(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["departmentReceive"],{"0562":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-edit"},[i("w-header",{attrs:{title:"选择成品BOM",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}},[i("van-icon",{staticClass:"header-confirm-btn",attrs:{slot:"header-right",name:"success"},on:{click:t.onItemConfirm},slot:"header-right"})],1),i("div",{staticClass:"item-search clearfix"},[i("van-search",{attrs:{placeholder:"请输入搜索关键词",shape:"round"},on:{search:t.search,focus:t.onSearchFocus},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}})],1),i("div",{staticClass:"item-edit-content"},[i("addItemClassList",{attrs:{itemClassList:t.itemClassList},on:{"on-change-class":t.changeClass},model:{value:t.currentClass,callback:function(e){t.currentClass=e},expression:"currentClass"}}),i("addItemList",{ref:"addItemList",attrs:{listLoading:t.listLoading,loadFinished:t.loadFinished,itemList:t.itemList},on:{"update:listLoading":function(e){t.listLoading=e},"update:list-loading":function(e){t.listLoading=e},"on-load-more":t.onLoadMore},scopedSlots:t._u([{key:"item-cell",fn:function(e){return[i("addBomCell",{attrs:{itemData:e.$item,itemIndex:e.$index,rowActive:t.rowActive,itemAmoutName:"bomAmount"},on:{"on-item-click":t.onItemEdit,"on-checkbox-click":t.clickCheckBoxes}})]}}]),model:{value:t.rowActive,callback:function(e){t.rowActive=e},expression:"rowActive"}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.numberKeyboardShow,expression:"numberKeyboardShow"}],staticClass:"details-number-keyboard"},[i("itemNumberKeyboard",{attrs:{title:t.keyboardTitleCompted,otherTitle:t.keyboardBomTitleCompted,unit:t.keyboardUnitCompted,unitEdit:!1,amount:t.keyboardAmountCompted,pointSize:t.sysPointSize,intLength:t.numberLength},on:{change:t.onKeyboardChange,"on-othertitle-edit":t.onOtherTitleClick,pre:t.onKeyboardPre,next:t.onKeyboardNext,hide:t.onKeyboardHide}})],1),i("van-actionsheet",{attrs:{actions:t.bomActions,"cancel-text":"取消"},on:{select:t.onBomSelect},model:{value:t.bomActionShow,callback:function(e){t.bomActionShow=e},expression:"bomActionShow"}})],1)},n=[],a=i("768b"),s=(i("20d6"),i("75fc")),r=(i("ac6a"),i("795b")),c=i.n(r),l=i("59ad"),u=i.n(l),d=(i("7514"),i("7f7f"),i("cebc")),h=i("2f62"),m=i("d444"),p=i("5443"),f=i("465e"),v=i("91c3"),S=10,b={name:"bomEditComp",components:{addItemClassList:m["a"],addItemList:p["a"],addBomCell:f["a"],itemNumberKeyboard:v["a"]},props:{visibleFlag:Boolean,shopId:{type:String,default:""}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",currentClass:"",itemClassList:[],itemList:[],numberKeyboardShow:!1,rowActive:"",selectedItemArr:[],itemListStart:0,listLoading:!1,loadFinished:!0,bomActionShow:!1,bomActions:[]}},computed:Object(d["a"])({},Object(h["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",loginerId:function(t){return t.loginer.loginerId}}),{keyboardTitleCompted:function(){if(""===this.rowActive)return"";var t=this.itemList[this.rowActive];return t.goods.name},keyboardBomTitleCompted:function(){if(""===this.rowActive)return"";var t=this.itemList[this.rowActive];return t.name},keyboardUnitCompted:function(){if(""===this.rowActive)return"";var t=this.itemList[this.rowActive];return t.unit.name},keyboardAmountCompted:function(){if(""===this.rowActive)return"0";var t=this.itemList[this.rowActive];return t.bomAmount}}),watch:{visibleFlag:{handler:function(t){t&&this.refresh()},immediate:!0},rowActive:function(t,e){""!==e?(this.numberStringAmount(e),""===t?this.numberKeyboardShow=!1:this.scrollToActive(t)):this.scrollToActive(t)}},methods:{refresh:function(){var t=this;this.searchKey="",this.selectedItemArr=[],this.getItemClass().then(function(e){t.itemClassList=e.goodsTypes,t.currentClass="",t.getItemByClass()})},onCloseClick:function(){this.rowActive="",this.$emit("update:visibleFlag",!1)},onItemConfirm:function(){var t=this,e=this.selectedItemArr.find(function(t){return 0===u()(t.bomAmount)});return e?(this.$fxToast.top("请填写数量!"),!1):this.selectedItemArr&&0!==this.selectedItemArr.length?(this.rowActive="",void this.$nextTick(function(){t.$emit("on-bom-confirm",t.selectedItemArr),t.$emit("update:visibleFlag",!1)})):(this.$fxToast.fail("请选择品项!"),!1)},search:function(){this.getItemByClass()},getItemClass:function(){var t=this;return new c.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/goodTypes")}).then(function(t){e(t)})})},getItem:function(){var t=this;return new c.a(function(e){var i={shopId:t.shopId,paged:!0,start:t.itemListStart,size:S,searchText:t.searchKey||"",goodsTypeId:t.currentClass||null};t.$fxHttp.requestPost({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/departmentreceivedetails"),data:i,query:{m:"getProductBomList"}}).then(function(t){t.productBom.forEach(function(t){t.checked=!1}),e(t)})})},getItemByClass:function(){var t=this;this.itemListStart=0,this.getItem().then(function(e){t.itemList=t.setResItem(e.productBom),t.setListLoading(e.productBom.length),t.selectedItemArr.length&&t.checkItem(t.itemList),t.$nextTick(function(){t.$refs.addItemList&&t.$refs.addItemList.onSelectLetter(0,5)})})},onLoadMore:function(){var t=this;this.getItem().then(function(e){var i;(i=t.itemList).push.apply(i,Object(s["a"])(t.setResItem(e.productBom))),t.setListLoading(e.productBom.length),t.selectedItemArr.length&&t.checkItem(e.productBom)})},setResItem:function(t){var e=this;return t.forEach(function(t){var i=e.selectedItemArr.findIndex(function(e){return t.goods.id===e.goods.id});~i?(t.bomAmount=e.selectedItemArr[i].bomAmount,t.name=e.selectedItemArr[i].name,t.id=e.selectedItemArr[i].id):t.bomAmount="0"}),t},setListLoading:function(t){this.listLoading=!1,this.itemListStart+=S,this.loadFinished=t<S},checkItem:function(t){var e=this;t.forEach(function(t,i){var o=e.selectedItemArr.find(function(e){return e.id===t.id});t.checked=!!o})},changeClass:function(t){var e=Object(a["a"])(t,2);e[0],e[1];this.searchKey="",this.onKeyboardHide(),this.getItemByClass()},onItemEdit:function(t){this.rowActive=t,this.numberKeyboardShow=!0},onKeyboardChange:function(t){this.itemList[this.rowActive].bomAmount=t,t>0?(this.itemList[this.rowActive].checked=!0,this.clickCheckBoxes(this.itemList[this.rowActive])):this.itemList[this.rowActive].checked=!1},numberStringAmount:function(t){var e=u()(this.itemList[t].bomAmount);this.itemList[t].bomAmount=e},onKeyboardPre:function(){if(!this.rowActive)return!1;this.rowActive--},onKeyboardNext:function(){if(""===this.rowActive||this.rowActive===this.itemList.length-1)return!1;this.rowActive++},onKeyboardHide:function(){this.rowActive=""},scrollToActive:function(t){var e=this;this.$nextTick(function(){e.$refs.addItemList.onSelectLetter(t,20)})},onSearchFocus:function(){this.rowActive=""},onOtherTitleClick:function(){var t=this,e=this.itemList[this.rowActive].goods.id;this.getBom(e).then(function(e){t.bomActions=e.productBom,t.bomActionShow=!0})},getBom:function(t){var e=this;return new c.a(function(i){var o={shopId:e.shopId,goodsId:t};e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.shopId,"/users/").concat(e.loginerId,"/departmentreceivedetails"),data:o,query:{m:"getProductBom"}}).then(function(t){i(t)})})},onBomSelect:function(t){this.bomActionShow=!1;var e=this.itemList[this.rowActive];e.name=t.name,e.id=t.id,e.unit=t.unit},clickCheckBoxes:function(t){t.checked?~this.getSelectItemIndex(t)||this.selectedItemArr.push(t):this.selectedItemArr.splice(this.getSelectItemIndex(t),1)},getSelectItemIndex:function(t){return this.selectedItemArr.findIndex(function(e){return e.id===t.id})}}},g=b,w=(i("1030"),i("2877")),I=Object(w["a"])(g,o,n,!1,null,"de7ef240",null);e["a"]=I.exports},"0597":function(t,e,i){"use strict";var o=i("0f09"),n=i.n(o);n.a},"073f":function(t,e,i){},"0e16":function(t,e,i){},"0f09":function(t,e,i){},1030:function(t,e,i){"use strict";var o=i("0e16"),n=i.n(o);n.a},"28a21":function(t,e,i){"use strict";var o=i("fef9"),n=i.n(o);n.a},"2fe3":function(t,e,i){"use strict";var o=i("af43"),n=i.n(o);n.a},"465e":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-detail-cell",class:{"is-active":t.rowActive===t.itemIndex,"is-error":t.isError},on:{click:t.onItemClick}},[i("div",{staticClass:"item-details-img"},[i("img",{attrs:{src:t.comptedItemImgSrc(t.itemData.goods.imageUrls),onerror:t.$fxCommon.errorImg("item")}})]),i("div",{staticClass:"item-details-params"},[i("div",{staticClass:"item-details-name fx-ellipsis"},[t._v(t._s(t.itemData.goods.name))]),i("div",{staticClass:"item-details-spec fx-ellipsis"},[t._v("\n\t\t\t"+t._s(t.itemData.name)+"\n\t\t")]),i("div",{staticClass:"item-details-amount"},[i("span",{staticClass:"item-details-count"},[t._v(t._s(t.getItemAmount()))]),i("span",{staticClass:"item-details-unit"},[t._v(t._s(t.itemData.unit.name))])]),i("i",{directives:[{name:"show",rawName:"v-show",value:t.getItemAmount()>0||t.isActive,expression:"(getItemAmount()>0 || isActive)"}],staticClass:"item-selected-icon"})]),i("van-checkbox",{staticClass:"item-checkbox",on:{click:function(e){return t.clickCheckBoxes()}},model:{value:t.itemData.checked,callback:function(e){t.$set(t.itemData,"checked",e)},expression:"itemData.checked"}})],1)},n=[],a=(i("c5f6"),{name:"bomAddItemCell",props:{itemData:{type:Object,default:function(){return{}}},itemIndex:Number,rowActive:[Number,String],isActive:Boolean,isError:Boolean,showSpec:{type:Boolean,default:!0},itemAmoutName:{type:String,default:""}},computed:{comptedItemImgSrc:function(t){return function(t){return t?0===t.length?"":t[0]:""}}},methods:{onItemClick:function(){this.$emit("on-item-click",this.itemIndex)},getItemAmount:function(){return""===this.itemAmoutName?this.itemData.busUnitAmount:this.itemData[this.itemAmoutName]},clickCheckBoxes:function(){this.$emit("on-checkbox-click",this.itemData)}}}),s=a,r=(i("cfc1"),i("2877")),c=Object(r["a"])(s,o,n,!1,null,"395c4cae",null);e["a"]=c.exports},"489c":function(t,e,i){},"4b65":function(t,e,i){},"4b97":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"itemRowEdit-popup"},[i("w-header",{attrs:{title:t.currentItemData.goodsDTO.name,leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{staticClass:"itemRowEdit-content"},[i("van-cell-group",[i("van-cell",{attrs:{title:"当前库存数量",value:t.currentItemData.storeAmount,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"非税单价",value:t.currentItemData.price,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"税率",value:t.fomatterTaxes(t.currentItemData.tax),"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"税额",value:t.currentItemData.taxOutMoney,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"含税单价",value:t.currentItemData.taxPrice,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"含税金额",value:t.currentItemData.outMoneyWithTax,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"批次号",value:t.currentItemData.batchCode,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"规格",value:t.currentItemData.goodsDTO.spec,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"品项编号",value:t.currentItemData.goodsDTO.code,"value-class":"info-item-value"}}),i("van-pro-field",{attrs:{label:"备注","value-class":"info-item-value",placeholder:t.setPlaceholder("请输入备注"),"input-align":"right",disabled:t.isDisabled},model:{value:t.currentItemData.memo,callback:function(e){t.$set(t.currentItemData,"memo",e)},expression:"currentItemData.memo"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"净重量",value:t.toFixedNumberSize(t.currentItemData.netWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"皮重量",value:t.toFixedNumberSize(t.currentItemData.skinWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"毛重量",value:t.toFixedNumberSize(t.currentItemData.grossWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"称重单位",value:t.currentItemData.weightUnit,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"称重状态",value:t.currentItemData.isWeightSign?"已称重":"未称重","value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"图片",border:!1,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData&&t.currentItemData.images.length,expression:"sysShowDZCData && currentItemData.images.length"}],staticClass:"info-cell-img",attrs:{"value-class":"info-item-img"}},[i("img",{attrs:{src:t.comptedItemImgSrc(t.currentItemData.images)}})])],1)],1),i("div",{staticClass:"itemRowEdit-bottom"},[t.isDisabled?i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onCloseClick}},[t._v("确定")]):i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onConfirmClick}},[t._v("保存")])],1)],1)},n=[],a=i("59ad"),s=i.n(a),r=i("f499"),c=i.n(r),l=i("cebc"),u=i("2f62"),d={name:"itemRowEdit",props:{visibleFlag:Boolean,itemData:{type:Object,default:function(){return{}}},isDisabled:Boolean},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},currentItemData:{}}},computed:Object(l["a"])({},Object(u["c"])({sysShowDZCData:function(t){return t.systemParams.sysShowDZCData},sysPointSize:"sysPointSize"}),{setPlaceholder:function(t){var e=this;return function(t){return e.isDisabled?"":t}},comptedItemImgSrc:function(t){return function(t){return t?0===t.length?"":t[0].imagUrl:""}},fomatterTaxes:function(t){var e=this;return function(t){if(t){var i=e.$fxUtils.toFixedSHW(100*t,2,!1);return"".concat(i,"%")}return"0%"}}}),watch:{visibleFlag:{handler:function(t){t&&(this.currentItemData=JSON.parse(c()(this.itemData)))},immediate:!0}},methods:{toFixedNumberSize:function(t){return s()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onConfirmClick:function(){this.currentItemData.id&&(this.currentItemData.changeType="edit"),this.$emit("on-Confirm",this.currentItemData),this.$emit("update:visibleFlag",!1)}}},h=d,m=(i("f5b2"),i("2877")),p=Object(m["a"])(h,o,n,!1,null,"01d2e7dd",null);e["a"]=p.exports},"4fa5":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-search-block"},[i("w-header",{attrs:{title:"搜索品项",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("searchHead",{attrs:{initSearch:t.visibleFlag,searchKey:t.searchKey},on:{"update:searchKey":function(e){t.searchKey=e},"update:search-key":function(e){t.searchKey=e},"on-select-click":t.onSelectAllClick}}),i("div",{ref:"details-content",staticClass:"item-list"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeStoreNames,callback:function(e){t.activeStoreNames=e},expression:"activeStoreNames"}},t._l(t.data,function(e){return i("van-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.$fxCommon.storeFilter(e,t.searchKey),expression:"$fxCommon.storeFilter(storeItem, searchKey)"}],key:e.id,staticClass:"store-row",attrs:{name:e.id}},[i("div",{staticClass:"item-store-title fx-ellipsis",attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),t._l(t.$fxCommon.detailFilter(e.details,t.searchKey),function(o,n){return i("van-swipe-cell",{directives:[{name:"show",rawName:"v-show",value:"del"!==o.changeType,expression:"item.changeType !== 'del'"}],key:e.id+"-"+o.goodsDTO.id+"-"+o.goodsUUid,ref:"details-row-"+e.id+"-"+o.goodsDTO.id,refInFor:!0,staticClass:"item-row",attrs:{"right-width":80,disabled:t.isDisabled||t.focusing}},[i("div",{staticClass:"item-cell"},[i("itemInfoCell",{staticClass:"search-info",attrs:{itemData:o,isDisabled:t.isDisabled,disabledEditBtn:t.focusing,autoType:t.autoType},on:{"on-item-focus":function(i){return t.onItemFocus(arguments,e.id+"-"+o.goodsDTO.id)},"on-item-blur":t.onItemBlur,"on-unit-edit":t.onUnitEdit,"on-item-edit":t.onSearchItemEdit}})],1),i("div",{staticClass:"item-row-delete",attrs:{slot:"right"},on:{click:function(i){return t.onDeleteClick(o,n,e.details)}},slot:"right"},[t._v("删除")])])})],2)}),1)],1),i("div",{staticClass:"search-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onSearchConfirm}},[t._v("保存")])],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,isDisabled:t.isDisabled},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}})],1)},n=[],a=(i("7514"),i("795b")),s=i.n(a),r=i("59ad"),c=i.n(r),l=(i("20d6"),i("ac6a"),i("c5f6"),i("e40b")),u=i("4b97"),d=i("01db"),h={name:"itemSearchPop",components:{itemInfoCell:l["a"],itemRowEditPop:u["a"],searchHead:d["a"]},props:{data:{type:Array,default:function(){return[]}},isDisabled:Boolean,visibleFlag:Boolean,autoType:{type:Number,default:1}},data:function(){return{focusing:!1,leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",unitActions:[],unitActionShow:!1,itemRowEditPopShow:!1,itemEditRowData:{},activeStoreNames:[]}},watch:{visibleFlag:{handler:function(t){var e=this;t&&(this.searchKey="",this.setDetailGoodsUUid(this.data),this.data.forEach(function(t){var i=t.details.filter(function(t){return"del"!==t.changeType}).length;i>0&&e.activeStoreNames.push(t.id)}))},immediate:!0}},computed:{isSelectAll:function(){var t=this;if(this.isDisabled)return"";var e=0,i=0;return this.data.forEach(function(o){var n=t.$fxCommon.detailFilter(o.details,t.searchKey);e+=n.filter(function(t){return"del"!==t.changeType&&t.checked}).length,i+=n.length}),0!==e&&e===i}},methods:{setDetailGoodsUUid:function(t){var e=this;t.forEach(function(t){t.details.forEach(function(t){t.goodsUUid=e.$fxUtils.createUUID()})})},onCloseClick:function(){if(this.focusing)return!1;this.$emit("update:visibleFlag",!1)},onDeleteClick:function(t,e,i){t.id?this.$set(t,"changeType","del"):i.splice(e,1)},onItemFocus:function(t,e){this.focusing=!0},onItemBlur:function(){this.focusing=!1},onSearchItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this.data.findIndex(function(e){return e.id===t.outHouseDTO.id});if(~e){var i=this.data[e].details.findIndex(function(e){return e.goodsDTO.id===t.goodsDTO.id});~i&&(this.data[e].details[i]=t)}},onUnitEdit:function(t){var e=this;this.itemEditRowData=t,this.getItemUnit(t.goodsDTO.id).then(function(t){e.unitActions=t,e.unitActionShow=!0})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemEditRowData,i=e.unitDTO.value,o=t,n=c()(e.storeAmount);n>0&&(n=n*i/o.value,e.storeAmount=c()(this.$fxUtils.toFixedSHW(n,this.sysPointSize))),0===e.busUnitOutAmount?(e.price=c()(this.$fxUtils.toFixedSHW(e.price*o.value/i,this.sysPointSize)),e.taxPrice=c()(this.$fxUtils.toFixedSHW(e.taxPrice*o.value/i,this.sysPointSize))):(e.price=c()(this.$fxUtils.toFixedSHW(e.outMoney/e.busUnitOutAmount,this.sysPointSize)),e.taxPrice=c()(this.$fxUtils.toFixedSHW(e.outMoneyWithTax/e.busUnitOutAmount,this.sysPointSize))),e.unitDTO=t},getItemUnit:function(t){var e=this;return new s.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/users/").concat(e.loginerId,"/goods/").concat(t,"/units")}).then(function(t){i(t.units)})})},onSearchConfirm:function(){if(this.focusing)return!1;this.$emit("on-search-confirm",this.data),this.$emit("update:visibleFlag",!1)},onCheckBoxClick:function(t){if(this.focusing)return!1;this.$set(t,"checked",!t.checked)},onSelectAllClick:function(){var t=this,e=!this.isSelectAll;this.data.forEach(function(i){var o=t.$fxCommon.detailFilter(i.details,t.searchKey);o.forEach(function(i){"del"!==i.changeType&&t.$set(i,"checked",e)})})},onSelectConfirm:function(){var t=this,e=this.data.find(function(t){return t.details.find(function(t){return t.checked&&"del"!==t.changeType})});if(!e)return this.$fxToast.top("请先选择品项!"),!0;this.$dialog.confirm({title:"提示",message:"是否删除？"}).then(function(){t.data.forEach(function(e){for(var i=e.details,o=i.length-1;o>=0;o--){var n=i[o];n.checked&&(n.id?t.$set(n,"changeType","del"):e.details.splice(o,1))}})})}}},m=h,p=(i("cee3"),i("2877")),f=Object(p["a"])(m,o,n,!1,null,"1b748d0e",null);e["a"]=f.exports},"532e":function(t,e,i){},5372:function(t,e,i){"use strict";var o=i("de18"),n=i.n(o);n.a},5443:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"details-content",staticClass:"item-details-content"},[i("van-list",{attrs:{finished:t.loadFinished,"finished-text":"没有更多了",error:t.listError,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.listError=e},load:t.onLoadMore},model:{value:t.currentListLoading,callback:function(e){t.currentListLoading=e},expression:"currentListLoading"}},t._l(t.itemList,function(e,o){return i("div",{key:e.goods.id,ref:"details-row-"+o,refInFor:!0,staticClass:"item-detail"},[t._t("item-cell",null,{$item:e,$index:o})],2)}),0)],1)},n=[],a=(i("c5f6"),{name:"bomAddItemList",props:{value:[String,Number],itemList:{type:Array,default:function(){return[]}},listLoading:Boolean,loadFinished:Boolean,listError:{type:Boolean,default:!1}},data:function(){return{activeNames:[],currentListLoading:!1}},watch:{listLoading:{handler:function(t){this.currentListLoading=t},immediate:!0},currentListLoading:function(t){this.$emit("update:listLoading",t)}},computed:{comptedItemImgSrc:function(t){return function(t){return 0===t.length?"":t[0]}}},methods:{onLoadMore:function(){this.$emit("on-load-more")},onSelectLetter:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40,i=this.$refs["details-row-".concat(t)];if(!i||0===i.length)return!1;var o=i[0].offsetTop,n=this.$refs["details-content"];this.$fxUtils.scrollTopW({offsetTop:o,$el:n,distance:e})}}}),s=a,r=(i("28a21"),i("2877")),c=Object(r["a"])(s,o,n,!1,null,"5d77ea3a",null);e["a"]=c.exports},"6ceb":function(t,e,i){},"717b":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-info-cell"},[i("div",{staticClass:"item-img"},[i("img",{attrs:{src:t.comptedItemImgSrc(t.itemData.goods.imageUrls),onerror:t.$fxCommon.errorImg("item")}})]),i("div",{staticClass:"item-details"},[i("div",{staticClass:"item-name-money"},[i("div",{staticClass:"item-name fx-ellipsis"},[t._v(t._s(t.itemData.goods.name))])]),i("div",{staticClass:"item-row"},[i("span",[t._v(t._s(t.itemData.bomName))])]),i("div",{staticClass:"item-row item-amount"},[i("span",[t._v(t._s(t.itemData.bomAmount))]),i("span",{staticClass:"item-unit-text"},[t._v(t._s(t.itemData.unit.name))])])])])},n=[],a={name:"bomInfoCell",props:{itemData:{type:Object,default:function(){return{}}}},computed:{comptedItemImgSrc:function(t){return function(t){return t?0===t.length?"":t[0]:""}}},methods:{}},s=a,r=(i("e67d"),i("2877")),c=Object(r["a"])(s,o,n,!1,null,"84f7efd6",null);e["a"]=c.exports},"779b":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-edit"},[i("w-header",{attrs:{title:"选择品项",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}},[i("van-icon",{staticClass:"header-confirm-btn",attrs:{slot:"header-right",name:"success"},on:{click:t.onItemConfirm},slot:"header-right"})],1),i("div",{staticClass:"item-search clearfix"},[i("van-search",{attrs:{placeholder:"请输入搜索关键词",shape:"round"},on:{search:t.search,focus:t.onSearchFocus},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}})],1),i("div",{staticClass:"item-edit-content"},[i("addItemClassList",{attrs:{itemClassList:t.itemClassList},on:{"on-change-class":t.changeClass},model:{value:t.currentClass,callback:function(e){t.currentClass=e},expression:"currentClass"}}),i("addItemList",{ref:"addItemList",attrs:{listLoading:t.listLoading,loadFinished:t.loadFinished,itemList:t.itemList},on:{"update:listLoading":function(e){t.listLoading=e},"update:list-loading":function(e){t.listLoading=e},"on-load-more":t.onLoadMore},scopedSlots:t._u([{key:"item-cell",fn:function(e){return[i("addItemCell",{attrs:{itemData:e.$item,itemIndex:e.$index,rowActive:t.rowActive,itemAmoutName:"busUnitOutAmount",isError:e.$index===t.isErrorActive},on:{"on-item-click":t.onItemEdit}})]}}]),model:{value:t.rowActive,callback:function(e){t.rowActive=e},expression:"rowActive"}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.numberKeyboardShow,expression:"numberKeyboardShow"}],staticClass:"details-number-keyboard"},[i("itemNumberKeyboard",{attrs:{title:t.keyboardTitleCompted,unit:t.keyboardUnitCompted,unitEdit:!0,amount:t.keyboardAmountCompted,pointSize:t.sysPointSize,intLength:t.numberLength},on:{change:t.onKeyboardChange,"on-unit-unitEdit":t.onUnitEdit,pre:t.onKeyboardPre,next:t.onKeyboardNext,hide:t.onKeyboardHide}})],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}})],1)},n=[],a=i("59ad"),s=i.n(a),r=(i("20d6"),i("75fc")),c=i("795b"),l=i.n(c),u=(i("ac6a"),i("f499")),d=i.n(u),h=(i("7f7f"),i("cebc")),m=(i("c5f6"),i("2f62")),p=i("d444"),f=i("01f7"),v=i("9c7f"),S=i("af41"),b=10,g={name:"itemEditComp",components:{addItemClassList:p["a"],addItemList:f["a"],addItemCell:v["a"],itemNumberKeyboard:S["a"]},props:{visibleFlag:Boolean,store:{type:Object,default:function(){return{}}},shopId:{type:String,default:""},businessDate:{type:[String,Number],default:""},parentStoreItem:{type:Array,default:function(){return[]}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",currentClass:"",itemClassList:[],itemList:[],numberKeyboardShow:!1,rowActive:"",selectedItemArr:[],itemListStart:0,listLoading:!1,loadFinished:!0,listError:!1,isErrorActive:"",unitActionShow:!1,unitActions:[]}},computed:Object(h["a"])({},Object(m["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{keyboardTitleCompted:function(){if(""===this.rowActive)return"";var t=this.itemList[this.rowActive];return t.goodsDTO.name},keyboardUnitCompted:function(){if(""===this.rowActive)return"";var t=this.itemList[this.rowActive];return t.unitDTO.name},keyboardAmountCompted:function(){if(""===this.rowActive)return"0";var t=this.itemList[this.rowActive];return t.busUnitOutAmount}}),watch:{visibleFlag:{handler:function(t){t&&(this.selectedItemArr=JSON.parse(d()(this.parentStoreItem)),this.refresh())},immediate:!0},rowActive:function(t,e){""!==e?(this.numberStringAmount(e),this.pushSelectedItem(this.itemList[e]),""===t?this.numberKeyboardShow=!1:this.scrollToActive(t)):this.scrollToActive(t)}},methods:{refresh:function(){var t=this;this.searchKey="",this.getItemClass().then(function(e){t.itemClassList=e.goodsTypes,t.currentClass="",t.getItemByClass()})},onCloseClick:function(){this.rowActive="",this.$emit("update:visibleFlag",!1)},onItemConfirm:function(){var t=this;this.rowActive="",this.$nextTick(function(){t.selectedItemArr.forEach(function(e){e.outHouseDTO||(e.outHouseDTO=t.store)}),t.$emit("on-confirm",[t.selectedItemArr,t.store]),t.$emit("update:visibleFlag",!1)})},search:function(){this.getItemByClass()},getItemClass:function(){var t=this;return new l.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/goodTypes")}).then(function(t){e(t)})})},getItem:function(){var t=this;return new l.a(function(e){var i={start:t.itemListStart,size:b,paged:!0,goodsTypeId:t.currentClass||null,inHouseId:t.store.id,orgId:t.shopId,searchText:t.searchKey||null,workDate:t.businessDate};t.$fxHttp.requestPost({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/departmentreceivedetails"),data:i,query:{m:"getFullkcAmoutGoodslist"}}).then(function(t){e(t)})})},getItemByClass:function(){var t=this;this.itemListStart=0,this.getItem().then(function(e){t.itemList=t.setResItem(e.billAndDetails),t.setListLoading(e.billAndDetails.length),t.$nextTick(function(){t.$refs.addItemList.onSelectLetter(0,5)})})},onLoadMore:function(){var t=this;this.getItem().then(function(e){var i;(i=t.itemList).push.apply(i,Object(r["a"])(t.setResItem(e.billAndDetails))),t.setListLoading(e.billAndDetails.length)})},setResItem:function(t){var e=this;return t.forEach(function(t){var i=e.selectedItemArr.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id});~i&&"del"!==e.selectedItemArr[i].changeType?(t.busUnitOutAmount=e.selectedItemArr[i].busUnitOutAmount,t.unitDTO=e.selectedItemArr[i].unitDTO):t.busUnitOutAmount="0"}),t},setListLoading:function(t){this.listLoading=!1,this.itemListStart+=b,this.loadFinished=t<b},changeClass:function(){this.searchKey="",this.onKeyboardHide(),this.getItemByClass()},onItemEdit:function(t){this.rowActive=t,this.numberKeyboardShow=!0},onKeyboardChange:function(t){this.itemList[this.rowActive].busUnitOutAmount=t},numberStringAmount:function(t){var e=this.itemList[t].busUnitOutAmount;this.itemList[t].busUnitOutAmount=s()(e),this.calcMoney("amount",e,this.itemList[t])},calcMoney:function(t,e,i){var o=i.busUnitOutAmount,n=i.price,a=i.tax,s=0,r=0,c=0,l=0,u=this.toFixedNumberSize(e);if(i.giftFlag||"money"===t&&0===u)return i.outMoney=0,!0;"money"===t?(s=u,c=this.toFixedNumberSize(s/o),r=s*(1+a),l=this.toFixedNumberSize(r/o)):"amount"===t?(""!==e&&(i.busUnitOutAmount=u),c=n,s=this.toFixedNumberSize(n*u),r=this.toFixedNumberSize(0*u)):"moneyWithTax"===t?(r=u,l=this.toFixedNumberSize(r/o),s=this.toFixedNumberSize(r/(1+a)),c=this.toFixedNumberSize(s/o)):"taxPrice"===t?(l=u,r=this.toFixedNumberSize(o*l),c=this.toFixedNumberSize(l/(1+a)),s=this.toFixedNumberSize(c*o)):"price"===t&&(c=u,s=this.toFixedNumberSize(c*o),l=this.toFixedNumberSize(c*(1+a)),r=this.toFixedNumberSize(o*l)),i.outMoney=s,i.price=c},toFixedNumberSize:function(t){return s()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},pushSelectedItem:function(t){var e=this.selectedItemArr.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id});~e?this.selectedItemArr[e].id||0!==t.busUnitOutAmount?(this.selectedItemArr[e].id&&(0===t.busUnitOutAmount?"del"!==this.selectedItemArr[e].changeType&&(this.selectedItemArr[e].changeType="del",this.$fxToast({message:"删除已选品项".concat(t.goodsDTO.name),position:"top"})):this.selectedItemArr[e].changeType="edit"),this.selectedItemArr[e].busUnitOutAmount=t.busUnitOutAmount,this.selectedItemArr[e].unitDTO=t.unitDTO):(this.selectedItemArr.splice(e,1),this.$fxToast({message:"删除已选品项".concat(t.goodsDTO.name),position:"top"})):t.busUnitOutAmount>0&&(t.changeType="add",this.selectedItemArr.push(t))},onKeyboardPre:function(){if(!this.rowActive)return!1;this.rowActive--},onKeyboardNext:function(){if(""===this.rowActive||this.rowActive===this.itemList.length-1)return!1;this.rowActive++},onKeyboardHide:function(){this.rowActive=""},checkRoundingError:function(t,e){return t&&e%t!==0},scrollToActive:function(t){var e=this;this.$nextTick(function(){e.$refs.addItemList.onSelectLetter(t,20)})},onSearchFocus:function(){this.rowActive=""},onUnitEdit:function(){var t=this,e=this.itemList[this.rowActive].goodsDTO.id;this.getItemUnit(e).then(function(e){t.unitActions=e,t.unitActionShow=!0})},getItemUnit:function(t){var e=this;return new l.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/shopId/users/userId/goods/").concat(t,"/units"),query:{userId:e.loginerId}}).then(function(t){i(t.units)})})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemList[this.rowActive];e.unitDTO=t}}},w=g,I=(i("aa41"),i("2877")),D=Object(I["a"])(w,o,n,!1,null,"bf7556fe",null);e["a"]=D.exports},"7d80":function(t,e,i){},8379:function(t,e,i){},"85ec":function(t,e,i){"use strict";var o=i("073f"),n=i.n(o);n.a},"916a":function(t,e,i){},9687:function(t,e,i){},"9d96":function(t,e,i){"use strict";var o=i("4b65"),n=i.n(o);n.a},a2f5:function(t,e,i){"use strict";var o=i("916a"),n=i.n(o);n.a},a6e6:function(t,e,i){"use strict";var o=i("c5e3"),n=i.n(o);n.a},aa41:function(t,e,i){"use strict";var o=i("6ceb"),n=i.n(o);n.a},ab2e:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-search-block"},[i("w-header",{attrs:{title:"已导入BOM",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{staticClass:"item-search clearfix"},[i("van-search",{attrs:{placeholder:"请输入搜索关键词",shape:"round"},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}})],1),i("div",{ref:"details-content",staticClass:"item-list bom-search-list"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeStoreNames,callback:function(e){t.activeStoreNames=e},expression:"activeStoreNames"}},t._l(t.data,function(e){return i("van-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.storeShowComputed(e),expression:"storeShowComputed(storeItem)"}],key:e.id,staticClass:"store-row",attrs:{name:e.id}},[i("div",{staticClass:"item-store-title fx-ellipsis",attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),t._l(t.detailFilter(e.details),function(o){return i("van-swipe-cell",{directives:[{name:"show",rawName:"v-show",value:"del"!==o.changeType,expression:"item.changeType !== 'del'"}],key:e.id+"-"+o.goods.id+"-"+o.goodsUUid,ref:"details-row-"+e.id+"-"+o.goods.id,refInFor:!0,staticClass:"item-row"},[i("div",{staticClass:"item-cell"},[i("bomInfoCell",{staticClass:"search-info",attrs:{itemData:o},on:{"on-item-focus":function(i){return t.onItemFocus(arguments,e.id+"-"+o.goods.id)}}})],1)])})],2)}),1)],1)],1)},n=[],a=(i("6762"),i("2fdb"),i("28a5"),i("7514"),i("ac6a"),i("717b")),s={name:"bomSearchPop",components:{bomInfoCell:a["a"]},props:{data:{type:Array,default:function(){return[]}},visibleFlag:Boolean,searchKeywords:String},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",activeStoreNames:[]}},watch:{visibleFlag:{handler:function(t){var e=this;t&&(this.searchKey="",this.setDetailGoodsUUid(this.data),this.data.forEach(function(t){var i=t.details.filter(function(t){return"del"!==t.changeType}).length;i>0&&e.activeStoreNames.push(t.id)}))},immediate:!0}},methods:{setDetailGoodsUUid:function(t){var e=this;t.forEach(function(t){t.details.forEach(function(t){t.goodsUUid=e.$fxUtils.createUUID()})})},storeShowComputed:function(t){return this.detailFilter(t.details).length>0},detailFilter:function(t){var e=this;return t.filter(function(t){return!!e.searchKeywords.split(",").find(function(i){if(t.goods[i].toLowerCase().includes(e.searchKey.toLowerCase()))return!0})})},onCloseClick:function(){this.$emit("update:visibleFlag",!1)}}},r=s,c=(i("db75"),i("2877")),l=Object(c["a"])(r,o,n,!1,null,"59ae6c62",null);e["a"]=l.exports},ad91:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-info-block fx-shadow-block"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},[i("van-collapse-item",{attrs:{name:"1",disabled:t.collapseDisabled}},[i("div",{staticClass:"info-title",attrs:{slot:"title"},slot:"title"},[i("span",{staticClass:"info-title-name"},[t._v("单据信息")]),i("stateText",{staticClass:"stateTag fl-r",attrs:{billState:t.data.billState}}),i("span",{directives:[{name:"show",rawName:"v-show",value:1===t.data.weightState,expression:"data.weightState === 1"}],staticClass:"info-title-weightState"},[t._v("待称重")])],1),i("van-tabs",{attrs:{animated:""},model:{value:t.tabActive,callback:function(e){t.tabActive=e},expression:"tabActive"}},[i("van-tab",{attrs:{title:"表头"}},[i("van-cell",{staticClass:"info-item",attrs:{title:"出库机构","value-class":"info-item-value",value:t.data.shopDTO&&t.data.shopDTO.name,"is-link":!t.isDisabled&&t.isAutoType([1])},on:{click:function(e){return t.onEmitClick("on-shop-click")}}}),i("van-cell",{staticClass:"info-item",attrs:{title:"部门","value-class":"info-item-value",value:t.data.departmentDTO&&t.data.departmentDTO.name,"is-link":!t.isDisabled&&t.isAutoType([1])},on:{click:function(e){return t.onEmitClick("on-department-click")}}}),i("van-cell",{staticClass:"info-item",attrs:{title:"业务日期",value:t.formatterDate(t.data.businessDate),"is-link":!t.isDisabled&&t.isAutoType([1])},on:{click:t.onBusDateClick}}),i("van-pro-field",{staticClass:"info-item",attrs:{label:"手工单号",placeholder:t.isDisabled?"":"请输入手工单号","input-align":"right",maxlength:"50",disabled:t.isDisabled},model:{value:t.data.manualCode,callback:function(e){t.$set(t.data,"manualCode",e)},expression:"data.manualCode"}}),i("van-cell",{staticClass:"info-item",attrs:{title:"业务人","value-class":"info-item-value",value:t.data.employeeDTO&&t.data.employeeDTO.name},on:{click:function(e){return t.onEmitClick("on-employee-click")}}},[i("van-icon",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&t.isAutoType([1]),expression:"!isDisabled && isAutoType([1])"}],staticClass:"item-clear-btn",attrs:{slot:"right-icon",name:t.hasEmployee?"close":"arrow"},on:{click:function(e){e.stopPropagation(),t.hasEmployee?t.onEmitClick("on-employee-clear"):t.onEmitClick("on-employee-click")}},slot:"right-icon"})],1),t.$fxSysAuth("departmentReceiveBill.viewSubject")?i("van-cell",{staticClass:"info-item",attrs:{title:"科目","value-class":"info-item-value",value:t.data.subjectDTO&&t.data.subjectDTO.name},on:{click:function(e){return t.onEmitClick("on-subject-click")}}},[i("van-icon",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"item-clear-btn",attrs:{slot:"right-icon",name:t.hasSubject?"close":"arrow"},on:{click:function(e){e.stopPropagation(),t.hasSubject?t.onEmitClick("on-subject-clear"):t.onEmitClick("on-subject-click")}},slot:"right-icon"})],1):t._e()],1),i("van-tab",{attrs:{title:"更多"}},[i("van-cell",{staticClass:"info-item",attrs:{title:"制单人",value:t.data.billEmp}}),i("van-cell",{staticClass:"info-item",attrs:{title:"制单日期",value:t.formatterDate(t.data.billDate)}}),i("van-cell",{staticClass:"info-item",attrs:{title:"审核人",value:t.data.checkEmp}}),i("van-cell",{staticClass:"info-item",attrs:{title:"审核日期",value:t.formatterDate(t.data.checkDate)}}),i("van-pro-field",{staticClass:"info-item",attrs:{label:"整单备注",placeholder:t.isDisabled?"":"请输入整单备注","input-align":"right",maxlength:"50",disabled:t.isDisabled||t.isAutoType([5])},model:{value:t.data.billMemo,callback:function(e){t.$set(t.data,"billMemo",e)},expression:"data.billMemo"}}),i("van-cell",{staticClass:"info-item",attrs:{title:"单据类型","value-class":"info-item-value",value:t.data.businessTypeDTO&&t.data.businessTypeDTO.name},on:{click:function(e){return t.onEmitClick("on-billType-click")}}},[i("van-icon",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"item-clear-btn",attrs:{slot:"right-icon",name:t.hasBillType?"close":"arrow"},on:{click:function(e){e.stopPropagation(),t.hasBillType?t.onEmitClick("on-billType-clear"):t.onEmitClick("on-billType-click")}},slot:"right-icon"})],1)],1)],1)],1)],1)],1)},n=[],a=(i("6762"),i("2fdb"),i("6b54"),i("4760")),s={name:"orderInfo",components:{stateText:a["a"]},props:{data:{type:Object,default:function(){return{}}},isDisabled:Boolean,collapseDisabled:Boolean},data:function(){return{activeNames:["1"],tabActive:0}},computed:{formatterDate:function(t){var e=this;return function(t){return"number"===typeof t?e.$fxUtils.setDateTime(new Date(t),"时分"):""}},hasEmployee:function(){return this.data.employeeDTO&&this.data.employeeDTO.id},isAutoType:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.data.autoType):e.data.autoType===t}},hasBillType:function(){return this.data.businessTypeDTO&&this.data.businessTypeDTO.id},hasSubject:function(){return this.data.subjectDTO&&this.data.subjectDTO.id}},methods:{onEmitClick:function(t){if(this.isDisabled||this.isAutoType([5]))return!1;this.$emit(t)},onBusDateClick:function(){this.onEmitClick("on-busdate-click")},closeCollapse:function(){this.activeNames=[]}}},r=s,c=(i("5372"),i("2877")),l=Object(c["a"])(r,o,n,!1,null,"6419b0d9",null);e["a"]=l.exports},af43:function(t,e,i){},b0b1:function(t,e,i){},b2e7:function(t,e,i){"use strict";var o=i("8379"),n=i.n(o);n.a},b417:function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-departmentReceive"},[i("w-header",{attrs:{title:"部门领用单",border:!0}},[i("headEditBtn",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("departmentReceiveBill.check"),expression:"$fxAuth('departmentReceiveBill.check')"}],attrs:{slot:"header-right",active:t.orderEditFlag},on:{click:t.onOrderEditClick},slot:"header-right"}),i("headSearchBtn",{directives:[{name:"show",rawName:"v-show",value:!t.orderEditFlag,expression:"!orderEditFlag"}],attrs:{slot:"header-right"},on:{click:t.onSearchClick},slot:"header-right"}),i("headSelectAllBtn",{directives:[{name:"show",rawName:"v-show",value:t.orderEditFlag,expression:"orderEditFlag"}],attrs:{slot:"header-right",active:t.isSelectAll},on:{click:t.onSelectAllClick},slot:"header-right"})],1),i("filterTab",{attrs:{state:t.computedState,billReState:t.computedBillReState},on:{"on-state-click":t.onStateClick,"on-billReState-click":t.onBillReStateClick}}),i("div",{staticClass:"departmentReceive-content"},[i("van-pull-refresh",{directives:[{name:"show",rawName:"v-show",value:0!==t.orderList.length,expression:"orderList.length !== 0"}],staticClass:"departmentReceive-list",on:{refresh:t.onPullRefresh},model:{value:t.pullRefreshLoading,callback:function(e){t.pullRefreshLoading=e},expression:"pullRefreshLoading"}},[i("van-list",{attrs:{finished:t.loadFinished,"finished-text":"没有更多了",error:t.listError,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.listError=e},load:t.onLoadMore},model:{value:t.listLoading,callback:function(e){t.listLoading=e},expression:"listLoading"}},t._l(t.orderList,function(e){return i("orderBlock",{directives:[{name:"show",rawName:"v-show",value:t.computedShowOrder(e.billState),expression:"computedShowOrder(item.billState)"}],key:e.id,attrs:{data:e,showCheckBox:t.orderEditFlag},on:{"on-click":function(i){return t.onClickOrder(e)}}})}),1)],1),i("emptyBill",{directives:[{name:"show",rawName:"v-show",value:0===t.orderList.length,expression:"orderList.length === 0"}]})],1),i("div",{staticClass:"departmentReceive-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.orderEditFlag&&t.$fxAuth("departmentReceiveBill.add"),expression:"!orderEditFlag && $fxAuth('departmentReceiveBill.add')"}],staticClass:"add-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onCreateClick}},[t._v("添加单据")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.orderEditFlag&&t.$fxAuth("departmentReceiveBill.check"),expression:"orderEditFlag && $fxAuth('departmentReceiveBill.check')"}],staticClass:"add-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onExpressClick}},[t._v("批量审核")])],1),i("van-actionsheet",{attrs:{actions:t.stateActions,"cancel-text":"取消"},on:{select:t.onStateSelect},model:{value:t.stateActionShow,callback:function(e){t.stateActionShow=e},expression:"stateActionShow"}}),i("van-actionsheet",{attrs:{actions:t.billReStateActions,"cancel-text":"取消"},on:{select:t.onBillReStateSelect},model:{value:t.billReStateActionShow,callback:function(e){t.billReStateActionShow=e},expression:"billReStateActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.filterPopShow,callback:function(e){t.filterPopShow=e},expression:"filterPopShow"}},[i("filterPop",{attrs:{visibleFlag:t.filterPopShow,filterParams:t.filterParams},on:{"update:visibleFlag":function(e){t.filterPopShow=e},"update:visible-flag":function(e){t.filterPopShow=e},"update:filterParams":function(e){t.filterParams=e},"update:filter-params":function(e){t.filterParams=e},"on-confirm":t.onFilterConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.filterPopShow,callback:function(e){t.filterPopShow=e},expression:"filterPopShow"}},[i("filterPop",{attrs:{visibleFlag:t.filterPopShow,filterParams:t.filterParams},on:{"update:visibleFlag":function(e){t.filterPopShow=e},"update:visible-flag":function(e){t.filterPopShow=e},"update:filterParams":function(e){t.filterParams=e},"update:filter-params":function(e){t.filterParams=e},"on-confirm":t.onFilterConfirm}})],1)],1)},n=[],a=(i("ac6a"),i("75fc")),s=i("5176"),r=i.n(s),c=i("795b"),l=i.n(c),u=(i("7514"),i("7f7f"),i("cebc")),d=(i("6762"),i("2f62")),h=i("b215"),m=i("46aa"),p=i("a0be"),f=i("4102"),v=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-block fx-shadow-block",on:{click:t.onClick}},[i("checkBox",{staticClass:"order-checkbox",attrs:{visibleFlag:t.showCheckBox,checked:t.data.checked},on:{"on-checkbox-click":t.onClick}}),i("div",{staticClass:"block-content"},[i("div",{staticClass:"block-title"},[i("i",{staticClass:"block-icon"}),i("span",{staticClass:"title-text"},[t._v(t._s(t.data.shopDTO.name))]),i("stateTag",{staticClass:"state-tag",attrs:{billState:t.data.billState,reCheckState:t.data.billReState}})],1),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No"}),i("div",{staticClass:"order-date fx-price-font"},[i("span",[t._v("金额：")]),i("span",[t._v("￥"+t._s(t.toFixedNumberSize(t.data.sumOutMoney)))])])]),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No"},[i("span",[t._v("明细数：")]),i("span",[t._v(t._s(t.data.detailCount))])]),i("div",{staticClass:"order-date"},[i("span",[t._v("业务日期：")]),i("span",[t._v(t._s(t._f("filterDateYMD")(t.data.businessDate)))]),i("van-icon",{staticClass:"order-date-arrow",attrs:{name:"arrow"}})],1)])])],1)},S=[],b=i("59ad"),g=i.n(b),w=i("0f38"),I=i("0b26"),D={name:"orderBlock",components:{stateTag:I["a"],checkBox:w["a"]},props:{data:{type:Object,default:function(){return{}}},showCheckBox:{type:Boolean,default:!1}},computed:Object(u["a"])({},Object(d["c"])({sysPointSize:"sysPointSize"}),{toFixedNumberSize:function(t){var e=this;return function(t){return g()(e.$fxUtils.toFixedSHW(t,e.sysPointSize))}}}),methods:{onClick:function(){this.showCheckBox?this.$set(this.data,"checked",!this.data.checked):this.$emit("on-click",this.data)}}},y=D,C=(i("b2e7"),i("2877")),k=Object(C["a"])(y,v,S,!1,null,"175c0d9c",null),x=k.exports,L=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"filter-popup"},[i("w-header",{attrs:{title:"筛选条件",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{ref:"filterContent",staticClass:"filter-content"},[i("van-cell-group",[i("van-cell",{attrs:{title:"业务日期"}}),i("van-cell",{attrs:{title:"起始时间",value:t.beginDate,"is-link":""},on:{click:t.onBeginDateClick}}),i("van-cell",{attrs:{title:"结束时间",value:t.endDate,"is-link":""},on:{click:t.endDateClick}}),i("van-cell",{attrs:{title:"机构",value:t.shop,"value-class":"info-item-value","is-link":""},on:{click:t.onShopClick}}),i("van-cell",{attrs:{title:"出库仓库",value:t.store,"value-class":"info-item-value","is-link":""},on:{click:t.onStoreClick}}),i("van-cell",{attrs:{title:"部门",value:t.department,"value-class":"info-item-value","is-link":""},on:{click:t.onDepartmentClick}}),i("van-cell",{attrs:{title:"品项",value:t.item,"value-class":"info-item-value","is-link":""},on:{click:t.onItemClick}}),i("van-field",{ref:"billNo",attrs:{label:"系统单号","value-class":"info-item-value",placeholder:"请输入系统单号","input-align":"right"},on:{focus:function(e){return t.onFocus("billNo")}},model:{value:t.billNo,callback:function(e){t.billNo=e},expression:"billNo"}})],1)],1),i("div",{staticClass:"filter-bottom"},[i("van-button",{staticClass:"reset-btn fx-no-radius",attrs:{type:"info"},on:{click:t.onResetClick}},[t._v("重置")]),i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onConfirmClick}},[t._v("确定")])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("filterListPopup",{attrs:{title:"出库机构检索",rollingLoad:!0,getDataApi:t.getShopListData},on:{"on-select":function(e){return t.selectShop(arguments)}},model:{value:t.shopPopShow,callback:function(e){t.shopPopShow=e},expression:"shopPopShow"}}),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.storePopShow,callback:function(e){t.storePopShow=e},expression:"storePopShow"}},[i("listComp",{attrs:{visibleFlag:t.storePopShow,data:t.storeList,loadFinished:!0,title:"仓库检索"},on:{"update:visibleFlag":function(e){t.storePopShow=e},"update:visible-flag":function(e){t.storePopShow=e},"on-search":t.searchStore,"on-select":t.selectStore}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.departmentPopShow,callback:function(e){t.departmentPopShow=e},expression:"departmentPopShow"}},[i("listComp",{attrs:{visibleFlag:t.departmentPopShow,data:t.departmentList,loadFinished:t.departmentListLoadFinished,loading:t.onDepartmentLoading,title:"部门检索"},on:{"update:visibleFlag":function(e){t.departmentPopShow=e},"update:visible-flag":function(e){t.departmentPopShow=e},"update:loading":function(e){t.onDepartmentLoading=e},"on-search":t.searchDepartment,"on-select":t.selectDepartment,"on-load":t.onDepartmentLoad}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.itemPopShow,callback:function(e){t.itemPopShow=e},expression:"itemPopShow"}},[i("listComp",{attrs:{visibleFlag:t.itemPopShow,data:t.itemList,loadFinished:t.itemListLoadFinished,loading:t.onItemLoading,title:"品项检索"},on:{"update:visibleFlag":function(e){t.itemPopShow=e},"update:visible-flag":function(e){t.itemPopShow=e},"update:loading":function(e){t.onItemLoading=e},"on-search":t.searchItem,"on-select":t.selectItem,"on-load":t.onItemLoad}})],1)],1)},P=[],T=i("768b"),A=i("f6bb"),O=i("eb03"),B=50,$={name:"filterPop",components:{listComp:A["a"],filterListPopup:O["a"]},props:{visibleFlag:Boolean,filterParams:{type:Object,default:function(){return{}}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},dateType:"",currentDate:new Date,beginDate:this.$fxCommon.orderFilterStartDate(),endDate:this.$fxCommon.orderFilterEndDate(),shop:"请选择",shopId:"",store:"请选择",storeId:"",department:"请选择",departmentId:"",item:"请选择",itemId:"",billNo:"",datePickerShow:!1,shopPopShow:!1,storePopShow:!1,departmentPopShow:!1,departmentListStart:0,departmentListLoadFinished:!1,onDepartmentLoading:!1,searchDepartmentKey:null,itemPopShow:!1,storeList:[],departmentList:[],itemList:[],itemListStart:0,onItemLoading:!1,itemListLoadFinished:!1}},watch:{visibleFlag:{handler:function(t){t&&this.$fxUtils.isEmptyObjSHW(this.filterParams)&&this.resetHandler()},immediate:!0}},computed:Object(u["a"])({},Object(d["c"])({loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}})),methods:{getFilterParams:function(){return{beginDate:this.beginDate||this.$fxCommon.orderFilterStartDate(),endDate:this.endDate||this.$fxCommon.orderFilterEndDate(),shopId:this.shopId,departmentId:this.departmentId,storeId:this.storeId,itemId:this.itemId,billNo:this.billNo}},onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onConfirmClick:function(){this.$emit("update:visibleFlag",!1),this.$emit("update:filterParams",this.getFilterParams()),this.$emit("on-confirm",this.getFilterParams())},onResetClick:function(){this.resetHandler()},resetHandler:function(){this.beginDate=this.$fxCommon.orderFilterStartDate(),this.endDate=this.$fxCommon.orderFilterEndDate(),this.shop="请选择",this.shopId="",this.store="请选择",this.storeId="",this.department="请选择",this.departmentId="",this.item="请选择",this.itemId="",this.billNo=""},onBeginDateClick:function(){this.dateType="begin",this.beginDate&&(this.currentDate=new Date(this.beginDate)),this.datePickerShow=!0},endDateClick:function(){this.dateType="end",this.endDate&&(this.currentDate=new Date(this.endDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){"begin"===this.dateType?(this.beginDate=this.$fxUtils.setDateTime(t,"时分"),this.endDate&&this.$fxCommon.orderFilterRangeDate(this.beginDate,this.endDate)||(this.endDate=this.$fxCommon.orderFilterDate(t))):(this.endDate=this.$fxUtils.setDateTime(t,"时分"),this.beginDate&&this.$fxCommon.orderFilterRangeDate(this.beginDate,this.endDate)||(this.beginDate=this.$fxCommon.orderFilterStartDate(t))),this.datePickerShow=!1},onShopClick:function(){this.shopPopShow=!0},selectShop:function(t){var e=Object(T["a"])(t,1),i=e[0];this.shop=i.name,this.shopId=i.id},getShopListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,o={keyword:t,start:e,size:i};return this.$fxApi("z5common.getUserManageShop")({data:o}).then(function(t){return t.shops})},onStoreClick:function(){if(!this.shopId)return this.$fxToast.fail("请选择机构!"),!1;this.onStoreRefresh()},searchStore:function(t){this.onStoreRefresh(t)},selectStore:function(t){this.store=t.name,this.storeId=t.id},onStoreRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getStoreListData(e).then(function(e){t.storeList=e.shops,t.storePopShow=!0})},getStoreListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new l.a(function(i){var o={keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/houses"),data:o}).then(function(t){i(t)})})},onDepartmentClick:function(){this.departmentListStart=0,this.searchDepartmentKey=null,this.departmentListLoadFinished=!1,this.onDepartmentRefresh()},searchDepartment:function(t){this.departmentListStart=0,this.searchDepartmentKey=t,this.onDepartmentRefresh()},selectDepartment:function(t){this.department=t.name,this.departmentId=t.id},onDepartmentRefresh:function(){var t=this;this.getDepartmentListData().then(function(e){t.onDepartmentLoading=!1,t.departmentList=e.departmentDTOData,t.departmentPopShow=!0})},onDepartmentLoad:function(){var t=this;this.getDepartmentListData().then(function(e){var i;t.onDepartmentLoading=!1,(i=t.departmentList).push.apply(i,Object(a["a"])(e.departmentDTOData))})},getDepartmentListData:function(){var t=this;return new l.a(function(e){var i={start:t.departmentListStart,size:B,keyword:t.searchDepartmentKey};t.shopId?i.id=t.shopId:i.selAll="on",t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/department/report"),data:i}).then(function(i){t.departmentListStart+=B,i.departmentDTOData.length<B?t.departmentListLoadFinished=!0:t.departmentListLoadFinished=!1,e(i)})})},onItemClick:function(){this.onItemRefresh()},searchItem:function(t){this.onItemRefresh(t)},selectItem:function(t){this.item=t.name,this.itemId=t.id},onItemRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.itemListStart=0,this.itemListLoadFinished=!1,this.getItemListData(e).then(function(e){t.itemPopShow=!0,t.onItemLoading=!1,t.itemListStart+=B,e.goods.length<B&&(t.itemListLoadFinished=!0),t.itemList=e.goods})},onItemLoad:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getItemListData(e).then(function(e){var i;t.onItemLoading=!1,t.itemListStart+=B,e.goods.length<B&&(t.itemListLoadFinished=!0),(i=t.itemList).push.apply(i,Object(a["a"])(e.goods))})},getItemListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new l.a(function(i){var o={start:t.itemListStart,size:B,paged:!0,keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/goods"),data:o}).then(function(t){i(t)})})},onFocus:function(t){this.onScrollTop(t)},onScrollTop:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,i=this.$refs[t];if(!i||0===i.length)return!1;var o=i.$el.offsetTop,n=this.$refs["filterContent"];this.$fxUtils.scrollTopW({offsetTop:o,$el:n,distance:e})}}},F=$,E=(i("9d96"),Object(C["a"])(F,L,P,!1,null,"051ea3dc",null)),R=E.exports,j=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"departmentReceive-filter fx-shadow-down"},[i("div",{staticClass:"filter-item",on:{click:t.onStateClick}},[i("span",[t._v("审核状态")]),i("van-icon",{staticClass:"filter-arrow",attrs:{name:"arrow-down"}}),i("span",[t._v(t._s(t.state))])],1),i("div",{staticClass:"filter-item",on:{click:t.onBillReStateClick}},[i("span",[t._v("复审状态")]),i("van-icon",{staticClass:"filter-arrow",attrs:{name:"arrow-down"}}),i("span",[t._v(t._s(t.billReState))])],1)])},N=[],U={name:"filterTab",props:{state:String,billReState:String},methods:{onStateClick:function(){this.$emit("on-state-click")},onBillReStateClick:function(){this.$emit("on-billReState-click")}}},_=U,H=(i("e876"),Object(C["a"])(_,j,N,!1,null,"526293de",null)),z=H.exports,K=50,W={name:"departmentReceive",components:{headSearchBtn:h["a"],headEditBtn:m["a"],headSelectAllBtn:p["a"],emptyBill:f["a"],orderBlock:x,filterPop:R,filterTab:z},data:function(){return{orderList:[],filterPopShow:!1,filterState:null,stateActionShow:!1,stateActions:[{id:null,name:"全部"},{id:"0",name:"未审核"},{id:"1",name:"已审核"}],filterBillReState:null,billReStateActionShow:!1,billReStateActions:[{id:null,name:"全部"},{id:"0",name:"未复审"},{id:"1",name:"已复审"}],listStart:0,pullRefreshLoading:!1,listLoading:!1,loadFinished:!0,listError:!1,orderEditFlag:!1,filterParams:{}}},beforeRouteLeave:function(t,e,i){if("/login"===t.path)i();else{if(this.filterPopShow)return this.filterPopShow=!1,this.$router.go(1),!1;i()}},beforeRouteEnter:function(t,e,i){var o=["/main/home","/"],n=["/departmentReceiveDetails"];o.includes(e.path)?i(function(e){e.restFilterParams(),e.restRouterParams(t.params),e.refreshOrderList()}):n.includes(e.path)?i(function(t){t.refreshOrderList()}):i()},computed:Object(u["a"])({},Object(d["c"])({billListPostParams:"billListPostParams",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{computedState:function(){var t=this;return this.stateActions.find(function(e){return e.id===t.filterState}).name},computedBillReState:function(){var t=this;return this.billReStateActions.find(function(e){return e.id===t.filterBillReState}).name},computedShowOrder:function(t){var e=this;return function(t){return!e.orderEditFlag||1!==t}},isSelectAll:function(){var t=this.orderList.filter(function(t){return 1!==t.billState});if(0===t.length)return!1;var e=t.filter(function(t){return!!t.checked});return e.length===t.length}}),methods:{orderListPostHandler:function(t){var e=this;return new l.a(function(i){e.$store.commit({type:"SETSTATE",billListPostParams:t}),e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/departmentReceive/users/").concat(e.loginerId),data:t}).then(function(t){i(t)})})},refreshOrderList:function(){var t=this;return new l.a(function(e){t.listStart=0;var i={start:t.listStart,size:K,paged:!0,businessDateStart:t.$fxCommon.orderFilterStartDate(),businessDateEnd:t.$fxCommon.orderFilterEndDate(),billState:t.filterState,reCheckState:t.filterBillReState};i=r()(i,t.translateFilterParams(t.filterParams)),t.orderListPostHandler(i).then(function(i){t.orderList=i.storeBills,e(i)})})},onFilterConfirm:function(t){var e=this;this.listStart=0;var i={start:this.listStart,size:K,paged:!0,businessDateStart:t.beginDate,businessDateEnd:t.endDate,billState:this.filterState,reCheckState:this.filterBillReState,shopId:""===t.shopId?null:t.shopId,departmentId:""===t.departmentId?null:t.departmentId,outHouseId:""===t.storeId?null:t.storeId,goodsId:""===t.itemId?null:t.itemId,sysBillCode:""===t.billNo?null:t.billNo};this.orderListPostHandler(i).then(function(t){e.orderList=t.storeBills})},translateFilterParams:function(t){return this.$fxUtils.isEmptyObjSHW(t)?{}:{businessDateStart:t.beginDate,businessDateEnd:t.endDate,shopId:""===t.shopId?null:t.shopId,departmentId:""===t.departmentId?null:t.departmentId,outHouseId:""===t.storeId?null:t.storeId,goodsId:""===t.itemId?null:t.itemId,sysBillCode:""===t.billNo?null:t.billNo}},onPullRefresh:function(){var t=this;this.refreshOrderList().then(function(e){t.pullRefreshLoading=!1})},onLoadMore:function(){var t=this,e=r()(this.billListPostParams,{start:this.listStart});this.orderListPostHandler(e).then(function(e){var i;(i=t.orderList).push.apply(i,Object(a["a"])(e.storeBills))})},onSearchClick:function(){this.filterPopShow=!0},onStateClick:function(){this.stateActionShow=!0},onStateSelect:function(t){this.filterState=t.id,this.stateActionShow=!1,this.refreshOrderList()},onBillReStateClick:function(){this.billReStateActionShow=!0},onBillReStateSelect:function(t){this.filterBillReState=t.id,this.billReStateActionShow=!1,this.refreshOrderList()},onClickOrder:function(t){this.$router.push({path:"departmentReceiveDetails",query:{orderId:t.id}})},onCreateClick:function(){this.$router.push("createDepartmentReceive")},onOrderEditClick:function(){this.orderEditFlag=!this.orderEditFlag},onExpressClick:function(){var t=this,e=this.orderList.reduce(function(t,e){var i=e.checked?t.concat(e.id):t;return i},[]);if(0===e.length)return!1;this.$dialog.confirm({title:"提示",message:"确定要审核所选单据?"}).then(function(){t.expressHandler(e).then(function(e){t.orderEditFlag=!t.orderEditFlag,t.refreshOrderList().then(function(){t.$fxToast.success(e.message)})})})},expressHandler:function(t){var e=this;return new l.a(function(i){e.$fxHttp.requestPut({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/departmentReceive/users/").concat(e.loginerId),data:t,query:{m:"batchCheck"}}).then(function(t){i(t)})})},onSelectAllClick:function(){var t=this,e=!this.isSelectAll;this.orderList.forEach(function(i){1!==i.billState&&t.$set(i,"checked",e)})},restFilterParams:function(){this.filterParams={},this.filterState=null,this.filterBillReState=null,this.orderEditFlag=!1},restRouterParams:function(t){this.$fxUtils.isEmptyObjSHW(t)||(this.filterState=t.billState)}}},q=W,M=(i("a6e6"),Object(C["a"])(q,o,n,!1,null,"12203e9b",null));e["default"]=M.exports},b7dbd:function(t,e,i){},bcb5:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"store-item"},[i("w-header",{attrs:{title:"编辑BOM明细",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{staticClass:"add-store-bar"},[i("van-button",{staticClass:"add-store-btn",attrs:{type:"primary",round:""},on:{click:t.onAddStoreClick}},[t._v("添加仓库")])],1),i("div",{staticClass:"store-item-content"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeStoreNames,callback:function(e){t.activeStoreNames=e},expression:"activeStoreNames"}},t._l(t.currentStoreItemData,function(e){return i("van-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.storeShowComputed(e),expression:"storeShowComputed(storeItem)"}],key:e.id,staticClass:"store-row",attrs:{name:e.id}},[i("div",{staticClass:"item-store-title",attrs:{slot:"title"},slot:"title"},[i("span",{staticClass:"item-store-name fx-ellipsis"},[t._v(t._s(e.name))])]),i("div",{staticClass:"item-storn-btn"},[i("span",{staticClass:"edit-btn",on:{click:function(i){return t.editStoreItem(e)}}})]),t._l(e.details,function(t){return i("div",{directives:[{name:"show",rawName:"v-show",value:"del"!==t.changeType,expression:"item.changeType !== 'del'"}],key:e.id+"-"+t.goods.id,staticClass:"item-row"},[i("bomInfoCell",{attrs:{itemData:t,isDisabled:!0,disabledWatchBtn:!0}})],1)})],2)}),1)],1),i("div",{staticClass:"store-item-bottom"},[i("van-button",{staticClass:"save-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onSaveClick}},[t._v("保存")])],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.storePopShow,callback:function(e){t.storePopShow=e},expression:"storePopShow"}},[i("listComp",{attrs:{visibleFlag:t.storePopShow,data:t.storeList,loadFinished:!0,title:"仓库检索"},on:{"update:visibleFlag":function(e){t.storePopShow=e},"update:visible-flag":function(e){t.storePopShow=e},"on-search":t.searchStore,"on-select":t.selectStore}})],1)],1)},n=[],a=(i("ac6a"),i("7f7f"),i("5176")),s=i.n(a),r=i("795b"),c=i.n(r),l=i("cebc"),u=i("2f62"),d=i("f6bb"),h=i("717b"),m={name:"storeItemComp",components:{listComp:d["a"],bomInfoCell:h["a"]},props:{visibleFlag:Boolean,shopId:{type:String,default:""},storeItemData:{type:Array,default:function(){return[]}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},storePopShow:!1,storeList:[],currentStoreObj:{},currentStoreItemData:[],activeStoreNames:[]}},computed:Object(l["a"])({},Object(u["c"])({loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{storeShowComputed:function(t){return function(t){var e=t.details.filter(function(t){return"del"!==t.changeType}).length;return e>0}}}),watch:{visibleFlag:{handler:function(t){t&&(this.currentStoreItemData=this.storeItemData,this.openStoreItemList(this.currentStoreItemData))},immediate:!0}},methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onAddStoreClick:function(){this.onStoreRefresh()},searchStore:function(t){this.onStoreRefresh(t)},selectStore:function(t){this.currentStoreObj=t,this.selectCurrentStore()},onStoreRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getStoreListData(e).then(function(e){t.storeList=e.shops,t.storePopShow=!0})},getStoreListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new c.a(function(i){var o={keyword:e,m:"getHouses4DepartmentBill"};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/houses"),data:o}).then(function(t){i(t)})})},editStoreItem:function(t){this.currentStoreObj=s()({},{code:t.code,id:t.id,name:t.name,pinYin:t.pinYin,updateIndicator:t.updateIndicator}),this.selectCurrentStore()},onSaveClick:function(){this.$emit("on-save",this.currentStoreItemData),this.$emit("update:visibleFlag",!1)},selectCurrentStore:function(){this.$emit("on-select-store",this.currentStoreObj),this.$emit("update:visibleFlag",!1)},openStoreItemList:function(t){var e=this;t.forEach(function(t){var i=t.details.filter(function(t){return"del"!==t.changeType}).length;i>0&&e.activeStoreNames.push(t.id)})}}},p=m,f=(i("0597"),i("2877")),v=Object(f["a"])(p,o,n,!1,null,"58606016",null);e["a"]=v.exports},bed3:function(t,e,i){},c5e3:function(t,e,i){},ced9:function(t,e,i){"use strict";var o=i("bed3"),n=i.n(o);n.a},cee3:function(t,e,i){"use strict";var o=i("b7dbd"),n=i.n(o);n.a},cfc1:function(t,e,i){"use strict";var o=i("7d80"),n=i.n(o);n.a},cfdd:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"store-item"},[i("w-header",{attrs:{title:"编辑部门领用单明细",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{staticClass:"add-store-bar"},[i("van-button",{staticClass:"add-store-btn",attrs:{type:"primary",round:""},on:{click:t.onAddStoreClick}},[t._v("添加仓库")])],1),i("div",{staticClass:"store-item-content"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeStoreNames,callback:function(e){t.activeStoreNames=e},expression:"activeStoreNames"}},t._l(t.currentStoreItemData,function(e,o){return i("van-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.storeShowComputed(e),expression:"storeShowComputed(storeItem)"}],key:e.id,staticClass:"store-row",attrs:{name:e.id}},[i("div",{staticClass:"item-store-title",attrs:{slot:"title"},slot:"title"},[i("span",{staticClass:"item-store-name fx-ellipsis"},[t._v(t._s(e.name))])]),i("div",{staticClass:"item-storn-btn"},[i("span",{staticClass:"edit-btn",on:{click:function(i){return t.editStoreItem(e)}}}),i("span",{staticClass:"delete-btn",on:{click:function(i){return t.deleteStoreItem(e,o)}}})]),t._l(e.details,function(t){return i("div",{directives:[{name:"show",rawName:"v-show",value:"del"!==t.changeType,expression:"item.changeType !== 'del'"}],key:e.id+"-"+t.goodsDTO.id,staticClass:"item-row"},[i("itemInfoCell",{attrs:{itemData:t,isDisabled:!0,disabledWatchBtn:!0}})],1)})],2)}),1)],1),i("div",{staticClass:"store-item-bottom"},[i("van-button",{staticClass:"save-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onSaveClick}},[t._v("保存")])],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.storePopShow,callback:function(e){t.storePopShow=e},expression:"storePopShow"}},[i("listComp",{attrs:{visibleFlag:t.storePopShow,data:t.storeList,loadFinished:!0,title:"仓库检索"},on:{"update:visibleFlag":function(e){t.storePopShow=e},"update:visible-flag":function(e){t.storePopShow=e},"on-search":t.searchStore,"on-select":t.selectStore}})],1)],1)},n=[],a=(i("ac6a"),i("7f7f"),i("5176")),s=i.n(a),r=i("768b"),c=i("795b"),l=i.n(c),u=(i("7514"),i("cebc")),d=i("2f62"),h=i("f6bb"),m=i("e40b"),p={name:"storeItemComp",components:{listComp:h["a"],itemInfoCell:m["a"]},props:{visibleFlag:Boolean,shopId:{type:String,default:""},storeItemData:{type:Array,default:function(){return[]}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},storePopShow:!1,storeList:[],currentStoreObj:{},currentStoreItemData:[],activeStoreNames:[]}},computed:Object(u["a"])({},Object(d["c"])({loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{computedStoreItem:function(){var t=this;if(this.$fxUtils.isEmptyObjSHW(this.currentStoreObj))return[];var e=this.currentStoreItemData.find(function(e){return e.id===t.currentStoreObj.id});return e?e.details:[]},storeShowComputed:function(t){return function(t){var e=t.details.filter(function(t){return"del"!==t.changeType}).length;return e>0}}}),watch:{visibleFlag:{handler:function(t){t&&(this.currentStoreItemData=this.storeItemData,this.openStoreItemList(this.currentStoreItemData))},immediate:!0}},methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onAddStoreClick:function(){this.onStoreRefresh()},searchStore:function(t){this.onStoreRefresh(t)},selectStore:function(t){this.currentStoreObj=t,this.selectCurrentStore()},onStoreRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getStoreListData(e).then(function(e){t.storeList=e.shops,t.storePopShow=!0})},getStoreListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new l.a(function(i){var o={keyword:e,m:"getHouses4DepartmentBill"};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/houses"),data:o}).then(function(t){i(t)})})},onItemEditConfirm:function(t){var e=Object(r["a"])(t,2),i=e[0],o=e[1],n=this.currentStoreItemData.find(function(t){return t.id===o.id});if(n)n.details=i;else{var a=s()({},o);a.details=i,this.currentStoreItemData.push(a)}this.openStoreItemList(this.currentStoreItemData)},editStoreItem:function(t){this.currentStoreObj=s()({},{code:t.code,id:t.id,name:t.name,pinYin:t.pinYin,updateIndicator:t.updateIndicator}),this.selectCurrentStore()},deleteStoreItem:function(t,e){var i=this;this.$dialog.confirm({title:"提示",message:"确定要删除当前仓库品项吗?"}).then(function(){var o=t.details.filter(function(t){return!!t.id});if(0===o.length)return i.currentStoreItemData.splice(e,1),!1;o.forEach(function(t){t.changeType="del"}),i.currentStoreItemData[e].details=o}).catch(function(){})},onSaveClick:function(){this.$emit("on-save",this.currentStoreItemData),this.$emit("update:visibleFlag",!1)},selectCurrentStore:function(){this.$emit("on-select-store",this.currentStoreObj),this.$emit("update:visibleFlag",!1)},openStoreItemList:function(t){var e=this;t.forEach(function(t){var i=t.details.filter(function(t){return"del"!==t.changeType}).length;i>0&&e.activeStoreNames.push(t.id)})}}},f=p,v=(i("2fe3"),i("2877")),S=Object(v["a"])(f,o,n,!1,null,"e87183d0",null);e["a"]=S.exports},d5a5:function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-departmentReceive-create"},[i("w-header",{attrs:{title:"新增部门领用单",border:!0}}),i("orderInfo",{ref:"orderInfo",attrs:{data:t.orderInfoData,collapseDisabled:t.itemInputFocusing},on:{"on-shop-click":t.onShopClick,"on-department-click":t.onDepartmentClick,"on-employee-click":t.onEmployeeClick,"on-employee-clear":t.onEmployeeClear,"on-busdate-click":t.onBusinessDateClick,"on-item-clear":t.onItemClear,"on-billType-click":t.onBillTypeClick,"on-billType-clear":t.onBillTypeClear,"on-subject-click":t.onSubjectClick,"on-subject-clear":t.onSubjectClear}}),i("orderItem",{attrs:{data:t.orderItemList,itemInputFocusing:t.itemInputFocusing,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id},on:{"update:itemInputFocusing":function(e){t.itemInputFocusing=e},"update:item-input-focusing":function(e){t.itemInputFocusing=e},"on-search-click":t.onSearchClick,"on-add-click":t.onAddClick,"on-unit-edit":t.onUnitEdit,"on-item-edit":t.onItemEdit,"on-item-focus":t.onItemFocus,"on-selectbom-click":t.onSelectBomClick,"on-viewbom-click":t.onViewBomClick}}),i("div",{staticClass:"departmentReceive-bottom"},[i("van-button",{staticClass:"add-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onCreateClick}},[t._v("生成单据")])],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.billTypePopShow,callback:function(e){t.billTypePopShow=e},expression:"billTypePopShow"}},[i("listComp",{attrs:{visibleFlag:t.billTypePopShow,data:t.billTypeList,loadFinished:!0,title:"单据类型检索"},on:{"update:visibleFlag":function(e){t.billTypePopShow=e},"update:visible-flag":function(e){t.billTypePopShow=e},"on-search":t.searchBillType,"on-select":t.selectBillType}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.subjectPopShow,callback:function(e){t.subjectPopShow=e},expression:"subjectPopShow"}},[i("listComp",{attrs:{visibleFlag:t.subjectPopShow,data:t.subjectList,loadFinished:!0,title:"科目检索"},on:{"update:visibleFlag":function(e){t.subjectPopShow=e},"update:visible-flag":function(e){t.subjectPopShow=e},"on-search":t.searchSubject,"on-select":t.selectSubject}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.shopPopShow,callback:function(e){t.shopPopShow=e},expression:"shopPopShow"}},[i("listComp",{attrs:{visibleFlag:t.shopPopShow,data:t.shopList,loadFinished:t.shopListLoadFinished,loading:t.onShopLoading,title:"请选择出库机构"},on:{"update:visibleFlag":function(e){t.shopPopShow=e},"update:visible-flag":function(e){t.shopPopShow=e},"update:loading":function(e){t.onShopLoading=e},"on-search":t.searchShop,"on-select":t.selectShop,"on-load":t.onShopLoad}})],1),i("filterListPopup",{attrs:{title:"请选择部门",rollingLoad:!0,getDataApi:t.getDepartmentListData},on:{"on-select":function(e){return t.selectDepartment(arguments)}},model:{value:t.departmentPopShow,callback:function(e){t.departmentPopShow=e},expression:"departmentPopShow"}}),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.employeePopShow,callback:function(e){t.employeePopShow=e},expression:"employeePopShow"}},[i("listComp",{attrs:{visibleFlag:t.employeePopShow,data:t.employeeList,loadFinished:t.employeeListLoadFinished,loading:t.onEmployeeLoading,title:"请选择业务人"},on:{"update:visibleFlag":function(e){t.employeePopShow=e},"update:visible-flag":function(e){t.employeePopShow=e},"update:loading":function(e){t.onEmployeeLoading=e},"on-search":t.searchEmployee,"on-select":t.selectEmployee,"on-load":t.onEmployeeLoad}})],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemStorePopShow,callback:function(e){t.itemStorePopShow=e},expression:"itemStorePopShow"}},[i("storeItemComp",{attrs:{visibleFlag:t.itemStorePopShow,storeItemData:t.storeItem,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id},on:{"update:visibleFlag":function(e){t.itemStorePopShow=e},"update:visible-flag":function(e){t.itemStorePopShow=e},"on-save":t.onStoreItemSave,"on-select-store":t.onStoreItemSelect}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemPopShow,callback:function(e){t.itemPopShow=e},expression:"itemPopShow"}},[i("itemEditComp",{attrs:{visibleFlag:t.itemPopShow,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,store:t.currentStoreObj,parentStoreItem:t.getStoreItem(),businessDate:t.orderInfoData.businessDate},on:{"update:visibleFlag":function(e){t.itemPopShow=e},"update:visible-flag":function(e){t.itemPopShow=e},"on-confirm":t.onItemEditConfirm}})],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemSearchPopShow,callback:function(e){t.itemSearchPopShow=e},expression:"itemSearchPopShow"}},[i("itemSearchPop",{attrs:{visibleFlag:t.itemSearchPopShow,data:t.searchItem,searchKeywords:"code,name,pinYin",isDisabled:!t.$fxAuth("departmentReceiveBill.save")},on:{"update:visibleFlag":function(e){t.itemSearchPopShow=e},"update:visible-flag":function(e){t.itemSearchPopShow=e},"on-search-confirm":t.onSearchConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.bomStorePopShow,callback:function(e){t.bomStorePopShow=e},expression:"bomStorePopShow"}},[i("storeBomComp",{attrs:{visibleFlag:t.bomStorePopShow,storeItemData:t.storeBom,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id},on:{"update:visibleFlag":function(e){t.bomStorePopShow=e},"update:visible-flag":function(e){t.bomStorePopShow=e},"on-save":t.onStoreBomSave,"on-select-store":t.onStoreBomSelect}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.bomPopShow,callback:function(e){t.bomPopShow=e},expression:"bomPopShow"}},[i("bomEditComp",{attrs:{visibleFlag:t.bomPopShow,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id},on:{"update:visibleFlag":function(e){t.bomPopShow=e},"update:visible-flag":function(e){t.bomPopShow=e},"on-bom-confirm":t.onBomConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.bomSearchPopShow,callback:function(e){t.bomSearchPopShow=e},expression:"bomSearchPopShow"}},[i("bomSearchPop",{attrs:{visibleFlag:t.bomSearchPopShow,data:t.searchBom,searchKeywords:"code,name,pinYin"},on:{"update:visibleFlag":function(e){t.bomSearchPopShow=e},"update:visible-flag":function(e){t.bomSearchPopShow=e}}})],1)],1)},n=[],a=(i("7f7f"),i("b6d0")),s=i.n(a),r=i("774e"),c=i.n(r),l=(i("7514"),i("20d6"),i("5176")),u=i.n(l),d=(i("ac6a"),i("a481"),i("f499")),h=i.n(d),m=i("59ad"),p=i.n(m),f=i("768b"),v=i("75fc"),S=i("795b"),b=i.n(S),g=i("cebc"),w=i("2f62"),I=i("ad91"),D=i("f720"),y=i("f6bb"),C=i("cfdd"),k=i("4b97"),x=i("4fa5"),L=i("779b"),P=i("bcb5"),T=i("0562"),A=i("ab2e"),O=i("eb03"),B=50,$={name:"createDepartmentReceive",components:{orderInfo:I["a"],orderItem:D["a"],listComp:y["a"],storeItemComp:C["a"],itemRowEditPop:k["a"],itemSearchPop:x["a"],itemEditComp:L["a"],storeBomComp:P["a"],bomEditComp:T["a"],bomSearchPop:A["a"],filterListPopup:O["a"]},data:function(){return{query:this.$route.query,activeNames:["1"],tabActive:"选项1",orderInfoData:{accountDTO:{},billEmp:"",billMemo:"",billState:0,businessDate:(new Date).getTime(),shopDTO:{},departmentDTO:{},employeeDTO:{},details:[],updateIndicator:"Append",autoType:1},orderItemList:[],currentDate:new Date,shopPopShow:!1,shopList:[],shopListStart:0,searchShopKey:null,shopListLoadFinished:!1,onShopLoading:!1,departmentPopShow:!1,departmentList:[],searchDepartmentKey:null,employeePopShow:!1,employeeList:[],employeeListStart:0,searchEmployeeKey:null,employeeListLoadFinished:!1,onEmployeeLoading:!1,datePickerShow:!1,itemStorePopShow:!1,storeItem:[],unitActions:[],unitActionShow:!1,itemRowEditPopShow:!1,itemEditRowData:{},itemInputFocusing:!1,itemSearchPopShow:!1,searchItem:[],currentStoreObj:{},itemPopShow:!1,orderBomList:[],storeBom:[],bomStorePopShow:!1,currentBomStoreObj:{},bomPopShow:!1,bomSearchPopShow:!1,searchBom:[],billTypePopShow:!1,billTypeList:[],subjectList:[],subjectPopShow:!1}},computed:Object(g["a"])({},Object(w["c"])({sysPointSize:"sysPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerShopName:function(t){return t.loginer.loginerShopName},loginerOrganType:function(t){return t.loginer.loginerOrganType},loginerId:function(t){return t.loginer.loginerId},loginerName:function(t){return t.loginer.loginerName}})),created:function(){var t=this;this.loginerShopId&&this.$fxStateMiddleware.stateIs("loginerOrganType")(["shop","center","area"])(this.loginerOrganType)&&(this.orderInfoData.shopDTO={id:this.loginerShopId,name:this.loginerShopName},this.orderInfoData.employeeDTO={id:this.loginerId,name:this.loginerName},this.getDepartmentListData(null,0,2).then(function(e){1===e.length&&(t.orderInfoData.departmentDTO=e[0])}))},beforeRouteLeave:function(t,e,i){var o=this;if(this.itemInputFocusing)return this.$router.go(1),!1;"/departmentReceive"===t.path?this.$dialog.confirm({title:"提示",message:"若已修改,请先保存单据<br/>是否关闭页面?"}).then(function(){i()}).catch(function(){return o.$router.go(1),!1}):i()},methods:{clearItemConfim:function(t){var e=this;return new b.a(function(i){var o=e.orderItemList.filter(function(t){var e=t.details.filter(function(t){return"del"!==t.changeType});return 0!==e.length});0===o.length?i():e.$dialog.confirm({title:"提示",message:t}).then(function(){e.onItemClear(),i()}).catch(function(){})})},onShopClick:function(){this.shopListStart=0,this.searchShopKey=null,this.shopListLoadFinished=!1,this.onShopRefresh()},searchShop:function(t){this.shopListStart=0,this.searchShopKey=t,this.onShopRefresh()},onShopRefresh:function(){var t=this;this.getShopListData().then(function(e){t.onShopLoading=!1,t.shopList=e.shops,t.shopPopShow=!0})},onShopLoad:function(){var t=this;this.getShopListData().then(function(e){var i;t.onShopLoading=!1,(i=t.shopList).push.apply(i,Object(v["a"])(e.shops))})},getShopListData:function(){var t=this;return new b.a(function(e){var i={start:t.shopListStart,size:B,keyword:t.searchShopKey,m:"list4ShopOtherOrderBill4Edit"};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/shops"),data:i}).then(function(i){t.shopListStart+=B,i.shops.length<B?t.shopListLoadFinished=!0:t.shopListLoadFinished=!1,e(i)})})},selectShop:function(t){var e=this;this.checkShop(t).then(function(){e.clearItemConfim("更换出库机构清空明细,是否继续?").then(function(){e.orderInfoData.shopDTO=t,e.orderInfoData.employeeDTO={id:e.loginerId,name:e.loginerName},e.getDepartmentListData(null,0,2).then(function(t){1===t.length?e.orderInfoData.departmentDTO=t[0]:e.orderInfoData.departmentDTO={}})})})},checkShop:function(t){var e=this;return new b.a(function(i){var o=e.orderInfoData.shopDTO||{};o.id!==t.id&&i()})},onDepartmentClick:function(){if(!this.orderInfoData.shopDTO.id)return this.$fxToast.fail("请先选择出库机构!"),!1;this.departmentPopShow=!0},getDepartmentListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,o={keyword:t,start:e,size:i},n={id:this.orderInfoData.shopDTO.id};return this.$fxApi("z5common.getDepartment",n)({data:o}).then(function(t){return t.departmentDTOData})},selectDepartment:function(t){var e=this,i=Object(f["a"])(t,1),o=i[0];this.checkDepartment(o).then(function(){e.clearItemConfim("更换部门清空明细,是否继续?").then(function(){e.orderInfoData.departmentDTO=o})})},checkDepartment:function(t){var e=this;return new b.a(function(i){var o=e.orderInfoData.departmentDTO||{};o.id!==t.id&&i()})},onEmployeeClick:function(){if(!this.orderInfoData.shopDTO.id)return this.$fxToast.fail("请先选择出库机构!"),!1;this.employeeListStart=0,this.searchEmployeeKey=null,this.employeeListLoadFinished=!1,this.onEmployeeRefresh()},searchEmployee:function(t){this.employeeListStart=0,this.searchEmployeeKey=t,this.onEmployeeRefresh()},onEmployeeRefresh:function(){var t=this;this.getEmployeeListData().then(function(e){t.onEmployeeLoading=!1,t.employeeList=e.employeeDTOData,t.employeePopShow=!0})},onEmployeeLoad:function(){var t=this;this.getEmployeeListData().then(function(e){var i;t.onEmployeeLoading=!1,(i=t.employeeList).push.apply(i,Object(v["a"])(e.employeeDTOData))})},getEmployeeListData:function(){var t=this;return new b.a(function(e){var i={start:t.employeeListStart,size:B,keyword:t.searchEmployeeKey};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/employee/report/").concat(t.orderInfoData.shopDTO.id),data:i}).then(function(i){t.employeeListStart+=B,i.employeeDTOData.length<B?t.employeeListLoadFinished=!0:t.employeeListLoadFinished=!1,e(i)})})},selectEmployee:function(t){this.orderInfoData.employeeDTO=t},onEmployeeClear:function(){this.orderInfoData.employeeDTO={}},onUnitEdit:function(t){var e=this;this.itemEditRowData=t,this.getItemUnit(t.goodsDTO.id).then(function(t){e.unitActions=t,e.unitActionShow=!0})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemEditRowData,i=e.unitDTO.value,o=t,n=p()(e.storeAmount);n>0&&(n=n*i/o.value,e.storeAmount=p()(this.$fxUtils.toFixedSHW(n,this.sysPointSize))),e.unitDTO=t},getItemUnit:function(t){var e=this;return new b.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/users/").concat(e.loginerId,"/goods/").concat(t,"/units")}).then(function(t){i(t.units)})})},onBusinessDateClick:function(){this.orderInfoData.businessDate&&(this.currentDate=new Date(this.orderInfoData.businessDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){var e=t.getTime();this.orderInfoData.businessDate=e,this.datePickerShow=!1},onAddClick:function(){var t=this;this.checkOrderInfo().then(function(){t.storeItem=JSON.parse(h()(t.orderItemList)),t.itemStorePopShow=!0})},checkOrderInfo:function(){var t=this;return new b.a(function(e,i){t.orderInfoData.businessDate?t.orderInfoData.shopDTO.id?t.orderInfoData.departmentDTO.id?!t.$fxSysAuth("departmentReceiveBill.viewSubject")||t.orderInfoData.subjectDTO&&t.orderInfoData.subjectDTO.id?!t.$fxSysAuth("departmentReceiveBill.viewSubject")||t.orderInfoData.businessTypeDTO&&t.orderInfoData.businessTypeDTO.id?e():t.$fxToast.top("请先选择单据类型!"):t.$fxToast.top("请先选择科目!"):t.$fxToast.top("请先选择部门!"):t.$fxToast.top("请先选择出库机构!"):t.$fxToast.top("请先选择业务日期!")})},onStoreItemSave:function(t){this.orderInfoData.details=t,this.orderItemList=this.orderInfoData.details},onCreateClick:function(){var t=this;if(this.itemInputFocusing)return!1;this.$dialog.confirm({title:"提示",message:"确定生成单据吗?"}).then(function(){t.checkOrderInfo().then(t.checkHasDetails).then(function(){var e=t.getSaveParams();t.createHandler(e)})}).catch(function(){})},createHandler:function(t){var e=this;this.$fxHttp.requestPost({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/departmentReceive"),data:t}).then(function(t){e.$fxToast.success("生成单据成功").then(function(){e.$router.replace({path:"departmentReceiveDetails",query:{orderId:t.storeBills[0].id}})})})},getSaveParams:function(){var t=[],e=[];this.orderItemList.forEach(function(e){t.push.apply(t,Object(v["a"])(e.details))});var i=t.filter(function(t){return"add"===t.changeType});this.orderBomList.forEach(function(t){e.push.apply(e,Object(v["a"])(t.details))});var o=u()({},this.orderInfoData,{detailAdd:i,billBom:e,accountDTO:{id:this.loginerId}});return o},getValidItem:function(){var t=[];return this.orderItemList.forEach(function(e){t.push.apply(t,Object(v["a"])(e.details))}),t},getItemLength:function(){return this.getValidItem().length},checkHasDetails:function(){var t=this;return new b.a(function(e){0===t.getItemLength()?t.onAddClick():e()})},onItemClear:function(){this.orderInfoData.details=[],this.orderItemList=this.orderInfoData.details},onItemFocus:function(){this.$refs.orderInfo.closeCollapse()},onItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this.orderItemList.findIndex(function(e){return e.id===t.outHouseDTO.id});if(~e){var i=this.orderItemList[e].details.findIndex(function(e){return e.goodsDTO.id===t.goodsDTO.id});~i&&(this.orderItemList[e].details[i]=t)}},onSearchClick:function(){this.itemSearchPopShow=!0,this.searchItem=JSON.parse(h()(this.orderItemList))},onSearchConfirm:function(t){this.orderItemList=t},onStoreItemSelect:function(t){this.currentStoreObj=t,this.itemPopShow=!0},getStoreItem:function(){var t=this;if(this.$fxUtils.isEmptyObjSHW(this.currentStoreObj))return[];var e=this.orderItemList.find(function(e){return e.id===t.currentStoreObj.id});return e?e.details:[]},onItemEditConfirm:function(t){var e=Object(f["a"])(t,2),i=e[0],o=e[1],n=this.orderItemList.find(function(t){return t.id===o.id});if(n)n.details=i;else{var a=u()({},o);a.details=i,this.orderItemList.push(a)}},onSelectBomClick:function(){var t=this;this.checkOrderInfo().then(function(){t.storeBom=JSON.parse(h()(t.orderBomList)),t.bomStorePopShow=!0})},onStoreBomSelect:function(t){this.currentBomStoreObj=t,this.bomPopShow=!0},onStoreBomSave:function(t){this.orderBomList=t},onViewBomClick:function(){this.orderBomList.length?(this.searchBom=JSON.parse(h()(this.orderBomList)),this.bomSearchPopShow=!0):this.$fxToast.top("没有已导入的BOM数据！")},onBomConfirm:function(t){var e=this;this.bomPopShow=!1,this.getBomItem(t).then(function(t){var i=t.billBom[0].details;i.forEach(function(t){var i=e.orderItemList.findIndex(function(e){return e.id===t.outHouseDTO.id});if(~i){var o=e.orderItemList[i].details.findIndex(function(e){return e.goodsDTO.id===t.goodsDTO.id});if(~o){var n=e.orderItemList[i].details[o];if("del"===n.changeType)return;"add"!==n.changeType&&e.$set(n,"changeType","edit"),n.busUnitOutAmount=t.busUnitOutAmount}else t.changeType="add",e.orderItemList[i].details.push(t)}else{var a=u()({},t.outHouseDTO);t.changeType="add",a.details=[t],e.orderItemList.push(a)}}),e.orderBomList=e.filterStoreBom(t.billBom[0].billBom)})},filterStoreBom:function(t){var e=c()(new s.a(t.map(function(t){return t.house.id}))),i=e.map(function(e){var i=t.find(function(t){return t.house.id===e}).house;return i=JSON.parse(h()(i)),i.details=t.filter(function(t){return t.house.id===e}),i});return i},getBomItem:function(t){var e=this;return new b.a(function(i){t.forEach(function(t){t.bomId=t.id,t.bomName=t.name,delete t.checked});var o=e.orderItemList.reduce(function(t,e){var i=e.details.length?t.concat(e.details):t;return i},[]),n=e.orderBomList.reduce(function(t,e){var i=e.details.length?t.concat(e.details):t;return i},[]),a={houseId:e.currentBomStoreObj.id,workDate:e.orderInfoData.businessDate,bom:t,details:o,billBom:n};e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.orderInfoData.shopDTO.id,"/users/").concat(e.loginerId,"/departmentreceivedetails"),data:a,query:{m:"departmentBillBom"}}).then(function(t){i(t)}).catch(function(t){i(t)})})},onBillTypeClick:function(){this.onBillTYpeRefresh()},searchBillType:function(t){this.onBillTYpeRefresh(t)},selectBillType:function(t){this.orderInfoData.businessTypeDTO=t,this.orderInfoData=JSON.parse(h()(this.orderInfoData))},onBillTypeClear:function(){this.orderInfoData.businessTypeDTO={}},onBillTYpeRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getBillTypeListData(e).then(function(e){t.billTypeList=e.businessTypes,t.billTypePopShow=!0})},getBillTypeListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new b.a(function(i){var o={m:"list4DepartmentReceiveBillEdit",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/businessTypes"),data:o}).then(function(t){i(t)})})},onSubjectClick:function(){this.onSubjectRefresh()},searchSubject:function(t){this.onSubjectRefresh(t)},selectSubject:function(t){this.orderInfoData.subjectDTO=t,this.orderInfoData=JSON.parse(h()(this.orderInfoData))},onSubjectClear:function(){this.orderInfoData.subjectDTO={}},onSubjectRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getSubjectListData(e).then(function(e){t.subjectList=e.subjectData,t.subjectPopShow=!0})},getSubjectListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new b.a(function(i){var o={keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/subject"),data:o}).then(function(t){i(t)})})}}},F=$,E=(i("a2f5"),i("2877")),R=Object(E["a"])(F,o,n,!1,null,"725cde30",null);e["default"]=R.exports},d840:function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-departmentReceive-details"},[i("w-header",{attrs:{title:t.orderInfoData.sysbillCode,titleFontSize:"3.733vw",border:!0}}),i("orderInfo",{ref:"orderInfo",attrs:{data:t.orderInfoData,isDisabled:t.isBillState(1)||!t.$fxAuth("departmentReceiveBill.save")||t.isWeightState(1)||t.isWeightState(2),collapseDisabled:t.itemInputFocusing},on:{"on-shop-click":t.onShopClick,"on-department-click":t.onDepartmentClick,"on-employee-click":t.onEmployeeClick,"on-employee-clear":t.onEmployeeClear,"on-busdate-click":t.onBusinessDateClick,"on-item-clear":t.onItemClear,"on-billType-click":t.onBillTypeClick,"on-billType-clear":t.onBillTypeClear,"on-subject-click":t.onSubjectClick,"on-subject-clear":t.onSubjectClear}}),i("orderItem",{ref:"orderItem",attrs:{data:t.orderItemList,isDisabled:t.isBillState(1)||!t.$fxAuth("departmentReceiveBill.save")||t.isWeightState(1)||t.isWeightState(2),itemInputFocusing:t.itemInputFocusing,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,autoType:t.orderInfoData.autoType},on:{"update:itemInputFocusing":function(e){t.itemInputFocusing=e},"update:item-input-focusing":function(e){t.itemInputFocusing=e},"on-search-click":t.onSearchClick,"on-add-click":t.onAddClick,"on-item-edit":t.onItemEdit,"on-unit-edit":t.onUnitEdit,"on-item-focus":t.onItemFocus,"on-selectbom-click":t.onSelectBomClick,"on-viewbom-click":t.onViewBomClick}}),i("div",{staticClass:"departmentReceive-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillState(0)&&t.$fxAuth("departmentReceiveBill.del")&&(t.isWeightState(0)||t.isWeightState(3)),expression:"isBillState(0) && $fxAuth('departmentReceiveBill.del') && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onDeleteClick")}}},[t._v("删除")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillState(0)&&t.$fxAuth("departmentReceiveBill.check")&&(t.isWeightState(0)||t.isWeightState(3)),expression:"isBillState(0) && $fxAuth('departmentReceiveBill.check') && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onExpressClick")}}},[t._v("审核")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillReState([0,2])&&t.isBillState(1)&&t.$fxAuth("departmentReceiveBill.unCheck")&&(t.isWeightState(0)||t.isWeightState(3)),expression:"isBillReState([0, 2]) && isBillState(1) && $fxAuth('departmentReceiveBill.unCheck') && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onUnExpressClick")}}},[t._v("反审")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillState(0)&&t.$fxAuth("departmentReceiveBill.save")&&(t.isWeightState(0)||t.isWeightState(3)),expression:"isBillState(0) && $fxAuth('departmentReceiveBill.save') && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:function(e){return t.onClickHandler("onSaveClick")}}},[t._v("保存")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillReState(0)&&t.isBillState(1)&&t.$fxAuth("departmentReceiveBill.reCheck"),expression:"isBillReState(0) && isBillState(1) && $fxAuth('departmentReceiveBill.reCheck')"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onExpressAgainClick")}}},[t._v("复审")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillReState(1)&&t.isBillState(1)&&t.$fxAuth("departmentReceiveBill.unReCheck"),expression:"isBillReState(1) && isBillState(1) && $fxAuth('departmentReceiveBill.unReCheck')"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onUnExpressAgainClick")}}},[t._v("取消复审")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("departmentReceiveBill.weighState")&&t.isBillState(0)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('departmentReceiveBill.weighState') && isBillState(0) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius yellow-btn",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onWeightClick")}}},[t._v("下发称重")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("departmentReceiveBill.weighState")&&t.isBillState(0)&&(t.isWeightState(1)||t.isWeightState(2)),expression:"$fxAuth('departmentReceiveBill.weighState') && isBillState(0) && (isWeightState(1) || isWeightState(2))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onUnWeightClick")}}},[t._v("取消称重")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("departmentReceiveBill.weighState")&&t.isBillState(0)&&t.isWeightState(2)&&t.sysDZCManyLower,expression:"$fxAuth('departmentReceiveBill.weighState') && isBillState(0) && isWeightState(2) && sysDZCManyLower"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onEndWeightClick")}}},[t._v("结束称重")])],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.billTypePopShow,callback:function(e){t.billTypePopShow=e},expression:"billTypePopShow"}},[i("listComp",{attrs:{visibleFlag:t.billTypePopShow,data:t.billTypeList,loadFinished:!0,title:"单据类型检索"},on:{"update:visibleFlag":function(e){t.billTypePopShow=e},"update:visible-flag":function(e){t.billTypePopShow=e},"on-search":t.searchBillType,"on-select":t.selectBillType}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.subjectPopShow,callback:function(e){t.subjectPopShow=e},expression:"subjectPopShow"}},[i("listComp",{attrs:{visibleFlag:t.subjectPopShow,data:t.subjectList,loadFinished:!0,title:"科目检索"},on:{"update:visibleFlag":function(e){t.subjectPopShow=e},"update:visible-flag":function(e){t.subjectPopShow=e},"on-search":t.searchSubject,"on-select":t.selectSubject}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.shopPopShow,callback:function(e){t.shopPopShow=e},expression:"shopPopShow"}},[i("listComp",{attrs:{visibleFlag:t.shopPopShow,data:t.shopList,loadFinished:t.shopListLoadFinished,loading:t.onShopLoading,title:"请选择出库机构"},on:{"update:visibleFlag":function(e){t.shopPopShow=e},"update:visible-flag":function(e){t.shopPopShow=e},"update:loading":function(e){t.onShopLoading=e},"on-search":t.searchShop,"on-select":t.selectShop,"on-load":t.onShopLoad}})],1),i("filterListPopup",{attrs:{title:"请选择部门",rollingLoad:!0,getDataApi:t.getDepartmentListData},on:{"on-select":function(e){return t.selectDepartment(arguments)}},model:{value:t.departmentPopShow,callback:function(e){t.departmentPopShow=e},expression:"departmentPopShow"}}),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.employeePopShow,callback:function(e){t.employeePopShow=e},expression:"employeePopShow"}},[i("listComp",{attrs:{visibleFlag:t.employeePopShow,data:t.employeeList,loadFinished:t.employeeListLoadFinished,loading:t.onEmployeeLoading,title:"请选择业务人"},on:{"update:visibleFlag":function(e){t.employeePopShow=e},"update:visible-flag":function(e){t.employeePopShow=e},"update:loading":function(e){t.onEmployeeLoading=e},"on-search":t.searchEmployee,"on-select":t.selectEmployee,"on-load":t.onEmployeeLoad}})],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemStorePopShow,callback:function(e){t.itemStorePopShow=e},expression:"itemStorePopShow"}},[i("storeItemComp",{attrs:{visibleFlag:t.itemStorePopShow,storeItemData:t.storeItem,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id},on:{"update:visibleFlag":function(e){t.itemStorePopShow=e},"update:visible-flag":function(e){t.itemStorePopShow=e},"on-save":t.onStoreItemSave,"on-select-store":t.onStoreItemSelect}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemPopShow,callback:function(e){t.itemPopShow=e},expression:"itemPopShow"}},[i("itemEditComp",{attrs:{visibleFlag:t.itemPopShow,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,store:t.currentStoreObj,parentStoreItem:t.getStoreItem(),businessDate:t.orderInfoData.businessDate},on:{"update:visibleFlag":function(e){t.itemPopShow=e},"update:visible-flag":function(e){t.itemPopShow=e},"on-confirm":t.onItemEditConfirm}})],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,isDisabled:t.isBillState(1)||!t.$fxAuth("departmentReceiveBill.save")||t.isWeightState(1)||t.isWeightState(2)},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemSearchPopShow,callback:function(e){t.itemSearchPopShow=e},expression:"itemSearchPopShow"}},[i("itemSearchPop",{attrs:{visibleFlag:t.itemSearchPopShow,data:t.searchItem,searchKeywords:"code,name,pinYin",isDisabled:t.isBillState(1)||!t.$fxAuth("departmentReceiveBill.save")||t.isWeightState(1)||t.isWeightState(2),autoType:t.orderInfoData.autoType},on:{"update:visibleFlag":function(e){t.itemSearchPopShow=e},"update:visible-flag":function(e){t.itemSearchPopShow=e},"on-search-confirm":t.onSearchConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.bomStorePopShow,callback:function(e){t.bomStorePopShow=e},expression:"bomStorePopShow"}},[i("storeBomComp",{attrs:{visibleFlag:t.bomStorePopShow,storeItemData:t.storeBom,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id},on:{"update:visibleFlag":function(e){t.bomStorePopShow=e},"update:visible-flag":function(e){t.bomStorePopShow=e},"on-save":t.onStoreBomSave,"on-select-store":t.onStoreBomSelect}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.bomPopShow,callback:function(e){t.bomPopShow=e},expression:"bomPopShow"}},[i("bomEditComp",{attrs:{visibleFlag:t.bomPopShow,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id},on:{"update:visibleFlag":function(e){t.bomPopShow=e},"update:visible-flag":function(e){t.bomPopShow=e},"on-bom-confirm":t.onBomConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.bomSearchPopShow,callback:function(e){t.bomSearchPopShow=e},expression:"bomSearchPopShow"}},[i("bomSearchPop",{attrs:{visibleFlag:t.bomSearchPopShow,data:t.searchBom,searchKeywords:"code,name,pinYin"},on:{"update:visibleFlag":function(e){t.bomSearchPopShow=e},"update:visible-flag":function(e){t.bomSearchPopShow=e}}})],1)],1)},n=[],a=(i("7f7f"),i("20d6"),i("5176")),s=i.n(a),r=i("768b"),c=i("75fc"),l=i("f499"),u=i.n(l),d=(i("7514"),i("b6d0")),h=i.n(d),m=i("774e"),p=i.n(m),f=(i("ac6a"),i("59ad")),v=i.n(f),S=i("795b"),b=i.n(S),g=(i("6762"),i("2fdb"),i("6b54"),i("cebc")),w=i("2f62"),I=i("ad91"),D=i("f720"),y=i("f6bb"),C=i("cfdd"),k=i("4b97"),x=i("4fa5"),L=i("779b"),P=i("bcb5"),T=i("0562"),A=i("ab2e"),O=i("eb03"),B=50,$={name:"departmentReceiveDetails",components:{orderInfo:I["a"],orderItem:D["a"],listComp:y["a"],storeItemComp:C["a"],itemRowEditPop:k["a"],itemSearchPop:x["a"],itemEditComp:L["a"],storeBomComp:P["a"],bomEditComp:T["a"],bomSearchPop:A["a"],filterListPopup:O["a"]},data:function(){return{query:this.$route.query,activeNames:["1"],tabActive:"选项1",orderInfoData:{},orderItemList:[],currentDate:new Date,shopPopShow:!1,shopList:[],shopListStart:0,searchShopKey:null,shopListLoadFinished:!1,onShopLoading:!1,departmentPopShow:!1,employeePopShow:!1,employeeList:[],employeeListStart:0,searchEmployeeKey:null,employeeListLoadFinished:!1,onEmployeeLoading:!1,datePickerShow:!1,itemStorePopShow:!1,storeItem:[],itemRowEditPopShow:!1,itemEditRowData:{},unitActions:[],unitActionShow:!1,itemInputFocusing:!1,orderDeleteFlag:!1,formatterSysPointKey:["busUnitOutAmount"],itemSearchPopShow:!1,searchItem:[],currentStoreObj:{},itemPopShow:!1,orderBomList:[],storeBom:[],bomStorePopShow:!1,currentBomStoreObj:{},bomPopShow:!1,bomSearchPopShow:!1,searchBom:[],billTypePopShow:!1,billTypeList:[],subjectList:[],subjectPopShow:!1}},created:function(){this.createOrderDetails()},beforeRouteLeave:function(t,e,i){var o=this;if(this.itemInputFocusing)return this.$router.go(1),!1;"/departmentReceive"!==t.path||this.orderDeleteFlag||0!==this.orderInfoData.billState?i():this.$dialog.confirm({title:"提示",message:"若已修改,请先保存单据<br/>是否关闭页面?"}).then(function(){i()}).catch(function(){return o.$router.go(1),!1})},computed:Object(g["a"])({},Object(w["c"])({sysPointSize:"sysPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId},loginerName:function(t){return t.loginer.loginerName},loginerOrganType:function(t){return t.loginer.loginerOrganType},sysDZCManyLower:function(t){return t.systemParams.sysDZCManyLower}}),{isBillState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.billState):e.orderInfoData.billState===t}},isBillReState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.billReState):e.orderInfoData.billReState===t}},isWeightState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.weightState):e.orderInfoData.weightState===t}}}),methods:{createOrderDetails:function(){var t=this;return new b.a(function(e){t.getOrderDetails().then(function(i){var o=i.storeBills[0];t.formatterSysPoint(o.details),t.orderInfoData=o,t.orderItemList=t.filterStoreItem(o.details),o.billBom&&o.billBom.length&&(t.orderBomList=t.filterStoreBom(o.billBom)),e()})})},getOrderDetails:function(){var t=this;return new b.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/departmentReceive/").concat(t.query.orderId)}).then(function(t){e(t)})})},formatterSysPoint:function(t){var e=this,i=function(t){return v()(e.$fxUtils.toFixedSHW(t,e.sysPointSize))};t.forEach(function(t){e.formatterSysPointKey.forEach(function(e){t[e]=i(t[e])})})},filterStoreItem:function(t){var e=this;t.forEach(function(t){var i=v()(t.busUnitOutAmount);i?(t.price=e.toFixedNumberSize(t.outMoney/i),t.taxPrice=e.toFixedNumberSize(t.outMoneyWithTax/i)):(t.price=e.toFixedNumberSize(t.price),t.taxPrice=e.toFixedNumberSize(t.taxPrice)),t.busUnitOutAmount=e.toFixedNumberSize(i),t.outMoney=e.toFixedNumberSize(t.outMoney),t.outMoneyWithTax=e.toFixedNumberSize(t.outMoneyWithTax),t.taxOutMoney=e.toFixedNumberSize(t.taxOutMoney)});var i=p()(new h.a(t.map(function(t){return t.outHouseDTO.id}))),o=i.map(function(e){var i=t.find(function(t){return t.outHouseDTO.id===e}).outHouseDTO;return i=JSON.parse(u()(i)),i.details=t.filter(function(t){return t.outHouseDTO.id===e}),i});return o},toFixedNumberSize:function(t){return v()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},clearItemConfim:function(t){var e=this;return new b.a(function(i){var o=e.orderItemList.filter(function(t){var e=t.details.filter(function(t){return"del"!==t.changeType});return 0!==e.length});0===o.length?i():e.$dialog.confirm({title:"提示",message:t}).then(function(){e.onItemClear(),i()}).catch(function(){})})},onShopClick:function(){this.shopListStart=0,this.searchShopKey=null,this.shopListLoadFinished=!1,this.onShopRefresh()},searchShop:function(t){this.shopListStart=0,this.searchShopKey=t,this.onShopRefresh()},onShopRefresh:function(){var t=this;this.getShopListData().then(function(e){t.onShopLoading=!1,t.shopList=e.shops,t.shopPopShow=!0})},onShopLoad:function(){var t=this;this.getShopListData().then(function(e){var i;t.onShopLoading=!1,(i=t.shopList).push.apply(i,Object(c["a"])(e.shops))})},getShopListData:function(){var t=this;return new b.a(function(e){var i={start:t.shopListStart,size:B,keyword:t.searchShopKey,m:"list4ShopOtherOrderBill4Edit"};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/shops"),data:i}).then(function(i){t.shopListStart+=B,i.shops.length<B?t.shopListLoadFinished=!0:t.shopListLoadFinished=!1,e(i)})})},selectShop:function(t){var e=this;this.checkShop(t).then(function(){e.clearItemConfim("更换出库机构清空明细,是否继续?").then(function(){e.orderInfoData.shopDTO=t,e.orderInfoData.employeeDTO={},e.orderInfoData.employeeDTO={id:e.loginerId,name:e.loginerName},e.getDepartmentListData(null,0,2).then(function(t){1===t.length?e.orderInfoData.departmentDTO=t[0]:e.orderInfoData.departmentDTO={}})})})},checkShop:function(t){var e=this;return new b.a(function(i){var o=e.orderInfoData.shopDTO||{};o.id!==t.id&&i()})},onDepartmentClick:function(){if(!this.orderInfoData.shopDTO.id)return this.$fxToast.fail("请先选择出库机构!"),!1;this.departmentPopShow=!0},getDepartmentListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,o={keyword:t,start:e,size:i},n={id:this.orderInfoData.shopDTO.id};return this.$fxApi("z5common.getDepartment",n)({data:o}).then(function(t){return t.departmentDTOData})},selectDepartment:function(t){var e=this,i=Object(r["a"])(t,1),o=i[0];this.checkDepartment(o).then(function(){e.clearItemConfim("更换部门清空明细,是否继续?").then(function(){e.orderInfoData.departmentDTO=o})})},checkDepartment:function(t){var e=this;return new b.a(function(i){var o=e.orderInfoData.departmentDTO||{};o.id!==t.id&&i()})},onEmployeeClick:function(){this.employeeListStart=0,this.searchEmployeeKey=null,this.employeeListLoadFinished=!1,this.onEmployeeRefresh()},searchEmployee:function(t){this.employeeListStart=0,this.searchEmployeeKey=t,this.onEmployeeRefresh()},onEmployeeRefresh:function(){var t=this;this.getEmployeeListData().then(function(e){t.onEmployeeLoading=!1,t.employeeList=e.employeeDTOData,t.employeePopShow=!0})},onEmployeeLoad:function(){var t=this;this.getEmployeeListData().then(function(e){var i;t.onEmployeeLoading=!1,(i=t.employeeList).push.apply(i,Object(c["a"])(e.employeeDTOData))})},getEmployeeListData:function(){var t=this;return new b.a(function(e){var i={start:t.employeeListStart,size:B,keyword:t.searchEmployeeKey};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/employee/report/").concat(t.orderInfoData.shopDTO.id),data:i}).then(function(i){t.employeeListStart+=B,i.employeeDTOData.length<B?t.employeeListLoadFinished=!0:t.employeeListLoadFinished=!1,e(i)})})},selectEmployee:function(t){this.orderInfoData.employeeDTO=t},onEmployeeClear:function(){this.orderInfoData.employeeDTO={}},onBusinessDateClick:function(){this.orderInfoData.businessDate&&(this.currentDate=new Date(this.orderInfoData.businessDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){var e=t.getTime();this.orderInfoData.businessDate=e,this.datePickerShow=!1},onUnitEdit:function(t){var e=this;this.itemEditRowData=t,this.getItemUnit(t.goodsDTO.id).then(function(t){e.unitActions=t,e.unitActionShow=!0})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemEditRowData,i=e.unitDTO.value,o=t,n=v()(e.storeAmount);n>0&&(n=n*i/o.value,e.storeAmount=v()(this.$fxUtils.toFixedSHW(n,this.sysPointSize))),0===e.busUnitOutAmount?(e.price=v()(this.$fxUtils.toFixedSHW(e.price*o.value/i,this.sysPointSize)),e.taxPrice=v()(this.$fxUtils.toFixedSHW(e.taxPrice*o.value/i,this.sysPointSize))):(e.price=v()(this.$fxUtils.toFixedSHW(e.outMoney/e.busUnitOutAmount,this.sysPointSize)),e.taxPrice=v()(this.$fxUtils.toFixedSHW(e.outMoneyWithTax/e.busUnitOutAmount,this.sysPointSize))),e.unitDTO=t},getItemUnit:function(t){var e=this;return new b.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/users/").concat(e.loginerId,"/goods/").concat(t,"/units")}).then(function(t){i(t.units)})})},onAddClick:function(){var t=this;this.checkOrderInfo().then(function(){t.storeItem=JSON.parse(u()(t.orderItemList)),t.itemStorePopShow=!0})},checkOrderInfo:function(){var t=this;return new b.a(function(e,i){t.orderInfoData.businessDate?t.orderInfoData.shopDTO.id?t.orderInfoData.departmentDTO.id?!t.$fxSysAuth("departmentReceiveBill.viewSubject")||t.orderInfoData.subjectDTO&&t.orderInfoData.subjectDTO.id?!t.$fxSysAuth("departmentReceiveBill.viewSubject")||t.orderInfoData.businessTypeDTO&&t.orderInfoData.businessTypeDTO.id?e():t.$fxToast.top("请先选择单据类型!"):t.$fxToast.top("请先选择科目!"):t.$fxToast.top("请先选择部门!"):t.$fxToast.top("请先选择出库机构!"):t.$fxToast.top("请先选择业务日期!")})},onStoreItemSave:function(t){this.orderItemList=t},onSaveClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要保存该单据吗?"}).then(function(){t.checkOrderInfo().then(t.checkHasDetails).then(function(){var e=t.getSaveParams();t.saveHandler(e)})}).catch(function(){})},saveHandler:function(t){var e=this;this.$fxHttp.requestPut({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/departmentReceive/").concat(this.query.orderId),data:t,query:{userId:this.loginerId,m:"modify"}}).then(function(t){e.createOrderDetails().then(function(){e.$fxToast.success(t.message)})})},onExpressClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要审核该单据吗?"}).then(function(){t.checkOrderInfo().then(t.checkHasDetails).then(function(){var e=t.getSaveParams();t.expressHandler(e)})}).catch(function(){})},expressHandler:function(t){var e=this;this.$fxHttp.requestPut({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/departmentReceive/").concat(this.query.orderId,"/users/").concat(this.loginerId),data:t,query:{m:"editAndCheck"}}).then(function(t){e.createOrderDetails().then(function(){e.$fxToast.success("审核成功")})}).catch(function(t){"1"===t.errorCode&&e.createOrderDetails()})},onUnExpressClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要反审该单据吗?"}).then(function(){t.checkHasDetails().then(function(){var e=t.getSaveParams();t.unExpressHandler(e)})}).catch(function(){})},unExpressHandler:function(t){var e=this;this.$fxHttp.requestPut({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/departmentReceive/").concat(this.query.orderId),data:t,query:{userId:this.loginerId,m:"unCheck"}}).then(function(t){e.createOrderDetails().then(function(){e.$fxToast.success("反审成功")})})},onDeleteClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要删除该单据吗?"}).then(function(){var e=t.getSaveParams();t.$fxHttp.requestDel({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/departmentReceive/").concat(t.query.orderId),data:e,query:{userId:t.loginerId}}).then(function(e){t.$fxToast.success({message:"删除成功",mask:!0}).then(function(){t.orderDeleteFlag=!0,t.$router.go(-1)})})}).catch(function(){})},onExpressAgainClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要复审该单据吗?"}).then(function(){var e=t.getSaveParams();t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/departmentReceive/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:e,query:{m:"reCheck"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("复审成功")})})}).catch(function(){})},onUnExpressAgainClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要取消复审该单据吗?"}).then(function(){var e=t.getSaveParams();t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/departmentReceive/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:e,query:{userId:t.loginerId,m:"unReCheck"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("取消复审成功")})})}).catch(function(){})},onWeightClick:function(){var t=this;this.checkOrderInfo().then(this.checkHasDetails).then(function(){t.$dialog.confirm({title:"提示",message:"确定要下发称重吗?"}).then(function(){var e=t.getSaveParams();if(!e)return!1;t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/departmentReceive/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:e,query:{userId:t.loginerId,m:"weighBill"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("下发称重成功")})})}).catch(function(){})})},onUnWeightClick:function(){var t=this;this.checkHasDetails().then(function(){var e="确定要取消称重吗?";2===t.orderInfoData.weighState&&(e="称重中的单据，取消称重后电子秤可以继续称重并传回数据！确定要取消称重吗"),t.$dialog.confirm({title:"提示",message:e}).then(function(){t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/departmentReceive/").concat(t.query.orderId,"/users/").concat(t.loginerId),query:{userId:t.loginerId,m:"unWeighBill"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("取消称重成功")})})}).catch(function(){})})},onEndWeightClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"结束称重后将不再接收此单据的称重数据"}).then(function(){t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/departmentReceive/").concat(t.query.orderId,"/users/").concat(t.loginerId),query:{userId:t.loginerId,m:"endWeighBill"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("结束称重成功")})})}).catch(function(){})},getSaveParams:function(){var t=[],e=[];this.orderItemList.forEach(function(e){t.push.apply(t,Object(c["a"])(e.details))});var i=t.filter(function(t){return"add"===t.changeType}),o=t.filter(function(t){return"del"===t.changeType}),n=t.filter(function(t){return"edit"===t.changeType});this.orderBomList.forEach(function(t){e.push.apply(e,Object(c["a"])(t.details))});var a=s()({},this.orderInfoData,{detailAdd:i.length>0?i:null,detailDel:o.length>0?o:null,detailMdf:n.length>0?n:null,billBom:e,details:[]});return a},getValidItem:function(){var t=[];return this.orderItemList.forEach(function(e){t.push.apply(t,Object(c["a"])(e.details))}),t.filter(function(t){return"del"!==t.changeType})},getItemLength:function(){return this.getValidItem().length},checkHasDetails:function(){var t=this;return new b.a(function(e){0===t.getItemLength()?t.$fxToast.fail("单据明细不能为空"):e()})},onItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this.orderItemList.findIndex(function(e){return e.id===t.outHouseDTO.id});if(~e){var i=this.orderItemList[e].details.findIndex(function(e){return e.goodsDTO.id===t.goodsDTO.id});~i&&(this.orderItemList[e].details[i]=t)}},onItemClear:function(){var t=this.orderInfoData.details.filter(function(t){return!!t.id});t.forEach(function(t){t.changeType="del"}),this.orderInfoData.details=t,this.orderItemList=this.filterStoreItem(t)},onItemFocus:function(){this.$refs.orderInfo.closeCollapse()},onClickHandler:function(t){if(this.itemInputFocusing)return!1;this[t]()},onSearchClick:function(){this.itemSearchPopShow=!0,this.searchItem=JSON.parse(u()(this.orderItemList))},onSearchConfirm:function(t){this.orderItemList=t},onStoreItemSelect:function(t){this.currentStoreObj=t,this.itemPopShow=!0},getStoreItem:function(){var t=this;if(this.$fxUtils.isEmptyObjSHW(this.currentStoreObj))return[];var e=this.orderItemList.find(function(e){return e.id===t.currentStoreObj.id});return e?e.details:[]},onItemEditConfirm:function(t){var e=Object(r["a"])(t,2),i=e[0],o=e[1],n=this.orderItemList.find(function(t){return t.id===o.id});if(n)n.details=i;else{var a=s()({},o);a.details=i,this.orderItemList.push(a)}},onSelectBomClick:function(){var t=this;this.checkOrderInfo().then(function(){t.storeBom=JSON.parse(u()(t.orderBomList)),t.bomStorePopShow=!0})},onStoreBomSelect:function(t){this.currentBomStoreObj=t,this.bomPopShow=!0},onStoreBomSave:function(t){this.orderBomList=t},onViewBomClick:function(){this.orderBomList.length?(this.searchBom=JSON.parse(u()(this.orderBomList)),this.bomSearchPopShow=!0):this.$fxToast.top("没有已导入的BOM数据！")},onBomConfirm:function(t){var e=this;this.bomPopShow=!1,this.getBomItem(t).then(function(t){var i=t.billBom[0].details;i.forEach(function(t){var i=e.orderItemList.findIndex(function(e){return e.id===t.outHouseDTO.id});if(~i){var o=e.orderItemList[i].details.findIndex(function(e){return e.goodsDTO.id===t.goodsDTO.id});if(~o){var n=e.orderItemList[i].details[o];"add"!==n.changeType&&t.busUnitOutAmount&&e.$set(n,"changeType","edit"),n.busUnitOutAmount=t.busUnitOutAmount}else t.changeType="add",e.orderItemList[i].details.push(t)}else{var a=s()({},t.outHouseDTO);t.changeType="add",a.details=[t],e.orderItemList.push(a)}}),e.orderBomList=e.filterStoreBom(t.billBom[0].billBom)})},filterStoreBom:function(t){var e=p()(new h.a(t.map(function(t){return t.house.id}))),i=e.map(function(e){var i=t.find(function(t){return t.house.id===e}).house;return i=JSON.parse(u()(i)),i.details=t.filter(function(t){return t.house.id===e}),i});return i},getBomItem:function(t){var e=this;return new b.a(function(i){t.forEach(function(t){t.bomId=t.id,t.bomName=t.name,delete t.checked});var o=e.orderItemList.reduce(function(t,e){var i=e.details.length?t.concat(e.details):t;return i},[]),n=e.orderBomList.reduce(function(t,e){var i=e.details.length?t.concat(e.details):t;return i},[]),a={houseId:e.currentBomStoreObj.id,workDate:e.orderInfoData.businessDate,bom:t,details:o,billBom:n};e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.orderInfoData.shopDTO.id,"/users/").concat(e.loginerId,"/departmentreceivedetails"),data:a,query:{m:"departmentBillBom"}}).then(function(t){i(t)}).catch(function(t){i(t)})})},onBillTypeClick:function(){this.onBillTYpeRefresh()},searchBillType:function(t){this.onBillTYpeRefresh(t)},selectBillType:function(t){this.orderInfoData.businessTypeDTO=t},onBillTypeClear:function(){this.orderInfoData.businessTypeDTO={}},onBillTYpeRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getBillTypeListData(e).then(function(e){t.billTypeList=e.businessTypes,t.billTypePopShow=!0})},getBillTypeListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new b.a(function(i){var o={m:"list4DepartmentReceiveBillEdit",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/businessTypes"),data:o}).then(function(t){i(t)})})},onSubjectClick:function(){this.onSubjectRefresh()},searchSubject:function(t){this.onSubjectRefresh(t)},selectSubject:function(t){this.orderInfoData.subjectDTO=t},onSubjectClear:function(){this.orderInfoData.subjectDTO={}},onSubjectRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getSubjectListData(e).then(function(e){t.subjectList=e.subjectData,t.subjectPopShow=!0})},getSubjectListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new b.a(function(i){var o={keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/subject"),data:o}).then(function(t){i(t)})})}}},F=$,E=(i("ced9"),i("2877")),R=Object(E["a"])(F,o,n,!1,null,"214d5f9b",null);e["default"]=R.exports},d8e9:function(t,e,i){"use strict";var o=i("532e"),n=i.n(o);n.a},db75:function(t,e,i){"use strict";var o=i("ffca"),n=i.n(o);n.a},de18:function(t,e,i){},e40b:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-info-cell"},[i("div",{staticClass:"item-img"},[i("img",{attrs:{src:t.comptedItemImgSrc(t.itemData.goodsDTO.imageUrls),onerror:t.$fxCommon.errorImg("item")}})]),i("div",{staticClass:"item-details"},[i("div",{staticClass:"item-name fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.name))]),i("div",{staticClass:"details-cell"},[i("div",{staticClass:"item-taxprice fx-ellipsis"},[i("span",[t._v("非税金额：￥")]),i("span",[t._v(t._s(t.itemData.outMoney))])]),i("div",{staticClass:"item-spec fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.spec))])]),i("div",{staticClass:"details-cell"},[t.isDisabled||t.itemData.isWeightSign&&!t.sysDZCCanModifyAcount||!t.$fxAuth("departmentReceiveBill.editAmount")?i("div",{staticClass:"item-amount"},[i("span",[t._v(t._s(t.itemData.busUnitOutAmount))]),i("span",{staticClass:"fx-ellipsis"},[t._v(t._s(t.itemData.unitDTO.name))])]):i("div",{staticClass:"item-amount-edit"},[i("w-stepper",{ref:"amountInput",staticClass:"amount-step",attrs:{min:"0",max:t.maxAmount,stepperBtnShow:!1,intLength:t.numberLength,pointSize:t.sysPointSize},on:{change:t.onChange,focus:t.onFocus,blur:t.onBlur},model:{value:t.itemData.busUnitOutAmount,callback:function(e){t.$set(t.itemData,"busUnitOutAmount",e)},expression:"itemData.busUnitOutAmount"}}),i("div",{staticClass:"unit-text"},[i("span",{staticClass:"fx-ellipsis cell-unit",on:{click:function(e){return e.stopPropagation(),t.onUnitClick(e)}}},[t._v(t._s(t.itemData.unitDTO.name))]),i("van-icon",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&t.isAutoType([1]),expression:"!isDisabled && isAutoType([1])"}],staticClass:"unit-icon",attrs:{name:"arrow-down"}})],1)],1)])]),i("i",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&!t.disabledEditBtn,expression:"!isDisabled && !disabledEditBtn"}],staticClass:"block-item-edit",on:{click:t.onItemEditClick}}),i("i",{directives:[{name:"show",rawName:"v-show",value:t.isDisabled&&!t.disabledWatchBtn,expression:"isDisabled && !disabledWatchBtn"}],staticClass:"block-item-watch",on:{click:t.onItemEditClick}})])},n=[],a=i("795b"),s=i.n(a),r=i("59ad"),c=i.n(r),l=(i("6762"),i("2fdb"),i("6b54"),i("cebc")),u=(i("c5f6"),i("2f62")),d={name:"itemInfoCell",props:{itemData:{type:Object,default:function(){return{}}},isDisabled:Boolean,disabledEditBtn:Boolean,disabledWatchBtn:Boolean,autoType:{type:Number,default:1}},computed:Object(l["a"])({},Object(u["c"])({sysDZCCanModifyAcount:function(t){return t.systemParams.sysDZCCanModifyAcount},sysPointSize:"sysPointSize",numberLength:"numberLength",maxAmount:"maxAmount"}),{comptedItemImgSrc:function(t){return function(t){return t?0===t.length?"":t[0]:""}},isAutoType:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.autoType):e.autoType===t}}}),data:function(){return{isHasGoods:!1}},methods:{onChange:function(t){this.amountChange(t)},editItem:function(){this.itemData.id&&this.$set(this.itemData,"changeType","edit")},amountChange:function(t){this.editItem(),this.calcMoney("amount",t,this.itemData)},calcMoney:function(t,e,i){var o=i.busUnitOutAmount,n=i.price,a=i.taxPrice,s=i.tax,r=0,c=0,l=0,u=0,d=this.toFixedNumberSize(e);if(i.giftFlag||"money"===t&&0===d)return i.outMoney=0,!0;"money"===t?(r=d,l=this.toFixedNumberSize(r/o),c=r*(1+s),u=this.toFixedNumberSize(c/o)):"amount"===t?(""!==e&&(i.busUnitOutAmount=d),l=n,u=a,r=this.toFixedNumberSize(n*d),c=this.toFixedNumberSize(a*d)):"moneyWithTax"===t?(c=d,u=this.toFixedNumberSize(c/o),r=this.toFixedNumberSize(c/(1+s)),l=this.toFixedNumberSize(r/o)):"taxPrice"===t?(u=d,c=this.toFixedNumberSize(o*u),l=this.toFixedNumberSize(u/(1+s)),r=this.toFixedNumberSize(l*o)):"price"===t&&(l=d,r=this.toFixedNumberSize(l*o),u=this.toFixedNumberSize(l*(1+s)),c=this.toFixedNumberSize(o*u)),i.outMoneyWithTax=c,i.outMoney=r,i.price=l},toFixedNumberSize:function(t){return c()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},onItemEditClick:function(){this.editItem(),this.$emit("on-item-edit",this.itemData)},onUnitClick:function(){var t=this;if(this.isDisabled||5===this.autoType)return!1;this.onCheckAmount().then(function(){t.editItem(),t.$emit("on-unit-edit",t.itemData)})},onFocus:function(){this.$emit("on-item-focus")},onBlur:function(){var t=this;this.onCheckAmount().then(function(){t.$emit("on-item-blur")}).catch(function(){t.$refs.amountInput.setFocus(),t.$emit("on-item-focus")})},onCheckAmount:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new s.a(function(i,o){var n=t.itemData.busUnitOutAmount,a="数量不符合规则";0===n?t.$nextTick(function(){e&&t.$fxNotify.fail("数量不能为0!"),o(a)}):i()})}}},h=d,m=(i("d8e9"),i("2877")),p=Object(m["a"])(h,o,n,!1,null,"97ae4c84",null);e["a"]=p.exports},e67d:function(t,e,i){"use strict";var o=i("9687"),n=i.n(o);n.a},e876:function(t,e,i){"use strict";var o=i("b0b1"),n=i.n(o);n.a},f5b2:function(t,e,i){"use strict";var o=i("489c"),n=i.n(o);n.a},f720:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-item-block fx-shadow-block"},[i("div",{staticClass:"item-title"},[i("span",{staticClass:"title-name"},[t._v("单据明细")]),i("span",{staticClass:"title-count"},[t._v("明细：")]),i("span",[t._v(t._s(t.detailsLength))]),i("i",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&t.isAutoType([1])&&t.$fxAuth("departmentReceiveBill.departmentBOM")&&t.$fxAuth("departmentReceiveBill.editAmount"),expression:"!isDisabled && isAutoType([1]) && $fxAuth('departmentReceiveBill.departmentBOM') && $fxAuth('departmentReceiveBill.editAmount')"}],staticClass:"title-selectbom-icon title-icon fl-r",on:{click:t.onSelectBomClick}}),i("i",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("departmentReceiveBill.departmentBOM")&&t.isAutoType([1]),expression:"$fxAuth('departmentReceiveBill.departmentBOM') && isAutoType([1])"}],staticClass:"title-viewbom-icon title-icon fl-r",on:{click:t.onViewBomClick}}),i("i",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&t.isAutoType([1])&&t.$fxAuth("departmentReceiveBill.editAmount"),expression:"!isDisabled && isAutoType([1]) && $fxAuth('departmentReceiveBill.editAmount')"}],staticClass:"title-add-icon title-icon fl-r",on:{click:t.onAddClick}})]),i("div",{ref:"details-content",staticClass:"item-list"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeStoreNames,callback:function(e){t.activeStoreNames=e},expression:"activeStoreNames"}},t._l(t.data,function(e){return i("van-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.storeShowComputed(e),expression:"storeShowComputed(storeItem)"}],key:e.id,staticClass:"store-row",attrs:{name:e.id}},[i("div",{staticClass:"item-store-title fx-ellipsis",attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),t._l(e.details,function(o,n){return i("van-swipe-cell",{directives:[{name:"show",rawName:"v-show",value:"del"!==o.changeType,expression:"item.changeType !== 'del'"}],key:e.id+"-"+o.goodsDTO.id+"-"+o.goodsUUid,ref:"details-row-"+e.id+"-"+o.goodsDTO.id,refInFor:!0,staticClass:"item-row",attrs:{"right-width":80,disabled:t.isDisabled||t.focusing}},[i("itemInfoCell",t._g(t._b({attrs:{itemData:o,isDisabled:t.isDisabled,disabledEditBtn:t.focusing,autoType:t.autoType},on:{"on-item-focus":function(i){return t.onItemFocus(arguments,e.id+"-"+o.goodsDTO.id)},"on-item-blur":t.onItemBlur}},"itemInfoCell",t.$attrs,!1),t.$listeners)),i("div",{staticClass:"item-row-delete",attrs:{slot:"right"},on:{click:function(i){return t.onDeleteClick(o,n,e.details)}},slot:"right"},[t._v("删除")])],1)})],2)}),1)],1)])},n=[],a=(i("ac6a"),i("6762"),i("2fdb"),i("6b54"),i("c5f6"),i("e40b")),s={name:"orderItem",components:{itemInfoCell:a["a"]},props:{data:{type:Array,default:function(){return[]}},isDisabled:Boolean,itemInputFocusing:Boolean,autoType:{type:Number,default:1}},inheritAttrs:!1,data:function(){return{focusing:!1,activeStoreNames:[]}},computed:{storeShowComputed:function(t){return function(t){var e=t.details.filter(function(t){return"del"!==t.changeType}).length;return e>0}},detailsLength:function(t){return this.data.reduce(function(t,e){var i=e.details.filter(function(t){return"del"!==t.changeType});return t+i.length},0)},isAutoType:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.autoType):e.autoType===t}}},watch:{focusing:function(t){this.$emit("update:itemInputFocusing",t)},data:function(){var t=this;this.setDetailGoodsUUid(this.data),this.data.forEach(function(e){var i=e.details.filter(function(t){return"del"!==t.changeType}).length;i>0&&t.activeStoreNames.push(e.id)})}},methods:{setDetailGoodsUUid:function(t){var e=this;t.forEach(function(t){t.details.forEach(function(t){t.goodsUUid=e.$fxUtils.createUUID()})})},onAddClick:function(){if(this.isDisabled||this.focusing)return!1;this.$emit("on-add-click")},onSearchClick:function(){if(this.focusing)return!1;this.$emit("on-search-click")},onDeleteClick:function(t,e,i){t.id?(this.$set(t,"changeType","del"),this.$set(t,"busUnitOutAmount",0)):i.splice(e,1)},onItemFocus:function(t,e){this.focusing=!0},onItemBlur:function(){this.focusing=!1},onSelectBomClick:function(){if(this.isDisabled||this.focusing)return!1;this.$emit("on-selectbom-click")},onViewBomClick:function(){if(this.focusing)return!1;this.$emit("on-viewbom-click")}}},r=s,c=(i("85ec"),i("2877")),l=Object(c["a"])(r,o,n,!1,null,"28b3f96f",null);e["a"]=l.exports},fef9:function(t,e,i){},ffca:function(t,e,i){}}]);
//# sourceMappingURL=departmentReceive.d11058cf.js.map