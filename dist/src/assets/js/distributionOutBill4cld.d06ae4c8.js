(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["distributionOutBill4cld"],{"01f7":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"details-content",staticClass:"item-details-content"},[i("van-list",{attrs:{finished:t.loadFinished,"finished-text":"没有更多了",error:t.listError,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.listError=e},load:t.onLoadMore},model:{value:t.currentListLoading,callback:function(e){t.currentListLoading=e},expression:"currentListLoading"}},t._l(t.itemList,function(e,o){return i("div",{key:e.goodsDTO.id,ref:"details-row-"+o,refInFor:!0,staticClass:"item-detail"},[t._t("item-cell",null,{$item:e,$index:o})],2)}),0)],1)},s=[],n=i("795b"),a=i.n(n),r=(i("c5f6"),{name:"addItemList",props:{value:[String,Number],itemList:{type:Array,default:function(){return[]}},listLoading:Boolean,loadFinished:Boolean,listError:{type:Boolean,default:!1}},data:function(){return{currentListLoading:!1}},watch:{listLoading:{handler:function(t){this.currentListLoading=t},immediate:!0},currentListLoading:function(t){this.$emit("update:listLoading",t)}},computed:{comptedItemImgSrc:function(t){return function(t){return 0===t.length?"":t[0]}}},methods:{onLoadMore:function(){this.$emit("on-load-more")},onSelectLetter:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40,i=this.$refs["details-row-".concat(t)];if(!i||0===i.length)return!1;var o=i[0].offsetTop,s=this.$refs["details-content"];this.$fxUtils.scrollTopW({offsetTop:o,$el:s,distance:e})},prev:function(t){var e=this;return new a.a(function(i){if(0===t)return!1;var o=t-1,s=e.itemList[o];e.onSelectLetter(o),i({data:s,index:o})})},next:function(t){var e=this;return new a.a(function(i){if(t===e.itemList.length-1)return!1;var o=t+1,s=e.itemList[o];e.onSelectLetter(o),i({data:s,index:o})})}}}),c=r,l=(i("2f8b"),i("2877")),u=Object(l["a"])(c,o,s,!1,null,"7690e6e7",null);e["a"]=u.exports},"0321":function(t,e,i){"use strict";var o=i("566b"),s=i.n(o);s.a},"033b":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-info-cell"},[i("div",{staticClass:"item-img"},[i("w-img",{attrs:{src:t.itemData.goodsDTO.imageUrls}})],1),i("div",{staticClass:"item-details"},[i("div",{staticClass:"item-details-cell"},[i("div",{staticClass:"item-name fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.name))]),i("w-icon",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&!t.disabledEditBtn,expression:"!isDisabled && !disabledEditBtn"}],staticClass:"block-item-edit",attrs:{type:"item-edit"},on:{click:t.onItemEditClick}}),i("w-icon",{directives:[{name:"show",rawName:"v-show",value:t.isDisabled&&t.showEditBtn,expression:"isDisabled && showEditBtn"}],staticClass:"block-item-edit",attrs:{type:"item-info"},on:{click:t.onItemEditClick}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.itemData.goodsDTO.spec,expression:"itemData.goodsDTO.spec"}],staticClass:"item-details-cell"},[i("span",[t._v("规格：")]),i("div",{staticClass:"item-spec fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.spec))])]),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"item-details-cell"},[i("div",{staticClass:"item-amount"},[i("span",[t._v("数量：")]),i("w-stepper",{attrs:{min:"0",max:t.maxAmount,stepperBtnShow:!1,intLength:t.numberLength,pointSize:t.sysPointSize,inputWidth:"26vw"},on:{change:t.onChange,focus:t.onFocus,blur:t.onBlur},model:{value:t.itemData.busUnitOutAmount,callback:function(e){t.$set(t.itemData,"busUnitOutAmount",e)},expression:"itemData.busUnitOutAmount"}})],1),i("div",{staticClass:"unit-text",on:{click:function(e){return e.stopPropagation(),t.onUnitClick(e)}}},[i("span",{staticClass:"fx-ellipsis"},[t._v(t._s(t.itemData.unitDTO.name))]),i("van-icon",{attrs:{name:"arrow-down"}})],1)]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isDisabled,expression:"isDisabled"}],staticClass:"item-details-cell"},[i("div",{staticClass:"item-amount"},[i("span",[t._v("数量：")]),i("span",[t._v(t._s(t.itemData.busUnitOutAmount))])]),i("div",{staticClass:"unit-text"},[i("span",{staticClass:"fx-ellipsis"},[t._v(t._s(t.itemData.unitDTO.name))])])]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.itemData.assistUnit,expression:"itemData.assistUnit"}],staticClass:"item-details-cell"},[i("div",{staticClass:"item-amount"},[i("span",[t._v("辅助数量：")]),i("w-stepper",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],attrs:{min:"0",max:t.maxAmount,stepperBtnShow:!1,intLength:t.numberLength,pointSize:t.sysPointSize,inputWidth:"26vw"},on:{change:t.onChange,focus:t.onFocus,blur:t.onBlur},model:{value:t.itemData.outAssistAmount,callback:function(e){t.$set(t.itemData,"outAssistAmount",e)},expression:"itemData.outAssistAmount"}}),i("span",{directives:[{name:"show",rawName:"v-show",value:t.isDisabled,expression:"isDisabled"}]},[t._v(t._s(t.itemData.outAssistAmount))])],1),i("div",{staticClass:"unit-text"},[i("span",{staticClass:"fx-ellipsis"},[t._v(t._s(t.itemData.assistUnit))])])])])])},s=[],n=i("cebc"),a=i("2f62"),r={name:"itemInfoCell",props:{itemData:{type:Object,default:function(){return{}}},isDisabled:Boolean,disabledEditBtn:Boolean,showEditBtn:{type:Boolean,default:function(){return!0}}},computed:Object(n["a"])({},Object(a["c"])({sysPointSize:"sysPointSize",sysMoneyPointSize:"sysMoneyPointSize",numberLength:"numberLength",maxAmount:"maxAmount"})),data:function(){return{isHasGoods:!1}},methods:{onChange:function(t){this.amountChange(t)},editItem:function(){this.itemData.id&&this.$set(this.itemData,"changeType","edit")},amountChange:function(t){this.editItem()},onItemEditClick:function(){this.editItem(),this.$emit("on-item-edit",this.itemData)},onUnitClick:function(){if(this.isDisabled)return!1;this.editItem(),this.$emit("on-unit-edit",this.itemData)},onFocus:function(){this.$emit("on-item-focus")},onBlur:function(){0===this.itemData.busUnitOutAmount&&(this.$fxToast.fail("数量不能为0!"),this.itemData.busUnitOutAmount=1),this.itemData.goodsDTO.assistUnitFlag&&0===this.itemData.outAssistAmount&&(this.$fxToast.fail("辅助数量不能为0!"),this.itemData.outAssistAmount=1),this.$fxCalculation("distributionOutBill4cld").changeAmount(this.itemData),this.$emit("on-item-blur")}}},c=r,l=(i("83c5"),i("2877")),u=Object(l["a"])(c,o,s,!1,null,"6c1f9a05",null);e["a"]=u.exports},"08d9":function(t,e,i){},"0f38":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("van-checkbox",{directives:[{name:"show",rawName:"v-show",value:t.visibleFlag,expression:"visibleFlag"}],staticClass:"order-checkbox",on:{click:t.onCheckboxClick},scopedSlots:t._u([{key:"icon",fn:function(e){return i("img",{staticClass:"checked-box-icon",attrs:{src:e.checked?t.checkedIcon.active:t.checkedIcon.normal}})}}]),model:{value:t.$attrs.checked,callback:function(e){t.$set(t.$attrs,"checked",e)},expression:"$attrs.checked"}})},s=[],n={name:"checkBox",props:{visibleFlag:{type:Boolean,default:!1}},data:function(){return{checkedIcon:{normal:i("41c0"),active:i("f3c0")}}},methods:{onCheckboxClick:function(){this.$emit("on-checkbox-click")}}},a=n,r=(i("dab9"),i("2877")),c=Object(r["a"])(a,o,s,!1,null,"4e0c8b3e",null);e["a"]=c.exports},"251d":function(t,e,i){},"2f8b":function(t,e,i){"use strict";var o=i("8c37"),s=i.n(o);s.a},"3d0c":function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("w-app-page",[i("fx-order-list-header",{attrs:{title:"中心统配出库单",showCheckBtn:t.$fxAuth("distributionOutBill4cld.check"),checkBtnActive:t.orderEditFlag,showSearchBtn:!t.orderEditFlag,showSelectAllBtn:t.orderEditFlag,selectAllBtnActive:t.isSelectAll},on:{"on-check-click":t.onOrderEditClick,"on-search-click":t.onSearchClick,"on-selectAll-click":t.onSelectAllClick}}),i("fx-filter-tab",{attrs:{leftTabState:t.filterStateAndRestate,rightTabState:t.filterSortingState,leftTabType:"checkAndRecheckStateCld",rightTabType:"sortingStateCld"},on:{"on-left-tab-select":t.onStateSelect,"on-right-tab-select":t.onSortingSelect}}),i("fx-order-list-container",{attrs:{data:t.orderList,loadFinished:t.loadFinished},on:{"on-refresh":t.onPullRefresh,"on-loadMore":t.onLoadMore},model:{value:t.pullRefreshLoading,callback:function(e){t.pullRefreshLoading=e},expression:"pullRefreshLoading"}},t._l(t.orderList,function(e){return i("orderBlock",{directives:[{name:"show",rawName:"v-show",value:t.computedShowOrder(e.billStateFlag),expression:"computedShowOrder(item.billStateFlag)"}],key:e.id,attrs:{data:e,showCheckBox:t.orderEditFlag},on:{"on-click":function(i){return t.onClickOrder(e)}}})}),1),i("w-bottom-btn-bar",[i("w-button",{directives:[{name:"show",rawName:"v-show",value:!t.orderEditFlag&&t.$fxAuth("distributionOutBill4cld.add"),expression:"!orderEditFlag && $fxAuth('distributionOutBill4cld.add')"}],attrs:{size:"large",type:"primary"},on:{click:t.onCreateClick}},[t._v("添加单据\n\t\t")]),i("w-button",{directives:[{name:"show",rawName:"v-show",value:t.orderEditFlag&&t.$fxAuth("distributionOutBill4cld.check"),expression:"orderEditFlag && $fxAuth('distributionOutBill4cld.check')"}],attrs:{size:"large",type:"primary"},on:{click:t.onExpressClick}},[t._v("批量审核")]),i("w-button",{directives:[{name:"show",rawName:"v-show",value:t.orderEditFlag&&t.$fxAuth("distributionOutBill4cld.sorting"),expression:"orderEditFlag && $fxAuth('distributionOutBill4cld.sorting')"}],attrs:{size:"large",type:"info"},on:{click:t.onSortingClick}},[t._v("批量分拣")])],1),i("van-popup",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.filterPopShow,expression:"filterPopShow"}],staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.filterPopShow,callback:function(e){t.filterPopShow=e},expression:"filterPopShow"}},[i("filterPop",{attrs:{visibleFlag:t.filterPopShow,filterParams:t.filterParams},on:{"update:visibleFlag":function(e){t.filterPopShow=e},"update:visible-flag":function(e){t.filterPopShow=e},"update:filterParams":function(e){t.filterParams=e},"update:filter-params":function(e){t.filterParams=e},"on-confirm":t.onFilterConfirm}})],1),i("w-action-sheet",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.checkActionSheetShow,expression:"checkActionSheetShow"}],ref:"checkActionSheet",attrs:{actions:t.checkActions},model:{value:t.checkActionSheetShow,callback:function(e){t.checkActionSheetShow=e},expression:"checkActionSheetShow"}}),i("w-action-sheet",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.sortingActionSheetShow,expression:"sortingActionSheetShow"}],ref:"sortingActionSheet",attrs:{actions:t.sortingCheckActions},model:{value:t.sortingActionSheetShow,callback:function(e){t.sortingActionSheetShow=e},expression:"sortingActionSheetShow"}})],1)},s=[],n=i("75fc"),a=i("5176"),r=i.n(a),c=i("795b"),l=i.n(c),u=i("cebc"),d=(i("6762"),i("2f62")),h=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-block fx-shadow-block",on:{click:t.onClick}},[i("checkBox",{staticClass:"order-checkbox",attrs:{visibleFlag:t.showCheckBox,checked:t.data.checked},on:{"on-checkbox-click":t.onClick}}),i("div",{staticClass:"block-content"},[i("div",{staticClass:"block-title"},[i("i",{staticClass:"block-icon"}),i("span",{staticClass:"title-text"},[t._v(t._s(t.data.rdcDTO.name))]),i("fx-state-tag",{staticClass:"state-tag",attrs:{type:"stateCld",billState:t.data.billStateFlag,reCheckState:t.data.billReState}}),i("fx-state-tag",{staticClass:"sorting-state-tag",attrs:{type:"sortingStateCld",sortingState:t.data.sortingState}})],1),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No"},[t._v(t._s(t.data.sysbillCode))])]),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No"},[t._v(t._s(t.data.inShopDTO.name))]),i("div",{staticClass:"order-date fx-price-font"},[i("span",[t._v("含税配送金额：")]),i("span",[t._v("￥"+t._s(t.toFixedNumberSize(t.data.sumOutMoneyWithTax)))])])]),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No"},[i("span",[t._v("明细数：")]),i("span",[t._v(t._s(t.data.detailCount))])]),i("div",{staticClass:"order-date"},[i("span",[t._v("业务日期：")]),i("span",[t._v(t._s(t._f("filterDateYMD")(t.data.businessDate)))])])])])],1)},f=[],p=i("59ad"),m=i.n(p),b=i("0f38"),v={name:"orderBlock",components:{checkBox:b["a"]},props:{data:{type:Object,default:function(){return{}}},showCheckBox:{type:Boolean,default:!1}},computed:Object(u["a"])({},Object(d["c"])({sysMoneyPointSize:"sysMoneyPointSize"}),{toFixedNumberSize:function(t){var e=this;return function(t){return m()(e.$fxUtils.toFixedSHW(t,e.sysMoneyPointSize))}}}),methods:{onClick:function(){this.showCheckBox?this.$set(this.data,"checked",!this.data.checked):this.$emit("on-click",this.data)}}},S=v,g=(i("f821"),i("2877")),w=Object(g["a"])(S,h,f,!1,null,"77b92a53",null),D=w.exports,k=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("fx-order-list-filter",{on:{"on-back":t.onCloseClick}},[i("van-cell-group",[i("w-cell",{attrs:{title:"业务日期"}}),i("w-cell",{attrs:{title:"起始时间","is-link":""},on:{click:t.onBeginDateClick}},[t._v(t._s(t.beginDate))]),i("w-cell",{attrs:{title:"结束时间","is-link":""},on:{click:t.onEndDateClick}},[t._v(t._s(t.endDate))]),i("w-cell",{attrs:{title:"配送中心","is-link":""},on:{click:t.onRdcClick}},[t._v(t._s(t.rdc.name))]),i("w-cell",{attrs:{title:"门店","is-link":""},on:{click:t.onInShopClick}},[t._v(t._s(t.inShop.name))]),i("w-cell",{attrs:{title:"仓库","is-link":""},on:{click:t.onHouseClick}},[t._v(t._s(t.house.name))]),i("w-cell",{attrs:{title:"品项","is-link":""},on:{click:t.onGoodsClick}},[t._v(t._s(t.goods.name))]),i("w-cell",{attrs:{title:"单据类型","is-link":!t.billType.id,"is-clear":!!t.billType.id},on:{click:t.onBillTypeClick,"on-clear":t.onBillTypeClearClick}},[t._v(t._s(t.billType.name))]),i("van-pro-field",{ref:"billNo",attrs:{label:"系统单号",placeholder:"请输入系统单号","input-align":"right"},on:{focus:function(e){return t.onFocus("billNo")}},model:{value:t.billNo,callback:function(e){t.billNo=e},expression:"billNo"}})],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{type:"date",visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right"},model:{value:t.rdcPopShow,callback:function(e){t.rdcPopShow=e},expression:"rdcPopShow"}},[i("listComp",{attrs:{visibleFlag:t.rdcPopShow,data:t.rdcList,loadFinished:!0,title:"配送中心检索"},on:{"update:visibleFlag":function(e){t.rdcPopShow=e},"update:visible-flag":function(e){t.rdcPopShow=e},"on-select":t.selectRdcs,"on-search":t.searchRdcs}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right"},model:{value:t.inShopPopShow,callback:function(e){t.inShopPopShow=e},expression:"inShopPopShow"}},[i("listComp",{attrs:{visibleFlag:t.inShopPopShow,data:t.inShopList,title:"门店检索",loadFinished:!0},on:{"update:visibleFlag":function(e){t.inShopPopShow=e},"update:visible-flag":function(e){t.inShopPopShow=e},"on-select":t.selectInShop,"on-search":t.searchInShop}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right"},model:{value:t.housePopShow,callback:function(e){t.housePopShow=e},expression:"housePopShow"}},[i("listComp",{attrs:{visibleFlag:t.housePopShow,data:t.houseList,title:"仓库检索",loadFinished:!0},on:{"update:visibleFlag":function(e){t.housePopShow=e},"update:visible-flag":function(e){t.housePopShow=e},"on-select":t.selectHouse,"on-search":t.searchHouse}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right"},model:{value:t.goodsPopShow,callback:function(e){t.goodsPopShow=e},expression:"goodsPopShow"}},[i("listComp",{attrs:{visibleFlag:t.goodsPopShow,data:t.goodsList,title:"品项检索",loading:t.goodsLoading,loadFinished:t.goodsLoadFinished},on:{"update:visibleFlag":function(e){t.goodsPopShow=e},"update:visible-flag":function(e){t.goodsPopShow=e},"update:loading":function(e){t.goodsLoading=e},"on-select":t.selectGoods,"on-search":t.searchGoods,"on-load":t.loadGoodsList}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right"},model:{value:t.billTypePopShow,callback:function(e){t.billTypePopShow=e},expression:"billTypePopShow"}},[i("listComp",{attrs:{visibleFlag:t.billTypePopShow,data:t.billTypeList,title:"单据类型检索",loadFinished:!0},on:{"update:visibleFlag":function(e){t.billTypePopShow=e},"update:visible-flag":function(e){t.billTypePopShow=e},"on-select":t.selectBillType,"on-search":t.searchBillType}})],1),i("w-button",{attrs:{slot:"bottom-btn",size:"large",type:"info"},on:{click:t.onResetClick},slot:"bottom-btn"},[t._v("重置")]),i("w-button",{attrs:{slot:"bottom-btn",size:"large",type:"primary"},on:{click:t.onConfirmClick},slot:"bottom-btn"},[t._v("确定")])],1)},I=[],C=i("f6bb"),x=50,y={name:"FilterPop",components:{listComp:C["a"]},props:{visibleFlag:Boolean,filterParams:{type:Object,default:function(){return{}}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},currentDate:new Date,datePickerShow:!1,beginDate:"",endDate:"",rdc:{name:"请选择"},rdcList:[],rdcPopShow:!1,inShop:{name:"请选择"},inShopList:[],inShopPopShow:!1,house:{name:"请选择"},houseList:[],housePopShow:!1,goods:{name:"请选择"},goodsListStart:0,goodsList:[],goodsLoading:!1,goodsLoadFinished:!1,goodsPopShow:!1,searchGoodsKeyword:"",billType:{name:"请选择"},billTypeList:[],billTypePopShow:!1,billNo:""}},watch:{visibleFlag:{handler:function(t){t&&this.$fxUtils.isEmptyObjSHW(this.filterParams)&&this.resetHandler()},immediate:!0},businessDateStart:{immediate:!0,handler:function(t){this.beginDate=t}},businessDateEnd:{immediate:!0,handler:function(t){this.endDate=t}}},computed:Object(u["a"])({},Object(d["c"])({loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId},businessDateStart:function(t){return t.systemParamsCld.businessDateStart},businessDateEnd:function(t){return t.systemParamsCld.businessDateEnd}})),methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onBeginDateClick:function(){this.datePickerShow=!0,this.beginDate&&(this.currentDate=new Date(this.beginDate)),this.dateType="begin"},onEndDateClick:function(){this.datePickerShow=!0,this.endDate&&(this.currentDate=new Date(this.endDate)),this.dateType="end"},dateConfirmhandle:function(t){"begin"===this.dateType?this.beginDate=this.$fxUtils.setDate(t):this.endDate=this.$fxUtils.setDate(t),this.datePickerShow=!1},onRdcClick:function(){var t=this;this.getRdcListData().then(function(e){t.rdcList=e.shops,t.rdcPopShow=!0})},selectRdcs:function(t){this.rdc=t},searchRdcs:function(t){var e=this;this.getRdcListData(t).then(function(t){e.rdcList=t.shops})},getRdcListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new l.a(function(i){var o={keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/rdcs"),data:o}).then(function(t){i(t)})})},onInShopClick:function(){var t=this;this.getInShopListData().then(function(e){t.inShopList=e.shops,t.inShopPopShow=!0})},selectInShop:function(t){this.inShop=t},searchInShop:function(t){var e=this;this.getInShopListData(t).then(function(t){e.inShopList=t.shops})},getInShopListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new l.a(function(i){var o={m:"list4ShopOrderBill",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/shops"),data:o}).then(function(t){i(t)})})},onHouseClick:function(){var t=this;if(!this.inShop.id)return this.$fxToast.fail("请先选择门店!"),!1;this.getHouseListData().then(function(e){t.houseList=e.shops,t.housePopShow=!0})},selectHouse:function(t){this.house=t},searchHouse:function(t){var e=this;this.getHouseListData(t).then(function(t){e.houseList=t.shops})},getHouseListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new l.a(function(i){var o={keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.inShop.id,"/users/").concat(t.loginerId,"/houses"),data:o}).then(function(t){i(t)})})},onGoodsClick:function(){var t=this;this.goodsListStart=0,this.searchGoodsKeyword="",this.getGoodsListData().then(function(e){t.goodsLoading=!1,t.goodsPopShow=!0,t.goodsList=e.goods})},selectGoods:function(t){this.goods=t},searchGoods:function(t){var e=this;this.goodsListStart=0,this.searchGoodsKeyword=t,this.getGoodsListData(t).then(function(t){t.goods.length<x&&(e.goodsLoadFinished=!0),e.goodsList=t.goods})},loadGoodsList:function(){var t=this;!0!==this.goodsLoadFinished&&(this.goodsListStart=this.goodsListStart+x,this.getGoodsListData(this.searchGoodsKeyword).then(function(e){var i;t.goodsLoading=!1,e.goods.length<x&&(t.goodsLoadFinished=!0),(i=t.goodsList).push.apply(i,Object(n["a"])(e.goods))}))},getGoodsListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new l.a(function(i){var o={start:t.goodsListStart,size:x,paged:!0,m:"list4ShopOrderBill",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/goods"),data:o}).then(function(t){i(t)})})},onBillTypeClick:function(){var t=this;this.getBillTypeListData().then(function(e){t.billTypeList=e.businessTypes,t.billTypePopShow=!0})},selectBillType:function(t){this.billType=t},searchBillType:function(t){var e=this;this.getBillTypeListData(t).then(function(t){e.billTypeList=t.businessTypes})},getBillTypeListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new l.a(function(i){var o={m:"list4DistributionOutListBill",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/businessTypes"),data:o}).then(function(t){i(t)})})},onResetClick:function(){this.resetHandler()},resetHandler:function(){this.beginDate=this.businessDateStart,this.endDate=this.businessDateEnd,this.rdc={name:"请选择"},this.inShop={name:"请选择"},this.house={name:"请选择"},this.billType={name:"请选择"},this.goods={name:"请选择"},this.billNo=""},onConfirmClick:function(){if(new Date(this.endDate)<new Date(this.beginDate))return this.$fxToast.fail("开始日期不能大于结束日期!"),!1;this.$emit("update:visibleFlag",!1),this.$emit("update:filterParams",this.getFilterParams()),this.$emit("on-confirm",this.getFilterParams())},getFilterParams:function(){return{beginDate:this.beginDate,endDate:this.endDate,rdcId:this.rdc.id,inShopId:this.inShop.id,houseId:this.house.id,billTypeId:this.billType.id,goodsId:this.goods.id,billNo:this.billNo}},onFocus:function(t){this.onScrollTop(t)},onScrollTop:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,i=this.$refs[t];if(!i||0===i.length)return!1;var o=i.$el.offsetTop,s=this.$refs["filterContent"];this.$fxUtils.scrollTopW({offsetTop:o,$el:s,distance:e})},onBillTypeClearClick:function(){this.billType={name:"请选择",id:""}}}},O=y,A=Object(g["a"])(O,k,I,!1,null,null,null),T=A.exports,P=50,B={name:"distributionOutBill4cld",components:{orderBlock:D,filterPop:T},data:function(){return{routeParams:this.$route.params,orderList:[],filterPopShow:!1,filterStateAndRestate:"0",filterState:"0",filterBillReState:null,filterSortingState:null,listStart:0,pullRefreshLoading:!1,loadFinished:!0,orderEditFlag:!1,filterParams:{},checkActionSheetShow:!1,checkActions:[],sortingActionSheetShow:!1,sortingCheckActions:this.$fxStateMiddleware.getStateList("sortingState")}},beforeRouteEnter:function(t,e,i){var o=["/main/home","/"],s=["/distributionOutBill4cldDetails"];o.includes(e.path)?i(function(t){t.restFilterParams(),t.refreshOrderList()}):s.includes(e.path)?i(function(t){t.refreshOrderList()}):i()},computed:Object(u["a"])({},Object(d["c"])({billListPostParams:"billListPostParams",businessDateStart:function(t){return t.systemParamsCld.businessDateStart},businessDateEnd:function(t){return t.systemParamsCld.businessDateEnd},disOut_setDate4Check:function(t){return t.systemParamsCld.disOut_setDate4Check}}),{computedShowOrder:function(t){var e=this;return function(t){return!e.orderEditFlag||!e.$fxStateMiddleware.stateIs("stateCld")("checked")(t)}},isSelectAll:function(){var t=this;return this.$fxCommon.orderListIsSelectAll(function(){return t.orderList.filter(function(e){return!t.$fxStateMiddleware.stateIs("stateCld")("checked")(e.billStateFlag)})})}}),methods:{orderListPostHandler:function(t){return this.$store.commit({type:"SETSTATE",billListPostParams:t}),this.$fxApi("distributionOutBill4cld.getOrderListData")({data:t})},refreshOrderList:function(){var t=this;return new l.a(function(e){t.listStart=0;var i={start:t.listStart,size:P,paged:!0,businessDateStart:t.businessDateStart,businessDateEnd:t.businessDateEnd,billStateFlag:t.filterState,reCheckState:t.filterBillReState,sortingState:t.filterSortingState};i=r()(i,t.translateFilterParams(t.filterParams)),t.orderListPostHandler(i).then(function(i){t.orderList=i.storeBills,e(i)})})},onFilterConfirm:function(t){var e=this;this.listStart=0;var i={start:this.listStart,size:P,paged:!0,businessDateStart:t.beginDate,businessDateEnd:t.endDate,billStateFlag:this.filterState,reCheckState:this.filterBillReState,sortingState:this.filterSortingState,rdcId:""===t.rdcId?null:t.rdcId,inShopId:""===t.inShopId?null:t.inShopId,houseId:""===t.houseId?null:t.houseId,goodsId:""===t.goodsId?null:t.goodsId,businessType:""===t.billTypeId?null:t.billTypeId,sysBillCode:""===t.billNo?null:t.billNo};this.orderListPostHandler(i).then(function(t){e.orderList=t.storeBills})},translateFilterParams:function(t){return this.$fxUtils.isEmptyObjSHW(t)?{}:{businessDateStart:t.beginDate,businessDateEnd:t.endDate,rdcId:""===t.rdcId?null:t.rdcId,inShopId:""===t.inShopId?null:t.inShopId,houseId:""===t.houseId?null:t.houseId,goodsId:""===t.goodsId?null:t.goodsId,businessType:""===t.billTypeId?null:t.billTypeId,sysBillCode:""===t.billNo?null:t.billNo}},onPullRefresh:function(){var t=this;this.refreshOrderList().then(function(e){t.pullRefreshLoading=!1})},onLoadMore:function(){var t=this,e=r()(this.billListPostParams,{start:this.listStart});this.orderListPostHandler(e).then(function(e){var i;(i=t.orderList).push.apply(i,Object(n["a"])(e.storeBills))})},onSearchClick:function(){this.filterPopShow=!0},onStateSelect:function(t){this.filterStateAndRestate=t.id,this.filterState=t.state,this.filterBillReState=t.rescheck,this.refreshOrderList()},onSortingSelect:function(t){this.filterSortingState=t.id,this.refreshOrderList()},onClickOrder:function(t){this.$router.push({path:"distributionOutBill4cldDetails",query:{orderId:t.id}})},onCreateClick:function(){this.$router.push("createDistributionOutBill4cld")},onOrderEditClick:function(t){this.orderEditFlag=!t},checkSorting:function(){var t=this;return new l.a(function(e){var i="",o=t.orderList.filter(function(e){return e.checked&&t.$fxStateMiddleware.stateIs("sortingState")(["sorting","unSorting"])(e.sortingState)});i=t.$fxAuth("distributionOutBill4cld.sorting")&&o.length>0?"所选择单据中分拣状态含有待分拣或分拣中单据，若强制审核单据分拣状态自动更新为：“已分拣”，是否继续审核？":"是否审核所选单据？审核后单据将不能修改，确定要审核吗？",t.$dialog.confirm({title:"提示",message:i}).then(e)})},onExpressClick:function(){var t=this,e=this.orderList.reduce(function(t,e){var i=e.checked?t.concat(e.id):t;return i},[]);if(0===e.length)return this.$fxToast.fail("请选择要审核的单据"),!1;this.checkSorting().then(function(){t.checkExpressType({data:e})})},checkExpressType:function(t){var e=this;0===this.disOut_setDate4Check?this.expressHandler(t):(1===this.disOut_setDate4Check?this.checkActions=[{id:1,name:"审核并重置业务日期"},{id:0,name:"审核但不重置业务日期"}]:2===this.disOut_setDate4Check&&(this.checkActions=[{id:1,name:"审核并重置业务日期"}]),this.$refs.checkActionSheet.doSelect().then(function(i){e.expressBusinessDateHandler(t,i.id)}))},expressHandler:function(t){var e=this;this.$fxApi("distributionOutBill4cld.checkMulity")(t).then(function(t){e.orderEditFlag=!e.orderEditFlag,e.refreshOrderList().then(function(){e.$fxToast.success(t.message)})}).catch(function(){e.refreshOrderList()})},expressBusinessDateHandler:function(t,e){var i=this;this.$fxApi("distributionOutBill4cld.checkMulityByBusinessDate",e)(t).then(function(t){i.orderEditFlag=!i.orderEditFlag,i.refreshOrderList().then(function(){i.$fxToast.success(t.message)})}).catch(function(){i.refreshOrderList()})},onSelectAllClick:function(t){var e=this;this.$fxCommon.orderListOnSelectAll(this.orderList,function(t){return!e.$fxStateMiddleware.stateIs("stateCld")("checked")(t.billStateFlag)},!t)},restFilterParams:function(){this.filterParams={},this.filterStateAndRestate=this.$fxStateMiddleware.getStateVal("stateAndRecheckCld")("all"),this.filterState=this.$fxStateMiddleware.getStateVal("stateCld")("all"),this.filterBillReState=null,this.filterSortingState=null,this.orderEditFlag=!1},onSortingClick:function(){var t=this,e=this.orderList.reduce(function(t,e){var i=e.checked?t.concat(e.id):t;return i},[]);this.$fxCommon.orderFrontFunc("sortingMulity",e).then(function(i){t.$refs.sortingActionSheet.doSelect().then(function(i){t.sortingHandler(i.id,e).then(function(e){t.refreshOrderList().then(function(){t.$fxToast.success(e.message)})})})})},sortingHandler:function(t,e){var i={sortingState:t,billIds:e};return this.$fxApi("distributionOutBill4cld.sortingMulity")({data:i})}}},$=B,L=Object(g["a"])($,o,s,!1,null,null,null);e["default"]=L.exports},"3e54":function(t,e,i){"use strict";var o=i("4619"),s=i.n(o);s.a},"41c0":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQyIDc5LjE2MDkyNCwgMjAxNy8wNy8xMy0wMTowNjozOSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjU5MzM3ODc2REY1QzExRTlBNjU4QkY2NDE0MTBEMjAzIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjU5MzM3ODc3REY1QzExRTlBNjU4QkY2NDE0MTBEMjAzIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NTkzMzc4NzRERjVDMTFFOUE2NThCRjY0MTQxMEQyMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NTkzMzc4NzVERjVDMTFFOUE2NThCRjY0MTQxMEQyMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6ky6P/AAACeElEQVR42sSXTW8SURSGLwNhAZLQBAhb09K6Vxd+xpWJNboxqRub9meoP0D7M5roRl36lW6tsQvtvkobd4QASUkYWPDp+07OkENtYabD1ZO8cyHMvM+9d+695xAbjUbmf0QiyE3lcjmG5hZ0H7oBLUEL8vMxdAh9gz5Au6VSaeZoYtNGDKCDZhN6JrAgwU68hLbRgWFoMKAX0byBrnpTk0iYTCZjUqmUSSaTJh6PGz7b7/c9dTod47qu6fV6vsV36DHgvwODAb2D5h2UIzCXy3nQINFqtUyj0fA6g2hAjwD/MhMM6F0076FkOp02xWLROI4TauEMh0NTrVZNu93m1y70EPCdM8GArsgUZbLZrMnn85FWbr1eN81mkx9d6ArgP/3fHAWNo3lFKKc1KpRBD3lFF+gtjEkwYoMLie+0UCjMbb/Si56ySDcnwLJPuWW8hRT2nU4LetFT4qmwxiO+zX3qb5l5Bz1l1EvCGoNX/RtshfJe1eDrvPBwsBXK+5oGl3jhiWQrlPeyBnsHPo9BW6G8F05up38ajkptZjAYWAMp72MNLnuHardrDay8f2nwHi9MbbZCee9p8Ec/pdkK5f1Jg5kvD5lDbcDpKfmZ1cnuGCw10paXuZHEmU/nFfSip8SWXw7p7bQN/WDParXa3MD0ktHuC2MyLaInXO/rTNqcGibxqEEPeXUsBJ4I4698TPgBmjWuflYOlUrlXNPOZ/isVB/cR2viPbPYu4fmLSuHiMWeK9DPYcrbS2heQ5fPKm/9E4mHwynl7b5M70GUgv45tBhwpo+gF+cu6E/pwE3ogeTuxRN/YY7kLwzL4q/TgKHANuKPAAMAun8rS4SUYuAAAAAASUVORK5CYII="},4619:function(t,e,i){},"4baf":function(t,e,i){"use strict";var o=i("5c1c"),s=i.n(o);s.a},5398:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-item-block fx-shadow-block"},[i("div",{staticClass:"item-title"},[i("span",{staticClass:"title-name"},[t._v("单据明细")]),i("span",{staticClass:"title-count"},[t._v("明细：")]),i("span",[t._v(t._s(t.detailsLength))]),i("i",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&t.showAddItemBtn,expression:"!isDisabled && showAddItemBtn"}],staticClass:"title-add-icon fl-r",on:{click:function(e){return t.onEmitClick("on-add-click")}}}),i("i",{staticClass:"title-search-icon fl-r",on:{click:t.onSearchClick}})]),i("div",{ref:"details-content",staticClass:"item-list"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeStoreNames,callback:function(e){t.activeStoreNames=e},expression:"activeStoreNames"}},t._l(t.data,function(e){return i("van-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.storeShowComputed(e),expression:"storeShowComputed(storeItem)"}],key:e.uuid,staticClass:"store-row",attrs:{name:e.id+"-"+e.shopHouseDTO.id}},[i("div",{staticClass:"item-store-title-container",attrs:{slot:"title"},slot:"title"},[i("span",{staticClass:"item-out-store-title fx-ellipsis"},[t._v("出库仓库："+t._s(e.name))]),i("span",{staticClass:"item-in-store-title fx-ellipsis"},[t._v("入库仓库："+t._s(e.shopHouseDTO.name))])]),t._l(e.details,function(o,s){return i("van-swipe-cell",{directives:[{name:"show",rawName:"v-show",value:"del"!==o.changeType,expression:"item.changeType !== 'del'"}],key:o.uuid,staticClass:"item-row",attrs:{"right-width":80,disabled:t.isDisabled||t.focusing||!t.$fxAuth("distributionOutBill4cld.delDetail")}},[i("itemInfoCell",t._g(t._b({attrs:{itemData:o,isDisabled:t.isDisabled,disabledEditBtn:t.focusing},on:{"on-item-focus":t.onItemFocus,"on-item-blur":t.onItemBlur,"on-unit-edit":t.onUnitEdit}},"itemInfoCell",t.$attrs,!1),t.$listeners)),i("div",{staticClass:"item-row-delete",attrs:{slot:"right"},on:{click:function(i){return t.onDeleteClick(o,s,e.details)}},slot:"right"},[t._v("删除")])],1)})],2)}),1)],1),i("w-action-sheet",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.unitActionShow,expression:"unitActionShow"}],ref:"unitActionSheet",attrs:{actions:t.unitActions},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}})],1)},s=[],n=(i("ac6a"),i("033b")),a={name:"orderItem",components:{itemInfoCell:n["a"]},props:{data:{type:Array,default:function(){return[]}},isDisabled:Boolean,showAddItemBtn:Boolean},inheritAttrs:!1,data:function(){return{focusing:!1,activeStoreNames:[],unitActions:[],unitActionShow:!1}},computed:{storeShowComputed:function(t){return function(t){var e=t.details.filter(function(t){return"del"!==t.changeType}).length;return e>0}},detailsLength:function(t){return this.data.reduce(function(t,e){var i=e.details.filter(function(t){return"del"!==t.changeType});return t+i.length},0)}},watch:{focusing:function(t){this.$emit("update:itemInputFocusing",t)},data:function(){var t=this;this.data.forEach(function(e){var i=e.details.filter(function(t){return"del"!==t.changeType}).length;i>0&&t.activeStoreNames.push("".concat(e.id,"-").concat(e.shopHouseDTO.id))})}},methods:{onEmitClick:function(t){if(this.isDisabled||this.focusing)return!1;this.$emit(t)},onSearchClick:function(){if(this.focusing)return!1;this.$emit("on-search-click")},onDeleteClick:function(t,e,i){t.id?this.$set(t,"changeType","del"):i.splice(e,1)},onItemFocus:function(){this.focusing=!0},onItemBlur:function(){this.focusing=!1},onUnitEdit:function(t){var e=this;this.$fxApi("common.getItemUnit",t.goodsDTO.id).then(function(i){e.unitActions=i.units,e.$refs.unitActionSheet.doSelect(t.unitDTO.id).then(function(i){e.$fxCalculation("distributionOutBill4cld").changeUnit(t,i)})})}}},r=a,c=(i("4baf"),i("2877")),l=Object(c["a"])(r,o,s,!1,null,"61263a52",null);e["a"]=l.exports},5402:function(t,e,i){"use strict";var o=i("73b7"),s=i.n(o);s.a},"541c":function(t,e,i){"use strict";var o=i("ba51"),s=i.n(o);s.a},"566b":function(t,e,i){},"5c1c":function(t,e,i){},"73b7":function(t,e,i){},"812c":function(t,e,i){"use strict";var o=i("d346"),s=i.n(o);s.a},"83c5":function(t,e,i){"use strict";var o=i("d2f2"),s=i.n(o);s.a},"8c37":function(t,e,i){},"8d5d":function(t,e,i){"use strict";var o=i("08d9"),s=i.n(o);s.a},"8d60":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("w-app-page",{staticClass:"item-edit"},[i("w-header",{attrs:{title:"选择品项",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}},[i("van-icon",{staticClass:"header-confirm-btn",attrs:{slot:"header-right",name:"success"},on:{click:t.onItemConfirm},slot:"header-right"})],1),i("div",{staticClass:"item-search clearfix"},[i("van-search",{attrs:{placeholder:"请输入搜索关键词",shape:"round"},on:{search:t.search,focus:t.onSearchFocus},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}})],1),i("div",{staticClass:"item-edit-content"},[i("addItemClassList",{attrs:{itemClassList:t.itemClassList},on:{"on-change-class":t.changeClass},model:{value:t.currentClass,callback:function(e){t.currentClass=e},expression:"currentClass"}}),i("addItemList",{ref:"addItemList",attrs:{listLoading:t.listLoading,loadFinished:t.loadFinished,itemList:t.itemList},on:{"update:listLoading":function(e){t.listLoading=e},"update:list-loading":function(e){t.listLoading=e},"on-load-more":t.onLoadMore},scopedSlots:t._u([{key:"item-cell",fn:function(e){return[i("addItemCell",{attrs:{itemData:e.$item,itemIndex:e.$index,rowActive:t.rowActive,itemAmoutName:"busUnitOutAmount"},on:{"on-item-click":t.onItemEdit}})]}}]),model:{value:t.rowActive,callback:function(e){t.rowActive=e},expression:"rowActive"}})],1),i("fx-item-number-keyboard",{directives:[{name:"show",rawName:"v-show",value:t.numberKeyboardShow,expression:"numberKeyboardShow"}],attrs:{amountKey:"busUnitOutAmount",data:t.currentSelectItem,unitEdit:!0,pointSize:t.sysPointSize,intLength:t.numberLength},on:{change:t.onKeyboardChange,pre:t.onKeyboardPre,next:t.onKeyboardNext,hide:t.onKeyboardHide,"on-unit-select":t.onUnitSelect}}),i("w-action-sheet",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.scanActionShow,expression:"scanActionShow"}],ref:"scanActionSheet",attrs:{actions:t.scanActions},model:{value:t.scanActionShow,callback:function(e){t.scanActionShow=e},expression:"scanActionShow"}})],1)},s=[],n=(i("7f7f"),i("59ad")),a=i.n(n),r=i("768b"),c=(i("20d6"),i("75fc")),l=(i("ac6a"),i("f499")),u=i.n(l),d=i("cebc"),h=(i("c5f6"),i("2f62")),f=i("d444"),p=i("01f7"),m=i("9c7f"),b=10,v={name:"itemEditComp",components:{addItemClassList:f["a"],addItemList:p["a"],addItemCell:m["a"]},props:{visibleFlag:Boolean,outHouse:{type:Object,default:function(){return{}}},shopHouseDTO:{type:Object,default:function(){return{}}},inShopId:{type:String,default:""},rdcId:{type:String,default:""},businessDate:{type:[String,Number],default:""},parentStoreItem:{type:Array,default:function(){return[]}}},data:function(){return{query:this.$route.query,leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",currentClass:"",itemClassList:[],itemList:[],numberKeyboardShow:!1,rowActive:"",selectedItemArr:[],itemListStart:0,listLoading:!1,loadFinished:!0,listError:!1,isErrorActive:"",scanActionShow:!1,scanActions:[{name:"累加数量"},{name:"覆盖数量"}]}},computed:Object(d["a"])({},Object(h["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength"}),{currentSelectItem:function(){return""===this.rowActive?{}:this.itemList[this.rowActive]}}),watch:{visibleFlag:{handler:function(t){t&&(this.$fxAuth("distributionOutBill4cld.inputMultipleDetails")?this.selectedItemArr=[]:this.selectedItemArr=JSON.parse(u()(this.parentStoreItem)),this.refresh())},immediate:!0},rowActive:function(t,e){""!==e?(this.numberStringAmount(e),this.pushSelectedItem(this.itemList[e]),""===t?this.numberKeyboardShow=!1:this.scrollToActive(t)):this.scrollToActive(t)}},created:function(){this.$fxEventBus.$on("redCode",this.getItemByRedCode)},beforeDestroy:function(){this.$fxEventBus.$off("redCode",this.getItemByRedCode)},methods:{refresh:function(){var t=this;this.searchKey="",this.getItemClass().then(function(e){t.itemClassList=e.goodsTypes,t.currentClass="",t.getItemByClass()})},onCloseClick:function(){this.rowActive="",this.$emit("update:visibleFlag",!1)},onItemConfirm:function(){var t=this;this.rowActive="",this.$nextTick(function(){t.selectedItemArr.forEach(function(e){e.shopHouseDTO||(e.shopHouseDTO=t.shopHouseDTO),e.outHouseDTO||(e.outHouseDTO=t.outHouse)}),t.$emit("on-confirm",[t.selectedItemArr,t.outHouse,t.shopHouseDTO]),t.$emit("update:visibleFlag",!1)})},search:function(){this.getItemByClass()},getItemClass:function(){return this.$fxApi("distributionOutBill4cld.getItemClass",this.inShopId)},getItem:function(){var t={start:this.itemListStart,size:b,paged:!0,goodsTypeId:this.currentClass||null,shopId:this.inShopId,rdcId:this.rdcId,outHouseId:this.outHouse.id,inHouseId:this.shopHouseDTO.id,workDate:this.businessDate,searchText:this.searchKey||""};return this.$fxApi("distributionOutBill4cld.getItemByClass",this.inShopId)({data:t})},getItemByClass:function(){var t=this;this.itemListStart=0,this.getItem().then(function(e){var i=t.setDataMoneyAndPrice(e);t.itemList=t.setResItem(i),t.setListLoading(i.length),t.$nextTick(function(){t.$refs.addItemList&&t.$refs.addItemList.onSelectLetter(0,5)})})},onLoadMore:function(){var t=this;this.getItem().then(function(e){var i,o=t.setDataMoneyAndPrice(e);(i=t.itemList).push.apply(i,Object(c["a"])(t.setResItem(o))),t.setListLoading(o.length)})},setDataMoneyAndPrice:function(t){return t.forEach(function(t){t.goodsDTO={id:t.goodsId,imageUrls:t.goodsImgUrl?[t.goodsImgUrl]:[],name:t.goodsName,spec:t.goodsSpec,code:t.goodsCode,pinYin:t.goodsSign},t.unitDTO={id:t.unitId,name:t.unitName,value:t.unitValue},t.giftFlag=!1,t.price=t.salePrice,t.taxPrice=t.taxesPrice,t.outMoney=0,t.outMoneyWithTax=0,t.tax=t.taxes,t.taxOutMoney=0,t.costDispach=!1}),t},setResItem:function(t){var e=this;return t.forEach(function(i,o){var s=e.selectedItemArr.findIndex(function(t){return i.goodsDTO.id===t.goodsDTO.id&&"del"!==t.changeType});~s?t[o]=e.$fxUtils.JSONcopy(e.selectedItemArr[s]):i.busUnitOutAmount="0"}),t},setListLoading:function(t){this.listLoading=!1,this.itemListStart+=b,this.loadFinished=t<b},changeClass:function(t){var e=Object(r["a"])(t,2);e[0],e[1];this.searchKey="",this.onKeyboardHide(),this.getItemByClass()},onItemEdit:function(t){this.rowActive=t,this.numberKeyboardShow=!0},onKeyboardChange:function(t){this.itemList[this.rowActive].busUnitOutAmount=t,this.computedAssistAmount(this.itemList[this.rowActive])},numberStringAmount:function(t){var e=this.itemList[t].busUnitOutAmount;this.itemList[t].busUnitOutAmount=a()(e)},pushSelectedItem:function(t){var e=this.selectedItemArr.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id});~e?t.id||0!==t.busUnitOutAmount?(t.id&&(0===t.busUnitOutAmount?this.$fxAuth("distributionOutBill4cld.delDetail")?this.$fxCommon.delEditItem(this.selectedItemArr,t,e):(t.busUnitOutAmount=1,this.$fxCommon.editItem(t),this.$fxToast({message:"当前没有删除品项权限",position:"top"})):this.$fxCommon.editItem(t)),this.$fxCommon.replaceItem(this.selectedItemArr,t,e),this.computedItemByAmount(t,e)):this.$fxCommon.delEditItem(this.selectedItemArr,t,e):t.busUnitOutAmount>0&&(t.uuid=this.$fxUtils.createUUID(),this.$fxCommon.addEditItem(this.selectedItemArr,t),this.computedItemByAmount(this.selectedItemArr,this.selectedItemArr.length-1))},computedItemByAmount:function(t,e){this.$fxCalculation("distributionOutBill4cld").changeAmount(this.selectedItemArr[e])},onKeyboardPre:function(){if(!this.rowActive)return!1;this.rowActive--},onKeyboardNext:function(){if(""===this.rowActive||this.rowActive===this.itemList.length-1)return!1;this.rowActive++},onKeyboardHide:function(){this.rowActive=""},scrollToActive:function(t){var e=this;this.$nextTick(function(){e.$refs.addItemList.onSelectLetter(t,20)})},onSearchFocus:function(){this.rowActive=""},onUnitSelect:function(t,e){this.$fxCalculation("distributionOutBill4cld").changeUnit(this.itemList[this.rowActive],t)},getItemByRedCode:function(t){var e=this;if(!this.visibleFlag)return!1;this.getItemByCode(t).then(function(t){if(0===t.length)return e.$fxToast.top("当前仓库无此品项!"),!1;e.getScanGoodData(t)})},getItemByCode:function(t){var e={billId:this.query.orderId||"",shopId:this.inShopId,rdcId:this.rdcId,outHouseId:this.outHouse.id,inHouseId:this.shopHouseDTO.id,workDate:this.businessDate,barcode:t};return this.$fxApi("distributionOutBill4cld.scanCode")({data:e})},getScanGoodData:function(t){var e=this.setDataMoneyAndPrice(t),i=Object(r["a"])(e,1),o=i[0];o.busUnitOutAmount=o.adviseAmount,this.computedAssistAmount(o),this.setScanGood(o)},computedAssistAmount:function(t){t.assistUnitFlag&&(t.outAssistAmount=t.busUnitOutAmount)},setScanGood:function(t){var e=this,i=[];i=this.$fxAuth("distributionOutBill4cld.inputMultipleDetails")?this.selectedItemArr.concat(this.parentStoreItem):this.selectedItemArr;var o=i.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id});if(~o){var s=i.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id&&t.unitDTO.id===e.unitDTO.id});if(!~s)return this.$fxToast.fail("不能重复添加品项！"),!1;var n=i[o],a=this.copyScanGood(t,n);if(n.batchCode!==a.batchCode&&this.$fxUtils.isDef(n.batchCode))return this.$fxToast.fail("不能重复添加品项！"),!1;this.$refs.scanActionSheet.doSelect().then(function(t){"累加数量"===t.name&&e.computedScanItemAmount(a,n),e.pushSelectedItem(a),e.itemList=[a]})}else this.itemList=[t],this.pushSelectedItem(t),this.$fxToast.success("扫码添加品项成功！")},copyScanGood:function(t,e){var i=t.busUnitOutAmount,o=t.batchCode,s=this.$fxUtils.JSONcopy(e);return s.busUnitOutAmount=i,s.batchCode=o,this.computedAssistAmount(s),this.$fxCalculation("distributionOutBill4cld").changeAmount(s),s},computedScanItemAmount:function(t,e){var i=this.$fxUtils.toFixedParseNumber(t.busUnitOutAmount+e.busUnitOutAmount,this.sysPointSize);t.busUnitOutAmount=this.$fxCommon.checkAmountRange(i),this.$fxCalculation("distributionOutBill4cld").changeAmount(t)}}},S=v,g=(i("541c"),i("2877")),w=Object(g["a"])(S,o,s,!1,null,"9d98e1f2",null);e["a"]=w.exports},"9c7f":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-detail-cell",class:{"is-active":t.rowActive===t.itemIndex,"is-error":t.isError},on:{click:t.onItemClick}},[i("div",{staticClass:"item-details-img"},[i("w-img",{attrs:{src:t.itemData.goodsDTO.imageUrls}})],1),i("div",{staticClass:"item-details-params"},[i("div",{staticClass:"item-details-name fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.name))]),t.sysShowCode?i("div",{staticClass:"item-details-name fx-ellipsis"},[t._v("编号："+t._s(t.itemData.goodsDTO.code))]):t._e(),i("div",{staticClass:"item-details-spec fx-ellipsis"},[t._v("\n\t\t\t"+t._s(t.showBom?t.itemData.bomDTO.name:"")+"\n\t\t\t"+t._s(!t.showBom&&t.showSpec?t.itemData.goodsDTO.spec:"")+"\n\t\t")]),i("div",{staticClass:"item-details-amount"},[i("span",{staticClass:"item-details-count"},[t._v(t._s(t.getItemAmount()))]),i("span",{staticClass:"item-details-unit"},[t._v(t._s(t.itemData.unitDTO.name))])]),i("i",{directives:[{name:"show",rawName:"v-show",value:t.getItemAmount()>0||t.isActive,expression:"(getItemAmount()>0 || isActive)"}],staticClass:"item-selected-icon"})])])},s=[],n=i("cebc"),a=(i("c5f6"),i("2f62")),r={name:"addItemCell",props:{itemData:{type:Object,default:function(){return{}}},itemIndex:Number,rowActive:[Number,String],isActive:Boolean,isError:Boolean,showBom:{type:Boolean,default:!1},showSpec:{type:Boolean,default:!0},itemAmoutName:{type:String,default:""}},computed:Object(n["a"])({},Object(a["c"])({sysShowCode:function(t){return t.systemParams.sysShowCode}})),methods:{onItemClick:function(){this.$emit("on-item-click",this.itemIndex)},getItemAmount:function(){return""===this.itemAmoutName?this.itemData.busUnitAmount:this.itemData[this.itemAmoutName]}}},c=r,l=(i("3e54"),i("2877")),u=Object(l["a"])(c,o,s,!1,null,"70501ba1",null);e["a"]=u.exports},a09d:function(t,e,i){},add1:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("w-app-page",{staticClass:"item-search-block"},[i("w-header",{attrs:{title:"搜索品项",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("fx-search-bar",{attrs:{isSelectAll:t.isSelectAll,showSelectAllBtn:!t.isDisabled},on:{"on-select-click":t.onSelectAllClick},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}}),i("div",{ref:"details-content",staticClass:"item-list"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeStoreNames,callback:function(e){t.activeStoreNames=e},expression:"activeStoreNames"}},t._l(t.data,function(e){return i("van-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.storeShowComputed(e),expression:"storeShowComputed(storeItem)"}],key:e.id+"-"+e.shopHouseDTO.id,staticClass:"store-row",attrs:{name:e.id+"-"+e.shopHouseDTO.id}},[i("div",{staticClass:"item-store-title-container",attrs:{slot:"title"},slot:"title"},[i("w-icon",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&t.showScanCode,expression:"!isDisabled && showScanCode"}],attrs:{type:"camera"},on:{click:function(i){return t.onCameraClick(e)}}}),i("div",{staticClass:"item-store-title"},[i("span",{staticClass:"item-out-store-title fx-ellipsis"},[t._v("出库仓库："+t._s(e.name))]),i("span",{staticClass:"item-in-store-title fx-ellipsis"},[t._v("入库仓库："+t._s(e.shopHouseDTO.name))])])],1),t._l(t.detailFilter(e.details),function(o,s){return i("van-swipe-cell",{directives:[{name:"show",rawName:"v-show",value:"del"!==o.changeType,expression:"item.changeType !== 'del'"}],key:o.goodsDTO.id+"-"+s,ref:"details-row",refInFor:!0,staticClass:"item-row",attrs:{"right-width":80,disabled:t.isDisabled||t.focusing||!t.$fxAuth("distributionOutBill4cld.delDetail")}},[i("div",{staticClass:"item-cell"},[i("checkBox",{staticClass:"search-checkbox",attrs:{visibleFlag:!t.isDisabled,checked:o.checked},on:{"on-checkbox-click":function(e){return t.onCheckBoxClick(o)}}}),i("itemInfoCell",{staticClass:"search-info",attrs:{itemData:o,isDisabled:t.isDisabled,disabledEditBtn:t.focusing},on:{"on-item-edit":t.onSearchItemEdit,"on-unit-edit":t.onUnitEdit,"on-item-focus":t.onItemFocus,"on-item-blur":t.onItemBlur}})],1),i("div",{staticClass:"item-row-delete",attrs:{slot:"right"},on:{click:function(i){return t.onDeleteClick(o,s,e.details)}},slot:"right"},[t._v("删除")])])})],2)}),1)],1),i("w-bottom-btn-bar",[i("w-button",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],attrs:{size:"large",type:"primary"},on:{click:t.onSearchConfirm}},[t._v("保存")]),i("w-button",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],attrs:{size:"large",type:"danger"},on:{click:t.onSelectConfirm}},[t._v("删除")])],1),i("van-popup",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.itemRowEditPopShow,expression:"itemRowEditPopShow"}],staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,isDisabled:t.isDisabled},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e}}})],1),i("w-action-sheet",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.unitActionShow,expression:"unitActionShow"}],ref:"unitActionSheet",attrs:{actions:t.unitActions},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("w-action-sheet",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.scanActionShow,expression:"scanActionShow"}],ref:"scanActionSheet",attrs:{actions:t.scanActions},model:{value:t.scanActionShow,callback:function(e){t.scanActionShow=e},expression:"scanActionShow"}})],1)},s=[],n=(i("20d6"),i("768b")),a=(i("7f7f"),i("7514"),i("cebc")),r=(i("ac6a"),i("c5f6"),i("2f62")),c=i("033b"),l=i("cbca"),u=i("0f38"),d=["code","name","pinYin"],h={name:"itemSearchPop",components:{itemInfoCell:c["a"],itemRowEditPop:l["a"],checkBox:u["a"]},props:{data:{type:Array,default:function(){return[]}},isDisabled:Boolean,visibleFlag:Boolean,inShopId:{type:String,default:""},rdcId:{type:String,default:""},businessDate:{type:[String,Number],default:""},showScanCode:Boolean},data:function(){return{query:this.$route.query,focusing:!1,leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",searchKeywords:d,itemRowEditPopShow:!1,itemEditRowData:{},unitActions:[],unitActionShow:!1,activeStoreNames:[],scanActionShow:!1,scanActions:[{name:"累加数量"},{name:"覆盖数量"},{name:"追加"}],scanStoreItem:{}}},beforeDestroy:function(){this.$fxEventBus.$off("redCode",this.getItemByRedCode)},watch:{visibleFlag:{handler:function(t){var e=this;t?(this.searchKey="",this.data.forEach(function(t){var i=t.details.filter(function(t){return"del"!==t.changeType}).length;i>0&&e.activeStoreNames.push("".concat(t.id,"-").concat(t.shopHouseDTO.id))})):this.$dialog.close()},immediate:!0}},computed:Object(a["a"])({},Object(r["c"])({sysPointSize:"sysPointSize"}),{isSelectAll:function(){var t=this,e=0,i=0;return this.data.forEach(function(o){var s=t.detailFilter(o.details);e+=s.filter(function(t){return"del"!==t.changeType&&t.checked}).length,i+=s.length}),0!==e&&e===i}}),methods:{storeShowComputed:function(t){return this.detailFilter(t.details).length>0},detailFilter:function(t){var e=this;return t.filter(function(t){return"del"!==t.changeType&&!!e.searchKeywords.find(function(i){return e.$fxUtils.fuzzyQueryString(t.goodsDTO[i],e.searchKey)})})},onCloseClick:function(){if(this.focusing)return!1;this.$emit("update:visibleFlag",!1)},onDeleteClick:function(t,e,i){t.id?this.$set(t,"changeType","del"):i.splice(e,1)},onItemFocus:function(){this.focusing=!0},onItemBlur:function(){this.focusing=!1},onSearchItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onUnitEdit:function(t){var e=this;this.$fxApi("common.getItemUnit",t.goodsDTO.id).then(function(i){e.unitActions=i.units,e.$refs.unitActionSheet.doSelect(t.unitDTO.id).then(function(i){e.$fxCalculation("distributionOutBill4cld").changeUnit(t,i)})})},onSearchConfirm:function(){if(this.focusing)return!1;this.data.forEach(function(t){t.details.forEach(function(t){delete t.checked})}),this.$emit("on-search-confirm",this.data),this.$emit("update:visibleFlag",!1)},onCheckBoxClick:function(t){if(this.focusing)return!1;this.$set(t,"checked",!t.checked)},onSelectAllClick:function(){var t=this,e=!this.isSelectAll;this.data.forEach(function(i){var o=t.detailFilter(i.details);o.forEach(function(i){"del"!==i.changeType&&t.$set(i,"checked",e)})})},onSelectConfirm:function(){var t=this,e=this.data.find(function(t){return t.details.find(function(t){return t.checked&&"del"!==t.changeType})});if(!e)return this.$fxToast.top("请先选择品项!"),!0;this.$dialog.confirm({title:"提示",message:"是否删除？"}).then(function(){t.data.forEach(function(e){for(var i=e.details,o=i.length-1;o>=0;o--){var s=i[o];s.checked&&(s.id?t.$set(s,"changeType","del"):e.details.splice(o,1))}})})},onCameraClick:function(t){this.scanStoreItem=t,this.$fxEventBus.$on("redCode",this.getItemByRedCode),this.$dialog.alert({title:"请扫码",message:"当前出库仓库：".concat(t.name,"，入库仓库：").concat(t.shopHouseDTO.name),confirmButtonText:"取消扫码",beforeClose:function(t,e){this.$fxEventBus.$off("redCode",this.getItemByRedCode),e()}})},getItemByRedCode:function(t){var e=this;if(this.$dialog.close(),this.$fxEventBus.$off("redCode",this.getItemByRedCode),!this.visibleFlag)return!1;this.getItemByCode(t).then(function(t){if(0===t.length)return e.$fxToast.top("当前仓库无此品项!"),!1;e.getScanGoodData(t)})},getItemByCode:function(t){var e={billId:this.query.orderId||"",shopId:this.inShopId,rdcId:this.rdcId,outHouseId:this.scanStoreItem.id,inHouseId:this.scanStoreItem.shopHouseDTO.id,workDate:this.businessDate,barcode:t};return this.$fxApi("distributionOutBill4cld.scanCode")({data:e})},getScanGoodData:function(t){var e=this.setDataMoneyAndPrice(t),i=Object(n["a"])(e,1),o=i[0];o.busUnitOutAmount=o.adviseAmount,this.computedAssistAmount(o),this.setScanGood(o)},computedAssistAmount:function(t){t.assistUnitFlag&&(t.outAssistAmount=t.busUnitOutAmount)},setDataMoneyAndPrice:function(t){return t.forEach(function(t,e){t.goodsDTO={id:t.goodsId,imageUrls:t.goodsImgUrl?[t.goodsImgUrl]:[],name:t.goodsName,spec:t.goodsSpec,code:t.goodsCode,pinYin:t.goodsSign},t.unitDTO={id:t.unitId,name:t.unitName,value:t.unitValue},t.giftFlag=!1,t.price=t.salePrice,t.taxPrice=t.taxesPrice,t.outMoney=0,t.outMoneyWithTax=0,t.tax=t.taxes,t.taxOutMoney=0,t.costDispach=!1}),t},setScanGood:function(t){var e=this,i=this.scanStoreItem.details.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id});if(!~i)return this.$fxToast.fail("当前仓库无此品项！"),!1;var o=this.scanStoreItem.details.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id&&t.unitDTO.id===e.unitDTO.id});if(!~o)return this.$fxToast.fail("当前仓库无此品项！"),!1;var s=this.scanStoreItem.details[o],n=this.copyScanGood(t,s);s.batchCode!==n.batchCode&&this.$fxUtils.isDef(s.batchCode)?this.scanActions=[{name:"覆盖数量"},{name:"追加"}]:this.scanActions=[{name:"累加数量"},{name:"覆盖数量"}],this.$refs.scanActionSheet.doSelect().then(function(t){switch(t.name){case"累加数量":e.computedScanItemAmount(n,s),e.changeScanItem(n,o);break;case"覆盖数量":e.changeScanItem(n,o);break;case"追加":e.addScanItem(n);break}})},copyScanGood:function(t,e){var i=t.busUnitOutAmount,o=t.batchCode,s=this.$fxUtils.JSONcopy(e);return s.busUnitOutAmount=i,s.batchCode=o,this.computedAssistAmount(s),this.$fxCalculation("distributionOutBill4cld").changeAmount(s),s},computedScanItemAmount:function(t,e){var i=this.$fxUtils.toFixedParseNumber(t.busUnitOutAmount+e.busUnitOutAmount,this.sysPointSize);t.busUnitOutAmount=this.$fxCommon.checkAmountRange(i),this.$fxCalculation("distributionOutBill4cld").changeAmount(t)},addScanItem:function(t){t.id="",this.setChangeType(t),this.scanStoreItem.details.push(t)},changeScanItem:function(t,e){this.setChangeType(t),this.scanStoreItem.details.splice(e,1,t)},setChangeType:function(t){t.changeType=t.id?"edit":"add"}}},f=h,p=(i("812c"),i("2877")),m=Object(p["a"])(f,o,s,!1,null,"45f43dd0",null);e["a"]=m.exports},ba51:function(t,e,i){},bdf8:function(t,e,i){},c538:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-info-block fx-shadow-block"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},[i("van-collapse-item",{attrs:{name:"1",disabled:t.collapseDisabled}},[i("div",{staticClass:"info-title",attrs:{slot:"title"},slot:"title"},[i("span",{staticClass:"info-title-name"},[t._v("单据信息")]),i("span",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionOutBill4cld.sortingState"),expression:"$fxAuth('distributionOutBill4cld.sortingState')"}],staticClass:"stateTag fl-r"},[t._v(t._s(t.$fxStateMiddleware.getStateName("sortingState")(t.data.sortingState)))]),i("span",{staticClass:"stateTag fl-r"},[t._v(t._s(t.$fxStateMiddleware.getStateName("stateCld")(t.data.billStateFlag)))])]),i("van-tabs",{attrs:{animated:""},model:{value:t.tabActive,callback:function(e){t.tabActive=e},expression:"tabActive"}},[i("van-tab",{attrs:{title:"表头"}},[i("w-cell",{staticClass:"info-item",attrs:{title:"配送中心","is-link":!t.isDisabled},on:{click:function(e){return t.onEmitClick("on-rdc-click")}}},[t._v(t._s(t.data.rdcDTO&&t.data.rdcDTO.name))]),i("w-cell",{staticClass:"info-item",attrs:{title:"业务日期","is-link":!t.isDisabled},on:{click:t.onBusDateClick}},[t._v(t._s(t.formatterDate(t.data.businessDate)))]),i("w-cell",{staticClass:"info-item",attrs:{title:"门店","is-link":!t.isDisabled},on:{click:function(e){return t.onEmitClick("on-shop-click")}}},[t._v(t._s(t.data.inShopDTO&&t.data.inShopDTO.name))]),i("w-cell",{staticClass:"info-item",attrs:{title:"到货日期","is-link":!t.isDisabled},on:{click:function(e){return t.onEmitClick("on-arriveDate-click")}}},[t._v(t._s(t.formatterDate(t.data.arriveDate)))]),i("w-cell",{staticClass:"info-item",attrs:{title:"单据类型","is-link":!t.isDisabled},on:{click:function(e){return t.onEmitClick("on-billType-click")}}},[t._v(t._s(t.data.businessTypeDTO&&t.data.businessTypeDTO.name))]),i("van-pro-field",{staticClass:"info-item",attrs:{label:"整单备注",placeholder:t.isDisabled?"":"请输入整单备注","input-align":"right",maxlength:"50",disabled:t.isDisabled},model:{value:t.data.billMemo,callback:function(e){t.$set(t.data,"billMemo",e)},expression:"data.billMemo"}})],1),i("van-tab",{attrs:{title:"更多"}},[i("w-cell",{staticClass:"info-item",attrs:{title:"制单人"}},[t._v(t._s(t.data.billEmp))]),i("w-cell",{staticClass:"info-item",attrs:{title:"制单日期"}},[t._v(t._s(t.formatterDate(t.data.billDate)))]),i("w-cell",{staticClass:"info-item",attrs:{title:"审核人"}},[t._v(t._s(t.data.checkEmp))]),i("w-cell",{staticClass:"info-item",attrs:{title:"审核日期"}},[t._v(t._s(t.formatterDate(t.data.checkDate)))]),i("van-pro-number-field",{staticClass:"info-item info-number",attrs:{label:"整单运费","input-align":"right",min:"0",defaultValue:0,max:t.maxAmount,intLength:t.numberLength,pointSize:t.sysPointSize,disabled:t.isDisabled||!t.$fxSysAuth("distributionOutBill4cld.editFreight")},model:{value:t.data.freight,callback:function(e){t.$set(t.data,"freight",e)},expression:"data.freight"}})],1)],1)],1)],1)],1)},s=[],n=i("cebc"),a=i("2f62"),r={name:"orderInfo",props:{data:{type:Object,default:function(){return{}}},isDisabled:Boolean,collapseDisabled:Boolean},data:function(){return{activeNames:["1"],tabActive:0}},computed:Object(n["a"])({},Object(a["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",maxAmount:"maxAmount"}),{formatterDate:function(t){var e=this;return function(t){return"number"===typeof t?e.$fxUtils.setDateTime(new Date(t),"时分"):""}},hasBillType:function(){return this.data.businessTypeDTO&&this.data.businessTypeDTO.id}}),methods:{onEmitClick:function(t){if(this.isDisabled)return!1;this.$emit(t)},closeCollapse:function(){this.activeNames=[]},onBusDateClick:function(){this.onEmitClick("on-busdate-click")}}},c=r,l=(i("e275"),i("2877")),u=Object(l["a"])(c,o,s,!1,null,"132e798c",null);e["a"]=u.exports},cbca:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("fx-item-row-edit",{attrs:{title:t.itemData.goodsDTO.name},on:{"on-back":t.onConfirmClick}},[i("van-cell-group",[i("w-cell",{attrs:{title:"应发数量"}},[t._v(t._s(t.itemData.shouldDeliverAmount||0))]),i("w-cell",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionOutBill4cld.seePriceMoney"),expression:"$fxAuth('distributionOutBill4cld.seePriceMoney')"}],attrs:{title:"成本单价"}},[t._v(t._s(t.itemData.costPrice))]),i("w-cell",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionOutBill4cld.seePriceMoney"),expression:"$fxAuth('distributionOutBill4cld.seePriceMoney')"}],attrs:{title:"成本金额"}},[t._v(t._s(t.itemData.costMoney))]),i("w-cell",{attrs:{title:"成本价配送"}},[i("w-switch",{attrs:{disabled:t.isDisabled,type:"normal"},model:{value:t.itemData.costDispatch,callback:function(e){t.$set(t.itemData,"costDispatch",e)},expression:"itemData.costDispatch"}})],1),i("van-pro-number-field",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionOutBill4cld.seePriceMoney"),expression:"$fxAuth('distributionOutBill4cld.seePriceMoney')"}],attrs:{label:"非税配送单价","input-align":"right",min:"0",defaultValue:0,max:t.maxAmount,intLength:t.numberLength,pointSize:t.sysMoneyPointSize,disabled:t.isDisabled||t.costDispatched||t.gived||!t.itemData.canChangePriceFlag},on:{change:t.onPriceChange},model:{value:t.itemData.price,callback:function(e){t.$set(t.itemData,"price",e)},expression:"itemData.price"}}),i("w-cell",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionOutBill4cld.seePriceMoney"),expression:"$fxAuth('distributionOutBill4cld.seePriceMoney')"}],attrs:{title:"非税配送金额"}},[t._v(t._s(t.itemData.outMoney))]),i("w-cell",{attrs:{title:"规格"}},[t._v(t._s(t.itemData.goodsDTO.spec))]),i("w-cell",{attrs:{title:"税率","is-link":!t.isDisabled,disabled:t.isDisabled||t.costDispatched||!t.itemData.canChangeTaxFlag},on:{click:t.onTaxClick}},[t._v(t._s(t.fomatterTaxes(t.itemData.tax)))]),i("van-pro-number-field",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionOutBill4cld.seePriceMoney"),expression:"$fxAuth('distributionOutBill4cld.seePriceMoney')"}],attrs:{label:"含税配送单价","input-align":"right",min:"0",defaultValue:0,max:t.maxAmount,intLength:t.numberLength,pointSize:t.sysMoneyPointSize,disabled:t.isDisabled||t.costDispatched||t.gived||!t.itemData.canChangePriceFlag},on:{change:t.onTaxPriceChange},model:{value:t.itemData.taxPrice,callback:function(e){t.$set(t.itemData,"taxPrice",e)},expression:"itemData.taxPrice"}}),i("w-cell",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionOutBill4cld.seePriceMoney"),expression:"$fxAuth('distributionOutBill4cld.seePriceMoney')"}],attrs:{title:"含税配送金额"}},[t._v(t._s(t.itemData.outMoneyWithTax))]),i("w-cell",{attrs:{title:"税额"}},[t._v(t._s(t.itemData.taxOutMoney))]),i("w-cell",{attrs:{title:"品项编号"}},[t._v(t._s(t.itemData.goodsDTO.code))]),i("w-cell",{attrs:{title:"赠送"}},[i("w-switch",{attrs:{disabled:t.isDisabled,type:"normal"},on:{change:t.changeGiftFlag},model:{value:t.itemData.giftFlag,callback:function(e){t.$set(t.itemData,"giftFlag",e)},expression:"itemData.giftFlag"}})],1),i("w-cell",{attrs:{title:"批次号","is-clear":!!t.itemData.batchCode&&!t.isDisabled&&t.$fxAuth("distributionOutBill4cld.editBatchCode"),disabled:t.isDisabled},on:{"on-clear":t.onBatchCodeClear}},[t._v(t._s(t.itemData.batchCode))]),i("van-pro-field",{ref:"memo",attrs:{placeholder:t.setPlaceholder("请输入备注"),disabled:t.isDisabled,label:"备注","input-align":"right"},on:{focus:function(e){return t.onFocus("memo")}},model:{value:t.itemData.memo,callback:function(e){t.$set(t.itemData,"memo",e)},expression:"itemData.memo"}}),i("w-cell",{attrs:{title:"称重异常"}},[t._v(t._s(t.itemData.shortageFlag))])],1),t.isDisabled?t._e():i("w-button",{attrs:{slot:"bottom-btn",size:"large",type:"primary"},on:{click:t.onConfirmClick},slot:"bottom-btn"},[t._v("保存\n\t")]),i("taxesActionSheet",{attrs:{sync:!0},on:{"on-taxes-select":t.onTaxesSelect},model:{value:t.taxesActionShow,callback:function(e){t.taxesActionShow=e},expression:"taxesActionShow"}})],1)},s=[],n=i("cebc"),a=i("2f62"),r=i("f729"),c={name:"itemRowEdit",components:{taxesActionSheet:r["a"]},props:{visibleFlag:Boolean,itemData:{type:Object,default:function(){return{}}},isDisabled:Boolean},data:function(){return{taxesActionShow:!1}},computed:Object(n["a"])({},Object(a["c"])({sysMoneyPointSize:"sysMoneyPointSize",numberLength:"numberLength",maxAmount:"maxAmount"}),{fomatterTaxes:function(t){return function(t){return t?"".concat(t,"%"):"0%"}},setPlaceholder:function(t){var e=this;return function(t){return e.isDisabled?"":t}},costDispatched:function(){return this.itemData.costDispatch},gived:function(){return this.itemData.giftFlag}}),methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onConfirmClick:function(){this.itemData.id&&(this.itemData.changeType="edit"),this.$emit("on-Confirm",this.itemData),this.$emit("update:visibleFlag",!1)},changeGiftFlag:function(t){this.$fxCalculation("distributionOutBill4cld").giftChange(this.itemData)},onFocus:function(t){this.$fxUtils.doScrollTop(this.$refs[t].$el)},onPriceChange:function(){this.$fxCalculation("distributionOutBill4cld").changePrice(this.itemData)},onTaxPriceChange:function(){this.$fxCalculation("distributionOutBill4cld").changePriceWithTax(this.itemData)},onTaxClick:function(){this.taxesActionShow=!0},onTaxesSelect:function(t){this.itemData.tax=this.$fxUtils.toFixedParseNumber(100*t.tax,2,!1),this.$fxCalculation("distributionOutBill4cld").changeTaxes(this.itemData),this.taxesActionShow=!1},onBatchCodeClear:function(){this.itemData.batchCode=""}}},l=c,u=i("2877"),d=Object(u["a"])(l,o,s,!1,null,null,null);e["a"]=d.exports},d2f2:function(t,e,i){},d346:function(t,e,i){},d444:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"add-item-class-content fx-vant-class-collapse"},[i("div",{staticClass:"all-class",class:{"is-active":""===t.value},on:{click:function(e){return e.stopPropagation(),t.selectClass("")}}},[t._v(t._s(t.classTitle))]),i("van-collapse",{attrs:{accordion:!0},model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},t._l(t.itemClassList,function(e){return i("van-collapse-item",{key:e.id,attrs:{name:e.id}},[i("div",{staticClass:"big-class",attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),t._l(e.smallType,function(e){return i("van-cell",{key:e.id,staticClass:"small-class",class:{"is-active":t.value===e.id},attrs:{title:e.name},on:{click:function(i){return i.stopPropagation(),t.selectClass(e.id)}}})})],2)}),1)],1)},s=[],n=(i("c5f6"),{name:"addItemClassList",props:{value:[String,Number],itemClassList:{type:Array,default:function(){return[]}},classTitle:{type:String,default:"全部品项"}},data:function(){return{activeNames:[]}},methods:{selectClass:function(t){this.$emit("input",t),this.$emit("on-select-class",t),this.$emit("on-change-class",[t,this.value])}}}),a=n,r=(i("5402"),i("2877")),c=Object(r["a"])(a,o,s,!1,null,"df69e854",null);e["a"]=c.exports},d7c9:function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("w-app-page",[i("w-header",{attrs:{title:"新增中心统配出库单",border:!0}}),i("orderInfo",{ref:"orderInfo",attrs:{data:t.orderInfoData},on:{"on-shop-click":t.onInShopClick,"on-rdc-click":t.onRdcClick,"on-busdate-click":t.onBusinessDateClick,"on-arriveDate-click":t.onArriveDateClick,"on-billType-click":t.onBillTypeClick,"on-item-clear":t.onItemClear,"on-billType-clear":t.onBillTypeClear}}),i("orderItem",{attrs:{data:t.orderItemList,itemInputFocusing:t.itemInputFocusing,showAddItemBtn:!0,inShopId:t.orderInfoData.inShopDTO&&t.orderInfoData.inShopDTO.id,rdcId:t.orderInfoData.rdcDTO&&t.orderInfoData.rdcDTO.id},on:{"update:itemInputFocusing":function(e){t.itemInputFocusing=e},"update:item-input-focusing":function(e){t.itemInputFocusing=e},"on-add-click":t.onAddClick,"on-search-click":t.onSearchClick,"on-item-edit":t.onItemEdit}}),i("w-bottom-btn-bar",[i("w-button",{attrs:{size:"large",type:"primary"},on:{click:t.onCreateClick}},[t._v("生成单据\n\t\t")])],1),i("van-popup",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.rdcPopShow,expression:"rdcPopShow"}],staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.rdcPopShow,callback:function(e){t.rdcPopShow=e},expression:"rdcPopShow"}},[i("listComp",{attrs:{visibleFlag:t.rdcPopShow,data:t.rdcList,loadFinished:!0,title:"请选择配送中心"},on:{"update:visibleFlag":function(e){t.rdcPopShow=e},"update:visible-flag":function(e){t.rdcPopShow=e},"on-search":t.searchRdc,"on-select":t.selectRdc}})],1),i("van-popup",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.inShopPopShow,expression:"inShopPopShow"}],staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.inShopPopShow,callback:function(e){t.inShopPopShow=e},expression:"inShopPopShow"}},[i("listComp",{attrs:{visibleFlag:t.inShopPopShow,data:t.inShopList,loadFinished:!0,title:"请选择门店"},on:{"update:visibleFlag":function(e){t.inShopPopShow=e},"update:visible-flag":function(e){t.inShopPopShow=e},"on-search":t.searchInShop,"on-select":t.selectInShop}})],1),i("van-popup",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.datePickerShow,expression:"datePickerShow"}],attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.billTypePopShow,expression:"billTypePopShow"}],staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.billTypePopShow,callback:function(e){t.billTypePopShow=e},expression:"billTypePopShow"}},[i("listComp",{attrs:{visibleFlag:t.billTypePopShow,data:t.billTypeList,loadFinished:!0,title:"单据类型检索"},on:{"update:visibleFlag":function(e){t.billTypePopShow=e},"update:visible-flag":function(e){t.billTypePopShow=e},"on-search":t.searchBillType,"on-select":t.selectBillType}})],1),i("van-popup",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.itemStorePopShow,expression:"itemStorePopShow"}],staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemStorePopShow,callback:function(e){t.itemStorePopShow=e},expression:"itemStorePopShow"}},[i("storeItemComp",{attrs:{visibleFlag:t.itemStorePopShow,storeItemData:t.storeItem,inShopId:t.orderInfoData.inShopDTO&&t.orderInfoData.inShopDTO.id,rdcId:t.orderInfoData.rdcDTO&&t.orderInfoData.rdcDTO.id,businessDate:t.orderInfoData.businessDate},on:{"update:visibleFlag":function(e){t.itemStorePopShow=e},"update:visible-flag":function(e){t.itemStorePopShow=e},"on-save":t.onStoreItemSave,"on-select-store":t.onStoreItemSelect}})],1),i("van-popup",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.itemPopShow,expression:"itemPopShow"}],staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemPopShow,callback:function(e){t.itemPopShow=e},expression:"itemPopShow"}},[i("itemEditComp",{attrs:{visibleFlag:t.itemPopShow,inShopId:t.orderInfoData.inShopDTO&&t.orderInfoData.inShopDTO.id,rdcId:t.orderInfoData.rdcDTO&&t.orderInfoData.rdcDTO.id,shopHouseDTO:t.currentShopHouseObj,outHouse:t.currentOutHouseObj,businessDate:t.orderInfoData.businessDate,parentStoreItem:t.getStoreItem()},on:{"update:visibleFlag":function(e){t.itemPopShow=e},"update:visible-flag":function(e){t.itemPopShow=e},"on-confirm":t.onItemEditConfirm}})],1),i("van-popup",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.itemRowEditPopShow,expression:"itemRowEditPopShow"}],staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e}}})],1),i("van-popup",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.itemSearchPopShow,expression:"itemSearchPopShow"}],staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemSearchPopShow,callback:function(e){t.itemSearchPopShow=e},expression:"itemSearchPopShow"}},[i("itemSearchPop",{attrs:{visibleFlag:t.itemSearchPopShow,data:t.searchItem},on:{"update:visibleFlag":function(e){t.itemSearchPopShow=e},"update:visible-flag":function(e){t.itemSearchPopShow=e},"on-search-confirm":t.onSearchConfirm}})],1)],1)},s=[],n=(i("20d6"),i("768b")),a=(i("7514"),i("5176")),r=i.n(a),c=i("75fc"),l=(i("ac6a"),i("a481"),i("f499")),u=i.n(l),d=i("795b"),h=i.n(d),f=i("cebc"),p=i("2f62"),m=i("c538"),b=i("5398"),v=i("f6bb"),S=i("fd122"),g=i("cbca"),w=i("add1"),D=i("8d60"),k={name:"createUniformDistributionOut",components:{orderInfo:m["a"],orderItem:b["a"],listComp:v["a"],storeItemComp:S["a"],itemRowEditPop:g["a"],itemSearchPop:w["a"],itemEditComp:D["a"]},data:function(){return{query:this.$route.query,orderInfoData:{},orderItemList:[],dateType:"business",currentDate:new Date,inShopPopShow:!1,inShopList:[],rdcPopShow:!1,rdcList:[],datePickerShow:!1,billTypePopShow:!1,billTypeList:[],itemStorePopShow:!1,storeItem:[],itemRowEditPopShow:!1,itemEditRowData:{},itemSearchPopShow:!1,searchItem:[],currentShopHouseObj:{},currentOutHouseObj:{},itemPopShow:!1,itemInputFocusing:!1,backAbsolute:!1}},computed:Object(f["a"])({},Object(p["c"])({sysPointSize:"sysPointSize",sysMoneyPointSize:"sysMoneyPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerShopName:function(t){return t.loginer.loginerShopName},loginerId:function(t){return t.loginer.loginerId},disOut_arrivalIntervalTime:function(t){return t.systemParamsCld.disOut_arrivalIntervalTime}})),created:function(){this.getBillOtherAuth().then(this.initDefaultOrderData)},beforeRouteLeave:function(t,e,i){var o=this;if(this.itemInputFocusing)return this.$router.go(1),!1;"/distributionOutBill4cld"!==t.path||0===this.orderItemList.length||this.backAbsolute?i():this.$dialog.confirm({title:"提示",message:"当前单据未生成<br/>是否生成单据?"}).then(function(){return o.$router.go(1),o.verifyCreateBill().then(function(){var t=o.getSaveParams();o.createHandler(t)}),!1}).catch(function(){i()})},methods:{initDefaultOrderData:function(){this.orderInfoData={accountDTO:{},arriveDate:(new Date).getTime()+this.$fxUtils.h2ms(this.disOut_arrivalIntervalTime),billEmp:"",billMemo:"",billState:0,businessDate:(new Date).getTime(),businessTypeDTO:{id:"0430_0020_0100",name:"中心统配出库单"},inShopDTO:{},rdcDTO:{id:this.loginerShopId,name:this.loginerShopName},details:[],updateIndicator:"Append",expressFlag:!1,freight:0}},getBillOtherAuth:function(){var t=this;return this.$fxApi("distributionOutBill4cld.getBillOtherAuth","0").then(function(e){return t.$store.commit({type:"EXTEND_AUTH",billAuth:e.functionMapData[0]}),h.a.resolve(e)})},clearItemConfirm:function(t){var e=this;return new h.a(function(i){var o=e.orderItemList.filter(function(t){var e=t.details.filter(function(t){return"del"!==t.changeType});return 0!==e.length});0===o.length?i():e.$dialog.confirm({title:"提示",message:t}).then(function(){e.onItemClear(),i()}).catch(function(){})})},onInShopClick:function(){if(!this.orderInfoData.rdcDTO.id)return this.$fxToast.top("请先选择配送中心!"),!1;this.onInShopRefresh()},searchInShop:function(t){this.onInShopRefresh(t)},selectInShop:function(t){var e=this;this.checkInShop(t).then(function(){e.clearItemConfirm("更换门店会清空品项,是否继续?").then(function(){e.orderInfoData.inShopDTO=t})})},checkInShop:function(t){var e=this;return new h.a(function(i){var o=e.orderInfoData.inShopDTO;o.id!==t.id&&i()})},onInShopRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getInShopListData(e).then(function(e){t.inShopList=e.shops,t.inShopPopShow=!0})},getInShopListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e={pid:this.orderInfoData.rdcDTO.id,keyword:t};return this.$fxApi("distributionOutBill4cld.getInShopListData")({data:e})},onRdcClick:function(){this.onRdcRefresh()},searchRdc:function(t){this.onRdcRefresh(t)},selectRdc:function(t){var e=this;this.checkRdc(t).then(function(){e.clearItemConfirm("修改配送中心将清空发货仓库、门店和单据明细，是否继续?").then(function(){e.orderInfoData.rdcDTO=t,e.orderInfoData.inShopDTO={}})})},checkRdc:function(t){var e=this;return new h.a(function(i){var o=e.orderInfoData.rdcDTO;o.id!==t.id&&i()})},onRdcRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getRdcListData(e).then(function(e){t.rdcList=e.shops,t.rdcPopShow=!0})},getRdcListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e={keyword:t,selAll:"on"};return this.$fxApi("distributionOutBill4cld.getRdcListData")({data:e})},onBillTypeClick:function(){this.onBillTYpeRefresh()},searchBillType:function(t){this.onBillTYpeRefresh(t)},selectBillType:function(t){this.orderInfoData.businessTypeDTO=t},onBillTypeClear:function(){this.orderInfoData.businessTypeDTO={}},onBillTYpeRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getBillTypeListData(e).then(function(e){t.billTypeList=e.businessTypes,t.billTypePopShow=!0})},getBillTypeListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e={m:"list4DistributionOutListBillEdit",keyword:t};return this.$fxApi("distributionOutBill4cld.getBillTypeListData")({data:e})},onBusinessDateClick:function(){this.dateType="business",this.orderInfoData.businessDate&&(this.currentDate=new Date(this.orderInfoData.businessDate)),this.datePickerShow=!0},onArriveDateClick:function(){this.dateType="arrive",this.orderInfoData.arriveDate&&(this.currentDate=new Date(this.orderInfoData.arriveDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){var e=t.getTime();"business"===this.dateType?(this.orderInfoData.businessDate=e,this.orderInfoData.arriveDate=e+this.$fxUtils.h2ms(this.disOut_arrivalIntervalTime)):this.orderInfoData.arriveDate=e,this.datePickerShow=!1},onAddClick:function(){var t=this;this.checkOrderInfo().then(function(){t.storeItem=JSON.parse(u()(t.orderItemList)),t.itemStorePopShow=!0})},checkOrderInfo:function(){var t=this;return new h.a(function(e,i){t.orderInfoData.businessDate?t.orderInfoData.rdcDTO.id?t.orderInfoData.inShopDTO.id?t.orderInfoData.businessTypeDTO.id?e():t.$fxToast.top("请先选择单据类型!"):t.$fxToast.top("请先选择门店!"):t.$fxToast.top("请先选择配送中心!"):t.$fxToast.top("请先选择业务日期!")})},onStoreItemSave:function(t){this.orderInfoData.details=t,this.orderItemList=this.orderInfoData.details},verifyCreateBill:function(){var t=this;return new h.a(function(e){if(0===t.getValidItem().length)return t.onAddClick(),!1;e()})},onCreateClick:function(){var t=this;if(this.itemInputFocusing)return!1;this.verifyCreateBill().then(function(){t.$dialog.confirm({title:"提示",message:"确定生成单据吗?"}).then(function(){var e=t.getSaveParams();t.createHandler(e)})})},createHandler:function(t){var e=this;this.$fxApi("distributionOutBill4cld.createOrder")({data:t}).then(function(t){e.$fxToast.success("生成单据成功").then(function(){e.$router.replace({path:"distributionOutBill4cldDetails",query:{orderId:t.storeBills[0].id}})})})},getSaveParams:function(){var t=[];this.orderItemList.forEach(function(e){t.push.apply(t,Object(c["a"])(e.details))});var e=t.filter(function(t){return"add"===t.changeType}),i=r()({},this.orderInfoData,{detailAdd:e,accountDTO:{id:this.loginerId},houseDTO:JSON.parse(u()(e[0].outHouseDTO))});return i},getValidItem:function(){var t=[];return this.orderItemList.forEach(function(e){t.push.apply(t,Object(c["a"])(e.details))}),t},onItemClear:function(){this.orderInfoData.details=[],this.orderItemList=this.orderInfoData.details},onItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onSearchClick:function(){this.itemSearchPopShow=!0,this.searchItem=JSON.parse(u()(this.orderItemList))},onSearchConfirm:function(t){this.orderItemList=t},onStoreItemSelect:function(t,e){this.currentOutHouseObj=t,this.currentShopHouseObj=e,this.itemPopShow=!0},getStoreItem:function(){var t=this;if(this.$fxUtils.isEmptyObjSHW(this.currentShopHouseObj)||this.$fxUtils.isEmptyObjSHW(this.currentOutHouseObj))return[];var e=this.orderItemList.find(function(e){return e.shopHouseDTO.id===t.currentShopHouseObj.id&&e.id===t.currentOutHouseObj.id});return e?e.details:[]},onItemEditConfirm:function(t){var e=this,i=Object(n["a"])(t,3),o=i[0],s=i[1],a=i[2],c=this.orderItemList.find(function(t){return t.id===s.id&&t.shopHouseDTO.id===a.id});if(c)if(this.$fxAuth("distributionOutBill4cld.inputMultipleDetails")){var l=c.details.filter(function(t){var i=o.findIndex(function(i){return i.goodsDTO.id===t.goodsDTO.id&&i.unitDTO.id===t.unitDTO.id&&i.batchCode===t.batchCode&&e.$fxUtils.isDef(t.batchCode)});return!~i});c.details=o.concat(l)}else c.details=o;else{var u=r()({},s);u.shopHouseDTO=a,u.details=o,this.orderItemList.push(u)}}}},I=k,C=i("2877"),x=Object(C["a"])(I,o,s,!1,null,null,null);e["default"]=x.exports},dab9:function(t,e,i){"use strict";var o=i("a09d"),s=i.n(o);s.a},e275:function(t,e,i){"use strict";var o=i("251d"),s=i.n(o);s.a},f127:function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("w-app-page",[i("w-header",{attrs:{title:t.orderInfoData.sysbillCode,titleFontSize:"3.733vw",border:!0}}),i("orderInfo",{ref:"orderInfo",attrs:{data:t.orderInfoData,isDisabled:t.isBillState(["unCheck","checked"])||t.isBillSortingState(["sorting"])||!t.$fxAuth("distributionOutBill4cld.save")},on:{"on-shop-click":t.onInShopClick,"on-rdc-click":t.onRdcClick,"on-busdate-click":t.onBusinessDateClick,"on-arriveDate-click":t.onArriveDateClick,"on-billType-click":t.onBillTypeClick,"on-item-clear":t.onItemClear,"on-billType-clear":t.onBillTypeClear}}),i("orderItem",{ref:"orderItem",attrs:{data:t.orderItemList,isDisabled:t.isBillState(["unCheck","checked"])||t.isBillSortingState(["sorting"])||!t.$fxAuth("distributionOutBill4cld.save"),itemInputFocusing:t.itemInputFocusing,showAddItemBtn:t.isHandCreate,inShopId:t.orderInfoData.inShopDTO&&t.orderInfoData.inShopDTO.id,rdcId:t.orderInfoData.rdcDTO&&t.orderInfoData.rdcDTO.id},on:{"update:itemInputFocusing":function(e){t.itemInputFocusing=e},"update:item-input-focusing":function(e){t.itemInputFocusing=e},"on-add-click":t.onAddClick,"on-search-click":t.onSearchClick,"on-item-edit":t.onItemEdit,"on-item-focus":t.onItemFocus}}),i("w-bottom-btn-bar",[i("w-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillState(["unSubmit","returned"])&&t.$fxAuth("distributionOutBill4cld.del"),expression:"isBillState(['unSubmit', 'returned']) && $fxAuth('distributionOutBill4cld.del')"}],attrs:{size:"large",type:"danger"},on:{click:function(e){return t.onClickHandler("onDeleteClick")}}},[t._v("删除")]),i("w-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillState("unCheck")&&t.$fxAuth("distributionOutBill4cld.drawback"),expression:"isBillState('unCheck') && $fxAuth('distributionOutBill4cld.drawback')"}],attrs:{size:"large",type:"danger"},on:{click:function(e){return t.onClickHandler("onReturnClick")}}},[t._v("退回")]),i("w-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillReState("unRecheck")&&t.isBillState("checked")&&t.$fxAuth("distributionOutBill4cld.unCheck"),expression:"isBillReState('unRecheck') && isBillState('checked') && $fxAuth('distributionOutBill4cld.unCheck')"}],attrs:{size:"large",type:"danger"},on:{click:function(e){return t.onClickHandler("onUnExpressClick")}}},[t._v("反审")]),i("w-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillReState("rechecked")&&t.$fxAuth("distributionOutBill4cld.unReCheck"),expression:"isBillReState('rechecked') && $fxAuth('distributionOutBill4cld.unReCheck')"}],attrs:{size:"large",type:"danger"},on:{click:function(e){return t.onClickHandler("onUnExpressAgainClick")}}},[t._v("取消复审")]),i("w-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillState(["unCheck","unSubmit","returned"])&&t.$fxAuth("distributionOutBill4cld.check"),expression:"isBillState(['unCheck', 'unSubmit', 'returned']) && $fxAuth('distributionOutBill4cld.check')"}],attrs:{size:"large",type:"info"},on:{click:function(e){return t.onClickHandler("onExpressClick")}}},[t._v("审核")]),i("w-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillState(["unSubmit","returned"])&&t.$fxAuth("distributionOutBill4cld.submit"),expression:"isBillState(['unSubmit', 'returned']) && $fxAuth('distributionOutBill4cld.submit')"}],attrs:{size:"large",type:"info"},on:{click:function(e){return t.onClickHandler("onSubmitClick")}}},[t._v("提交")]),i("w-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillState(["unSubmit","returned"])&&t.$fxAuth("distributionOutBill4cld.save"),expression:"isBillState(['unSubmit', 'returned']) && $fxAuth('distributionOutBill4cld.save')"}],attrs:{size:"large",type:"primary"},on:{click:function(e){return t.onClickHandler("onSaveClick")}}},[t._v("保存")]),i("w-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillReState("unRecheck")&&t.isBillState("checked")&&t.$fxAuth("distributionOutBill4cld.reCheck"),expression:"isBillReState('unRecheck') && isBillState('checked') && $fxAuth('distributionOutBill4cld.reCheck')"}],attrs:{size:"large",type:"info"},on:{click:function(e){return t.onClickHandler("onExpressAgainClick")}}},[t._v("复审")]),i("w-button",{directives:[{name:"show",rawName:"v-show",value:!t.isBillState("checked")&&t.$fxAuth("distributionOutBill4cld.sorting"),expression:"!isBillState('checked') && $fxAuth('distributionOutBill4cld.sorting')"}],attrs:{size:"large",type:"info"},on:{click:function(e){return t.onClickHandler("onSortingClick")}}},[t._v("分拣")])],1),i("van-popup",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.rdcPopShow,expression:"rdcPopShow"}],staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.rdcPopShow,callback:function(e){t.rdcPopShow=e},expression:"rdcPopShow"}},[i("listComp",{attrs:{visibleFlag:t.rdcPopShow,data:t.rdcList,loadFinished:!0,title:"请选择配送中心"},on:{"update:visibleFlag":function(e){t.rdcPopShow=e},"update:visible-flag":function(e){t.rdcPopShow=e},"on-search":t.searchRdc,"on-select":t.selectRdc}})],1),i("van-popup",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.inShopPopShow,expression:"inShopPopShow"}],staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.inShopPopShow,callback:function(e){t.inShopPopShow=e},expression:"inShopPopShow"}},[i("listComp",{attrs:{visibleFlag:t.inShopPopShow,data:t.inShopList,loadFinished:!0,title:"请选择门店"},on:{"update:visibleFlag":function(e){t.inShopPopShow=e},"update:visible-flag":function(e){t.inShopPopShow=e},"on-search":t.searchInShop,"on-select":t.selectInShop}})],1),i("van-popup",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.datePickerShow,expression:"datePickerShow"}],attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.billTypePopShow,expression:"billTypePopShow"}],staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.billTypePopShow,callback:function(e){t.billTypePopShow=e},expression:"billTypePopShow"}},[i("listComp",{attrs:{visibleFlag:t.billTypePopShow,data:t.billTypeList,loadFinished:!0,title:"单据类型检索"},on:{"update:visibleFlag":function(e){t.billTypePopShow=e},"update:visible-flag":function(e){t.billTypePopShow=e},"on-search":t.searchBillType,"on-select":t.selectBillType}})],1),i("van-popup",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.itemStorePopShow,expression:"itemStorePopShow"}],staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemStorePopShow,callback:function(e){t.itemStorePopShow=e},expression:"itemStorePopShow"}},[i("storeItemComp",{attrs:{visibleFlag:t.itemStorePopShow,storeItemData:t.storeItem,autoType:t.orderInfoData.autoType,inShopId:t.orderInfoData.inShopDTO&&t.orderInfoData.inShopDTO.id,rdcId:t.orderInfoData.rdcDTO&&t.orderInfoData.rdcDTO.id,businessDate:t.orderInfoData.businessDate},on:{"update:visibleFlag":function(e){t.itemStorePopShow=e},"update:visible-flag":function(e){t.itemStorePopShow=e},"on-save":t.onStoreItemSave,"on-select-store":t.onStoreItemSelect}})],1),i("van-popup",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.itemPopShow,expression:"itemPopShow"}],staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemPopShow,callback:function(e){t.itemPopShow=e},expression:"itemPopShow"}},[i("itemEditComp",{attrs:{visibleFlag:t.itemPopShow,inShopId:t.orderInfoData.inShopDTO&&t.orderInfoData.inShopDTO.id,rdcId:t.orderInfoData.rdcDTO&&t.orderInfoData.rdcDTO.id,shopHouseDTO:t.currentShopHouseObj,outHouse:t.currentOutHouseObj,businessDate:t.orderInfoData.businessDate,parentStoreItem:t.getStoreItem()},on:{"update:visibleFlag":function(e){t.itemPopShow=e},"update:visible-flag":function(e){t.itemPopShow=e},"on-confirm":t.onItemEditConfirm}})],1),i("van-popup",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.itemRowEditPopShow,expression:"itemRowEditPopShow"}],staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,isDisabled:t.isBillState(["unCheck","checked"])||!t.$fxAuth("distributionOutBill4cld.save")},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e}}})],1),i("van-popup",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.itemSearchPopShow,expression:"itemSearchPopShow"}],staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemSearchPopShow,callback:function(e){t.itemSearchPopShow=e},expression:"itemSearchPopShow"}},[i("itemSearchPop",{attrs:{visibleFlag:t.itemSearchPopShow,data:t.searchItem,inShopId:t.orderInfoData.inShopDTO&&t.orderInfoData.inShopDTO.id,rdcId:t.orderInfoData.rdcDTO&&t.orderInfoData.rdcDTO.id,isDisabled:t.isBillState(["unCheck","checked"])||!t.$fxAuth("distributionOutBill4cld.save"),showScanCode:!t.isHandCreate,businessDate:t.orderInfoData.businessDate},on:{"update:visibleFlag":function(e){t.itemSearchPopShow=e},"update:visible-flag":function(e){t.itemSearchPopShow=e},"on-search-confirm":t.onSearchConfirm}})],1),i("w-action-sheet",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.checkActionSheetShow,expression:"checkActionSheetShow"}],ref:"checkActionSheet",attrs:{actions:t.checkActions},model:{value:t.checkActionSheetShow,callback:function(e){t.checkActionSheetShow=e},expression:"checkActionSheetShow"}}),i("w-action-sheet",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.sortingActionSheetShow,expression:"sortingActionSheetShow"}],ref:"sortingActionSheet",attrs:{actions:t.sortingCheckActions},model:{value:t.sortingActionSheetShow,callback:function(e){t.sortingActionSheetShow=e},expression:"sortingActionSheetShow"}})],1)},s=[],n=(i("20d6"),i("768b")),a=(i("7514"),i("59ad")),r=i.n(a),c=i("5176"),l=i.n(c),u=i("75fc"),d=i("f499"),h=i.n(d),f=(i("ac6a"),i("b6d0")),p=i.n(f),m=i("774e"),b=i.n(m),v=i("795b"),S=i.n(v),g=i("cebc"),w=i("2f62"),D=i("c538"),k=i("5398"),I=i("f6bb"),C=i("fd122"),x=i("cbca"),y=i("add1"),O=i("8d60"),A={name:"distributionOutBill4cldDetails",components:{orderInfo:D["a"],orderItem:k["a"],listComp:I["a"],storeItemComp:C["a"],itemRowEditPop:x["a"],itemSearchPop:y["a"],itemEditComp:O["a"]},data:function(){return{query:this.$route.query,orderInfoData:{},orderItemList:[],dateType:"business",currentDate:new Date,inShopPopShow:!1,inShopList:[],rdcPopShow:!1,rdcList:[],datePickerShow:!1,billTypePopShow:!1,billTypeList:[],itemStorePopShow:!1,storeItem:[],itemSearchPopShow:!1,itemRowEditPopShow:!1,itemEditRowData:{},searchItem:[],currentShopHouseObj:{},currentOutHouseObj:{},itemPopShow:!1,itemInputFocusing:!1,checkActionSheetShow:!1,checkActions:[],fxOrderInfoVerification:this.$fxUtils.fxDataVerification(),fxOrderDetailsVerification:this.$fxUtils.fxDataVerification(),backAbsolute:!1,sortingActionSheetShow:!1,sortingCheckActions:this.$fxStateMiddleware.getStateList("sortingState")}},created:function(){this.getBillOtherAuth().then(this.refreshOrderDetails)},beforeRouteLeave:function(t,e,i){var o=this;if(this.itemInputFocusing)return this.$router.go(1),!1;"/distributionOutBill4cld"===t.path&&this.isChange&&!this.backAbsolute?this.$dialog.confirm({title:"提示",message:"当前单据已修改<br/>是否保存单据?"}).then(function(){return o.$router.go(1),o.checkHasDetails().then(o.saveHandler).then(function(){o.backAbsolute=!0,o.$fxGo("BACK",o.$router)}),!1}).catch(function(){i()}):i()},computed:Object(g["a"])({},Object(w["c"])({sysPointSize:"sysPointSize",sysMoneyPointSize:"sysMoneyPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId},disOut_arrivalIntervalTime:function(t){return t.systemParamsCld.disOut_arrivalIntervalTime},disOut_setDate4Check:function(t){return t.systemParamsCld.disOut_setDate4Check}}),{isBillState:function(t){var e=this;return function(t){return e.$fxStateMiddleware.stateIs("stateCld")(t)(e.orderInfoData.billStateFlag)}},isBillReState:function(t){var e=this;return function(t){return e.$fxStateMiddleware.stateIs("reState")(t)(e.orderInfoData.billReState)}},isBillSortingState:function(t){var e=this;return function(t){return e.$fxStateMiddleware.stateIs("sortingState")(t)(e.orderInfoData.sortingState)}},isHandCreate:function(){return 0===this.orderInfoData.createWay},isChange:function(){return!this.fxOrderInfoVerification.checkData(this.orderInfoData)||!this.fxOrderDetailsVerification.checkData(this.orderItemList)}}),methods:{getBillOtherAuth:function(){var t=this;return this.$fxApi("distributionOutBill4cld.getBillOtherAuth",this.query.orderId).then(function(e){return t.$store.commit({type:"EXTEND_AUTH",billAuth:e.functionMapData[0]}),S.a.resolve(e)})},refreshOrderDetails:function(){return this.$fxApi("distributionOutBill4cld.getOrderDetails",this.query.orderId).then(this.initOrderDetails)},initOrderDetails:function(t){var e=this,i=t.storeBills[0];return this.orderInfoData=i,this.orderItemList=this.filterStoreItem(i.details),this.setDataUUID(this.orderItemList),this.$nextTick(function(){e.fxOrderInfoVerification.resetData(e.orderInfoData),e.fxOrderDetailsVerification.resetData(e.orderItemList)}),S.a.resolve()},filterStoreItem:function(t){var e=b()(new p.a(t.map(function(t){return t.shopHouseDTO.id}))),i=b()(new p.a(t.map(function(t){return t.outHouseDTO.id}))),o=[];return e.forEach(function(e){i.forEach(function(i){var s=t.filter(function(t){return t.outHouseDTO.id===i&&t.shopHouseDTO.id===e});if(s.length){var n=JSON.parse(h()(s[0].outHouseDTO));n.shopHouseDTO=s[0].shopHouseDTO,n.details=s,o.push(n)}})}),o},setDataUUID:function(t){var e=this;t.forEach(function(t){t.uuid=e.$fxUtils.createUUID(),t.details.forEach(function(t){t.uuid=e.$fxUtils.createUUID()})})},clearItemConfirm:function(t){var e=this;return new S.a(function(i){var o=e.orderItemList.filter(function(t){return 0!==t.details.filter(function(t){return"del"!==t.changeType}).length});0===o.length?i():e.$dialog.confirm({title:"提示",message:t}).then(function(){e.onItemClear(),i()})})},onInShopClick:function(){this.onInShopRefresh()},searchInShop:function(t){this.onInShopRefresh(t)},selectInShop:function(t){var e=this;this.checkShop(t).then(function(){e.clearItemConfirm("更换门店会清空品项,是否继续?").then(function(){e.orderInfoData.inShopDTO=t})})},checkShop:function(t){var e=this;return new S.a(function(i){var o=e.orderInfoData.inShopDTO;o.id!==t.id&&i()})},onInShopRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getInShopListData(e).then(function(e){t.inShopList=e.shops,t.inShopPopShow=!0})},getInShopListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e={pid:this.orderInfoData.rdcDTO.id,keyword:t};return this.$fxApi("distributionOutBill4cld.getInShopListData")({data:e})},onRdcClick:function(){this.onRdcRefresh()},searchRdc:function(t){this.onRdcRefresh(t)},selectRdc:function(t){var e=this;this.checkRdc(t).then(function(){e.clearItemConfirm("修改配送中心将清空发货仓库、门店和单据明细，是否继续?").then(function(){e.orderInfoData.rdcDTO=t,e.orderInfoData.inShopDTO={}})})},checkRdc:function(t){var e=this;return new S.a(function(i){var o=e.orderInfoData.rdcDTO;o.id!==t.id&&i()})},onRdcRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getRdcListData(e).then(function(e){t.rdcList=e.shops,t.rdcPopShow=!0})},getRdcListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e={keyword:t};return this.$fxApi("distributionOutBill4cld.getRdcListData")({data:e})},onBillTypeClick:function(){this.onBillTYpeRefresh()},searchBillType:function(t){this.onBillTYpeRefresh(t)},selectBillType:function(t){this.orderInfoData.businessTypeDTO=t},onBillTypeClear:function(){this.orderInfoData.businessTypeDTO={}},onBillTYpeRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getBillTypeListData(e).then(function(e){t.billTypeList=e.businessTypes,t.billTypePopShow=!0})},getBillTypeListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e={m:"list4DistributionOutListBillEdit",keyword:t};return this.$fxApi("distributionOutBill4cld.getBillTypeListData")({data:e})},onBusinessDateClick:function(){this.dateType="business",this.orderInfoData.businessDate&&(this.currentDate=new Date(this.orderInfoData.businessDate)),this.datePickerShow=!0},onArriveDateClick:function(){this.dateType="arrive",this.orderInfoData.arriveDate&&(this.currentDate=new Date(this.orderInfoData.arriveDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){var e=t.getTime();"business"===this.dateType?(this.orderInfoData.businessDate=e,this.orderInfoData.arriveDate=e+this.$fxUtils.h2ms(this.disOut_arrivalIntervalTime)):this.orderInfoData.arriveDate=e,this.datePickerShow=!1},onAddClick:function(){var t=this;this.checkOrderInfo().then(function(){t.storeItem=JSON.parse(h()(t.orderItemList)),t.itemStorePopShow=!0})},checkOrderInfo:function(){var t=this;return new S.a(function(e,i){t.orderInfoData.businessDate?t.orderInfoData.rdcDTO.id?t.orderInfoData.inShopDTO.id?e():t.$fxToast.top("请先选择门店!"):t.$fxToast.top("请先选择配送中心!"):t.$toast.fail("请先选择业务日期!")})},onItemFocus:function(){this.$refs.orderInfo.closeCollapse()},onSearchClick:function(){this.itemSearchPopShow=!0,this.searchItem=JSON.parse(h()(this.orderItemList))},onStoreItemSave:function(t){this.orderItemList=t},onSaveClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要保存该单据吗?"}).then(this.checkHasDetails).then(this.saveHandler).then(this.refreshOrderDetails).then(function(){t.$fxToast.success("保存成功")})},saveHandler:function(){if(this.isBillState(["unSubmit","returned"])){var t=this.getSaveParams();return this.$fxApi("distributionOutBill4cld.saveOrder",this.query.orderId)({data:t})}return S.a.resolve()},checkSorting:function(){var t=this;return new S.a(function(e){var i="";i=t.$fxAuth("distributionOutBill4cld.sorting")&&t.$fxStateMiddleware.stateIs("sortingState")(["sorting","unSorting"])(t.orderInfoData.sortingState)?"所选择单据中分拣状态含有待分拣或分拣中单据，若强制审核单据分拣状态自动更新为：“已分拣”，是否继续审核？":"是否审核所选单据？审核后单据将不能修改，确定要审核吗？",t.$dialog.confirm({title:"提示",message:i}).then(e)})},onExpressClick:function(){var t=this;this.checkSorting().then(function(){0===t.disOut_setDate4Check?t.checkHasDetails().then(t.saveHandler).then(t.refreshOrderDetails).then(t.expressHandler):(1===t.disOut_setDate4Check?t.checkActions=[{id:1,name:"审核并重置业务日期"},{id:0,name:"审核但不重置业务日期"}]:2===t.disOut_setDate4Check&&(t.checkActions=[{id:1,name:"审核并重置业务日期"}]),t.$refs.checkActionSheet.doSelect().then(function(e){t.checkHasDetails().then(t.saveHandler).then(t.refreshOrderDetails).then(function(){t.expressByBusinessDate(e.id)})}))})},expressByBusinessDate:function(t){var e=this,i=this.getSaveParams();return this.$fxApi("distributionOutBill4cld.checkOrderByBusinessDate",this.query.orderId,t)({data:i}).then(function(t){e.refreshOrderDetails().then(function(){e.$fxToast.success(t.message)})}).catch(function(i){"1"===i.errorCode?e.refreshOrderDetails():"isToContinue"===i.errorCode&&(e.setOrderInfoHasNoticed(),e.expressByBusinessDate(t))})},expressHandler:function(){var t=this,e=this.getSaveParams();return this.$fxApi("distributionOutBill4cld.checkOrder",this.query.orderId)({data:e}).then(function(e){t.refreshOrderDetails().then(function(){t.$fxToast.success(e.message)})}).catch(function(e){"1"===e.errorCode?t.refreshOrderDetails():"isToContinue"===e.errorCode&&(t.setOrderInfoHasNoticed(),t.expressHandler())})},onUnExpressClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要反审该单据吗?"}).then(this.unExpressHandler).then(this.refreshOrderDetails).then(function(){t.$fxToast.success("反审成功")})},unExpressHandler:function(){var t=this.getSaveParams();return this.$fxApi("distributionOutBill4cld.uncheckOrder",this.query.orderId)({data:t})},onCopyClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要复制该单据吗?"}).then(this.checkHasDetails).then(this.copyHandler).then(this.refreshOrderDetails).then(function(){t.$fxToast.success("复制成功")})},copyHandler:function(){var t=this.getSaveParams();return this.$fxApi("distributionOutBill4cld.copyOrder",this.query.orderId)({data:t})},onDeleteClick:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"确定要删除该单据吗?";this.$dialog.confirm({title:"提示",message:e}).then(this.deleteOrderHandler).then(function(){t.$fxToast.success("删除成功").then(function(){t.backAbsolute=!0,t.$router.go(-1)})})},deleteOrderHandler:function(){var t=this.getSaveParams();return this.$fxApi("distributionOutBill4cld.deleteOrder",this.query.orderId)({data:t})},getSaveParams:function(){var t=[];this.orderItemList.forEach(function(e){t.push.apply(t,Object(u["a"])(e.details))});var e=t.filter(function(t){return"add"===t.changeType}),i=t.filter(function(t){return"del"===t.changeType}),o=t.filter(function(t){return"edit"===t.changeType}),s=l()({},this.orderInfoData,{detailAdd:e.length>0?e:null,detailDel:i.length>0?i:null,detailMdf:o.length>0?o:null,details:[]});return s},getValidItem:function(){var t=[];return this.orderItemList.forEach(function(e){t.push.apply(t,Object(u["a"])(e.details))}),t.filter(function(t){return"del"!==t.changeType})},getItemLength:function(){return this.getValidItem().length},checkHasDetails:function(){var t=this;return new S.a(function(e){0===t.getItemLength()?t.onDeleteClick("当前单据没有明细,是否要删除该单据吗?"):e()})},onItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},toFixedNumberSize:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sysMoneyPointSize;return r()(this.$fxUtils.toFixedSHW(t,e))},onExpressAgainClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要复审该单据吗?"}).then(this.checkAgainHandler).then(this.refreshOrderDetails).then(function(){t.$fxToast.success("复审成功")})},checkAgainHandler:function(){var t=this.getSaveParams();return this.$fxApi("distributionOutBill4cld.checkAgain",this.query.orderId)({data:t})},onUnExpressAgainClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要取消复审该单据吗?"}).then(this.UnExpressAgainHandler).then(this.refreshOrderDetails).then(function(){t.$fxToast.success("取消复审成功")})},UnExpressAgainHandler:function(){var t=this.getSaveParams();return this.$fxApi("distributionOutBill4cld.unReCheck",this.query.orderId)({data:t})},onItemClear:function(){var t=this.orderInfoData.details.filter(function(t){return!!t.id});t.forEach(function(t){t.changeType="del"}),this.orderInfoData.details=t,this.orderItemList=this.filterStoreItem(t)},onClickHandler:function(t){if(this.itemInputFocusing)return!1;this[t]()},onSearchConfirm:function(t){this.orderItemList=t},onStoreItemSelect:function(t,e){this.currentOutHouseObj=t,this.currentShopHouseObj=e,this.itemPopShow=!0},getStoreItem:function(){var t=this;if(this.$fxUtils.isEmptyObjSHW(this.currentShopHouseObj)||this.$fxUtils.isEmptyObjSHW(this.currentOutHouseObj))return[];var e=this.orderItemList.find(function(e){return e.shopHouseDTO.id===t.currentShopHouseObj.id&&e.id===t.currentOutHouseObj.id});return e?e.details:[]},onItemEditConfirm:function(t){var e=this,i=Object(n["a"])(t,3),o=i[0],s=i[1],a=i[2],r=this.orderItemList.find(function(t){return t.id===s.id&&t.shopHouseDTO.id===a.id});if(r)if(this.$fxAuth("distributionOutBill4cld.inputMultipleDetails")){var c=r.details.filter(function(t){var i=o.findIndex(function(i){return i.goodsDTO.id===t.goodsDTO.id&&i.unitDTO.id===t.unitDTO.id&&i.batchCode===t.batchCode&&e.$fxUtils.isDef(t.batchCode)});return!~i});r.details=o.concat(c)}else r.details=o;else{var u=l()({},s);u.shopHouseDTO=a,u.details=o,this.orderItemList.push(u)}},onSubmitClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要提交该单据吗?"}).then(this.checkHasDetails).then(this.saveHandler).then(this.refreshOrderDetails).then(this.onSubmitHandler).then(this.refreshOrderDetails).then(function(){t.$fxToast.success("提交成功")})},onSubmitHandler:function(){return this.$fxApi("distributionOutBill4cld.submitOrder",this.query.orderId)},onReturnClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要退回该单据吗?"}).then(this.onReturnHandler).then(this.refreshOrderDetails).then(function(){t.$fxToast.success("退回成功")})},onReturnHandler:function(){return this.$fxApi("distributionOutBill4cld.returnOrder",this.query.orderId)},setOrderInfoHasNoticed:function(){this.orderInfoData.hasNoticed=!0},onSortingClick:function(){var t=this;this.sortingCheckActions.forEach(function(e){e.disabled=t.orderInfoData.sortingState===e.id}),this.$refs.sortingActionSheet.doSelect().then(function(e){t.checkHasDetails().then(t.saveHandler).then(function(){t.sortingHandler(e.id).then(t.refreshOrderDetails).then(t.$fxCommon.orderSuccess("sorting"))})})},sortingHandler:function(t){var e={sortingState:t};return this.$fxApi("distributionOutBill4cld.sortingOrder",this.query.orderId)({data:e})}}},T=A,P=i("2877"),B=Object(P["a"])(T,o,s,!1,null,null,null);e["default"]=B.exports},f3c0:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQyIDc5LjE2MDkyNCwgMjAxNy8wNy8xMy0wMTowNjozOSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjRFMEVGQjYxREY1QzExRTk4NEQxQzk4RUQzQjYwMzQxIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjRFMEVGQjYyREY1QzExRTk4NEQxQzk4RUQzQjYwMzQxIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NEUwRUZCNUZERjVDMTFFOTg0RDFDOThFRDNCNjAzNDEiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NEUwRUZCNjBERjVDMTFFOTg0RDFDOThFRDNCNjAzNDEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5jgS7LAAAC50lEQVR42sSXy2tTQRTGzyS1KFgxYqkLQaWtAREXYiJpNUQLEaqCj/pAfBStuHHhRtC/wG4EX4hvKrpR3NWapq2KsZigreimBJtErSsfNYipSKh3/KYZ4zWZ3HtjEnrgy+ZOzm/mnJkzZxjnnKbDqsRP2xnNbByD1kIboWaoAXLIb0koBj2D7kNPIcPV3Dtmy4ANzAa1QyclTGV1UmJCx+UkTkFdkGbkuJAtgSLQdQOoyhrkfyLSR1FgH/QccpWQRpf04bUK9kNBaH4Z9pDw0Q9tMAM7Re6h6jJu4Grp01kIbIduQTUVOD2zpW+7CnygxJxayXl7LpjJI1M28y1jdHZ/3hY6IVlZsLfII2NoLcsZdaxjtGCu8qh59eDWckH9Kxgd9DGagWzejSgLWGu2ZMKalHUSQbFjapO/rEE3rWS0p4lRFaC3Bzl1v1SCPXpwo2rEkRZGNsDvhDmNpwwKOcZsXcVox2o2lcGuJ5wCrzkVuH+W6sEOZe2rY7S4FmdhJtHVR5ySE2rwdhejXR5Gk6jMN0OcggJaeJ4Os1pNlwY0+jBO5K7P5G3OrH+/izTsRmiF0kjHlYeceo2heQUkqfoY+0h0oU+jMcA9jYwOr2dUI+HViJVYZZub0fefRJcHOD0esXS3J/Xg0UKj4oCfD/6Fd2DlC+fRVD63IcTffojIcApFLTcUb/Q5DkNrCo18+4noXK9GR/02anYyWlSbgX+dyIR3KFFUFxPWr7jHbPS7z4Bj5QlMQkDFLr/YVzRU2AM9OCQ7B0Mb+wJYv0bhUU7XsMtfvS8aGpOtURYsPHRa+adY+ekeTi8S/9Ukdv5ph/THSfRIQxW8nYYlI+9aFIVxH5SqAFT43CsZyg4kCu2E0mWEpqXPqFnPFYC2lGnlKekrYLXLDMiOYbjEnLpUULNaLULjhg6JAlYEMC7/484Nb94TxsDE1r8hd6OobJvl3V2f84SJyydMNzRo9ILIXqXT9Wj7LcAAqr/RbQBzkgIAAAAASUVORK5CYII="},f6bb:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"shop-popup"},[i("w-header",{attrs:{title:t.title,leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("van-pro-search",{directives:[{name:"show",rawName:"v-show",value:t.searchShow,expression:"searchShow"}],attrs:{shape:"round"},on:{search:t.search},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}}),i("div",{staticClass:"popup-content"},[i("van-list",{attrs:{finished:t.loadFinished,"finished-text":"没有更多了",error:t.listError,"immediate-check":t.immediateCheck,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.listError=e},load:t.onLoad},model:{value:t.listLoading,callback:function(e){t.listLoading=e},expression:"listLoading"}},t._l(t.data,function(e){return i("van-cell",{key:e.id,staticClass:"fx-van-cell",attrs:{title:e.name},on:{click:function(i){return t.indexListClick(e)}}})}),1)],1)],1)},s=[],n={name:"filterPop",props:{loading:Boolean,visibleFlag:Boolean,title:String,data:{type:Array,default:function(){return[]}},searchShow:{type:Boolean,default:!0},loadFinished:Boolean,immediateCheck:{type:Boolean,default:!0}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",listLoading:!1,listError:!1}},watch:{loading:{handler:function(t){t||(this.listLoading=!1)},immediate:!0},visibleFlag:function(t){t&&(this.searchKey="")}},methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},indexListClick:function(t){this.$emit("on-select",t),this.$emit("update:visibleFlag",!1)},search:function(t){this.$emit("on-search",t)},onLoad:function(){this.$emit("update:loading",!0),this.$emit("on-load",this.searchKey||null)}}},a=n,r=(i("8d5d"),i("2877")),c=Object(r["a"])(a,o,s,!1,null,"2a1c11fe",null);e["a"]=c.exports},f821:function(t,e,i){"use strict";var o=i("bdf8"),s=i.n(o);s.a},fd122:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"store-item"},[i("w-header",{attrs:{title:"编辑统配出库单明细",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{staticClass:"add-store-bar"},[t.currentOutHouseObj.id?i("van-button",{staticClass:"add-store-btn",attrs:{type:"primary",round:""},on:{click:t.onAddOutHouseClick}},[t._v(t._s(t.currentOutHouseObj.name))]):i("van-button",{staticClass:"add-store-btn",attrs:{type:"primary",round:""},on:{click:t.onAddOutHouseClick}},[t._v("添加发货仓库")])],1),i("div",{staticClass:"add-store-bar"},[i("van-button",{staticClass:"add-store-btn",attrs:{type:"primary",round:""},on:{click:t.onAddShopHouseClick}},[t._v("添加收货仓库")])],1),i("div",{staticClass:"store-item-content"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeStoreNames,callback:function(e){t.activeStoreNames=e},expression:"activeStoreNames"}},t._l(t.currentStoreItemData,function(e,o){return i("van-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.storeShowComputed(e),expression:"storeShowComputed(storeItem)"}],key:e.id+"-"+e.shopHouseDTO.id,staticClass:"store-row",attrs:{name:e.id+"-"+e.shopHouseDTO.id}},[i("div",{staticClass:"item-store-title",attrs:{slot:"title"},slot:"title"},[i("span",{staticClass:"item-store-name fx-ellipsis"},[t._v("出库仓库："+t._s(e.name))]),i("span",{staticClass:"item-store-name fx-ellipsis"},[t._v("入库仓库："+t._s(e.shopHouseDTO.name))])]),i("div",{staticClass:"item-storn-btn"},[i("i",{staticClass:"edit-btn",on:{click:function(i){return t.editStoreItem(e)}}}),i("i",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionOutBill4cld.delDetail"),expression:"$fxAuth('distributionOutBill4cld.delDetail')"}],staticClass:"delete-btn",on:{click:function(i){return t.deleteStoreItem(e,o)}}})]),t._l(e.details,function(t){return i("div",{directives:[{name:"show",rawName:"v-show",value:"del"!==t.changeType,expression:"item.changeType !== 'del'"}],key:e.shopHouseDTO.id+"-"+t.goodsDTO.id+"-"+t.goodsUUid,staticClass:"item-row"},[i("itemInfoCell",{attrs:{itemData:t,isDisabled:!0,disabledWatchBtn:!0,showEditBtn:!1}})],1)})],2)}),1)],1),i("div",{staticClass:"store-item-bottom"},[i("van-button",{staticClass:"save-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onSaveClick}},[t._v("保存")])],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.storePopShow,callback:function(e){t.storePopShow=e},expression:"storePopShow"}},[i("listComp",{attrs:{visibleFlag:t.storePopShow,data:t.storeList,loadFinished:!0,title:"仓库检索"},on:{"update:visibleFlag":function(e){t.storePopShow=e},"update:visible-flag":function(e){t.storePopShow=e},"on-search":t.searchStore,"on-select":t.selectStore}})],1)],1)},s=[],n=(i("7f7f"),i("5176")),a=i.n(n),r=i("795b"),c=i.n(r),l=(i("ac6a"),i("cebc")),u=(i("c5f6"),i("2f62")),d=i("f6bb"),h=i("033b"),f={name:"storeItemComp",components:{listComp:d["a"],itemInfoCell:h["a"]},props:{visibleFlag:Boolean,inShopId:{type:String,default:""},rdcId:{type:String,default:""},businessDate:{type:[String,Number],default:""},storeItemData:{type:Array,default:function(){return[]}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},storePopShow:!1,storeList:[],currentOutHouseObj:{},currentShopHouseObj:{},currentStoreObj:{},currentStoreItemData:[],listCompType:"",activeStoreNames:[]}},computed:Object(l["a"])({},Object(u["c"])({loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{storeShowComputed:function(t){return function(t){var e=t.details.filter(function(t){return"del"!==t.changeType}).length;return e>0}}}),watch:{visibleFlag:{handler:function(t){if(t){this.resetHandler(),this.currentStoreItemData=this.storeItemData;var e=0,i={};this.storeItemData.forEach(function(t){e+=t.details.filter(function(t){return"del"!==t.changeType&&(i=t.outHouseDTO,!0)}).length}),e>0&&(this.currentOutHouseObj=i),this.openStoreItemList(this.currentStoreItemData),this.setDetailGoodsUUid(this.currentStoreItemData)}},immediate:!0}},methods:{setDetailGoodsUUid:function(t){var e=this;t.forEach(function(t){t.details.forEach(function(t){t.goodsUUid=e.$fxUtils.createUUID()})})},resetHandler:function(){this.currentOutHouseObj={},this.currentShopHouseObj={},this.currentStoreItemData=[]},onCloseClick:function(){this.$emit("update:visibleFlag",!1)},clearItemConfim:function(t){var e=this;return new c.a(function(i){var o=e.currentStoreItemData.filter(function(t){var e=t.details.filter(function(t){return"del"!==t.changeType});return 0!==e.length});0===o.length?i():e.$dialog.confirm({title:"提示",message:t}).then(function(){e.onItemClear(),i()}).catch(function(){})})},onAddOutHouseClick:function(){this.onOutHouseRefresh()},onOutHouseRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.listCompType="outHouse",this.getStoreListData(e).then(function(e){t.storeList=e.shops,t.storePopShow=!0})},getStoreListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i="",o="";return"outHouse"===this.listCompType?(i=this.rdcId,o="list4ShopOrderBill"):"shopHouse"===this.listCompType&&(i=this.inShopId,o="list4DistributionOutBillTC"),new c.a(function(s){var n={keyword:e,m:o};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(i,"/users/").concat(t.loginerId,"/houses"),data:n}).then(function(t){s(t)})})},onAddShopHouseClick:function(){if(!this.currentOutHouseObj.id)return this.$fxToast.top("请先选择发货仓库!"),!1;this.onShopHouseRefresh()},onShopHouseRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.listCompType="shopHouse",this.getStoreListData(e).then(function(e){t.storeList=e.shops,t.storePopShow=!0})},searchStore:function(t){"outHouse"===this.listCompType?this.onOutHouseRefresh(t):"shopHouse"===this.listCompType&&this.onShopHouseRefresh(t)},selectStore:function(t){"outHouse"===this.listCompType?this.currentOutHouseObj=t:"shopHouse"===this.listCompType&&(this.currentShopHouseObj=t,this.$emit("on-select-store",this.currentOutHouseObj,this.currentShopHouseObj),this.$emit("update:visibleFlag",!1)),this.listCompType=""},editStoreItem:function(t){this.currentOutHouseObj=a()({},{code:t.code,id:t.id,name:t.name,pinYin:t.pinYin,updateIndicator:t.updateIndicator}),this.currentShopHouseObj=a()({},{id:t.shopHouseDTO.id,code:t.shopHouseDTO.code,name:t.shopHouseDTO.name,pinYin:t.shopHouseDTO.pinYin}),this.$emit("on-select-store",this.currentOutHouseObj,this.currentShopHouseObj),this.$emit("update:visibleFlag",!1)},deleteStoreItem:function(t,e){var i=this;this.$dialog.confirm({title:"提示",message:"确定要删除当前仓库品项吗?"}).then(function(){var o=t.details.filter(function(t){return!!t.id});if(0===o.length)return i.currentStoreItemData.splice(e,1),!1;o.forEach(function(t){t.changeType="del"}),i.currentStoreItemData[e].details=o}).catch(function(){})},onSaveClick:function(){this.$emit("on-save",this.currentStoreItemData),this.$emit("update:visibleFlag",!1)},openStoreItemList:function(t){var e=this;t.forEach(function(t){var i=t.details.filter(function(t){return"del"!==t.changeType}).length;i>0&&e.activeStoreNames.push("".concat(t.id,"-").concat(t.shopHouseDTO.id))})}}},p=f,m=(i("0321"),i("2877")),b=Object(m["a"])(p,o,s,!1,null,"2fb0ead0",null);e["a"]=b.exports}}]);
//# sourceMappingURL=distributionOutBill4cld.d06ae4c8.js.map