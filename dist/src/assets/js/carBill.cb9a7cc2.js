(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["carBill"],{"0076":function(t,e,i){"use strict";var o=i("0806"),n=i.n(o);n.a},"01b2":function(t,e,i){},"06e3":function(t,e,i){},"0806":function(t,e,i){},"0852":function(t,e,i){},"08c6":function(t,e,i){},"0984":function(t,e,i){},"0d46":function(t,e,i){"use strict";var o=i("08c6"),n=i.n(o);n.a},"107c":function(t,e,i){"use strict";var o=i("4464"),n=i.n(o);n.a},1289:function(t,e,i){"use strict";var o=i("6f47"),n=i.n(o);n.a},"1de0":function(t,e,i){"use strict";var o=i("340b"),n=i.n(o);n.a},"282e":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-info-wrap"},[i("div",{staticClass:"item-info-cell"},[i("div",{staticClass:"item-img"},[i("img",{attrs:{src:t.comptedItemImgSrc(t.itemData.goodsDTO.imageUrls),onerror:t.$fxCommon.errorImg("item")}})]),i("div",{staticClass:"item-details"},[i("div",{staticClass:"item-name fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.name))]),i("div",{staticClass:"details-cell"},[i("div",{staticClass:"item-taxprice fx-ellipsis"},[i("span",[t._v("金额：￥")]),i("span",[t._v(t._s(t.itemData.sumMoney))])]),i("div",{staticClass:"item-spec fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.spec))])]),i("div",{staticClass:"details-cell"},[t.isDisabled?i("div",{staticClass:"item-amount"},[i("span",{staticClass:"item-amount-text"},[t._v(t._s(t.itemData.factCount))]),i("span",{staticClass:"fx-ellipsis"},[t._v(t._s(t.itemData.unitDTO.name))])]):i("div",{staticClass:"item-amount-edit"},[i("w-stepper",{ref:"amountInput",staticClass:"amount-step",attrs:{min:"0",max:t.maxAmount,stepperBtnShow:!1,intLength:t.numberLength,pointSize:t.sysPointSize,inputWidth:"28vw"},on:{change:t.onChange,focus:t.onFocus,blur:t.onBlur},model:{value:t.itemData.factCount,callback:function(e){t.$set(t.itemData,"factCount",e)},expression:"itemData.factCount"}}),i("div",{staticClass:"unit-text"},[i("span",{staticClass:"cell-unit fx-ellipsis",on:{click:function(e){return e.stopPropagation(),t.onUnitClick(e)}}},[t._v(t._s(t.itemData.unitDTO.name))]),i("van-icon",{staticClass:"unit-icon",attrs:{name:"arrow-down"}})],1)],1)])]),i("i",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&!t.disabledEditBtn,expression:"!isDisabled && !disabledEditBtn"}],staticClass:"block-item-edit",on:{click:t.onItemEditClick}}),i("i",{directives:[{name:"show",rawName:"v-show",value:t.isDisabled,expression:"isDisabled"}],staticClass:"block-item-watch",on:{click:t.onItemEditClick}})]),i("div",{staticClass:"item-bom",on:{click:t.onEditBomDetails}},[t._v("查看BOM明细>")])])},n=[],a=i("795b"),s=i.n(a),r=i("59ad"),c=i.n(r),l=(i("ac6a"),i("cebc")),u=i("2f62"),h={name:"itemInfoCell",props:{itemData:{type:Object,default:function(){return{}}},isDisabled:Boolean,disabledEditBtn:Boolean},computed:Object(l["a"])({},Object(u["c"])({sysDZCCanModifyAcount:function(t){return t.systemParams.sysDZCCanModifyAcount},sysPointSize:"sysPointSize",numberLength:"numberLength",maxAmount:"maxAmount"}),{comptedItemImgSrc:function(t){return function(t){return t?0===t.length?"":t[0]:""}}}),methods:{editItem:function(){this.itemData.id&&this.$set(this.itemData,"changeType","edit")},onItemEditClick:function(){this.editItem(),this.$emit("on-item-edit",this.itemData)},onEditBomDetails:function(){this.$emit("on-bom-view",this.itemData)},onChange:function(t){if("del"===this.itemData.changeType)return!1;this.editItem(),this.onAmountChange(t)},onAmountChange:function(t){var e=this;this.editItem();var i=this.itemData,o=i.factMoney,n=i.taxInMoney,a=i.price,s=i.tax;o=this.toFixedNumberSize(a*t,this.sysPointSize),n=this.toFixedNumberSize(o*s,this.sysPointSize),this.itemData.bomDetail.forEach(function(i){var o=i.crude;e.$fxSysAuth("carBill.sysCarBillChangeAmount")&&(i.factCount=e.toFixedNumberSize(t*o)),i.theoryCount=e.toFixedNumberSize(t*o),i.id&&(i.changeType="edit")}),this.itemData.factMoney=o,this.itemData.taxInMoney=n},toFixedNumberSize:function(t){return c()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},onUnitClick:function(){var t=this;if(this.isDisabled)return!1;this.onCheckAmount(!1).then(function(){t.editItem(),t.$emit("on-unit-edit",t.itemData)})},onFocus:function(){this.$emit("on-item-focus")},onBlur:function(){var t=this;this.onCheckAmount().then(function(){t.$emit("on-item-blur")}).catch(function(){t.$refs.amountInput.setFocus(),t.$emit("on-item-focus")})},onCheckAmount:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new s.a(function(i,o){var n=t.itemData.factCount,a="数量不符合规则";0===n?t.$nextTick(function(){e&&t.$fxNotify.fail("数量不能为0!"),o(a)}):i()})}}},d=h,f=(i("1de0"),i("2877")),m=Object(f["a"])(d,o,n,!1,null,"31fa550e",null);e["a"]=m.exports},2847:function(t,e,i){"use strict";var o=i("9f11"),n=i.n(o);n.a},"2d58":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-info-block fx-shadow-block"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},[i("van-collapse-item",{attrs:{name:"1",disabled:t.collapseDisabled}},[i("div",{staticClass:"info-title",attrs:{slot:"title"},slot:"title"},[i("span",{staticClass:"info-title-name"},[t._v("单据信息")]),i("stateText",{staticClass:"stateTag fl-r",attrs:{billState:t.data.billState}}),i("span",{directives:[{name:"show",rawName:"v-show",value:1===t.data.weightState,expression:"data.weightState === 1"}],staticClass:"info-title-weightState"},[t._v("待称重")])],1),i("van-tabs",{attrs:{animated:""},model:{value:t.tabActive,callback:function(e){t.tabActive=e},expression:"tabActive"}},[i("van-tab",{attrs:{title:"表头"}},[i("van-cell",{staticClass:"info-item",attrs:{title:"所属机构","value-class":"info-item-value",value:t.data.shopDTO&&t.data.shopDTO.name,"is-link":!t.isDisabled},on:{click:function(e){return t.onEmitClick("on-shop-click")}}}),i("van-cell",{staticClass:"info-item",attrs:{title:"业务日期",value:t.formatterDate(t.data.businessDate),"is-link":!t.isDisabled},on:{click:t.onBusdateClick}}),i("van-cell",{staticClass:"info-item",attrs:{title:"成品仓库","value-class":"info-item-value",value:t.data.inHouseDTO&&t.data.inHouseDTO.name,"is-link":!t.isDisabled},on:{click:function(e){return t.onEmitClick("on-inStore-click")}}}),i("van-cell",{staticClass:"info-item",attrs:{title:"材料仓库","value-class":"info-item-value",value:t.data.outHouseDTO&&t.data.outHouseDTO.name,"is-link":!t.isDisabled},on:{click:function(e){return t.onEmitClick("on-outStore-click")}}}),i("van-cell",{staticClass:"info-item",attrs:{title:"单据类型","value-class":"info-item-value",value:t.data.businessTypeDTO&&t.data.businessTypeDTO.name},on:{click:function(e){return t.onBillTypeClick("on-billType-click")}}},[i("van-icon",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"item-clear-btn",attrs:{slot:"right-icon",name:t.hasBillType?"close":"arrow"},on:{click:function(e){e.stopPropagation(),t.hasBillType?t.onBillTypeClick("on-billType-clear"):t.onBillTypeClick("on-billType-click")}},slot:"right-icon"})],1),i("van-cell",{staticClass:"info-item",attrs:{title:"生成方式",value:t.formatterAutoType(t.data.autoType)}})],1),i("van-tab",{attrs:{title:"更多"}},[i("van-pro-field",{staticClass:"info-item",attrs:{label:"手工单号",placeholder:t.isDisabled?"":"请输入手工单号",maxlength:"50","input-align":"right",disabled:t.isDisabled},model:{value:t.data.manualCode,callback:function(e){t.$set(t.data,"manualCode",e)},expression:"data.manualCode"}}),i("van-cell",{staticClass:"info-item",attrs:{title:"制单人",value:t.data.billEmp}}),i("van-cell",{staticClass:"info-item",attrs:{title:"制单日期",value:t.formatterDate(t.data.billDate)}}),i("van-cell",{staticClass:"info-item",attrs:{title:"审核人",value:t.data.checkEmp}}),i("van-cell",{staticClass:"info-item",attrs:{title:"审核日期",value:t.formatterDate(t.data.checkDate)}}),i("van-pro-field",{staticClass:"info-item",attrs:{label:"整单备注",placeholder:t.isDisabled?"":"请输入整单备注","input-align":"right",maxlength:"50",disabled:t.isDisabled},model:{value:t.data.billMemo,callback:function(e){t.$set(t.data,"billMemo",e)},expression:"data.billMemo"}})],1)],1)],1)],1)],1)},n=[],a=i("4760"),s={name:"orderInfo",components:{stateText:a["a"]},props:{data:{type:Object,default:function(){return{}}},isDisabled:Boolean,collapseDisabled:Boolean},data:function(){return{activeNames:["1"],tabActive:0}},computed:{formatterDate:function(t){var e=this;return function(t){return"number"===typeof t?e.$fxUtils.setDateTime(new Date(t),"时分"):""}},formatterAutoType:function(t){return function(t){return 0===t?"自动生成":1===t?"手动生成":2===t?"完工入库":void 0}},hasBillType:function(){return this.data.businessTypeDTO&&this.data.businessTypeDTO.id}},methods:{onEmitClick:function(t){if(this.isDisabled)return!1;this.$emit(t)},onBillTypeClick:function(t){if(this.isDisabled)return!1;this.$emit(t)},onBusdateClick:function(){if(this.isDisabled)return!1;this.$emit("on-busdate-click")},closeCollapse:function(){this.activeNames=[]}}},r=s,c=(i("749e"),i("a792"),i("2877")),l=Object(c["a"])(r,o,n,!1,null,"fa695d7c",null);e["a"]=l.exports},"340b":function(t,e,i){},"3aad":function(t,e,i){},"3ad4":function(t,e,i){"use strict";var o=i("b523"),n=i.n(o);n.a},4464:function(t,e,i){},"47a7":function(t,e,i){"use strict";var o=i("5acf"),n=i.n(o);n.a},"48d9":function(t,e,i){"use strict";var o=i("df40"),n=i.n(o);n.a},"5acf":function(t,e,i){},"5b30":function(t,e,i){},"5f75":function(t,e,i){"use strict";var o=i("0852"),n=i.n(o);n.a},"6e8c":function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-carBill"},[i("w-header",{attrs:{title:"加工单",border:!0}},[i("headEditBtn",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("carBill.check"),expression:"$fxAuth('carBill.check')"}],attrs:{slot:"header-right",active:t.orderEditFlag},on:{click:t.onOrderEditClick},slot:"header-right"}),i("headSearchBtn",{directives:[{name:"show",rawName:"v-show",value:!t.orderEditFlag,expression:"!orderEditFlag"}],attrs:{slot:"header-right"},on:{click:t.onSearchClick},slot:"header-right"}),i("headSelectAllBtn",{directives:[{name:"show",rawName:"v-show",value:t.orderEditFlag,expression:"orderEditFlag"}],attrs:{slot:"header-right",active:t.isSelectAll},on:{click:t.onSelectAllClick},slot:"header-right"})],1),i("filterTab",{attrs:{state:t.computedState},on:{"on-state-click":t.onStateClick}}),i("div",{staticClass:"carBill-content"},[i("van-pull-refresh",{directives:[{name:"show",rawName:"v-show",value:0!==t.orderList.length,expression:"orderList.length !== 0"}],staticClass:"carBill-list",on:{refresh:t.onPullRefresh},model:{value:t.pullRefreshLoading,callback:function(e){t.pullRefreshLoading=e},expression:"pullRefreshLoading"}},[i("van-list",{attrs:{finished:t.loadFinished,"finished-text":"没有更多了",error:t.listError,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.listError=e},load:t.onLoadMore},model:{value:t.listLoading,callback:function(e){t.listLoading=e},expression:"listLoading"}},t._l(t.orderList,function(e){return i("orderBlock",{directives:[{name:"show",rawName:"v-show",value:t.computedShowOrder(e.billState),expression:"computedShowOrder(item.billState)"}],key:e.id,attrs:{data:e,showCheckBox:t.orderEditFlag},on:{"on-click":function(i){return t.onClickOrder(e)}}})}),1)],1),i("emptyBill",{directives:[{name:"show",rawName:"v-show",value:0===t.orderList.length,expression:"orderList.length === 0"}]})],1),i("div",{staticClass:"carBill-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.orderEditFlag&&t.$fxAuth("carBill.add"),expression:"!orderEditFlag && $fxAuth('carBill.add')"}],staticClass:"add-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onCreateClick}},[t._v("添加单据")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.orderEditFlag&&t.$fxAuth("carBill.check"),expression:"orderEditFlag && $fxAuth('carBill.check')"}],staticClass:"add-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onExpressClick}},[t._v("批量审核")])],1),i("van-actionsheet",{attrs:{actions:t.stateActions,"cancel-text":"取消"},on:{select:t.onStateSelect},model:{value:t.stateActionShow,callback:function(e){t.stateActionShow=e},expression:"stateActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.filterPopShow,callback:function(e){t.filterPopShow=e},expression:"filterPopShow"}},[i("filterPop",{attrs:{visibleFlag:t.filterPopShow,filterParams:t.filterParams},on:{"update:visibleFlag":function(e){t.filterPopShow=e},"update:visible-flag":function(e){t.filterPopShow=e},"update:filterParams":function(e){t.filterParams=e},"update:filter-params":function(e){t.filterParams=e},"on-confirm":t.onFilterConfirm}})],1)],1)},n=[],a=(i("ac6a"),i("75fc")),s=i("5176"),r=i.n(s),c=i("795b"),l=i.n(c),u=(i("7514"),i("7f7f"),i("cebc")),h=(i("6762"),i("2f62")),d=i("b215"),f=i("46aa"),m=i("a0be"),p=i("4102"),v=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-block fx-shadow-block",on:{click:t.onClick}},[i("checkBox",{staticClass:"order-checkbox",attrs:{visibleFlag:t.showCheckBox,checked:t.data.checked},on:{"on-checkbox-click":t.onClick}}),i("div",{staticClass:"block-content"},[i("div",{staticClass:"block-title"},[i("i",{staticClass:"block-icon"}),i("span",{staticClass:"title-text fx-ellipsis"},[t._v(t._s(t.data.shopDTO.name))]),i("stateTag",{staticClass:"state-tag",attrs:{billState:t.data.billState,reCheckState:t.data.billReState}})],1),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No"},[i("span",[t._v("明细数：")]),i("span",[t._v(t._s(t.data.detailCount))])]),i("div",{staticClass:"order-date"},[i("span",[t._v("业务日期：")]),i("span",[t._v(t._s(t._f("filterDateYMD")(t.data.businessDate)))]),i("van-icon",{staticClass:"order-date-arrow",attrs:{name:"arrow"}})],1)])])],1)},S=[],g=i("59ad"),b=i.n(g),D=i("0f38"),w=i("0b26"),I={name:"orderBlock",components:{checkBox:D["a"],stateTag:w["a"]},props:{data:{type:Object,default:function(){return{}}},showCheckBox:{type:Boolean,default:!1}},computed:Object(u["a"])({},Object(h["c"])({sysMoneyPointSize:"sysMoneyPointSize"}),{toFixedNumberSize:function(t){var e=this;return function(t){return b()(e.$fxUtils.toFixedSHW(t,e.sysMoneyPointSize))}}}),methods:{onClick:function(){this.showCheckBox?this.$set(this.data,"checked",!this.data.checked):this.$emit("on-click",this.data)}}},C=I,k=(i("48d9"),i("2877")),y=Object(k["a"])(C,v,S,!1,null,"00f76ec0",null),x=y.exports,B=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"filter-popup"},[i("w-header",{attrs:{title:"筛选条件",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{ref:"filterContent",staticClass:"filter-content"},[i("van-cell-group",[i("van-cell",{attrs:{title:"业务日期"}}),i("van-cell",{attrs:{title:"起始时间",value:t.beginDate,"is-link":""},on:{click:t.onBeginDateClick}}),i("van-cell",{attrs:{title:"结束时间",value:t.endDate,"is-link":""},on:{click:t.endDateClick}}),i("van-cell",{attrs:{title:"机构",value:t.shop,"value-class":"info-item-value","is-link":""},on:{click:t.onShopClick}}),i("van-cell",{attrs:{title:"成品仓库",value:t.store,"value-class":"info-item-value","is-link":""},on:{click:t.onStoreClick}}),i("van-cell",{attrs:{title:"材料仓库",value:t.outHouse,"value-class":"info-item-value","is-link":""},on:{click:t.onOutHouseClick}}),i("van-cell",{attrs:{title:"品项",value:t.item,"value-class":"info-item-value","is-link":""},on:{click:t.onItemClick}}),i("van-field",{ref:"billNo",attrs:{label:"系统单号","value-class":"info-item-value",placeholder:"请输入系统单号","input-align":"right"},model:{value:t.billNo,callback:function(e){t.billNo=e},expression:"billNo"}})],1)],1),i("div",{staticClass:"filter-bottom"},[i("van-button",{staticClass:"reset-btn fx-no-radius",attrs:{type:"info"},on:{click:t.onResetClick}},[t._v("重置")]),i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onConfirmClick}},[t._v("确定")])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.outHousePopShow,callback:function(e){t.outHousePopShow=e},expression:"outHousePopShow"}},[i("listComp",{attrs:{visibleFlag:t.outHousePopShow,data:t.outHouseList,loadFinished:!0,title:"成品仓库检索"},on:{"update:visibleFlag":function(e){t.outHousePopShow=e},"update:visible-flag":function(e){t.outHousePopShow=e},"on-search":t.searchOutHouse,"on-select":t.selectOutHouse}})],1),i("filterListPopup",{attrs:{title:"机构检索",rollingLoad:!0,getDataApi:t.getShopListData},on:{"on-select":function(e){return t.selectShop(arguments)}},model:{value:t.shopPopShow,callback:function(e){t.shopPopShow=e},expression:"shopPopShow"}}),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.storePopShow,callback:function(e){t.storePopShow=e},expression:"storePopShow"}},[i("listComp",{attrs:{visibleFlag:t.storePopShow,data:t.storeList,loadFinished:!0,title:"材料仓库检索"},on:{"update:visibleFlag":function(e){t.storePopShow=e},"update:visible-flag":function(e){t.storePopShow=e},"on-search":t.searchStore,"on-select":t.selectStore}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.itemPopShow,callback:function(e){t.itemPopShow=e},expression:"itemPopShow"}},[i("listComp",{attrs:{visibleFlag:t.itemPopShow,data:t.itemList,loadFinished:t.itemListLoadFinished,loading:t.onItemLoading,title:"品项检索"},on:{"update:visibleFlag":function(e){t.itemPopShow=e},"update:visible-flag":function(e){t.itemPopShow=e},"update:loading":function(e){t.onItemLoading=e},"on-search":t.searchItem,"on-select":t.selectItem,"on-load":t.onItemLoad}})],1)],1)},T=[],P=i("768b"),L=i("f6bb"),O=i("eb03"),A=50,$={name:"filterPop",components:{listComp:L["a"],filterListPopup:O["a"]},props:{visibleFlag:Boolean,filterParams:{type:Object,default:function(){return{}}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},dateType:"",currentDate:new Date,beginDate:this.$fxCommon.orderFilterStartDate(),endDate:this.$fxCommon.orderFilterEndDate(),shop:"请选择",shopId:"",outHouse:"请选择",outHouseId:"",store:"请选择",storeId:"",item:"请选择",itemId:"",billNo:"",datePickerShow:!1,outHousePopShow:!1,storePopShow:!1,itemPopShow:!1,outHouseList:[],shopPopShow:!1,storeList:[],itemList:[],itemListStart:0,onItemLoading:!1,itemListLoadFinished:!1}},watch:{visibleFlag:{handler:function(t){t&&this.$fxUtils.isEmptyObjSHW(this.filterParams)&&this.resetHandler()},immediate:!0}},computed:Object(u["a"])({},Object(h["c"])({loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}})),methods:{getFilterParams:function(){return{beginDate:this.beginDate||this.$fxCommon.orderFilterStartDate(),endDate:this.endDate||this.$fxCommon.orderFilterEndDate(),outHouseId:this.outHouseId,shopId:this.shopId,storeId:this.storeId,itemId:this.itemId,billNo:this.billNo}},onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onConfirmClick:function(){this.$emit("update:visibleFlag",!1),this.$emit("update:filterParams",this.getFilterParams()),this.$emit("on-confirm",this.getFilterParams())},onResetClick:function(){this.resetHandler()},resetHandler:function(){this.beginDate=this.$fxCommon.orderFilterStartDate(),this.endDate=this.$fxCommon.orderFilterEndDate(),this.outHouse="请选择",this.outHouseId="",this.shop="请选择",this.shopId="",this.store="请选择",this.storeId="",this.item="请选择",this.itemId="",this.billNo=""},onBeginDateClick:function(){this.dateType="begin",this.beginDate&&(this.currentDate=new Date(this.beginDate)),this.datePickerShow=!0},endDateClick:function(){this.dateType="end",this.endDate&&(this.currentDate=new Date(this.endDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){"begin"===this.dateType?(this.beginDate=this.$fxUtils.setDateTime(t,"时分"),this.endDate&&this.$fxCommon.orderFilterRangeDate(this.beginDate,this.endDate)||(this.endDate=this.$fxCommon.orderFilterDate(t))):(this.endDate=this.$fxUtils.setDateTime(t,"时分"),this.beginDate&&this.$fxCommon.orderFilterRangeDate(this.beginDate,this.endDate)||(this.beginDate=this.$fxCommon.orderFilterStartDate(t))),this.datePickerShow=!1},onShopClick:function(){this.shopPopShow=!0},selectShop:function(t){var e=Object(P["a"])(t,1),i=e[0];this.shop=i.name,this.shopId=i.id,this.outHouse="请选择",this.outHouseId="",this.store="请选择",this.storeId=""},getShopListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,o={keyword:t,start:e,size:i};return this.$fxApi("z5common.getUserManageShop")({data:o}).then(function(t){return t.shops})},onStoreClick:function(){if(!this.shopId)return this.$fxToast.fail("请先选择机构!"),!1;this.onStoreRefresh()},searchStore:function(t){this.onStoreRefresh(t)},selectStore:function(t){this.store=t.name,this.storeId=t.id},onStoreRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getStoreListData(e).then(function(e){t.storeList=e.shops,t.storePopShow=!0})},getStoreListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new l.a(function(i){var o={keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/houses"),data:o}).then(function(t){i(t)})})},onOutHouseClick:function(){if(!this.shopId)return this.$fxToast.fail("请先选择机构!"),!1;this.onOutHouseRefresh()},searchOutHouse:function(t){this.onOutHouseRefresh(t)},selectOutHouse:function(t){this.outHouse=t.name,this.outHouseId=t.id},onOutHouseRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getOutHouseListData(e).then(function(e){t.outHouseList=e.shops,t.outHousePopShow=!0})},getOutHouseListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new l.a(function(i){var o={keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/houses"),data:o}).then(function(t){i(t)})})},onItemClick:function(){this.onItemRefresh()},searchItem:function(t){this.onItemRefresh(t)},selectItem:function(t){this.item=t.name,this.itemId=t.id},onItemRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.itemListStart=0,this.getItemListData(e).then(function(e){t.itemPopShow=!0,t.onItemLoading=!1,t.itemListStart+=A,t.itemListLoadFinished=e.goods.length<A,t.itemList=e.goods})},onItemLoad:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getItemListData(e).then(function(e){var i;t.onItemLoading=!1,t.itemListStart+=A,e.goods.length<A&&(t.itemListLoadFinished=!0),(i=t.itemList).push.apply(i,Object(a["a"])(e.goods))})},getItemListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new l.a(function(i){var o={start:t.itemListStart,size:A,paged:!0,keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/goods"),data:o}).then(function(t){i(t)})})}}},F=$,E=(i("bcf0"),Object(k["a"])(F,B,T,!1,null,"54d5a76a",null)),H=E.exports,R=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"bill-filter fx-shadow-down"},[i("div",{staticClass:"filter-item",on:{click:t.onStateClick}},[i("span",[t._v("审核状态")]),i("van-icon",{staticClass:"filter-arrow",attrs:{name:"arrow-down"}}),i("span",[t._v(t._s(t.state))])],1)])},_=[],N={name:"filterTab",props:{state:String},methods:{onStateClick:function(){this.$emit("on-state-click")}}},z=N,U=(i("c009"),Object(k["a"])(z,R,_,!1,null,"c0cc4048",null)),j=U.exports,K=50,W={name:"carBill",components:{headSearchBtn:d["a"],headEditBtn:f["a"],headSelectAllBtn:m["a"],emptyBill:p["a"],orderBlock:x,filterPop:H,filterTab:j},data:function(){return{orderList:[],filterPopShow:!1,filterState:null,stateActionShow:!1,stateActions:[{id:null,name:"全部"},{id:"0",name:"未审核"},{id:"1",name:"已审核"}],listStart:0,pullRefreshLoading:!1,listLoading:!1,loadFinished:!0,listError:!1,orderEditFlag:!1,filterParams:{}}},beforeRouteEnter:function(t,e,i){var o=["/main/home","/"],n=["/carBillDetails"];o.includes(e.path)?i(function(e){e.restFilterParams(),e.restRouterParams(t.params),e.refreshOrderList()}):n.includes(e.path)?i(function(t){t.refreshOrderList()}):i()},computed:Object(u["a"])({},Object(h["c"])({billListPostParams:"billListPostParams",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{computedState:function(){var t=this;return this.stateActions.find(function(e){return e.id===t.filterState}).name},computedShowOrder:function(t){var e=this;return function(t){return!e.orderEditFlag||1!==t}},isSelectAll:function(){var t=this.orderList.filter(function(t){return 1!==t.billState});if(0===t.length)return!1;var e=t.filter(function(t){return!!t.checked});return e.length===t.length}}),methods:{orderListPostHandler:function(t){var e=this;return new l.a(function(i){e.$store.commit({type:"SETSTATE",billListPostParams:t}),e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/carBill/users/").concat(e.loginerId),data:t}).then(function(t){i(t)})})},refreshOrderList:function(){var t=this;return new l.a(function(e){t.listStart=0;var i={start:t.listStart,size:K,paged:!0,businessDateStart:t.$fxCommon.orderFilterStartDate(),businessDateEnd:t.$fxCommon.orderFilterEndDate(),billState:t.filterState};i=r()(i,t.translateFilterParams(t.filterParams)),t.orderListPostHandler(i).then(function(i){t.orderList=i.carBills,e(i)})})},onFilterConfirm:function(t){var e=this;this.listStart=0;var i={start:this.listStart,size:K,paged:!0,businessDateStart:t.beginDate,businessDateEnd:t.endDate,billState:this.filterState,outHouseId:""===t.outHouseId?null:t.outHouseId,shopId:""===t.shopId?null:t.shopId,inHouseId:""===t.storeId?null:t.storeId,goodsId:""===t.itemId?null:t.itemId,sysBillCode:""===t.billNo?null:t.billNo};this.orderListPostHandler(i).then(function(t){e.orderList=t.carBills})},translateFilterParams:function(t){return this.$fxUtils.isEmptyObjSHW(t)?{}:{businessDateStart:t.beginDate,businessDateEnd:t.endDate,outHouseId:""===t.outHouseId?null:t.outHouseId,shopId:""===t.shopId?null:t.shopId,inHouseId:""===t.storeId?null:t.storeId,goodsId:""===t.itemId?null:t.itemId,sysBillCode:""===t.billNo?null:t.billNo}},onPullRefresh:function(){var t=this;this.refreshOrderList().then(function(e){t.pullRefreshLoading=!1})},onLoadMore:function(){var t=this,e=r()(this.billListPostParams,{start:this.listStart});this.orderListPostHandler(e).then(function(e){var i;(i=t.orderList).push.apply(i,Object(a["a"])(e.carBills))})},onSearchClick:function(){this.filterPopShow=!0},onStateClick:function(){this.stateActionShow=!0},onStateSelect:function(t){this.filterState=t.id,this.stateActionShow=!1,this.refreshOrderList()},onClickOrder:function(t){this.$router.push({path:"carBillDetails",query:{orderId:t.id}})},onCreateClick:function(){this.$router.push("createCarBill")},onOrderEditClick:function(){this.orderEditFlag=!this.orderEditFlag},onExpressClick:function(){var t=this,e=this.orderList.reduce(function(t,e){var i=e.checked?t.concat(e.id):t;return i},[]);if(0===e.length)return!1;this.$dialog.confirm({title:"提示",message:"确定要审核所选单据?"}).then(function(){t.expressHandler(e).then(function(e){t.orderEditFlag=!t.orderEditFlag,t.refreshOrderList().then(function(){t.$fxToast.success(e.message)})}).catch(function(){t.refreshOrderList()})})},expressHandler:function(t){var e=this;return new l.a(function(i,o){e.$fxHttp.requestPut({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/carBill/users/").concat(e.loginerId),data:t,query:{m:"batchCheck"}}).then(function(t){i(t)}).catch(function(t){o(t)})})},onSelectAllClick:function(){var t=this,e=!this.isSelectAll;this.orderList.forEach(function(i){1!==i.billState&&t.$set(i,"checked",e)})},restFilterParams:function(){this.filterParams={},this.filterState=null,this.orderEditFlag=!1},restRouterParams:function(t){this.$fxUtils.isEmptyObjSHW(t)||(this.filterState=t.billState)}}},q=W,M=(i("f470"),Object(k["a"])(q,o,n,!1,null,"6b767ec6",null));e["default"]=M.exports},"6f47":function(t,e,i){},"727f":function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-carBill-create"},[i("w-header",{attrs:{title:"新增加工单",border:!0}}),i("orderInfo",{ref:"orderInfo",attrs:{data:t.orderInfoData,collapseDisabled:t.itemInputFocusing},on:{"on-busdate-click":t.onBusinessDateClick,"on-shop-click":t.onShopClick,"on-inStore-click":t.onInStoreClick,"on-outStore-click":t.onOutStoreClick,"on-billType-click":t.onBillTypeClick,"on-billType-clear":t.onBillTypeClear}}),i("orderItem",{attrs:{data:t.orderItemList,itemInputFocusing:t.itemInputFocusing},on:{"update:itemInputFocusing":function(e){t.itemInputFocusing=e},"update:item-input-focusing":function(e){t.itemInputFocusing=e},"on-add-click":t.onAddClick,"on-search-click":t.onSearchClick,"on-unit-edit":t.onUnitEdit,"on-item-edit":t.onItemEdit,"on-bom-view":t.onBomView,"on-item-focus":t.onItemFocus}}),i("div",{staticClass:"carBill-bottom"},[i("van-button",{staticClass:"add-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onCreateClick}},[t._v("生成单据")])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.shopPopShow,callback:function(e){t.shopPopShow=e},expression:"shopPopShow"}},[i("listComp",{attrs:{visibleFlag:t.shopPopShow,data:t.shopList,loadFinished:t.shopListLoadFinished,loading:t.onShopLoading,title:"请选择机构"},on:{"update:visibleFlag":function(e){t.shopPopShow=e},"update:visible-flag":function(e){t.shopPopShow=e},"update:loading":function(e){t.onShopLoading=e},"on-search":t.searchShop,"on-select":t.selectShop,"on-load":t.onShopLoad}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right"},model:{value:t.inStorePopShow,callback:function(e){t.inStorePopShow=e},expression:"inStorePopShow"}},[i("listComp",{attrs:{visibleFlag:t.inStorePopShow,data:t.inStoreList,title:"成品仓库检索",loadFinished:!0},on:{"update:visibleFlag":function(e){t.inStorePopShow=e},"update:visible-flag":function(e){t.inStorePopShow=e},"on-select":t.selectInStore,"on-search":t.searchInStore}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right"},model:{value:t.outStorePopShow,callback:function(e){t.outStorePopShow=e},expression:"outStorePopShow"}},[i("listComp",{attrs:{visibleFlag:t.outStorePopShow,data:t.outStoreList,title:"材料仓库检索",loadFinished:!0},on:{"update:visibleFlag":function(e){t.outStorePopShow=e},"update:visible-flag":function(e){t.outStorePopShow=e},"on-select":t.selectOutStore,"on-search":t.searchOutStore}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.billTypePopShow,callback:function(e){t.billTypePopShow=e},expression:"billTypePopShow"}},[i("listComp",{attrs:{visibleFlag:t.billTypePopShow,data:t.billTypeList,loadFinished:!0,title:"单据类型检索"},on:{"update:visibleFlag":function(e){t.billTypePopShow=e},"update:visible-flag":function(e){t.billTypePopShow=e},"on-search":t.searchBillType,"on-select":t.selectBillType}})],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemPopShow,callback:function(e){t.itemPopShow=e},expression:"itemPopShow"}},[i("itemEditComp",{attrs:{visibleFlag:t.itemPopShow,inHouseId:t.orderInfoData.inHouseDTO&&t.orderInfoData.inHouseDTO.id,outHouseId:t.orderInfoData.outHouseDTO&&t.orderInfoData.outHouseDTO.id,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,parentStoreItem:t.orderItemList},on:{"update:visibleFlag":function(e){t.itemPopShow=e},"update:visible-flag":function(e){t.itemPopShow=e},"on-confirm":t.onItemEditConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,inHouseId:t.orderInfoData.inHouseDTO&&t.orderInfoData.inHouseDTO.id,outHouseId:t.orderInfoData.outHouseDTO&&t.orderInfoData.outHouseDTO.id,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,isBillState:!1},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemSearchPopShow,callback:function(e){t.itemSearchPopShow=e},expression:"itemSearchPopShow"}},[i("itemSearchPop",{attrs:{visibleFlag:t.itemSearchPopShow,data:t.searchItem,orderInfoData:t.orderInfoData,isDisabled:!t.$fxAuth("carBill.save")},on:{"update:visibleFlag":function(e){t.itemSearchPopShow=e},"update:visible-flag":function(e){t.itemSearchPopShow=e},"on-bom-view":t.onBomView,"on-search-confirm":t.onSearchConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.orderBomPopShow,callback:function(e){t.orderBomPopShow=e},expression:"orderBomPopShow"}},[i("orderBomPop",{attrs:{visibleFlag:t.orderBomPopShow,itemData:t.itemEditRowData,orderInfoData:t.orderInfoData,isBillState:!1,isDisabled:!t.$fxAuth("carBill.save")},on:{"update:visibleFlag":function(e){t.orderBomPopShow=e},"update:visible-flag":function(e){t.orderBomPopShow=e},"on-bom-save":t.onBomSave}})],1)],1)},n=[],a=i("f499"),s=i.n(a),r=(i("20d6"),i("7f7f"),i("5176")),c=i.n(r),l=(i("ac6a"),i("a481"),i("59ad")),u=i.n(l),h=i("75fc"),d=i("795b"),f=i.n(d),m=i("cebc"),p=i("2f62"),v=i("2d58"),S=i("d4ff"),g=i("f6bb"),b=i("809d"),D=i("d949"),w=i("8794"),I=i("8706"),C=50,k={name:"createCarBill",components:{orderInfo:v["a"],orderItem:S["a"],listComp:g["a"],itemEditComp:b["a"],itemRowEditPop:D["a"],itemSearchPop:w["a"],orderBomPop:I["a"]},data:function(){return{query:this.$route.query,orderInfoData:{autoType:1,accountDTO:{},billEmp:"",billMemo:"",billState:0,businessTypeDTO:{},businessDate:(new Date).getTime(),inHouseDTO:{},outHouseDTO:{},shopDTO:{},manualCode:"",updateIndicator:"Append"},orderItemList:[],currentDate:new Date,datePickerShow:!1,itemPopShow:!1,shopPopShow:!1,shopList:[],searchShopKey:null,shopListStart:0,onShopLoading:!1,shopListLoadFinished:!1,inStorePopShow:!1,inStoreList:[],outStorePopShow:!1,outStoreList:[],itemEditRowData:{},unitActionShow:!1,unitActions:[],itemRowEditPopShow:!1,itemInputFocusing:!1,itemSearchPopShow:!1,billTypeList:[],billTypePopShow:!1,orderBomPopShow:!1,searchItem:[]}},computed:Object(m["a"])({},Object(p["c"])({sysPointSize:"sysPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerShopName:function(t){return t.loginer.loginerShopName},loginerOrganType:function(t){return t.loginer.loginerOrganType},loginerId:function(t){return t.loginer.loginerId}})),created:function(){this.$fxStateMiddleware.stateIs("loginerOrganType")(["shop","center"])(this.loginerOrganType)&&(this.orderInfoData.shopDTO={id:this.loginerShopId,name:this.loginerShopName})},beforeRouteLeave:function(t,e,i){var o=this;if(this.itemInputFocusing)return this.$router.go(1),!1;"/carBill"===t.path?this.$dialog.confirm({title:"提示",message:"若已修改,请先保存单据<br/>是否关闭页面?"}).then(function(){i()}).catch(function(){return o.$router.go(1),!1}):i()},methods:{onBusinessDateClick:function(){this.orderInfoData.businessDate&&(this.currentDate=new Date(this.orderInfoData.businessDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){var e=t.getTime();this.orderInfoData.businessDate=e,this.datePickerShow=!1},clearItemConfim:function(t){var e=this;return new f.a(function(i){var o=e.orderItemList.filter(function(t){return"del"!==t.changeType});0===o.length?i():e.$dialog.confirm({title:"提示",message:t}).then(function(){e.clearItemHandler(),i()}).catch(function(){})})},clearItemHandler:function(){this.orderItemList=[]},onShopClick:function(){this.shopListStart=0,this.searchShopKey=null,this.shopListLoadFinished=!1,this.onShopRefresh()},searchShop:function(t){this.shopListStart=0,this.searchShopKey=t,this.onShopRefresh(t)},onShopLoad:function(){var t=this;this.getShopListData().then(function(e){var i;(i=t.shopList).push.apply(i,Object(h["a"])(e.shops))})},selectShop:function(t){var e=this;this.checkShop(t).then(function(){e.clearItemConfim("更换机构会清空品项,是否继续?").then(function(){e.orderInfoData.shopDTO=t,e.orderInfoData.inHouseDTO={},e.orderInfoData.outHouseDTO={}})})},checkShop:function(t){var e=this;return new f.a(function(i){var o=e.orderInfoData.shopDTO||{};o.id!==t.id&&i()})},onShopRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getShopListData(e).then(function(e){t.shopPopShow=!0,t.shopList=e.shops})},getShopListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new f.a(function(i){var o={start:t.shopListStart,size:C,m:"list4ShopOtherOrderBill4Edit",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/shops"),data:o}).then(function(e){t.onShopLoading=!1,t.shopListStart+=C,e.shops.length<C?t.shopListLoadFinished=!0:t.shopListLoadFinished=!1,i(e)})})},onInStoreClick:function(){if(!this.orderInfoData.shopDTO.id)return this.$fxToast.top("请先选择机构！"),!1;this.onInStoreRefresh()},searchInStore:function(t){this.onInStoreRefresh(t)},selectInStore:function(t){var e=this;this.checkInStore(t).then(function(){e.clearItemConfim("更换成品仓库会清空品项,是否继续?").then(function(){e.orderInfoData.inHouseDTO=t})})},checkInStore:function(t){var e=this;return new f.a(function(i){var o=e.orderInfoData.inHouseDTO;o.id!==t.id&&i()})},onInStoreRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getInStoreListData(e).then(function(e){t.inStorePopShow=!0,t.inStoreList=e.shops})},getInStoreListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new f.a(function(i){var o={keyword:e,m:"list4ShopOrderBill"};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.orderInfoData.shopDTO.id,"/users/").concat(t.loginerId,"/houses"),data:o}).then(function(t){i(t)})})},onOutStoreClick:function(){if(!this.orderInfoData.shopDTO.id)return this.$fxToast.top("请先选择机构！"),!1;this.onOutStoreRefresh()},searchOutStore:function(t){this.onOutStoreRefresh(t)},selectOutStore:function(t){var e=this;this.checkOutStore(t).then(function(){e.clearItemConfim("更换材料仓库会清空品项,是否继续?").then(function(){e.orderInfoData.outHouseDTO=t})})},checkOutStore:function(t){var e=this;return new f.a(function(i){var o=e.orderInfoData.outHouseDTO;o.id!==t.id&&i()})},onOutStoreRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getOutStoreListData(e).then(function(e){t.outStorePopShow=!0,t.outStoreList=e.shops})},getOutStoreListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new f.a(function(i){var o={keyword:e,m:"list4ShopOrderBill"};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.orderInfoData.shopDTO.id,"/users/").concat(t.loginerId,"/houses"),data:o}).then(function(t){i(t)})})},onBillTypeClick:function(){this.onBillTypeRefresh()},searchBillType:function(t){this.onBillTypeRefresh(t)},selectBillType:function(t){this.orderInfoData.businessTypeDTO=t},onBillTypeClear:function(){this.orderInfoData.businessTypeDTO={}},onBillTypeRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getBillTypeListData(e).then(function(e){t.billTypeList=e.businessTypes,t.billTypePopShow=!0})},getBillTypeListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new f.a(function(i){var o={billType:"11_1",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/businessTypes"),data:o}).then(function(t){i(t)})})},onUnitEdit:function(t){var e=this;this.itemEditRowData=t,this.getItemUnit(t.goodsDTO.id).then(function(t){e.unitActions=t,e.unitActionShow=!0})},getItemUnit:function(t){var e=this;return new f.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/shopId/users/userId/goods/").concat(t,"/units"),query:{userId:e.loginerId}}).then(function(t){i(t.units)})})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemEditRowData,i=e.unitDTO,o=i.value/t.value,n=u()(this.$fxUtils.toFixedSHW(e.factCount*o,this.sysPointSize));e.unitDTO=t,e.factCount=n},onAddClick:function(){var t=this;this.checkOrderInfo().then(function(){t.itemPopShow=!0})},checkOrderInfo:function(){var t=this;return new f.a(function(e,i){for(var o=[[t.orderInfoData.businessDate,"业务日期"],[t.orderInfoData.shopDTO.id,"机构"],[t.orderInfoData.inHouseDTO.id,"成品仓库"],[t.orderInfoData.outHouseDTO.id,"材料仓库"]],n=!0,a=0;a<o.length;a++)if(!o[a][0]){t.$fxToast.top("请选择".concat(o[a][1],"！")),n=!1;break}n&&e()})},onItemEditConfirm:function(t){this.orderItemList=t},onCreateClick:function(){var t=this;if(this.itemInputFocusing)return!1;this.$dialog.confirm({title:"提示",message:"确定生成单据吗?"}).then(function(){t.checkHasDetails().then(function(){var e=t.getSaveParams();t.createHandler(e)})}).catch(function(){})},createHandler:function(t){var e=this;this.$fxHttp.requestPost({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/carBill"),data:t}).then(function(t){e.$fxToast.success("生成单据成功").then(function(){e.$router.replace({path:"carBillDetails",query:{orderId:t.carBills[0].id}})})})},getSaveParams:function(){var t=this.orderItemList.filter(function(t){return"add"===t.changeType}),e=this.orderItemList.filter(function(t){return"del"===t.changeType}),i=this.orderItemList.filter(function(t){return"edit"===t.changeType}),o=[],n=[],a=[];this.orderItemList.forEach(function(t){"add"===t.changeType?o.push.apply(o,Object(h["a"])(t.bomDetail)):"del"===t.changeType?n.push.apply(n,Object(h["a"])(t.bomDetail)):t.bomDetail.forEach(function(t){"add"===t.changeType&&o.push(t),"del"===t.changeType&&n.push(t),"edit"===t.changeType&&a.push(t)})});var s=c()({},this.orderInfoData,{finishDetailAdd:t.length>0?t:null,finishDetailDel:e.length>0?e:null,finishDetailMdf:i.length>0?i:null,bomDetailAdd:o.length>0?o:null,bomDetailDel:n.length>0?n:null,bomDetailMdf:a.length>0?a:null,accountDTO:{id:this.loginerId}});return s},checkHasDetails:function(){var t=this;return new f.a(function(e){var i="";if(t.orderItemList.forEach(function(t){var e=t.bomDetail.filter(function(t){return 0===t.factCount});e.length===t.bomDetail.length&&(i+="成品【"+t.goodsDTO.name+"】至少含一条实际数量大于零的材料</br>")}),""!==i)return t.$dialog.confirm({title:"提示",message:i}),!1;var o=t.orderItemList.filter(function(t){return"del"!==t.changeType});0===o.length?t.onAddClick():e()})},onItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this.orderItemList.findIndex(function(e){return e.goodsDTO.id===t.goodsDTO.id});~e&&(this.orderItemList[e]=t)},onItemFocus:function(){this.$refs.orderInfo.closeCollapse()},onSearchClick:function(){this.itemSearchPopShow=!0,this.searchItem=JSON.parse(s()(this.orderItemList))},onSearchConfirm:function(t){this.orderItemList=t},onBomView:function(t){this.itemEditRowData=t,this.orderBomPopShow=!0},onBomSave:function(t){var e=this.orderItemList.findIndex(function(e){return e.goodsDTO.id===t.goodsDTO.id});~e&&(this.orderItemList[e]=t)}}},y=k,x=(i("2847"),i("2877")),B=Object(x["a"])(y,o,n,!1,null,"c59a8c0c",null);e["default"]=B.exports},"733c":function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-carBill-details"},[i("w-header",{attrs:{title:t.orderInfoData.sysbillCode,titleFontSize:"3.733vw",border:!0}}),i("orderInfo",{ref:"orderInfo",attrs:{data:t.orderInfoData,isDisabled:!t.$fxAuth("carBill.save")||t.isBillState(1)||t.isWeightState(1)||t.isWeightState(2),collapseDisabled:t.itemInputFocusing},on:{"on-busdate-click":t.onBusinessDateClick,"on-shop-click":t.onShopClick,"on-inStore-click":t.onInStoreClick,"on-outStore-click":t.onOutStoreClick,"on-billType-click":t.onBillTypeClick,"on-billType-clear":t.onBillTypeClear}}),i("orderItem",{attrs:{data:t.orderItemList,isDisabled:!t.$fxAuth("carBill.save")||t.isBillState(1)||t.isWeightState(1)||t.isWeightState(2),itemInputFocusing:t.itemInputFocusing},on:{"update:itemInputFocusing":function(e){t.itemInputFocusing=e},"update:item-input-focusing":function(e){t.itemInputFocusing=e},"on-add-click":t.onAddClick,"on-search-click":t.onSearchClick,"on-unit-edit":t.onUnitEdit,"on-item-edit":t.onItemEdit,"on-bom-view":t.onBomView,"on-item-focus":t.onItemFocus}}),i("div",{staticClass:"carBill-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("carBill.del")&&t.isBillState(0)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('carBill.del') && isBillState(0) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onDeleteClick")}}},[t._v("删除")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("carBill.check")&&t.isBillState(0)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('carBill.check') && isBillState(0) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onExpressClick")}}},[t._v("审核")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("carBill.unCheck")&&t.isBillState(1)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('carBill.unCheck') && isBillState(1) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onUnExpressClick")}}},[t._v("反审")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("carBill.save")&&t.isBillState(0)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('carBill.save') && isBillState(0) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:function(e){return t.onClickHandler("onSaveClick")}}},[t._v("保存")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("carBill.weighState")&&t.isBillState(0)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('carBill.weighState') && isBillState(0) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius yellow-btn",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onWeightClick")}}},[t._v("下发称重")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("carBill.weighState")&&t.isBillState(0)&&(t.isWeightState(1)||t.isWeightState(2)),expression:"$fxAuth('carBill.weighState') && isBillState(0) && (isWeightState(1) || isWeightState(2))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onUnWeightClick")}}},[t._v("取消称重")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("carBill.weighState")&&t.isBillState(0)&&t.isWeightState(2)&&t.sysDZCManyLower,expression:"$fxAuth('carBill.weighState') && isBillState(0) && isWeightState(2) && sysDZCManyLower"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onEndWeightClick")}}},[t._v("结束称重")])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.shopPopShow,callback:function(e){t.shopPopShow=e},expression:"shopPopShow"}},[i("listComp",{attrs:{visibleFlag:t.shopPopShow,data:t.shopList,loadFinished:t.shopListLoadFinished,loading:t.onShopLoading,title:"请选择机构"},on:{"update:visibleFlag":function(e){t.shopPopShow=e},"update:visible-flag":function(e){t.shopPopShow=e},"update:loading":function(e){t.onShopLoading=e},"on-search":t.searchShop,"on-select":t.selectShop,"on-load":t.onShopLoad}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.inStorePopShow,callback:function(e){t.inStorePopShow=e},expression:"inStorePopShow"}},[i("listComp",{attrs:{visibleFlag:t.inStorePopShow,data:t.inStoreList,loadFinished:!0,title:"成品仓库检索"},on:{"update:visibleFlag":function(e){t.inStorePopShow=e},"update:visible-flag":function(e){t.inStorePopShow=e},"on-search":t.searchInStore,"on-select":t.selectInStore}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right"},model:{value:t.outStorePopShow,callback:function(e){t.outStorePopShow=e},expression:"outStorePopShow"}},[i("listComp",{attrs:{visibleFlag:t.outStorePopShow,data:t.outStoreList,title:"材料仓库检索",loadFinished:!0},on:{"update:visibleFlag":function(e){t.outStorePopShow=e},"update:visible-flag":function(e){t.outStorePopShow=e},"on-select":t.selectOutStore,"on-search":t.searchOutStore}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.billTypePopShow,callback:function(e){t.billTypePopShow=e},expression:"billTypePopShow"}},[i("listComp",{attrs:{visibleFlag:t.billTypePopShow,data:t.billTypeList,loadFinished:!0,title:"单据类型检索"},on:{"update:visibleFlag":function(e){t.billTypePopShow=e},"update:visible-flag":function(e){t.billTypePopShow=e},"on-search":t.searchBillType,"on-select":t.selectBillType}})],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemPopShow,callback:function(e){t.itemPopShow=e},expression:"itemPopShow"}},[i("itemEditComp",{attrs:{visibleFlag:t.itemPopShow,inHouseId:t.orderInfoData.inHouseDTO&&t.orderInfoData.inHouseDTO.id,outHouseId:t.orderInfoData.outHouseDTO&&t.orderInfoData.outHouseDTO.id,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,parentStoreItem:t.orderItemList},on:{"update:visibleFlag":function(e){t.itemPopShow=e},"update:visible-flag":function(e){t.itemPopShow=e},"on-confirm":t.onItemEditConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,inHouseId:t.orderInfoData.inHouseDTO&&t.orderInfoData.inHouseDTO.id,outHouseId:t.orderInfoData.outHouseDTO&&t.orderInfoData.outHouseDTO.id,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,isBillState:t.isBillState(1),isDisabled:t.isBillState(1)||!t.$fxAuth("carBill.save")||t.isWeightState(1)||t.isWeightState(2)},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemSearchPopShow,callback:function(e){t.itemSearchPopShow=e},expression:"itemSearchPopShow"}},[i("itemSearchPop",{attrs:{visibleFlag:t.itemSearchPopShow,data:t.searchItem,orderInfoData:t.orderInfoData,isDisabled:t.isBillState(1)||!t.$fxAuth("carBill.save")||t.isWeightState(1)||t.isWeightState(2)},on:{"update:visibleFlag":function(e){t.itemSearchPopShow=e},"update:visible-flag":function(e){t.itemSearchPopShow=e},"on-bom-view":t.onBomView,"on-search-confirm":t.onSearchConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.orderBomPopShow,callback:function(e){t.orderBomPopShow=e},expression:"orderBomPopShow"}},[i("orderBomPop",{attrs:{visibleFlag:t.orderBomPopShow,itemData:t.itemEditRowData,orderInfoData:t.orderInfoData,isBillState:t.isBillState(1),isDisabled:t.isBillState(1)||!t.$fxAuth("carBill.save")||t.isWeightState(1)||t.isWeightState(2)},on:{"update:visibleFlag":function(e){t.orderBomPopShow=e},"update:visible-flag":function(e){t.orderBomPopShow=e},"on-bom-save":t.onBomSave}})],1)],1)},n=[],a=i("f499"),s=i.n(a),r=(i("20d6"),i("7f7f"),i("5176")),c=i.n(r),l=i("75fc"),u=i("59ad"),h=i.n(u),d=(i("ac6a"),i("795b")),f=i.n(d),m=(i("6762"),i("2fdb"),i("6b54"),i("cebc")),p=i("2f62"),v=i("2d58"),S=i("d4ff"),g=i("f6bb"),b=i("809d"),D=i("d949"),w=i("8794"),I=i("8706"),C=50,k={name:"carBillDetails",components:{orderInfo:v["a"],orderItem:S["a"],listComp:g["a"],itemEditComp:b["a"],itemRowEditPop:D["a"],itemSearchPop:w["a"],orderBomPop:I["a"]},data:function(){return{query:this.$route.query,orderInfoData:{},orderItemList:[],currentDate:new Date,datePickerShow:!1,itemPopShow:!1,shopPopShow:!1,shopList:[],searchShopKey:null,shopListStart:0,onShopLoading:!1,shopListLoadFinished:!1,inStorePopShow:!1,inStoreListStart:0,inStoreLoading:!1,inStoreLoadFinished:!1,inStoreList:[],outStorePopShow:!1,outStoreList:[],outStoreListStart:0,outStoreLoading:!1,outStoreLoadFinished:!1,itemEditRowData:{},unitActionShow:!1,unitActions:[],itemRowEditPopShow:!1,itemInputFocusing:!1,orderDeleteFlag:!1,formatterSysPointKey:["factCount","factMoney","processingFee","sumMoney","planCount","planMoney"],itemSearchPopShow:!1,billTypeList:[],billTypePopShow:!1,orderBomPopShow:!1,searchItem:[]}},created:function(){this.createOrderDetails()},beforeRouteLeave:function(t,e,i){var o=this;if(this.itemInputFocusing)return this.$router.go(1),!1;"/carBill"!==t.path||this.orderDeleteFlag||0!==this.orderInfoData.billState?i():this.$dialog.confirm({title:"提示",message:"若已修改,请先保存单据<br/>是否关闭页面?"}).then(function(){i()}).catch(function(){return o.$router.go(1),!1})},computed:Object(m["a"])({},Object(p["c"])({sysPointSize:"sysPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerShopName:function(t){return t.loginer.loginerShopName},loginerOrganType:function(t){return t.loginer.loginerOrganType},loginerId:function(t){return t.loginer.loginerId},sysDZCManyLower:function(t){return t.systemParams.sysDZCManyLower}}),{isBillState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.billState):e.orderInfoData.billState===t}},isWeightState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.weightState):e.orderInfoData.weightState===t}}}),methods:{createOrderDetails:function(){var t=this;return new f.a(function(e){t.getOrderDetails().then(function(i){var o=i.carBills[0];t.formatterSysPoint(o.finishDetail),t.orderInfoData=o,t.orderItemList=t.filterStoreItem(o.finishDetail),e()})})},getOrderDetails:function(){var t=this;return new f.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/carBill/").concat(t.query.orderId,"/users/").concat(t.loginerId)}).then(function(t){e(t)})})},formatterSysPoint:function(t){var e=this;t.forEach(function(t){e.formatterSysPointKey.forEach(function(i){t[i]&&(t[i]=e.toFixedNumberSize(t[i]))})})},toFixedNumberSize:function(t){return h()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},filterStoreItem:function(t){var e=this;return t.forEach(function(t){var i=h()(t.factCount);e.isBillState(1)&&(t.price=e.toFixedNumberSize(t.sumMoney/i))}),t},onBusinessDateClick:function(){this.orderInfoData.businessDate&&(this.currentDate=new Date(this.orderInfoData.businessDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){var e=t.getTime();this.orderInfoData.businessDate=e,this.datePickerShow=!1},clearItemConfim:function(t){var e=this;return new f.a(function(i){var o=e.orderItemList.filter(function(t){return"del"!==t.changeType});0===o.length?i():e.$dialog.confirm({title:"提示",message:t}).then(function(){e.clearItemHandler(),i()}).catch(function(){})})},clearItemHandler:function(){var t=this.orderItemList.filter(function(t){return!!t.id});t.forEach(function(t){t.changeType="del"}),this.orderItemList=t},onShopClick:function(){this.shopListStart=0,this.searchShopKey=null,this.shopListLoadFinished=!1,this.onShopRefresh()},searchShop:function(t){this.shopListStart=0,this.searchShopKey=t,this.onShopRefresh(t)},onShopLoad:function(){var t=this;this.getShopListData().then(function(e){var i;(i=t.shopList).push.apply(i,Object(l["a"])(e.shops))})},selectShop:function(t){var e=this;this.checkShop(t).then(function(){e.clearItemConfim("更换机构会清空品项,是否继续?").then(function(){e.orderInfoData.shopDTO=t,e.orderInfoData.inHouseDTO={},e.orderInfoData.outHouseDTO={}})})},checkShop:function(t){var e=this;return new f.a(function(i){var o=e.orderInfoData.shopDTO;o.id!==t.id&&i()})},onShopRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getShopListData(e).then(function(e){t.shopList=e.shops,t.shopPopShow=!0})},getShopListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new f.a(function(i){var o={start:t.shopListStart,size:C,m:"list4ShopOtherOrderBill4Edit",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/shops"),data:o}).then(function(e){t.onShopLoading=!1,t.shopListStart+=C,e.shops.length<C?t.shopListLoadFinished=!0:t.shopListLoadFinished=!1,i(e)})})},onInStoreClick:function(){if(!this.orderInfoData.shopDTO.id)return this.$fxToast.fail("请先选择机构!"),!1;this.onInStoreRefresh()},searchInStore:function(t){this.onInStoreRefresh(t)},selectInStore:function(t){var e=this;this.checkInStore(t).then(function(){e.clearItemConfim("更换成品仓库会清空品项,是否继续?").then(function(){e.orderInfoData.inHouseDTO=t})})},checkInStore:function(t){var e=this;return new f.a(function(i){var o=e.orderInfoData.inHouseDTO;o.id!==t.id&&i()})},onInStoreRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getInStoreListData(e).then(function(e){t.inStorePopShow=!0,t.inStoreList=e.shops})},getInStoreListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new f.a(function(i){var o={keyword:e,m:"list4ShopOrderBill"};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.orderInfoData.shopDTO.id,"/users/").concat(t.loginerId,"/houses"),data:o}).then(function(t){i(t)})})},onOutStoreClick:function(){if(!this.orderInfoData.shopDTO.id)return this.$fxToast.fail("请先选择机构!"),!1;this.onOutStoreRefresh()},searchOutStore:function(t){this.onOutStoreRefresh(t)},selectOutStore:function(t){var e=this;this.checkOutStore(t).then(function(){e.clearItemConfim("更换材料仓库会清空品项,是否继续?").then(function(){e.orderInfoData.outHouseDTO=t})})},checkOutStore:function(t){var e=this;return new f.a(function(i){var o=e.orderInfoData.outHouseDTO;o.id!==t.id&&i()})},onOutStoreRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getOutStoreListData(e).then(function(e){t.outStorePopShow=!0,t.outStoreList=e.shops})},getOutStoreListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new f.a(function(i){var o={keyword:e,m:"list4ShopOrderBill"};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.orderInfoData.shopDTO.id,"/users/").concat(t.loginerId,"/houses"),data:o}).then(function(t){i(t)})})},onBillTypeClick:function(){this.onBillTypeRefresh()},searchBillType:function(t){this.onBillTypeRefresh(t)},selectBillType:function(t){this.orderInfoData.businessTypeDTO=t},onBillTypeClear:function(){this.orderInfoData.businessTypeDTO={}},onBillTypeRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getBillTypeListData(e).then(function(e){t.billTypeList=e.businessTypes,t.billTypePopShow=!0})},getBillTypeListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new f.a(function(i){var o={billType:"11_1",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/businessTypes"),data:o}).then(function(t){i(t)})})},onUnitEdit:function(t){var e=this;this.itemEditRowData=t,this.getItemUnit(t.goodsDTO.id).then(function(t){e.unitActions=t,e.unitActionShow=!0})},getItemUnit:function(t){var e=this;return new f.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/shopId/users/userId/goods/").concat(t,"/units"),query:{userId:e.loginerId}}).then(function(t){i(t.units)})})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemEditRowData,i=e.unitDTO,o=i.value/t.value,n=h()(this.$fxUtils.toFixedSHW(e.factCount*o,this.sysPointSize));e.unitDTO=t,e.factCount=n,e.id&&(e.changeType="edit")},onAddClick:function(){var t=this;this.checkOrderInfo().then(function(){t.itemPopShow=!0})},checkOrderInfo:function(){var t=this;return new f.a(function(e,i){for(var o=[[t.orderInfoData.shopDTO.id,"机构"],[t.orderInfoData.inHouseDTO.id,"成品仓库"],[t.orderInfoData.outHouseDTO.id,"材料仓库"]],n=!0,a=0;a<o.length;a++)if(!o[a][0]){t.$toast.fail("请选择".concat(o[a][1],"!")),n=!1;break}n&&e()})},onItemEditConfirm:function(t){this.orderItemList=t},onSaveClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要保存该单据吗?"}).then(function(){t.checkHasDetails().then(function(){var e=t.getSaveParams();t.saveHandler(e)})}).catch(function(){})},saveHandler:function(t){var e=this;this.$fxHttp.requestPut({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/carBill/").concat(this.query.orderId,"/users/").concat(this.loginerId),data:t,query:{m:"modifyBill"}}).then(function(t){e.createOrderDetails().then(function(){e.$fxToast.success("保存成功")})})},onExpressClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要审核该单据吗?"}).then(function(){t.checkHasDetails().then(function(){var e=t.getSaveParams();t.expressHandler(e)})}).catch(function(){})},expressHandler:function(t){var e=this;this.$fxHttp.requestPut({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/carBill/").concat(this.query.orderId,"/users/").concat(this.loginerId),data:t,query:{m:"editAndCheck"}}).then(function(t){e.createOrderDetails().then(function(){e.$fxToast.success("审核成功")})}).catch(function(t){"1"===t.errorCode&&e.createOrderDetails()})},onUnExpressClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要反审该单据吗?"}).then(function(){t.checkHasDetails().then(function(){var e=t.getSaveParams();t.unExpressHandler(e)})}).catch(function(){})},unExpressHandler:function(t){var e=this;this.$fxHttp.requestPut({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/carBill/").concat(this.query.orderId,"/users/").concat(this.loginerId),data:t,query:{m:"unCheck"}}).then(function(t){e.createOrderDetails().then(function(){e.$fxToast.success("反审成功")})})},onDeleteClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要删除该单据吗?"}).then(function(){var e=t.getSaveParams();t.$fxHttp.requestDel({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/carBill/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:e,query:{userId:t.loginerId}}).then(function(e){t.$fxToast.success("删除成功").then(function(){t.orderDeleteFlag=!0,t.$router.go(-1)})})}).catch(function(){})},onWeightClick:function(){var t=this;this.checkHasDetails().then(function(){t.$dialog.confirm({title:"提示",message:"确定要下发称重吗?"}).then(function(){var e=t.getSaveParams();if(!e)return!1;t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/carBill/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:e,query:{userId:t.loginerId,m:"weighBill"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("下发称重成功")})})}).catch(function(){})})},onUnWeightClick:function(){var t=this;this.checkHasDetails().then(function(){var e="确定要取消称重吗?";2===t.orderInfoData.weighState&&(e="称重中的单据，取消称重后电子秤可以继续称重并传回数据！确定要取消称重吗"),t.$dialog.confirm({title:"提示",message:e}).then(function(){t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/carBill/").concat(t.query.orderId,"/users/").concat(t.loginerId),query:{userId:t.loginerId,m:"unWeighBill"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("取消称重成功")})})}).catch(function(){})})},onEndWeightClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"结束称重后将不再接收此单据的称重数据"}).then(function(){t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/carBill/").concat(t.query.orderId,"/users/").concat(t.loginerId),query:{userId:t.loginerId,m:"endWeighBill"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("结束称重成功")})})}).catch(function(){})},getSaveParams:function(){var t=this.orderItemList.filter(function(t){return"add"===t.changeType}),e=this.orderItemList.filter(function(t){return"del"===t.changeType}),i=this.orderItemList.filter(function(t){return"edit"===t.changeType}),o=[],n=[],a=[];this.orderItemList.forEach(function(t){"add"===t.changeType?o.push.apply(o,Object(l["a"])(t.bomDetail)):"del"===t.changeType?n.push.apply(n,Object(l["a"])(t.bomDetail)):t.bomDetail.forEach(function(t){"add"===t.changeType&&o.push(t),"del"===t.changeType&&n.push(t),"edit"===t.changeType&&a.push(t)})});var s=c()({},this.orderInfoData,{finishDetailAdd:t.length>0?t:null,finishDetailDel:e.length>0?e:null,finishDetailMdf:i.length>0?i:null,bomDetailAdd:o.length>0?o:null,bomDetailDel:n.length>0?n:null,bomDetailMdf:a.length>0?a:null,finishDetail:[]});return s},checkHasDetails:function(){var t=this;return new f.a(function(e){var i="";if(t.orderItemList.forEach(function(t){var e=t.bomDetail.filter(function(t){return 0===t.factCount&&"del"!==t.changeType});e.length===t.bomDetail.length&&(i+="成品【"+t.goodsDTO.name+"】至少含一条实际数量大于零的材料</br>")}),""!==i)return t.$dialog.confirm({title:"提示",message:i}),!1;var o=t.orderItemList.filter(function(t){return"del"!==t.changeType});0===o.length?t.$fxToast.fail("单据明细不能为空"):e()})},onItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this.orderItemList.findIndex(function(e){return e.id===t.id});~e&&(this.orderItemList[e]=t)},onClickHandler:function(t){if(this.itemInputFocusing)return!1;this[t]()},onItemFocus:function(){this.$refs.orderInfo.closeCollapse()},onSearchClick:function(){this.itemSearchPopShow=!0,this.searchItem=JSON.parse(s()(this.orderItemList))},onSearchConfirm:function(t){this.orderItemList=t},onBomView:function(t){this.itemEditRowData=t,this.orderBomPopShow=!0},onBomSave:function(t){var e=this.orderItemList.findIndex(function(e){return e.goodsDTO.id===t.goodsDTO.id});~e&&(this.orderItemList[e]=t)}}},y=k,x=(i("1289"),i("2877")),B=Object(x["a"])(y,o,n,!1,null,"05d4f10f",null);e["default"]=B.exports},"749e":function(t,e,i){"use strict";var o=i("5b30"),n=i.n(o);n.a},"809d":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-edit"},[i("w-header",{attrs:{title:"选择成品",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}},[i("van-icon",{staticClass:"header-confirm-btn",attrs:{slot:"header-right",name:"success"},on:{click:t.onItemConfirm},slot:"header-right"})],1),i("div",{staticClass:"item-search clearfix"},[i("van-search",{attrs:{placeholder:"请输入搜索关键词",shape:"round"},on:{search:t.search},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}})],1),i("div",{staticClass:"item-edit-content"},[i("addItemClassList",{attrs:{itemClassList:t.itemClassList},on:{"on-select-class":t.selectClass},model:{value:t.currentClass,callback:function(e){t.currentClass=e},expression:"currentClass"}}),i("addItemList",{ref:"addItemList",attrs:{listLoading:t.listLoading,loadFinished:t.loadFinished,itemList:t.itemList},on:{"update:listLoading":function(e){t.listLoading=e},"update:list-loading":function(e){t.listLoading=e},"on-load-more":t.onLoadMore},scopedSlots:t._u([{key:"item-cell",fn:function(e){return[i("addItemCell",{attrs:{itemData:e.$item,itemIndex:e.$index,rowActive:t.rowActive,itemAmoutName:"factCount",showBom:!0},on:{"on-item-click":t.onItemEdit}})]}}]),model:{value:t.rowActive,callback:function(e){t.rowActive=e},expression:"rowActive"}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.numberKeyboardShow,expression:"numberKeyboardShow"}],staticClass:"details-number-keyboard"},[i("BomNumberKeyboard",{attrs:{title:t.keyboardTitleCompted,otherTitle:t.keyboardBomTitleCompted,unit:t.keyboardUnitCompted,unitEdit:!0,amount:t.keyboardAmountCompted,pointSize:t.sysPointSize,intLength:t.numberLength},on:{change:t.onKeyboardChange,"on-othertitle-edit":t.onOtherTitleClick,pre:t.onKeyboardPre,next:t.onKeyboardNext,hide:t.onKeyboardHide,"on-unit-unitEdit":t.onUnitEdit}})],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("van-actionsheet",{attrs:{actions:t.bomActions,"cancel-text":"取消"},on:{select:t.onBomSelect},model:{value:t.bomActionShow,callback:function(e){t.bomActionShow=e},expression:"bomActionShow"}})],1)},n=[],a=i("59ad"),s=i.n(a),r=(i("20d6"),i("ac6a"),i("75fc")),c=i("795b"),l=i.n(c),u=i("f499"),h=i.n(u),d=(i("7f7f"),i("cebc")),f=i("2f62"),m=i("d444"),p=i("01f7"),v=i("9c7f"),S=i("91c3"),g=10,b={name:"itemEditComp",components:{addItemClassList:m["a"],addItemList:p["a"],addItemCell:v["a"],BomNumberKeyboard:S["a"]},props:{visibleFlag:Boolean,shopId:String,inHouseId:String,outHouseId:String,parentStoreItem:{type:Array,default:function(){return[]}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",currentClass:"",itemClassList:[],itemList:[],numberKeyboardShow:!1,rowActive:"",selectedItemArr:[],itemListStart:0,listLoading:!1,loadFinished:!0,listError:!1,unitActionShow:!1,unitActions:[],bomActionShow:!1,bomActions:[]}},computed:Object(d["a"])({},Object(f["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{keyboardTitleCompted:function(){if(""===this.rowActive)return"";var t=this.itemList[this.rowActive];return t.goodsDTO.name},keyboardBomTitleCompted:function(){if(""===this.rowActive)return"";var t=this.itemList[this.rowActive];return t.bomDTO.name},keyboardUnitCompted:function(){if(""===this.rowActive)return"";var t=this.itemList[this.rowActive];return t.unitDTO.name},keyboardAmountCompted:function(){if(""===this.rowActive)return"0";var t=this.itemList[this.rowActive];return t.factCount}}),watch:{visibleFlag:{handler:function(t){t&&(this.selectedItemArr=JSON.parse(h()(this.parentStoreItem)),this.refresh())},immediate:!0},rowActive:function(t,e){""!==e&&(this.numberStringAmount(e),this.pushSelectedItem(this.itemList[e]),""===t&&(this.numberKeyboardShow=!1))}},methods:{refresh:function(){var t=this;this.searchKey="",this.getItemClass().then(function(e){t.itemClassList=e.goodsTypes,t.currentClass="",t.getItemByClass()})},onCloseClick:function(){this.rowActive="",this.$emit("update:visibleFlag",!1)},onItemConfirm:function(){var t=this;this.rowActive="",this.$nextTick(function(){t.$emit("on-confirm",t.selectedItemArr),t.$emit("update:visibleFlag",!1)})},search:function(){this.getItemByClass()},getItemClass:function(){var t=this;return new l.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.inHouseId,"/users/").concat(t.loginerId,"/goodTypes")}).then(function(t){e(t)})})},getItem:function(){var t=this;return new l.a(function(e){var i={start:t.itemListStart,size:g,paged:!0,shopId:t.shopId,goodsTypeId:t.currentClass||null,inId:t.inHouseId,outId:t.outHouseId,searchText:t.searchKey||null};t.$fxHttp.requestPost({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/carBill"),data:i,query:{m:"getFinishGoodsList"}}).then(function(t){e(t)})})},getItemByClass:function(){var t=this;this.itemListStart=0,this.getItem().then(function(e){t.itemList=t.setResItem(e.finishGoods),t.setListLoading(e.finishGoods.length),t.$nextTick(function(){t.$refs.addItemList&&t.$refs.addItemList.onSelectLetter(0,5)})})},onLoadMore:function(){var t=this;this.getItem().then(function(e){var i;(i=t.itemList).push.apply(i,Object(r["a"])(t.setResItem(e.finishGoods))),t.setListLoading(e.finishGoods.length)})},setResItem:function(t){var e=this;return t.forEach(function(t){var i=e.selectedItemArr.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id});~i&&"del"!==e.selectedItemArr[i].changeType?(t.factCount=e.selectedItemArr[i].factCount,t.unitDTO=e.selectedItemArr[i].unitDTO,t.bomDetail=e.selectedItemArr[i].bomDetail,t.bomDTO=e.selectedItemArr[i].bomDTO):t.factCount="0"}),t},setListLoading:function(t){this.listLoading=!1,this.itemListStart+=g,this.loadFinished=t<g},selectClass:function(){this.searchKey="",this.onKeyboardHide(),this.getItemByClass()},onItemEdit:function(t){this.rowActive=t,this.numberKeyboardShow=!0,this.$refs.addItemList.onSelectLetter(this.rowActive,20)},onKeyboardChange:function(t){this.itemList[this.rowActive].factCount=t},numberStringAmount:function(t){var e=this.itemList[t].factCount;this.itemList[t].factCount=s()(e),this.calcMoneyByCount(e,this.itemList[t])},calcMoneyByCount:function(t,e){var i=this;e.factMoney=this.toFixedNumberSize(e.price*t,this.sysPointSize),e.taxInMoney=this.toFixedNumberSize(e.factMoney*e.tax,this.sysPointSize),e.bomDetail.forEach(function(e){var o=e.crude;i.$fxSysAuth("carBill.sysCarBillChangeAmount")&&(e.factCount=i.toFixedNumberSize(t*o)),e.theoryCount=i.toFixedNumberSize(t*o),e.id&&"del"!==e.changeType&&(e.changeType="edit")})},toFixedNumberSize:function(t){return s()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},pushSelectedItem:function(t){var e=this.selectedItemArr.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id});~e?this.selectedItemArr[e].id||0!==t.factCount?(this.selectedItemArr[e].id&&0===t.factCount?this.selectedItemArr[e].changeType="del":this.selectedItemArr[e].id&&(this.selectedItemArr[e].changeType="edit"),this.selectedItemArr[e].factCount=t.factCount,this.selectedItemArr[e].unitDTO=t.unitDTO,this.selectedItemArr[e].bomDTO=t.bomDTO,this.selectedItemArr[e].bomDetail=t.bomDetail):this.selectedItemArr.splice(e,1):t.factCount>0&&(t.changeType="add",this.$fxSysAuth("carBill.SysDefaultDate")&&(t.produceDate=(new Date).getTime()),this.selectedItemArr.push(t))},onKeyboardPre:function(){if(!this.rowActive)return!1;this.rowActive--,this.$refs.addItemList.onSelectLetter(this.rowActive,5)},onKeyboardNext:function(){if(""===this.rowActive||this.rowActive===this.itemList.length-1)return!1;this.rowActive++,this.$refs.addItemList.onSelectLetter(this.rowActive,5)},onKeyboardHide:function(){this.rowActive=""},onUnitEdit:function(){var t=this,e=this.itemList[this.rowActive].goodsDTO.id;this.getItemUnit(e).then(function(e){t.unitActions=e,t.unitActionShow=!0})},getItemUnit:function(t){var e=this;return new l.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/shopId/users/userId/goods/").concat(t,"/units"),query:{userId:e.loginerId}}).then(function(t){i(t.units)})})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemList[this.rowActive],i=e.unitDTO,o=i.value/t.value,n=s()(this.$fxUtils.toFixedSHW(e.factCount*o,this.sysPointSize));e.unitDTO=t,e.factCount=n},onOtherTitleClick:function(){var t=this,e=this.itemList[this.rowActive].goodsDTO.id;this.getBom(e).then(function(e){t.bomActions=t.resetBomList(e.carBomGoods),t.bomActionShow=!0})},resetBomList:function(t){return t.map(function(t){return t.bomDTO.bomDetail=t.bomDetail,t.bomDTO.unitDTO=t.unitDTO,t.bomDTO})},getBom:function(t){var e=this;return new l.a(function(i){var o={shopId:e.shopId,goodsId:t};e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.shopId,"/carBill"),data:o,query:{m:"getBomList"}}).then(function(t){i(t)})})},onBomSelect:function(t){var e,i=this;this.bomActionShow=!1;var o=this.itemList[this.rowActive];t.bomDetail.forEach(function(e){var n=t.crude;i.$fxSysAuth("carBill.sysCarBillChangeAmount")&&(e.factCount=i.toFixedNumberSize(o.factCount*n)),e.theoryCount=i.toFixedNumberSize(o.factCount*n),e.id&&(e.changeType="edit")});var n=o.bomDetail;t.bomDetail.forEach(function(t){t.changeType="add"});for(var a=n.length-1;a>-1;a--){var s=n[a];s.id?s.changeType="del":n.splice(a,1)}o.bomDTO=t,(e=o.bomDetail).push.apply(e,Object(r["a"])(t.bomDetail)),o.unitDTO=t.unitDTO}}},D=b,w=(i("e185"),i("2877")),I=Object(w["a"])(D,o,n,!1,null,"464b7006",null);e["a"]=I.exports},8706:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-carBill-details"},[i("w-header",{attrs:{title:"查看BOM明细",titleFontSize:"3.733vw",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{staticClass:"goods-title"},[t._v("成品品项："+t._s(t.itemData.goodsDTO.name))]),i("orderBom",{attrs:{data:t.orderBomList,isDisabled:!t.$fxAuth("carBill.save")||t.isBillState(1)||t.isWeightState(1)||t.isWeightState(2)||t.currentItemData.bomDTO.lockFlag,bomInputFocusing:t.bomInputFocusing},on:{"update:bomInputFocusing":function(e){t.bomInputFocusing=e},"update:bom-input-focusing":function(e){t.bomInputFocusing=e},"on-add-click":t.onAddClick,"on-search-click":t.onSearchClick,"on-unit-edit":t.onUnitEdit,"on-bom-edit":t.onBomEdit,"on-bom-focus":t.onBomFocus,"on-bom-blur":t.onBomBlur}}),i("div",{staticClass:"carBill-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:function(e){return t.onClickHandler("onSaveClick")}}},[t._v("保存")])],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.bomPopShow,callback:function(e){t.bomPopShow=e},expression:"bomPopShow"}},[i("bomEditComp",{attrs:{visibleFlag:t.bomPopShow,itemId:t.itemData.goodsDTO.id,outHouseId:t.orderInfoData.outHouseDTO&&t.orderInfoData.outHouseDTO.id,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,parentStoreBom:t.orderBomList},on:{"update:visibleFlag":function(e){t.bomPopShow=e},"update:visible-flag":function(e){t.bomPopShow=e},"on-confirm":t.onBomEditConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.bomRowEditPopShow,callback:function(e){t.bomRowEditPopShow=e},expression:"bomRowEditPopShow"}},[i("bomRowEditPop",t._b({attrs:{visibleFlag:t.bomRowEditPopShow,bomData:t.bomEditRowData,isDisabled:t.isDisabled},on:{"update:visibleFlag":function(e){t.bomRowEditPopShow=e},"update:visible-flag":function(e){t.bomRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}},"bomRowEditPop",t.$attrs,!1))],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.bomSearchPopShow,callback:function(e){t.bomSearchPopShow=e},expression:"bomSearchPopShow"}},[i("bomSearchPop",{attrs:{visibleFlag:t.bomSearchPopShow,data:t.searchBom,isDisabled:t.isDisabled},on:{"update:visibleFlag":function(e){t.bomSearchPopShow=e},"update:visible-flag":function(e){t.bomSearchPopShow=e},"on-search-confirm":t.onSearchConfirm}})],1)],1)},n=[],a=(i("20d6"),i("5176")),s=i.n(a),r=i("795b"),c=i.n(r),l=i("59ad"),u=i.n(l),h=(i("ac6a"),i("f499")),d=i.n(h),f=(i("6762"),i("2fdb"),i("6b54"),i("cebc")),m=i("2f62"),p=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-item-block fx-shadow-block"},[i("div",{staticClass:"item-title"},[i("span",{staticClass:"title-name"},[t._v("BOM明细")]),i("span",{staticClass:"title-count"},[t._v("明细：")]),i("span",[t._v(t._s(t.detailsLength))]),i("i",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&t.$fxAuth("carBill.addDetail"),expression:"!isDisabled && $fxAuth('carBill.addDetail')"}],staticClass:"title-add-icon fl-r",on:{click:t.onAddClick}}),i("i",{staticClass:"title-search-icon fl-r",on:{click:t.onSearchClick}})]),i("div",{ref:"details-content",staticClass:"item-list"},t._l(t.data,function(e,o){return i("van-swipe-cell",{directives:[{name:"show",rawName:"v-show",value:"del"!==e.changeType,expression:"item.changeType !== 'del'"}],key:e.goodsDTO.id,ref:"details-row-"+e.goodsDTO.id,refInFor:!0,staticClass:"item-row",attrs:{"right-width":80,disabled:t.isDisabled||t.focusing||!t.$fxAuth("carBill.delDetail")}},[i("bomInfoCell",t._g({attrs:{itemData:e,isDisabled:t.isDisabled,disabledEditBtn:t.focusing},on:{"on-bom-focus":function(i){return t.onBomFocus(arguments,""+e.goodsDTO.id)},"on-bom-blur":t.onBomBlur}},t.$listeners)),i("div",{staticClass:"item-row-delete",attrs:{slot:"right"},on:{click:function(i){return t.onDeleteClick(e,o,t.data)}},slot:"right"},[t._v("删除")])],1)}),1)])},v=[],S=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-info-cell"},[i("div",{staticClass:"item-img"},[i("img",{attrs:{src:t.comptedItemImgSrc(t.itemData.goodsDTO.imageUrls),onerror:t.$fxCommon.errorImg("item")}})]),i("div",{staticClass:"item-details"},[i("div",{staticClass:"item-name fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.name))]),i("div",{staticClass:"details-cell"},[i("div",{staticClass:"item-taxprice fx-ellipsis"},[i("span",[t._v("金额：￥")]),i("span",[t._v(t._s(t.itemData.factMoney))])])]),i("div",{staticClass:"details-cell"},[i("div",{staticClass:"item-spec fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.spec))]),t.isDisabled?i("div",{staticClass:"item-amount"},[i("span",{staticClass:"item-amount-text"},[t._v(t._s(t.itemData.factCount))])]):i("div",{staticClass:"item-amount-edit"},[i("w-stepper",{ref:"amountInput",staticClass:"amount-step",attrs:{min:"0",max:t.maxAmount,stepperBtnShow:!1,intLength:t.numberLength,pointSize:t.sysPointSize,inputWidth:"28vw"},on:{change:t.onChange,blur:t.onBlur},model:{value:t.itemData.factCount,callback:function(e){t.$set(t.itemData,"factCount",e)},expression:"itemData.factCount"}})],1),i("div",{staticClass:"unit-text"},[i("span",{staticClass:"cell-unit fx-ellipsis",on:{click:function(e){return e.stopPropagation(),t.onUnitClick(e)}}},[t._v(t._s(t.itemData.unitDTO.name))]),i("van-icon",{staticClass:"unit-icon",attrs:{name:"arrow-down"}})],1)])]),i("i",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&!t.disabledEditBtn,expression:"!isDisabled && !disabledEditBtn"}],staticClass:"block-item-edit",on:{click:t.onItemEditClick}}),i("i",{directives:[{name:"show",rawName:"v-show",value:t.isDisabled,expression:"isDisabled"}],staticClass:"block-item-watch",on:{click:t.onItemEditClick}})])},g=[],b={name:"bomInfoCell",props:{itemData:{type:Object,default:function(){return{}}},isDisabled:Boolean,disabledEditBtn:Boolean},computed:Object(f["a"])({},Object(m["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",maxAmount:"maxAmount"}),{comptedItemImgSrc:function(t){return function(t){return t?0===t.length?"":t[0]:""}}}),methods:{editItem:function(){this.itemData.id&&this.$set(this.itemData,"changeType","edit")},onItemEditClick:function(){this.editItem(),this.$emit("on-bom-edit",this.itemData)},onChange:function(t){if("del"===this.itemData.changeType)return!1;this.editItem()},onUnitClick:function(){if(this.isDisabled)return!1;this.editItem(),this.$emit("on-unit-edit",this.itemData)},onFocus:function(){this.$emit("on-bom-focus")},onBlur:function(){this.$emit("on-bom-blur")}}},D=b,w=(i("3ad4"),i("2877")),I=Object(w["a"])(D,S,g,!1,null,"0c292e86",null),C=I.exports,k={name:"orderItem",components:{bomInfoCell:C},props:{data:{type:Array,default:function(){return[]}},isDisabled:Boolean,itemInputFocusing:Boolean},data:function(){return{focusing:!1}},computed:{detailsLength:function(){return this.data.filter(function(t){return"del"!==t.changeType}).length}},watch:{focusing:function(t){this.$emit("update:itemInputFocusing",t)}},methods:{onAddClick:function(){if(this.isDisabled||this.focusing)return!1;this.$emit("on-add-click")},onSearchClick:function(){if(this.focusing)return!1;this.$emit("on-search-click")},onDeleteClick:function(t,e,i){t.id?this.$set(t,"changeType","del"):i.splice(e,1)},onBomFocus:function(t,e){this.focusing=!0},onBomBlur:function(){this.focusing=!1}}},y=k,x=(i("dc18"),Object(w["a"])(y,p,v,!1,null,"07cdd6e9",null)),B=x.exports,T=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-edit"},[i("w-header",{attrs:{title:"选择材料品项",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}},[i("van-icon",{staticClass:"header-confirm-btn",attrs:{slot:"header-right",name:"success"},on:{click:t.onItemConfirm},slot:"header-right"})],1),i("div",{staticClass:"item-search clearfix"},[i("van-search",{attrs:{placeholder:"请输入搜索关键词",shape:"round"},on:{search:t.search},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}})],1),i("div",{staticClass:"item-edit-content"},[i("addItemClassList",{attrs:{itemClassList:t.itemClassList},on:{"on-select-class":t.selectClass},model:{value:t.currentClass,callback:function(e){t.currentClass=e},expression:"currentClass"}}),i("addItemList",{ref:"addItemList",attrs:{listLoading:t.listLoading,loadFinished:t.loadFinished,itemList:t.itemList},on:{"update:listLoading":function(e){t.listLoading=e},"update:list-loading":function(e){t.listLoading=e},"on-load-more":t.onLoadMore},scopedSlots:t._u([{key:"item-cell",fn:function(e){return[i("addItemCell",{attrs:{itemData:e.$item,itemIndex:e.$index,rowActive:t.rowActive,itemAmoutName:"factCount"},on:{"on-item-click":t.onItemEdit}})]}}]),model:{value:t.rowActive,callback:function(e){t.rowActive=e},expression:"rowActive"}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.numberKeyboardShow,expression:"numberKeyboardShow"}],staticClass:"details-number-keyboard"},[i("itemNumberKeyboard",{attrs:{title:t.keyboardTitleCompted,unit:t.keyboardUnitCompted,amount:t.keyboardAmountCompted,pointSize:t.sysPointSize,intLength:t.numberLength,unitEdit:!0},on:{change:t.onKeyboardChange,pre:t.onKeyboardPre,next:t.onKeyboardNext,hide:t.onKeyboardHide,"on-unit-unitEdit":t.onUnitEdit}})],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}})],1)},P=[],L=i("75fc"),O=(i("7f7f"),i("d444")),A=i("01f7"),$=i("9c7f"),F=i("af41"),E=10,H={name:"bomEditComp",components:{addItemClassList:O["a"],addItemList:A["a"],addItemCell:$["a"],itemNumberKeyboard:F["a"]},props:{visibleFlag:Boolean,itemId:String,shopId:String,outHouseId:String,parentStoreBom:{type:Array,default:function(){return[]}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",currentClass:"",itemClassList:[],itemList:[],numberKeyboardShow:!1,rowActive:"",selectedItemArr:[],itemListStart:0,listLoading:!1,loadFinished:!0,listError:!1,unitActionShow:!1,unitActions:[]}},computed:Object(f["a"])({},Object(m["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{keyboardTitleCompted:function(){if(""===this.rowActive)return"";var t=this.itemList[this.rowActive];return t.goodsDTO.name},keyboardUnitCompted:function(){if(""===this.rowActive)return"";var t=this.itemList[this.rowActive];return t.unitDTO.name},keyboardAmountCompted:function(){if(""===this.rowActive)return"0";var t=this.itemList[this.rowActive];return t.factCount}}),watch:{visibleFlag:{handler:function(t){t&&(this.selectedItemArr=JSON.parse(d()(this.parentStoreBom)),this.refresh())},immediate:!0},rowActive:function(t,e){""!==e&&(this.numberStringAmount(e),this.pushSelectedItem(this.itemList[e]),""===t&&(this.numberKeyboardShow=!1))}},methods:{refresh:function(){var t=this;this.searchKey="",this.getItemClass().then(function(e){t.itemClassList=e.goodsTypes,t.currentClass="",t.getItemByClass()})},onCloseClick:function(){this.rowActive="",this.$emit("update:visibleFlag",!1)},onItemConfirm:function(){var t=this;this.rowActive="",this.$nextTick(function(){t.$emit("on-confirm",t.selectedItemArr),t.$emit("update:visibleFlag",!1)})},search:function(){this.getItemByClass()},getItemClass:function(){var t=this;return new c.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.outHouseId,"/users/").concat(t.loginerId,"/goodTypes")}).then(function(t){e(t)})})},getItemByClass:function(){var t=this;this.itemListStart=0,this.getItem().then(function(e){t.itemList=t.setResItem(e.bomGoods),t.setListLoading(e.bomGoods.length),t.$nextTick(function(){t.$refs.addItemList.onSelectLetter(0,5)})})},getItem:function(){var t=this;return new c.a(function(e){var i={start:t.itemListStart,size:E,paged:!0,shopId:t.shopId,inId:t.outHouseId,goodsTypeId:t.currentClass||null,searchText:t.searchKey||null,removeIds:t.itemId};t.$fxHttp.requestPost({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/carBill"),data:i,query:{m:"getBomGoodsList"}}).then(function(t){e(t)})})},onLoadMore:function(){var t=this;this.getItem().then(function(e){var i;(i=t.itemList).push.apply(i,Object(L["a"])(t.setResItem(e.bomGoods))),t.setListLoading(e.bomGoods.length)})},setResItem:function(t){var e=this;return t.forEach(function(t){var i=e.selectedItemArr.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id});~i?"del"!==e.selectedItemArr[i].changeType&&(t.factCount=e.selectedItemArr[i].factCount,t.unitDTO=e.selectedItemArr[i].unitDTO):t.factCount="0"}),t},setListLoading:function(t){this.listLoading=!1,this.itemListStart+=E,this.loadFinished=t<E},selectClass:function(t){this.searchKey="",this.onKeyboardHide(),this.getItemByClass()},onItemEdit:function(t){this.rowActive=t,this.numberKeyboardShow=!0,this.$refs.addItemList.onSelectLetter(this.rowActive,20)},onKeyboardChange:function(t){this.itemList[this.rowActive].factCount=t},numberStringAmount:function(t){var e=this.itemList[t].factCount;this.itemList[t].factCount=u()(e),this.itemList[t].price=0,this.itemList[t].factMoney=0},pushSelectedItem:function(t){var e=this.selectedItemArr.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id});~e?this.selectedItemArr[e].id||0!==t.factCount?(this.selectedItemArr[e].id&&0===t.factCount?this.selectedItemArr[e].changeType="del":this.selectedItemArr[e].id&&(this.selectedItemArr[e].changeType="edit"),this.selectedItemArr[e].factCount=t.factCount,this.selectedItemArr[e].unitDTO=t.unitDTO):this.selectedItemArr.splice(e,1):t.factCount>0&&(t.changeType="add",this.selectedItemArr.push(t))},onKeyboardPre:function(){if(!this.rowActive)return!1;this.rowActive--,this.$refs.addItemList.onSelectLetter(this.rowActive,5)},onKeyboardNext:function(){if(""===this.rowActive||this.rowActive===this.itemList.length-1)return!1;this.rowActive++,this.$refs.addItemList.onSelectLetter(this.rowActive,5)},onKeyboardHide:function(){this.rowActive=""},onUnitEdit:function(){var t=this,e=this.itemList[this.rowActive].goodsDTO.id;this.getItemUnit(e).then(function(e){t.unitActions=e,t.unitActionShow=!0})},getItemUnit:function(t){var e=this;return new c.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/shopId/users/userId/goods/").concat(t,"/units"),query:{userId:e.loginerId}}).then(function(t){i(t.units)})})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemList[this.rowActive],i=e.unitDTO,o=i.value/t.value,n=u()(this.$fxUtils.toFixedSHW(e.factCount*o,this.sysPointSize));e.unitDTO=t,e.factCount=n}}},R=H,_=(i("107c"),Object(w["a"])(R,T,P,!1,null,"88a399c2",null)),N=_.exports,z=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"itemRowEdit-popup"},[i("w-header",{attrs:{title:t.currentItemData.goodsDTO.name,leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{staticClass:"itemRowEdit-content"},[i("van-cell-group",[i("van-cell",{attrs:{title:"材料编号",value:t.currentItemData.goodsDTO.code,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"单价",value:t.formatBomPrice(),"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"理论数量",value:t.currentItemData.theoryCount,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"理论金额",value:t.currentItemData.theoryMoney,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"计划数量",value:t.currentItemData.planCount,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"计划金额",value:t.currentItemData.planMoney,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"净重量",value:t.toFixedNumberSize(t.currentItemData.netWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"皮重量",value:t.toFixedNumberSize(t.currentItemData.skinWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"毛重量",value:t.toFixedNumberSize(t.currentItemData.grossWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"称重单位",value:t.currentItemData.weightUnit,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"称重状态",value:t.currentItemData.isWeightSign?"已称重":"未称重","value-class":"info-item-value"}}),i("van-pro-field",{attrs:{placeholder:t.setPlaceholder("请输入备注"),disabled:t.isDisabled,label:"备注","value-class":"info-item-value","input-align":"right"},model:{value:t.currentItemData.memo,callback:function(e){t.$set(t.currentItemData,"memo",e)},expression:"currentItemData.memo"}})],1)],1),i("div",{staticClass:"itemRowEdit-bottom"},[t.isDisabled?i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onCloseClick}},[t._v("确定")]):i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onConfirmClick}},[t._v("保存")])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1)],1)},U=[],j={name:"bomRowEdit",props:{visibleFlag:Boolean,bomData:{type:Object,default:function(){return{}}},isBillState:Boolean,isDisabled:Boolean},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},currentItemData:{},currentDate:new Date,datePickerShow:!1}},computed:Object(f["a"])({},Object(m["c"])({sysShowDZCData:function(t){return t.systemParams.sysShowDZCData},sysPointSize:"sysPointSize"}),{setPlaceholder:function(t){var e=this;return function(t){return e.isDisabled?"":t}},fomatterDate:function(t){var e=this;return function(t){return t?e.$fxUtils.setDateTime(new Date(t),"时分"):""}},comptedItemImgSrc:function(t){return function(t){return t?0===t.length?"":t[0].imagUrl:""}},formatBomPrice:function(){var t=this;return function(){return t.isBillState?t.toFixedNumberSize(t.bomData.factMoney/t.bomData.factCount):t.toFixedNumberSize(t.bomData.referencePrice)}}}),watch:{visibleFlag:{handler:function(t){t&&(this.currentItemData=JSON.parse(d()(this.bomData)))},immediate:!0}},methods:{toFixedNumberSize:function(t){return u()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onProductDateClick:function(){if(this.isDisabled)return!1;this.currentItemData.productDate&&(this.currentDate=new Date(this.currentItemData.productDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){this.currentItemData.productDate=t.getTime(),this.datePickerShow=!1},onConfirmClick:function(){this.currentItemData.id&&(this.currentItemData.changeType="edit"),this.$emit("on-Confirm",this.currentItemData),this.$emit("update:visibleFlag",!1)}}},K=j,W=(i("0076"),Object(w["a"])(K,z,U,!1,null,"1f6a080f",null)),q=W.exports,M=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-search-block"},[i("w-header",{attrs:{title:"搜索品项",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("searchHead",{attrs:{initSearch:t.visibleFlag,searchKey:t.searchKey,selectActive:t.isSelectAll},on:{"update:searchKey":function(e){t.searchKey=e},"update:search-key":function(e){t.searchKey=e},"on-select-click":t.onSelectAllClick}}),i("div",{ref:"details-content",staticClass:"item-list"},t._l(t.$fxCommon.detailFilter(t.data,t.searchKey),function(e,o){return i("van-swipe-cell",{directives:[{name:"show",rawName:"v-show",value:"del"!==e.changeType,expression:"item.changeType !== 'del'"}],key:e.goodsDTO.id,ref:"details-row-"+e.goodsDTO.id,refInFor:!0,staticClass:"item-row",attrs:{"right-width":80,disabled:t.isDisabled||t.focusing}},[i("div",{staticClass:"item-cell"},[i("checkBox",{staticClass:"search-checkbox",attrs:{visibleFlag:!t.isDisabled,checked:e.checked},on:{"on-checkbox-click":function(i){return t.onCheckBoxClick(e)}}}),i("bomInfoCell",t._g({staticClass:"search-info",attrs:{itemData:e,isDisabled:t.isDisabled,disabledEditBtn:t.focusing},on:{"on-bom-focus":function(i){return t.onItemFocus(arguments,""+e.goodsDTO.id)},"on-bom-blur":t.onItemBlur,"on-unit-edit":t.onUnitEdit,"on-bom-edit":t.onSearchItemEdit}},t.$listeners))],1),i("div",{staticClass:"item-row-delete",attrs:{slot:"right"},on:{click:function(i){return t.onDeleteClick(e,o,t.data)}},slot:"right"},[t._v("删除")])])}),1),i("div",{staticClass:"search-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onSearchConfirm}},[t._v("保存")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&t.$fxAuth("carBill.delDetail"),expression:"!isDisabled && $fxAuth('carBill.delDetail')"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:t.onSelectConfirm}},[t._v("删除")])],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("bomRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,bomData:t.itemEditRowData,isDisabled:t.isDisabled},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1)],1)},G=[],Z=(i("7514"),i("01db")),J=i("0f38"),V={name:"bomSearchPop",components:{bomInfoCell:C,bomRowEditPop:q,searchHead:Z["a"],checkBox:J["a"]},props:{data:{type:Array,default:function(){return[]}},isDisabled:Boolean,visibleFlag:Boolean},data:function(){return{focusing:!1,leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",itemRowEditPopShow:!1,itemEditRowData:{},unitActions:[],unitActionShow:!1}},watch:{visibleFlag:{handler:function(t){t&&(this.searchKey="")},immediate:!0}},computed:Object(f["a"])({},Object(m["c"])({sysPointSize:"sysPointSize"}),{isSelectAll:function(){if(this.isDisabled)return"";var t=0,e=0,i=this.$fxCommon.detailFilter(this.data,this.searchKey);return t=i.filter(function(t){return"del"!==t.changeType&&t.checked}).length,e=i.length,0!==t&&t===e}}),methods:{onCloseClick:function(){if(this.focusing)return!1;this.$emit("update:visibleFlag",!1)},onDeleteClick:function(t,e,i){t.id?(this.$set(t,"changeType","del"),this.$set(t,"factCount",0)):i.splice(e,1)},onItemFocus:function(t,e){this.focusing=!0},onItemBlur:function(){this.focusing=!1},onSearchItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this.data.findIndex(function(e){return e.id===t.id});~e&&(this.data[e]=t)},onUnitEdit:function(t){var e=this;this.itemEditRowData=t,this.getItemUnit(t.goodsDTO.id).then(function(t){e.unitActions=t,e.unitActionShow=!0})},getItemUnit:function(t){var e=this;return new c.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/shopId/users/userId/goods/").concat(t,"/units"),query:{userId:e.loginerId}}).then(function(t){i(t.units)})})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemEditRowData,i=e.unitDTO,o=i.value/t.value,n=u()(this.$fxUtils.toFixedSHW(e.factCount*o,this.sysPointSize));e.unitDTO=t,e.factCount=n,e.id&&(e.changeType="edit")},onSearchConfirm:function(){if(this.focusing)return!1;this.data.forEach(function(t){delete t.checked}),this.$emit("on-search-confirm",this.data),this.$emit("update:visibleFlag",!1)},onCheckBoxClick:function(t){if(this.focusing)return!1;this.$set(t,"checked",!t.checked)},onSelectAllClick:function(){var t=this,e=!this.isSelectAll,i=this.$fxCommon.detailFilter(this.data,this.searchKey);i.forEach(function(i){"del"!==i.changeType&&t.$set(i,"checked",e)})},onSelectConfirm:function(){var t=this,e=this.data.find(function(t){return t.checked&&"del"!==t.changeType});if(!e)return this.$fxToast.top("请先选择品项!"),!0;this.$dialog.confirm({title:"提示",message:"是否删除？"}).then(function(){for(var e=t.data,i=e.length-1;i>=0;i--){var o=e[i];o.checked&&(o.id?t.$set(o,"changeType","del"):t.data.splice(i,1))}})}}},Y=V,Q=(i("0d46"),Object(w["a"])(Y,M,G,!1,null,"b3168b14",null)),X=Q.exports,tt={name:"carBillDetails",components:{orderBom:B,bomEditComp:N,bomRowEditPop:q,bomSearchPop:X},props:{visibleFlag:Boolean,itemData:{type:Object,default:function(){return{}}},orderInfoData:{type:Object,default:function(){return{}}},isDisabled:Boolean},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},focusing:!1,query:this.$route.query,orderBomList:[],bomPopShow:!1,bomEditRowData:{},unitActionShow:!1,unitActions:[],bomRowEditPopShow:!1,bomInputFocusing:!1,formatterSysPointKey:["factCount","factMoney","theoryMoney","planMoney","planCount","theoryCount"],bomSearchPopShow:!1,searchBom:[],currentItemData:{}}},computed:Object(f["a"])({},Object(m["c"])({sysPointSize:"sysPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerShopName:function(t){return t.loginer.loginerShopName},loginerOrganType:function(t){return t.loginer.loginerOrganType},loginerId:function(t){return t.loginer.loginerId},sysDZCManyLower:function(t){return t.systemParams.sysDZCManyLower}}),{isBillState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.billState):e.orderInfoData.billState===t}},isWeightState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.weightState):e.orderInfoData.weightState===t}}}),watch:{visibleFlag:{handler:function(t){t&&(this.currentItemData=JSON.parse(d()(this.itemData)),this.createOrderDetails())},immediate:!0}},methods:{onCloseClick:function(){if(this.focusing)return!1;this.$emit("update:visibleFlag",!1)},createOrderDetails:function(){this.orderBomList=this.currentItemData.bomDetail,this.orderBomList=this.filterStoreBom(this.orderBomList),this.formatterSysPoint(this.orderBomList)},filterStoreBom:function(t){var e=this;return t.forEach(function(t){var i=t.factCount;e.isBillState(1)?t.price=e.toFixedNumberSize(t.factMoney/i):(t.price=e.toFixedNumberSize(t.referencePrice),t.factMoney=e.toFixedNumberSize(t.referencePrice*i),t.theoryMoney=e.toFixedNumberSize(t.referencePrice*t.theoryCount),t.planMoney=e.toFixedNumberSize(t.referencePrice*t.planCount))}),t},formatterSysPoint:function(t){var e=this;t.forEach(function(t){e.formatterSysPointKey.forEach(function(i){t[i]=e.toFixedNumberSize(t[i])})})},toFixedNumberSize:function(t){return u()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},onUnitEdit:function(t){var e=this;this.bomEditRowData=t,this.getBomUnit(t.goodsDTO.id).then(function(t){e.unitActions=t,e.unitActionShow=!0})},getBomUnit:function(t){var e=this;return new c.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/shopId/users/userId/goods/").concat(t,"/units"),query:{userId:e.loginerId}}).then(function(t){i(t.units)})})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.bomEditRowData,i=e.unitDTO,o=i.value/t.value,n=u()(this.$fxUtils.toFixedSHW(e.factCount*o,this.sysPointSize));e.unitDTO=t,e.factCount=n,e.crude=e.crude*o,e.id&&(e.changeType="edit")},onAddClick:function(){this.bomPopShow=!0},onBomEditConfirm:function(t){var e=this;t.forEach(function(t){t.bomDTO={id:e.currentItemData.bomDTO.id}}),this.orderBomList=t},onSaveClick:function(){var t=this;this.checkHasDetails().then(function(){t.saveHandler(t.getSaveParams())})},saveHandler:function(t){if(this.focusing)return!1;this.$emit("update:visibleFlag",!1),this.$emit("on-bom-save",t)},getSaveParams:function(){var t=s()({},this.currentItemData,{bomDetail:this.orderBomList});return t},checkHasDetails:function(){var t=this;return new c.a(function(e){var i=t.orderBomList.filter(function(t){return"del"!==t.changeType});0===i.length?t.$fxToast.fail("单据明细不能为空"):e()})},onBomEdit:function(t){this.bomEditRowData=t,this.bomRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this.orderBomList.findIndex(function(e){return e.id===t.id});~e&&(this.orderBomList[e]=t)},onClickHandler:function(t){if(this.bomInputFocusing)return!1;this[t]()},onBomFocus:function(t,e){this.focusing=!0},onBomBlur:function(){this.focusing=!1},onSearchClick:function(){this.bomSearchPopShow=!0,this.searchBom=JSON.parse(d()(this.orderBomList))},onSearchConfirm:function(t){this.orderBomList=t}}},et=tt,it=(i("e40a"),Object(w["a"])(et,o,n,!1,null,"38ec80a0",null));e["a"]=it.exports},8794:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-search-block"},[i("w-header",{attrs:{title:"搜索品项",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("searchHead",{attrs:{initSearch:t.visibleFlag,searchKey:t.searchKey,selectActive:t.isSelectAll},on:{"update:searchKey":function(e){t.searchKey=e},"update:search-key":function(e){t.searchKey=e},"on-select-click":t.onSelectAllClick}}),i("div",{ref:"details-content",staticClass:"item-list"},t._l(t.$fxCommon.detailFilter(t.data,t.searchKey),function(e,o){return i("van-swipe-cell",{directives:[{name:"show",rawName:"v-show",value:"del"!==e.changeType,expression:"item.changeType !== 'del'"}],key:e.goodsDTO.id,ref:"details-row-"+e.goodsDTO.id,refInFor:!0,staticClass:"item-row",attrs:{"right-width":80,disabled:t.isDisabled||t.focusing}},[i("div",{staticClass:"item-cell"},[i("checkBox",{staticClass:"search-checkbox",attrs:{visibleFlag:!t.isDisabled,checked:e.checked},on:{"on-checkbox-click":function(i){return t.onCheckBoxClick(e)}}}),i("itemInfoCell",t._g({staticClass:"search-info",attrs:{itemData:e,isDisabled:t.isDisabled,disabledEditBtn:t.focusing},on:{"on-item-focus":function(i){return t.onItemFocus(arguments,""+e.goodsDTO.id)},"on-item-blur":t.onItemBlur,"on-unit-edit":t.onUnitEdit,"on-item-edit":t.onSearchItemEdit}},t.$listeners))],1),i("div",{staticClass:"item-row-delete",attrs:{slot:"right"},on:{click:function(i){return t.onDeleteClick(e,o,t.data)}},slot:"right"},[t._v("删除")])])}),1),i("div",{staticClass:"search-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onSearchConfirm}},[t._v("保存")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:t.onSelectConfirm}},[t._v("删除")])],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,inHouseId:t.orderInfoData.inHouseDTO&&t.orderInfoData.inHouseDTO.id,outHouseId:t.orderInfoData.outHouseDTO&&t.orderInfoData.outHouseDTO.id,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,isBillState:1===t.orderInfoData.billState,isDisabled:t.isDisabled},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1)],1)},n=[],a=(i("7514"),i("ac6a"),i("59ad")),s=i.n(a),r=i("795b"),c=i.n(r),l=(i("20d6"),i("cebc")),u=i("2f62"),h=i("282e"),d=i("d949"),f=i("01db"),m=i("0f38"),p={name:"itemSearchPop",components:{itemInfoCell:h["a"],itemRowEditPop:d["a"],searchHead:f["a"],checkBox:m["a"]},props:{data:{type:Array,default:function(){return[]}},orderInfoData:{type:Object,default:function(){return{}}},isDisabled:Boolean,visibleFlag:Boolean},data:function(){return{focusing:!1,leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",itemRowEditPopShow:!1,itemEditRowData:{},unitActions:[],unitActionShow:!1}},watch:{visibleFlag:{handler:function(t){t&&(this.searchKey="")},immediate:!0}},computed:Object(l["a"])({},Object(u["c"])({sysPointSize:"sysPointSize"}),{isSelectAll:function(){if(this.isDisabled)return"";var t=0,e=0,i=this.$fxCommon.detailFilter(this.data,this.searchKey);return t=i.filter(function(t){return"del"!==t.changeType&&t.checked}).length,e=i.length,0!==t&&t===e}}),methods:{onCloseClick:function(){if(this.focusing)return!1;this.$emit("update:visibleFlag",!1)},onDeleteClick:function(t,e,i){t.id?(this.$set(t,"changeType","del"),this.$set(t,"factCount",0)):i.splice(e,1)},onItemFocus:function(t,e){this.focusing=!0},onItemBlur:function(){this.focusing=!1},onSearchItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this.data.findIndex(function(e){return e.id===t.id});~e&&(this.data[e]=t)},onUnitEdit:function(t){var e=this;this.itemEditRowData=t,this.getItemUnit(t.goodsDTO.id).then(function(t){e.unitActions=t,e.unitActionShow=!0})},getItemUnit:function(t){var e=this;return new c.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/shopId/users/userId/goods/").concat(t,"/units"),query:{userId:e.loginerId}}).then(function(t){i(t.units)})})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemEditRowData,i=e.unitDTO,o=i.value/t.value,n=s()(this.$fxUtils.toFixedSHW(e.factCount*o,this.sysPointSize));e.unitDTO=t,e.factCount=n,e.id&&(e.changeType="edit")},onSearchConfirm:function(){if(this.focusing)return!1;this.data.forEach(function(t){delete t.checked}),this.$emit("on-search-confirm",this.data),this.$emit("update:visibleFlag",!1)},onCheckBoxClick:function(t){if(this.focusing)return!1;this.$set(t,"checked",!t.checked)},onSelectAllClick:function(){var t=this,e=!this.isSelectAll,i=this.$fxCommon.detailFilter(this.data,this.searchKey);i.forEach(function(i){"del"!==i.changeType&&t.$set(i,"checked",e)})},onSelectConfirm:function(){var t=this,e=this.data.find(function(t){return t.checked&&"del"!==t.changeType});if(!e)return this.$fxToast.top("请先选择品项!"),!0;this.$dialog.confirm({title:"提示",message:"是否删除？"}).then(function(){for(var e=t.data,i=e.length-1;i>=0;i--){var o=e[i];o.checked&&(o.id?t.$set(o,"changeType","del"):t.data.splice(i,1))}})}}},v=p,S=(i("9891"),i("2877")),g=Object(S["a"])(v,o,n,!1,null,"ff85d830",null);e["a"]=g.exports},9891:function(t,e,i){"use strict";var o=i("01b2"),n=i.n(o);n.a},"99ca":function(t,e,i){},"9f11":function(t,e,i){},a792:function(t,e,i){"use strict";var o=i("99ca"),n=i.n(o);n.a},b523:function(t,e,i){},bcf0:function(t,e,i){"use strict";var o=i("0984"),n=i.n(o);n.a},c009:function(t,e,i){"use strict";var o=i("3aad"),n=i.n(o);n.a},d4ff:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-item-block fx-shadow-block"},[i("div",{staticClass:"item-title"},[i("span",{staticClass:"title-name"},[t._v("单据明细")]),i("span",{staticClass:"title-count"},[t._v("明细：")]),i("span",[t._v(t._s(t.detailsLength))]),i("i",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"title-add-icon fl-r",on:{click:t.onAddClick}}),i("i",{staticClass:"title-search-icon fl-r",on:{click:t.onSearchClick}})]),i("div",{ref:"details-content",staticClass:"item-list"},t._l(t.data,function(e,o){return i("van-swipe-cell",{directives:[{name:"show",rawName:"v-show",value:"del"!==e.changeType,expression:"item.changeType !== 'del'"}],key:e.goodsDTO.id,ref:"details-row-"+e.goodsDTO.id,refInFor:!0,staticClass:"item-row",attrs:{"right-width":80,disabled:t.isDisabled||t.focusing}},[i("itemInfoCell",t._g({attrs:{itemData:e,isDisabled:t.isDisabled,disabledEditBtn:t.focusing},on:{"on-item-focus":function(i){return t.onItemFocus(arguments,""+e.goodsDTO.id)},"on-item-blur":t.onItemBlur}},t.$listeners)),i("div",{staticClass:"item-row-delete",attrs:{slot:"right"},on:{click:function(i){return t.onDeleteClick(e,o,t.data)}},slot:"right"},[t._v("删除")])],1)}),1)])},n=[],a=i("282e"),s={name:"orderItem",components:{itemInfoCell:a["a"]},props:{data:{type:Array,default:function(){return[]}},isDisabled:Boolean,itemInputFocusing:Boolean},data:function(){return{focusing:!1}},computed:{detailsLength:function(){return this.data.filter(function(t){return"del"!==t.changeType}).length}},watch:{focusing:function(t){this.$emit("update:itemInputFocusing",t)}},methods:{onAddClick:function(){if(this.isDisabled||this.focusing)return!1;this.$emit("on-add-click")},onSearchClick:function(){if(this.focusing)return!1;this.$emit("on-search-click")},onDeleteClick:function(t,e,i){t.id?(this.$set(t,"changeType","del"),this.$set(t,"busUnitAmount",0)):i.splice(e,1)},onItemFocus:function(t,e){this.focusing=!0},onItemBlur:function(){this.focusing=!1}}},r=s,c=(i("5f75"),i("2877")),l=Object(c["a"])(r,o,n,!1,null,"cb747ffe",null);e["a"]=l.exports},d728:function(t,e,i){},d72a:function(t,e,i){},d949:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"itemRowEdit-popup"},[i("w-header",{attrs:{title:t.currentItemData.goodsDTO.name,leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{staticClass:"itemRowEdit-content"},[i("van-cell-group",[i("van-cell",{attrs:{title:"成品编号",value:t.currentItemData.goodsDTO.code,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"BOM名称",value:t.currentItemData.bomDTO.name,"is-link":!t.isDisabled,"value-class":"info-item-value"},on:{click:t.onBomClick}}),i("van-cell",{attrs:{title:"单价",value:t.isBillState?t.currentItemData.price:"","value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"金额",value:t.isBillState?t.currentItemData.sumMoney:"","value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"产出金额",value:t.isBillState?t.currentItemData.factMoney:"","value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"生产日期",value:t.fomatterDate(t.currentItemData.produceDate),"is-link":!t.isDisabled},on:{click:t.onProduceDateClick}}),i("van-pro-number-field",{attrs:{label:"加工费","input-align":"right",min:"0",defaultValue:0,max:t.maxAmount,intLength:t.numberLength,pointSize:t.sysPointSize,disabled:t.isDisabled},model:{value:t.currentItemData.processingFee,callback:function(e){t.$set(t.currentItemData,"processingFee",e)},expression:"currentItemData.processingFee"}}),i("van-cell",{attrs:{title:"计划数量",value:t.isBillState?t.currentItemData.planCount:"","value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"计划金额",value:t.isBillState?t.currentItemData.planMoney:"","value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"净重量",value:t.toFixedNumberSize(t.currentItemData.netWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"皮重量",value:t.toFixedNumberSize(t.currentItemData.skinWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"毛重量",value:t.toFixedNumberSize(t.currentItemData.grossWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"称重单位",value:t.currentItemData.weightUnit,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"加工班组",value:t.currentItemData.teamDTO?t.currentItemData.teamDTO.name:"","is-link":!t.isDisabled,"value-class":"info-item-value"},on:{click:t.onTeamClick}}),i("van-cell",{attrs:{title:"计件费用",value:t.currentItemData.pieceMoney,"value-class":"info-item-value"}}),i("van-pro-field",{attrs:{placeholder:t.setPlaceholder("请输入备注"),disabled:t.isDisabled,label:"备注","value-class":"info-item-value","input-align":"right"},model:{value:t.currentItemData.memo,callback:function(e){t.$set(t.currentItemData,"memo",e)},expression:"currentItemData.memo"}})],1)],1),i("div",{staticClass:"itemRowEdit-bottom"},[t.isDisabled?i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onCloseClick}},[t._v("确定")]):i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onConfirmClick}},[t._v("保存")])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right"},model:{value:t.teamPopShow,callback:function(e){t.teamPopShow=e},expression:"teamPopShow"}},[i("listComp",{attrs:{visibleFlag:t.teamPopShow,data:t.teamList,title:"请选择加工班组",loadFinished:!0},on:{"update:visibleFlag":function(e){t.teamPopShow=e},"update:visible-flag":function(e){t.teamPopShow=e},"on-select":t.selectTeam,"on-search":t.searchTeam}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right"},model:{value:t.bomPopShow,callback:function(e){t.bomPopShow=e},expression:"bomPopShow"}},[i("listComp",{attrs:{visibleFlag:t.bomPopShow,data:t.bomList,title:"请选择Bom",loadFinished:t.bomLoadFinished,loading:t.bomLoading},on:{"update:visibleFlag":function(e){t.bomPopShow=e},"update:visible-flag":function(e){t.bomPopShow=e},"update:loading":function(e){t.bomLoading=e},"on-select":t.selectBom,"on-search":t.searchBom,"on-load":t.onBomLoad}})],1)],1)},n=[],a=i("75fc"),s=(i("ac6a"),i("795b")),r=i.n(s),c=i("59ad"),l=i.n(c),u=i("f499"),h=i.n(u),d=i("cebc"),f=i("2f62"),m=i("f6bb"),p=50,v={name:"itemRowEdit",components:{listComp:m["a"]},props:{visibleFlag:Boolean,itemData:{type:Object,default:function(){return{}}},shopId:String,inHouseId:String,outHouseId:String,isDisabled:Boolean,isBillState:Boolean},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},currentItemData:{},currentDate:new Date,datePickerShow:!1,teamPopShow:!1,teamList:[],bomPopShow:!1,bomList:[],bomListStart:0,bomLoading:!1,bomLoadFinished:!1}},computed:Object(d["a"])({},Object(f["c"])({sysShowDZCData:function(t){return t.systemParams.sysShowDZCData},sysPointSize:"sysPointSize",numberLength:"numberLength",maxAmount:"maxAmount"}),{setPlaceholder:function(t){var e=this;return function(t){return e.isDisabled?"":t}},fomatterDate:function(t){var e=this;return function(t){return t?e.$fxUtils.setDateTime(new Date(t),"时分"):""}}}),watch:{visibleFlag:{handler:function(t){t&&(this.currentItemData=JSON.parse(h()(this.itemData)))},immediate:!0}},methods:{toFixedNumberSize:function(t){return l()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onProduceDateClick:function(){if(this.isDisabled)return!1;this.currentItemData.produceDate&&(this.currentDate=new Date(this.currentItemData.produceDate)),this.datePickerShow=!0},onTeamClick:function(){if(this.isDisabled)return!1;this.onTeamRefresh()},searchTeam:function(t){this.onTeamRefresh(t)},selectTeam:function(t){this.currentItemData.teamDTO=t},onTeamRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getTeamListData(e).then(function(e){t.teamPopShow=!0,t.teamList=e.goodsTeam})},getTeamListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new r.a(function(i){var o={goodsId:t.currentItemData.goodsDTO.id,searchText:e||null};t.$fxHttp.requestPost({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/carBill"),data:o,query:{m:"getTeamList"}}).then(function(t){i(t)})})},onBomClick:function(){if(this.isDisabled)return!1;this.onBomRefresh()},searchBom:function(t){this.onBomRefresh(t)},selectBom:function(t){var e=this;this.checkBom(t).then(function(){e.$dialog.confirm({title:"提示",message:"更改BOM会清空之前对应的BOM明细,是否继续?"}).then(function(){e.currentItemData.bomDTO=t,t.bomDetail.forEach(function(i){var o=t.crude;e.$fxSysAuth("carBill.sysCarBillChangeAmount")&&(i.factCount=e.toFixedNumberSize(e.currentItemData.factCount*o)),i.theoryCount=e.toFixedNumberSize(e.currentItemData.factCount*o),i.id&&(i.changeType="edit")});var i=e.currentItemData,o=i.bomDetail;t.bomDetail.forEach(function(t){t.changeType="add"});for(var n=o.length-1;n>-1;n--){var s=o[n];s.id?s.changeType="del":o.splice(n,1)}o.push.apply(o,Object(a["a"])(t.bomDetail)),i.unitDTO=t.unitDTO})})},checkBom:function(t){var e=this;return new r.a(function(i){var o=e.currentItemData.bomDTO;o.id!==t.id&&i()})},onBomRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.bomListStart=0,this.getBomListData(e).then(function(e){t.bomPopShow=!0,t.bomLoading=!1,t.bomListStart+=p,t.bomLoadFinished=e.carBomGoods.length<p,t.bomList=t.resetBomList(e.carBomGoods)})},onBomLoad:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getBomListData(e).then(function(e){var i;t.bomLoading=!1,t.bomListStart+=p,e.carBomGoods.length<p&&(t.bomLoadFinished=!0),(i=t.bomList).push.apply(i,Object(a["a"])(t.resetBomList(e.carBomGoods)))})},resetBomList:function(t){return t.map(function(t){return t.bomDTO.bomDetail=t.bomDetail,t.bomDTO.unitDTO=t.unitDTO,t.bomDTO})},getBomListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new r.a(function(i){var o={start:t.bomListStart,size:p,paged:!0,shopId:t.shopId,goodsId:t.currentItemData.goodsDTO.id,searchText:e||null};t.$fxHttp.requestPost({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/carBill"),data:o,query:{m:"getBomList"}}).then(function(t){i(t)})})},dateConfirmhandle:function(t){this.currentItemData.produceDate=t.getTime(),this.datePickerShow=!1},onConfirmClick:function(){this.currentItemData.id&&(this.currentItemData.changeType="edit"),this.$emit("on-Confirm",this.currentItemData),this.$emit("update:visibleFlag",!1)}}},S=v,g=(i("47a7"),i("2877")),b=Object(g["a"])(S,o,n,!1,null,"15378137",null);e["a"]=b.exports},dc18:function(t,e,i){"use strict";var o=i("d728"),n=i.n(o);n.a},df40:function(t,e,i){},e185:function(t,e,i){"use strict";var o=i("ec57"),n=i.n(o);n.a},e40a:function(t,e,i){"use strict";var o=i("06e3"),n=i.n(o);n.a},ec57:function(t,e,i){},f470:function(t,e,i){"use strict";var o=i("d72a"),n=i.n(o);n.a}}]);
//# sourceMappingURL=carBill.cb9a7cc2.js.map