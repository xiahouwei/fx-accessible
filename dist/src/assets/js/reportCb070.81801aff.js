(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["reportCb070"],{7091:function(t,e,r){"use strict";r.r(e);var i=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("reportFormContainer",{ref:"reportForm",attrs:{reportFormConfig:t.reportFormConfig,reportPlans:t.reportPlans,getReportParams:t.getReportParams,filterPopShow:t.filterPopShow,showSearchBar:""},on:{"update:filterPopShow":function(e){t.filterPopShow=e},"update:filter-pop-show":function(e){t.filterPopShow=e}}},[r("filterPop",{attrs:{slot:"slot-filter",visibleFlag:t.filterPopShow,filterParams:t.filterParams},on:{"update:visibleFlag":function(e){t.filterPopShow=e},"update:visible-flag":function(e){t.filterPopShow=e},"update:filterParams":function(e){t.filterParams=e},"update:filter-params":function(e){t.filterParams=e},"on-confirm":t.filterConfirm},slot:"slot-filter"})],1)},o=[],n=(r("7f7f"),r("795b")),s=r.n(n),a=(r("96cf"),r("3b8d")),l=r("cebc"),h=r("2f62"),c=r("fe17"),p=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("filterPopComp",{on:{"on-close":t.onCloseClick,"on-confirm":t.onConfirmClick,"on-reset":t.onResetClick}},[r("van-cell-group",{attrs:{slot:"solt-filter-cell"},slot:"solt-filter-cell"},[r("van-cell",{attrs:{title:"业务日期"}}),r("van-cell",{attrs:{title:"起始时间",value:t.beginDate,"is-link":""},on:{click:t.onBeginDateClick}}),r("van-cell",{attrs:{title:"结束时间",value:t.endDate,"is-link":""},on:{click:t.endDateClick}}),r("filterCell",{attrs:{title:"门店区域",value:t.shopArea,showCloseBtn:!!t.shopAreaId},on:{"on-click":function(e){return t.onFilterCellClick("shopAreaPopShow")},"on-clear":function(e){return t.onFilterCellClear(["shopArea","shop"])}}}),r("filterCell",{attrs:{title:"机构名称",value:t.shop,showCloseBtn:!!t.shopId},on:{"on-click":function(e){return t.onFilterCellClick("shopPopShow")},"on-clear":function(e){return t.onFilterCellClear("shop")}}}),r("filterCell",{attrs:{title:"仓库名称",value:t.store,showCloseBtn:!!t.storeId},on:{"on-click":function(e){return t.onFilterCellClick("storePopShow")},"on-clear":function(e){return t.onFilterCellClear("store")}}}),r("filterCell",{attrs:{title:"品项大类",value:t.bigClass,showCloseBtn:!!t.bigClassId},on:{"on-click":function(e){return t.onFilterCellClick("bigClassPopShow")},"on-clear":function(e){return t.onFilterCellClear(["bigClass","smallClass","item"])}}}),r("filterCell",{attrs:{title:"品项小类",value:t.smallClass,showCloseBtn:!!t.smallClassId},on:{"on-click":function(e){return t.onFilterCellClick("smallClassPopShow")},"on-clear":function(e){return t.onFilterCellClear(["smallClass","item"])}}}),r("filterCell",{attrs:{title:"品项名称",value:t.item,showCloseBtn:!!t.itemId},on:{"on-click":function(e){return t.onFilterCellClick("itemPopShow")},"on-clear":function(e){return t.onFilterCellClear("item")}}})],1),r("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[r("datePicker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),r("filterListPopup",{attrs:{title:"门店区域检索",getDataApi:t.getShopAreaListData},on:{"on-select":function(e){return t.onFilterSelect(arguments,"shopArea")}},model:{value:t.shopAreaPopShow,callback:function(e){t.shopAreaPopShow=e},expression:"shopAreaPopShow"}}),r("filterListPopup",{attrs:{title:"机构名称检索",rollingLoad:!0,getDataApi:t.getShopListData},on:{"on-select":function(e){return t.onFilterSelect(arguments,"shop")}},model:{value:t.shopPopShow,callback:function(e){t.shopPopShow=e},expression:"shopPopShow"}}),r("filterListPopup",{attrs:{title:"仓库检索",rollingLoad:!0,getDataApi:t.getStoreListData},on:{"on-select":function(e){return t.onFilterSelect(arguments,"store")}},model:{value:t.storePopShow,callback:function(e){t.storePopShow=e},expression:"storePopShow"}}),r("filterListPopup",{attrs:{title:"品项大类检索",rollingLoad:!0,getDataApi:t.getBigClassListData},on:{"on-select":function(e){return t.onFilterSelect(arguments,"bigClass")}},model:{value:t.bigClassPopShow,callback:function(e){t.bigClassPopShow=e},expression:"bigClassPopShow"}}),r("filterListPopup",{attrs:{title:"品项小类检索",rollingLoad:!0,getDataApi:t.getSmallClassListData},on:{"on-select":function(e){return t.onFilterSelect(arguments,"smallClass")}},model:{value:t.smallClassPopShow,callback:function(e){t.smallClassPopShow=e},expression:"smallClassPopShow"}}),r("filterListPopup",{attrs:{title:"品项检索",rollingLoad:!0,getDataApi:t.getItemListData},on:{"on-select":function(e){return t.onFilterSelect(arguments,"item")}},model:{value:t.itemPopShow,callback:function(e){t.itemPopShow=e},expression:"itemPopShow"}})],1)},u=[],f=(r("ac6a"),r("768b")),g=r("cd56"),d=r("a343"),m=r("3a5e"),C=r("eb03"),b=["shopArea","shop","store","bigClass","smallClass","item"],P={name:"filterPop",components:{filterPopComp:g["a"],datePicker:d["a"],filterCell:m["a"],filterListPopup:C["a"]},props:{visibleFlag:Boolean,filterParams:{type:Object,default:function(){return{}}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},dateType:"",currentDate:new Date,beginDate:this.$fxUtils.getCurrentMonthFirst(),endDate:this.$fxUtils.getCurrentMonthLast(),shopArea:"请选择",shopAreaId:"",shop:"请选择",shopId:"",store:"请选择",storeId:"",bigClass:"请选择",bigClassId:"",smallClass:"请选择",smallClassId:"",item:"请选择",itemId:"",datePickerShow:!1,shopAreaPopShow:!1,shopPopShow:!1,storePopShow:!1,bigClassPopShow:!1,smallClassPopShow:!1,itemPopShow:!1}},created:function(){this.initDefaultShop()},watch:{visibleFlag:{handler:function(t){t&&(this.$fxUtils.isEmptyObjSHW(this.filterParams)?this.resetHandler():this.setFilterParams())},immediate:!0}},computed:Object(l["a"])({},Object(h["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",maxAmount:"maxAmount",loginerShopId:function(t){return t.loginer.loginerShopId},loginerShopName:function(t){return t.loginer.loginerShopName},loginerId:function(t){return t.loginer.loginerId},loginerOrganType:function(t){return t.loginer.loginerOrganType}}),{shopCellDisable:function(){return this.$fxStateMiddleware.stateIs("loginerOrganType")(["shop","center","area"])(this.loginerOrganType)}}),methods:{initDefaultShop:function(){this.shopId=this.filterParams.shopId,this.shop=this.filterParams.shop},getFilterParams:function(){return{beginDate:this.beginDate||this.$fxUtils.getCurrentMonthFirst(),endDate:this.endDate||this.$fxUtils.getCurrentMonthLast(),shopArea:this.shopArea,shopAreaId:this.shopAreaId,shop:this.shop,shopId:this.shopId,store:this.store,storeId:this.storeId,bigClass:this.bigClass,bigClassId:this.bigClassId,smallClass:this.smallClass,smallClassId:this.smallClassId,item:this.item,itemId:this.itemId}},onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onConfirmClick:function(){var t=this;this.confirmCheck().then(function(){t.$emit("update:visibleFlag",!1),t.$emit("update:filterParams",t.getFilterParams()),t.$emit("on-confirm",t.getFilterParams())})},onResetClick:function(){this.resetHandler()},resetHandler:function(){this.beginDate=this.$fxUtils.getCurrentMonthFirst(),this.endDate=this.$fxUtils.getCurrentMonthLast(),this.resetFilterCell(b),this.shopCellDisable&&(this.shop=this.loginerShopName,this.shopId=this.loginerShopId)},setFilterParams:function(){var t=this;b.forEach(function(e){t.filterParams[e]?(t[e]=t.filterParams[e],t["".concat(e,"Id")]=t.filterParams["".concat(e,"Id")]):t.resetFilterCell(e)})},confirmCheck:function(){var t=this;return new s.a(function(e){if(!t.shopId&&!t.shopAreaId)return t.$fxToast.fail("门店区域、机构至少填写其中一项!"),!1;e()})},onBeginDateClick:function(){this.dateType="begin",this.beginDate&&(this.currentDate=new Date(this.beginDate)),this.datePickerShow=!0},endDateClick:function(){this.dateType="end",this.endDate&&(this.currentDate=new Date(this.endDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){"begin"===this.dateType?(this.beginDate=this.$fxUtils.setDate(t),this.endDate&&this.$fxUtils.compareDateRange(this.beginDate,this.endDate,31)||(this.endDate=this.setDateRange(this.beginDate,31))):(this.endDate=this.$fxUtils.setDate(t),this.beginDate&&this.$fxUtils.compareDateRange(this.beginDate,this.endDate,31)||(this.beginDate=this.setDateRange(this.endDate,-31))),this.datePickerShow=!1},setDateRange:function(t,e){return this.$fxUtils.setDate(this.$fxUtils.getCustomAssignDate(t,e))},onFilterCellClick:function(t){this[t]=!0},onFilterCellClear:function(t){this.resetFilterCell(t)},onFilterSelect:function(t,e){var r=Object(f["a"])(t,1),i=r[0];this[e]=i.name,this["".concat(e,"Id")]=i.id,this.selectAfterHandler(e)},selectAfterHandler:function(t){switch(t){case"shopArea":this.resetFilterCell(["shop","store"]);break;case"shop":this.resetFilterCell("store");break;case"bigClass":this.resetFilterCell(["smallClass","item"]);break;case"smallClass":this.resetFilterCell("item");break}},resetFilterCell:function(t){var e=this,r=[].concat(t);r.forEach(function(t){e[t]="请选择",e["".concat(t,"Id")]=""})},getShopAreaListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e={keyword:t};return this.$fxApi("reportForm.getShopArea")(e)},getShopListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,i={keyword:t,shoparea:this.shopAreaId||null,start:e,size:r};return this.$fxApi("reportForm.getShop")(i)},getStoreListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,i={keyword:t,shopName:this.shopId,start:e,size:r};return this.$fxApi("reportForm.getStore")(i)},getBigClassListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,i={keyword:t,bigOrSmall:"1",start:e,size:r};return this.$fxApi("reportForm.getItemClass")(i)},getSmallClassListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,i={keyword:t,bigOrSmall:"2",goodsBigType:this.bigClassId,start:e,size:r};return this.$fxApi("reportForm.getItemClass")(i)},getItemListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,i={keyword:t,start:e,size:r,goodsBigType:this.bigClassId,goodsSmallType:this.smallClassId};return this.$fxApi("reportForm.getItem")(i)}}},S=P,D=r("2877"),w=Object(D["a"])(S,p,u,!1,null,null,null),k=w.exports,v="cb070",I={name:"report-cb070",components:{reportFormContainer:c["a"],filterPop:k},data:function(){var t=this.$fxCommon.getReportFormConfig(v);return{reportFormConfig:t,filterPopShow:!1,filterParams:{}}},mounted:function(){this.$refs.reportForm.init({reportPlan:this.reportPlans[0],getReportParams:this.getReportParams})},computed:Object(l["a"])({},Object(h["c"])({loginerShopId:function(t){return t.loginer.loginerShopId},loginerShopName:function(t){return t.loginer.loginerShopName},loginerOrganType:function(t){return t.loginer.loginerOrganType}}),Object(h["b"])(["reportPlansGetter"]),{reportPlans:function(){return this.reportPlansGetter(v)},shopCellDisable:function(){return this.$fxStateMiddleware.stateIs("loginerOrganType")(["shop","center","area"])(this.loginerOrganType)}}),methods:{filterConfirm:function(t){var e=this;this.getReportParams(t).then(function(t){e.$refs.reportForm.refreshReportForm(t)})},getReportParams:function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(){var e,r=arguments;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(e=r.length>0&&void 0!==r[0]?r[0]:{},!this.$fxUtils.isEmptyObjSHW(e)){t.next=7;break}return t.next=4,this.getReportParamsDefault();case 4:t.t0=t.sent,t.next=8;break;case 7:t.t0={sWorkDate:e.beginDate?"".concat(e.beginDate," 00:00:00"):"",eWorkDate:e.beginDate?"".concat(e.endDate," 23:59:59"):"",shopAreaId:e.shopAreaId,shopId:e.shopId,houseId:e.storeId,goodBigTypeId:e.bigClassId,goodSmallTypeId:e.smallClassId,goodsId:e.itemId,agg:{}};case 8:return t.abrupt("return",t.t0);case 9:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),getReportParamsDefault:function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(){var e,r,i;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.getDefaultShop();case 2:return e=t.sent,r=e.shop,i=e.shopId,this.setDefaultShop(r,i),t.abrupt("return",{sWorkDate:"".concat(this.$fxUtils.getCurrentMonthFirst()," 00:00:00"),eWorkDate:"".concat(this.$fxUtils.setDate()," 23:59:59"),shopId:i,agg:{amount:"sum"}});case 7:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),getDefaultShop:function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!this.shopCellDisable){t.next=4;break}t.t0={shop:this.loginerShopName,shopId:this.loginerShopId},t.next=7;break;case 4:return t.next=6,this.getDefaultShopHandler();case 6:t.t0=t.sent;case 7:return t.abrupt("return",t.t0);case 8:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),setDefaultShop:function(t,e){this.filterParams.shop=t,this.filterParams.shopId=e},getDefaultShopHandler:function(){var t=this;return new s.a(function(e,r){t.getShopListData().then(function(i){if(i.length>0)e({shop:i[0].name,shopId:i[0].id});else{var o="当前没有可查询机构";t.$fxToast.fail(o).then(function(){r(o)})}})})},getShopListData:function(){var t={keyword:null,start:0,size:1};return this.$fxApi("reportForm.getShop")(t)}}},F=I,x=Object(D["a"])(F,i,o,!1,null,null,null);e["default"]=x.exports},a343:function(t,e,r){"use strict";var i=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("van-datetime-picker",t._g({attrs:{type:"date",formatter:t.dataPickerFormatter},on:{cancel:t.onCancelClick},model:{value:t.$attrs.currentDate,callback:function(e){t.$set(t.$attrs,"currentDate",e)},expression:"$attrs.currentDate"}},t.$listeners))},o=[],n={name:"datePicker",props:{visibleFlag:Boolean},methods:{dataPickerFormatter:function(t,e){return"".concat(e,"year"===t?"年":"month"===t?"月":"日")},onCancelClick:function(){this.$emit("update:visibleFlag",!1)}}},s=n,a=r("2877"),l=Object(a["a"])(s,i,o,!1,null,null,null);e["a"]=l.exports}}]);
//# sourceMappingURL=reportCb070.81801aff.js.map