(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["insideMoveBill"],{"0002":function(t,e,i){"use strict";var o=i("65ff"),n=i.n(o);n.a},"085e":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-search-block"},[i("w-header",{attrs:{title:"搜索品项",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("searchHead",{attrs:{initSearch:t.visibleFlag,searchKey:t.searchKey,selectActive:t.isSelectAll},on:{"update:searchKey":function(e){t.searchKey=e},"update:search-key":function(e){t.searchKey=e},"on-select-click":t.onSelectAllClick}}),i("div",{ref:"details-content",staticClass:"item-list"},[i("div",{staticClass:"item-store-title-container",attrs:{slot:"title"},slot:"title"},[i("w-icon",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&t.data.length&&!t.autoType8,expression:"!isDisabled && data.length && !autoType8"}],attrs:{type:"camera"},on:{click:function(e){return t.onCameraClick()}}})],1),t._l(t.$fxCommon.detailFilter(t.data,t.searchKey),function(e,o){return i("van-swipe-cell",{directives:[{name:"show",rawName:"v-show",value:"del"!==e.changeType,expression:"item.changeType !== 'del'"}],key:e.goodsDTO.id,ref:"details-row-"+e.goodsDTO.id,refInFor:!0,staticClass:"item-row",attrs:{"right-width":80,disabled:t.isDisabled||t.focusing}},[i("div",{staticClass:"item-cell"},[i("checkBox",{staticClass:"search-checkbox",attrs:{visibleFlag:!t.isDisabled,checked:e.checked},on:{"on-checkbox-click":function(i){return t.onCheckBoxClick(e)}}}),i("itemInfoCell",{staticClass:"search-info",attrs:{itemData:e,isDisabled:t.isDisabled,disabledEditBtn:t.focusing,autoType8:t.autoType8},on:{"on-item-focus":function(i){return t.onItemFocus(arguments,""+e.goodsDTO.id)},"on-item-blur":t.onItemBlur,"on-unit-edit":t.onUnitEdit,"on-item-edit":t.onSearchItemEdit}})],1),i("div",{staticClass:"item-row-delete",attrs:{slot:"right"},on:{click:function(i){return t.onDeleteClick(e,o,t.data)}},slot:"right"},[t._v("删除")])])})],2),i("div",{staticClass:"search-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onSearchConfirm}},[t._v("保存")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:t.onSelectConfirm}},[t._v("删除")])],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,isDisabled:t.isDisabled},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1),i("w-action-sheet",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.scanActionShow,expression:"scanActionShow"}],ref:"scanActionSheet",attrs:{actions:t.scanActions},model:{value:t.scanActionShow,callback:function(e){t.scanActionShow=e},expression:"scanActionShow"}})],1)},n=[],s=(i("7f7f"),i("7514"),i("ac6a"),i("59ad")),a=i.n(s),r=i("795b"),c=i.n(r),l=(i("20d6"),i("cebc")),u=i("2f62"),d=i("bf73"),h=i("1b71"),f=i("01db"),m=i("0f38"),p={name:"itemSearchPop",components:{itemInfoCell:d["a"],itemRowEditPop:h["a"],searchHead:f["a"],checkBox:m["a"]},props:{data:{type:Array,default:function(){return[]}},houseDTO:{type:Object,default:function(){return{}}},outHouseId:String,shopId:{type:String,default:""},isDisabled:Boolean,visibleFlag:Boolean,autoType8:Boolean},data:function(){return{focusing:!1,leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",itemRowEditPopShow:!1,itemEditRowData:{},unitActions:[],unitActionShow:!1,scanActionShow:!1,scanActions:[{name:"累加数量"},{name:"覆盖数量"}]}},watch:{visibleFlag:{handler:function(t){t&&(this.searchKey="")},immediate:!0}},computed:Object(l["a"])({},Object(u["c"])({sysPointSize:"sysPointSize"}),{isSelectAll:function(){if(this.isDisabled)return"";var t=0,e=0,i=this.$fxCommon.detailFilter(this.data,this.searchKey);return t=i.filter(function(t){return"del"!==t.changeType&&t.checked}).length,e=i.length,0!==t&&t===e}}),methods:{onCloseClick:function(){if(this.focusing)return!1;this.$emit("update:visibleFlag",!1)},onDeleteClick:function(t,e,i){t.id?(this.$set(t,"changeType","del"),this.$set(t,"busUnitInAmount",0)):i.splice(e,1)},onItemFocus:function(t,e){this.focusing=!0},onItemBlur:function(){this.focusing=!1},onSearchItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this.data.findIndex(function(e){return e.id===t.id});~e&&(this.data[e]=t)},onUnitEdit:function(t){var e=this;this.itemEditRowData=t,this.getItemUnit(t.goodsDTO.id).then(function(t){e.unitActions=t,e.unitActionShow=!0})},getItemUnit:function(t){var e=this;return new c.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/shopId/users/userId/goods/").concat(t,"/units"),query:{userId:e.loginerId}}).then(function(t){i(t.units)})})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemEditRowData,i=e.unitDTO.value,o=t,n=i/t.value,s=a()(this.$fxUtils.toFixedSHW(e.busUnitInAmount*n,this.sysPointSize));e.unitDTO=t,e.busUnitInAmount=s,0===e.busUnitInAmount?(e.price=a()(this.$fxUtils.toFixedSHW(e.price*o.value/i,this.sysPointSize)),e.taxPrice=a()(this.$fxUtils.toFixedSHW(e.taxPrice*o.value/i,this.sysPointSize))):(e.price=a()(this.$fxUtils.toFixedSHW(e.inMoney/e.busUnitInAmount,this.sysPointSize)),e.taxPrice=a()(this.$fxUtils.toFixedSHW(e.inMoneyWithTax/e.busUnitInAmount,this.sysPointSize))),e.id&&(e.changeType="edit")},onSearchConfirm:function(){if(this.focusing)return!1;this.data.forEach(function(t){delete t.checked}),this.$emit("on-search-confirm",this.data),this.$emit("update:visibleFlag",!1)},onCheckBoxClick:function(t){if(this.focusing)return!1;this.$set(t,"checked",!t.checked)},onSelectAllClick:function(){var t=this,e=!this.isSelectAll,i=this.$fxCommon.detailFilter(this.data,this.searchKey);i.forEach(function(i){"del"!==i.changeType&&t.$set(i,"checked",e)})},onSelectConfirm:function(){var t=this,e=this.data.find(function(t){return t.checked&&"del"!==t.changeType});if(!e)return this.$fxToast.top("请先选择品项!"),!0;this.$dialog.confirm({title:"提示",message:"是否删除？"}).then(function(){for(var e=t.data,i=e.length-1;i>=0;i--){var o=e[i];o.checked&&(o.id?t.$set(o,"changeType","del"):t.data.splice(i,1))}})},createBreakBill:function(t){var e=this;return new c.a(function(i){var o={billEmp:"",billMemo:"",billState:0,businessDate:(new Date).getTime(),businessTypeDTO:{},shopDTO:{id:e.shopId},details:[],updateIndicator:"Append",autoType:1,reckonBreak:"0",detailAdd:[t],accountDTO:{id:e.loginerId}};e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/breakBills"),data:o,query:{m:"addAndCheckBill"}}).then(function(t){i(),e.$fxToast.success("报损成功！")})})},onCameraClick:function(){this.scanStoreItem=this.data,this.$fxEventBus.initEvent(this,"redCode",this.getItemByRedCode),this.$dialog.alert({title:"请扫码",message:"当前入库仓库：".concat(this.houseDTO.name),confirmButtonText:"取消扫码",beforeClose:function(t,e){this.$fxEventBus.$off("redCode",this.getItemByRedCode),e()}})},getItemByRedCode:function(t){if(!this.visibleFlag)return!1;this.onRedTwoCodeHandler(t)},onRedTwoCodeHandler:function(t){var e=this;this.getItemByTwoCode(t,!1).then(function(i){"100"===i.errorCode||"101"===i.errorCode?e.$dialog.confirm({title:"提示",message:i.message}).then(function(){if("100"===i.errorCode)return e.createBreakBill(i.storeBillDetailDTO),!0;e.getItemByTwoCode(t,!0).then(function(t){e.getScanGoodData(t.storeBillDetailDTO)})}).catch(function(){return!1}):e.getScanGoodData(i.storeBillDetailDTO)})},getItemByTwoCode:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new c.a(function(o){var n={qrCodeContent:t,houseId:e.houseDTO.id,outHouseId:e.outHouseId,billType:23,nextFlag:i};e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.shopId,"/users/").concat(e.loginerId,"/getscancodedata"),query:n}).then(function(t){o(t)})})},getScanGoodData:function(t){this.setScanGood(t)},setScanGood:function(t){var e=this,i=this.scanStoreItem.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id&&"del"!==e.changeType});if(!~i)return this.$fxToast.fail("当前仓库无此品项！"),!1;var o=this.scanStoreItem.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id&&t.unitDTO.id===e.unitDTO.id&&"del"!==e.changeType});if(!~o)return this.$fxToast.fail("不能重复添加品项！"),!1;var n=this.scanStoreItem[o];if(n.batchCode!==t.batchCode&&this.$fxUtils.isDef(n.batchCode))return this.$fxToast.fail("不能重复添加品项！"),!1;this.$refs.scanActionSheet.doSelect().then(function(i){"累加数量"===i.name&&e.computedScanItemAmount(t,n),e.refreshSelectItem(t,n)})},computedScanItemAmount:function(t,e){var i=this.toFixedNumberSize(t.busUnitInAmount+e.busUnitInAmount);t.busUnitInAmount=this.$fxCommon.checkAmountRange(i)},refreshSelectItem:function(t,e){e.busUnitInAmount=t.busUnitInAmount,e.batchCode=t.batchCode,this.editItem(e)},toFixedNumberSize:function(t){return a()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},editItem:function(t){t.id&&this.$set(t,"changeType","edit")}}},v=p,g=(i("3124"),i("2877")),S=Object(g["a"])(v,o,n,!1,null,"1725e00e",null);e["a"]=S.exports},1454:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-search-block"},[i("w-header",{attrs:{title:"已导入BOM",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{staticClass:"item-search clearfix"},[i("van-search",{attrs:{placeholder:"请输入搜索关键词",shape:"round"},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}})],1),i("div",{ref:"details-content",staticClass:"item-list bom-search-list"},t._l(t.detailFilter(t.data),function(t){return i("van-swipe-cell",{directives:[{name:"show",rawName:"v-show",value:"del"!==t.changeType,expression:"item.changeType !== 'del'"}],key:t.goods.id+"-"+t.goodsUUid,ref:"details-row-"+t.goods.id,refInFor:!0,staticClass:"item-row"},[i("div",{staticClass:"item-cell"},[i("bomInfoCell",{staticClass:"search-info",attrs:{itemData:t}})],1)])}),1)],1)},n=[],s=(i("6762"),i("2fdb"),i("28a5"),i("7514"),i("ac6a"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-info-cell"},[i("div",{staticClass:"item-img"},[i("img",{attrs:{src:t.comptedItemImgSrc(t.itemData.goods.imageUrls),onerror:t.$fxCommon.errorImg("item")}})]),i("div",{staticClass:"item-details"},[i("div",{staticClass:"item-name-money"},[i("div",{staticClass:"item-name fx-ellipsis"},[t._v(t._s(t.itemData.goods.name))])]),i("div",{staticClass:"item-row"},[i("span",[t._v(t._s(t.itemData.bomName))])]),i("div",{staticClass:"item-row item-amount"},[i("span",[t._v(t._s(t.itemData.bomAmount))]),i("span",{staticClass:"item-unit-text"},[t._v(t._s(t.itemData.unit.name))])])])])}),a=[],r={name:"bomInfoCell",props:{itemData:{type:Object,default:function(){return{}}}},computed:{comptedItemImgSrc:function(t){return function(t){return t?0===t.length?"":t[0]:""}}},methods:{}},c=r,l=(i("8b23"),i("2877")),u=Object(l["a"])(c,s,a,!1,null,"7bfd8968",null),d=u.exports,h={name:"bomSearchPop",components:{bomInfoCell:d},props:{data:{type:Array,default:function(){return[]}},visibleFlag:Boolean,searchKeywords:String},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:""}},watch:{visibleFlag:{handler:function(t){t&&(this.searchKey="",this.setDetailGoodsUUid(this.data))},immediate:!0}},methods:{setDetailGoodsUUid:function(t){var e=this;t.forEach(function(t){t.goodsUUid=e.$fxUtils.createUUID()})},storeShowComputed:function(t){return this.detailFilter(t.details).length>0},detailFilter:function(t){var e=this;return t.filter(function(t){return!!e.searchKeywords.split(",").find(function(i){if(t.goods[i].includes(e.searchKey))return!0})})},onCloseClick:function(){this.$emit("update:visibleFlag",!1)}}},f=h,m=(i("a794"),Object(l["a"])(f,o,n,!1,null,"2fead56a",null));e["a"]=m.exports},"16c3":function(t,e,i){},"19b6":function(t,e,i){},"1b71":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"itemRowEdit-popup"},[i("w-header",{attrs:{title:t.currentItemData.goodsDTO.name,leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{staticClass:"itemRowEdit-content"},[i("van-cell-group",[i("van-cell",{attrs:{title:"非税单价",value:t.currentItemData.price,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"税率",value:t.fomatterTaxes(t.currentItemData.tax),"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"税额",value:t.currentItemData.taxInMoney,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"含税单价",value:t.currentItemData.taxPrice,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"含税金额",value:t.currentItemData.inMoneyWithTax,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"规格",value:t.currentItemData.goodsDTO.spec,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"品项编号",value:t.currentItemData.goodsDTO.code,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"批次号",value:t.currentItemData.batchCode,"value-class":"info-item-value"}}),i("van-pro-field",{attrs:{placeholder:t.setPlaceholder("请输入备注"),disabled:t.isDisabled,label:"备注","value-class":"info-item-value","input-align":"right"},model:{value:t.currentItemData.memo,callback:function(e){t.$set(t.currentItemData,"memo",e)},expression:"currentItemData.memo"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"净重量",value:t.toFixedNumberSize(t.currentItemData.netWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"皮重量",value:t.toFixedNumberSize(t.currentItemData.skinWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"毛重量",value:t.toFixedNumberSize(t.currentItemData.grossWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"称重单位",value:t.currentItemData.weightUnit,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"称重状态",value:t.currentItemData.isWeightSign?"已称重":"未称重","value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"图片",border:!1,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData&&t.currentItemData.images.length,expression:"sysShowDZCData && currentItemData.images.length"}],staticClass:"info-cell-img",attrs:{"value-class":"info-item-img"}},[i("img",{attrs:{src:t.comptedItemImgSrc(t.currentItemData.images)}})])],1)],1),i("div",{staticClass:"itemRowEdit-bottom"},[t.isDisabled?i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onCloseClick}},[t._v("确定")]):i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onConfirmClick}},[t._v("保存")])],1)],1)},n=[],s=i("59ad"),a=i.n(s),r=i("f499"),c=i.n(r),l=i("cebc"),u=i("2f62"),d={name:"itemRowEdit",props:{visibleFlag:Boolean,itemData:{type:Object,default:function(){return{}}},isDisabled:Boolean},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},currentItemData:{}}},computed:Object(l["a"])({},Object(u["c"])({sysShowDZCData:function(t){return t.systemParams.sysShowDZCData},sysPointSize:"sysPointSize"}),{setPlaceholder:function(t){var e=this;return function(t){return e.isDisabled?"":t}},comptedItemImgSrc:function(t){return function(t){return t?0===t.length?"":t[0].imagUrl:""}},fomatterTaxes:function(t){var e=this;return function(t){if(t){var i=e.$fxUtils.toFixedSHW(100*t,2,!1);return"".concat(i,"%")}return"0%"}}}),watch:{visibleFlag:{handler:function(t){t&&(this.currentItemData=JSON.parse(c()(this.itemData)))},immediate:!0}},methods:{toFixedNumberSize:function(t){return a()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onConfirmClick:function(){this.currentItemData.id&&(this.currentItemData.changeType="edit"),this.$emit("on-Confirm",this.currentItemData),this.$emit("update:visibleFlag",!1)}}},h=d,f=(i("7c07"),i("2877")),m=Object(f["a"])(h,o,n,!1,null,"76098194",null);e["a"]=m.exports},"232e":function(t,e,i){},2599:function(t,e,i){"use strict";var o=i("2e9b"),n=i.n(o);n.a},"28a21":function(t,e,i){"use strict";var o=i("fef9"),n=i.n(o);n.a},"2e9b":function(t,e,i){},3124:function(t,e,i){"use strict";var o=i("232e"),n=i.n(o);n.a},3155:function(t,e,i){},3509:function(t,e,i){},"43e0":function(t,e,i){},"465e":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-detail-cell",class:{"is-active":t.rowActive===t.itemIndex,"is-error":t.isError},on:{click:t.onItemClick}},[i("div",{staticClass:"item-details-img"},[i("img",{attrs:{src:t.comptedItemImgSrc(t.itemData.goods.imageUrls),onerror:t.$fxCommon.errorImg("item")}})]),i("div",{staticClass:"item-details-params"},[i("div",{staticClass:"item-details-name fx-ellipsis"},[t._v(t._s(t.itemData.goods.name))]),i("div",{staticClass:"item-details-spec fx-ellipsis"},[t._v("\n\t\t\t"+t._s(t.itemData.name)+"\n\t\t")]),i("div",{staticClass:"item-details-amount"},[i("span",{staticClass:"item-details-count"},[t._v(t._s(t.getItemAmount()))]),i("span",{staticClass:"item-details-unit"},[t._v(t._s(t.itemData.unit.name))])]),i("i",{directives:[{name:"show",rawName:"v-show",value:t.getItemAmount()>0||t.isActive,expression:"(getItemAmount()>0 || isActive)"}],staticClass:"item-selected-icon"})]),i("van-checkbox",{staticClass:"item-checkbox",on:{click:function(e){return t.clickCheckBoxes()}},model:{value:t.itemData.checked,callback:function(e){t.$set(t.itemData,"checked",e)},expression:"itemData.checked"}})],1)},n=[],s=(i("c5f6"),{name:"bomAddItemCell",props:{itemData:{type:Object,default:function(){return{}}},itemIndex:Number,rowActive:[Number,String],isActive:Boolean,isError:Boolean,showSpec:{type:Boolean,default:!0},itemAmoutName:{type:String,default:""}},computed:{comptedItemImgSrc:function(t){return function(t){return t?0===t.length?"":t[0]:""}}},methods:{onItemClick:function(){this.$emit("on-item-click",this.itemIndex)},getItemAmount:function(){return""===this.itemAmoutName?this.itemData.busUnitAmount:this.itemData[this.itemAmoutName]},clickCheckBoxes:function(){this.$emit("on-checkbox-click",this.itemData)}}}),a=s,r=(i("cfc1"),i("2877")),c=Object(r["a"])(a,o,n,!1,null,"395c4cae",null);e["a"]=c.exports},"4c8b":function(t,e,i){"use strict";var o=i("e453"),n=i.n(o);n.a},5443:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"details-content",staticClass:"item-details-content"},[i("van-list",{attrs:{finished:t.loadFinished,"finished-text":"没有更多了",error:t.listError,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.listError=e},load:t.onLoadMore},model:{value:t.currentListLoading,callback:function(e){t.currentListLoading=e},expression:"currentListLoading"}},t._l(t.itemList,function(e,o){return i("div",{key:e.goods.id,ref:"details-row-"+o,refInFor:!0,staticClass:"item-detail"},[t._t("item-cell",null,{$item:e,$index:o})],2)}),0)],1)},n=[],s=(i("c5f6"),{name:"bomAddItemList",props:{value:[String,Number],itemList:{type:Array,default:function(){return[]}},listLoading:Boolean,loadFinished:Boolean,listError:{type:Boolean,default:!1}},data:function(){return{activeNames:[],currentListLoading:!1}},watch:{listLoading:{handler:function(t){this.currentListLoading=t},immediate:!0},currentListLoading:function(t){this.$emit("update:listLoading",t)}},computed:{comptedItemImgSrc:function(t){return function(t){return 0===t.length?"":t[0]}}},methods:{onLoadMore:function(){this.$emit("on-load-more")},onSelectLetter:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40,i=this.$refs["details-row-".concat(t)];if(!i||0===i.length)return!1;var o=i[0].offsetTop,n=this.$refs["details-content"];this.$fxUtils.scrollTopW({offsetTop:o,$el:n,distance:e})}}}),a=s,r=(i("28a21"),i("2877")),c=Object(r["a"])(a,o,n,!1,null,"5d77ea3a",null);e["a"]=c.exports},"56be":function(t,e,i){"use strict";var o=i("16c3"),n=i.n(o);n.a},"5d77":function(t,e,i){},"609a":function(t,e,i){"use strict";var o=i("e965"),n=i.n(o);n.a},"65ff":function(t,e,i){},"6d5f":function(t,e,i){},"7c07":function(t,e,i){"use strict";var o=i("d21a"),n=i.n(o);n.a},"7d80":function(t,e,i){},"87f9":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-edit"},[i("w-header",{attrs:{title:"选择品项",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}},[i("van-icon",{staticClass:"header-confirm-btn",attrs:{slot:"header-right",name:"success"},on:{click:t.onItemConfirm},slot:"header-right"})],1),i("div",{staticClass:"item-search clearfix"},[i("van-search",{attrs:{placeholder:"请输入搜索关键词",shape:"round"},on:{search:t.search},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}})],1),i("div",{staticClass:"item-edit-content"},[i("addItemClassList",{attrs:{itemClassList:t.itemClassList},on:{"on-select-class":t.selectClass},model:{value:t.currentClass,callback:function(e){t.currentClass=e},expression:"currentClass"}}),i("addItemList",{ref:"addItemList",attrs:{listLoading:t.listLoading,loadFinished:t.loadFinished,itemList:t.itemList},on:{"update:listLoading":function(e){t.listLoading=e},"update:list-loading":function(e){t.listLoading=e},"on-load-more":t.onLoadMore},scopedSlots:t._u([{key:"item-cell",fn:function(e){return[i("addItemCell",{attrs:{itemData:e.$item,itemIndex:e.$index,rowActive:t.rowActive,itemAmoutName:"busUnitInAmount"},on:{"on-item-click":t.onItemEdit}})]}}]),model:{value:t.rowActive,callback:function(e){t.rowActive=e},expression:"rowActive"}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.numberKeyboardShow,expression:"numberKeyboardShow"}],staticClass:"details-number-keyboard"},[i("itemNumberKeyboard",{attrs:{title:t.keyboardTitleCompted,unit:t.keyboardUnitCompted,amount:t.keyboardAmountCompted,unitEdit:t.$fxAuth("insideMoveBill.modifyUnit"),pointSize:t.sysPointSize,intLength:t.numberLength},on:{change:t.onKeyboardChange,pre:t.onKeyboardPre,next:t.onKeyboardNext,hide:t.onKeyboardHide,"on-unit-unitEdit":t.onUnitEdit}})],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("w-action-sheet",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.scanActionShow,expression:"scanActionShow"}],ref:"scanActionSheet",attrs:{actions:t.scanActions},model:{value:t.scanActionShow,callback:function(e){t.scanActionShow=e},expression:"scanActionShow"}})],1)},n=[],s=i("59ad"),a=i.n(s),r=(i("20d6"),i("ac6a"),i("75fc")),c=i("795b"),l=i.n(c),u=i("f499"),d=i.n(u),h=(i("7f7f"),i("cebc")),f=i("2f62"),m=i("d444"),p=i("01f7"),v=i("9c7f"),g=i("af41"),S=10,I={name:"itemEditComp",components:{addItemClassList:m["a"],addItemList:p["a"],addItemCell:v["a"],itemNumberKeyboard:g["a"]},props:{visibleFlag:Boolean,shopId:String,inHouseId:String,outHouseId:String,parentStoreItem:{type:Array,default:function(){return[]}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",currentClass:"",itemClassList:[],itemList:[],numberKeyboardShow:!1,rowActive:"",selectedItemArr:[],itemListStart:0,listLoading:!1,loadFinished:!0,listError:!1,unitActionShow:!1,unitActions:[],scanActionShow:!1,scanActions:[{name:"累加数量"},{name:"覆盖数量"}]}},computed:Object(h["a"])({},Object(f["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{keyboardTitleCompted:function(){if(""===this.rowActive)return"";var t=this.itemList[this.rowActive];return t.goodsDTO.name},keyboardUnitCompted:function(){if(""===this.rowActive)return"";var t=this.itemList[this.rowActive];return t.unitDTO.name},keyboardAmountCompted:function(){if(""===this.rowActive)return"0";var t=this.itemList[this.rowActive];return t.busUnitInAmount}}),watch:{visibleFlag:{handler:function(t){t?(this.selectedItemArr=JSON.parse(d()(this.parentStoreItem)),this.refresh(),this.$fxEventBus.$on("redCode",this.getItemByRedCode)):this.$fxEventBus.$off("redCode",this.getItemByRedCode)},immediate:!0},rowActive:function(t,e){""!==e&&(this.numberStringAmount(e),this.pushSelectedItem(this.itemList[e]),""===t&&(this.numberKeyboardShow=!1))}},methods:{refresh:function(){var t=this;this.searchKey="",this.getItemClass().then(function(e){t.itemClassList=e.goodsTypes,t.currentClass="",t.getItemByClass()})},onCloseClick:function(){this.rowActive="",this.$emit("update:visibleFlag",!1)},onItemConfirm:function(){var t=this;this.rowActive="",this.$nextTick(function(){t.$emit("on-confirm",t.selectedItemArr),t.$emit("update:visibleFlag",!1)})},search:function(){this.getItemByClass()},getItemClass:function(){var t=this;return new l.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.inHouseId,"/users/").concat(t.loginerId,"/goodTypes")}).then(function(t){e(t)})})},getItem:function(){var t=this;return new l.a(function(e){var i={start:t.itemListStart,size:S,paged:!0,m:"getGoodsForInshop",goodsSmallTypeId:t.currentClass||null,inHouseId:t.inHouseId,outHouseId:t.outHouseId,searchText:t.searchKey||null};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/insideMoveBillDetails"),data:i}).then(function(t){e(t)})})},getItemByClass:function(){var t=this;this.itemListStart=0,this.getItem().then(function(e){t.itemList=t.setResItem(e.billAndDetails),t.setListLoading(e.billAndDetails.length),t.$nextTick(function(){t.$refs.addItemList&&t.$refs.addItemList.onSelectLetter(0,5)})})},onLoadMore:function(){var t=this;this.getItem().then(function(e){var i;(i=t.itemList).push.apply(i,Object(r["a"])(t.setResItem(e.billAndDetails))),t.setListLoading(e.billAndDetails.length)})},setResItem:function(t){var e=this;return t.forEach(function(t){var i=e.selectedItemArr.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id});~i?"del"!==e.selectedItemArr[i].changeType&&(t.busUnitInAmount=e.selectedItemArr[i].busUnitInAmount,t.unitDTO=e.selectedItemArr[i].unitDTO):t.busUnitInAmount="0"}),t},setListLoading:function(t){this.listLoading=!1,this.itemListStart+=S,this.loadFinished=t<S},selectClass:function(t){this.searchKey="",this.onKeyboardHide(),this.getItemByClass()},onItemEdit:function(t){this.rowActive=t,this.numberKeyboardShow=!0,this.$refs.addItemList.onSelectLetter(this.rowActive,20)},onKeyboardChange:function(t){this.itemList[this.rowActive].busUnitInAmount=t},numberStringAmount:function(t){var e=this.itemList[t].busUnitInAmount;this.itemList[t].busUnitInAmount=a()(e),this.itemList[t].price=0,this.itemList[t].inMoney=0},pushSelectedItem:function(t){var e=this.selectedItemArr.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id&&"del"!==e.changeType});~e?this.selectedItemArr[e].id||0!==t.busUnitInAmount?(this.selectedItemArr[e].id&&0===t.busUnitInAmount?this.selectedItemArr[e].changeType="del":this.selectedItemArr[e].id&&(this.selectedItemArr[e].changeType="edit"),this.selectedItemArr[e].busUnitInAmount=t.busUnitInAmount,this.selectedItemArr[e].unitDTO=t.unitDTO):this.selectedItemArr.splice(e,1):t.busUnitInAmount>0&&(t.changeType="add",this.selectedItemArr.push(t))},onKeyboardPre:function(){if(!this.rowActive)return!1;this.rowActive--,this.$refs.addItemList.onSelectLetter(this.rowActive,5)},onKeyboardNext:function(){if(""===this.rowActive||this.rowActive===this.itemList.length-1)return!1;this.rowActive++,this.$refs.addItemList.onSelectLetter(this.rowActive,5)},onKeyboardHide:function(){this.rowActive=""},onUnitEdit:function(){var t=this;if(!this.$fxAuth("insideMoveBill.modifyUnit"))return!1;var e=this.itemList[this.rowActive].goodsDTO.id;this.getItemUnit(e).then(function(e){t.unitActions=e,t.unitActionShow=!0})},getItemUnit:function(t){var e=this;return new l.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/shopId/users/userId/goods/").concat(t,"/units"),query:{userId:e.loginerId}}).then(function(t){i(t.units)})})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemList[this.rowActive],i=e.unitDTO,o=i.value/t.value,n=a()(this.$fxUtils.toFixedSHW(e.busUnitInAmount*o,this.sysPointSize));e.unitDTO=t,e.busUnitInAmount=n},createBreakBill:function(t){var e=this;return new l.a(function(i){var o={billEmp:"",billMemo:"",billState:0,businessDate:(new Date).getTime(),businessTypeDTO:{},shopDTO:{id:e.shopId},details:[],updateIndicator:"Append",autoType:1,reckonBreak:"0",detailAdd:[t],accountDTO:{id:e.loginerId}};e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/breakBills"),data:o,query:{m:"addAndCheckBill"}}).then(function(t){i(),e.$fxToast.success("报损成功！")})})},getItemByRedCode:function(t){if(!this.visibleFlag)return!1;this.onRedTwoCodeHandler(t)},onRedTwoCodeHandler:function(t){var e=this;this.getItemByCode(t,!1).then(function(i){"100"===i.errorCode||"101"===i.errorCode?e.$dialog.confirm({title:"提示",message:i.message}).then(function(){if("100"===i.errorCode)return e.createBreakBill(i.storeBillDetailDTO),!0;e.getItemByCode(t,!0).then(function(t){e.setScanGood(t.storeBillDetailDTO)})}):e.setScanGood(i.storeBillDetailDTO)})},getItemByCode:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new l.a(function(o){var n={qrCodeContent:t,houseId:e.inHouseId,outHouseId:e.outHouseId,billType:23,nextFlag:i};e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.shopId,"/users/").concat(e.loginerId,"/getscancodedata"),query:n}).then(function(t){o(t)})})},setScanGood:function(t){var e=this,i=[];i=this.selectedItemArr;var o=i.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id&&"del"!==e.changeType});if(~o){var n=i.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id&&t.unitDTO.id===e.unitDTO.id&&"del"!==e.changeType});if(!~n)return this.$fxToast.fail("不能重复添加品项！"),!1;var s=i[o];if(s.batchCode!==t.batchCode&&this.$fxUtils.isDef(s.batchCode))return this.$fxToast.fail("不能重复添加品项！"),!1;this.$refs.scanActionSheet.doSelect().then(function(i){"累加数量"===i.name&&e.computedScanItemAmount(t,s),e.refreshSelectItem(t,s),e.itemList=[t]})}else this.itemList=[t],this.pushSelectedItem(t),this.$fxToast.success("扫码添加品项成功！")},computedScanItemAmount:function(t,e){var i=this.toFixedNumberSize(t.busUnitInAmount+e.busUnitInAmount);t.busUnitInAmount=this.$fxCommon.checkAmountRange(i)},refreshSelectItem:function(t,e){e.busUnitInAmount=t.busUnitInAmount,e.batchCode=t.batchCode,this.editItem(e)},toFixedNumberSize:function(t){return a()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},editItem:function(t){t.id&&this.$set(t,"changeType","edit")}}},b=I,D=(i("ee8e"),i("2877")),w=Object(D["a"])(b,o,n,!1,null,"d5a5e8f2",null);e["a"]=w.exports},"8b23":function(t,e,i){"use strict";var o=i("43e0"),n=i.n(o);n.a},"92f0":function(t,e,i){},9874:function(t,e,i){"use strict";var o=i("92f0"),n=i.n(o);n.a},"9ae0":function(t,e,i){"use strict";var o=i("b267"),n=i.n(o);n.a},a794:function(t,e,i){"use strict";var o=i("3155"),n=i.n(o);n.a},aa93:function(t,e,i){},aafe:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-edit"},[i("w-header",{attrs:{title:"选择成品BOM",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}},[i("van-icon",{staticClass:"header-confirm-btn",attrs:{slot:"header-right",name:"success"},on:{click:t.onItemConfirm},slot:"header-right"})],1),i("div",{staticClass:"item-search clearfix"},[i("van-search",{attrs:{placeholder:"请输入搜索关键词",shape:"round"},on:{search:t.search,focus:t.onSearchFocus},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}})],1),i("div",{staticClass:"item-edit-content"},[i("addItemClassList",{attrs:{itemClassList:t.itemClassList},on:{"on-change-class":t.changeClass},model:{value:t.currentClass,callback:function(e){t.currentClass=e},expression:"currentClass"}}),i("addItemList",{ref:"addItemList",attrs:{listLoading:t.listLoading,loadFinished:t.loadFinished,itemList:t.itemList},on:{"update:listLoading":function(e){t.listLoading=e},"update:list-loading":function(e){t.listLoading=e},"on-load-more":t.onLoadMore},scopedSlots:t._u([{key:"item-cell",fn:function(e){return[i("addBomCell",{attrs:{itemData:e.$item,itemIndex:e.$index,rowActive:t.rowActive,itemAmoutName:"bomAmount"},on:{"on-item-click":t.onItemEdit,"on-checkbox-click":t.clickCheckBoxes}})]}}]),model:{value:t.rowActive,callback:function(e){t.rowActive=e},expression:"rowActive"}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.numberKeyboardShow,expression:"numberKeyboardShow"}],staticClass:"details-number-keyboard"},[i("itemNumberKeyboard",{attrs:{title:t.keyboardTitleCompted,otherTitle:t.keyboardBomTitleCompted,unit:t.keyboardUnitCompted,unitEdit:!1,amount:t.keyboardAmountCompted,pointSize:t.sysPointSize,intLength:t.numberLength},on:{change:t.onKeyboardChange,"on-othertitle-edit":t.onOtherTitleClick,pre:t.onKeyboardPre,next:t.onKeyboardNext,hide:t.onKeyboardHide}})],1),i("van-actionsheet",{attrs:{actions:t.bomActions,"cancel-text":"取消"},on:{select:t.onBomSelect},model:{value:t.bomActionShow,callback:function(e){t.bomActionShow=e},expression:"bomActionShow"}})],1)},n=[],s=i("768b"),a=(i("20d6"),i("75fc")),r=(i("ac6a"),i("795b")),c=i.n(r),l=i("59ad"),u=i.n(l),d=(i("7514"),i("7f7f"),i("cebc")),h=i("2f62"),f=i("d444"),m=i("5443"),p=i("465e"),v=i("91c3"),g=10,S={name:"bomEditComp",components:{addItemClassList:f["a"],addItemList:m["a"],addBomCell:p["a"],itemNumberKeyboard:v["a"]},props:{visibleFlag:Boolean,shopId:{type:String,default:""}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",currentClass:"",itemClassList:[],itemList:[],numberKeyboardShow:!1,rowActive:"",selectedItemArr:[],itemListStart:0,listLoading:!1,loadFinished:!0,bomActionShow:!1,bomActions:[]}},computed:Object(d["a"])({},Object(h["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",loginerId:function(t){return t.loginer.loginerId}}),{keyboardTitleCompted:function(){if(""===this.rowActive)return"";var t=this.itemList[this.rowActive];return t.goods.name},keyboardBomTitleCompted:function(){if(""===this.rowActive)return"";var t=this.itemList[this.rowActive];return t.name},keyboardUnitCompted:function(){if(""===this.rowActive)return"";var t=this.itemList[this.rowActive];return t.unit.name},keyboardAmountCompted:function(){if(""===this.rowActive)return"0";var t=this.itemList[this.rowActive];return t.bomAmount}}),watch:{visibleFlag:{handler:function(t){t&&this.refresh()},immediate:!0},rowActive:function(t,e){""!==e?(this.numberStringAmount(e),""===t?this.numberKeyboardShow=!1:this.scrollToActive(t)):this.scrollToActive(t)}},methods:{refresh:function(){var t=this;this.searchKey="",this.selectedItemArr=[],this.getItemClass().then(function(e){t.itemClassList=e.goodsTypes,t.currentClass="",t.getItemByClass()})},onCloseClick:function(){this.rowActive="",this.$emit("update:visibleFlag",!1)},onItemConfirm:function(){var t=this,e=this.selectedItemArr.find(function(t){return 0===u()(t.bomAmount)});return e?(this.$fxToast.top("请填写数量!"),!1):this.selectedItemArr&&0!==this.selectedItemArr.length?(this.rowActive="",void this.$nextTick(function(){t.$emit("on-bom-confirm",t.selectedItemArr),t.$emit("update:visibleFlag",!1)})):(this.$fxToast.fail("请选择品项!"),!1)},search:function(){this.getItemByClass()},getItemClass:function(){var t=this;return new c.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/goodTypes")}).then(function(t){e(t)})})},getItem:function(){var t=this;return new c.a(function(e){var i={shopId:t.shopId,paged:!0,start:t.itemListStart,size:g,searchText:t.searchKey||"",goodsTypeId:t.currentClass||null};t.$fxHttp.requestPost({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/insideMoveBillDetails"),data:i,query:{m:"getProductBomList"}}).then(function(t){t.productBom.forEach(function(t){t.checked=!1}),e(t)})})},getItemByClass:function(){var t=this;this.itemListStart=0,this.getItem().then(function(e){t.itemList=t.setResItem(e.productBom),t.setListLoading(e.productBom.length),t.selectedItemArr.length&&t.checkItem(t.itemList),t.$nextTick(function(){t.$refs.addItemList&&t.$refs.addItemList.onSelectLetter(0,5)})})},onLoadMore:function(){var t=this;this.getItem().then(function(e){var i;(i=t.itemList).push.apply(i,Object(a["a"])(t.setResItem(e.productBom))),t.setListLoading(e.productBom.length),t.selectedItemArr.length&&t.checkItem(e.productBom)})},setResItem:function(t){var e=this;return t.forEach(function(t){var i=e.selectedItemArr.findIndex(function(e){return t.goods.id===e.goods.id});~i?(t.bomAmount=e.selectedItemArr[i].bomAmount,t.name=e.selectedItemArr[i].name,t.id=e.selectedItemArr[i].id):t.bomAmount="0"}),t},setListLoading:function(t){this.listLoading=!1,this.itemListStart+=g,this.loadFinished=t<g},checkItem:function(t){var e=this;t.forEach(function(t,i){var o=e.selectedItemArr.find(function(e){return e.id===t.id});t.checked=!!o})},changeClass:function(t){var e=Object(s["a"])(t,2);e[0],e[1];this.searchKey="",this.onKeyboardHide(),this.getItemByClass()},onItemEdit:function(t){this.rowActive=t,this.numberKeyboardShow=!0},onKeyboardChange:function(t){this.itemList[this.rowActive].bomAmount=t,t>0?(this.itemList[this.rowActive].checked=!0,this.clickCheckBoxes(this.itemList[this.rowActive])):this.itemList[this.rowActive].checked=!1},numberStringAmount:function(t){var e=u()(this.itemList[t].bomAmount);this.itemList[t].bomAmount=e},onKeyboardPre:function(){if(!this.rowActive)return!1;this.rowActive--},onKeyboardNext:function(){if(""===this.rowActive||this.rowActive===this.itemList.length-1)return!1;this.rowActive++},onKeyboardHide:function(){this.rowActive=""},scrollToActive:function(t){var e=this;this.$nextTick(function(){e.$refs.addItemList.onSelectLetter(t,20)})},onSearchFocus:function(){this.rowActive=""},onOtherTitleClick:function(){var t=this,e=this.itemList[this.rowActive].goods.id;this.getBom(e).then(function(e){t.bomActions=e.productBom,t.bomActionShow=!0})},getBom:function(t){var e=this;return new c.a(function(i){var o={shopId:e.shopId,goodsId:t};e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.shopId,"/users/").concat(e.loginerId,"/insideMoveBillDetails"),data:o,query:{m:"getProductBom"}}).then(function(t){i(t)})})},onBomSelect:function(t){this.bomActionShow=!1;var e=this.itemList[this.rowActive];e.name=t.name,e.id=t.id,e.unit=t.unit},clickCheckBoxes:function(t){t.checked?~this.getSelectItemIndex(t)||this.selectedItemArr.push(t):this.selectedItemArr.splice(this.getSelectItemIndex(t),1)},getSelectItemIndex:function(t){return this.selectedItemArr.findIndex(function(e){return e.id===t.id})}}},I=S,b=(i("609a"),i("2877")),D=Object(b["a"])(I,o,n,!1,null,"6900ced7",null);e["a"]=D.exports},abf3:function(t,e,i){"use strict";var o=i("19b6"),n=i.n(o);n.a},b267:function(t,e,i){},b4ed:function(t,e,i){"use strict";var o=i("6d5f"),n=i.n(o);n.a},bc05:function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-insideMoveBill-details"},[i("w-header",{attrs:{title:t.orderInfoData.sysbillCode,titleFontSize:"3.733vw",border:!0}}),i("orderInfo",{ref:"orderInfo",attrs:{data:t.orderInfoData,HouseManageDisabled:t.HouseManageDisabled,isDisabled:!t.$fxAuth("insideMoveBill.save")||t.isBillState(1)||t.isWeightState(1)||t.isWeightState(2),collapseDisabled:t.itemInputFocusing},on:{"on-busdate-click":t.onBusinessDateClick,"on-shop-click":t.onShopClick,"on-inStore-click":t.onInStoreClick,"on-outStore-click":t.onOutStoreClick,"on-houseManaged-click":t.onHouseManaged,"on-inStore-clear":t.onInStoreClear,"on-outStore-clear":t.onOutStoreClear}}),i("orderItem",{attrs:{data:t.orderItemList,isDisabled:!t.$fxAuth("insideMoveBill.save")||t.isBillState(1)||t.isWeightState(1)||t.isWeightState(2),itemInputFocusing:t.itemInputFocusing,autoType8:8===t.orderInfoData.autoType},on:{"update:itemInputFocusing":function(e){t.itemInputFocusing=e},"update:item-input-focusing":function(e){t.itemInputFocusing=e},"on-add-click":t.onAddClick,"on-search-click":t.onSearchClick,"on-unit-edit":t.onUnitEdit,"on-item-edit":t.onItemEdit,"on-item-focus":t.onItemFocus,"on-selectbom-click":t.onSelectBomClick,"on-viewbom-click":t.onViewBomClick}}),i("div",{staticClass:"insideMoveBill-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("insideMoveBill.del")&&t.isBillState(0)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('insideMoveBill.del') && isBillState(0) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onDeleteClick")}}},[t._v("删除")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("insideMoveBill.check")&&t.isBillState(0)&&(t.isWeightState(0)&&t.insideFlag||t.isWeightState(3)),expression:"$fxAuth('insideMoveBill.check') && isBillState(0)  && (isWeightState(0) && insideFlag || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onExpressClick")}}},[t._v("审核")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("insideMoveBill.unCheck")&&t.isBillState(1)&&t.isBillReState(0)&&t.insideFlag&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('insideMoveBill.unCheck') && isBillState(1) && isBillReState(0) && insideFlag && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onUnExpressClick")}}},[t._v("反审")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("insideMoveBill.reCheck")&&t.isBillState(1)&&t.isBillReState(0)&&t.insideFlag,expression:"$fxAuth('insideMoveBill.reCheck') && isBillState(1) && isBillReState(0) && insideFlag"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:function(e){return t.onClickHandler("onBillReStateClick")}}},[t._v("复审")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("insideMoveBill.unReCheck")&&t.isBillReState(1),expression:"$fxAuth('insideMoveBill.unReCheck') && isBillReState(1)"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onUnBillReStateClick")}}},[t._v("取消复审")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("insideMoveBill.save")&&t.isBillState(0)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('insideMoveBill.save') && isBillState(0) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:function(e){return t.onClickHandler("onSaveClick")}}},[t._v("保存")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("insideMoveBill.weighState")&&t.isBillState(0)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('insideMoveBill.weighState') && isBillState(0) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius yellow-btn",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onWeightClick")}}},[t._v("下发称重")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("insideMoveBill.weighState")&&t.isBillState(0)&&(t.isWeightState(1)||t.isWeightState(2)),expression:"$fxAuth('insideMoveBill.weighState') && isBillState(0) && (isWeightState(1) || isWeightState(2))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onUnWeightClick")}}},[t._v("取消称重")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("insideMoveBill.weighState")&&t.isBillState(0)&&t.isWeightState(2)&&t.sysDZCManyLower,expression:"$fxAuth('insideMoveBill.weighState') && isBillState(0) && isWeightState(2) && sysDZCManyLower"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onEndWeightClick")}}},[t._v("结束称重")])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right"},model:{value:t.shopPopShow,callback:function(e){t.shopPopShow=e},expression:"shopPopShow"}},[i("listComp",{attrs:{visibleFlag:t.shopPopShow,data:t.shopList,title:"请选择机构",loading:t.shopLoading,loadFinished:t.shopLoadFinished,immediateCheck:!1},on:{"update:visibleFlag":function(e){t.shopPopShow=e},"update:visible-flag":function(e){t.shopPopShow=e},"update:loading":function(e){t.shopLoading=e},"on-select":t.selectShop,"on-search":t.searchShop,"on-load":t.onShopLoad}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.inStorePopShow,callback:function(e){t.inStorePopShow=e},expression:"inStorePopShow"}},[i("listComp",{attrs:{visibleFlag:t.inStorePopShow,data:t.inStoreList,loadFinished:!0,title:"入库仓库检索"},on:{"update:visibleFlag":function(e){t.inStorePopShow=e},"update:visible-flag":function(e){t.inStorePopShow=e},"on-search":t.searchInStore,"on-select":t.selectInStore}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right"},model:{value:t.outStorePopShow,callback:function(e){t.outStorePopShow=e},expression:"outStorePopShow"}},[i("listComp",{attrs:{visibleFlag:t.outStorePopShow,data:t.outStoreList,title:"出库仓库检索",loading:t.outStoreLoading,loadFinished:t.outStoreLoadFinished,immediateCheck:!1},on:{"update:visibleFlag":function(e){t.outStorePopShow=e},"update:visible-flag":function(e){t.outStorePopShow=e},"update:loading":function(e){t.outStoreLoading=e},"on-select":t.selectOutStore,"on-search":t.searchOutStore,"on-load":t.onOutStoreLoad}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right"},model:{value:t.HouseManagedPopShow,callback:function(e){t.HouseManagedPopShow=e},expression:"HouseManagedPopShow"}},[i("listComp",{attrs:{visibleFlag:t.HouseManagedPopShow,searchShow:t.searchShow,data:t.HouseManagedList,title:"调拨类型",loading:t.HouseManagedLoading,loadFinished:t.HouseManagedLoadFinished,immediateCheck:!1},on:{"update:visibleFlag":function(e){t.HouseManagedPopShow=e},"update:visible-flag":function(e){t.HouseManagedPopShow=e},"update:loading":function(e){t.HouseManagedLoading=e},"on-select":t.houseManagedStore}})],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemPopShow,callback:function(e){t.itemPopShow=e},expression:"itemPopShow"}},[i("itemEditComp",{attrs:{visibleFlag:t.itemPopShow,inHouseId:t.orderInfoData.inHouseDTO&&t.orderInfoData.inHouseDTO.id,outHouseId:t.orderInfoData.outHouseDTO&&t.orderInfoData.outHouseDTO.id,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,parentStoreItem:t.orderItemList},on:{"update:visibleFlag":function(e){t.itemPopShow=e},"update:visible-flag":function(e){t.itemPopShow=e},"on-confirm":t.onItemEditConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,isDisabled:t.isBillState(1)||!t.$fxAuth("insideMoveBill.save")||t.isWeightState(1)||t.isWeightState(2)},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemSearchPopShow,callback:function(e){t.itemSearchPopShow=e},expression:"itemSearchPopShow"}},[i("itemSearchPop",{attrs:{visibleFlag:t.itemSearchPopShow,data:t.searchItem,houseDTO:t.orderInfoData.inHouseDTO,outHouseId:t.orderInfoData.outHouseDTO&&t.orderInfoData.outHouseDTO.id,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,autoType8:8===t.orderInfoData.autoType,isDisabled:t.isBillState(1)||!t.$fxAuth("insideMoveBill.save")||t.isWeightState(1)||t.isWeightState(2)},on:{"update:visibleFlag":function(e){t.itemSearchPopShow=e},"update:visible-flag":function(e){t.itemSearchPopShow=e},"on-search-confirm":t.onSearchConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.bomPopShow,callback:function(e){t.bomPopShow=e},expression:"bomPopShow"}},[i("bomEditComp",{attrs:{visibleFlag:t.bomPopShow,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id},on:{"update:visibleFlag":function(e){t.bomPopShow=e},"update:visible-flag":function(e){t.bomPopShow=e},"on-bom-confirm":t.onBomConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.bomSearchPopShow,callback:function(e){t.bomSearchPopShow=e},expression:"bomSearchPopShow"}},[i("bomSearchPop",{attrs:{visibleFlag:t.bomSearchPopShow,data:t.searchBom,searchKeywords:"code,name,pinYin"},on:{"update:visibleFlag":function(e){t.bomSearchPopShow=e},"update:visible-flag":function(e){t.bomSearchPopShow=e}}})],1)],1)},n=[],s=(i("7f7f"),i("f499")),a=i.n(s),r=(i("20d6"),i("5176")),c=i.n(r),l=i("75fc"),u=i("59ad"),d=i.n(u),h=(i("ac6a"),i("795b")),f=i.n(h),m=(i("6762"),i("2fdb"),i("6b54"),i("cebc")),p=i("2f62"),v=i("e80d"),g=i("e5ff"),S=i("f6bb"),I=i("87f9"),b=i("1b71"),D=i("085e"),w=i("aafe"),C=i("1454"),k=50,x={name:"insideMoveBillDetails",components:{orderInfo:v["a"],orderItem:g["a"],listComp:S["a"],itemEditComp:I["a"],itemRowEditPop:b["a"],itemSearchPop:D["a"],bomEditComp:w["a"],bomSearchPop:C["a"]},data:function(){return{query:this.$route.query,searchShow:!1,activeNames:["1"],tabActive:"选项1",orderInfoData:{},orderItemList:[],currentDate:new Date,datePickerShow:!1,itemPopShow:!1,shopPopShow:!1,shopList:[],shopListStart:0,shopLoading:!1,shopLoadFinished:!1,inStorePopShow:!1,inStoreListStart:0,inStoreLoading:!1,inStoreLoadFinished:!1,inStoreList:[],outStorePopShow:!1,outStoreList:[],outStoreListStart:0,outStoreLoading:!1,outStoreLoadFinished:!1,itemEditRowData:{},unitActionShow:!1,unitActions:[],itemRowEditPopShow:!1,itemInputFocusing:!1,orderDeleteFlag:!1,formatterSysPointKey:["busUnitInAmount","inMoney","inMoneyWithTax","taxInMoney"],itemSearchPopShow:!1,searchItem:[],orderBomList:[],bomPopShow:!1,insideFlag:!1,bomSearchPopShow:!1,searchBom:[],HouseManagedStart:0,HouseManagedPopShow:!1,HouseManagedList:[],HouseManagedLoading:!1,HouseManagedLoadFinished:!1,HouseManageDisabled:!0,houseManageDTO:[{code:"0",id:"0",name:"调入",pinYin:null,updateIndicator:"Append",disabledFlag:!0},{code:"1",id:"1",name:"调出",pinYin:null,updateIndicator:"Append",disabledFlag:!0}]}},created:function(){this.createOrderDetails()},beforeRouteLeave:function(t,e,i){var o=this;if(this.itemInputFocusing)return this.$router.go(1),!1;"/insideMoveBill"!==t.path||this.orderDeleteFlag||0!==this.orderInfoData.billState?i():this.$dialog.confirm({title:"提示",message:"若已修改,请先保存单据<br/>是否关闭页面?"}).then(function(){i()}).catch(function(){return o.$router.go(1),!1})},computed:Object(m["a"])({},Object(p["c"])({sysPointSize:"sysPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerShopName:function(t){return t.loginer.loginerShopName},loginerOrganType:function(t){return t.loginer.loginerOrganType},loginerId:function(t){return t.loginer.loginerId},sysDZCManyLower:function(t){return t.systemParams.sysDZCManyLower},sysInsideMoveBillCheckWay:function(t){return t.systemParams.sysInsideMoveBillCheckWay}}),{isBillState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.billState):e.orderInfoData.billState===t}},isBillReState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.billReState):e.orderInfoData.billReState===t}},isWeightState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.weightState):e.orderInfoData.weightState===t}}}),methods:{checkHouseStore:function(t){var e=this;return new f.a(function(i){var o=e.orderInfoData.outHouseDTO;o.id!==t.id&&i()})},isinAllocateType:function(){console.log(this.sysInsideMoveBillCheckWay),"0"===this.sysInsideMoveBillCheckWay?this.insideFlag="1"===this.HouseManagedStates||"2"===this.HouseManagedStates||"3"===this.HouseManagedStates:"1"===this.sysInsideMoveBillCheckWay?this.insideFlag="2"===this.HouseManagedStates:"2"===this.sysInsideMoveBillCheckWay?this.insideFlag="1"===this.HouseManagedStates||"3"===this.HouseManagedStates:"3"===this.sysInsideMoveBillCheckWay&&("1"===this.orderInfoData.insideMoveType&&"1"===this.HouseManagedStates?this.insideFlag=!0:"0"===this.orderInfoData.insideMoveType&&"2"===this.HouseManagedStates?this.insideFlag=!0:"3"===this.HouseManagedStates?this.insideFlag=!0:this.insideFlag=!1)},onHouseManaged:function(){this.onHouseManagedRefresh()},onHouseManagedRefresh:function(){this.HouseManagedStart=0,this.HouseManagedPopShow=!0,this.HouseManagedLoading=!1,this.HouseManagedStart+=k,this.HouseManagedLoadFinished=this.houseManageDTO.length<k,this.HouseManagedList=this.houseManageDTO},houseManagedStore:function(t){this.orderInfoData.houseManageDTO=t,this.orderInfoData.insideMoveType=t.code},houseManagedLoad:function(){console.log("111")},initAllocateType:function(){var t=this,e=this.orderInfoData.inHouseDTO.id,i=this.orderInfoData.outHouseDTO.id;e&&i&&this.getHouseManagedStatus(e,i).then(function(e){t.HouseManagedStates=e.shops[0].pinYin,"1"===t.HouseManagedStates||"0"===t.HouseManagedStates?t.HouseManageDisabled=!0:"2"===t.HouseManagedStates?t.HouseManageDisabled=!0:"3"===t.HouseManagedStates&&(t.HouseManageDisabled=!1),t.isinAllocateType()})},checkAllocateType:function(t){var e=this,i=this.orderInfoData.inHouseDTO.id,o=this.orderInfoData.outHouseDTO.id;i&&o&&this.getHouseManagedStatus(i,o).then(function(i){if(e.HouseManagedStates=i.shops[0].pinYin,e.orderInfoData.houseManageDTO=e.houseItem,"0"===e.HouseManagedStates)return e.$fxToast.top("调出仓库和调入仓库必须管辖其中之一！"),"1"===t?e.orderInfoData.inHouseDTO="":"2"===t&&(e.orderInfoData.outHouseDTO=""),!1;"1"===e.HouseManagedStates?(e.orderInfoData.houseManageDTO=e.houseManageDTO[0],e.orderInfoData.insideMoveType="0",e.HouseManageDisabled=!0):"2"===e.HouseManagedStates?(e.orderInfoData.houseManageDTO=e.houseManageDTO[1],e.orderInfoData.insideMoveType="1",e.HouseManageDisabled=!0):"3"===e.HouseManagedStates&&(e.orderInfoData.insideMoveType="0",e.orderInfoData.houseManageDTO=e.houseManageDTO[0],e.HouseManageDisabled=!1),e.isinAllocateType()})},getHouseManagedStatus:function(t,e){var i={m:"selHouseManagedStatus",houseIds:t+","+e};return this.$fxApi("insideMoveBill.getHouseManagedStatus")({data:i})},settingHouseManageDTO:function(t){if("0"===t.insideMoveType)t.houseManageDTO=this.houseManageDTO[0];else{if("1"!==t.insideMoveType)return!1;t.houseManageDTO=this.houseManageDTO[1]}},createOrderDetails:function(){var t=this;return new f.a(function(e){t.getOrderDetails().then(function(i){var o=i.storeBills[0];o.houseManageDTO={},t.settingHouseManageDTO(o),t.formatterSysPoint(o.details),t.orderInfoData=o,t.initAllocateType(),t.orderItemList=t.filterStoreItem(o.details),o.billBom&&o.billBom.length&&(t.orderBomList=o.billBom),e()})})},getOrderDetails:function(){var t=this;return new f.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/insideMoveBill/").concat(t.query.orderId)}).then(function(t){e(t)})})},formatterSysPoint:function(t){var e=this;t.forEach(function(t){e.formatterSysPointKey.forEach(function(i){t[i]=e.toFixedNumberSize(t[i])})})},toFixedNumberSize:function(t){return d()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},filterStoreItem:function(t){var e=this;return t.forEach(function(t){var i=d()(t.busUnitInAmount);i?(t.price=e.toFixedNumberSize(t.inMoney/i),t.taxPrice=e.toFixedNumberSize(t.inMoneyWithTax/i)):(t.price=e.toFixedNumberSize(t.price),t.taxPrice=e.toFixedNumberSize(t.taxPrice))}),t},onBusinessDateClick:function(){this.orderInfoData.businessDate&&(this.currentDate=new Date(this.orderInfoData.businessDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){var e=t.getTime();this.orderInfoData.businessDate=e,this.datePickerShow=!1},clearItemConfim:function(t){var e=this;return new f.a(function(i){var o=e.orderItemList.filter(function(t){return"del"!==t.changeType});0===o.length?i():e.$dialog.confirm({title:"提示",message:t}).then(function(){e.clearItemHandler(),i()}).catch(function(){})})},clearItemHandler:function(){var t=this.orderItemList.filter(function(t){return!!t.id});t.forEach(function(t){t.changeType="del"}),this.orderItemList=t},onShopClick:function(){this.onShopRefresh()},searchShop:function(t){this.onShopRefresh(t)},selectShop:function(t){var e=this;this.checkShop(t).then(function(){e.clearItemConfim("更换机构会清空品项,是否继续?").then(function(){e.orderInfoData.shopDTO=t,e.orderInfoData.inHouseDTO={},e.orderInfoData.outHouseDTO={}})})},checkShop:function(t){var e=this;return new f.a(function(i){var o=e.orderInfoData.shopDTO;o.id!==t.id&&i()})},onShopRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.shopListStart=0,this.getShopListData(e).then(function(e){t.shopPopShow=!0,t.shopLoading=!1,t.shopListStart+=k,t.shopLoadFinished=e.shops.length<k,t.shopList=e.shops})},onShopLoad:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getShopListData(e).then(function(e){var i;t.shopLoading=!1,t.shopListStart+=k,e.shops.length<k&&(t.shopLoadFinished=!0),(i=t.shopList).push.apply(i,Object(l["a"])(e.shops))})},getShopListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new f.a(function(i){var o={m:"getShopListForInsideMove",start:t.shopListStart,size:k,paged:!0,keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/shops"),data:o}).then(function(t){i(t)})})},onInStoreClick:function(){return this.orderInfoData.shopDTO.id?this.orderInfoData.outHouseDTO.id?void this.onInStoreRefresh():(this.$fxToast.top("请先选择出库仓库！"),!1):(this.$fxToast.fail("请先选择机构!"),!1)},searchInStore:function(t){this.onInStoreRefresh(t)},selectInStore:function(t){var e=this;this.checkInStore(t).then(function(){e.clearItemConfim("更换入库仓库会清空品项,是否继续?").then(function(){e.orderInfoData.inHouseDTO=t,e.checkAllocateType("1")})})},checkInStore:function(t){var e=this;return new f.a(function(i){var o=e.orderInfoData.inHouseDTO;o.id!==t.id&&i()})},onInStoreRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.inStoreListStart=0,this.getInStoreListData(e).then(function(e){t.inStorePopShow=!0,t.inStoreLoading=!1,t.inStoreListStart+=k,t.inStoreLoadFinished=e.shops.length<k,t.inStoreList=e.shops})},onInStoreLoad:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getInStoreListData(e).then(function(e){var i;t.inStoreLoading=!1,t.inStoreListStart+=k,e.shops.length<k&&(t.inStoreLoadFinished=!0),(i=t.inStoreList).push.apply(i,Object(l["a"])(e.shops))})},getInStoreListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new f.a(function(i){var o={m:"getInHouseListForInsideMove",orgId:t.orderInfoData.shopDTO.id,houseId:t.orderInfoData.outHouseDTO.id,start:t.inStoreListStart,size:k,paged:!0,keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.orderInfoData.shopDTO.id,"/users/").concat(t.loginerId,"/houses"),data:o}).then(function(t){i(t)})})},onInStoreClear:function(){var t=this;this.clearItemConfim("更换入库仓库会清空品项,是否继续?").then(function(){t.orderInfoData.inHouseDTO={},t.orderInfoData.insideMoveType="",t.orderInfoData.houseManageDTO={},t.HouseManageDisabled=!0})},onOutStoreClick:function(){if(!this.orderInfoData.shopDTO.id)return this.$fxToast.fail("请先选择机构!"),!1;this.onOutStoreRefresh()},searchOutStore:function(t){this.onOutStoreRefresh(t)},selectOutStore:function(t){var e=this;this.checkOutStore(t).then(function(){e.clearItemConfim("更换出库仓库会清空品项,是否继续?").then(function(){e.orderInfoData.outHouseDTO=t,e.checkAllocateType("2")})})},checkOutStore:function(t){var e=this;return new f.a(function(i){var o=e.orderInfoData.outHouseDTO;o.id!==t.id&&i()})},onOutStoreRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.outStoreListStart=0,this.getOutStoreListData(e).then(function(e){t.outStorePopShow=!0,t.outStoreLoading=!1,t.outStoreListStart+=k,t.outStoreLoadFinished=e.shops.length<k,t.outStoreList=e.shops})},onOutStoreLoad:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getOutStoreListData(e).then(function(e){var i;t.outStoreLoading=!1,t.outStoreListStart+=k,e.shops.length<k&&(t.outStoreLoadFinished=!0),(i=t.outStoreList).push.apply(i,Object(l["a"])(e.shops))})},getOutStoreListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new f.a(function(i){var o={m:"getOutHouseListForInsideMove",orgId:t.orderInfoData.shopDTO.id,houseId:t.orderInfoData.inHouseDTO.id,start:t.outStoreListStart,size:k,paged:!0,keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.orderInfoData.shopDTO.id,"/users/").concat(t.loginerId,"/houses"),data:o}).then(function(t){i(t)})})},onOutStoreClear:function(){var t=this;this.clearItemConfim("更换出库仓库会清空品项,是否继续?").then(function(){t.orderInfoData.outHouseDTO={},t.orderInfoData.insideMoveType="",t.orderInfoData.houseManageDTO={},t.HouseManageDisabled=!0})},onUnitEdit:function(t){var e=this;this.itemEditRowData=t,this.getItemUnit(t.goodsDTO.id).then(function(t){e.unitActions=t,e.unitActionShow=!0})},getItemUnit:function(t){var e=this;return new f.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/shopId/users/userId/goods/").concat(t,"/units"),query:{userId:e.loginerId}}).then(function(t){i(t.units)})})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemEditRowData,i=e.unitDTO.value,o=t,n=i/o.value,s=d()(this.$fxUtils.toFixedSHW(e.busUnitInAmount*n,this.sysPointSize));e.unitDTO=o,e.busUnitInAmount=s,0===e.busUnitInAmount?(e.price=d()(this.$fxUtils.toFixedSHW(e.price*o.value/i,this.sysPointSize)),e.taxPrice=d()(this.$fxUtils.toFixedSHW(e.taxPrice*o.value/i,this.sysPointSize))):(e.price=d()(this.$fxUtils.toFixedSHW(e.inMoney/e.busUnitInAmount,this.sysPointSize)),e.taxPrice=d()(this.$fxUtils.toFixedSHW(e.inMoneyWithTax/e.busUnitInAmount,this.sysPointSize))),e.id&&(e.changeType="edit")},onAddClick:function(){var t=this;this.checkOrderInfo().then(function(){t.itemPopShow=!0})},checkOrderInfo:function(){var t=this;return new f.a(function(e,i){for(var o=[[t.orderInfoData.shopDTO.id,"机构"],[t.orderInfoData.inHouseDTO.id,"入库仓库"],[t.orderInfoData.outHouseDTO.id,"出库仓库"]],n=!0,s=0;s<o.length;s++)if(!o[s][0]){t.$toast.fail("请选择".concat(o[s][1],"!")),n=!1;break}n&&e()})},onItemEditConfirm:function(t){this.orderItemList=t},onSaveClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要保存该单据吗?"}).then(function(){t.checkHasDetails().then(function(){var e=t.getSaveParams();t.saveHandler(e)})}).catch(function(){})},saveHandler:function(t){var e=this;this.$fxHttp.requestPut({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/insideMoveBill/users/").concat(this.loginerId,"/").concat(this.orderInfoData.inHouseDTO.id,"/").concat(this.orderInfoData.outHouseDTO.id,"/").concat(this.query.orderId),data:t,query:{userId:this.loginerId,m:"modify"}}).then(function(t){e.createOrderDetails().then(function(){e.$fxToast.success("保存成功")})})},onExpressClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要审核该单据吗?"}).then(function(){t.checkHasDetails().then(function(){var e=t.getSaveParams();t.expressHandler(e)})}).catch(function(){})},expressHandler:function(t){var e=this;this.$fxHttp.requestPut({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/insideMoveBill/").concat(this.query.orderId),data:t,query:{userId:this.loginerId,m:"editAndCheck"}}).then(function(t){e.createOrderDetails().then(function(){e.$fxToast.success("审核成功")})}).catch(function(t){"1"===t.errorCode&&e.createOrderDetails()})},onUnExpressClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要反审该单据吗?"}).then(function(){t.checkHasDetails().then(function(){var e=t.getSaveParams();t.unExpressHandler(e)})}).catch(function(){})},unExpressHandler:function(t){var e=this;this.$fxHttp.requestPut({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/insideMoveBill/").concat(this.query.orderId),data:t,query:{userId:this.loginerId,m:"unCheck"}}).then(function(t){e.createOrderDetails().then(function(){e.$fxToast.success("反审成功")})})},onDeleteClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要删除该单据吗?"}).then(function(){var e=t.getSaveParams();t.$fxHttp.requestDel({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/insideMoveBill/").concat(t.query.orderId),data:e,query:{userId:t.loginerId}}).then(function(e){t.$fxToast.success("删除成功").then(function(){t.orderDeleteFlag=!0,t.$router.go(-1)})})}).catch(function(){})},onBillReStateClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要复审该单据吗?"}).then(function(){var e=t.getSaveParams();t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/insideMoveBill/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:e,query:{m:"reCheck"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("复审成功")})})}).catch(function(){})},onUnBillReStateClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要取消复审该单据吗?"}).then(function(){var e=t.getSaveParams();t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/insideMoveBill/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:e,query:{m:"unReCheck"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("取消复审成功")})})}).catch(function(){})},onWeightClick:function(){var t=this;this.checkHasDetails().then(function(){t.$dialog.confirm({title:"提示",message:"确定要下发称重吗?"}).then(function(){var e=t.getSaveParams();if(!e)return!1;t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/insideMoveBill/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:e,query:{userId:t.loginerId,m:"weighBill"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("下发称重成功")})})}).catch(function(){})})},onUnWeightClick:function(){var t=this;this.checkHasDetails().then(function(){var e="确定要取消称重吗?";2===t.orderInfoData.weighState&&(e="称重中的单据，取消称重后电子秤可以继续称重并传回数据！确定要取消称重吗"),t.$dialog.confirm({title:"提示",message:e}).then(function(){t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/insideMoveBill/").concat(t.query.orderId,"/users/").concat(t.loginerId),query:{userId:t.loginerId,m:"unWeighBill"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("取消称重成功")})})}).catch(function(){})})},onEndWeightClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"结束称重后将不再接收此单据的称重数据"}).then(function(){t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/insideMoveBill/").concat(t.query.orderId,"/users/").concat(t.loginerId),query:{userId:t.loginerId,m:"endWeighBill"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("结束称重成功")})})}).catch(function(){})},getSaveParams:function(){var t=this.orderItemList.filter(function(t){return"add"===t.changeType}),e=this.orderItemList.filter(function(t){return"del"===t.changeType}),i=this.orderItemList.filter(function(t){return"edit"===t.changeType}),o=c()({},this.orderInfoData,{detailAdd:t.length>0?t:null,detailDel:e.length>0?e:null,detailMdf:i.length>0?i:null,billBom:this.orderBomList,details:[]});return o},checkHasDetails:function(){var t=this;return new f.a(function(e){var i=t.orderItemList.filter(function(t){return"del"!==t.changeType});0===i.length?t.$fxToast.fail("单据明细不能为空"):e()})},onItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this.orderItemList.findIndex(function(e){return e.id===t.id});~e&&(this.orderItemList[e]=t)},onClickHandler:function(t){if(this.itemInputFocusing)return!1;this[t]()},onItemFocus:function(){this.$refs.orderInfo.closeCollapse()},onSearchClick:function(){this.itemSearchPopShow=!0,this.searchItem=JSON.parse(a()(this.orderItemList))},onSearchConfirm:function(t){this.orderItemList=t},onSelectBomClick:function(){var t=this;this.checkOrderInfo().then(function(){t.bomPopShow=!0})},onViewBomClick:function(){this.orderBomList.length?(this.searchBom=JSON.parse(a()(this.orderBomList)),this.bomSearchPopShow=!0):this.$fxToast.top("没有已导入的BOM数据！")},onBomConfirm:function(t){var e=this;this.bomPopShow=!1,this.getBomItem(t).then(function(t){var i=t.billBom[0].details;i.forEach(function(t){var i=e.orderItemList.findIndex(function(e){return e.goodsDTO.id===t.goodsDTO.id});if(~i){var o=e.orderItemList[i];if("del"===o.changeType)return t.changeType="add",void e.orderItemList.push(t);"add"!==o.changeType&&e.$set(o,"changeType","edit"),o.busUnitInAmount=t.busUnitInAmount,o.busUnitOutAmount=t.busUnitOutAmount}else t.changeType="add",e.orderItemList.push(t)}),e.orderBomList=t.billBom[0].billBom})},getBomItem:function(t){var e=this;return new f.a(function(i){t.forEach(function(t){t.bomId=t.id,t.bomName=t.name,delete t.checked});var o=e.orderItemList.filter(function(t){return"del"!==t.changeType}),n=e.orderBomList,s={houseId:e.orderInfoData.outHouseDTO.id,inHouseId:e.orderInfoData.inHouseDTO.id,outHouseId:e.orderInfoData.outHouseDTO.id,workDate:e.orderInfoData.businessDate,bom:t,details:o,billBom:n};e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.orderInfoData.shopDTO.id,"/users/").concat(e.loginerId,"/insideMoveBillDetails"),data:s,query:{m:"inSideMoveBillBom"}}).then(function(t){i(t)}).catch(function(t){i(t)})})}}},y=x,T=(i("e580"),i("2877")),L=Object(T["a"])(y,o,n,!1,null,"3affe7e2",null);e["default"]=L.exports},bdd2:function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-insideMoveBill-create"},[i("w-header",{attrs:{title:"新增内部调拨单",border:!0}}),i("orderInfo",{ref:"orderInfo",attrs:{data:t.orderInfoData,HouseManageDisabled:t.HouseManageDisabled,collapseDisabled:t.itemInputFocusing},on:{"on-busdate-click":t.onBusinessDateClick,"on-shop-click":t.onShopClick,"on-inStore-click":t.onInStoreClick,"on-outStore-click":t.onOutStoreClick,"on-houseManaged-click":t.onHouseManaged,"on-inStore-clear":t.onInStoreClear,"on-outStore-clear":t.onOutStoreClear}}),i("orderItem",{attrs:{data:t.orderItemList,itemInputFocusing:t.itemInputFocusing},on:{"update:itemInputFocusing":function(e){t.itemInputFocusing=e},"update:item-input-focusing":function(e){t.itemInputFocusing=e},"on-add-click":t.onAddClick,"on-search-click":t.onSearchClick,"on-unit-edit":t.onUnitEdit,"on-item-edit":t.onItemEdit,"on-item-focus":t.onItemFocus,"on-selectbom-click":t.onSelectBomClick,"on-viewbom-click":t.onViewBomClick}}),i("div",{staticClass:"insideMoveBill-bottom"},[i("van-button",{staticClass:"add-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onCreateClick}},[t._v("生成单据")])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right"},model:{value:t.shopPopShow,callback:function(e){t.shopPopShow=e},expression:"shopPopShow"}},[i("listComp",{attrs:{visibleFlag:t.shopPopShow,data:t.shopList,title:"机构检索",loading:t.shopLoading,loadFinished:t.shopLoadFinished,immediateCheck:!1},on:{"update:visibleFlag":function(e){t.shopPopShow=e},"update:visible-flag":function(e){t.shopPopShow=e},"update:loading":function(e){t.shopLoading=e},"on-select":t.selectShop,"on-search":t.searchShop,"on-load":t.onShopLoad}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right"},model:{value:t.inStorePopShow,callback:function(e){t.inStorePopShow=e},expression:"inStorePopShow"}},[i("listComp",{attrs:{visibleFlag:t.inStorePopShow,data:t.inStoreList,title:"入库仓库检索",loading:t.inStoreLoading,loadFinished:t.inStoreLoadFinished,immediateCheck:!1},on:{"update:visibleFlag":function(e){t.inStorePopShow=e},"update:visible-flag":function(e){t.inStorePopShow=e},"update:loading":function(e){t.inStoreLoading=e},"on-select":t.selectInStore,"on-search":t.searchInStore,"on-load":t.onInStoreLoad}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right"},model:{value:t.outStorePopShow,callback:function(e){t.outStorePopShow=e},expression:"outStorePopShow"}},[i("listComp",{attrs:{visibleFlag:t.outStorePopShow,data:t.outStoreList,title:"出库仓库检索",loading:t.outStoreLoading,loadFinished:t.outStoreLoadFinished,immediateCheck:!1},on:{"update:visibleFlag":function(e){t.outStorePopShow=e},"update:visible-flag":function(e){t.outStorePopShow=e},"update:loading":function(e){t.outStoreLoading=e},"on-select":t.selectOutStore,"on-search":t.searchOutStore,"on-load":t.onOutStoreLoad}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right"},model:{value:t.HouseManagedPopShow,callback:function(e){t.HouseManagedPopShow=e},expression:"HouseManagedPopShow"}},[i("listComp",{attrs:{searchShow:t.searchShow,visibleFlag:t.HouseManagedPopShow,data:t.HouseManagedList,title:"调拨类型",loading:t.HouseManagedLoading,loadFinished:t.HouseManagedLoadFinished,immediateCheck:!1},on:{"update:visibleFlag":function(e){t.HouseManagedPopShow=e},"update:visible-flag":function(e){t.HouseManagedPopShow=e},"update:loading":function(e){t.HouseManagedLoading=e},"on-select":t.houseManagedStore,"on-load":t.houseManagedLoad}})],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemPopShow,callback:function(e){t.itemPopShow=e},expression:"itemPopShow"}},[i("itemEditComp",{attrs:{visibleFlag:t.itemPopShow,inHouseId:t.orderInfoData.inHouseDTO&&t.orderInfoData.inHouseDTO.id,outHouseId:t.orderInfoData.outHouseDTO&&t.orderInfoData.outHouseDTO.id,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,parentStoreItem:t.orderItemList},on:{"update:visibleFlag":function(e){t.itemPopShow=e},"update:visible-flag":function(e){t.itemPopShow=e},"on-confirm":t.onItemEditConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemSearchPopShow,callback:function(e){t.itemSearchPopShow=e},expression:"itemSearchPopShow"}},[i("itemSearchPop",{attrs:{visibleFlag:t.itemSearchPopShow,data:t.searchItem,houseDTO:t.orderInfoData.inHouseDTO,outHouseId:t.orderInfoData.outHouseDTO&&t.orderInfoData.outHouseDTO.id,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,isDisabled:!t.$fxAuth("insideMoveBill.save")},on:{"update:visibleFlag":function(e){t.itemSearchPopShow=e},"update:visible-flag":function(e){t.itemSearchPopShow=e},"on-search-confirm":t.onSearchConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.bomPopShow,callback:function(e){t.bomPopShow=e},expression:"bomPopShow"}},[i("bomEditComp",{attrs:{visibleFlag:t.bomPopShow,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id},on:{"update:visibleFlag":function(e){t.bomPopShow=e},"update:visible-flag":function(e){t.bomPopShow=e},"on-bom-confirm":t.onBomConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.bomSearchPopShow,callback:function(e){t.bomSearchPopShow=e},expression:"bomSearchPopShow"}},[i("bomSearchPop",{attrs:{visibleFlag:t.bomSearchPopShow,data:t.searchBom,searchKeywords:"code,name,pinYin"},on:{"update:visibleFlag":function(e){t.bomSearchPopShow=e},"update:visible-flag":function(e){t.bomSearchPopShow=e}}})],1)],1)},n=[],s=(i("7f7f"),i("ac6a"),i("f499")),a=i.n(s),r=(i("20d6"),i("5176")),c=i.n(r),l=(i("a481"),i("59ad")),u=i.n(l),d=i("75fc"),h=i("795b"),f=i.n(h),m=i("cebc"),p=i("2f62"),v=i("e80d"),g=i("e5ff"),S=i("f6bb"),I=i("87f9"),b=i("1b71"),D=i("085e"),w=i("aafe"),C=i("1454"),k=50,x={name:"createInsideMoveBill",components:{orderInfo:v["a"],orderItem:g["a"],listComp:S["a"],itemEditComp:I["a"],itemRowEditPop:b["a"],itemSearchPop:D["a"],bomEditComp:w["a"],bomSearchPop:C["a"]},data:function(){return{query:this.$route.query,outHouseId:"",searchShow:!1,activeNames:["1"],tabActive:"选项1",HouseManagedStates:"",orderInfoData:{autoType:1,houseManageDTO:{},accountDTO:{},billEmp:"",billMemo:"",insideMoveType:"",billState:0,businessDate:(new Date).getTime(),inHouseDTO:{},shopDTO:{},manualCode:"",outHouseDTO:{},updateIndicator:"Append"},orderItemList:[],currentDate:new Date,datePickerShow:!1,itemPopShow:!1,shopPopShow:!1,shopList:[],shopListStart:0,shopLoading:!1,shopLoadFinished:!1,inStorePopShow:!1,HouseManagedStart:0,HouseManagedPopShow:!1,HouseManagedList:[],HouseManagedLoading:!1,HouseManagedLoadFinished:!1,HouseManageDisabled:!0,inStoreList:[],inStoreListStart:0,inStoreLoading:!1,inStoreLoadFinished:!1,outStorePopShow:!1,outStoreList:[],outStoreListStart:0,outStoreLoading:!1,outStoreLoadFinished:!1,itemEditRowData:{},unitActionShow:!1,unitActions:[],itemRowEditPopShow:!1,itemInputFocusing:!1,itemSearchPopShow:!1,searchItem:[],orderBomList:[],bomPopShow:!1,bomSearchPopShow:!1,searchBom:[],houseItem:{code:"",id:"",name:"",disabledFlag:!0,pinYin:null,updateIndicator:"Append"},houseManageDTO:[{code:"0",id:0,name:"调入",pinYin:null,updateIndicator:"Append",disabledFlag:!0},{code:"1",id:1,name:"调出",pinYin:null,updateIndicator:"Append",disabledFlag:!0}]}},computed:Object(m["a"])({},Object(p["c"])({sysPointSize:"sysPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerShopName:function(t){return t.loginer.loginerShopName},loginerOrganType:function(t){return t.loginer.loginerOrganType},loginerId:function(t){return t.loginer.loginerId}})),created:function(){this.$fxStateMiddleware.stateIs("loginerOrganType")(["shop","center"])(this.loginerOrganType)&&(this.orderInfoData.shopDTO={id:this.loginerShopId,name:this.loginerShopName})},beforeRouteLeave:function(t,e,i){var o=this;if(this.itemInputFocusing)return this.$router.go(1),!1;"/insideMoveBill"===t.path?this.$dialog.confirm({title:"提示",message:"若已修改,请先保存单据<br/>是否关闭页面?"}).then(function(){i()}).catch(function(){return o.$router.go(1),!1}):i()},methods:{onBusinessDateClick:function(){this.orderInfoData.businessDate&&(this.currentDate=new Date(this.orderInfoData.businessDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){var e=t.getTime();this.orderInfoData.businessDate=e,this.datePickerShow=!1},clearItemConfim:function(t){var e=this;return new f.a(function(i){var o=e.orderItemList.filter(function(t){return"del"!==t.changeType});0===o.length?i():e.$dialog.confirm({title:"提示",message:t}).then(function(){e.clearItemHandler(),i()}).catch(function(){})})},clearItemHandler:function(){this.orderItemList=[]},onShopClick:function(){this.onShopRefresh()},searchShop:function(t){this.onShopRefresh(t)},selectShop:function(t){var e=this;this.checkShop(t).then(function(){e.clearItemConfim("更换机构会清空品项,是否继续?").then(function(){e.orderInfoData.shopDTO=t,e.orderInfoData.inHouseDTO={},e.orderInfoData.outHouseDTO={}})})},checkShop:function(t){var e=this;return new f.a(function(i){var o=e.orderInfoData.shopDTO||{};o.id!==t.id&&i()})},onShopRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.shopListStart=0,this.getShopListData(e).then(function(e){t.shopPopShow=!0,t.shopLoading=!1,t.shopListStart+=k,t.shopLoadFinished=e.shops.length<k,t.shopList=e.shops})},onShopLoad:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getShopListData(e).then(function(e){var i;t.shopLoading=!1,t.shopListStart+=k,e.shops.length<k&&(t.shopLoadFinished=!0),(i=t.shopList).push.apply(i,Object(d["a"])(e.shops))})},getShopListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new f.a(function(i){var o={m:"getShopListForInsideMove",start:t.shopListStart,size:k,paged:!0,keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/shops"),data:o}).then(function(t){i(t)})})},onInStoreClick:function(){return this.orderInfoData.shopDTO.id?this.orderInfoData.outHouseDTO.id?void this.onInStoreRefresh():(this.$fxToast.top("请先选择出库仓库！"),!1):(this.$fxToast.top("请先选择机构！"),!1)},searchInStore:function(t){this.onInStoreRefresh(t)},selectInStore:function(t){var e=this;this.checkInStore(t).then(function(){e.clearItemConfim("更换入库仓库会清空品项,是否继续?").then(function(){e.orderInfoData.inHouseDTO=t,e.checkAllocateType("1")})})},checkInStore:function(t){var e=this;return new f.a(function(i){var o=e.orderInfoData.inHouseDTO;o.id!==t.id&&i()})},onInStoreRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.inStoreListStart=0,this.getInStoreListData(e).then(function(e){t.inStorePopShow=!0,t.inStoreLoading=!1,t.inStoreListStart+=k,t.inStoreLoadFinished=e.shops.length<k,t.inStoreList=e.shops})},onInStoreLoad:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getInStoreListData(e).then(function(e){var i;t.inStoreLoading=!1,t.inStoreListStart+=k,e.shops.length<k&&(t.inStoreLoadFinished=!0),(i=t.inStoreList).push.apply(i,Object(d["a"])(e.shops))})},getInStoreListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new f.a(function(i){var o={m:"getInHouseListForInsideMove",orgId:t.orderInfoData.shopDTO.id,houseId:t.orderInfoData.outHouseDTO.id,start:t.inStoreListStart,size:k,paged:!0,keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/houses"),data:o}).then(function(t){i(t)})})},onInStoreClear:function(){var t=this;this.clearItemConfim("更换入库仓库会清空品项,是否继续?").then(function(){t.orderInfoData.inHouseDTO={},t.orderInfoData.insideMoveType="",t.orderInfoData.houseManageDTO={},t.HouseManageDisabled=!0})},onOutStoreClick:function(){if(!this.orderInfoData.shopDTO.id)return this.$fxToast.top("请先选择机构！"),!1;this.onOutStoreRefresh()},searchOutStore:function(t){this.onOutStoreRefresh(t)},selectOutStore:function(t){var e=this;this.checkOutStore(t).then(function(){e.clearItemConfim("更换出库仓库会清空品项,是否继续?").then(function(){e.orderInfoData.outHouseDTO=t,e.checkAllocateType("2")})})},checkHouseStore:function(t){var e=this;return new f.a(function(i){var o=e.orderInfoData.outHouseDTO;o.id!==t.id&&i()})},onHouseManaged:function(){console.log("123"),this.onHouseManagedRefresh()},onHouseManagedRefresh:function(){this.HouseManagedStart=0,this.HouseManagedPopShow=!0,this.HouseManagedLoading=!1,this.HouseManagedStart+=k,this.HouseManagedLoadFinished=this.houseManageDTO.length<k,this.HouseManagedList=this.houseManageDTO,console.log("onHouseManagedRefresh")},houseManagedStore:function(t){this.orderInfoData.insideMoveType=t.code,this.orderInfoData.houseManageDTO=t},houseManagedLoad:function(){console.log("111")},settingHouseManaged:function(t){"0"===t?this.orderInfoData.houseManageDTO="调入":"1"===t&&(this.orderInfoData.houseManageDTO="调出")},initAllocateType:function(){var t=this,e=this.orderInfoData.inHouseDTO.id,i=this.orderInfoData.outHouseDTO.id;e&&i&&this.getHouseManagedStatus(e,i).then(function(e){t.HouseManagedStates=e.shops[0].pinYin,t.orderInfoData.houseManageDTO=t.houseItem,"1"===t.HouseManagedStates||"0"===t.HouseManagedStates?t.HouseManageDisabled=!0:"2"===t.HouseManagedStates?t.HouseManageDisabled=!0:"3"===t.HouseManagedStates&&(t.HouseManageDisabled=!1)})},checkAllocateType:function(t){var e=this,i=this.orderInfoData.inHouseDTO.id,o=this.orderInfoData.outHouseDTO.id;i&&o&&this.getHouseManagedStatus(i,o).then(function(i){if(e.HouseManagedStates=i.shops[0].pinYin,e.orderInfoData.houseManageDTO=e.houseItem,"0"===e.HouseManagedStates)return e.$fxToast.top("调出仓库和调入仓库必须管辖其中之一！"),"1"===t?e.orderInfoData.inHouseDTO="":"2"===t&&(e.orderInfoData.outHouseDTO=""),!1;"1"===e.HouseManagedStates?(e.orderInfoData.houseManageDTO=e.houseManageDTO[0],e.orderInfoData.insideMoveType="0",e.HouseManageDisabled=!0):"2"===e.HouseManagedStates?(e.orderInfoData.houseManageDTO=e.houseManageDTO[1],e.orderInfoData.insideMoveType="1",e.HouseManageDisabled=!0):"3"===e.HouseManagedStates&&(e.orderInfoData.insideMoveType="0",e.orderInfoData.houseManageDTO=e.houseManageDTO[0],e.HouseManageDisabled=!1)})},getHouseManagedStatus:function(t,e){var i={m:"selHouseManagedStatus",houseIds:t+","+e};return this.$fxApi("insideMoveBill.getHouseManagedStatus")({data:i})},checkOutStore:function(t){var e=this;return new f.a(function(i){var o=e.orderInfoData.outHouseDTO;o.id!==t.id&&i()})},onOutStoreRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.outStoreListStart=0,this.getOutStoreListData(e).then(function(e){t.outStorePopShow=!0,t.outStoreLoading=!1,t.outStoreListStart+=k,t.outStoreLoadFinished=e.shops.length<k,t.outStoreList=e.shops})},onOutStoreLoad:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getOutStoreListData(e).then(function(e){var i;t.outStoreLoading=!1,t.outStoreListStart+=k,e.shops.length<k&&(t.outStoreLoadFinished=!0),(i=t.outStoreList).push.apply(i,Object(d["a"])(e.shops))})},getOutStoreListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new f.a(function(i){var o={m:"getOutHouseListForInsideMove",orgId:t.orderInfoData.shopDTO.id,houseId:t.orderInfoData.inHouseDTO.id,start:t.outStoreListStart,size:k,paged:!0,keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.orderInfoData.shopDTO.id,"/users/").concat(t.loginerId,"/houses"),data:o}).then(function(t){i(t)})})},onOutStoreClear:function(){var t=this;this.clearItemConfim("更换出库仓库会清空品项,是否继续?").then(function(){t.orderInfoData.outHouseDTO={},t.orderInfoData.insideMoveType="",t.orderInfoData.houseManageDTO={},t.HouseManageDisabled=!0})},onUnitEdit:function(t){var e=this;this.itemEditRowData=t,this.getItemUnit(t.goodsDTO.id).then(function(t){e.unitActions=t,e.unitActionShow=!0})},getItemUnit:function(t){var e=this;return new f.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/shopId/users/userId/goods/").concat(t,"/units"),query:{userId:e.loginerId}}).then(function(t){i(t.units)})})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemEditRowData,i=e.unitDTO,o=i.value/t.value,n=u()(this.$fxUtils.toFixedSHW(e.busUnitInAmount*o,this.sysPointSize));e.unitDTO=t,e.busUnitInAmount=n},onAddClick:function(){var t=this;this.checkOrderInfo().then(function(){t.itemPopShow=!0})},checkOrderInfo:function(){var t=this;return new f.a(function(e,i){for(var o=[[t.orderInfoData.businessDate,"业务日期"],[t.orderInfoData.shopDTO.id,"机构"],[t.orderInfoData.inHouseDTO.id,"入库仓库"],[t.orderInfoData.outHouseDTO.id,"出库仓库"]],n=!0,s=0;s<o.length;s++)if(!o[s][0]){t.$fxToast.top("请选择".concat(o[s][1],"！")),n=!1;break}n&&e()})},onItemEditConfirm:function(t){this.orderItemList=t},onCreateClick:function(){var t=this;if(this.itemInputFocusing)return!1;this.$dialog.confirm({title:"提示",message:"确定生成单据吗?"}).then(function(){t.checkHasDetails().then(function(){var e=t.getSaveParams();t.createHandler(e)})}).catch(function(){})},createHandler:function(t){var e=this;this.$fxHttp.requestPost({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/insideMoveBill/").concat(this.orderInfoData.inHouseDTO.id,"/").concat(this.orderInfoData.outHouseDTO.id),data:t}).then(function(t){e.$fxToast.success("生成单据成功").then(function(){e.$router.replace({path:"insideMoveBillDetails",query:{orderId:t.storeBills[0].id}})})})},getSaveParams:function(){var t=this.orderItemList.filter(function(t){return"add"===t.changeType}),e=c()(this.orderInfoData,{detailAdd:t,accountDTO:{id:this.loginerId}});return e},checkHasDetails:function(){var t=this;return new f.a(function(e){var i=t.orderItemList.filter(function(t){return"del"!==t.changeType});0===i.length?t.onAddClick():e()})},onItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this.orderItemList.findIndex(function(e){return e.id===t.id});~e&&(this.orderItemList[e]=t)},onItemFocus:function(){this.$refs.orderInfo.closeCollapse()},onSearchClick:function(){this.itemSearchPopShow=!0,this.searchItem=JSON.parse(a()(this.orderItemList))},onSearchConfirm:function(t){this.orderItemList=t},onSelectBomClick:function(){var t=this;this.checkOrderInfo().then(function(){t.bomPopShow=!0})},onViewBomClick:function(){this.orderBomList.length?(this.searchBom=JSON.parse(a()(this.orderBomList)),this.bomSearchPopShow=!0):this.$fxToast.top("没有已导入的BOM数据！")},onBomConfirm:function(t){var e=this;this.bomPopShow=!1,this.getBomItem(t).then(function(t){var i=t.billBom[0].details;i.forEach(function(t){var i=e.orderItemList.findIndex(function(e){return e.goodsDTO.id===t.goodsDTO.id});if(~i){var o=e.orderItemList[i];if("del"===o.changeType)return t.changeType="add",void e.orderItemList.push(t);"add"!==o.changeType&&e.$set(o,"changeType","edit"),o.busUnitInAmount=t.busUnitInAmount,o.busUnitOutAmount=t.busUnitOutAmount}else t.changeType="add",e.orderItemList.push(t)}),e.orderBomList=t.billBom[0].billBom})},getBomItem:function(t){var e=this;return new f.a(function(i){t.forEach(function(t){t.bomId=t.id,t.bomName=t.name,delete t.checked});var o=e.orderItemList.filter(function(t){return"del"!==t.changeType}),n=e.orderBomList,s={houseId:e.orderInfoData.outHouseDTO.id,inHouseId:e.orderInfoData.inHouseDTO.id,outHouseId:e.orderInfoData.outHouseDTO.id,workDate:e.orderInfoData.businessDate,bom:t,details:o,billBom:n};e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.orderInfoData.shopDTO.id,"/users/").concat(e.loginerId,"/insideMoveBillDetails"),data:s,query:{m:"inSideMoveBillBom"}}).then(function(t){i(t)}).catch(function(t){i(t)})})}}},y=x,T=(i("56be"),i("2877")),L=Object(T["a"])(y,o,n,!1,null,"4acad514",null);e["default"]=L.exports},bf73:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-info-cell"},[i("div",{staticClass:"item-img"},[i("img",{attrs:{src:t.comptedItemImgSrc(t.itemData.goodsDTO.imageUrls),onerror:t.$fxCommon.errorImg("item")}})]),i("div",{staticClass:"item-details"},[i("div",{staticClass:"item-name fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.name))]),i("div",{staticClass:"details-cell"},[i("div",{staticClass:"item-taxprice fx-ellipsis"},[i("span",[t._v("非税金额：￥")]),i("span",[t._v(t._s(t.itemData.inMoney))])]),i("div",{staticClass:"item-spec fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.spec))])]),i("div",{staticClass:"details-cell"},[t.isDisabled||t.itemData.isWeightSign&&!t.sysDZCCanModifyAcount||!t.$fxAuth("insideMoveBill.editAmount")?i("div",{staticClass:"item-amount"},[i("span",{staticClass:"item-amount-text"},[t._v(t._s(t.itemData.busUnitInAmount))]),i("span",{staticClass:"fx-ellipsis"},[t._v(t._s(t.itemData.unitDTO.name))])]):i("div",{staticClass:"item-amount-edit"},[i("w-stepper",{ref:"amountInput",staticClass:"amount-step",attrs:{min:"0",max:t.maxAmount,stepperBtnShow:!1,intLength:t.numberLength,pointSize:t.sysPointSize,inputWidth:"28vw"},on:{change:t.onChange,focus:t.onFocus,blur:t.onBlur},model:{value:t.itemData.busUnitInAmount,callback:function(e){t.$set(t.itemData,"busUnitInAmount",e)},expression:"itemData.busUnitInAmount"}}),i("div",{staticClass:"unit-text"},[i("span",{staticClass:"cell-unit fx-ellipsis",on:{click:function(e){return e.stopPropagation(),t.onUnitClick(e)}}},[t._v(t._s(t.itemData.unitDTO.name))]),i("van-icon",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("insideMoveBill.modifyUnit")&&!t.autoType8,expression:"$fxAuth('insideMoveBill.modifyUnit') && !autoType8"}],staticClass:"unit-icon",attrs:{name:"arrow-down"}})],1)],1)])]),i("i",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&!t.disabledEditBtn,expression:"!isDisabled && !disabledEditBtn"}],staticClass:"block-item-edit",on:{click:t.onItemEditClick}}),i("i",{directives:[{name:"show",rawName:"v-show",value:t.isDisabled,expression:"isDisabled"}],staticClass:"block-item-watch",on:{click:t.onItemEditClick}})])},n=[],s=i("795b"),a=i.n(s),r=i("59ad"),c=i.n(r),l=i("cebc"),u=i("2f62"),d={name:"itemInfoCell",props:{itemData:{type:Object,default:function(){return{}}},autoType8:Boolean,isDisabled:Boolean,disabledEditBtn:Boolean},computed:Object(l["a"])({},Object(u["c"])({sysDZCCanModifyAcount:function(t){return t.systemParams.sysDZCCanModifyAcount},sysPointSize:"sysPointSize",numberLength:"numberLength",maxAmount:"maxAmount"}),{comptedItemImgSrc:function(t){return function(t){return t?0===t.length?"":t[0]:""}}}),methods:{editItem:function(){this.itemData.id&&this.$set(this.itemData,"changeType","edit")},onItemEditClick:function(){this.editItem(),this.$emit("on-item-edit",this.itemData)},onChange:function(t){if("del"===this.itemData.changeType)return!1;this.editItem(),this.onAmountChange(t)},onAmountChange:function(t){this.editItem();var e=this.itemData,i=e.inMoneyWithTax,o=e.taxPrice,n=e.inMoney,s=e.taxInMoney,a=e.price,r=e.tax;i=c()(this.$fxUtils.toFixedSHW(o*t,this.sysPointSize)),n=c()(this.$fxUtils.toFixedSHW(a*t,this.sysPointSize)),s=c()(this.$fxUtils.toFixedSHW(n*r,this.sysPointSize)),this.itemData.inMoneyWithTax=i,this.itemData.inMoney=n,this.itemData.taxInMoney=s},onUnitClick:function(){var t=this;if(this.isDisabled||!this.$fxAuth("insideMoveBill.modifyUnit")||this.autoType8)return!1;this.onCheckAmount(!1).then(function(){t.editItem(),t.$emit("on-unit-edit",t.itemData)})},onFocus:function(){this.$emit("on-item-focus")},onBlur:function(){var t=this;this.onCheckAmount().then(function(){t.$emit("on-item-blur")}).catch(function(){t.$refs.amountInput.setFocus(),t.$emit("on-item-focus")})},onCheckAmount:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new a.a(function(i,o){var n=t.itemData.busUnitInAmount,s="数量不符合规则";0===n?t.$nextTick(function(){e&&t.$fxNotify.fail("数量不能为0!"),o(s)}):i()})}}},h=d,f=(i("4c8b"),i("2877")),m=Object(f["a"])(h,o,n,!1,null,"0f825c1a",null);e["a"]=m.exports},cfc1:function(t,e,i){"use strict";var o=i("7d80"),n=i.n(o);n.a},d21a:function(t,e,i){},da62:function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-insideMoveBill"},[i("w-header",{attrs:{title:"内部调拨单",border:!0}},[i("headEditBtn",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("insideMoveBill.check"),expression:"$fxAuth('insideMoveBill.check')"}],attrs:{slot:"header-right",active:t.orderEditFlag},on:{click:t.onOrderEditClick},slot:"header-right"}),i("headSearchBtn",{directives:[{name:"show",rawName:"v-show",value:!t.orderEditFlag,expression:"!orderEditFlag"}],attrs:{slot:"header-right"},on:{click:t.onSearchClick},slot:"header-right"}),i("headSelectAllBtn",{directives:[{name:"show",rawName:"v-show",value:t.orderEditFlag,expression:"orderEditFlag"}],attrs:{slot:"header-right",active:t.isSelectAll},on:{click:t.onSelectAllClick},slot:"header-right"})],1),i("filterTab",{attrs:{state:t.computedState,reCheckState:t.computedReCheckState},on:{"on-state-click":t.onStateClick,"on-reCheckState-click":t.onReCheckStateClick}}),i("div",{staticClass:"insideMoveBill-content"},[i("van-pull-refresh",{directives:[{name:"show",rawName:"v-show",value:0!==t.orderList.length,expression:"orderList.length !== 0"}],staticClass:"insideMoveBill-list",on:{refresh:t.onPullRefresh},model:{value:t.pullRefreshLoading,callback:function(e){t.pullRefreshLoading=e},expression:"pullRefreshLoading"}},[i("van-list",{attrs:{finished:t.loadFinished,"finished-text":"没有更多了",error:t.listError,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.listError=e},load:t.onLoadMore},model:{value:t.listLoading,callback:function(e){t.listLoading=e},expression:"listLoading"}},t._l(t.orderList,function(e){return i("orderBlock",{directives:[{name:"show",rawName:"v-show",value:t.computedShowOrder(e.billState),expression:"computedShowOrder(item.billState)"}],key:e.id,attrs:{data:e,showCheckBox:t.orderEditFlag},on:{"on-click":function(i){return t.onClickOrder(e)}}})}),1)],1),i("emptyBill",{directives:[{name:"show",rawName:"v-show",value:0===t.orderList.length,expression:"orderList.length === 0"}]})],1),i("div",{staticClass:"insideMoveBill-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.orderEditFlag&&t.$fxAuth("insideMoveBill.add"),expression:"!orderEditFlag && $fxAuth('insideMoveBill.add')"}],staticClass:"add-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onCreateClick}},[t._v("添加单据")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.orderEditFlag&&t.$fxAuth("insideMoveBill.check"),expression:"orderEditFlag && $fxAuth('insideMoveBill.check')"}],staticClass:"add-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onExpressClick}},[t._v("批量审核")])],1),i("van-actionsheet",{attrs:{actions:t.stateActions,"cancel-text":"取消"},on:{select:t.onStateSelect},model:{value:t.stateActionShow,callback:function(e){t.stateActionShow=e},expression:"stateActionShow"}}),i("van-actionsheet",{attrs:{actions:t.reCheckStateActions,"cancel-text":"取消"},on:{select:t.onReCheckStateSelect},model:{value:t.reCheckStateActionShow,callback:function(e){t.reCheckStateActionShow=e},expression:"reCheckStateActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.filterPopShow,callback:function(e){t.filterPopShow=e},expression:"filterPopShow"}},[i("filterPop",{attrs:{visibleFlag:t.filterPopShow,filterParams:t.filterParams},on:{"update:visibleFlag":function(e){t.filterPopShow=e},"update:visible-flag":function(e){t.filterPopShow=e},"update:filterParams":function(e){t.filterParams=e},"update:filter-params":function(e){t.filterParams=e},"on-confirm":t.onFilterConfirm}})],1)],1)},n=[],s=(i("ac6a"),i("75fc")),a=i("5176"),r=i.n(a),c=i("795b"),l=i.n(c),u=(i("7514"),i("7f7f"),i("cebc")),d=(i("6762"),i("2f62")),h=i("b215"),f=i("46aa"),m=i("a0be"),p=i("4102"),v=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-block fx-shadow-block",on:{click:t.onClick}},[i("checkBox",{staticClass:"order-checkbox",attrs:{visibleFlag:t.showCheckBox,checked:t.data.checked},on:{"on-checkbox-click":t.onClick}}),i("div",{staticClass:"block-content"},[i("div",{staticClass:"block-title"},[i("i",{staticClass:"block-icon"}),i("span",{staticClass:"title-text fx-ellipsis"},[t._v(t._s(t.data.shopDTO.name))]),i("stateTag",{staticClass:"state-tag",attrs:{billState:t.data.billState,reCheckState:t.data.billReState}})],1),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No"}),i("div",{staticClass:"order-date fx-price-font"},[i("span",[t._v("金额：")]),i("span",[t._v("￥"+t._s(t.toFixedNumberSize(t.data.sumOutMoney)))])])]),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No"},[i("span",[t._v("明细数：")]),i("span",[t._v(t._s(t.data.detailCount))])]),i("div",{staticClass:"order-date"},[i("span",[t._v("业务日期：")]),i("span",[t._v(t._s(t._f("filterDateYMD")(t.data.businessDate)))]),i("van-icon",{staticClass:"order-date-arrow",attrs:{name:"arrow"}})],1)])])],1)},g=[],S=i("59ad"),I=i.n(S),b=i("0f38"),D=i("0b26"),w={name:"orderBlock",components:{checkBox:b["a"],stateTag:D["a"]},props:{data:{type:Object,default:function(){return{}}},showCheckBox:{type:Boolean,default:!1}},computed:Object(u["a"])({},Object(d["c"])({sysMoneyPointSize:"sysMoneyPointSize"}),{toFixedNumberSize:function(t){var e=this;return function(t){return I()(e.$fxUtils.toFixedSHW(t,e.sysMoneyPointSize))}}}),methods:{onClick:function(){this.showCheckBox?this.$set(this.data,"checked",!this.data.checked):this.$emit("on-click",this.data)}}},C=w,k=(i("9ae0"),i("2877")),x=Object(k["a"])(C,v,g,!1,null,"0bfb61e1",null),y=x.exports,T=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"filter-popup"},[i("w-header",{attrs:{title:"筛选条件",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{ref:"filterContent",staticClass:"filter-content"},[i("van-cell-group",[i("van-cell",{attrs:{title:"业务日期"}}),i("van-cell",{attrs:{title:"起始时间",value:t.beginDate,"is-link":""},on:{click:t.onBeginDateClick}}),i("van-cell",{attrs:{title:"结束时间",value:t.endDate,"is-link":""},on:{click:t.endDateClick}}),i("van-cell",{attrs:{title:"机构",value:t.shop,"value-class":"info-item-value","is-link":""},on:{click:t.onShopClick}}),i("van-cell",{attrs:{title:"出库仓库",value:t.outHouse,"value-class":"info-item-value","is-link":""},on:{click:t.onOutHouseClick}}),i("van-cell",{attrs:{title:"入库仓库",value:t.store,"value-class":"info-item-value","is-link":""},on:{click:t.onStoreClick}}),i("van-cell",{attrs:{title:"品项",value:t.item,"value-class":"info-item-value","is-link":""},on:{click:t.onItemClick}}),i("van-field",{ref:"billNo",attrs:{label:"系统单号","value-class":"info-item-value",placeholder:"请输入系统单号","input-align":"right"},model:{value:t.billNo,callback:function(e){t.billNo=e},expression:"billNo"}})],1)],1),i("div",{staticClass:"filter-bottom"},[i("van-button",{staticClass:"reset-btn fx-no-radius",attrs:{type:"info"},on:{click:t.onResetClick}},[t._v("重置")]),i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onConfirmClick}},[t._v("确定")])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.outHousePopShow,callback:function(e){t.outHousePopShow=e},expression:"outHousePopShow"}},[i("listComp",{attrs:{visibleFlag:t.outHousePopShow,data:t.outHouseList,loadFinished:!0,title:"调出仓库检索"},on:{"update:visibleFlag":function(e){t.outHousePopShow=e},"update:visible-flag":function(e){t.outHousePopShow=e},"on-search":t.searchOutHouse,"on-select":t.selectOutHouse}})],1),i("filterListPopup",{attrs:{title:"机构检索",rollingLoad:!0,getDataApi:t.getShopListData},on:{"on-select":function(e){return t.selectShop(arguments)}},model:{value:t.shopPopShow,callback:function(e){t.shopPopShow=e},expression:"shopPopShow"}}),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.storePopShow,callback:function(e){t.storePopShow=e},expression:"storePopShow"}},[i("listComp",{attrs:{visibleFlag:t.storePopShow,data:t.storeList,loadFinished:!0,title:"入库仓库检索"},on:{"update:visibleFlag":function(e){t.storePopShow=e},"update:visible-flag":function(e){t.storePopShow=e},"on-search":t.searchStore,"on-select":t.selectStore}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.itemPopShow,callback:function(e){t.itemPopShow=e},expression:"itemPopShow"}},[i("listComp",{attrs:{visibleFlag:t.itemPopShow,data:t.itemList,loadFinished:t.itemListLoadFinished,loading:t.onItemLoading,title:"品项检索"},on:{"update:visibleFlag":function(e){t.itemPopShow=e},"update:visible-flag":function(e){t.itemPopShow=e},"update:loading":function(e){t.onItemLoading=e},"on-search":t.searchItem,"on-select":t.selectItem,"on-load":t.onItemLoad}})],1)],1)},L=[],A=i("768b"),O=i("f6bb"),H=i("eb03"),B=50,P={name:"filterPop",components:{listComp:O["a"],filterListPopup:H["a"]},props:{visibleFlag:Boolean,filterParams:{type:Object,default:function(){return{}}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},dateType:"",currentDate:new Date,beginDate:this.$fxCommon.orderFilterStartDate(),endDate:this.$fxCommon.orderFilterEndDate(),shop:"请选择",shopId:"",outHouse:"请选择",outHouseId:"",store:"请选择",storeId:"",item:"请选择",itemId:"",billNo:"",datePickerShow:!1,outHousePopShow:!1,storePopShow:!1,itemPopShow:!1,outHouseList:[],shopPopShow:!1,storeList:[],itemList:[],itemListStart:0,onItemLoading:!1,itemListLoadFinished:!1}},watch:{visibleFlag:{handler:function(t){t&&this.$fxUtils.isEmptyObjSHW(this.filterParams)&&this.resetHandler()},immediate:!0}},computed:Object(u["a"])({},Object(d["c"])({loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}})),methods:{getFilterParams:function(){return{beginDate:this.beginDate||this.$fxCommon.orderFilterStartDate(),endDate:this.endDate||this.$fxCommon.orderFilterEndDate(),outHouseId:this.outHouseId,shopId:this.shopId,storeId:this.storeId,itemId:this.itemId,billNo:this.billNo}},onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onConfirmClick:function(){this.$emit("update:visibleFlag",!1),this.$emit("update:filterParams",this.getFilterParams()),this.$emit("on-confirm",this.getFilterParams())},onResetClick:function(){this.resetHandler()},resetHandler:function(){this.beginDate=this.$fxCommon.orderFilterStartDate(),this.endDate=this.$fxCommon.orderFilterEndDate(),this.outHouse="请选择",this.outHouseId="",this.shop="请选择",this.shopId="",this.store="请选择",this.storeId="",this.item="请选择",this.itemId="",this.billNo=""},onBeginDateClick:function(){this.dateType="begin",this.beginDate&&(this.currentDate=new Date(this.beginDate)),this.datePickerShow=!0},endDateClick:function(){this.dateType="end",this.endDate&&(this.currentDate=new Date(this.endDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){"begin"===this.dateType?(this.beginDate=this.$fxUtils.setDateTime(t,"时分"),this.endDate&&this.$fxCommon.orderFilterRangeDate(this.beginDate,this.endDate)||(this.endDate=this.$fxCommon.orderFilterDate(t))):(this.endDate=this.$fxUtils.setDateTime(t,"时分"),this.beginDate&&this.$fxCommon.orderFilterRangeDate(this.beginDate,this.endDate)||(this.beginDate=this.$fxCommon.orderFilterStartDate(t))),this.datePickerShow=!1},onShopClick:function(){this.shopPopShow=!0},selectShop:function(t){var e=Object(A["a"])(t,1),i=e[0];this.shop=i.name,this.shopId=i.id,this.outHouse="请选择",this.outHouseId="",this.store="请选择",this.storeId=""},getShopListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,o={keyword:t,start:e,size:i};return this.$fxApi("z5common.getUserManageShop")({data:o}).then(function(t){return t.shops})},onStoreClick:function(){if(!this.shopId)return this.$fxToast.fail("请先选择机构!"),!1;this.onStoreRefresh()},searchStore:function(t){this.onStoreRefresh(t)},selectStore:function(t){this.store=t.name,this.storeId=t.id},onStoreRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getStoreListData(e).then(function(e){t.storeList=e.shops,t.storePopShow=!0})},getStoreListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new l.a(function(i){var o={m:"getAllHouseList",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/houses"),data:o}).then(function(t){i(t)})})},onOutHouseClick:function(){if(!this.shopId)return this.$fxToast.fail("请先选择机构!"),!1;this.onOutHouseRefresh()},searchOutHouse:function(t){this.onOutHouseRefresh(t)},selectOutHouse:function(t){this.outHouse=t.name,this.outHouseId=t.id},onOutHouseRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getOutHouseListData(e).then(function(e){t.outHouseList=e.shops,t.outHousePopShow=!0})},getOutHouseListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new l.a(function(i){var o={m:"getAllHouseList",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/houses"),data:o}).then(function(t){i(t)})})},onItemClick:function(){this.onItemRefresh()},searchItem:function(t){this.onItemRefresh(t)},selectItem:function(t){this.item=t.name,this.itemId=t.id},onItemRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.itemListStart=0,this.getItemListData(e).then(function(e){t.itemPopShow=!0,t.onItemLoading=!1,t.itemListStart+=B,t.itemListLoadFinished=e.goods.length<B,t.itemList=e.goods})},onItemLoad:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getItemListData(e).then(function(e){var i;t.onItemLoading=!1,t.itemListStart+=B,e.goods.length<B&&(t.itemListLoadFinished=!0),(i=t.itemList).push.apply(i,Object(s["a"])(e.goods))})},getItemListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new l.a(function(i){var o={start:t.itemListStart,size:B,paged:!0,keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/goods"),data:o}).then(function(t){i(t)})})},onFocus:function(t){this.onScrollTop(t)},onScrollTop:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,i=this.$refs[t];if(!i||0===i.length)return!1;var o=i.$el.offsetTop,n=this.$refs["filterContent"];this.$fxUtils.scrollTopW({offsetTop:o,$el:n,distance:e})}}},$=P,M=(i("fe37"),Object(k["a"])($,T,L,!1,null,"01cc370a",null)),F=M.exports,E=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"shopOrder-filter fx-shadow-down"},[i("div",{staticClass:"filter-item",on:{click:t.onStateClick}},[i("span",[t._v("审核状态")]),i("van-icon",{staticClass:"filter-arrow",attrs:{name:"arrow-down"}}),i("span",[t._v(t._s(t.state))])],1),i("div",{staticClass:"filter-item",on:{click:t.onReCheckStateClick}},[i("span",[t._v("复审状态")]),i("van-icon",{staticClass:"filter-arrow",attrs:{name:"arrow-down"}}),i("span",[t._v(t._s(t.reCheckState))])],1)])},R=[],U={name:"filterTab",props:{state:String,reCheckState:String},methods:{onStateClick:function(){this.$emit("on-state-click")},onReCheckStateClick:function(){this.$emit("on-reCheckState-click")}}},_=U,N=(i("abf3"),Object(k["a"])(_,E,R,!1,null,"40b1870a",null)),W=N.exports,q=50,z={name:"insideMoveBill",components:{headSearchBtn:h["a"],headEditBtn:f["a"],headSelectAllBtn:m["a"],emptyBill:p["a"],orderBlock:y,filterPop:F,filterTab:W},data:function(){return{orderList:[],filterPopShow:!1,filterState:null,stateActionShow:!1,stateActions:[{id:null,name:"全部"},{id:"0",name:"未审核"},{id:"1",name:"已审核"}],filterReCheckState:null,reCheckStateActionShow:!1,reCheckStateActions:[{id:null,name:"全部"},{id:"0",name:"未复审"},{id:"1",name:"已复审"}],listStart:0,pullRefreshLoading:!1,listLoading:!1,loadFinished:!0,listError:!1,orderEditFlag:!1,filterParams:{}}},beforeRouteEnter:function(t,e,i){var o=["/main/home","/"],n=["/insideMoveBillDetails"];o.includes(e.path)?i(function(e){e.restFilterParams(),e.restRouterParams(t.params),e.refreshOrderList()}):n.includes(e.path)?i(function(t){t.refreshOrderList()}):i()},computed:Object(u["a"])({},Object(d["c"])({billListPostParams:"billListPostParams",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{computedState:function(){var t=this;return this.stateActions.find(function(e){return e.id===t.filterState}).name},computedReCheckState:function(){var t=this;return this.reCheckStateActions.find(function(e){return e.id===t.filterReCheckState}).name},computedShowOrder:function(t){var e=this;return function(t){return!e.orderEditFlag||1!==t}},isSelectAll:function(){var t=this.orderList.filter(function(t){return 1!==t.billState});if(0===t.length)return!1;var e=t.filter(function(t){return!!t.checked});return e.length===t.length}}),methods:{orderListPostHandler:function(t){var e=this;return new l.a(function(i){e.$store.commit({type:"SETSTATE",billListPostParams:t}),e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/insideMoveBill/users/").concat(e.loginerId),data:t}).then(function(t){i(t)})})},refreshOrderList:function(){var t=this;return new l.a(function(e){t.listStart=0;var i={start:t.listStart,size:q,paged:!0,businessDateStart:t.$fxCommon.orderFilterStartDate(),businessDateEnd:t.$fxCommon.orderFilterEndDate(),billState:t.filterState,reCheckState:t.filterReCheckState};i=r()(i,t.translateFilterParams(t.filterParams)),t.orderListPostHandler(i).then(function(i){t.orderList=i.storeBills,e(i)})})},onFilterConfirm:function(t){var e=this;this.listStart=0;var i={start:this.listStart,size:q,paged:!0,businessDateStart:t.beginDate,businessDateEnd:t.endDate,billState:this.filterState,reCheckState:this.filterReCheckState,outHouseId:""===t.outHouseId?null:t.outHouseId,shopId:""===t.shopId?null:t.shopId,inHouseId:""===t.storeId?null:t.storeId,goodsId:""===t.itemId?null:t.itemId,sysBillCode:""===t.billNo?null:t.billNo};this.orderListPostHandler(i).then(function(t){e.orderList=t.storeBills})},translateFilterParams:function(t){return this.$fxUtils.isEmptyObjSHW(t)?{}:{businessDateStart:t.beginDate,businessDateEnd:t.endDate,outHouseId:""===t.outHouseId?null:t.outHouseId,shopId:""===t.shopId?null:t.shopId,houseId:""===t.storeId?null:t.storeId,goodsId:""===t.itemId?null:t.itemId,sysBillCode:""===t.billNo?null:t.billNo}},onPullRefresh:function(){var t=this;this.refreshOrderList().then(function(e){t.pullRefreshLoading=!1})},onLoadMore:function(){var t=this,e=r()(this.billListPostParams,{start:this.listStart});this.orderListPostHandler(e).then(function(e){var i;(i=t.orderList).push.apply(i,Object(s["a"])(e.storeBills))})},onSearchClick:function(){this.filterPopShow=!0},onStateClick:function(){this.stateActionShow=!0},onStateSelect:function(t){this.filterState=t.id,this.stateActionShow=!1,this.refreshOrderList()},onReCheckStateClick:function(){this.reCheckStateActionShow=!0},onReCheckStateSelect:function(t){this.filterReCheckState=t.id,this.reCheckStateActionShow=!1,this.refreshOrderList()},onClickOrder:function(t){this.$router.push({path:"insideMoveBillDetails",query:{orderId:t.id}})},onCreateClick:function(){this.$router.push("createInsideMoveBill")},onOrderEditClick:function(){this.orderEditFlag=!this.orderEditFlag},onExpressClick:function(){var t=this,e=this.orderList.reduce(function(t,e){var i=e.checked?t.concat(e.id):t;return i},[]);if(0===e.length)return!1;this.$dialog.confirm({title:"提示",message:"确定要审核所选单据?"}).then(function(){t.expressHandler(e).then(function(e){t.orderEditFlag=!t.orderEditFlag,t.refreshOrderList().then(function(){t.$fxToast.success(e.message)})}).catch(function(){t.refreshOrderList()})})},expressHandler:function(t){var e=this;return new l.a(function(i,o){e.$fxHttp.requestPut({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/insideMoveBill/users/").concat(e.loginerId),data:t,query:{m:"batchCheck"}}).then(function(t){i(t)}).catch(function(t){o(t)})})},onSelectAllClick:function(){var t=this,e=!this.isSelectAll;this.orderList.forEach(function(i){1!==i.billState&&t.$set(i,"checked",e)})},restFilterParams:function(){this.filterParams={},this.filterState=null,this.filterReCheckState=null,this.orderEditFlag=!1},restRouterParams:function(t){this.$fxUtils.isEmptyObjSHW(t)||(this.filterState=t.billState,this.filterReCheckState=t.reCheckState?t.reCheckState:null)}}},K=z,j=(i("0002"),Object(k["a"])(K,o,n,!1,null,"c2d7c896",null));e["default"]=j.exports},e453:function(t,e,i){},e580:function(t,e,i){"use strict";var o=i("5d77"),n=i.n(o);n.a},e5ff:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-item-block fx-shadow-block"},[i("div",{staticClass:"item-title"},[i("span",{staticClass:"title-name"},[t._v("单据明细")]),i("span",{staticClass:"title-count"},[t._v("明细：")]),i("span",[t._v(t._s(t.detailsLength))]),i("i",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&t.$fxAuth("insideMoveBill.insideMoveBOM")&&!t.autoType8,expression:"!isDisabled && $fxAuth('insideMoveBill.insideMoveBOM') && !autoType8"}],staticClass:"title-selectbom-icon title-icon fl-r",on:{click:t.onSelectBomClick}}),i("i",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("insideMoveBill.insideMoveBOM")&&!t.autoType8,expression:"$fxAuth('insideMoveBill.insideMoveBOM') && !autoType8"}],staticClass:"title-viewbom-icon title-icon fl-r",on:{click:t.onViewBomClick}}),i("i",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&t.$fxAuth("insideMoveBill.editAmount")&&!t.autoType8,expression:"!isDisabled && $fxAuth('insideMoveBill.editAmount') && !autoType8"}],staticClass:"title-add-icon title-icon fl-r",on:{click:t.onAddClick}}),i("i",{staticClass:"title-search-icon title-icon fl-r",on:{click:t.onSearchClick}})]),i("div",{ref:"details-content",staticClass:"item-list"},t._l(t.data,function(e,o){return i("van-swipe-cell",{directives:[{name:"show",rawName:"v-show",value:"del"!==e.changeType,expression:"item.changeType !== 'del'"}],key:e.goodsDTO.id,ref:"details-row-"+e.goodsDTO.id,refInFor:!0,staticClass:"item-row",attrs:{"right-width":80,disabled:t.isDisabled||t.focusing}},[i("itemInfoCell",t._g({attrs:{itemData:e,isDisabled:t.isDisabled,disabledEditBtn:t.focusing,autoType8:t.autoType8},on:{"on-item-focus":function(i){return t.onItemFocus(arguments,""+e.goodsDTO.id)},"on-item-blur":t.onItemBlur}},t.$listeners)),i("div",{staticClass:"item-row-delete",attrs:{slot:"right"},on:{click:function(i){return t.onDeleteClick(e,o,t.data)}},slot:"right"},[t._v("删除")])],1)}),1)])},n=[],s=i("bf73"),a={name:"orderItem",components:{itemInfoCell:s["a"]},props:{data:{type:Array,default:function(){return[]}},autoType8:Boolean,isDisabled:Boolean,itemInputFocusing:Boolean},data:function(){return{focusing:!1}},computed:{detailsLength:function(){return this.data.filter(function(t){return"del"!==t.changeType}).length}},watch:{focusing:function(t){this.$emit("update:itemInputFocusing",t)}},methods:{onAddClick:function(){if(this.isDisabled||this.focusing)return!1;this.$emit("on-add-click")},onSearchClick:function(){if(this.focusing)return!1;this.$emit("on-search-click")},onDeleteClick:function(t,e,i){t.id?(this.$set(t,"changeType","del"),this.$set(t,"busUnitAmount",0)):i.splice(e,1)},onItemFocus:function(t,e){this.focusing=!0},onItemBlur:function(){this.focusing=!1},onSelectBomClick:function(){if(this.isDisabled||this.focusing)return!1;this.$emit("on-selectbom-click")},onViewBomClick:function(){if(this.focusing)return!1;this.$emit("on-viewbom-click")}}},r=a,c=(i("b4ed"),i("2877")),l=Object(c["a"])(r,o,n,!1,null,"1ad9eae1",null);e["a"]=l.exports},e80d:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-info-block fx-shadow-block"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},[i("van-collapse-item",{attrs:{name:"1",disabled:t.collapseDisabled}},[i("div",{staticClass:"info-title",attrs:{slot:"title"},slot:"title"},[i("span",{staticClass:"info-title-name"},[t._v("单据信息")]),i("stateText",{staticClass:"stateTag fl-r",attrs:{billState:t.data.billState}}),i("span",{directives:[{name:"show",rawName:"v-show",value:1===t.data.weightState,expression:"data.weightState === 1"}],staticClass:"info-title-weightState"},[t._v("待称重")])],1),i("van-tabs",{attrs:{animated:""},model:{value:t.tabActive,callback:function(e){t.tabActive=e},expression:"tabActive"}},[i("van-tab",{attrs:{title:"表头"}},[i("van-cell",{staticClass:"info-item",attrs:{title:"机构","value-class":"info-item-value",value:t.data.shopDTO&&t.data.shopDTO.name,"is-link":!t.isDisabled},on:{click:function(e){return t.onEmitClick("on-shop-click")}}}),i("van-cell",{staticClass:"info-item",attrs:{title:"出库仓库","value-class":"info-item-value",value:t.data.outHouseDTO&&t.data.outHouseDTO.name},on:{click:function(e){return t.onEmitClick("on-outStore-click")}}},[i("van-icon",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"item-clear-btn",attrs:{slot:"right-icon",name:t.hasOutHouse?"close":"arrow"},on:{click:function(e){e.stopPropagation(),t.hasOutHouse?t.onEmitClick("on-outStore-clear"):t.onEmitClick("on-outStore-click")}},slot:"right-icon"})],1),i("van-cell",{staticClass:"info-item",attrs:{title:"入库仓库","value-class":"info-item-value",value:t.data.inHouseDTO&&t.data.inHouseDTO.name},on:{click:function(e){return t.onEmitClick("on-inStore-click")}}},[i("van-icon",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"item-clear-btn",attrs:{slot:"right-icon",name:t.hasInHouse?"close":"arrow"},on:{click:function(e){e.stopPropagation(),t.hasInHouse?t.onEmitClick("on-inStore-clear"):t.onEmitClick("on-inStore-click")}},slot:"right-icon"})],1),i("van-cell",{class:[t.HouseManageDisabled?"info-item-disabled info-item":"info-item"],attrs:{title:"调拨类型","value-class":"info-item-value",value:t.data.houseManageDTO&&t.data.houseManageDTO.name,"is-link":!t.isDisabled},on:{click:function(e){return t.onEmitClick("on-houseManaged-click")}}}),i("van-cell",{staticClass:"info-item",attrs:{title:"业务日期",value:t.formatterDate(t.data.businessDate),"is-link":!t.isDisabled},on:{click:t.onBusdateClick}}),i("van-pro-field",{staticClass:"info-item",attrs:{label:"手工单号",placeholder:t.isDisabled?"":"请输入手工单号",maxlength:"50","input-align":"right",disabled:t.isDisabled},model:{value:t.data.manualCode,callback:function(e){t.$set(t.data,"manualCode",e)},expression:"data.manualCode"}}),i("van-cell",{staticClass:"info-item",attrs:{title:"生成方式",value:t.formatterAutoType(t.data.autoType)}})],1),i("van-tab",{attrs:{title:"更多"}},[i("van-cell",{staticClass:"info-item",attrs:{title:"制单人",value:t.data.billEmp}}),i("van-cell",{staticClass:"info-item",attrs:{title:"制单日期",value:t.formatterDate(t.data.billDate)}}),i("van-cell",{staticClass:"info-item",attrs:{title:"审核人",value:t.data.checkEmp}}),i("van-cell",{staticClass:"info-item",attrs:{title:"审核日期",value:t.formatterDate(t.data.checkDate)}}),i("van-pro-field",{staticClass:"info-item",attrs:{label:"整单备注",placeholder:t.isDisabled?"":"请输入整单备注","input-align":"right",maxlength:"50",disabled:t.isDisabled},model:{value:t.data.billMemo,callback:function(e){t.$set(t.data,"billMemo",e)},expression:"data.billMemo"}})],1)],1)],1)],1)],1)},n=[],s=i("4760"),a={name:"orderInfo",components:{stateText:s["a"]},props:{data:{type:Object,default:function(){return{}}},HouseManageDisabled:{type:Boolean,default:!0},isDisabled:Boolean,collapseDisabled:Boolean},data:function(){return{disabledItem:"info-item-disabled",activeNames:["1"],tabActive:0}},computed:{formatterDate:function(t){var e=this;return function(t){return"number"===typeof t?e.$fxUtils.setDateTime(new Date(t),"时分"):""}},formatterAutoType:function(t){return function(t){return 1===t?"手动生成":0===t?"自动生成":8===t?"快速调拨":""}},hasOutHouse:function(){return this.data.outHouseDTO&&this.data.outHouseDTO.id},hasInHouse:function(){return this.data.inHouseDTO&&this.data.inHouseDTO.id}},methods:{onEmitClick:function(t){if(this.isDisabled)return!1;this.$emit(t)},onBusdateClick:function(){if(!this.$fxSysAuth("shopMoveApplyBill.editWorkDate")||this.isDisabled)return!1;this.$emit("on-busdate-click")},closeCollapse:function(){this.activeNames=[]}}},r=a,c=(i("9874"),i("2599"),i("2877")),l=Object(c["a"])(r,o,n,!1,null,"73304c2d",null);e["a"]=l.exports},e965:function(t,e,i){},ee8e:function(t,e,i){"use strict";var o=i("aa93"),n=i.n(o);n.a},fe37:function(t,e,i){"use strict";var o=i("3509"),n=i.n(o);n.a},fef9:function(t,e,i){}}]);
//# sourceMappingURL=insideMoveBill.0db3a313.js.map