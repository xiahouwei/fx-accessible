(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["checkBill"],{"0229":function(t,e,i){},"0606":function(t,e,i){},"066f":function(t,e,i){},"08c07":function(t,e,i){"use strict";var n=i("066f"),s=i.n(n);s.a},"08d9":function(t,e,i){},"09b8":function(t,e,i){},"0b26":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("van-tag",{staticClass:"state-class",attrs:{type:t.tagType,size:"large",plain:""}},[t._v(t._s(t.billStateText))])},s=[],a=(i("c5f6"),{name:"stateTag",props:{billState:Number,reCheckState:Number},computed:{billStateText:function(){var t="";switch(this.billState){case 0:t="未审核";break;case 1:t=1===this.reCheckState?"已复审":"已审核";break}return t},tagType:function(){var t="";switch(this.billState){case 0:t="danger";break;case 1:t="success";break}return t}}}),o=a,c=(i("eb87"),i("2877")),r=Object(c["a"])(o,n,s,!1,null,"935c03cc",null);e["a"]=r.exports},"0e42":function(t,e,i){"use strict";var n=i("8f3f"),s=i.n(n);s.a},1295:function(t,e,i){"use strict";var n=i("3148"),s=i.n(n);s.a},"251a":function(t,e,i){},3148:function(t,e,i){},"40b3":function(t,e,i){"use strict";var n=i("0606"),s=i.n(n);s.a},4102:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"order-empty"},[n("img",{staticClass:"empty-icon",attrs:{src:i("6ee7")}}),n("div",{staticClass:"empty-text"},[t._v(t._s(t.message))])])},s=[],a={name:"emptyBill",props:{message:{type:String,default:"暂无可查看的订单"}}},o=a,c=(i("faf1"),i("2877")),r=Object(c["a"])(o,n,s,!1,null,"3c6ad708",null);e["a"]=r.exports},4340:function(t,e,i){},4760:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("span",{staticClass:"stateTag"},[t._v(t._s(t.billStateText))])},s=[],a=(i("c5f6"),{name:"stateText",props:{billState:Number},computed:{billStateText:function(){var t="";switch(this.billState){case 0:t="未审核";break;case 1:t="已审核";break}return t}}}),o=a,c=i("2877"),r=Object(c["a"])(o,n,s,!1,null,null,null);e["a"]=r.exports},"4bf5":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-sendOrder"},[i("w-header",{attrs:{title:"盘点单",border:!0}},[i("i",{staticClass:"title-icon-search",attrs:{slot:"header-right"},on:{click:t.onSearchClick},slot:"header-right"})]),i("filterTab",{attrs:{state:t.computedState,reCheckState:t.computedReCheckState},on:{"on-state-click":t.onStateClick,"on-reCheckState-click":t.onReCheckStateClick}}),i("div",{staticClass:"sendOrder-content"},[i("van-pull-refresh",{directives:[{name:"show",rawName:"v-show",value:0!==t.orderList.length,expression:"orderList.length !== 0"}],staticClass:"sendOrder-list",on:{refresh:t.onPullRefresh},model:{value:t.pullRefreshLoading,callback:function(e){t.pullRefreshLoading=e},expression:"pullRefreshLoading"}},[i("van-list",{attrs:{finished:t.loadFinished,"finished-text":"没有更多了",error:t.listError,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.listError=e},load:t.onLoadMore},model:{value:t.listLoading,callback:function(e){t.listLoading=e},expression:"listLoading"}},t._l(t.orderList,function(e){return i("orderBlock",{key:e.id,attrs:{data:e},on:{"on-click":function(i){return t.onClickOrder(e)}}})}),1)],1),i("emptyBill",{directives:[{name:"show",rawName:"v-show",value:0===t.orderList.length,expression:"orderList.length === 0"}]})],1),i("div",{staticClass:"sendOrder-bottom"},[!t.orderEditFlag&&t.$fxAuth("shopCheckBill.add")?i("van-button",{staticClass:"add-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onCreateClick}},[t._v("添加单据")]):t._e()],1),i("van-actionsheet",{attrs:{actions:t.stateActions,"cancel-text":"取消"},on:{select:t.onStateSelect},model:{value:t.stateActionShow,callback:function(e){t.stateActionShow=e},expression:"stateActionShow"}}),i("van-actionsheet",{attrs:{actions:t.reCheckStateActions,"cancel-text":"取消"},on:{select:t.onReCheckStateSelect},model:{value:t.reCheckStateShow,callback:function(e){t.reCheckStateShow=e},expression:"reCheckStateShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.filterPopShow,callback:function(e){t.filterPopShow=e},expression:"filterPopShow"}},[i("filterPop",{attrs:{visibleFlag:t.filterPopShow,filterParams:t.filterParams},on:{"update:visibleFlag":function(e){t.filterPopShow=e},"update:visible-flag":function(e){t.filterPopShow=e},"update:filterParams":function(e){t.filterParams=e},"update:filter-params":function(e){t.filterParams=e},"on-confirm":t.onFilterConfirm}})],1)],1)},s=[],a=i("75fc"),o=i("5176"),c=i.n(o),r=i("795b"),l=i.n(r),h=(i("7514"),i("7f7f"),i("cebc")),u=(i("6762"),i("2f62")),d=i("4102"),f=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-block fx-shadow-block",style:t.orderBlockStyle,on:{click:t.onClick}},[i("div",{staticClass:"block-title"},[i("i",{staticClass:"block-icon"}),i("span",{staticClass:"title-text"},[t._v(t._s(t.data.shopDTO.name))]),i("stateTag",{staticClass:"state-tag",attrs:{billState:t.data.billState}}),i("span",{directives:[{name:"show",rawName:"v-show",value:t.data.reCheckState,expression:"data.reCheckState"}],staticClass:"reCheckState-span"},[t._v("已复审")])],1),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No"},[t._v(t._s(t.data.houseDTO.name))]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.data.billState,expression:"data.billState"}],staticClass:"order-date"},[i("span",[t._v("盈亏金额：")]),i("span",[t._v(t._s(-1*t.data.sumPLMoney))])])]),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No"},[i("span",[t._v("明细数：")]),i("span",[t._v(t._s(t.data.detailCount))])]),i("div",{staticClass:"order-date"},[i("span",[t._v("业务日期：")]),i("span",[t._v(t._s(t._f("filterDateYMD")(t.data.businessDate)))]),i("van-icon",{staticClass:"order-date-arrow",attrs:{name:"arrow"}})],1)])])},m=[],p=i("0b26"),v={name:"orderBlock",components:{stateTag:p["a"]},props:{data:{type:Object,default:function(){return{}}}},computed:{orderBlockStyle:function(){var t="15px";return{paddingLeft:t}}},methods:{onClick:function(){this.$emit("on-click",this.data)}}},g=v,b=(i("cc41"),i("2877")),C=Object(b["a"])(g,f,m,!1,null,"721be495",null),S=C.exports,k=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"filter-popup"},[i("w-header",{attrs:{title:"筛选条件",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{ref:"filterContent",staticClass:"filter-content"},[i("van-cell-group",[i("van-cell",{attrs:{title:"盘点日期"}}),i("van-cell",{attrs:{title:"起始时间",value:t.beginDate,"is-link":""},on:{click:t.onBeginDateClick}}),i("van-cell",{attrs:{title:"结束时间",value:t.endDate,"is-link":""},on:{click:t.endDateClick}}),i("van-cell",{attrs:{title:"盘点机构",value:t.shop,"value-class":"info-item-value","is-link":""},on:{click:t.onShopClick}}),i("van-cell",{attrs:{title:"盘点仓库",value:t.store,"value-class":"info-item-value","is-link":""},on:{click:t.onStoreClick}}),i("van-cell",{attrs:{title:"品项",value:t.item,"value-class":"info-item-value","is-link":""},on:{click:t.onItemClick}}),i("van-field",{ref:"billNo",attrs:{label:"系统单号","value-class":"info-item-value",placeholder:"请输入系统单号","input-align":"right"},on:{focus:function(e){return t.onFocus("billNo")}},model:{value:t.billNo,callback:function(e){t.billNo=e},expression:"billNo"}})],1)],1),i("div",{staticClass:"filter-bottom"},[i("van-button",{staticClass:"reset-btn fx-no-radius",attrs:{type:"info"},on:{click:t.onResetClick}},[t._v("重置")]),i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onConfirmClick}},[t._v("确定")])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("filterListPopup",{attrs:{title:"机构检索",rollingLoad:!0,getDataApi:t.getShopListData},on:{"on-select":function(e){return t.selectShop(arguments)}},model:{value:t.shopPopShow,callback:function(e){t.shopPopShow=e},expression:"shopPopShow"}}),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.storePopShow,callback:function(e){t.storePopShow=e},expression:"storePopShow"}},[i("listComp",{attrs:{visibleFlag:t.storePopShow,data:t.storeList,loadFinished:!0,title:"仓库检索"},on:{"update:visibleFlag":function(e){t.storePopShow=e},"update:visible-flag":function(e){t.storePopShow=e},"on-search":t.searchStore,"on-select":t.selectStore}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.itemPopShow,callback:function(e){t.itemPopShow=e},expression:"itemPopShow"}},[i("listComp",{attrs:{visibleFlag:t.itemPopShow,data:t.itemList,loadFinished:t.itemListLoadFinished,loading:t.onItemLoading,title:"品项检索"},on:{"update:visibleFlag":function(e){t.itemPopShow=e},"update:visible-flag":function(e){t.itemPopShow=e},"update:loading":function(e){t.onItemLoading=e},"on-search":t.searchItem,"on-select":t.selectItem,"on-load":t.onItemLoad}})],1)],1)},D=[],I=i("768b"),w=i("f6bb"),x=i("eb03"),y=50,B={name:"filterPop",components:{listComp:w["a"],filterListPopup:x["a"]},props:{visibleFlag:Boolean,filterParams:{type:Object,default:function(){return{}}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},dateType:"",currentDate:new Date,beginDate:this.$fxCommon.orderFilterStartDate(),endDate:this.$fxCommon.orderFilterEndDate(),shop:"请选择",shopId:"",store:"请选择",storeId:"",item:"请选择",itemId:"",billNo:"",datePickerShow:!1,shopPopShow:!1,storePopShow:!1,itemPopShow:!1,storeList:[],itemList:[],itemListStart:0,onItemLoading:!1,itemListLoadFinished:!1}},watch:{visibleFlag:{handler:function(t){t&&this.$fxUtils.isEmptyObjSHW(this.filterParams)&&this.resetHandler()},immediate:!0}},computed:Object(h["a"])({},Object(u["c"])({loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}})),methods:{getFilterParams:function(){return{beginDate:this.beginDate||this.$fxCommon.orderFilterStartDate(),endDate:this.endDate||this.$fxCommon.orderFilterEndDate(),shopId:this.shopId,storeId:this.storeId,itemId:this.itemId,billNo:this.billNo}},onCloseClick:function(){this.resetHandler(),this.$emit("update:visibleFlag",!1)},onConfirmClick:function(){this.$emit("update:visibleFlag",!1),this.$emit("on-confirm",this.getFilterParams()),this.$emit("update:filterParams",this.getFilterParams())},onResetClick:function(){this.resetHandler()},resetHandler:function(){this.beginDate=this.$fxCommon.orderFilterStartDate(),this.endDate=this.$fxCommon.orderFilterEndDate(),this.shop="请选择",this.shopId="",this.store="请选择",this.storeId="",this.item="请选择",this.itemId=""},onBeginDateClick:function(){this.dateType="begin",this.beginDate&&(this.currentDate=new Date(this.beginDate)),this.datePickerShow=!0},endDateClick:function(){this.dateType="end",this.endDate&&(this.currentDate=new Date(this.endDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){"begin"===this.dateType?(this.beginDate=this.$fxUtils.setDateTime(t,"时分"),this.endDate&&this.$fxCommon.orderFilterRangeDate(this.beginDate,this.endDate)||(this.endDate=this.$fxCommon.orderFilterDate(t))):(this.endDate=this.$fxUtils.setDateTime(t,"时分"),this.beginDate&&this.$fxCommon.orderFilterRangeDate(this.beginDate,this.endDate)||(this.beginDate=this.$fxCommon.orderFilterStartDate(t))),this.datePickerShow=!1},onShopClick:function(){this.shopPopShow=!0},selectShop:function(t){var e=Object(I["a"])(t,1),i=e[0];this.shop=i.name,this.shopId=i.id,this.store="请选择",this.storeId=""},getShopListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,n={keyword:t,start:e,size:i};return this.$fxApi("z5common.getUserManageShop")({data:n}).then(function(t){return t.shops})},onStoreClick:function(){if(!this.shopId)return this.$fxToast.fail("请先选择机构!"),!1;this.onStoreRefresh()},searchStore:function(t){this.onStoreRefresh(t)},selectStore:function(t){this.store=t.name,this.storeId=t.id},onStoreRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getStoreListData(e).then(function(e){t.storeList=e.shops,t.storePopShow=!0})},getStoreListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new l.a(function(i){var n={keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/houses"),data:n}).then(function(t){i(t)})})},onItemClick:function(){this.onItemRefresh()},searchItem:function(t){this.onItemRefresh(t)},selectItem:function(t){this.item=t.name,this.itemId=t.id},onItemRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.itemListStart=0,this.getItemListData(e).then(function(e){t.itemPopShow=!0,t.itemList=e.goods})},onItemLoad:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getItemListData(e).then(function(e){var i;(i=t.itemList).push.apply(i,Object(a["a"])(e.goods))})},getItemListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new l.a(function(i){var n={start:t.itemListStart,size:y,paged:!0,keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/goods"),data:n}).then(function(e){t.onItemLoading=!1,t.itemListStart+=y,e.goods.length<y?t.itemListLoadFinished=!0:t.itemListLoadFinished=!1,i(e)})})},onFocus:function(t){this.onScrollTop(t)},onScrollTop:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,i=this.$refs[t];if(!i||0===i.length)return!1;var n=i.$el.offsetTop,s=this.$refs["filterContent"];this.$fxUtils.scrollTopW({offsetTop:n,$el:s,distance:e})}}},$=B,L=(i("40b3"),Object(b["a"])($,k,D,!1,null,"c273148c",null)),T=L.exports,A=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"shopOrder-filter fx-shadow-down"},[i("div",{staticClass:"filter-item",on:{click:t.onStateClick}},[i("span",[t._v("审核状态")]),i("van-icon",{staticClass:"filter-arrow",attrs:{name:"arrow-down"}}),i("span",[t._v(t._s(t.state))])],1),i("div",{staticClass:"filter-item",on:{click:t.onReCheckStateClick}},[i("span",[t._v("复审状态")]),i("van-icon",{staticClass:"filter-arrow",attrs:{name:"arrow-down"}}),i("span",[t._v(t._s(t.reCheckState))])],1)])},P=[],O={name:"filterTab",props:{state:String,reCheckState:String},methods:{onStateClick:function(){this.$emit("on-state-click")},onReCheckStateClick:function(){this.$emit("on-reCheckState-click")}}},F=O,E=(i("5707"),Object(b["a"])(F,A,P,!1,null,"ea1226b4",null)),_=E.exports,N=50,U={name:"checkBill",components:{emptyBill:d["a"],orderBlock:S,filterPop:T,filterTab:_},data:function(){return{orderList:[],filterPopShow:!1,filterState:null,stateActionShow:!1,stateActions:[{id:null,name:"全部"},{id:"0",name:"未审核"},{id:"1",name:"已审核"}],filterReCheckState:null,reCheckStateShow:!1,reCheckStateActions:[{id:null,name:"全部"},{id:"0",name:"未复审"},{id:"1",name:"已复审"}],listStart:0,pullRefreshLoading:!1,listLoading:!1,loadFinished:!1,listError:!1,orderEditFlag:!1,filterParams:{}}},beforeRouteEnter:function(t,e,i){var n=["/main/home","/"],s=["/checkBillDetails"];n.includes(e.path)?i(function(e){e.restFilterParams(),e.restRouterParams(t.params),e.refreshOrderList()}):s.includes(e.path)?i(function(t){t.refreshOrderList()}):i()},computed:Object(h["a"])({},Object(u["c"])({billListPostParams:"billListPostParams",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{computedState:function(){var t=this;return this.stateActions.find(function(e){return e.id===t.filterState}).name},computedReCheckState:function(){var t=this;return this.reCheckStateActions.find(function(e){return e.id===t.filterReCheckState}).name}}),methods:{orderListPostHandler:function(t){var e=this;return new l.a(function(i){e.$store.commit({type:"SETSTATE",billListPostParams:t}),e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/checkbills/users/").concat(e.loginerId),data:t}).then(function(t){e.listStart+=N,e.listLoading=!1,t.checkBills.length<N&&(e.loadFinished=!0),i(t)})})},refreshOrderList:function(){var t=this;return new l.a(function(e){t.listStart=0;var i={start:t.listStart,size:N,paged:!0,businessDateStart:t.$fxCommon.orderFilterStartDate(),businessDateEnd:t.$fxCommon.orderFilterEndDate(),billState:t.filterState,reCheckState:t.filterReCheckState};i=c()(i,t.translateFilterParams(t.filterParams)),t.orderListPostHandler(i).then(function(i){t.orderList=i.checkBills,e(i)})})},translateFilterParams:function(t){return this.$fxUtils.isEmptyObjSHW(t)?{}:{businessDateStart:t.beginDate,businessDateEnd:t.endDate,shopId:""===t.shopId?null:t.shopId,houseId:""===t.storeId?null:t.storeId,goodsId:""===t.itemId?null:t.itemId,businessType:""===t.billTypeId?null:t.billTypeId,supplierId:""===t.supplierId?null:t.supplierId,sysBillCode:""===t.billNo?null:t.billNo}},onFilterConfirm:function(t){var e=this;this.listStart=0;var i={start:this.listStart,size:N,paged:!0,businessDateStart:t.beginDate,businessDateEnd:t.endDate,billState:this.filterState,reCheckState:this.filterReCheckState,shopId:""===t.shopId?null:t.shopId,houseId:""===t.storeId?null:t.storeId,goodsId:""===t.itemId?null:t.itemId,businessType:""===t.billTypeId?null:t.billTypeId,supplierId:""===t.supplierId?null:t.supplierId,sysBillCode:""===t.billNo?null:t.billNo};this.orderListPostHandler(i).then(function(t){e.orderList=t.checkBills})},onPullRefresh:function(){var t=this;this.refreshOrderList().then(function(e){t.pullRefreshLoading=!1})},onLoadMore:function(){var t=this,e=c()(this.billListPostParams,{start:this.listStart});this.orderListPostHandler(e).then(function(e){var i;(i=t.orderList).push.apply(i,Object(a["a"])(e.checkBills))})},onSearchClick:function(){this.filterPopShow=!0},onStateClick:function(){this.stateActionShow=!0},onStateSelect:function(t){this.filterState=t.id,this.stateActionShow=!1,this.refreshOrderList()},onReCheckStateClick:function(){this.reCheckStateShow=!0},onReCheckStateSelect:function(t){this.filterReCheckState=t.id,this.reCheckStateShow=!1,this.refreshOrderList()},onClickOrder:function(t){this.$router.push({path:"checkBillDetails",query:{orderId:t.id}})},onCreateClick:function(){this.$router.push({path:"creatCheckBill"})},restFilterParams:function(){this.filterParams={},this.filterState=null,this.filterReCheckState=null,this.orderEditFlag=!1},restRouterParams:function(t){this.$fxUtils.isEmptyObjSHW(t)||(this.filterState=t.billState)}}},R=U,H=(i("08c07"),Object(b["a"])(R,n,s,!1,null,"4b03c065",null));e["default"]=H.exports},"51b5":function(t,e,i){"use strict";var n=i("526c"),s=i.n(n);s.a},"51e3":function(t,e,i){"use strict";var n=i("fa8a"),s=i.n(n);s.a},"526c":function(t,e,i){},5402:function(t,e,i){"use strict";var n=i("73b7"),s=i.n(n);s.a},5707:function(t,e,i){"use strict";var n=i("e5de"),s=i.n(n);s.a},"5f8b":function(t,e,i){},"5fe1":function(t,e,i){"use strict";var n=i("e08a"),s=i.n(n);s.a},7183:function(t,e,i){},"73b7":function(t,e,i){},"752f":function(t,e,i){},"75c8":function(t,e,i){"use strict";var n=i("b5c9"),s=i.n(n);s.a},"76e7":function(t,e,i){"use strict";var n=i("7183"),s=i.n(n);s.a},"7c34":function(t,e,i){"use strict";var n=i("752f"),s=i.n(n);s.a},"7d8d":function(t,e,i){"use strict";var n=i("cac7"),s=i.n(n);s.a},"86b8":function(t,e,i){"use strict";var n=i("e399"),s=i.n(n);s.a},8741:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-edit"},[i("w-header",{attrs:{title:"选择品项",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}},[i("van-icon",{staticClass:"header-confirm-btn",attrs:{slot:"header-right",name:"success"},on:{click:t.onItemConfirm},slot:"header-right"})],1),i("div",{staticClass:"item-search clearfix"},[i("van-search",{attrs:{placeholder:"请输入搜索关键词",shape:"round"},on:{search:t.search},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}}),i("van-switch-cell",{directives:[{name:"show",rawName:"v-show",value:t.createBillFlag,expression:"createBillFlag"}],staticClass:"info-item",attrs:{title:"未盘品项自动清零"},model:{value:t.isUnCheckZero,callback:function(e){t.isUnCheckZero=e},expression:"isUnCheckZero"}})],1),i("div",{staticClass:"item-edit-content"},[i("addItemClassList",{attrs:{itemClassList:t.itemClassList},on:{"on-change-class":t.changeClass},model:{value:t.currentClass,callback:function(e){t.currentClass=e},expression:"currentClass"}}),i("div",{ref:"details-content",staticClass:"item-details-content"},[i("van-list",{attrs:{finished:t.loadFinished,"finished-text":"没有更多了","error-text":"请求失败，点击重新加载"},on:{load:t.onLoadMore},model:{value:t.listLoading,callback:function(e){t.listLoading=e},expression:"listLoading"}},t._l(t.itemList,function(e){return i("div",{key:e.id,ref:"details-row-"+e.id,refInFor:!0,staticClass:"item-detail"},[i("div",{staticClass:"item-details-img"},[i("img",{attrs:{src:t.comptedItemImgSrc(e.imageUrls),onerror:t.$fxCommon.errorImg("item")}})]),i("div",{staticClass:"item-details-params"},[i("div",{staticClass:"item-details-name fx-ellipsis"},[t._v(t._s(e.name))]),i("div",{staticClass:"item-details-spec fx-ellipsis"},[t._v(t._s(e.spec))])]),i("van-checkbox",{staticClass:"item-checkbox",on:{change:function(i){return t.clickCheckBoxes(e)}},model:{value:e.checked,callback:function(i){t.$set(e,"checked",i)},expression:"item.checked"}})],1)}),0)],1)],1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.createBillFlag,expression:"createBillFlag"}],staticClass:"item-edit-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.selectAllFlag&&!t.hasInventoryFlag,expression:"!selectAllFlag && !hasInventoryFlag"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:t.onSelectAllClick}},[t._v("全选")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.selectAllFlag||t.hasInventoryFlag,expression:"selectAllFlag || hasInventoryFlag"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:t.onCancelAllClick}},[t._v("取消全选")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.createBillFlag,expression:"createBillFlag"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:t.onSelectInventoryClick}},[t._v("有库存")])],1)],1)},s=[],a=i("59ad"),o=i.n(a),c=i("75fc"),r=(i("7514"),i("ac6a"),i("20d6"),i("795b")),l=i.n(r),h=i("cebc"),u=(i("c5f6"),i("2f62")),d=i("d444"),f=10,m={name:"itemEditComp",components:{addItemClassList:d["a"]},props:{visibleFlag:Boolean,store:{type:Object,default:function(){return{}}},shopId:{type:String,default:""},businessDate:{type:[String,Number],default:""},parentStoreItem:{type:Array,default:function(){return[]}},createBillFlag:{type:Boolean,default:!1},unCheckZero:Boolean,hasSumBatch:Boolean},data:function(){return{activeNames:[],leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",currentClass:"",itemClassList:[],itemList:[],rowActive:"",selectedItemArr:[],listLoading:!1,loadFinished:!0,itemListStart:0,selectAllFlag:!1,hasInventoryFlag:!1,isUnCheckZero:!1}},computed:Object(h["a"])({},Object(u["c"])({loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{comptedItemImgSrc:function(t){return function(t){return 0===t.length?"":t[0]}}}),created:function(){this.$fxEventBus.initEvent(this,"redCode",this.getItemByRedCode)},watch:{visibleFlag:{handler:function(t){t&&(this.isUnCheckZero=this.unCheckZero,this.refresh())},immediate:!0}},methods:{refresh:function(){var t=this;this.resetHandler(),this.getItemClass().then(function(e){t.itemClassList=e.goodsTypes,t.getItemByClass()})},resetHandler:function(){this.currentClass="",this.searchKey="",this.selectedItemArr=[],this.itemList=[],this.selectAllFlag=!1,this.hasInventoryFlag=!1},onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onItemConfirm:function(){if(!this.selectedItemArr||0===this.selectedItemArr.length)return this.$fxToast.fail("请选择品项!"),!1;this.$emit("on-confirm",this.selectedItemArr,this.isUnCheckZero)},changeClass:function(t){this.searchKey="",this.getItemByClass()},getItemClass:function(){var t=this;return new l.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/goodTypes")}).then(function(t){e(t)})})},getItemByClass:function(t){var e=this;this.itemListStart=0,this.getItem(t).then(function(t){e.itemList=t.goods,e.setListLoading(t.goods.length),e.selectedItemArr.length&&e.checkItem(e.itemList)})},getItem:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.searchKey,i=this.itemList.filter(function(e){var i=t.selectedItemArr.findIndex(function(t){return t.id===e.id});return!~i&&e.checked});return this.selectedItemArr=this.selectedItemArr.concat(i),new l.a(function(i){var n={houseId:t.store.id,paged:!0,start:t.itemListStart,size:f,removeIds:t.parentStoreItem.reduce(function(t,e){return"del"!==e.changeType?t.concat(e.goodsDTO.id):t},[]),workDate:new Date(t.businessDate).getTime(),searchText:e,goodsTypeId:t.currentClass||null};t.$fxHttp.requestPost({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/goods?"),data:n,query:{m:t.createBillFlag?"list4CheckBill":"list4AddCheckDetail"}}).then(function(t){t.goods.forEach(function(t){t.checked=!1}),i(t)})})},checkItem:function(t){var e=this;t.forEach(function(t,i){var n=e.selectedItemArr.find(function(e){return e.id===t.id});t.checked=!!n})},search:function(t){this.searchKey=t,this.getItemByClass()},onLoadMore:function(){var t=this;this.getItem().then(function(e){var i;(i=t.itemList).push.apply(i,Object(c["a"])(e.goods)),t.setListLoading(e.goods.length),t.selectedItemArr.length&&t.checkItem(e.goods)})},setListLoading:function(t){this.listLoading=!1,this.itemListStart+=f,this.loadFinished=t<f},onSelectInventoryClick:function(){var t=this,e={houseId:this.store.id,paged:!0,start:0,size:0,removeIds:[],workDate:new Date(this.businessDate).getTime()};this.$fxHttp.requestPost({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.shopId,"/users/").concat(this.loginerId,"/goods?"),data:e,query:{m:"list4CheckBillInventory"}}).then(function(e){t.hasInventoryFlag=!0,t.selectedItemArr=e.goods,t.selectedItemArr.length&&t.checkItem(t.itemList)})},onSelectAllClick:function(){var t=this,e={houseId:this.store.id,paged:!0,start:0,size:0,removeIds:[],workDate:new Date(this.businessDate).getTime(),searchText:this.searchKey,goodsTypeId:this.currentClass||null};this.$fxHttp.requestPost({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.shopId,"/users/").concat(this.loginerId,"/goods?"),data:e,query:{m:"list4CheckBill"}}).then(function(e){t.selectAllFlag=!0,t.selectedItemArr=e.goods,t.selectedItemArr.length&&t.checkItem(t.itemList)})},onCancelAllClick:function(){this.hasInventoryFlag=!1,this.selectAllFlag=!1,this.selectedItemArr=[],this.itemList.forEach(function(t,e){t.checked&&(t.checked=!1)})},clickCheckBoxes:function(t){t.checked?~this.getSelectItemIndex(t)||this.selectedItemArr.push(t):this.selectedItemArr.splice(this.getSelectItemIndex(t),1)},getSelectItemIndex:function(t){return this.selectedItemArr.findIndex(function(e){return e.id===t.id})},getItemByRedCode:function(t){var e=this;if(!this.visibleFlag)return!1;t.length<=24?this.getItemByBarRedCode(t):this.hasSumBatch||this.getItemByCode(t).then(function(t){if(0===t.length)return e.$fxToast.top("当前仓库无此品项!"),!1;e.getScanGoodData(t.checkDetailDTO)})},getItemByCode:function(t){var e=this;return new l.a(function(i){var n={qrCodeContent:t,houseId:e.store.id,billType:2};e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.shopId,"/users/").concat(e.loginerId,"/getscancodedata"),query:n}).then(function(t){i(t)})})},getScanGoodData:function(t){this.setScanGood(t)},setScanGood:function(t){var e=[];e=this.selectedItemArr;var i=e.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id});~i?this.$fxToast.fail("不能重复添加品项！"):(this.scanPushItem(t),this.$fxToast.success("扫码添加品项成功！"))},scanPushItem:function(t){this.itemList=[t.goodsDTO];var e=this.itemList[0];e.checked=!0,this.clickCheckBoxes(e)},toFixedNumberSize:function(t){return o()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},getItemByBarRedCode:function(t){var e=this,i=this.$fxCommon.redCode2Item(t),n=i.itemCode;if(n.length<13)return this.$fxToast.top("此条码无对应品项!"),!1;this.currentClass="",this.itemListStart=0,this.getItem(n).then(function(t){var i=t.goods;if(e.itemList=i,0===i.length)return e.$fxToast.top("当前仓库无此品项!"),!1;var n=e.itemList[0];n.checked=!0,e.clickCheckBoxes(n)})}}},p=m,v=(i("fd07"),i("2877")),g=Object(v["a"])(p,n,s,!1,null,"af4f4016",null);e["a"]=g.exports},"8d5d":function(t,e,i){"use strict";var n=i("08d9"),s=i.n(n);s.a},"8f3f":function(t,e,i){},9909:function(t,e,i){t.exports=i.p+"src/assets/img/icon-record.bacf8bde.png"},"9a45":function(t,e,i){"use strict";var n=i("4340"),s=i.n(n);s.a},afae:function(t,e,i){"use strict";var n=i("fc31"),s=i.n(n);s.a},b5bc:function(t,e,i){"use strict";var n=i("5f8b"),s=i.n(n);s.a},b5c9:function(t,e,i){},c137:function(t,e,i){},c347:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-shopOrder-create"},[i("w-header",{attrs:{title:"新增盘点单",border:!0}}),i("createBillInfo",{attrs:{data:t.orderInfoData},on:{"on-shop-click":t.onShopClick,"on-house-click":t.onHouseClick,"on-date-click":t.onDateClick,"on-plan-click":t.onPlanClick,"on-plan-clear":t.onPlanClear,"on-batchType-click":t.onBatchTypeClick}}),i("div",{staticClass:"shopOrder-bottom"},[i("van-button",{staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:t.onCancelClick}},[t._v("取消")]),i("van-button",{staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onAddItemClick}},[t._v("生成")])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.shopPopShow,callback:function(e){t.shopPopShow=e},expression:"shopPopShow"}},[i("listComp",{attrs:{visibleFlag:t.shopPopShow,data:t.shopList,loadFinished:t.shopListLoadFinished,loading:t.onShopLoading,title:"请选择机构"},on:{"update:visibleFlag":function(e){t.shopPopShow=e},"update:visible-flag":function(e){t.shopPopShow=e},"update:loading":function(e){t.onShopLoading=e},"on-search":t.searchShop,"on-select":t.selectShop,"on-load":t.onShopLoad}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.housePopShow,callback:function(e){t.housePopShow=e},expression:"housePopShow"}},[i("listComp",{attrs:{visibleFlag:t.housePopShow,data:t.houseList,loadFinished:!0,title:"盘点仓库检索"},on:{"update:visibleFlag":function(e){t.housePopShow=e},"update:visible-flag":function(e){t.housePopShow=e},"on-search":t.searcHouse,"on-select":t.selectHouse}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.planPopShow,callback:function(e){t.planPopShow=e},expression:"planPopShow"}},[i("listComp",{attrs:{visibleFlag:t.planPopShow,data:t.planList,loadFinished:!0,title:"盘点方案"},on:{"update:visibleFlag":function(e){t.planPopShow=e},"update:visible-flag":function(e){t.planPopShow=e},"on-search":t.searcPlan,"on-select":t.selectPlan}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemPopShow,callback:function(e){t.itemPopShow=e},expression:"itemPopShow"}},[i("itemEditComp",{attrs:{visibleFlag:t.itemPopShow,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,store:t.orderInfoData.houseDTO,businessDate:t.orderInfoData.businessDate,createBillFlag:!0,unCheckZero:t.sysCheckClearZero},on:{"update:visibleFlag":function(e){t.itemPopShow=e},"update:visible-flag":function(e){t.itemPopShow=e},"on-confirm":t.onConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right"},model:{value:t.batchTypePopShow,callback:function(e){t.batchTypePopShow=e},expression:"batchTypePopShow"}},[i("listComp",{attrs:{visibleFlag:t.batchTypePopShow,data:t.batchTypeList,title:"合批分批检索",loadFinished:!0},on:{"update:visibleFlag":function(e){t.batchTypePopShow=e},"update:visible-flag":function(e){t.batchTypePopShow=e},"on-select":t.selectBatchType,"on-search":t.searchBatchType}})],1)],1)},s=[],a=(i("6762"),i("2fdb"),i("ac6a"),i("7f7f"),i("a481"),i("5176")),o=i.n(a),c=i("75fc"),r=i("795b"),l=i.n(r),h=i("cebc"),u=i("2f62"),d=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"checkbill-info-block fx-shadow-block"},[i("van-cell-group",[i("van-cell",{staticClass:"info-item",attrs:{title:"机构","value-class":"info-item-value",value:t.data.shopDTO&&t.data.shopDTO.name,"is-link":""},on:{click:function(e){return t.onEmitClick("on-shop-click")}}}),i("van-cell",{staticClass:"info-item",attrs:{title:"盘点仓库","value-class":"info-item-value",value:t.data.houseDTO&&t.data.houseDTO.name,"is-link":""},on:{click:function(e){return t.onEmitClick("on-house-click")}}}),i("van-cell",{staticClass:"info-item",attrs:{title:"盘点日期",value:t.formatterDate(t.data.businessDate),"is-link":""},on:{click:function(e){return t.onEmitClick("on-date-click")}}}),i("van-pro-field",{staticClass:"info-item",attrs:{label:"手工单号",placeholder:"请输入手工单号","input-align":"right",disabled:t.isDisabled},model:{value:t.data.manualCode,callback:function(e){t.$set(t.data,"manualCode",e)},expression:"data.manualCode"}}),i("van-cell",{staticClass:"info-item",attrs:{title:"盘点方案","value-class":"info-item-value",value:t.data.planDTO&&t.data.planDTO.name?t.data.planDTO.name:"请选择"},on:{click:function(e){return t.onEmitClick("on-plan-click")}}},[i("van-icon",{staticClass:"item-clear-btn",attrs:{slot:"right-icon",name:t.hasPlan?"close":"arrow"},on:{click:function(e){e.stopPropagation(),t.hasPlan?t.onEmitClick("on-plan-clear"):t.onEmitClick("on-plan-click")}},slot:"right-icon"})],1),i("van-pro-field",{staticClass:"info-item",attrs:{label:"整单备注",placeholder:"请输入整单备注","input-align":"right",disabled:t.isDisabled},model:{value:t.data.billMemo,callback:function(e){t.$set(t.data,"billMemo",e)},expression:"data.billMemo"}}),i("van-cell",{attrs:{title:"盘点方式",value:t.data.batchTypeName,"value-class":"info-item-value","is-link":""},on:{click:function(e){return t.onEmitClick("on-batchType-click")}}})],1)],1)},f=[],m={name:"orderInfoAdd",components:{},props:{data:{type:Object,default:function(){return{}}},isDisabled:Boolean},data:function(){return{}},computed:Object(h["a"])({},Object(u["c"])({sysPointSize:"sysPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{formatterDate:function(t){var e=this;return function(t){return"number"===typeof t?e.$fxUtils.setDateTime(new Date(t),"时分"):t}},hasPlan:function(){return this.data.planDTO&&this.data.planDTO.id}}),methods:{onEmitClick:function(t){if(this.isDisabled)return!1;this.$emit(t)}}},p=m,v=(i("75c8"),i("2877")),g=Object(v["a"])(p,d,f,!1,null,"22cfa9f3",null),b=g.exports,C=i("f6bb"),S=i("8741"),k=50,D={name:"creatCheckBill",components:{createBillInfo:b,listComp:C["a"],itemEditComp:S["a"]},data:function(){return{query:this.$route.query,activeNames:["1"],tabActive:"选项1",orderInfoData:{accountDTO:{},businessDate:"",shopDTO:{name:"请选择",id:""},houseDTO:{name:"请选择",id:""},planDTO:null,updateIndicator:"Append",unCheckZero:!1,batchTypeName:"合批",batchType:1},orderItemList:[],itemStorePopShow:!1,housePopShow:!1,houseList:[],planPopShow:!1,planList:[],datePickerShow:!1,currentDate:new Date,itemPopShow:!1,shopList:[],shopPopShow:!1,shopListStart:0,onShopLoading:!1,shopListLoadFinished:!1,batchTypeData:[{id:!1,name:"分批"},{id:!0,name:"合批"}],batchTypePopShow:!1,batchTypeList:[]}},created:function(){var t=this;this.getDefaultShopListData().then(function(e){var i=Object(h["a"])({},e);if(!i.shops)return!1;t.orderInfoData.shopDTO=i.shops[0],t.getHouseListData().then(function(e){var i=Object(h["a"])({},e);return!!i.shops.length&&(t.orderInfoData.houseDTO=i.shops[0],!t.$fxSysAuth("shopCheckBill.defaultPlan")||void t.getPlanListData(null,!1).then(function(e){var i=Object(h["a"])({},e);if(!i.checkPlans)return!1;t.orderInfoData.planDTO=i.checkPlans[0]}))})}),1===this.sysCheckDateFormat?this.orderInfoData.businessDate=this.$fxUtils.getCustomerDateAndCurrentTime(new Date).getTime():this.orderInfoData.businessDate=this.$fxUtils.getCustomerDateAndTime(new Date,"23:59:59").getTime()},computed:Object(h["a"])({},Object(u["c"])({loginerId:function(t){return t.loginer.loginerId},sysCheckDateFormat:function(t){return t.systemParams.sysCheckDateFormat},sysCheckClearZero:function(t){return t.systemParams.sysCheckClearZero},loginerShopId:function(t){return t.loginer.loginerShopId},loginerShopName:function(t){return t.loginer.loginerShopName},loginerOrganType:function(t){return t.loginer.loginerOrganType}})),methods:{getDefaultShopListData:function(){var t=this;return new l.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/inshopDefault")}).then(function(t){e(t)})})},onHouseClick:function(){this.onHouseRefresh()},searcHouse:function(t){this.onHouseRefresh(t)},onHouseRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getHouseListData(e).then(function(e){t.housePopShow=!0,t.houseList=e.shops})},getHouseListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new l.a(function(i){var n={searchText:e,disableFalg:0};t.$fxHttp.requestPost({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.orderInfoData.shopDTO.id,"/users/").concat(t.loginerId,"/houses"),data:n}).then(function(t){i(t)})})},selectHouse:function(t){var e=this;if(this.orderInfoData.houseDTO=t,!this.$fxSysAuth("shopCheckBill.defaultPlan"))return this.orderInfoData.planDTO="",!0;this.getPlanListData(null,!1).then(function(t){var i=Object(h["a"])({},t);if(!i.checkPlans)return!1;e.orderInfoData.planDTO=i.checkPlans[0]})},onShopClick:function(){var t=this;this.shopListStart=0,this.shopListLoadFinished=!1,this.getShopListData().then(function(e){t.shopList=e.shops,t.shopPopShow=!0})},searchShop:function(t){var e=this;this.shopListStart=0,this.getShopListData(t).then(function(t){e.shopList=t.shops})},onShopLoad:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getShopListData(e).then(function(e){var i;(i=t.shopList).push.apply(i,Object(c["a"])(e.shops))})},getShopListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new l.a(function(i){var n={start:t.shopListStart,size:k,keyword:e,m:"getShopListForUserhouse"};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/shops"),data:n}).then(function(e){t.onShopLoading=!1,t.shopListStart+=k,e.shops.length<k?t.shopListLoadFinished=!0:t.shopListLoadFinished=!1,i(e)})})},checkShop:function(t){var e=this;return new l.a(function(i){var n=e.orderInfoData.shopDTO||{};n.id!==t.id&&i()})},selectShop:function(t){var e=this;this.checkShop(t).then(function(){e.clearItemConfim("更换机构清空仓库，是否确认修改?").then(function(){e.orderInfoData.houseDTO={},e.orderInfoData.shopDTO=t,e.houseList=[],e.orderInfoData.planDTO=null,e.getHouseListData().then(function(t){return!!t.shops.length&&(e.orderInfoData.houseDTO=t.shops[0],!e.$fxSysAuth("shopCheckBill.defaultPlan")||void e.getPlanListData(null,!1).then(function(t){if(!t.checkPlans)return!1;e.orderInfoData.planDTO=t.checkPlans[0]}))})})})},clearItemConfim:function(t){var e=this;return new l.a(function(i){e.orderInfoData.houseDTO.id?e.$dialog.confirm({title:"提示",message:t}).then(function(){i()}).catch(function(){}):i()})},onPlanClick:function(){this.onPlanRefresh()},searcPlan:function(t){this.onPlanRefresh(t)},onPlanRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getPlanListData(e,!0).then(function(e){t.planPopShow=!0,t.planList=e.checkPlans})},getPlanListData:function(){var t,e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1?arguments[1]:void 0;return t=n?"":this.orderInfoData.planDTO?this.orderInfoData.planDTO.id:"",new l.a(function(n){var s={workDate:e.$fxUtils.setDate(new Date(e.orderInfoData.businessDate))+" 23:59:59",keyWord:i,houseId:e.orderInfoData.houseDTO.id,planId:t};e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.orderInfoData.shopDTO.id,"/users/").concat(e.loginerId,"/checkplans"),data:s}).then(function(t){n(t)})})},selectPlan:function(t){this.orderInfoData.planDTO=t},onDateClick:function(){if(!this.$fxAuth("shopCheckBill.modifyCheckDate"))return this.$toast({message:"当前没有修改盘点日期权限!",position:"top"}),!1;this.datePickerShow=!0},dateConfirmhandle:function(t){var e=this,i=0;i=1===this.sysCheckDateFormat?this.$fxUtils.getCustomerDateAndCurrentTime(t).getTime():this.$fxUtils.getCustomerDateAndTime(t,"23:59:59").getTime(),this.orderInfoData.businessDate!==i?this.$fxSysAuth("shopCheckBill.defaultPlan")?(this.orderInfoData.businessDate=i,this.getPlanListData(!1).then(function(t){if(!t.checkPlans)return!1;e.orderInfoData.planDTO=t.checkPlans[0]})):this.orderInfoData.planDTO?this.$dialog.confirm({title:"提示",message:"更改盘点日期将清空盘点方案，是否确认修改?"}).then(function(){e.orderInfoData.businessDate=i,e.orderInfoData.planDTO=null}):(this.orderInfoData.businessDate=i,this.orderInfoData.planDTO=null):this.orderInfoData.businessDate=i,this.datePickerShow=!1},onCancelClick:function(){this.$router.go(-1)},onAddItemClick:function(){var t=this;return""===this.orderInfoData.houseDTO.id?(this.$fxToast.fail("请先选择仓库!"),!1):""===this.orderInfoData.businessDate?(this.$fxToast.fail("请先选择盘点日期!"),!1):void this.createdByPlan().catch(function(){t.openItemPop()})},createdByPlan:function(){var t=this;return new l.a(function(e,i){if(!t.orderInfoData.planDTO)return i(t.orderInfoData.planDTO),!1;var n=o()(t.orderInfoData,{details:[],planId:t.orderInfoData.planDTO.id,sumAccountMoney:0,sumActualMoney:0,sumPLMoney:0,unCheckZero:!1,businessDate:new Date(t.orderInfoData.businessDate).getTime(),accountDTO:{id:t.loginerId},hasSumBatch:t.orderInfoData.batchType});t.$fxHttp.requestPost({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/checkbills"),data:n}).then(function(e){t.$fxToast.success("创建盘点单成功").then(function(){t.$router.replace({path:"checkBillDetails",query:{orderId:e.checkBills[0].id}})})})})},openItemPop:function(){var t=this,e={houseId:this.orderInfoData.houseDTO.id,paged:!0,start:0,size:k,removeIds:[],workDate:new Date(this.orderInfoData.businessDate).getTime(),searchText:""};this.$fxHttp.requestPost({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.shopId,"/users/").concat(this.loginerId,"/goods?"),data:e,query:{m:"list4CheckBill"}}).then(function(e){e.goods.length?t.itemPopShow=!0:t.$fxToast.fail("没有品项!")})},onConfirm:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.$fxUtils.arrDedup(t.map(function(t){return t.id})),s=o()(this.orderInfoData,{goodsIdList:n,details:[],sumAccountMoney:0,sumActualMoney:0,sumPLMoney:0,unCheckZero:i,businessDate:new Date(this.orderInfoData.businessDate).getTime(),accountDTO:{id:this.loginerId},houseDTO:{id:this.orderInfoData.houseDTO.id,name:this.orderInfoData.houseDTO.name},shopDTO:{id:this.orderInfoData.shopDTO.id,name:this.orderInfoData.shopDTO.name},hasSumBatch:this.orderInfoData.batchType});this.$fxHttp.requestPost({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/checkbills"),data:s}).then(function(t){e.$fxToast.success("创建盘点单成功").then(function(){e.itemPopShow=!1,e.$nextTick(function(){e.$router.replace({path:"checkBillDetails",query:{orderId:t.checkBills[0].id}})})})})},getSelectItemUnit:function(t){var e=this,i=[];return t.forEach(function(t){var n={billId:e.query.orderId,goodsDTO:{id:t.id},houseId:e.orderInfoData.houseDTO.id,workDate:e.orderInfoData.businessDate};i.push(n)}),new l.a(function(t){e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/checkbills/").concat(e.query.orderId,"/details"),data:i}).then(function(e){t(e)})})},onPlanClear:function(){this.orderInfoData.planDTO=null},onBatchTypeClick:function(){this.batchTypeList=this.batchTypeData,this.batchTypePopShow=!0},selectBatchType:function(t){this.orderInfoData.batchTypeName=t.name,this.orderInfoData.batchType=t.id},searchBatchType:function(t){this.batchTypeList=this.batchTypeData.filter(function(e){return e["name"].includes(t)})}}},I=D,w=(i("51e3"),Object(v["a"])(I,n,s,!1,null,"4b28961e",null));e["default"]=w.exports},c39e:function(t,e,i){},c646:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-shopOrder-details"},[i("w-header",{attrs:{title:t.orderInfoData.sysbillCode,titleFontSize:"3.733vw",border:!0}}),i("orderInfo",{ref:"orderInfo",attrs:{data:t.orderInfoData,isDisabled:t.isBillState(1)||t.isWeightState(1)||t.isWeightState(2)||!t.$fxAuth("shopCheckBill.save"),collapseDisabled:t.itemInputFocusing}}),i("orderItem",{attrs:{data:t.orderItemList,isDisabled:t.isBillState(1)||t.isWeightState(1)||t.isWeightState(2)||!t.$fxAuth("shopCheckBill.save"),itemInputFocusing:t.itemInputFocusing,planId:t.orderInfoData.planId,hasSumBatch:t.orderInfoData.hasSumBatch},on:{"update:itemInputFocusing":function(e){t.itemInputFocusing=e},"update:item-input-focusing":function(e){t.itemInputFocusing=e},"on-item-edit":t.onItemEdit,"on-add-click":t.onAddClick,"on-search-click":t.onSearchClick,"on-item-focus":t.onItemFocus,"on-mic-click":t.onMicClick,"on-selectbom-click":t.onSelectBomClick,"on-viewbom-click":t.onViewBomClick}}),i("div",{staticClass:"shopOrder-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopCheckBill.refreshAccounts")&&t.isBillState(0)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('shopCheckBill.refreshAccounts') && isBillState(0) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:t.onRefreshAccountsClick}},[t._v("刷新账存")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopCheckBill.del")&&t.isBillState(0)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('shopCheckBill.del') && isBillState(0) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:t.onDelBillClick}},[t._v("删除")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopCheckBill.check")&&t.isBillState(0)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('shopCheckBill.check') && isBillState(0) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:t.onExpressClick}},[t._v("审核")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopCheckBill.unCheck")&&t.isBillState(1)&&t.isBillReState(0)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('shopCheckBill.unCheck') && isBillState(1) && isBillReState(0) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:t.onUnExpressClick}},[t._v("反审")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopCheckBill.rdCheck")&&t.isBillState(1)&&t.isBillReState(0),expression:"$fxAuth('shopCheckBill.rdCheck') && isBillState(1) && isBillReState(0)"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onBillReStateClick}},[t._v("复审")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopCheckBill.unReCheck")&&t.isBillReState(1),expression:"$fxAuth('shopCheckBill.unReCheck') && isBillReState(1)"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onUnBillReStateClick}},[t._v("取消复审")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopCheckBill.save")&&t.isBillState(0)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('shopCheckBill.save') && isBillState(0) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onSaveClick}},[t._v("保存")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopCheckBill.weighState")&&t.isBillState(0)&&(t.isWeightState(0)||t.isWeightState(3))&&t.orderInfoData.hasSumBatch,expression:"$fxAuth('shopCheckBill.weighState') && isBillState(0) && (isWeightState(0) || isWeightState(3)) && orderInfoData.hasSumBatch"}],staticClass:"bottom-btn fx-no-radius yellow-btn",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onWeightClick")}}},[t._v("下发称重")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopCheckBill.weighState")&&t.isBillState(0)&&(t.isWeightState(1)||t.isWeightState(2)),expression:"$fxAuth('shopCheckBill.weighState') && isBillState(0) && (isWeightState(1) || isWeightState(2))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onUnWeightClick")}}},[t._v("取消称重")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopCheckBill.weighState")&&t.isBillState(0)&&t.isWeightState(2)&&t.sysDZCManyLower,expression:"$fxAuth('shopCheckBill.weighState') && isBillState(0) && isWeightState(2) && sysDZCManyLower"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onEndWeightClick")}}},[t._v("结束称重")])],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemPopShow,callback:function(e){t.itemPopShow=e},expression:"itemPopShow"}},[i("itemEditComp",{attrs:{visibleFlag:t.itemPopShow,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,store:t.orderInfoData.houseDTO,businessDate:t.orderInfoData.businessDate,parentStoreItem:t.orderItemList,createBillFlag:!1,hasSumBatch:t.orderInfoData.hasSumBatch},on:{"update:visibleFlag":function(e){t.itemPopShow=e},"update:visible-flag":function(e){t.itemPopShow=e},"on-confirm":t.onConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,isCheckedBill:t.isBillState(1),isDisabled:t.isBillState(1)||t.isWeightState(1)||t.isWeightState(2)||!t.$fxAuth("shopCheckBill.save"),hasSumBatch:t.orderInfoData.hasSumBatch},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemMicEditPopShow,callback:function(e){t.itemMicEditPopShow=e},expression:"itemMicEditPopShow"}},[i("itemMicEditComp",{attrs:{visibleFlag:t.itemMicEditPopShow,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,billId:t.orderInfoData.id,checkPlanId:t.orderInfoData.planId,houseId:t.orderInfoData.houseDTO&&t.orderInfoData.houseDTO.id,checkDate:t.orderInfoData.businessDate},on:{"update:visibleFlag":function(e){t.itemMicEditPopShow=e},"update:visible-flag":function(e){t.itemMicEditPopShow=e},"on-micAdd-item":t.onMicAddItem}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemSearchPopShow,callback:function(e){t.itemSearchPopShow=e},expression:"itemSearchPopShow"}},[i("itemSearchPop",{attrs:{visibleFlag:t.itemSearchPopShow,data:t.searchItem,planId:t.orderInfoData.planId,house:t.orderInfoData.houseDTO,isCheckedBill:t.isBillState(1),isDisabled:t.isBillState(1)||t.isWeightState(1)||t.isWeightState(2)||!t.$fxAuth("shopCheckBill.save"),hasSumBatch:t.orderInfoData.hasSumBatch},on:{"update:visibleFlag":function(e){t.itemSearchPopShow=e},"update:visible-flag":function(e){t.itemSearchPopShow=e},"on-search-confirm":t.onSearchConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.bomPopShow,callback:function(e){t.bomPopShow=e},expression:"bomPopShow"}},[i("bomEditComp",{attrs:{visibleFlag:t.bomPopShow,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,orderId:t.orderInfoData.id},on:{"update:visibleFlag":function(e){t.bomPopShow=e},"update:visible-flag":function(e){t.bomPopShow=e},"on-bom-confirm":t.onBomConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.bomSearchPopShow,callback:function(e){t.bomSearchPopShow=e},expression:"bomSearchPopShow"}},[i("bomSearchPop",{attrs:{visibleFlag:t.bomSearchPopShow,data:t.searchBom,searchKeywords:"code,name,pinYin"},on:{"update:visibleFlag":function(e){t.bomSearchPopShow=e},"update:visible-flag":function(e){t.bomSearchPopShow=e}}})],1)],1)},s=[],a=(i("7f7f"),i("7514"),i("75fc")),o=i("59ad"),c=i.n(o),r=(i("20d6"),i("ac6a"),i("f499")),l=i.n(r),h=i("5176"),u=i.n(h),d=i("795b"),f=i.n(d),m=(i("6762"),i("2fdb"),i("6b54"),i("cebc")),p=i("2f62"),v=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-info-block fx-shadow-block"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},[i("van-collapse-item",{attrs:{name:"1",disabled:t.collapseDisabled}},[i("div",{staticClass:"info-title",attrs:{slot:"title"},slot:"title"},[i("span",{staticClass:"info-title-name"},[t._v("单据信息")]),i("stateText",{staticClass:"stateTag fl-r",attrs:{billState:t.data.billState}}),i("span",{directives:[{name:"show",rawName:"v-show",value:1===t.data.weightState,expression:"data.weightState === 1"}],staticClass:"info-title-weightState"},[t._v("待称重")])],1),i("van-tabs",{attrs:{animated:""},model:{value:t.tabActive,callback:function(e){t.tabActive=e},expression:"tabActive"}},[i("van-tab",{attrs:{title:"表头"}},[i("van-cell",{staticClass:"info-item",attrs:{title:"机构","value-class":"info-item-value",value:t.data.shopDTO&&t.data.shopDTO.name}}),i("van-cell",{staticClass:"info-item",attrs:{title:"盘点仓库","value-class":"info-item-value",value:t.data.houseDTO&&t.data.houseDTO.name}}),i("van-cell",{staticClass:"info-item",attrs:{title:"系统单号","value-class":"info-item-value",value:t.data.sysbillCode}}),i("van-cell",{staticClass:"info-item",attrs:{title:"盘点日期",value:t.formatterDate(t.data.businessDate)}}),i("van-pro-field",{staticClass:"info-item",attrs:{label:"手工单号",placeholder:t.isDisabled?"":"请输入手工单号",maxlength:"50","input-align":"right",disabled:t.isDisabled},model:{value:t.data.manualCode,callback:function(e){t.$set(t.data,"manualCode",e)},expression:"data.manualCode"}}),i("van-pro-field",{staticClass:"info-item",attrs:{label:"整单备注",placeholder:t.isDisabled?"":"请输入整单备注","input-align":"right",disabled:t.isDisabled},model:{value:t.data.billMemo,callback:function(e){t.$set(t.data,"billMemo",e)},expression:"data.billMemo"}}),i("van-cell",{staticClass:"info-item",attrs:{title:"称重状态",value:t.weightStateComputed}})],1),i("van-tab",{attrs:{title:"更多"}},[i("van-cell",{staticClass:"info-item",attrs:{title:"制单人",value:t.data.billEmp}}),i("van-cell",{staticClass:"info-item",attrs:{title:"制单日期",value:t.formatterDate(t.data.billDate)}}),i("van-cell",{staticClass:"info-item",attrs:{title:"审核人",value:t.data.checkEmp}}),i("van-cell",{staticClass:"info-item",attrs:{title:"审核日期",value:t.formatterDate(t.data.checkDate)}}),i("van-cell",{staticClass:"info-item",attrs:{title:"盘点方案",value:t.data.planName}}),i("van-cell",{staticClass:"info-item",attrs:{title:"生成方式",value:t.data.hasSumBatch?"合批":"分批"}})],1)],1)],1)],1)],1)},g=[],b=i("4760"),C={name:"orderInfo",components:{stateText:b["a"]},props:{data:{type:Object,default:function(){return{}}},isDisabled:Boolean,collapseDisabled:Boolean},data:function(){return{activeNames:["1"],tabActive:0}},computed:{formatterDate:function(t){var e=this;return function(t){return"number"===typeof t?e.$fxUtils.setDateTime(new Date(t),"时分"):""}},weightStateComputed:function(){var t=["未称重","待称重","称重中","已称重"];return t[this.data.weightState]}},methods:{onEmitClick:function(t){if(this.isDisabled)return!1;this.$emit(t)},closeCollapse:function(){this.activeNames=[]}}},S=C,k=(i("76e7"),i("daf88"),i("2877")),D=Object(k["a"])(S,v,g,!1,null,"fd57ab5e",null),I=D.exports,w=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-item-block fx-shadow-block"},[i("div",{staticClass:"item-title"},[i("span",{staticClass:"title-name"},[t._v("单据明细")]),i("span",{staticClass:"title-count"},[t._v("明细：")]),i("span",[t._v(t._s(t.detailsLength))]),i("i",{directives:[{name:"show",rawName:"v-show",value:t.showAddBtn()&&t.$fxAuth("shopCheckBill.bomCheck")&&t.hasSumBatch,expression:"showAddBtn() && $fxAuth('shopCheckBill.bomCheck') && hasSumBatch"}],staticClass:"title-selectbom-icon title-icon fl-r",on:{click:t.onSelectBomClick}}),i("i",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopCheckBill.bomCheck")&&t.hasSumBatch,expression:"$fxAuth('shopCheckBill.bomCheck') && hasSumBatch"}],staticClass:"title-viewbom-icon title-icon fl-r",on:{click:t.onViewBomClick}}),i("i",{directives:[{name:"show",rawName:"v-show",value:t.showAddBtn()&&t.hasSumBatch,expression:"showAddBtn() && hasSumBatch"}],staticClass:"title-add-icon title-icon fl-r",on:{click:t.onAddClick}}),i("i",{staticClass:"title-search-icon title-icon fl-r",on:{click:t.onSearchClick}}),i("i",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"title-mic-icon title-icon fl-r",on:{click:t.onMicClick}})]),i("div",{ref:"details-content",staticClass:"item-list"},[t._l(t.filteScroll(t.data),function(e){return i("van-swipe-cell",{directives:[{name:"show",rawName:"v-show",value:"del"!==e.changeType,expression:"item.changeType !== 'del'"}],key:e.goodsUUid,ref:"details-row-"+e.goodsUUid,refInFor:!0,staticClass:"item-row",attrs:{"right-width":80,disabled:!t.showAddBtn()||t.focusing}},[i("itemInfoCell",t._g({attrs:{itemData:e,isDisabled:t.isDisabled,disabledEditBtn:t.focusing,isPlan:!!t.planId},on:{"on-item-focus":function(i){return t.onItemFocus(arguments,""+e.goodsUUid)},"on-item-blur":t.onItemBlur}},t.$listeners)),i("div",{staticClass:"item-row-delete",attrs:{slot:"right"},on:{click:function(i){return t.onDeleteClick(e,t.data)}},slot:"right"},[t._v("删除")])],1)}),t.scrollDataEnd!==t.data.length?i("div",{staticClass:"item-row-load"},[t._v("加载中...")]):t._e()],2)])},x=[],y=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-info-cell"},[i("div",{staticClass:"item-img"},[i("img",{attrs:{src:t.comptedItemImgSrc(t.itemData.goodsDTO.imageUrls),onerror:t.$fxCommon.errorImg("item")}})]),i("div",{staticClass:"item-details"},[i("div",{staticClass:"item-name-money"},[i("div",{staticClass:"item-name fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.name))]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopCheckBill.seeCheckMoney"),expression:"$fxAuth('shopCheckBill.seeCheckMoney')"}],staticClass:"item-taxprice fx-ellipsis"},[i("span",[t._v("实盘金额：￥")]),i("span",{directives:[{name:"show",rawName:"v-show",value:t.isDisabled,expression:"isDisabled"}]},[t._v(t._s(t.itemData.checkMoney))])]),i("div",{staticClass:"item-more"},[i("i",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&!t.disabledEditBtn,expression:"!isDisabled && !disabledEditBtn"}],staticClass:"block-item-edit",on:{click:t.onItemEditClick}}),i("i",{directives:[{name:"show",rawName:"v-show",value:t.isDisabled,expression:"isDisabled"}],staticClass:"block-item-watch",on:{click:t.onItemEditClick}})])]),t.$fxSysAuth("shopCheckBill.showUnit2column")&&t.isPlan?i("div",[i("div",{staticClass:"item-amount"},[i("span",[t._v("单位1")]),t.$fxAuth("shopCheckBill.seeAmount")?i("div",[t.isDisabled||t.itemData.isWeightSign&&!t.sysDZCCanModifyAcount||t.itemData.checkUnitDTO&&t.itemData.unit2DTO&&t.itemData.checkUnitDTO.id===t.itemData.unit2DTO.id?i("span",{staticClass:"item-amout-text"},[t._v("\n\t\t\t\t\t\t"+t._s(t.itemData.checkUnitAmount)+"\n\t\t\t\t\t")]):i("w-stepper",{staticClass:"amount-step",attrs:{min:"0",max:t.maxAmount,stepperBtnShow:!1,"input-width":"16vw",intLength:t.numberLength,pointSize:t.sysPointSize},on:{change:t.onAmountChange,focus:t.onFocus,blur:t.onBlur},model:{value:t.itemData.checkUnitAmount,callback:function(e){t.$set(t.itemData,"checkUnitAmount",e)},expression:"itemData.checkUnitAmount"}})],1):t._e(),i("div",{staticClass:"item-unit"},[t.itemData.checkUnitDTO?i("span",{staticClass:"item-unit-text"},[t._v(t._s(t.itemData.checkUnitDTO.name))]):t._e()])]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.itemData.unit2DTO,expression:"itemData.unit2DTO"}],staticClass:"item-amount"},[i("span",[t._v("单位2")]),t.$fxAuth("shopCheckBill.seeAmount")?i("div",[t.isDisabled||t.itemData.isWeightSign&&!t.sysDZCCanModifyAcount?i("span",{staticClass:"item-amout-text"},[t._v(t._s(t.itemData.unit2Amount))]):i("w-stepper",{staticClass:"amount-step",attrs:{min:"0",max:t.maxAmount,stepperBtnShow:!1,"input-width":"16vw",intLength:t.numberLength,pointSize:t.sysPointSize,defaultValue:0},on:{change:t.onAmountChange,blur:t.onBlur},model:{value:t.itemData.unit2Amount,callback:function(e){t.$set(t.itemData,"unit2Amount",e)},expression:"itemData.unit2Amount"}})],1):t._e(),i("div",{staticClass:"item-unit"},[t.itemData.unit2DTO?i("span",{staticClass:"item-unit-text"},[t._v(t._s(t.itemData.unit2DTO.name))]):t._e()])]),i("div",{staticClass:"item-spec fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.spec))])]):i("div",[i("div",{staticClass:"item-amount"},[i("span",[t._v("盘点单位")]),t.$fxAuth("shopCheckBill.seeAmount")?i("div",[t.isDisabled||t.itemData.isWeightSign&&!t.sysDZCCanModifyAcount?i("span",{staticClass:"item-amout-text"},[t._v(t._s(t.itemData.checkUnitAmount))]):i("w-stepper",{staticClass:"amount-step",attrs:{min:"0",max:t.maxAmount,stepperBtnShow:!1,"input-width":"16vw",intLength:t.numberLength,pointSize:t.sysPointSize},on:{change:t.onAmountChange,focus:t.onFocus,blur:t.onBlur},model:{value:t.itemData.checkUnitAmount,callback:function(e){t.$set(t.itemData,"checkUnitAmount",e)},expression:"itemData.checkUnitAmount"}})],1):t._e(),i("div",{staticClass:"item-unit"},[t.itemData.checkUnitDTO?i("span",{staticClass:"item-unit-text"},[t._v(t._s(t.itemData.checkUnitDTO.name))]):t._e()])]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.itemData.planUnitDTO,expression:"itemData.planUnitDTO"}],staticClass:"item-amount"},[t.isPlan?i("span",[t._v("方案单位")]):i("span",[t._v("核算单位")]),t.$fxAuth("shopCheckBill.seeAmount")?i("div",[t.isDisabled||t.itemData.isWeightSign&&!t.sysDZCCanModifyAcount?i("span",{staticClass:"item-amout-text"},[t._v(t._s(t.itemData.planUnitAmount))]):i("w-stepper",{staticClass:"amount-step",attrs:{min:"0",max:t.maxAmount,stepperBtnShow:!1,"input-width":"16vw",intLength:t.numberLength,pointSize:t.sysPointSize,defaultValue:0},on:{change:t.onAmountChange,blur:t.onBlur},model:{value:t.itemData.planUnitAmount,callback:function(e){t.$set(t.itemData,"planUnitAmount",e)},expression:"itemData.planUnitAmount"}})],1):t._e(),i("div",{staticClass:"item-unit"},[t.itemData.planUnitDTO?i("span",{staticClass:"item-unit-text"},[t._v(t._s(t.itemData.planUnitDTO.name))]):t._e()])]),i("div",{staticClass:"item-spec fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.spec))])])])])},B=[],$={name:"itemInfoCell",props:{itemData:{type:Object,default:function(){return{}}},isDisabled:Boolean,disabledEditBtn:Boolean,isPlan:Boolean},computed:Object(m["a"])({},Object(p["c"])({sysPointSize:"sysPointSize",taxes:"taxes",sysDZCCanModifyAcount:function(t){return t.systemParams.sysDZCCanModifyAcount},loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId},numberLength:"numberLength",maxAmount:"maxAmount"}),{comptedItemImgSrc:function(t){return function(t){return t?0===t.length?"":t[0]:""}}}),methods:{onItemEditClick:function(){this.editItem(),this.$emit("on-item-edit",this.itemData)},onAmountChange:function(){this.editItem()},editItem:function(){this.itemData.id&&this.$set(this.itemData,"changeType","edit")},onFocus:function(){this.$emit("on-item-focus")},onBlur:function(){this.$emit("on-item-blur")}}},L=$,T=(i("f823"),Object(k["a"])(L,y,B,!1,null,"f2d49e78",null)),A=T.exports,P=10,O=20,F={name:"orderItem",components:{itemInfoCell:A},props:{data:{type:Array,default:function(){return[]}},isDisabled:Boolean,planId:String,hasSumBatch:Boolean,itemInputFocusing:Boolean},data:function(){return{focusing:!1,dataLength:-1,scrollDataEnd:0,scrollThrottle:this.$fxUtils.throttle()}},mounted:function(){document.querySelector(".item-list").addEventListener("scroll",this.scrollHandle,!0)},destroyed:function(){document.querySelector(".item-list").removeEventListener("scroll",this.scrollHandle)},computed:Object(m["a"])({},Object(p["c"])({loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{detailsLength:function(){return this.data.reduce(function(t,e){return"del"!==e.changeType?t+1:t},0)},showAddBtn:function(){var t=this;return function(){return!(!t.isDisabled&&t.planId||t.isDisabled)}}}),watch:{focusing:function(t){this.$emit("update:itemInputFocusing",t)},data:function(){var t,e=this.data;this.dataLength!==e.length&&(t=e.length>this.scrollDataEnd+O?this.scrollDataEnd+O:e.length,t!==this.scrollDataEnd&&(this.scrollDataEnd=t),this.dataLength=e.length);this.setGoodsUUid(this.data)}},methods:{setGoodsUUid:function(t){var e=this;t.forEach(function(t){t.goodsUUid=e.$fxUtils.createUUID()})},filteScroll:function(t){var e=this;return t.filter(function(t,i){if(i<e.scrollDataEnd){if(!(e.scrollDataEnd>O))return!0;if(e.scrollDataEnd-O-1<i)return!0}})},onAddClick:function(){if(this.isDisabled||this.focusing)return!1;this.$emit("on-add-click")},onSearchClick:function(){if(this.focusing)return!1;this.$emit("on-search-click")},onDeleteClick:function(t,e){if(t.id)this.$set(t,"changeType","del");else{var i=this.data.indexOf(t);e.splice(i,1)}},onItemFocus:function(t,e){this.focusing=!0},onItemBlur:function(){this.focusing=!1},onMicClick:function(){this.$emit("on-mic-click")},scrollHandle:function(){var t=this;this.data.length<=O||this.scrollThrottle(10).then(function(){t.setScrollHandle()})},setScrollHandle:function(){var t=this,e=2,i=3,n=document.getElementsByClassName("item-list")[0],s=n.clientHeight,a=n.scrollTop,o=this.data[this.scrollDataEnd-e].goodsUUid,c=this.scrollDataEnd-O+i,r=this.$refs["details-row-".concat(o)][0].$el.offsetTop,l=this.filteScroll(this.data)[e].goodsUUid,h=this.$refs["details-row-".concat(l)][0].$el.offsetTop;a+s>=r&&this.scrollDataEnd!==this.data.length?(this.data.length>this.scrollDataEnd+P?this.scrollDataEnd=this.scrollDataEnd+P:this.scrollDataEnd=this.data.length,this.$nextTick(function(){n.scrollTop=t.$refs["details-row-".concat(o)][0].$el.offsetTop-(r-a)})):a<=h&&c>i&&(this.scrollDataEnd=this.scrollDataEnd-P,this.$nextTick(function(){n.scrollTop=t.$refs["details-row-".concat(l)][0].$el.offsetTop-(h-a)}))},onSelectBomClick:function(){if(this.isDisabled||this.focusing)return!1;this.$emit("on-selectbom-click")},onViewBomClick:function(){if(this.focusing)return!1;this.$emit("on-viewbom-click")}}},E=F,_=(i("7c34"),Object(k["a"])(E,w,x,!1,null,"210790bc",null)),N=_.exports,U=i("8741"),R=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"itemRowEdit-popup"},[i("w-header",{attrs:{title:t.currentItemData.goodsDTO.name,leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{ref:"rowEditContent",staticClass:"itemRowEdit-content"},[i("van-cell-group",[i("van-cell",{attrs:{title:"单位",value:t.unitName,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopCheckBill.seeAmount"),expression:"$fxAuth('shopCheckBill.seeAmount')"}],attrs:{title:"账存数量",value:t.currentItemData.accountAmount,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopCheckBill.seeMoney"),expression:"$fxAuth('shopCheckBill.seeMoney')"}],attrs:{title:"账存金额",value:t.currentItemData.accountMoney,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopCheckBill.seeDiffAmount"),expression:"$fxAuth('shopCheckBill.seeDiffAmount')"}],attrs:{title:"差异数量",value:t.showByChecked(t.currentItemData.diffAmount),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopCheckBill.seeCheckOutMoney"),expression:"$fxAuth('shopCheckBill.seeCheckOutMoney')"}],attrs:{title:"盈亏金额",value:t.showByChecked(t.currentItemData.checkInOutMoney),"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"品项编号",value:t.currentItemData.goodsDTO.code,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:!t.hasSumBatch,expression:"!hasSumBatch"}],attrs:{title:"批次号",value:t.currentItemData.batchCode,"value-class":"info-item-value"}}),t.$fxSysAuth("shopCheckBill.viewSync")?i("van-switch-cell",{staticClass:"info-item-value",attrs:{value:t.formatType(t.currentItemData.synStock),disabled:t.isDisabled,title:"同步库存"},on:{input:t.onSynStockInput}}):t._e(),i("van-pro-field",{ref:"memo",attrs:{disabled:t.isDisabled,placeholder:t.setPlaceholder("请输入备注"),label:"备注","input-align":"right"},on:{focus:function(e){return t.onFocus("memo")}},model:{value:t.currentItemData.memo,callback:function(e){t.$set(t.currentItemData,"memo",e)},expression:"currentItemData.memo"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"净重量",value:t.toFixedNumberSize(t.currentItemData.netWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"皮重量",value:t.toFixedNumberSize(t.currentItemData.skinWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"毛重量",value:t.toFixedNumberSize(t.currentItemData.grossWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"称重单位",value:t.currentItemData.weightUnit,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"称重状态",value:t.currentItemData.isWeightSign?"已称重":"未称重","value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"图片",border:!1,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData&&t.currentItemData.images.length,expression:"sysShowDZCData && currentItemData.images.length"}],staticClass:"info-cell-img",attrs:{"value-class":"info-item-img"}},[i("img",{attrs:{src:t.comptedItemImgSrc(t.currentItemData.images)}})])],1)],1),i("div",{staticClass:"itemRowEdit-bottom"},[t.isDisabled?i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onCloseClick}},[t._v("确定")]):i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onConfirmClick}},[t._v("保存")])],1)],1)},H=[],M={name:"itemRowEdit",props:{visibleFlag:Boolean,itemData:{type:Object,default:function(){return{}}},isCheckedBill:Boolean,isDisabled:Boolean,hasSumBatch:Boolean},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},currentItemData:{}}},computed:Object(m["a"])({},Object(p["c"])({sysShowDZCData:function(t){return t.systemParams.sysShowDZCData},sysPointSize:"sysPointSize"}),{unitName:function(){return this.currentItemData.planUnitDTO?this.currentItemData.planUnitDTO.name:this.currentItemData.checkUnitDTO.name},showByChecked:function(t){var e=this;return function(t){return e.isCheckedBill?t:""}},setPlaceholder:function(t){var e=this;return function(t){return e.isDisabled?"":t}},comptedItemImgSrc:function(t){return function(t){return t?0===t.length?"":t[0].imagUrl:""}},formatType:function(t){return function(t){return"1"===t}}}),watch:{visibleFlag:{handler:function(t){t&&(this.currentItemData=JSON.parse(l()(this.itemData)))},immediate:!0}},methods:{toFixedNumberSize:function(t){return c()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onConfirmClick:function(){this.currentItemData.id&&(this.currentItemData.changeType="edit"),this.$emit("on-Confirm",this.currentItemData),this.$emit("update:visibleFlag",!1)},onFocus:function(t){this.onScrollTop(t)},onScrollTop:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,i=this.$refs[t];if(!i||0===i.length)return!1;var n=i.$el.offsetTop,s=this.$refs["rowEditContent"];this.$fxUtils.scrollTopW({offsetTop:n,$el:s,distance:e})},onSynStockInput:function(t){this.currentItemData.synStock=t?"1":"0"}}},q=M,j=(i("0e42"),Object(k["a"])(q,R,H,!1,null,"37c393ec",null)),z=j.exports,W=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"itemMicEditComp-popup"},[n("w-header",{attrs:{title:"语音盘点",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),n("div",{staticClass:"itemMicEditComp-content"},[n("div",{staticClass:"itemMicEditComp-record-message",domProps:{innerHTML:t._s(t.recordMessage)}}),n("img",{staticClass:"itemMicEditComp-record-icon",attrs:{src:i("9909"),alt:""}})]),n("div",{staticClass:"itemMicEditComp-bottom"},[n("button",{staticClass:"record-btn",on:{touchstart:t.onRecordTouchStart,touchend:t.onRecordTouchEnd}},[t._v(t._s(t.recordBtnText))])])],1)},K=[],Z=(i("c5f6"),{name:"itemMicEditComp",props:{visibleFlag:Boolean,shopId:String,billId:String,checkPlanId:String,houseId:String,checkDate:[String,Number]},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},recording:!1,recordSuccessMessage:""}},computed:Object(m["a"])({},Object(p["c"])({loginerId:function(t){return t.loginer.loginerId}}),{recordBtnText:function(){return this.recording?"松开盘点":"按住说话"},recordMessage:function(){return this.recording?"开始录入盘点指令":this.recordSuccessMessage}}),watch:{recording:function(t){t&&(this.recordSuccessMessage="")}},methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onRecordTouchStart:function(){this.recording=!0;var t="intelEDI-".concat((new Date).getTime(),".m4a");this.$fxCordova.media.startRecord({fileName:t})},onRecordTouchEnd:function(){var t=this;this.recording=!1,this.$fxCordova.media.stopRecord().then(function(e){t.uploadAudio(e)}).catch(function(){t.recordSuccessMessage="语音获取失败"})},uploadAudio:function(t){var e=this,i={checkPlanId:this.checkPlanId||"",houseId:this.houseId||"",checkDate:this.$fxUtils.setDateTime(new Date(this.checkDate))||""};this.recordSuccessMessage="盘点语音解析中...";var n="".concat(this.$fxBaseApi.url,"/upload/shops/").concat(this.shopId,"/users/").concat(this.loginerId,"/checkId/").concat(this.billId,"/checkbills");this.$fxHttp.fileTransfer({url:n,fileFullPath:t,params:i}).then(function(t){e.recordSuccessMessage=e.getCheckItemMessage(t.checkBillDetails),e.$emit("on-micAdd-item",t.checkBillDetails)}).catch(function(t){e.recordSuccessMessage=t.message})},getCheckItemMessage:function(t){var e=t[0],i=e.goodsDTO.name,n=e.checkUnitDTO.name,s=e.checkUnitAmount;return"成功盘点".concat(i).concat(s).concat(n)}}}),G=Z,V=(i("1295"),Object(k["a"])(G,W,K,!1,null,"f9a805a2",null)),J=V.exports,Y=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-search-block"},[i("w-header",{attrs:{title:"搜索品项",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{staticClass:"item-search clearfix"},[i("van-search",{attrs:{placeholder:"请输入搜索关键词",shape:"round"},on:{search:t.onConfirmKey},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}})],1),i("div",{ref:"details-content",staticClass:"item-list item-search-list"},t._l(t.filteScroll(t.detailFilter(t.dataList)),function(e){return i("van-swipe-cell",{directives:[{name:"show",rawName:"v-show",value:"del"!==e.changeType,expression:"item.changeType !== 'del'"}],key:e.id,ref:"details-row-"+e.goodsUUid,refInFor:!0,staticClass:"item-row",attrs:{"right-width":80,disabled:!t.showAddBtn()||t.focusing}},[i("itemInfoCell",{attrs:{itemData:e,isDisabled:t.isDisabled,disabledEditBtn:t.focusing,isPlan:!!t.planId},on:{"on-item-edit":t.onSearchItemEdit,"on-item-focus":function(i){return t.onItemFocus(arguments,""+e.goodsUUid)},"on-item-blur":t.onItemBlur}}),i("div",{staticClass:"item-row-delete",attrs:{slot:"right"},on:{click:function(i){return t.onDeleteClick(e,t.data)}},slot:"right"},[t._v("删除")])],1)}),1),i("div",{staticClass:"search-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onSearchConfirm}},[t._v("保存")])],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,isCheckedBill:t.isCheckedBill,isDisabled:t.isDisabled,hasSumBatch:t.hasSumBatch},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1),i("w-action-sheet",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.scanActionShow,expression:"scanActionShow"}],ref:"scanActionSheet",attrs:{actions:t.scanActions},model:{value:t.scanActionShow,callback:function(e){t.scanActionShow=e},expression:"scanActionShow"}})],1)},Q=[],X=(i("28a5"),10),tt=20,et={name:"itemSearchPop",components:{itemInfoCell:A,itemRowEditPop:z},props:{data:{type:Array,default:function(){return[]}},planId:String,isDisabled:Boolean,visibleFlag:Boolean,house:{type:Object,default:function(){return{}}},hasSumBatch:Boolean,isCheckedBill:Boolean},data:function(){return{focusing:!1,leftOptions:{showBackBtn:!0,preventGoBack:!0},dataList:[],searchKey:"",searchScanItem:null,itemRowEditPopShow:!1,itemEditRowData:{},unitActions:[],unitActionShow:!1,scrollDataEnd:0,scrollThrottle:this.$fxUtils.throttle(),dataLength:-1,scanActionShow:!1,scanActions:[{name:"累加数量"},{name:"覆盖数量"}],scanStoreItem:{}}},created:function(){this.isDisabled||this.$fxEventBus.$on("redCode",this.getItemByRedCode)},mounted:function(){document.querySelector(".item-search-list").addEventListener("scroll",this.scrollHandle,!0)},beforeDestroy:function(){this.$fxEventBus.$off("redCode",this.getItemByRedCode),document.querySelector(".item-search-list").removeEventListener("scroll",this.scrollHandle)},watch:{visibleFlag:{handler:function(t){t&&(this.dataList=JSON.parse(l()(this.data)),this.dataLength=this.dataList.length,this.setGoodsUUid(this.dataList),this.resetHandler())},immediate:!0},searchKey:{handler:function(t){t&&this.initScrollData()},immediate:!0},searchScanItem:{handler:function(t){t&&this.initScrollData()},immediate:!0},dataList:function(){var t,e=this.dataList;this.dataLength!==e.length&&(t=e.length>this.scrollDataEnd+tt?this.scrollDataEnd+tt:e.length,t!==this.scrollDataEnd&&(this.scrollDataEnd=t),this.dataLength=e.length)}},computed:Object(m["a"])({},Object(p["c"])({sysPointSize:"sysPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{showAddBtn:function(){var t=this;return function(){return!(!t.isDisabled&&t.planId||t.isDisabled)}}}),methods:{detailFilter:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"code,name,pinYin",n=this.searchScanItem;return t.filter(function(t){return"del"!==t.changeType&&!!i.split(",").find(function(i){if(t.goodsDTO[i].toLowerCase().includes(e.searchKey.toLowerCase()))return!n||!(t.goodsDTO.id!==n.goodsDTO.id||n.batchCode&&n.batchCode!==t.batchCode)})})},resetHandler:function(){this.searchKey="",this.searchScanItem=null,this.initScrollData()},setGoodsUUid:function(t){var e=this;t.forEach(function(t){t.goodsUUid=e.$fxUtils.createUUID()})},initScrollData:function(){var t=this.detailFilter(this.dataList);t.length>this.scrollDataEnd+tt?this.scrollDataEnd=this.scrollDataEnd+tt:this.scrollDataEnd=t.length,this.dataLength=this.dataList.length},filteScroll:function(t){var e=this.scrollDataEnd;return t.filter(function(t,i){if(i<e){if(!(e>tt))return!0;if(e-tt-1<i)return!0}})},onCloseClick:function(){if(this.focusing)return!1;this.$emit("update:visibleFlag",!1)},onDeleteClick:function(t,e){if(t.id)this.$set(t,"changeType","del");else{var i=this.dataList.indexOf(t);e.splice(i,1)}},onItemFocus:function(t,e){this.focusing=!0},onItemBlur:function(){this.focusing=!1},onSearchItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this.dataList.findIndex(function(e){return e.id===t.id});~e&&(this.dataList[e]=t)},onUnitEdit:function(t){var e=this;this.itemEditRowData=t,this.getItemUnit(t.goodsDTO.id).then(function(t){e.unitActions=t,e.unitActionShow=!0})},getItemUnit:function(t){var e=this;return new f.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/shopId/users/userId/goods/").concat(t,"/units"),query:{userId:e.loginerId}}).then(function(t){i(t.units)})})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemEditRowData,i=e.unitDTO,n=i.value/t.value,s=c()(this.$fxUtils.toFixedSHW(e.busUnitAmount*n,this.sysPointSize));e.unitDTO=t,e.busUnitAmount=s,e.id&&(e.changeType="edit")},onSearchConfirm:function(){if(this.focusing)return!1;this.$emit("on-search-confirm",this.dataList),this.$emit("update:visibleFlag",!1)},getItemByRedCode:function(t){var e=this;if(!this.visibleFlag)return!1;t.length<=24?this.onRedCodeHandler(t):this.hasSumBatch||this.getItemByCode(t).then(function(t){if(!t)return e.$fxToast.top("当前仓库无此品项!"),!1;e.scanStoreItem=e.dataList,e.getScanGoodData(t)})},getItemByCode:function(t){var e=this;return new f.a(function(i){var n={qrCodeContent:t,houseId:e.house.id,billType:2,planId:e.planId};e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.shopId,"/users/").concat(e.loginerId,"/getscancodedata"),query:n}).then(function(t){i(t.checkDetailDTO)})})},getScanGoodData:function(t){t.accountMoney=0,this.setScanGood(t)},setScanGood:function(t){var e=this,i=this.scanStoreItem.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id&&"del"!==e.changeType});if(~i){var n=["unitDTO","checkUnitDTO","planUnitDTO"],s=n.find(function(e){return t[e]&&t[e].id}),a=this.scanStoreItem.filter(function(e,i){return t.goodsDTO.id===e.goodsDTO.id&&"del"!==e.changeType&&e[s]&&t[s].id===e[s].id});if(!a.length)return this.$fxToast.fail("不能重复添加品项！"),!1;var o=a.findIndex(function(i){return i.batchCode===t.batchCode&&e.$fxUtils.isDef(i.batchCode)});if(~o){var c=a[o];this.changeScanItem(t,c),this.showCodeItem(c)}else this.addScanItem(t),this.showCodeItem(t),this.$fxToast.success("追加成功！")}else this.scanPushItem(t),this.showCodeItem(t),this.$fxToast.success("扫码添加品项成功！")},computedScanItemAmount:function(t,e){var i=["checkUnitAmount","planUnitAmount"],n=i.find(function(e){return null!==t[e]}),s=this.toFixedNumberSize(t[n]+e[n]);t[n]=this.$fxCommon.checkAmountRange(s)},changeScanItem:function(t,e){e.accountAmount=t.accountAmount,e.accountMoney=0,e.batchCode=t.batchCode,this.setChangeType(e)},addScanItem:function(t){t.id="",this.setChangeType(t),this.dataList.push(t)},setChangeType:function(t){t.id?this.$set(t,"changeType","edit"):this.$set(t,"changeType","add")},copyScanGood:function(t,e){var i=t.batchCode,n=this.$fxUtils.JSONcopy(e);return n.batchCode=i,n},scanPushItem:function(t){var e=t;this.dataList.push(e),this.setChangeType(e)},onRedCodeHandler:function(t){var e=this;if(!this.visibleFlag)return!1;this.getItemByRedCodeHandler(t).then(function(t){var i=t.billAndDetails[0];if(0===i.length)return e.$fxToast.top("当前仓库无此品项!"),!1;var n=e.dataList.find(function(t){return t.goodsDTO.id===i.goodsDTO.id&&"del"!==t.changeType});n?(e.showCodeItem(i),e.itemUpdate(i,n)):e.$fxToast.top("无此品项!")})},itemUpdate:function(t,e){if(!e){var i=this.$fxUtils.appointedMap(this.dataList,function(e,i){if(e.goodsDTO.id===t.goodsDTO.id&&"del"!==e.changeType)return i});if(1!==i.length||!this.dataList[i[0]].id)return!1;e=this.dataList[i[0]]}e.id&&this.$set(e,"changeType","edit")},getItemByRedCodeHandler:function(t){var e=this;return new f.a(function(i){var n={m:"getGoodsByBarCode4Modify",barCodes:t};e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/users/").concat(e.loginerId,"/goods"),data:n}).then(function(t){i(t)})})},showCodeItem:function(t){this.searchScanItem=t},onConfirmKey:function(){""===this.searchKey&&this.resetHandler()},toFixedNumberSize:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sysPointSize;return c()(this.$fxUtils.toFixedSHW(t,e))},scrollHandle:function(){var t=this;this.detailFilter(this.dataList).length<=tt||this.scrollThrottle(10).then(function(){t.setScrollHandle()})},setScrollHandle:function(){var t=this,e=2,i=3,n=document.getElementsByClassName("item-search-list")[0],s=n.clientHeight,a=n.scrollTop,o=this.detailFilter(this.dataList)[this.scrollDataEnd-e].goodsUUid,c=this.scrollDataEnd-tt+i,r=this.$refs["details-row-".concat(o)][0].$el.offsetTop,l=this.filteScroll(this.detailFilter(this.dataList))[e].goodsUUid,h=this.$refs["details-row-".concat(l)][0].$el.offsetTop;a+s>=r&&this.scrollDataEnd!==this.detailFilter(this.dataList).length?(this.detailFilter(this.dataList).length>this.scrollDataEnd+X?this.scrollDataEnd=this.scrollDataEnd+X:this.scrollDataEnd=this.detailFilter(this.dataList).length,this.$nextTick(function(){n.scrollTop=t.$refs["details-row-".concat(o)][0].$el.offsetTop-(r-a)})):a<=h&&c>i&&(this.scrollDataEnd=this.scrollDataEnd-X,this.$nextTick(function(){n.scrollTop=t.$refs["details-row-".concat(l)][0].$el.offsetTop-(h-a)}))}}},it=et,nt=(i("86b8"),Object(k["a"])(it,Y,Q,!1,null,"d98fb3fe",null)),st=nt.exports,at=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-edit"},[i("w-header",{attrs:{title:"选择成品BOM",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}},[i("van-icon",{staticClass:"header-confirm-btn",attrs:{slot:"header-right",name:"success"},on:{click:t.onItemConfirm},slot:"header-right"})],1),i("div",{staticClass:"item-search clearfix"},[i("van-search",{attrs:{placeholder:"请输入搜索关键词",shape:"round"},on:{search:t.search,focus:t.onSearchFocus},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}})],1),i("div",{staticClass:"item-edit-content"},[i("addItemClassList",{attrs:{itemClassList:t.itemClassList},on:{"on-change-class":t.changeClass},model:{value:t.currentClass,callback:function(e){t.currentClass=e},expression:"currentClass"}}),i("addItemList",{ref:"addItemList",attrs:{listLoading:t.listLoading,loadFinished:t.loadFinished,itemList:t.itemList},on:{"update:listLoading":function(e){t.listLoading=e},"update:list-loading":function(e){t.listLoading=e},"on-load-more":t.onLoadMore},scopedSlots:t._u([{key:"item-cell",fn:function(e){return[i("addItemCell",{attrs:{itemData:e.$item,itemIndex:e.$index,rowActive:t.rowActive,itemAmoutName:"bomAmount"},on:{"on-item-click":t.onItemEdit,"on-checkbox-click":t.clickCheckBoxes}})]}}]),model:{value:t.rowActive,callback:function(e){t.rowActive=e},expression:"rowActive"}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.numberKeyboardShow,expression:"numberKeyboardShow"}],staticClass:"details-number-keyboard"},[i("itemNumberKeyboard",{attrs:{title:t.keyboardTitleCompted,otherTitle:t.keyboardBomTitleCompted,unit:t.keyboardUnitCompted,unitEdit:!1,amount:t.keyboardAmountCompted,pointSize:t.sysPointSize,intLength:t.numberLength},on:{change:t.onKeyboardChange,"on-othertitle-edit":t.onOtherTitleClick,pre:t.onKeyboardPre,next:t.onKeyboardNext,hide:t.onKeyboardHide}})],1),i("van-actionsheet",{attrs:{actions:t.bomActions,"cancel-text":"取消"},on:{select:t.onBomSelect},model:{value:t.bomActionShow,callback:function(e){t.bomActionShow=e},expression:"bomActionShow"}})],1)},ot=[],ct=i("768b"),rt=i("d444"),lt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"details-content",staticClass:"item-details-content"},[i("van-list",{attrs:{finished:t.loadFinished,"finished-text":"没有更多了",error:t.listError,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.listError=e},load:t.onLoadMore},model:{value:t.currentListLoading,callback:function(e){t.currentListLoading=e},expression:"currentListLoading"}},t._l(t.itemList,function(e,n){return i("div",{key:e.goods.id,ref:"details-row-"+n,refInFor:!0,staticClass:"item-detail"},[t._t("item-cell",null,{$item:e,$index:n})],2)}),0)],1)},ht=[],ut={name:"bomAddItemList",props:{value:[String,Number],itemList:{type:Array,default:function(){return[]}},listLoading:Boolean,loadFinished:Boolean,listError:{type:Boolean,default:!1}},data:function(){return{activeNames:[],currentListLoading:!1}},watch:{listLoading:{handler:function(t){this.currentListLoading=t},immediate:!0},currentListLoading:function(t){this.$emit("update:listLoading",t)}},computed:{comptedItemImgSrc:function(t){return function(t){return 0===t.length?"":t[0]}}},methods:{onLoadMore:function(){this.$emit("on-load-more")},onSelectLetter:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40,i=this.$refs["details-row-".concat(t)];if(!i||0===i.length)return!1;var n=i[0].offsetTop,s=this.$refs["details-content"];this.$fxUtils.scrollTopW({offsetTop:n,$el:s,distance:e})}}},dt=ut,ft=(i("5fe1"),Object(k["a"])(dt,lt,ht,!1,null,"775e24ef",null)),mt=ft.exports,pt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-detail-cell",class:{"is-active":t.rowActive===t.itemIndex,"is-error":t.isError},on:{click:t.onItemClick}},[i("div",{staticClass:"item-details-img"},[i("img",{attrs:{src:t.comptedItemImgSrc(t.itemData.goods.imageUrls),onerror:t.$fxCommon.errorImg("item")}})]),i("div",{staticClass:"item-details-params"},[i("div",{staticClass:"item-details-name fx-ellipsis"},[t._v(t._s(t.itemData.goods.name))]),i("div",{staticClass:"item-details-spec fx-ellipsis"},[t._v("\n\t\t\t"+t._s(t.itemData.name)+"\n\t\t")]),i("div",{staticClass:"item-details-amount"},[i("span",{staticClass:"item-details-count"},[t._v(t._s(t.getItemAmount()))]),i("span",{staticClass:"item-details-unit"},[t._v(t._s(t.itemData.unit.name))])]),i("i",{directives:[{name:"show",rawName:"v-show",value:t.getItemAmount()>0||t.isActive,expression:"(getItemAmount()>0 || isActive)"}],staticClass:"item-selected-icon"})]),i("van-checkbox",{staticClass:"item-checkbox",on:{click:function(e){return t.clickCheckBoxes()}},model:{value:t.itemData.checked,callback:function(e){t.$set(t.itemData,"checked",e)},expression:"itemData.checked"}})],1)},vt=[],gt={name:"bomAddItemCell",props:{itemData:{type:Object,default:function(){return{}}},itemIndex:Number,rowActive:[Number,String],isActive:Boolean,isError:Boolean,showSpec:{type:Boolean,default:!0},itemAmoutName:{type:String,default:""}},computed:{comptedItemImgSrc:function(t){return function(t){return t?0===t.length?"":t[0]:""}}},methods:{onItemClick:function(){this.$emit("on-item-click",this.itemIndex)},getItemAmount:function(){return""===this.itemAmoutName?this.itemData.busUnitAmount:this.itemData[this.itemAmoutName]},clickCheckBoxes:function(){this.$emit("on-checkbox-click",this.itemData)}}},bt=gt,Ct=(i("51b5"),Object(k["a"])(bt,pt,vt,!1,null,"278a381e",null)),St=Ct.exports,kt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-number-keyboard fx-shadow-up"},[i("div",{staticClass:"number-keyboard-title"},[i("div",{staticClass:"title-name fx-ellipsis"},[t._v(t._s(t.title))]),i("div",{staticClass:"title-amount"},[t._v(t._s(t.amount))]),i("div",{staticClass:"title-unit",on:{click:t.onUnitClick}},[i("span",{staticClass:"title-unit-text fx-ellipsis"},[t._v(t._s(t.unit))]),i("i",{directives:[{name:"show",rawName:"v-show",value:t.unitEdit,expression:"unitEdit"}],staticClass:"title-unit-select"})])]),i("div",{staticClass:"number-keyboard-title"},[i("div",{staticClass:"title-name fx-ellipsis",on:{click:t.onOtherTitleClick}},[t._v(t._s(t.otherTitle))])]),i("div",{staticClass:"number-keyboard-content"},[i("div",{staticClass:"keyboard-number"},[i("div",{staticClass:"keyboard-number-row"},[i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("1")}}},[t._v("1")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("2")}}},[t._v("2")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("3")}}},[t._v("3")]),i("i",{staticClass:"keyboard-btn-1 keyboard-btn-hide fx-Pseudo-btn",on:{click:t.hideKeyboardBtnClick}})]),i("div",{staticClass:"keyboard-number-row"},[i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("4")}}},[t._v("4")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("5")}}},[t._v("5")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("6")}}},[t._v("6")]),i("i",{staticClass:"keyboard-btn-1 keyboard-btn-del fx-Pseudo-btn",on:{click:t.delBtnClick}})]),i("div",{staticClass:"keyboard-number-row"},[i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("7")}}},[t._v("7")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("8")}}},[t._v("8")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("9")}}},[t._v("9")]),i("i",{staticClass:"keyboard-btn-1 keyboard-btn-pre fx-Pseudo-btn",on:{click:t.preBtnClick}},[t._v("上一个")])]),i("div",{staticClass:"keyboard-number-row"},[i("i",{staticClass:"keyboard-btn-2 keyboard-btn-zero fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("0")}}},[t._v("0")]),i("i",{staticClass:"keyboard-btn-1 keyboard-btn-dot fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick(".")}}},[t._v(".")]),i("i",{staticClass:"keyboard-btn-1 keyboard-btn-next fx-Pseudo-btn",on:{click:t.nextBtnClick}},[t._v("下一个")])])])])])},Dt=[],It=(i("3b2b"),{name:"BomItemNumberKeyboard",props:{otherTitle:String,title:String,unit:String,amount:[String,Number],unitEdit:{type:Boolean,default:!1},integer:Boolean,pointSize:{type:[String,Number],default:4},intLength:{type:[String,Number],default:8}},computed:{computedNumberReg:function(){return new RegExp("^\\d+(\\.|\\.\\d{1,".concat(this.pointSize-1,"})?$"))}},methods:{numberBtnClick:function(t){this.$emit("input",t),this.$emit("change",this.getAddValue(t))},delBtnClick:function(t){this.$emit("delete"),this.$emit("change",this.getDelValue(t))},preBtnClick:function(){this.$emit("pre")},nextBtnClick:function(){this.$emit("next")},hideKeyboardBtnClick:function(){this.$emit("hide")},onUnitClick:function(){this.$emit("on-unit-unitEdit")},onOtherTitleClick:function(){this.$emit("on-othertitle-edit")},getAddValue:function(t){var e=this.amount+"";return-1===e.indexOf(".")&&e.length>=this.intLength&&"."!==t||-1!==e.indexOf(".")&&("."===t||!this.computedNumberReg.test(e))||"."===t&&this.integer?e:("0"===e&&"."!==t?e=t:e+=t,e)},getDelValue:function(t){var e=this.amount+"";return"0"===e?e:(e=1===e.length?"0":e.substr(0,e.length-1),e)}}}),wt=It,xt=(i("afae"),Object(k["a"])(wt,kt,Dt,!1,null,"5925b05c",null)),yt=xt.exports,Bt=10,$t={name:"itemEditComp",components:{addItemClassList:rt["a"],addItemList:mt,addItemCell:St,itemNumberKeyboard:yt},props:{visibleFlag:Boolean,shopId:{type:String,default:""},orderId:{type:String,default:""}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",currentClass:"",itemClassList:[],itemList:[],numberKeyboardShow:!1,rowActive:"",selectedItemArr:[],itemListStart:0,listLoading:!1,loadFinished:!0,bomActionShow:!1,bomActions:[]}},computed:Object(m["a"])({},Object(p["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",loginerId:function(t){return t.loginer.loginerId}}),{keyboardTitleCompted:function(){if(""===this.rowActive)return"";var t=this.itemList[this.rowActive];return t.goods.name},keyboardBomTitleCompted:function(){if(""===this.rowActive)return"";var t=this.itemList[this.rowActive];return t.name},keyboardUnitCompted:function(){if(""===this.rowActive)return"";var t=this.itemList[this.rowActive];return t.unit.name},keyboardAmountCompted:function(){if(""===this.rowActive)return"0";var t=this.itemList[this.rowActive];return t.bomAmount}}),watch:{visibleFlag:{handler:function(t){t&&this.refresh()},immediate:!0},rowActive:function(t,e){""!==e?(this.numberStringAmount(e),""===t?this.numberKeyboardShow=!1:this.scrollToActive(t)):this.scrollToActive(t)}},methods:{refresh:function(){var t=this;this.searchKey="",this.selectedItemArr=[],this.getItemClass().then(function(e){t.itemClassList=e.goodsTypes,t.currentClass="",t.getItemByClass()})},onCloseClick:function(){this.rowActive="",this.$emit("update:visibleFlag",!1)},onItemConfirm:function(){var t=this;if(!this.selectedItemArr||0===this.selectedItemArr.length)return this.$fxToast.fail("请选择品项!"),!1;this.rowActive="",this.$nextTick(function(){t.$emit("on-bom-confirm",t.selectedItemArr),t.$emit("update:visibleFlag",!1)})},search:function(){this.getItemByClass()},getItemClass:function(){var t=this;return new f.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.inShopId,"/users/").concat(t.loginerId,"/goodTypes")}).then(function(t){e(t)})})},getItem:function(){var t=this;return new f.a(function(e){var i={shopId:t.shopId,paged:!0,start:t.itemListStart,size:Bt,searchText:t.searchKey||"",goodsTypeId:t.currentClass||null};t.$fxHttp.requestPost({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/checkbills/").concat(t.orderId,"/details"),data:i,query:{m:"getProductBomList"}}).then(function(t){t.productBom.forEach(function(t){t.checked=!1}),e(t)})})},getItemByClass:function(){var t=this;this.itemListStart=0,this.getItem().then(function(e){t.itemList=t.setResItem(e.productBom),t.setListLoading(e.productBom.length),t.selectedItemArr.length&&t.checkItem(t.itemList),t.$nextTick(function(){t.$refs.addItemList&&t.$refs.addItemList.onSelectLetter(0,5)})})},onLoadMore:function(){var t=this;this.getItem().then(function(e){var i;(i=t.itemList).push.apply(i,Object(a["a"])(t.setResItem(e.productBom))),t.setListLoading(e.productBom.length),t.selectedItemArr.length&&t.checkItem(e.productBom)})},setResItem:function(t){var e=this;return t.forEach(function(t){var i=e.selectedItemArr.findIndex(function(e){return t.goods.id===e.goods.id});~i?(t.bomAmount=e.selectedItemArr[i].bomAmount,t.name=e.selectedItemArr[i].name,t.id=e.selectedItemArr[i].id):t.bomAmount="0"}),t},setListLoading:function(t){this.listLoading=!1,this.itemListStart+=Bt,this.loadFinished=t<Bt},checkItem:function(t){var e=this;t.forEach(function(t,i){var n=e.selectedItemArr.find(function(e){return e.id===t.id});t.checked=!!n})},changeClass:function(t){var e=Object(ct["a"])(t,2);e[0],e[1];this.searchKey="",this.onKeyboardHide(),this.getItemByClass()},onItemEdit:function(t){this.rowActive=t,this.numberKeyboardShow=!0},onKeyboardChange:function(t){this.itemList[this.rowActive].bomAmount=t,t>=0?(this.itemList[this.rowActive].checked=!0,this.clickCheckBoxes(this.itemList[this.rowActive])):this.itemList[this.rowActive].checked=!1},numberStringAmount:function(t){var e=c()(this.itemList[t].bomAmount);this.itemList[t].bomAmount=e},onKeyboardPre:function(){if(!this.rowActive)return!1;this.rowActive--},onKeyboardNext:function(){if(""===this.rowActive||this.rowActive===this.itemList.length-1)return!1;this.rowActive++},onKeyboardHide:function(){this.rowActive=""},scrollToActive:function(t){var e=this;this.$nextTick(function(){e.$refs.addItemList.onSelectLetter(t,20)})},onSearchFocus:function(){this.rowActive=""},onOtherTitleClick:function(){var t=this,e=this.itemList[this.rowActive].goods.id;this.getBom(e).then(function(e){t.bomActions=e.productBom,t.bomActionShow=!0})},getBom:function(t){var e=this;return new f.a(function(i){var n={shopId:e.shopId,goodsId:t};e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.shopId,"/checkbills/").concat(e.orderId,"/details"),data:n,query:{m:"getProductBom"}}).then(function(t){i(t)})})},onBomSelect:function(t){this.bomActionShow=!1;var e=this.itemList[this.rowActive];e.name=t.name,e.id=t.id,e.unit=t.unit},clickCheckBoxes:function(t){t.checked?~this.getSelectItemIndex(t)||this.selectedItemArr.push(t):this.selectedItemArr.splice(this.getSelectItemIndex(t),1)},getSelectItemIndex:function(t){return this.selectedItemArr.findIndex(function(e){return e.id===t.id})}}},Lt=$t,Tt=(i("b5bc"),Object(k["a"])(Lt,at,ot,!1,null,"cce7f8c6",null)),At=Tt.exports,Pt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-search-block"},[i("w-header",{attrs:{title:"搜索品项",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{staticClass:"item-search clearfix"},[i("van-search",{attrs:{placeholder:"请输入搜索关键词",shape:"round"},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}})],1),i("div",{ref:"details-content",staticClass:"item-list bom-search-list"},t._l(t.filteScroll(t.detailFilter(t.data)),function(t){return i("div",{directives:[{name:"show",rawName:"v-show",value:"del"!==t.changeType,expression:"item.changeType !== 'del'"}],key:t.id,ref:"details-row-"+t.goods.id,refInFor:!0,staticClass:"item-row"},[i("bomInfoCell",{attrs:{itemData:t}})],1)}),0)],1)},Ot=[],Ft=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-info-cell"},[i("div",{staticClass:"item-img"},[i("img",{attrs:{src:t.comptedItemImgSrc(t.itemData.goods.imageUrls),onerror:t.$fxCommon.errorImg("item")}})]),i("div",{staticClass:"item-details"},[i("div",{staticClass:"item-name-money"},[i("div",{staticClass:"item-name fx-ellipsis"},[t._v(t._s(t.itemData.goods.name))])]),i("div",{staticClass:"item-row"},[i("span",[t._v(t._s(t.itemData.bomName))])]),i("div",{staticClass:"item-row item-amount"},[i("span",[t._v(t._s(t.itemData.bomAmount))]),i("span",{staticClass:"item-unit-text"},[t._v(t._s(t.itemData.unit.name))])])])])},Et=[],_t={name:"bomInfoCell",props:{itemData:{type:Object,default:function(){return{}}}},computed:{comptedItemImgSrc:function(t){return function(t){return t?0===t.length?"":t[0]:""}}},methods:{}},Nt=_t,Ut=(i("7d8d"),Object(k["a"])(Nt,Ft,Et,!1,null,"2bd279a9",null)),Rt=Ut.exports,Ht=10,Mt=20,qt={name:"bomSearchPop",components:{bomInfoCell:Rt},props:{data:{type:Array,default:function(){return[]}},visibleFlag:Boolean,searchKeywords:String},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",scrollDataEnd:0,scrollThrottle:this.$fxUtils.throttle()}},mounted:function(){document.querySelector(".bom-search-list").addEventListener("scroll",this.scrollHandle,!0)},destroyed:function(){document.querySelector(".bom-search-list").removeEventListener("scroll",this.scrollHandle)},watch:{visibleFlag:{handler:function(t){if(t){var e=this.detailFilter(this.data);e.length>this.scrollDataEnd+Mt?this.scrollDataEnd=this.scrollDataEnd+Mt:this.scrollDataEnd=e.length,this.searchKey=""}},immediate:!0}},methods:{detailFilter:function(t){var e=this;return t.filter(function(t){return!!e.searchKeywords.split(",").find(function(i){if(t.goods[i].toLowerCase().includes(e.searchKey.toLowerCase()))return!0})})},filteScroll:function(t){var e=this;return t.filter(function(t,i){if(i<e.scrollDataEnd){if(!(e.scrollDataEnd>Mt))return!0;if(e.scrollDataEnd-Mt-1<i)return!0}})},onCloseClick:function(){this.$emit("update:visibleFlag",!1)},scrollHandle:function(){var t=this;this.detailFilter(this.data).length<=Mt||this.scrollThrottle(10).then(function(){t.setScrollHandle()})},setScrollHandle:function(){var t=this,e=2,i=3,n=document.getElementsByClassName("bom-search-list")[0],s=n.clientHeight,a=n.scrollTop,o=this.detailFilter(this.data)[this.scrollDataEnd-e].goods.id,c=this.scrollDataEnd-Mt+i,r=this.$refs["details-row-".concat(o)][0].$el.offsetTop,l=this.filteScroll(this.detailFilter(this.data))[e].goods.id,h=this.$refs["details-row-".concat(l)][0].$el.offsetTop;a+s>=r&&this.scrollDataEnd!==this.detailFilter(this.data).length?(this.detailFilter(this.data).length>this.scrollDataEnd+Ht?this.scrollDataEnd=this.scrollDataEnd+Ht:this.scrollDataEnd=this.detailFilter(this.data).length,this.$nextTick(function(){n.scrollTop=t.$refs["details-row-".concat(o)][0].$el.offsetTop-(r-a)})):a<=h&&c>i&&(this.scrollDataEnd=this.scrollDataEnd-Ht,this.$nextTick(function(){n.scrollTop=t.$refs["details-row-".concat(l)][0].$el.offsetTop-(h-a)}))}}},jt=qt,zt=(i("cd09"),Object(k["a"])(jt,Pt,Ot,!1,null,"d3c1107a",null)),Wt=zt.exports,Kt={name:"checkBillDetails",components:{orderInfo:I,orderItem:N,itemEditComp:U["a"],itemRowEditPop:z,itemMicEditComp:J,itemSearchPop:st,bomEditComp:At,bomSearchPop:Wt},data:function(){return{query:this.$route.query,activeNames:["1"],tabActive:"选项1",orderInfoData:{},orderItemList:[],orderBomItemList:[],storeItem:{},itemPopShow:!1,bomPopShow:!1,itemEditRowData:{},itemRowEditPopShow:!1,itemInputFocusing:!1,orderDeleteFlag:!1,itemMicEditPopShow:!1,itemSearchPopShow:!1,searchItem:[],bomSearchPopShow:!1,searchBom:[]}},created:function(){this.createOrderDetails()},beforeRouteLeave:function(t,e,i){var n=this;if(this.itemInputFocusing)return this.$router.go(1),!1;"/checkBill"!==t.path||this.orderDeleteFlag||0!==this.orderInfoData.billState?i():this.$dialog.confirm({title:"提示",message:"若已修改,请先保存单据<br/>是否关闭页面?"}).then(function(){i()}).catch(function(){return n.$router.go(1),!1})},computed:Object(m["a"])({},Object(p["c"])({sysPointSize:"sysPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId},sysDZCManyLower:function(t){return t.systemParams.sysDZCManyLower}}),{isBillState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.billState):e.orderInfoData.billState===t}},isBillReState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.billReState):e.orderInfoData.billReState===t}},isWeightState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.weightState):e.orderInfoData.weightState===t}}}),methods:{createOrderDetails:function(){var t=this;return new f.a(function(e){t.getOrderDetails().then(function(i){var n=i.checkBills[0];t.orderInfoData=n,t.orderItemList=t.setDataToFixedSize(n.details),n.billBom&&n.billBom.length&&(t.orderBomItemList=n.billBom),e()})})},getOrderDetails:function(){var t=this;return new f.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/checkbills/").concat(t.query.orderId,"/users/").concat(t.loginerId)}).then(function(t){e(t)})})},onSaveClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要保存该单据吗?"}).then(function(){t.checkHasDetails().then(function(){t.saveBill()})}).catch(function(){})},saveBill:function(){var t=this;return new f.a(function(e){var i=t.getSaveParams();t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/checkbills/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:i,query:{m:"modify"}}).then(function(i){t.createOrderDetails().then(function(){t.$fxToast.success("保存成功"),e()})})})},onExpressClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要审核该单据吗?"}).then(function(){t.checkHasDetails().then(function(){var e=t.getSaveParams();t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/checkbills/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:e,query:{m:"editAndCheck"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("审核成功")})})})}).catch(function(){})},onUnExpressClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要反审该单据吗?"}).then(function(){var e=t.getSaveParams();if(!e)return!1;t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/checkbills/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:e,query:{m:"unCheck"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("反审成功")})})}).catch(function(){})},onBillReStateClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要复审该单据吗?"}).then(function(){var e=t.getSaveParams();if(!e)return!1;t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/checkbills/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:e,query:{m:"reCheck"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("复审成功")})})}).catch(function(){})},onUnBillReStateClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要取消复审该单据吗?"}).then(function(){var e=t.getSaveParams();if(!e)return!1;t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/checkbills/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:e,query:{m:"unReCheck"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("取消复审成功")})})}).catch(function(){})},onRefreshAccountsClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要刷新账存吗?"}).then(function(){t.checkHasDetails().then(function(){t.saveBill().then(function(e){var i=t.getSaveParams();if(!i)return!1;t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/checkbills/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:i,query:{m:"refreshBill"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("刷新账存成功")})})})})}).catch(function(){})},onDelBillClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要删除单据吗?"}).then(function(){t.$fxHttp.requestDel({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/checkbills/").concat(t.query.orderId,"/users/").concat(t.loginerId)}).then(function(e){t.$fxToast.success("删除成功！").then(function(){t.orderDeleteFlag=!0,t.$router.go(-1)})})}).catch(function(){})},onWeightClick:function(){var t=this;this.checkHasDetails().then(function(){t.$dialog.confirm({title:"提示",message:"确定要下发称重吗?"}).then(function(){var e=t.getSaveParams();if(!e)return!1;t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/checkbills/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:e,query:{userId:t.loginerId,m:"weighBill"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("下发称重成功")})})}).catch(function(){})})},onUnWeightClick:function(){var t=this;this.checkHasDetails().then(function(){var e="确定要取消称重吗?";2===t.orderInfoData.weighState&&(e="称重中的单据，取消称重后电子秤可以继续称重并传回数据！确定要取消称重吗"),t.$dialog.confirm({title:"提示",message:e}).then(function(){t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/checkbills/").concat(t.query.orderId,"/users/").concat(t.loginerId),query:{userId:t.loginerId,m:"unWeighBill"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("取消称重成功")})})}).catch(function(){})})},onEndWeightClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"结束称重后将不再接收此单据的称重数据"}).then(function(){t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/checkbills/").concat(t.query.orderId,"/users/").concat(t.loginerId),query:{userId:t.loginerId,m:"endWeighBill"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("结束称重成功")})})}).catch(function(){})},onClickHandler:function(t){if(this.itemInputFocusing)return!1;this[t]()},getSaveParams:function(){var t=this.orderItemList.filter(function(t){return"edit"===t.changeType}),e=this.orderItemList.filter(function(t){return"add"===t.changeType}),i=this.orderItemList.filter(function(t){return"del"===t.changeType}),n=u()(this.orderInfoData,{detailDel:i.length>0?i:null,detailMdf:t,detailAdd:e,details:[],billBom:this.orderBomItemList});return n},getValidItem:function(){var t=this.orderItemList;return t.filter(function(t){return"del"!==t.changeType})},getItemLength:function(){return this.getValidItem().length},checkHasDetails:function(){var t=this;return new f.a(function(e){0===t.getItemLength()?t.$fxToast.fail("单据明细不能为空"):e()})},onAddClick:function(){this.storeItem=JSON.parse(l()(this.orderItemList)),this.itemPopShow=!0},onConfirm:function(t){var e=this;this.itemPopShow=!1,this.getSelectItemUnit(t).then(function(t){t.checkBillDetails.forEach(function(t){t.changeType="add"}),e.orderItemList=e.orderItemList.concat(t.checkBillDetails)})},getSelectItemUnit:function(t){var e=this,i=[];return t.forEach(function(t){var n={billId:e.query.orderId,goodsDTO:{id:t.id},houseId:e.orderInfoData.houseDTO.id,workDate:e.orderInfoData.businessDate};i.push(n)}),new f.a(function(t){e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/checkbills/").concat(e.query.orderId,"/details"),data:i}).then(function(e){t(e)})})},onItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this.orderItemList.findIndex(function(e){return e.id===t.id});~e&&(this.orderItemList[e]=t)},setDataToFixedSize:function(t){var e=this;return t.forEach(function(t){t.accountMoney=e.toFixedNumberSize(t.accountMoney),t.accountAmount=e.toFixedNumberSize(t.accountAmount),t.seeDiffAmount=e.toFixedNumberSize(t.seeDiffAmount),t.checkUnitAmount=e.toFixedNumberSize(t.checkUnitAmount),t.planUnitAmount=e.toFixedNumberSize(t.planUnitAmount),t.checkInOutMoney=e.toFixedNumberSize(t.checkInOutMoney),t.diffAmount=e.toFixedNumberSize(t.diffAmount),t.checkMoney=e.toFixedNumberSize(t.checkMoney),t.unit2Amount=e.toFixedNumberSize(t.unit2Amount)}),t},toFixedNumberSize:function(t){return c()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},onItemFocus:function(){this.$refs.orderInfo.closeCollapse()},onMicClick:function(){this.itemMicEditPopShow=!0},onMicAddItem:function(t){var e,i=this;t.forEach(function(t,e){var n=i.orderItemList.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id});~n&&(t.id=i.orderItemList[n].id,i.orderItemList.splice(n,1)),t.changeType=t.id?"edit":"add"}),(e=this.orderItemList).push.apply(e,Object(a["a"])(t))},onSearchClick:function(){this.itemSearchPopShow=!0,this.searchItem=JSON.parse(l()(this.orderItemList))},onSearchConfirm:function(t){this.orderItemList=JSON.parse(l()(t))},onSelectBomClick:function(){this.bomPopShow=!0},onViewBomClick:function(){this.searchBom=JSON.parse(l()(this.orderBomItemList)),this.bomSearchPopShow=!0},onBomConfirm:function(t){var e=this;this.bomPopShow=!1,this.getBomItem(t).then(function(t){var i=t.billBom[0].details;i.forEach(function(t){var i=e.orderItemList.find(function(e){return e.goodsDTO.id===t.goodsDTO.id});if(i){if("del"===i.changeType)return;"add"!==i.changeType&&e.$set(i,"changeType","edit"),i.checkUnitAmount=t.checkUnitAmount}else t.changeType="add",e.orderItemList.push(t)}),e.orderBomItemList=t.billBom[0].billBom})},getBomItem:function(t){var e=this;return new f.a(function(i){t.forEach(function(t){t.bomId=t.id,t.bomName=t.name,delete t.checked});var n={houseId:e.orderInfoData.houseDTO.id,workDate:e.orderInfoData.businessDate,bom:t,details:e.orderItemList,billBom:e.orderBomItemList};e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.orderInfoData.shopDTO.id,"/checkbills/").concat(e.orderInfoData.id,"/details"),data:n,query:{m:"checkBillBom"}}).then(function(t){i(t)}).catch(function(t){i(t)})})}}},Zt=Kt,Gt=(i("9a45"),Object(k["a"])(Zt,n,s,!1,null,"3b3ddc68",null));e["default"]=Gt.exports},cac7:function(t,e,i){},cc41:function(t,e,i){"use strict";var n=i("0229"),s=i.n(n);s.a},cd09:function(t,e,i){"use strict";var n=i("c39e"),s=i.n(n);s.a},cf93:function(t,e,i){},d444:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"add-item-class-content fx-vant-class-collapse"},[i("div",{staticClass:"all-class",class:{"is-active":""===t.value},on:{click:function(e){return e.stopPropagation(),t.selectClass("")}}},[t._v(t._s(t.classTitle))]),i("van-collapse",{attrs:{accordion:!0},model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},t._l(t.itemClassList,function(e){return i("van-collapse-item",{key:e.id,attrs:{name:e.id}},[i("div",{staticClass:"big-class",attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),t._l(e.smallType,function(e){return i("van-cell",{key:e.id,staticClass:"small-class",class:{"is-active":t.value===e.id},attrs:{title:e.name},on:{click:function(i){return i.stopPropagation(),t.selectClass(e.id)}}})})],2)}),1)],1)},s=[],a=(i("c5f6"),{name:"addItemClassList",props:{value:[String,Number],itemClassList:{type:Array,default:function(){return[]}},classTitle:{type:String,default:"全部品项"}},data:function(){return{activeNames:[]}},methods:{selectClass:function(t){this.$emit("input",t),this.$emit("on-select-class",t),this.$emit("on-change-class",[t,this.value])}}}),o=a,c=(i("5402"),i("2877")),r=Object(c["a"])(o,n,s,!1,null,"df69e854",null);e["a"]=r.exports},daf88:function(t,e,i){"use strict";var n=i("251a"),s=i.n(n);s.a},e08a:function(t,e,i){},e399:function(t,e,i){},e5de:function(t,e,i){},eb03:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.popupShowFlag,callback:function(e){t.popupShowFlag=e},expression:"popupShowFlag"}},[i("listComp",{attrs:{visibleFlag:t.popupShowFlag,title:t.title,data:t.listData,loadFinished:t.currentLoadFinish,loading:t.onItemLoading},on:{"update:visibleFlag":function(e){t.popupShowFlag=e},"update:visible-flag":function(e){t.popupShowFlag=e},"update:loading":function(e){t.onItemLoading=e},"on-search":t.onSearchHandler,"on-select":t.onSelectHandler,"on-load":t.onListLoad}})],1)},s=[],a=i("75fc"),o=i("795b"),c=i.n(o),r=(i("c5f6"),i("f6bb")),l=50,h={name:"filterListPopup",components:{listComp:r["a"]},props:{value:Boolean,title:String,rollingLoad:Boolean,itemSize:{type:Number,default:l},getDataApi:Function},data:function(){return{popupShowFlag:!1,itemListLoadFinished:!1,onItemLoading:!1,listStart:0,listData:[]}},computed:{currentLoadFinish:function(){return this.itemListLoadFinished||!this.rollingLoad}},watch:{value:{immediate:!0,handler:function(t){var e=this;t&&this.onListRefresh().then(function(){e.$emit("on-show")})}},popupShowFlag:{immediate:!0,handler:function(t){t||this.$emit("input",!1)}}},methods:{onSearchHandler:function(t){this.onListRefresh(t)},onSelectHandler:function(t){this.$emit("on-select",t)},onListRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.listStart=0,new c.a(function(i){t.getDataApi(e,t.listStart,t.itemSize).then(function(e){t.popupShowFlag=!0,t.onItemLoading=!1,t.listStart+=t.itemSize,t.itemListLoadFinished=e.length<t.itemSize,t.listData=e,i()})})},onListLoad:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getDataApi(e,this.listStart,this.itemSize).then(function(e){var i;t.onItemLoading=!1,t.listStart+=t.itemSize,e.length<t.itemSize&&(t.itemListLoadFinished=!0),(i=t.listData).push.apply(i,Object(a["a"])(e))})}}},u=h,d=i("2877"),f=Object(d["a"])(u,n,s,!1,null,null,null);e["a"]=f.exports},eb87:function(t,e,i){"use strict";var n=i("c137"),s=i.n(n);s.a},f6bb:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"shop-popup"},[i("w-header",{attrs:{title:t.title,leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("van-pro-search",{directives:[{name:"show",rawName:"v-show",value:t.searchShow,expression:"searchShow"}],attrs:{shape:"round"},on:{search:t.search},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}}),i("div",{staticClass:"popup-content"},[i("van-list",{attrs:{finished:t.loadFinished,"finished-text":"没有更多了",error:t.listError,"immediate-check":t.immediateCheck,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.listError=e},load:t.onLoad},model:{value:t.listLoading,callback:function(e){t.listLoading=e},expression:"listLoading"}},t._l(t.data,function(e){return i("van-cell",{key:e.id,staticClass:"fx-van-cell",attrs:{title:e.name},on:{click:function(i){return t.indexListClick(e)}}})}),1)],1)],1)},s=[],a={name:"filterPop",props:{loading:Boolean,visibleFlag:Boolean,title:String,data:{type:Array,default:function(){return[]}},searchShow:{type:Boolean,default:!0},loadFinished:Boolean,immediateCheck:{type:Boolean,default:!0}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",listLoading:!1,listError:!1}},watch:{loading:{handler:function(t){t||(this.listLoading=!1)},immediate:!0},visibleFlag:function(t){t&&(this.searchKey="")}},methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},indexListClick:function(t){this.$emit("on-select",t),this.$emit("update:visibleFlag",!1)},search:function(t){this.$emit("on-search",t)},onLoad:function(){this.$emit("update:loading",!0),this.$emit("on-load",this.searchKey||null)}}},o=a,c=(i("8d5d"),i("2877")),r=Object(c["a"])(o,n,s,!1,null,"2a1c11fe",null);e["a"]=r.exports},f823:function(t,e,i){"use strict";var n=i("fe82"),s=i.n(n);s.a},fa8a:function(t,e,i){},faf1:function(t,e,i){"use strict";var n=i("cf93"),s=i.n(n);s.a},fc31:function(t,e,i){},fd07:function(t,e,i){"use strict";var n=i("09b8"),s=i.n(n);s.a},fe82:function(t,e,i){}}]);
//# sourceMappingURL=checkBill.6efded47.js.map