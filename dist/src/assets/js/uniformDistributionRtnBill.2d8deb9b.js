(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["uniformDistributionRtnBill"],{"022e":function(t,e,i){"use strict";var n=i("20e1"),o=i.n(n);o.a},1774:function(t,e,i){},"1f50":function(t,e,i){},"20e1":function(t,e,i){},"20fc":function(t,e,i){},"2ad6":function(t,e,i){},"2e09":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-uniformDistributionRtn-create"},[i("w-header",{attrs:{title:"新增统配退货单",border:!0}}),i("orderInfo",{ref:"orderInfo",attrs:{data:t.orderInfoData,collapseDisabled:t.itemInputFocusing},on:{"on-busdate-click":t.onBusinessDateClick,"on-billType-click":t.onBillTypeClick,"on-rdc-click":t.onRdcClick,"on-shop-click":t.onShopClick,"on-billType-clear":t.onBillTypeClear}}),i("orderItem",{ref:"orderItem",attrs:{data:t.orderItemList,itemInputFocusing:t.itemInputFocusing},on:{"update:itemInputFocusing":function(e){t.itemInputFocusing=e},"update:item-input-focusing":function(e){t.itemInputFocusing=e},"on-import-click":t.onImportClick,"on-search-click":t.onSearchClick,"on-unit-edit":t.onUnitEdit,"on-item-edit":t.onItemEdit,"on-item-focus":t.onItemFocus}}),i("div",{staticClass:"uniformDistributionRtn-bottom"},[i("van-button",{staticClass:"add-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onCreateClick}},[t._v("生成单据")])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.shopPopShow,callback:function(e){t.shopPopShow=e},expression:"shopPopShow"}},[i("listComp",{attrs:{visibleFlag:t.shopPopShow,data:t.shopList,loadFinished:t.shopListLoadFinished,loading:t.onShopLoading,title:"退货机构检索"},on:{"update:visibleFlag":function(e){t.shopPopShow=e},"update:visible-flag":function(e){t.shopPopShow=e},"update:loading":function(e){t.onShopLoading=e},"on-search":t.searchShop,"on-select":t.selectShop,"on-load":t.onShopLoad}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.rdcPopShow,callback:function(e){t.rdcPopShow=e},expression:"rdcPopShow"}},[i("listComp",{attrs:{visibleFlag:t.rdcPopShow,data:t.rdcList,loadFinished:!0,title:"配送中心检索"},on:{"update:visibleFlag":function(e){t.rdcPopShow=e},"update:visible-flag":function(e){t.rdcPopShow=e},"on-search":t.searchRdc,"on-select":t.selectRdc}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.billTypePopShow,callback:function(e){t.billTypePopShow=e},expression:"billTypePopShow"}},[i("listComp",{attrs:{visibleFlag:t.billTypePopShow,data:t.billTypeList,loadFinished:!0,title:"单据类型检索"},on:{"update:visibleFlag":function(e){t.billTypePopShow=e},"update:visible-flag":function(e){t.billTypePopShow=e},"on-search":t.searchBillType,"on-select":t.selectBillType}})],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.importPopShow,callback:function(e){t.importPopShow=e},expression:"importPopShow"}},[i("importBillComp",{attrs:{visibleFlag:t.importPopShow,orderInfo:t.orderInfoData},on:{"update:visibleFlag":function(e){t.importPopShow=e},"update:visible-flag":function(e){t.importPopShow=e},"on-item-import-confirm":t.onImportConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemSearchPopShow,callback:function(e){t.itemSearchPopShow=e},expression:"itemSearchPopShow"}},[i("itemSearchPop",{attrs:{visibleFlag:t.itemSearchPopShow,data:t.searchItem,isDisabled:!t.$fxAuth("uniformDistributionRtnBill.save")},on:{"update:visibleFlag":function(e){t.itemSearchPopShow=e},"update:visible-flag":function(e){t.itemSearchPopShow=e},"on-search-confirm":t.onSearchConfirm}})],1)],1)},o=[],s=(i("20d6"),i("59ad")),a=i.n(s),r=i("5176"),l=i.n(r),c=(i("a481"),i("75fc")),u=i("795b"),d=i.n(u),h=(i("ac6a"),i("f499")),f=i.n(h),p=(i("7514"),i("b6d0")),m=i.n(p),v=i("774e"),g=i.n(v),b=i("cebc"),S=i("2f62"),D=i("ad8c"),w=i("57f6"),I=i("f6bb"),k=i("c0bf"),C=i("95d5d"),x=i("39b8"),y=50,P={name:"createUniformDistributionRtnBill",components:{orderInfo:D["a"],orderItem:w["a"],listComp:I["a"],importBillComp:k["a"],itemRowEditPop:C["a"],itemSearchPop:x["a"]},data:function(){return{query:this.$route.query,activeNames:["1"],tabActive:"选项1",orderInfoData:{accountDTO:{},billEmp:"",billMemo:"",billState:0,businessDate:(new Date).getTime(),details:[],rdcDTO:{},shopDTO:{},businessTypeDTO:{},manualCode:"",updateIndicator:"Append"},orderItemList:[],currentDate:new Date,datePickerShow:!1,rdcPopShow:!1,shopPopShow:!1,billTypePopShow:!1,importPopShow:!1,rdcList:[],shopList:[],billTypeList:[],itemEditRowData:{},itemRowEditPopShow:!1,itemInputFocusing:!1,shopListStart:0,onShopLoading:!1,shopListLoadFinished:!1,itemSearchPopShow:!1,unitActionShow:!1,unitActions:[],searchItem:[]}},created:function(){this.$fxUtils.isEmptyObjSHW(this.$route.params)?this.loginerIsShop&&(this.orderInfoData.shopDTO={id:this.loginerShopId,name:this.loginerShopName}):(this.orderInfoData=this.$route.params,this.orderItemList=this.filterStoreItem(this.orderInfoData.details))},beforeRouteLeave:function(t,e,i){var n=this;if(this.itemInputFocusing)return this.$router.go(1),!1;"/uniformDistributionRtnBill"===t.path?this.$dialog.confirm({title:"提示",message:"若已修改,请先保存单据<br/>是否关闭页面?"}).then(function(){i()}).catch(function(){return n.$router.go(1),!1}):i()},computed:Object(b["a"])({},Object(S["c"])({loginerShopName:function(t){return t.loginer.loginerShopName},loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId},loginerOrganType:function(t){return t.loginer.loginerOrganType},sysPointSize:"sysPointSize"}),{loginerIsShop:function(){return this.$fxStateMiddleware.stateIs("loginerOrganType")("shop")(this.loginerOrganType)}}),methods:{filterStoreItem:function(t){var e=g()(new m.a(t.map(function(t){return t.outHouseDTO.id}))),i=e.map(function(e){var i=t.find(function(t){return t.outHouseDTO.id===e}).outHouseDTO;return i=JSON.parse(f()(i)),i.details=t.filter(function(t){return t.outHouseDTO.id===e}),i});return i},setDetailGoodsUUid:function(t){var e=this;t.forEach(function(t){t.details.forEach(function(t){t.goodsUUid=e.$fxUtils.createUUID()})})},onBusinessDateClick:function(){this.orderInfoData.businessDate&&(this.currentDate=new Date(this.orderInfoData.businessDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){var e=t.getTime();this.orderInfoData.businessDate=e,this.datePickerShow=!1},clearItemConfim:function(t){var e=this;return new d.a(function(i){var n=e.orderItemList.filter(function(t){var e=t.details.filter(function(t){return"del"!==t.changeType});return 0!==e.length});0===n.length?i():e.$dialog.confirm({title:"提示",message:t}).then(function(){e.onItemClear(),i()}).catch(function(){})})},onBillTypeClick:function(){this.onBillTypeRefresh()},searchBillType:function(t){this.onBillTypeRefresh(t)},selectBillType:function(t){this.orderInfoData.businessTypeDTO=t},onBillTypeClear:function(){this.orderInfoData.businessTypeDTO={}},onBillTypeRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getBillTypeListData(e).then(function(e){t.billTypeList=e.businessTypes,t.billTypePopShow=!0})},getBillTypeListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new d.a(function(i){var n={billType:"34_1",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/businessTypes"),data:n}).then(function(t){i(t)})})},onRdcClick:function(){this.onRdcRefresh()},searchRdc:function(t){this.onRdcRefresh(t)},selectRdc:function(t){var e=this;this.checkRdc(t).then(function(){e.clearItemConfim("更换配送中心会清空品项,是否继续?").then(function(){e.orderInfoData.rdcDTO=t})})},checkRdc:function(t){var e=this;return new d.a(function(i){var n=e.orderInfoData.rdcDTO||{};n.id!==t.id&&i()})},onRdcRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getRdcListData(e).then(function(e){t.rdcList=e.shops,t.rdcPopShow=!0})},getRdcListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new d.a(function(i){var n={keyword:e,selAll:"on"};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/rdcs"),data:n}).then(function(t){i(t)})})},onShopClick:function(){this.loginerIsShop||this.onShopRefresh()},searchShop:function(t){this.onShopRefresh(t)},selectShop:function(t){var e=this;this.checkShop(t).then(function(){e.clearItemConfim("更换退货机构会清空品项,是否继续?").then(function(){e.orderInfoData.shopDTO=t})})},checkShop:function(t){var e=this;return new d.a(function(i){var n=e.orderInfoData.shopDTO||{};n.id!==t.id&&i()})},onShopRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.shopListStart=0,this.getShopListData(e).then(function(e){t.shopPopShow=!0,t.onShopLoading=!1,t.shopListStart+=y,e.shops.length<y?t.shopListLoadFinished=!0:t.shopListLoadFinished=!1,t.shopList=e.shops})},onShopLoad:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getShopListData(e).then(function(e){var i;t.onShopLoading=!1,t.shopListStart+=y,e.shops.length<y&&(t.shopListLoadFinished=!0),(i=t.shopList).push.apply(i,Object(c["a"])(e.shops))})},getShopListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new d.a(function(i){var n={start:t.shopListStart,size:y,paged:!0,keyword:e,m:"getShopListForUserhouse",orgFlag:0};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/shops"),data:n}).then(function(t){i(t)})})},onImportClick:function(){var t=this;this.checkOrderInfo().then(function(){var e=t.orderItemList.filter(function(t){var e=t.details.filter(function(t){return"del"!==t.changeType});return 0!==e.length});0!==e.length?t.$dialog.confirm({title:"提示",message:"重新导入单据？会清空明细！"}).then(function(){t.onItemClear(),t.importPopShow=!0}).catch(function(){}):t.importPopShow=!0})},checkOrderInfo:function(){var t=this;return new d.a(function(e){t.orderInfoData.shopDTO.id?t.orderInfoData.rdcDTO.id?e():t.$fxToast.top("请选择配送中心！"):t.$fxToast.top("请选择退货机构！")})},onImportConfirm:function(t){if(0===t.length)return!1;var e=this.orderInfoData.details.filter(function(t){return!!t.id}),i="";e.forEach(function(t){t.changeType="del"}),t.forEach(function(t){i=t.billId,t.changeType="add",t.preDetailId=t.id,t.billId="",t.busUnitOutAmount=t.busUnitInAmount,t.outHouseDTO=t.inHouseDTO,t.outMoney=t.inMoney,t.outMoneyWithTax=t.inMoneyWithTax,t.taxOutMoney=t.taxInMoney,delete t["inHouseDTO"],delete t["id"],delete t["busUnitInAmount"],delete t["inMoney"],delete t["inMoneyWithTax"],delete t["taxInMoney"],delete t["outOrderAmount"]}),e.push.apply(e,Object(c["a"])(t)),this.orderInfoData.details=e,this.orderItemList=this.filterStoreItem(e),this.setDetailGoodsUUid(this.orderItemList),this.orderInfoData.fatherId=i},onCreateClick:function(){var t=this;if(this.itemInputFocusing)return!1;this.$dialog.confirm({title:"提示",message:"确定生成单据吗?"}).then(function(){t.getSaveParams().then(function(e){t.createHandler(e)})}).catch(function(){})},createHandler:function(t){var e=this;this.$fxHttp.requestPost({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/distributionRtn"),data:t}).then(function(t){e.$fxToast.success("生成单据成功").then(function(){e.$router.replace({path:"uniformDistributionRtnBillDetails",query:{orderId:t.storeBills[0].id}})})})},getSaveParams:function(){var t=this;return new d.a(function(e){if(0===t.orderItemList.length)t.onImportClick();else{var i=[];t.orderItemList.forEach(function(t){i.push.apply(i,Object(c["a"])(t.details))});var n=i.filter(function(t){return"add"===t.changeType}),o=l()({},t.orderInfoData,{detailAdd:n,accountDTO:{id:t.loginerId}});e(o)}})},onUnitEdit:function(t){var e=this;this.itemEditRowData=t,this.getItemUnit(t.goodsDTO.id).then(function(t){e.unitActions=t,e.unitActionShow=!0})},getItemUnit:function(t){var e=this;return new d.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/shopId/users/userId/goods/").concat(t,"/units"),query:{userId:e.loginerId}}).then(function(t){i(t.units)})})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemEditRowData,i=e.unitDTO,n=i.value/t.value,o=a()(this.$fxUtils.toFixedSHW(e.busUnitOutAmount*n,this.sysPointSize)),s=a()(this.$fxUtils.toFixedSHW(e.outMoneyWithTax/o,this.sysPointSize)),r=a()(this.$fxUtils.toFixedSHW(e.outMoney/o,this.sysPointSize));e.unitDTO=t,e.busUnitOutAmount=o,e.taxPrice=s,e.price=r,e.id&&(e.changeType="edit")},onItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this.orderItemList.findIndex(function(e){return e.id===t.outHouseDTO.id});if(~e){var i=this.orderItemList[e].details.findIndex(function(e){return e.goodsUUid===t.goodsUUid});~i&&(this.orderItemList[e].details[i]=t)}},onItemClear:function(){this.orderInfoData.details=[],this.orderItemList=this.orderInfoData.details},onItemFocus:function(){this.$refs.orderInfo.closeCollapse()},onSearchClick:function(){this.itemSearchPopShow=!0,this.searchItem=JSON.parse(f()(this.orderItemList))},onSearchConfirm:function(t){this.orderItemList=t}}},T=P,$=(i("ddd3"),i("2877")),B=Object($["a"])(T,n,o,!1,null,"22e80d4b",null);e["default"]=B.exports},"39b8":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-search-block"},[i("w-header",{attrs:{title:"搜索品项",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("searchHead",{attrs:{initSearch:t.visibleFlag,searchKey:t.searchKey,selectActive:t.isSelectAll},on:{"update:searchKey":function(e){t.searchKey=e},"update:search-key":function(e){t.searchKey=e},"on-select-click":t.onSelectAllClick}}),i("div",{ref:"details-content",staticClass:"item-list"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeStoreNames,callback:function(e){t.activeStoreNames=e},expression:"activeStoreNames"}},t._l(t.data,function(e){return i("van-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.$fxCommon.storeFilter(e,t.searchKey),expression:"$fxCommon.storeFilter(storeItem, searchKey)"}],key:e.id,staticClass:"store-row",attrs:{name:e.id}},[i("div",{attrs:{slot:"title"},slot:"title"},[i("span",{staticClass:"item-store-title fx-ellipsis"},[t._v(t._s(e.name))])]),t._l(t.$fxCommon.detailFilter(e.details,t.searchKey),function(n,o){return i("van-swipe-cell",{directives:[{name:"show",rawName:"v-show",value:"del"!==n.changeType,expression:"item.changeType !== 'del'"}],key:""+n.goodsUUid,ref:"details-row-"+e.id+"-"+n.goodsDTO.id,refInFor:!0,staticClass:"item-row",attrs:{"right-width":80,disabled:t.isDisabled||t.focusing}},[i("div",{staticClass:"item-cell"},[i("checkBox",{staticClass:"search-checkbox",attrs:{visibleFlag:!t.isDisabled,checked:n.checked},on:{"on-checkbox-click":function(e){return t.onCheckBoxClick(n)}}}),i("itemInfoCell",{staticClass:"search-info",attrs:{itemData:n,isDisabled:t.isDisabled,disabledEditBtn:t.focusing},on:{"on-item-edit":t.onSearchItemEdit,"on-unit-edit":t.onUnitEdit,"on-item-focus":function(i){return t.onItemFocus(arguments,e.id+"-"+n.goodsDTO.id)},"on-item-blur":t.onItemBlur}})],1),i("div",{staticClass:"item-row-delete",attrs:{slot:"right"},on:{click:function(i){return t.onDeleteClick(n,o,e.details)}},slot:"right"},[t._v("删除")])])})],2)}),1)],1),i("div",{staticClass:"search-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onSearchConfirm}},[t._v("保存")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:t.onSelectConfirm}},[t._v("删除")])],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,isDisabled:t.isDisabled},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1)],1)},o=[],s=(i("7514"),i("59ad")),a=i.n(s),r=i("795b"),l=i.n(r),c=(i("20d6"),i("cebc")),u=(i("ac6a"),i("2f62")),d=i("796c"),h=i("95d5d"),f=i("01db"),p=i("0f38"),m={name:"itemSearchPop",components:{itemInfoCell:d["a"],itemRowEditPop:h["a"],searchHead:f["a"],checkBox:p["a"]},props:{data:{type:Array,default:function(){return[]}},isDisabled:Boolean,visibleFlag:Boolean},data:function(){return{focusing:!1,leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",itemRowEditPopShow:!1,itemEditRowData:{},unitActions:[],unitActionShow:!1,activeStoreNames:[]}},watch:{visibleFlag:{handler:function(t){var e=this;t&&(this.searchKey="",this.showData(this.data),this.data.forEach(function(t){var i=t.details.filter(function(t){return"del"!==t.changeType}).length;i>0&&e.activeStoreNames.push(t.id)}))},immediate:!0}},computed:Object(c["a"])({},Object(u["c"])({sysPointSize:"sysPointSize"}),{isSelectAll:function(){var t=this;if(this.isDisabled)return"";var e=0,i=0;return this.data.forEach(function(n){var o=t.$fxCommon.detailFilter(n.details,t.searchKey);e+=o.filter(function(t){return"del"!==t.changeType&&t.showFlag&&t.checked}).length,i+=o.length}),0!==e&&e===i}}),methods:{onCloseClick:function(){if(this.focusing)return!1;this.$emit("update:visibleFlag",!1)},onDeleteClick:function(t,e,i){t.id?(this.$set(t,"changeType","del"),this.$set(t,"busUnitAmount",0)):i.splice(e,1)},onItemFocus:function(t,e){this.focusing=!0},onItemBlur:function(){this.focusing=!1},onSearchItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this.data.findIndex(function(e){return e.id===t.outHouseDTO.id});if(~e){var i=this.data[e].details.findIndex(function(e){return e.goodsUUid===t.goodsUUid});~i&&(this.data[e].details[i]=t)}},onUnitEdit:function(t){var e=this;this.itemEditRowData=t,this.getItemUnit(t.goodsDTO.id).then(function(t){e.unitActions=t,e.unitActionShow=!0})},getItemUnit:function(t){var e=this;return new l.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/shopId/users/userId/goods/").concat(t,"/units"),query:{userId:e.loginerId}}).then(function(t){i(t.units)})})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemEditRowData,i=e.unitDTO,n=i.value/t.value,o=a()(this.$fxUtils.toFixedSHW(e.busUnitOutAmount*n,this.sysPointSize)),s=a()(this.$fxUtils.toFixedSHW(e.outMoneyWithTax/o,this.sysPointSize)),r=a()(this.$fxUtils.toFixedSHW(e.outMoney/o,this.sysPointSize));e.unitDTO=t,e.busUnitOutAmount=o,e.taxPrice=s,e.price=r,e.id&&(e.changeType="edit")},onCheckBoxClick:function(t){if(this.focusing)return!1;this.$set(t,"checked",!t.checked)},onSelectAllClick:function(){var t=this,e=!this.isSelectAll;this.data.forEach(function(i){var n=t.$fxCommon.detailFilter(i.details,t.searchKey);n.forEach(function(i){"del"!==i.changeType&&t.$set(i,"checked",e)})})},onSelectConfirm:function(){var t=this,e=this.data.find(function(t){return t.details.find(function(t){return t.checked&&"del"!==t.changeType})});if(!e)return this.$fxToast.top("请先选择品项!"),!0;this.$dialog.confirm({title:"提示",message:"是否删除？"}).then(function(){t.data.forEach(function(e){for(var i=e.details,n=i.length-1;n>=0;n--){var o=i[n];o.checked&&(o.id?t.$set(o,"changeType","del"):e.details.splice(n,1))}})})},showData:function(t){var e=this;t.forEach(function(t){t.details.forEach(function(t){e.$set(t,"showFlag",!0)})})},onConfirmKey:function(){""===this.searchKey&&this.showData(this.data)},onSearchConfirm:function(){if(this.focusing)return!1;this.$emit("on-search-confirm",this.data),this.$emit("update:visibleFlag",!1)}}},v=m,g=(i("6f64"),i("2877")),b=Object(g["a"])(v,n,o,!1,null,"81345932",null);e["a"]=b.exports},"4ba8":function(t,e,i){},5135:function(t,e,i){"use strict";var n=i("1f50"),o=i.n(n);o.a},"57f6":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-item-block fx-shadow-block"},[i("div",{staticClass:"item-title"},[i("span",{staticClass:"title-name"},[t._v("单据明细")]),i("span",{staticClass:"title-count"},[t._v("明细：")]),i("span",[t._v(t._s(t.detailsLength))]),i("i",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"title-import-icon fl-r",on:{click:t.onImportClick}}),i("i",{staticClass:"title-search-icon fl-r",on:{click:t.onSearchClick}})]),i("div",{ref:"details-content",staticClass:"item-list"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeStoreNames,callback:function(e){t.activeStoreNames=e},expression:"activeStoreNames"}},t._l(t.data,function(e){return i("van-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.storeShowComputed(e),expression:"storeShowComputed(storeItem)"}],key:e.id,staticClass:"store-row",attrs:{name:e.id}},[i("div",{staticClass:"item-store-title fx-ellipsis",attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),t._l(e.details,function(n,o){return i("van-swipe-cell",{directives:[{name:"show",rawName:"v-show",value:"del"!==n.changeType,expression:"item.changeType !== 'del'"}],key:""+n.goodsUUid,ref:"details-row-"+e.id+"-"+n.goodsDTO.id,refInFor:!0,staticClass:"item-row",attrs:{"right-width":80,disabled:t.isDisabled||t.focusing}},[i("itemInfoCell",t._g({attrs:{itemData:n,isDisabled:t.isDisabled,disabledEditBtn:t.focusing},on:{"on-item-focus":function(i){return t.onItemFocus(arguments,e.id+"-"+n.goodsDTO.id)},"on-item-blur":t.onItemBlur}},t.$listeners)),i("div",{staticClass:"item-row-delete",attrs:{slot:"right"},on:{click:function(i){return t.onDeleteClick(n,o,e.details)}},slot:"right"},[t._v("删除")])],1)})],2)}),1)],1)])},o=[],s=(i("ac6a"),i("796c")),a={name:"orderItem",components:{itemInfoCell:s["a"]},props:{data:{type:Array,default:function(){return[]}},isDisabled:Boolean,itemInputFocusing:Boolean},data:function(){return{focusing:!1,activeStoreNames:[]}},computed:{storeShowComputed:function(t){return function(t){var e=t.details.filter(function(t){return"del"!==t.changeType}).length;return e>0}},detailsLength:function(){return this.data.reduce(function(t,e){var i=e.details.filter(function(t){return"del"!==t.changeType});return t+i.length},0)}},watch:{focusing:function(t){this.$emit("update:itemInputFocusing",t)},data:function(){var t=this;this.data.forEach(function(e){var i=e.details.filter(function(t){return"del"!==t.changeType}).length;i>0&&t.activeStoreNames.push(e.id)})}},methods:{onImportClick:function(){if(this.isDisabled||this.focusing)return!1;this.$emit("on-import-click")},onSearchClick:function(){if(this.focusing)return!1;this.$emit("on-search-click")},onDeleteClick:function(t,e,i){t.id?(this.$set(t,"changeType","del"),this.$set(t,"busUnitAmount",0)):i.splice(e,1)},onItemFocus:function(t,e){this.focusing=!0},onItemBlur:function(){this.focusing=!1}}},r=a,l=(i("a2a6"),i("2877")),c=Object(l["a"])(r,n,o,!1,null,"7a3b025a",null);e["a"]=c.exports},"5e8f":function(t,e,i){},"60bc":function(t,e,i){},"68d6":function(t,e,i){"use strict";var n=i("abbc"),o=i.n(n);o.a},"6d38":function(t,e,i){"use strict";var n=i("6e9d"),o=i.n(n);o.a},"6e9d":function(t,e,i){},"6f64":function(t,e,i){"use strict";var n=i("aeda"),o=i.n(n);o.a},7369:function(t,e,i){"use strict";var n=i("4ba8"),o=i.n(n);o.a},"796c":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-info-cell"},[i("div",{staticClass:"item-img"},[i("img",{attrs:{src:t.comptedItemImgSrc(t.itemData.goodsDTO.imageUrls||[]),onerror:t.$fxCommon.errorImg("item")}})]),i("div",{staticClass:"item-details"},[i("div",{staticClass:"item-name fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.name))]),i("div",{staticClass:"details-cell"},[t.$fxAuth("uniformDistributionRtnBill.taxOutmoney")?i("div",{staticClass:"item-taxprice fx-ellipsis"},[i("span",[t._v("含税金额：￥")]),i("span",[t._v(t._s(t.itemData.outMoneyWithTax))])]):t._e(),i("div",{staticClass:"item-spec fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.spec))])]),i("div",{staticClass:"details-cell"},[t.isDisabled||t.itemData.isWeightSign&&!t.sysDZCCanModifyAcount?i("div",{staticClass:"item-amount"},[i("span",{staticClass:"item-amount-text"},[t._v(t._s(t.itemData.busUnitOutAmount))]),i("span",[t._v(t._s(t.itemData.unitDTO.name))])]):i("div",{staticClass:"item-amount-edit"},[i("w-stepper",{ref:"amountInput",staticClass:"amount-step",attrs:{min:"0",max:t.maxAmount,stepperBtnShow:!1,intLength:t.numberLength,pointSize:t.sysPointSize,inputWidth:"28vw"},on:{change:t.onChange,focus:t.onFocus,blur:t.onBlur},model:{value:t.itemData.busUnitOutAmount,callback:function(e){t.$set(t.itemData,"busUnitOutAmount",e)},expression:"itemData.busUnitOutAmount"}}),i("div",{staticClass:"unit-text"},[i("span",{staticClass:"cell-unit fx-ellipsis",on:{click:function(e){return e.stopPropagation(),t.onUnitClick(e)}}},[t._v(t._s(t.itemData.unitDTO.name))]),i("van-icon",{directives:[{name:"show",rawName:"v-show",value:t.sysUniformDistribution,expression:"sysUniformDistribution"}],attrs:{name:"arrow-down"}})],1)],1)]),i("i",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&!t.disabledEditBtn,expression:"!isDisabled && !disabledEditBtn"}],staticClass:"block-item-edit",on:{click:t.onItemEditClick}}),i("i",{directives:[{name:"show",rawName:"v-show",value:t.isDisabled,expression:"isDisabled"}],staticClass:"block-item-watch",on:{click:t.onItemEditClick}})])])},o=[],s=i("795b"),a=i.n(s),r=i("59ad"),l=i.n(r),c=i("cebc"),u=i("2f62"),d={name:"itemInfoCell",props:{itemData:{type:Object,default:function(){return{}}},isDisabled:Boolean,disabledEditBtn:Boolean},computed:Object(c["a"])({},Object(u["c"])({sysDZCCanModifyAcount:function(t){return t.systemParams.sysDZCCanModifyAcount},sysUniformDistribution:function(t){return t.systemParams.sysUniformDistribution},sysPointSize:"sysPointSize",numberLength:"numberLength",maxAmount:"maxAmount"}),{comptedItemImgSrc:function(t){return function(t){return 0===t.length?"":t[0]}}}),methods:{editItem:function(){this.itemData.id&&this.$set(this.itemData,"changeType","edit")},onItemEditClick:function(){this.editItem(),this.$emit("on-item-edit",this.itemData)},onChange:function(t){if("del"===this.itemData.changeType)return!1;this.editItem(),this.onAmountChange(t)},onAmountChange:function(t){this.editItem();var e=this.itemData,i=e.taxPrice,n=e.price,o=l()(this.$fxUtils.toFixedSHW(n*t,this.sysPointSize)),s=l()(this.$fxUtils.toFixedSHW(i*t,this.sysPointSize)),a=l()(this.$fxUtils.toFixedSHW(s-o,this.sysPointSize));this.itemData.outMoney=o,this.itemData.outMoneyWithTax=s,this.itemData.taxOutMoney=a},onFocus:function(){this.$emit("on-item-focus")},onBlur:function(){var t=this;this.onCheckAmount().then(function(){t.$emit("on-item-blur")}).catch(function(){t.$refs.amountInput.setFocus(),t.$emit("on-item-focus")})},onUnitClick:function(){var t=this;if(this.isDisabled||!this.sysUniformDistribution)return!1;this.onCheckAmount(!1).then(function(){t.editItem(),t.$emit("on-unit-edit",t.itemData)})},onCheckAmount:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new a.a(function(i,n){var o=t.itemData.busUnitOutAmount,s="数量不符合规则";0===o?t.$nextTick(function(){e&&t.$fxNotify.fail("退货数量不能为0!"),n(s)}):i()})}}},h=d,f=(i("976b"),i("2877")),p=Object(f["a"])(h,n,o,!1,null,"854e5900",null);e["a"]=p.exports},8371:function(t,e,i){},"88e3":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-uniformDistributionRtn-details"},[i("w-header",{attrs:{title:t.orderInfoData.sysbillCode,titleFontSize:"3.733vw",border:!0}}),i("orderInfo",{ref:"orderInfo",attrs:{data:t.orderInfoData,isDisabled:!t.$fxAuth("uniformDistributionRtnBill.save")||t.isBillState(1)||t.isWeightState(1)||t.isWeightState(2),collapseDisabled:t.itemInputFocusing},on:{"on-busdate-click":t.onBusinessDateClick,"on-billType-click":t.onBillTypeClick,"on-rdc-click":t.onRdcClick,"on-shop-click":t.onShopClick,"on-billType-clear":t.onBillTypeClear}}),i("orderItem",{ref:"orderItem",attrs:{data:t.orderItemList,isDisabled:!t.$fxAuth("uniformDistributionRtnBill.save")||t.isBillState(1)||t.isWeightState(1)||t.isWeightState(2),itemInputFocusing:t.itemInputFocusing},on:{"update:itemInputFocusing":function(e){t.itemInputFocusing=e},"update:item-input-focusing":function(e){t.itemInputFocusing=e},"on-import-click":t.onImportClick,"on-search-click":t.onSearchClick,"on-unit-edit":t.onUnitEdit,"on-item-edit":t.onItemEdit,"on-item-focus":t.onItemFocus}}),i("div",{staticClass:"uniformDistributionRtn-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("uniformDistributionRtnBill.del")&&t.isBillState(0)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('uniformDistributionRtnBill.del') && isBillState(0) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onDeleteClick")}}},[t._v("删除")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("uniformDistributionRtnBill.check")&&t.isBillState(0)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('uniformDistributionRtnBill.check') && isBillState(0) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onExpressClick")}}},[t._v("审核")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("uniformDistributionRtnBill.unCheck")&&t.isBillState(1)&&t.isBillReState(0)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('uniformDistributionRtnBill.unCheck') && isBillState(1) && isBillReState(0) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onUnExpressClick")}}},[t._v("反审")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("uniformDistributionRtnBill.reCheck")&&t.isBillReState(0)&&t.isBillState(1),expression:"$fxAuth('uniformDistributionRtnBill.reCheck') && isBillReState(0) && isBillState(1)"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onExpressAgainClick")}}},[t._v("复审")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("uniformDistributionRtnBill.unRecheck")&&t.isBillReState(1)&&t.isBillState(1),expression:" $fxAuth('uniformDistributionRtnBill.unRecheck') && isBillReState(1) && isBillState(1)"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onUnExpressAgainClick")}}},[t._v("取消复审")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("uniformDistributionRtnBill.save")&&t.isBillState(0)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('uniformDistributionRtnBill.save') && isBillState(0) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:function(e){return t.onClickHandler("onSaveClick")}}},[t._v("保存")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("uniformDistributionRtnBill.weighState")&&t.isBillState(0)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('uniformDistributionRtnBill.weighState') && isBillState(0) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius yellow-btn",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onWeightClick")}}},[t._v("下发称重")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("uniformDistributionRtnBill.weighState")&&t.isBillState(0)&&(t.isWeightState(1)||t.isWeightState(2)),expression:"$fxAuth('uniformDistributionRtnBill.weighState') && isBillState(0) && (isWeightState(1) || isWeightState(2))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onUnWeightClick")}}},[t._v("取消称重")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("uniformDistributionRtnBill.weighState")&&t.isBillState(0)&&t.isWeightState(2)&&t.sysDZCManyLower,expression:"$fxAuth('uniformDistributionRtnBill.weighState') && isBillState(0) && isWeightState(2) && sysDZCManyLower"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onEndWeightClick")}}},[t._v("结束称重")])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.shopPopShow,callback:function(e){t.shopPopShow=e},expression:"shopPopShow"}},[i("listComp",{attrs:{visibleFlag:t.shopPopShow,data:t.shopList,loadFinished:t.shopListLoadFinished,loading:t.onShopLoading,title:"退货机构检索"},on:{"update:visibleFlag":function(e){t.shopPopShow=e},"update:visible-flag":function(e){t.shopPopShow=e},"update:loading":function(e){t.onShopLoading=e},"on-search":t.searchShop,"on-select":t.selectShop,"on-load":t.onShopLoad}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.rdcPopShow,callback:function(e){t.rdcPopShow=e},expression:"rdcPopShow"}},[i("listComp",{attrs:{visibleFlag:t.rdcPopShow,data:t.rdcList,loadFinished:!0,title:"配送中心检索"},on:{"update:visibleFlag":function(e){t.rdcPopShow=e},"update:visible-flag":function(e){t.rdcPopShow=e},"on-search":t.searchRdc,"on-select":t.selectRdc}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.billTypePopShow,callback:function(e){t.billTypePopShow=e},expression:"billTypePopShow"}},[i("listComp",{attrs:{visibleFlag:t.billTypePopShow,data:t.billTypeList,loadFinished:!0,title:"单据类型检索"},on:{"update:visibleFlag":function(e){t.billTypePopShow=e},"update:visible-flag":function(e){t.billTypePopShow=e},"on-search":t.searchBillType,"on-select":t.selectBillType}})],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.importPopShow,callback:function(e){t.importPopShow=e},expression:"importPopShow"}},[i("importBillComp",{attrs:{visibleFlag:t.importPopShow,orderInfo:t.orderInfoData},on:{"update:visibleFlag":function(e){t.importPopShow=e},"update:visible-flag":function(e){t.importPopShow=e},"on-item-import-confirm":t.onImportConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,isDisabled:!t.$fxAuth("uniformDistributionRtnBill.save")||t.isBillState(1)||t.isWeightState(1)||t.isWeightState(2)},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemSearchPopShow,callback:function(e){t.itemSearchPopShow=e},expression:"itemSearchPopShow"}},[i("itemSearchPop",{attrs:{visibleFlag:t.itemSearchPopShow,data:t.searchItem,isDisabled:!t.$fxAuth("uniformDistributionRtnBill.save")||t.isBillState(1)||t.isWeightState(1)||t.isWeightState(2)},on:{"update:visibleFlag":function(e){t.itemSearchPopShow=e},"update:visible-flag":function(e){t.itemSearchPopShow=e},"on-unit-edit":t.onUnitEdit,"on-search-confirm":t.onSearchConfirm}})],1)],1)},o=[],s=(i("20d6"),i("5176")),a=i.n(s),r=i("75fc"),l=i("f499"),c=i.n(l),u=(i("7514"),i("b6d0")),d=i.n(u),h=i("774e"),f=i.n(h),p=(i("ac6a"),i("59ad")),m=i.n(p),v=i("795b"),g=i.n(v),b=(i("6762"),i("2fdb"),i("6b54"),i("cebc")),S=i("2f62"),D=i("ad8c"),w=i("57f6"),I=i("f6bb"),k=i("c0bf"),C=i("95d5d"),x=i("39b8"),y=50,P={name:"uniformDistributionRtnBillDetails",components:{orderInfo:D["a"],orderItem:w["a"],listComp:I["a"],importBillComp:k["a"],itemRowEditPop:C["a"],itemSearchPop:x["a"]},data:function(){return{query:this.$route.query,activeNames:["1"],tabActive:"选项1",orderInfoData:{},orderItemList:[],currentDate:new Date,datePickerShow:!1,rdcPopShow:!1,billTypePopShow:!1,importPopShow:!1,rdcList:[],billTypeList:[],shopPopShow:!1,shopList:[],shopListStart:0,onShopLoading:!1,shopListLoadFinished:!1,itemEditRowData:{},unitActionShow:!1,unitActions:[],itemRowEditPopShow:!1,itemInputFocusing:!1,orderDeleteFlag:!1,formatterSysPointKey:["taxPrice","price","outMoney","taxOutMoney","outMoneyWithTax","busUnitOutAmount"],itemSearchPopShow:!1,searchItem:[]}},created:function(){this.createOrderDetails()},beforeRouteLeave:function(t,e,i){var n=this;if(this.itemInputFocusing)return this.$router.go(1),!1;"/uniformDistributionRtnBill"!==t.path||this.orderDeleteFlag||0!==this.orderInfoData.billState?i():this.$dialog.confirm({title:"提示",message:"若已修改,请先保存单据<br/>是否关闭页面?"}).then(function(){i()}).catch(function(){return n.$router.go(1),!1})},computed:Object(b["a"])({},Object(S["c"])({sysPointSize:"sysPointSize",sysMoneyPointSize:"sysMoneyPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId},sysDZCManyLower:function(t){return t.systemParams.sysDZCManyLower}}),{isBillState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.billState):e.orderInfoData.billState===t}},isBillReState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.billReState):e.orderInfoData.billReState===t}},isWeightState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.weightState):e.orderInfoData.weightState===t}}}),methods:{createOrderDetails:function(){var t=this;return new g.a(function(e){t.getOrderDetails().then(function(i){var n=i.storeBills[0];t.formatterSysPoint(n.details),t.orderInfoData=n,t.orderItemList=t.filterStoreItem(n.details),t.setDetailGoodsUUid(t.orderItemList),e()})})},getOrderDetails:function(){var t=this;return new g.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/distributionRtn/").concat(t.query.orderId,"/users/").concat(t.loginerId)}).then(function(t){e(t)})})},formatterSysPoint:function(t){var e=this,i=function(t){return m()(e.$fxUtils.toFixedSHW(t,e.sysPointSize))};t.forEach(function(t){e.formatterSysPointKey.forEach(function(e){t[e]=i(t[e])})})},filterStoreItem:function(t){var e=this;t.forEach(function(t){var i=t.busUnitOutAmount;i&&!t.giftFlag&&(t.price=e.toFixedNumberSize(t.outMoney/i),t.taxPrice=e.toFixedNumberSize(t.outMoneyWithTax/i)),t.busUnitOutAmount=i});var i=f()(new d.a(t.map(function(t){return t.outHouseDTO.id}))),n=i.map(function(e){var i=t.find(function(t){return t.outHouseDTO.id===e}).outHouseDTO;return i=JSON.parse(c()(i)),i.details=t.filter(function(t){return t.outHouseDTO.id===e}),i});return n},setDetailGoodsUUid:function(t){var e=this;t.forEach(function(t){t.details.forEach(function(t){t.goodsUUid=e.$fxUtils.createUUID()})})},toFixedNumberSize:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sysMoneyPointSize;return m()(this.$fxUtils.toFixedSHW(t,e))},onBusinessDateClick:function(){this.orderInfoData.businessDate&&(this.currentDate=new Date(this.orderInfoData.businessDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){var e=t.getTime();this.orderInfoData.businessDate=e,this.datePickerShow=!1},clearItemConfim:function(t){var e=this;return new g.a(function(i){var n=e.orderItemList.filter(function(t){var e=t.details.filter(function(t){return"del"!==t.changeType});return 0!==e.length});0===n.length?i():e.$dialog.confirm({title:"提示",message:t}).then(function(){e.onItemClear(),i()}).catch(function(){})})},onBillTypeClick:function(){this.onBillTypeRefresh()},searchBillType:function(t){this.onBillTypeRefresh(t)},selectBillType:function(t){this.orderInfoData.businessTypeDTO=t},onBillTypeClear:function(){this.orderInfoData.businessTypeDTO={}},onBillTypeRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getBillTypeListData(e).then(function(e){t.billTypeList=e.businessTypes,t.billTypePopShow=!0})},getBillTypeListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new g.a(function(i){var n={billType:"34_1",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/businessTypes"),data:n}).then(function(t){i(t)})})},onRdcClick:function(){this.onRdcRefresh()},searchRdc:function(t){this.onRdcRefresh(t)},selectRdc:function(t){var e=this;this.checkRdc(t).then(function(){e.clearItemConfim("更换配送中心会清空品项,是否继续?").then(function(){e.orderInfoData.rdcDTO=t})})},checkRdc:function(t){var e=this;return new g.a(function(i){var n=e.orderInfoData.rdcDTO||{};n.id!==t.id&&i()})},onRdcRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getRdcListData(e).then(function(e){t.rdcList=e.shops,t.rdcPopShow=!0})},getRdcListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new g.a(function(i){var n={keyword:e,selAll:"on"};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/rdcs"),data:n}).then(function(t){i(t)})})},onShopClick:function(){this.$fxStateMiddleware.stateIs("loginerOrganType")("shop")(this.loginerOrganType)||this.onShopRefresh()},searchShop:function(t){this.onShopRefresh(t)},selectShop:function(t){var e=this;this.checkShop(t).then(function(){e.clearItemConfim("更换退货机构会清空品项,是否继续?").then(function(){e.orderInfoData.shopDTO=t})})},checkShop:function(t){var e=this;return new g.a(function(i){var n=e.orderInfoData.shopDTO||{};n.id!==t.id&&i()})},onShopRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.shopListStart=0,this.getShopListData(e).then(function(e){t.shopPopShow=!0,t.onShopLoading=!1,t.shopListStart+=y,e.shops.length<y?t.shopListLoadFinished=!0:t.shopListLoadFinished=!1,t.shopList=e.shops})},onShopLoad:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getShopListData(e).then(function(e){var i;t.onShopLoading=!1,t.shopListStart+=y,e.shops.length<y&&(t.shopListLoadFinished=!0),(i=t.shopList).push.apply(i,Object(r["a"])(e.shops))})},getShopListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new g.a(function(i){var n={start:t.shopListStart,size:y,paged:!0,keyword:e,m:"getShopListForUserhouse",orgFlag:0};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/shops"),data:n}).then(function(t){i(t)})})},onImportClick:function(){var t=this,e=this.orderItemList.filter(function(t){var e=t.details.filter(function(t){return"del"!==t.changeType});return 0!==e.length});0!==e.length?this.$dialog.confirm({title:"提示",message:"重新导入单据？会清空明细！"}).then(function(){t.onItemClear(),t.importPopShow=!0}).catch(function(){}):this.importPopShow=!0},onImportConfirm:function(t){var e=this,i=this.orderInfoData.details.filter(function(t){return!!t.id}),n="";i.forEach(function(t){t.changeType="del"}),t.forEach(function(t){n=t.billId,t.changeType="add",t.preDetailId=t.id,t.billId=e.orderInfoData.id,t.busUnitOutAmount=t.busUnitInAmount,t.outHouseDTO=t.inHouseDTO,t.outMoney=t.inMoney,t.outMoneyWithTax=t.inMoneyWithTax,t.taxOutMoney=t.taxInMoney,delete t["inHouseDTO"],delete t["id"],delete t["busUnitInAmount"],delete t["inMoney"],delete t["inMoneyWithTax"],delete t["taxInMoney"],delete t["outOrderAmount"]}),i.push.apply(i,Object(r["a"])(t)),this.orderInfoData.details=i,this.orderItemList=this.filterStoreItem(i),this.setDetailGoodsUUid(this.orderItemList),this.orderInfoData.fatherId=n},onSaveClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要保存该单据吗?"}).then(function(){t.checkHasDetails().then(function(){var e=t.getSaveParams();t.saveHandler(e)})}).catch(function(){})},saveHandler:function(t){var e=this;this.$fxHttp.requestPut({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/distributionRtn/").concat(this.query.orderId,"/users/").concat(this.loginerId),data:t,query:{userId:this.loginerId,m:"modify"}}).then(function(t){e.createOrderDetails().then(function(){e.$fxToast.success("保存成功")})})},onExpressClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要审核该单据吗?"}).then(function(){t.checkHasDetails().then(function(){var e=t.getSaveParams();t.expressHandler(e)})}).catch(function(){})},expressHandler:function(t){var e=this;this.$fxHttp.requestPut({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/distributionRtn/").concat(this.query.orderId,"/users/").concat(this.loginerId),data:t,query:{userId:this.loginerId,m:"editAndCheck"}}).then(function(t){e.createOrderDetails().then(function(){e.$fxToast.success("审核成功")})}).catch(function(t){"1"===t.errorCode&&e.createOrderDetails()})},onUnExpressClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要反审该单据吗?"}).then(function(){t.checkHasDetails().then(function(){var e=t.getSaveParams();t.unExpressHandler(e)})}).catch(function(){})},unExpressHandler:function(t){var e=this;this.$fxHttp.requestPut({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/distributionRtn/").concat(this.query.orderId,"/users/").concat(this.loginerId),data:t,query:{userId:this.loginerId,m:"unCheck"}}).then(function(t){e.createOrderDetails().then(function(){e.$fxToast.success("反审成功")})})},onWeightClick:function(){var t=this;this.checkHasDetails().then(function(){t.$dialog.confirm({title:"提示",message:"确定要下发称重吗?"}).then(function(){var e=t.getSaveParams();if(!e)return!1;t.$fxHttp.requestPost({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/distributionRtn/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:e,query:{userId:t.loginerId,m:"weighBill"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("下发称重成功")})})}).catch(function(){})})},onUnWeightClick:function(){var t=this;this.checkHasDetails().then(function(){var e="确定要取消称重吗?";2===t.orderInfoData.weighState&&(e="称重中的单据，取消称重后电子秤可以继续称重并传回数据！确定要取消称重吗"),t.$dialog.confirm({title:"提示",message:e}).then(function(){t.$fxHttp.requestPost({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/distributionRtn/").concat(t.query.orderId,"/users/").concat(t.loginerId),query:{userId:t.loginerId,m:"unWeighBill"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("取消称重成功")})})}).catch(function(){})})},onEndWeightClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"结束称重后将不再接收此单据的称重数据"}).then(function(){t.$fxHttp.requestPost({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/distributionRtn/").concat(t.query.orderId,"/users/").concat(t.loginerId),query:{userId:t.loginerId,m:"endWeighBill"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("结束称重成功")})})}).catch(function(){})},onDeleteClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要删除该单据吗?"}).then(function(){var e=t.getSaveParams();t.$fxHttp.requestDel({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/distributionRtn/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:e,query:{userId:t.loginerId}}).then(function(e){t.$fxToast.success({message:"删除成功",mask:!0}).then(function(){t.orderDeleteFlag=!0,t.$router.go(-1)})})}).catch(function(){})},onExpressAgainClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要复审该单据吗?"}).then(function(){var e=t.getSaveParams();t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/distributionRtn/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:e,query:{userId:t.loginerId,m:"reCheck"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("复审成功")})})}).catch(function(){})},onUnExpressAgainClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要取消复审该单据吗?"}).then(function(){var e=t.getSaveParams();t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/distributionRtn/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:e,query:{userId:t.loginerId,m:"unReCheck"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("取消复审成功")})})}).catch(function(){})},getSaveParams:function(){var t=[];this.orderItemList.forEach(function(e){t.push.apply(t,Object(r["a"])(e.details))});var e=t.filter(function(t){return"add"===t.changeType}),i=t.filter(function(t){return"del"===t.changeType}),n=t.filter(function(t){return"edit"===t.changeType}),o=a()({},this.orderInfoData,{detailAdd:e.length>0?e:null,detailDel:i.length>0?i:null,detailMdf:n.length>0?n:null,details:[]});return o},checkHasDetails:function(){var t=this;return new g.a(function(e){var i=[];t.orderItemList.forEach(function(t){i.push.apply(i,Object(r["a"])(t.details))});var n=i.filter(function(t){return"del"!==t.changeType});0===n.length?t.$fxToast.fail("单据明细不能为空"):e()})},onUnitEdit:function(t){var e=this;this.itemEditRowData=t,this.getItemUnit(t.goodsDTO.id).then(function(t){e.unitActions=t,e.unitActionShow=!0})},getItemUnit:function(t){var e=this;return new g.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/shopId/users/userId/goods/").concat(t,"/units"),query:{userId:e.loginerId}}).then(function(t){i(t.units)})})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemEditRowData,i=e.unitDTO,n=i.value/t.value,o=m()(this.$fxUtils.toFixedSHW(e.busUnitOutAmount*n,this.sysPointSize)),s=m()(this.$fxUtils.toFixedSHW(e.outMoneyWithTax/o,this.sysPointSize)),a=m()(this.$fxUtils.toFixedSHW(e.outMoney/o,this.sysPointSize));e.unitDTO=t,e.busUnitOutAmount=o,e.taxPrice=s,e.price=a,e.id&&(e.changeType="edit")},onItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this.orderItemList.findIndex(function(e){return e.id===t.outHouseDTO.id});if(~e){var i=this.orderItemList[e].details.findIndex(function(e){return e.goodsUUid===t.goodsUUid});~i&&(this.orderItemList[e].details[i]=t)}},onItemClear:function(){var t=this.orderInfoData.details.filter(function(t){return!!t.id});t.forEach(function(t){t.changeType="del"}),this.orderInfoData.details=t,this.orderItemList=this.filterStoreItem(t)},onClickHandler:function(t){if(this.itemInputFocusing)return!1;this[t]()},onItemFocus:function(){this.$refs.orderInfo.closeCollapse()},onSearchClick:function(){this.itemSearchPopShow=!0,this.searchItem=JSON.parse(c()(this.orderItemList))},onSearchConfirm:function(t){this.orderItemList=t}}},T=P,$=(i("7369"),i("2877")),B=Object($["a"])(T,n,o,!1,null,"2ea6dc7f",null);e["default"]=B.exports},"95d5d":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"itemRowEdit-popup"},[i("w-header",{attrs:{title:t.currentItemData.goodsDTO.name,leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{ref:"rowEditContent",staticClass:"itemRowEdit-content"},[i("van-cell-group",[i("van-cell",{attrs:{title:"单位",value:t.currentItemData.unitDTO.name,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("uniformDistributionRtnBill.seePrice"),expression:"$fxAuth('uniformDistributionRtnBill.seePrice')"}],attrs:{title:"非税单价",value:t.currentItemData.price,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("uniformDistributionRtnBill.noTaxOutmoney"),expression:"$fxAuth('uniformDistributionRtnBill.noTaxOutmoney')"}],attrs:{title:"非税金额",value:t.currentItemData.outMoney,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("uniformDistributionRtnBill.taxAmount"),expression:"$fxAuth('uniformDistributionRtnBill.taxAmount')"}],attrs:{title:"税额",value:t.currentItemData.taxOutMoney,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("uniformDistributionRtnBill.taxRete"),expression:"$fxAuth('uniformDistributionRtnBill.taxRete')"}],attrs:{title:"税率",value:t.fomatterTaxes(t.currentItemData.tax),"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"品项编号",value:t.currentItemData.goodsDTO.code,"value-class":"info-item-value"}}),i("van-pro-field",{ref:"memo",attrs:{disabled:t.isDisabled,placeholder:t.setPlaceholder("请输入备注"),label:"备注","value-class":"info-item-value","input-align":"right"},on:{focus:function(e){return t.onFocus("memo")}},model:{value:t.currentItemData.memo,callback:function(e){t.$set(t.currentItemData,"memo",e)},expression:"currentItemData.memo"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"净重量",value:t.toFixedNumberSize(t.currentItemData.netWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"皮重量",value:t.toFixedNumberSize(t.currentItemData.skinWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"毛重量",value:t.toFixedNumberSize(t.currentItemData.grossWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"称重单位",value:t.currentItemData.weightUnit,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"称重状态",value:t.currentItemData.isWeightSign?"已称重":"未称重","value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"图片",border:!1,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData&&t.currentItemData.images.length,expression:"sysShowDZCData && currentItemData.images.length"}],staticClass:"info-cell-img",attrs:{"value-class":"info-item-img"}},[i("img",{attrs:{src:t.comptedItemImgSrc(t.currentItemData.images),onerror:t.$fxCommon.errorImg("currentItemData")}})])],1)],1),i("div",{staticClass:"itemRowEdit-bottom"},[t.isDisabled?i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onCloseClick}},[t._v("确定")]):i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onConfirmClick}},[t._v("保存")])],1)],1)},o=[],s=i("59ad"),a=i.n(s),r=i("f499"),l=i.n(r),c=i("cebc"),u=i("2f62"),d={name:"itemRowEdit",props:{visibleFlag:Boolean,itemData:{type:Object,default:function(){return{}}},isDisabled:Boolean},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},currentItemData:{}}},computed:Object(c["a"])({},Object(u["c"])({sysPointSize:"sysPointSize",sysShowDZCData:function(t){return t.systemParams.sysShowDZCData}}),{fomatterTaxes:function(t){var e=this;return function(t){if(t){var i=e.$fxUtils.toFixedSHW(100*t,2,!1);return"".concat(i,"%")}return"0%"}},setPlaceholder:function(t){var e=this;return function(t){return e.isDisabled?"":t}},comptedItemImgSrc:function(t){return function(t){return t?0===t.length?"":t[0].imagUrl:""}}}),watch:{visibleFlag:{handler:function(t){t&&(this.currentItemData=JSON.parse(l()(this.itemData)))},immediate:!0}},methods:{toFixedNumberSize:function(t){return a()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onConfirmClick:function(){this.currentItemData.id&&(this.currentItemData.changeType="edit"),this.$emit("on-Confirm",this.currentItemData),this.$emit("update:visibleFlag",!1)},onFocus:function(t){this.onScrollTop(t)},onScrollTop:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,i=this.$refs[t];if(!i||0===i.length)return!1;var n=i.$el.offsetTop,o=this.$refs["rowEditContent"];this.$fxUtils.scrollTopW({offsetTop:n,$el:o,distance:e})}}},h=d,f=(i("5135"),i("2877")),p=Object(f["a"])(h,n,o,!1,null,"089cc8ba",null);e["a"]=p.exports},9646:function(t,e,i){},"976b":function(t,e,i){"use strict";var n=i("5e8f"),o=i.n(n);o.a},a0d6:function(t,e,i){},a2a6:function(t,e,i){"use strict";var n=i("9646"),o=i.n(n);o.a},abbc:function(t,e,i){},ad8c:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-info-block fx-shadow-block"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},[i("van-collapse-item",{attrs:{name:"1",disabled:t.collapseDisabled}},[i("div",{staticClass:"info-title",attrs:{slot:"title"},slot:"title"},[i("span",{staticClass:"info-title-name"},[t._v("单据信息")]),i("stateText",{staticClass:"stateTag fl-r",attrs:{billState:t.data.billState}}),i("span",{directives:[{name:"show",rawName:"v-show",value:1===t.data.weightState,expression:"data.weightState === 1"}],staticClass:"info-title-weightState"},[t._v("待称重")])],1),i("van-tabs",{attrs:{animated:""},model:{value:t.tabActive,callback:function(e){t.tabActive=e},expression:"tabActive"}},[i("van-tab",{attrs:{title:"表头"}},[i("van-cell",{staticClass:"info-item",attrs:{title:"退货机构","value-class":"info-item-value",value:t.data.shopDTO&&t.data.shopDTO.name,"is-link":!t.isDisabled},on:{click:function(e){return t.onEmitClick("on-shop-click")}}}),i("van-cell",{staticClass:"info-item",attrs:{title:"配送中心","value-class":"info-item-value",value:t.data.rdcDTO&&t.data.rdcDTO.name,"is-link":!t.isDisabled},on:{click:function(e){return t.onEmitClick("on-rdc-click")}}}),i("van-cell",{staticClass:"info-item",attrs:{title:"业务日期",value:t.formatterDate(t.data.businessDate),"is-link":!t.isDisabled},on:{click:function(e){return t.onEmitClick("on-busdate-click")}}}),i("van-cell",{staticClass:"info-item",attrs:{title:"单据类型","value-class":"info-item-value",value:t.data.businessTypeDTO&&t.data.businessTypeDTO.name},on:{click:function(e){return t.onEmitClick("on-billType-click")}}},[i("van-icon",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"item-clear-btn",attrs:{slot:"right-icon",name:t.hasBillType?"close":"arrow"},on:{click:function(e){e.stopPropagation(),t.hasBillType?t.onEmitClick("on-billType-clear"):t.onEmitClick("on-billType-click")}},slot:"right-icon"})],1),i("van-cell",{staticClass:"info-item",attrs:{title:"系统单号","value-class":"info-item-value",value:t.data.sysbillCode}}),i("van-pro-field",{staticClass:"info-item",attrs:{label:"手工单号",placeholder:t.isDisabled?"":"请输入手工单号","input-align":"right",maxlength:"50",disabled:t.isDisabled},model:{value:t.data.manualCode,callback:function(e){t.$set(t.data,"manualCode",e)},expression:"data.manualCode"}})],1),i("van-tab",{attrs:{title:"更多"}},[i("van-cell",{staticClass:"info-item",attrs:{title:"制单人",value:t.data.billEmp}}),i("van-cell",{staticClass:"info-item",attrs:{title:"制单日期",value:t.formatterDate(t.data.billDate)}}),i("van-cell",{staticClass:"info-item",attrs:{title:"审核人",value:t.data.checkEmp}}),i("van-cell",{staticClass:"info-item",attrs:{title:"审核日期",value:t.formatterDate(t.data.checkDate)}}),i("van-pro-field",{staticClass:"info-item",attrs:{label:"整单备注",placeholder:t.isDisabled?"":"请输入整单备注","input-align":"right",maxlength:"50",disabled:t.isDisabled},model:{value:t.data.billMemo,callback:function(e){t.$set(t.data,"billMemo",e)},expression:"data.billMemo"}})],1)],1)],1)],1)],1)},o=[],s=i("cebc"),a=i("2f62"),r=i("4760"),l={name:"orderInfo",components:{stateText:r["a"]},props:{data:{type:Object,default:function(){return{}}},isDisabled:Boolean,collapseDisabled:Boolean},data:function(){return{activeNames:["1"],tabActive:0}},computed:Object(s["a"])({},Object(a["c"])({loginerOrganType:function(t){return t.loginer.loginerOrganType}}),{formatterDate:function(t){var e=this;return function(t){return"number"===typeof t?e.$fxUtils.setDateTime(new Date(t),"时分"):""}},hasBillType:function(){return this.data.businessTypeDTO&&this.data.businessTypeDTO.id}}),methods:{onEmitClick:function(t){if(this.isDisabled)return!1;this.$emit(t)},closeCollapse:function(){this.activeNames=[]}}},c=l,u=(i("cf1d"),i("2877")),d=Object(u["a"])(c,n,o,!1,null,"75c89fe5",null);e["a"]=d.exports},aeda:function(t,e,i){},b10f:function(t,e,i){},b2101:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-uniformDistributionRtn"},[i("w-header",{attrs:{title:"统配退货单",border:!0}},[i("headEditBtn",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("uniformDistributionRtnBill.check"),expression:"$fxAuth('uniformDistributionRtnBill.check')"}],attrs:{slot:"header-right",active:t.orderEditFlag},on:{click:t.onOrderEditClick},slot:"header-right"}),i("headSearchBtn",{directives:[{name:"show",rawName:"v-show",value:!t.orderEditFlag,expression:"!orderEditFlag"}],attrs:{slot:"header-right"},on:{click:t.onSearchClick},slot:"header-right"}),i("headSelectAllBtn",{directives:[{name:"show",rawName:"v-show",value:t.orderEditFlag,expression:"orderEditFlag"}],attrs:{slot:"header-right",active:t.isSelectAll},on:{click:t.onSelectAllClick},slot:"header-right"})],1),i("filterTab",{attrs:{state:t.computedState},on:{"on-state-click":t.onStateClick}}),i("div",{staticClass:"uniformDistributionRtn-content"},[i("van-pull-refresh",{directives:[{name:"show",rawName:"v-show",value:0!==t.orderList.length,expression:"orderList.length !== 0"}],staticClass:"uniformDistributionRtn-list",on:{refresh:t.onPullRefresh},model:{value:t.pullRefreshLoading,callback:function(e){t.pullRefreshLoading=e},expression:"pullRefreshLoading"}},[i("van-list",{attrs:{finished:t.loadFinished,"finished-text":"没有更多了",error:t.listError,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.listError=e},load:t.onLoadMore},model:{value:t.listLoading,callback:function(e){t.listLoading=e},expression:"listLoading"}},t._l(t.orderList,function(e){return i("orderBlock",{directives:[{name:"show",rawName:"v-show",value:t.computedShowOrder(e.billState),expression:"computedShowOrder(item.billState)"}],key:e.id,attrs:{data:e,showCheckBox:t.orderEditFlag},on:{"on-click":function(i){return t.onClickOrder(e)}}})}),1)],1),i("emptyBill",{directives:[{name:"show",rawName:"v-show",value:0===t.orderList.length,expression:"orderList.length === 0"}]})],1),i("div",{staticClass:"uniformDistributionRtn-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.orderEditFlag&&t.$fxAuth("uniformDistributionRtnBill.add"),expression:"!orderEditFlag && $fxAuth('uniformDistributionRtnBill.add')"}],staticClass:"add-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onCreateClick}},[t._v("添加单据")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.orderEditFlag&&t.$fxAuth("uniformDistributionRtnBill.check"),expression:"orderEditFlag && $fxAuth('uniformDistributionRtnBill.check')"}],staticClass:"add-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onExpressClick}},[t._v("批量审核")])],1),i("van-actionsheet",{attrs:{actions:t.stateActions,"cancel-text":"取消"},on:{select:t.onStateSelect},model:{value:t.stateActionShow,callback:function(e){t.stateActionShow=e},expression:"stateActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.filterPopShow,callback:function(e){t.filterPopShow=e},expression:"filterPopShow"}},[i("filterPop",{attrs:{visibleFlag:t.filterPopShow,filterParams:t.filterParams},on:{"update:visibleFlag":function(e){t.filterPopShow=e},"update:visible-flag":function(e){t.filterPopShow=e},"update:filterParams":function(e){t.filterParams=e},"update:filter-params":function(e){t.filterParams=e},"on-confirm":t.onFilterConfirm}})],1)],1)},o=[],s=(i("ac6a"),i("75fc")),a=i("5176"),r=i.n(a),l=i("795b"),c=i.n(l),u=(i("7514"),i("7f7f"),i("cebc")),d=(i("6762"),i("2f62")),h=i("b215"),f=i("46aa"),p=i("a0be"),m=i("4102"),v=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-block fx-shadow-block",style:t.orderBlockStyle,on:{click:t.onClick}},[i("div",{staticClass:"block-title"},[i("i",{staticClass:"block-icon"}),i("span",{staticClass:"title-text fx-ellipsis"},[t._v(t._s(t.data.rdcDTO.name))]),i("stateTag",{staticClass:"state-tag",attrs:{billState:t.data.billState}})],1),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No fx-ellipsis"},[t._v(t._s(t.data.shopDTO.name))]),i("div",{staticClass:"order-count"},[i("span",{staticClass:"order-count-key"},[t._v("明细数：")]),i("span",{staticClass:"order-count-value"},[t._v(t._s(t.data.detailCount))])])]),i("div",{staticClass:"block-value"},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("uniformDistributionRtnBill.taxOutmoney"),expression:"$fxAuth('uniformDistributionRtnBill.taxOutmoney')"}],staticClass:"order-No fx-price-font"},[i("span",[t._v("含税金额：")]),i("span",[t._v("￥"+t._s(t._f("filterPrice")(t.data.sumTaxOutMoney,{len:this.sysPointSize,pushZero:!1})))])]),i("div",{staticClass:"order-date"},[i("span",[t._v("业务日期：")]),i("span",[t._v(t._s(t._f("filterDateYMD")(t.data.businessDate)))]),i("van-icon",{staticClass:"order-date-arrow",attrs:{name:"arrow"}})],1)]),i("checkBox",{staticClass:"order-checkbox",attrs:{visibleFlag:t.showCheckBox,checked:t.data.checked}})],1)},g=[],b=i("0f38"),S=i("0b26"),D={name:"orderBlock",components:{checkBox:b["a"],stateTag:S["a"]},props:{data:{type:Object,default:function(){return{}}},showCheckBox:{type:Boolean,default:!1}},computed:Object(u["a"])({},Object(d["c"])({sysPointSize:"sysPointSize"}),{orderBlockStyle:function(){var t=this.showCheckBox?"50px":"15px";return{paddingLeft:t}}}),methods:{onClick:function(){this.showCheckBox?this.$set(this.data,"checked",!this.data.checked):this.$emit("on-click",this.data)}}},w=D,I=(i("6d38"),i("2877")),k=Object(I["a"])(w,v,g,!1,null,"ab689d6a",null),C=k.exports,x=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"filter-popup"},[i("w-header",{attrs:{title:"筛选条件",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{ref:"filterContent",staticClass:"filter-content"},[i("van-cell-group",[i("van-cell",{attrs:{title:"业务日期"}}),i("van-cell",{attrs:{title:"起始时间",value:t.beginDate,"is-link":""},on:{click:t.onBeginDateClick}}),i("van-cell",{attrs:{title:"结束时间",value:t.endDate,"is-link":""},on:{click:t.endDateClick}}),i("van-cell",{attrs:{title:"配送中心",value:t.rdc,"value-class":"info-item-value","is-link":""},on:{click:t.onRdcClick}}),i("van-cell",{attrs:{title:"退货机构",value:t.shop,"value-class":"info-item-value","is-link":""},on:{click:t.onShopClick}}),i("van-cell",{attrs:{title:"退货仓库",value:t.store,"value-class":"info-item-value","is-link":""},on:{click:t.onStoreClick}}),i("van-cell",{attrs:{title:"品项",value:t.item,"value-class":"info-item-value","is-link":""},on:{click:t.onItemClick}}),i("van-cell",{attrs:{title:"单据类型",value:t.billType,"value-class":"info-item-value"},on:{click:t.onBillTypeClick}},[i("van-icon",{staticClass:"item-clear-btn",attrs:{slot:"right-icon",name:t.billTypeId?"close":"arrow"},on:{click:function(e){e.stopPropagation(),t.billTypeId?t.onBillTypeClearClick():t.onBillTypeClick()}},slot:"right-icon"})],1),i("van-field",{ref:"billNo",attrs:{label:"系统单号","value-class":"info-item-value",placeholder:"请输入系统单号","input-align":"right"},on:{focus:function(e){return t.onFocus("billNo")}},model:{value:t.billNo,callback:function(e){t.billNo=e},expression:"billNo"}})],1)],1),i("div",{staticClass:"filter-bottom"},[i("van-button",{staticClass:"reset-btn fx-no-radius",attrs:{type:"info"},on:{click:t.onResetClick}},[t._v("重置")]),i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onConfirmClick}},[t._v("确定")])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("filterListPopup",{attrs:{title:"配送中心检索",rollingLoad:!0,getDataApi:t.getRdcListData},on:{"on-select":function(e){return t.selectRdc(arguments)}},model:{value:t.rdcPopShow,callback:function(e){t.rdcPopShow=e},expression:"rdcPopShow"}}),i("filterListPopup",{attrs:{title:"退货机构检索",rollingLoad:!0,getDataApi:t.getShopListData},on:{"on-select":function(e){return t.selectShop(arguments)}},model:{value:t.shopPopShow,callback:function(e){t.shopPopShow=e},expression:"shopPopShow"}}),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.storePopShow,callback:function(e){t.storePopShow=e},expression:"storePopShow"}},[i("listComp",{attrs:{visibleFlag:t.storePopShow,data:t.storeList,loadFinished:!0,title:"退货仓库检索"},on:{"update:visibleFlag":function(e){t.storePopShow=e},"update:visible-flag":function(e){t.storePopShow=e},"on-search":t.searchStore,"on-select":t.selectStore}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.itemPopShow,callback:function(e){t.itemPopShow=e},expression:"itemPopShow"}},[i("listComp",{attrs:{visibleFlag:t.itemPopShow,data:t.itemList,loadFinished:t.itemListLoadFinished,loading:t.onItemLoading,title:"品项检索"},on:{"update:visibleFlag":function(e){t.itemPopShow=e},"update:visible-flag":function(e){t.itemPopShow=e},"update:loading":function(e){t.onItemLoading=e},"on-search":t.searchItem,"on-select":t.selectItem,"on-load":t.onItemLoad}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.billTypePopShow,callback:function(e){t.billTypePopShow=e},expression:"billTypePopShow"}},[i("listComp",{attrs:{visibleFlag:t.billTypePopShow,data:t.billTypeList,loadFinished:!0,title:"单据类型检索"},on:{"update:visibleFlag":function(e){t.billTypePopShow=e},"update:visible-flag":function(e){t.billTypePopShow=e},"on-search":t.searchBillType,"on-select":t.selectBillType}})],1)],1)},y=[],P=i("768b"),T=i("f6bb"),$=i("eb03"),B=50,L={name:"filterPop",components:{listComp:T["a"],filterListPopup:$["a"]},props:{visibleFlag:Boolean,filterParams:{type:Object,default:function(){return{}}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},dateType:"",currentDate:new Date,beginDate:this.$fxCommon.orderFilterStartDate(),endDate:this.$fxCommon.orderFilterEndDate(),rdc:"请选择",rdcId:"",shop:"请选择",shopId:"",store:"请选择",storeId:"",item:"请选择",itemId:"",billType:"请选择",billTypeId:"",billNo:"",datePickerShow:!1,rdcPopShow:!1,shopPopShow:!1,storePopShow:!1,itemPopShow:!1,billTypePopShow:!1,storeList:[],itemList:[],billTypeList:[],itemListStart:0,onItemLoading:!1,itemListLoadFinished:!1}},watch:{visibleFlag:{handler:function(t){t&&this.$fxUtils.isEmptyObjSHW(this.filterParams)&&this.resetHandler()},immediate:!0}},computed:Object(u["a"])({},Object(d["c"])({loginerShopName:function(t){return t.loginer.loginerShopName},loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId},loginerOrganType:function(t){return t.loginer.loginerOrganType}})),methods:{getFilterParams:function(){return{beginDate:this.beginDate||this.$fxCommon.orderFilterStartDate(),endDate:this.endDate||this.$fxCommon.orderFilterEndDate(),rdcId:this.rdcId,shopId:this.shopId,storeId:this.storeId,itemId:this.itemId,billTypeId:this.billTypeId,billNo:this.billNo}},onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onConfirmClick:function(){this.$emit("update:visibleFlag",!1),this.$emit("update:filterParams",this.getFilterParams()),this.$emit("on-confirm",this.getFilterParams())},onResetClick:function(){this.resetHandler()},resetHandler:function(){this.beginDate=this.$fxCommon.orderFilterStartDate(),this.endDate=this.$fxCommon.orderFilterEndDate(),this.rdc="请选择",this.rdcId="",this.store="请选择",this.storeId="",this.item="请选择",this.itemId="",this.billType="请选择",this.billTypeId="",this.billNo="",this.shop="请选择",this.shopId=""},onBeginDateClick:function(){this.dateType="begin",this.beginDate&&(this.currentDate=new Date(this.beginDate)),this.datePickerShow=!0},endDateClick:function(){this.dateType="end",this.endDate&&(this.currentDate=new Date(this.endDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){"begin"===this.dateType?(this.beginDate=this.$fxUtils.setDateTime(t,"时分"),this.endDate&&this.$fxCommon.orderFilterRangeDate(this.beginDate,this.endDate)||(this.endDate=this.$fxCommon.orderFilterDate(t))):(this.endDate=this.$fxUtils.setDateTime(t,"时分"),this.beginDate&&this.$fxCommon.orderFilterRangeDate(this.beginDate,this.endDate)||(this.beginDate=this.$fxCommon.orderFilterStartDate(t))),this.datePickerShow=!1},onRdcClick:function(){this.rdcPopShow=!0},selectRdc:function(t){var e=Object(P["a"])(t,1),i=e[0];this.rdc=i.name,this.rdcId=i.id},getRdcListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,n={keyword:t,start:e,size:i,orgFlag:1};return this.$fxApi("z5common.getUserManageShop")({data:n}).then(function(t){return t.shops})},onShopClick:function(){this.shopPopShow=!0},selectShop:function(t){var e=Object(P["a"])(t,1),i=e[0];this.shop=i.name,this.shopId=i.id},getShopListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,n={keyword:t,start:e,size:i,orgFlag:0};return this.$fxApi("z5common.getUserManageShop")({data:n}).then(function(t){return t.shops})},onStoreClick:function(){if(!this.shopId)return this.$fxToast.fail("请选择机构!"),!1;this.onStoreRefresh()},searchStore:function(t){this.onStoreRefresh(t)},selectStore:function(t){this.store=t.name,this.storeId=t.id},onStoreRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getStoreListData(e).then(function(e){t.storeList=e.shops,t.storePopShow=!0})},getStoreListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new c.a(function(i){var n={keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/houses"),data:n}).then(function(t){i(t)})})},onItemClick:function(){this.onItemRefresh()},searchItem:function(t){this.onItemRefresh(t)},selectItem:function(t){this.item=t.name,this.itemId=t.id},onItemRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.itemListStart=0,this.itemListLoadFinished=!1,this.getItemListData(e).then(function(e){t.itemPopShow=!0,t.onItemLoading=!1,t.itemListStart+=B,e.goods.length<B&&(t.itemListLoadFinished=!0),t.itemList=e.goods})},onItemLoad:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getItemListData(e).then(function(e){var i;t.onItemLoading=!1,t.itemListStart+=B,e.goods.length<B&&(t.itemListLoadFinished=!0),(i=t.itemList).push.apply(i,Object(s["a"])(e.goods))})},getItemListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new c.a(function(i){var n={start:t.itemListStart,size:B,paged:!0,keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/goods"),data:n}).then(function(t){i(t)})})},onBillTypeClick:function(){this.onBillTypeRefresh()},searchBillType:function(t){this.onBillTypeRefresh(t)},selectBillType:function(t){this.billType=t.name,this.billTypeId=t.id},onBillTypeRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getBillTypeListData(e).then(function(e){t.billTypeList=e.businessTypes,t.billTypePopShow=!0})},getBillTypeListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new c.a(function(i){var n={billType:"34_1",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/businessTypes"),data:n}).then(function(t){i(t)})})},onFocus:function(t){this.onScrollTop(t)},onScrollTop:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,i=this.$refs[t];if(!i||0===i.length)return!1;var n=i.$el.offsetTop,o=this.$refs["filterContent"];this.$fxUtils.scrollTopW({offsetTop:n,$el:o,distance:e})},onBillTypeClearClick:function(){this.billType="请选择",this.billTypeId=""}}},O=L,R=(i("f255"),Object(I["a"])(O,x,y,!1,null,"02947b34",null)),F=R.exports,E=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"uniformDistributionRtn-filter fx-shadow-down"},[i("div",{staticClass:"filter-item",on:{click:t.onStateClick}},[i("span",[t._v("审核状态")]),i("van-icon",{staticClass:"filter-arrow",attrs:{name:"arrow-down"}}),i("span",[t._v(t._s(t.state))])],1)])},A=[],_={name:"filterTab",props:{state:String,sendBillState:String},methods:{onStateClick:function(){this.$emit("on-state-click")}}},U=_,H=(i("022e"),Object(I["a"])(U,E,A,!1,null,"04c315aa",null)),N=H.exports,W=50,j={name:"uniformDistributionRtnBill",components:{headSearchBtn:h["a"],headEditBtn:f["a"],headSelectAllBtn:p["a"],emptyBill:m["a"],orderBlock:C,filterPop:F,filterTab:N},data:function(){return{orderList:[],filterPopShow:!1,filterState:null,stateActionShow:!1,stateActions:[{id:null,name:"全部"},{id:"0",name:"未审核"},{id:"1",name:"已审核"}],listStart:0,pullRefreshLoading:!1,listLoading:!1,loadFinished:!0,listError:!1,orderEditFlag:!1,filterParams:{}}},beforeRouteLeave:function(t,e,i){if("/login"===t.path)i();else{if(this.filterPopShow)return this.filterPopShow=!1,this.$router.go(1),!1;i()}},beforeRouteEnter:function(t,e,i){var n=["/main/home","/"],o=["/uniformDistributionRtnBillDetails"];n.includes(e.path)?i(function(e){e.restFilterParams(),e.restRouterParams(t.params),e.refreshOrderList()}):o.includes(e.path)?i(function(t){t.refreshOrderList()}):i()},computed:Object(u["a"])({},Object(d["c"])({billListPostParams:"billListPostParams",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{computedState:function(){var t=this;return this.stateActions.find(function(e){return e.id===t.filterState}).name},computedShowOrder:function(t){var e=this;return function(t){return!e.orderEditFlag||1!==t}},isSelectAll:function(){var t=this.orderList.filter(function(t){return 1!==t.billState});if(0===t.length)return!1;var e=t.filter(function(t){return!!t.checked});return e.length===t.length}}),methods:{orderListPostHandler:function(t){var e=this;return new c.a(function(i){e.$store.commit({type:"SETSTATE",billListPostParams:t}),e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/distributionRtn/users/").concat(e.loginerId),data:t}).then(function(t){i(t)})})},refreshOrderList:function(){var t=this;return new c.a(function(e){t.listStart=0;var i={start:t.listStart,size:W,paged:!0,businessDateStart:t.$fxCommon.orderFilterStartDate(),businessDateEnd:t.$fxCommon.orderFilterEndDate(),billState:t.filterState};i=r()(i,t.translateFilterParams(t.filterParams)),t.orderListPostHandler(i).then(function(i){t.orderList=i.storeBills,e(i)})})},onFilterConfirm:function(t){var e=this;this.listStart=0;var i={start:this.listStart,size:W,paged:!0,businessDateStart:t.beginDate,businessDateEnd:t.endDate,billState:this.filterState,rdcId:""===t.rdcId?null:t.rdcId,shopId:""===t.shopId?null:t.shopId,houseId:""===t.storeId?null:t.storeId,goodsId:""===t.itemId?null:t.itemId,businessType:""===t.billTypeId?null:t.billTypeId,sysBillCode:""===t.billNo?null:t.billNo};this.orderListPostHandler(i).then(function(t){e.orderList=t.storeBills})},translateFilterParams:function(t){return this.$fxUtils.isEmptyObjSHW(t)?{}:{businessDateStart:t.beginDate,businessDateEnd:t.endDate,rdcId:""===t.rdcId?null:t.rdcId,shopId:""===t.shopId?null:t.shopId,houseId:""===t.storeId?null:t.storeId,goodsId:""===t.itemId?null:t.itemId,businessType:""===t.billTypeId?null:t.billTypeId,sysBillCode:""===t.billNo?null:t.billNo}},onPullRefresh:function(){var t=this;this.refreshOrderList().then(function(e){t.pullRefreshLoading=!1})},onLoadMore:function(){var t=this,e=r()(this.billListPostParams,{start:this.listStart});this.orderListPostHandler(e).then(function(e){var i;(i=t.orderList).push.apply(i,Object(s["a"])(e.storeBills))})},onSearchClick:function(){this.filterPopShow=!0},onStateClick:function(){this.stateActionShow=!0},onStateSelect:function(t){this.filterState=t.id,this.stateActionShow=!1,this.refreshOrderList()},onClickOrder:function(t){this.$router.push({path:"uniformDistributionRtnBillDetails",query:{orderId:t.id}})},onCreateClick:function(){this.$router.push("createUniformDistributionRtnBill")},onOrderEditClick:function(){this.orderEditFlag=!this.orderEditFlag},onExpressClick:function(){var t=this,e=this.orderList.reduce(function(t,e){var i=e.checked?t.concat(e.id):t;return i},[]);if(0===e.length)return!1;this.$dialog.confirm({title:"提示",message:"确定要审核所选单据?"}).then(function(){t.expressHandler(e).then(function(e){t.orderEditFlag=!t.orderEditFlag,t.refreshOrderList().then(function(){t.$fxToast.success(e.message)})})})},expressHandler:function(t){var e=this;return new c.a(function(i){e.$fxHttp.requestPut({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/distributionRtn/users/").concat(e.loginerId),data:t,query:{m:"batchCheck"}}).then(function(t){i(t)})})},onSelectAllClick:function(){var t=this,e=!this.isSelectAll;this.orderList.forEach(function(i){1!==i.billState&&t.$set(i,"checked",e)})},restFilterParams:function(){this.filterParams={},this.filterState=null,this.orderEditFlag=!1},restRouterParams:function(t){this.$fxUtils.isEmptyObjSHW(t)||(this.filterState=t.billState)}}},M=j,q=(i("b429"),Object(I["a"])(M,n,o,!1,null,"e46a17f8",null));e["default"]=q.exports},b3d8:function(t,e,i){"use strict";var n=i("1774"),o=i.n(n);o.a},b429:function(t,e,i){"use strict";var n=i("d738"),o=i.n(n);o.a},c0bf:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"import-bill"},[i("w-header",{attrs:{title:"选择导入单据",border:!0,leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("inStoreDateComp",{attrs:{beginDate:t.beginDate,endDate:t.endDate},on:{"on-beginDate-click":t.onBeginDateClick,"on-endDate-click":t.onEndDateClick,"on-search-click":t.onSearchClick}}),i("div",{staticClass:"import-bill-content"},[i("van-pull-refresh",{directives:[{name:"show",rawName:"v-show",value:0!==t.orderList.length,expression:"orderList.length !== 0"}],staticClass:"import-bill-list",on:{refresh:t.onPullRefresh},model:{value:t.pullRefreshLoading,callback:function(e){t.pullRefreshLoading=e},expression:"pullRefreshLoading"}},[i("van-list",{attrs:{finished:t.loadFinished,"finished-text":"没有更多了",error:t.listError,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.listError=e},load:t.onLoadMore},model:{value:t.listLoading,callback:function(e){t.listLoading=e},expression:"listLoading"}},t._l(t.orderList,function(e){return i("importBillBlock",{key:e.id,attrs:{data:e},on:{"on-click":function(i){return t.onClickOrder(e)}}})}),1)],1),i("emptyBill",{directives:[{name:"show",rawName:"v-show",value:0===t.orderList.length,expression:"orderList.length === 0"}],attrs:{message:"暂无可导入单据"}})],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.importItemPopShow,callback:function(e){t.importItemPopShow=e},expression:"importItemPopShow"}},[i("importItemComp",{attrs:{visibleFlag:t.importItemPopShow,storeItemData:t.importItemData},on:{"update:visibleFlag":function(e){t.importItemPopShow=e},"update:visible-flag":function(e){t.importItemPopShow=e},"on-item-import-confirm":t.onImportConfirm}})],1)],1)},o=[],s=i("f499"),a=i.n(s),r=(i("7514"),i("b6d0")),l=i.n(r),c=i("774e"),u=i.n(c),d=(i("ac6a"),i("59ad")),h=i.n(d),f=i("75fc"),p=i("5176"),m=i.n(p),v=i("795b"),g=i.n(v),b=i("cebc"),S=i("2f62"),D=i("4102"),w=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inStore-date"},[i("div",{staticClass:"date-box"},[i("div",[t._v("入库日期")]),i("div",{staticClass:"begin-date-box",on:{click:function(e){return t.onEmitHandler("on-beginDate-click")}}},[t._v(t._s(t.beginDate))]),i("div",[t._v("至")]),i("div",{staticClass:"end-date-box",on:{click:function(e){return t.onEmitHandler("on-endDate-click")}}},[t._v(t._s(t.endDate))])]),i("van-button",{staticClass:"search-btn",attrs:{type:"primary",size:"mini",round:""},on:{click:function(e){return t.onEmitHandler("on-search-click")}}},[t._v("查询")])],1)},I=[],k=(i("c5f6"),{name:"inStoreDate",props:{beginDate:[String,Number],endDate:[String,Number]},methods:{onEmitHandler:function(t){this.$emit(t)}}}),C=k,x=(i("68d6"),i("2877")),y=Object(x["a"])(C,w,I,!1,null,"fd70e6e8",null),P=y.exports,T=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-block fx-shadow-block",on:{click:t.onClick}},[i("div",{staticClass:"block-title"},[i("i",{staticClass:"block-icon"}),i("span",{staticClass:"title-text"},[t._v(t._s(t.data.sysbillCode))])]),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-date"},[i("span",[t._v("业务日期：")]),i("span",[t._v(t._s(t._f("filterDateYMD")(t.data.businessDate)))])]),i("div",{staticClass:"order-count"},[i("span",{staticClass:"order-count-key"},[t._v("明细数：")]),i("span",{staticClass:"order-count-value"},[t._v(t._s(t.data.detailCount))])])])])},$=[],B={name:"importBillBlock",props:{data:{type:Object,default:function(){return{}}}},methods:{onClick:function(){this.$emit("on-click",this.data)}}},L=B,O=(i("db98"),Object(x["a"])(L,T,$,!1,null,"3940d8ae",null)),R=O.exports,F=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"import-bill"},[i("w-header",{attrs:{title:"选择导入品项",border:!0,leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}},[i("headSelectAllBtn",{attrs:{slot:"header-right",active:t.isSelectAll},on:{click:t.onSelectAllClick},slot:"header-right"})],1),i("div",{staticClass:"import-bill-content"},[t._l(t.storeItemData,function(e){return i("div",{directives:[{name:"show",rawName:"v-show",value:0!==t.storeItemData.length,expression:"storeItemData.length !== 0"}],key:e.id,staticClass:"store-item-block fx-shadow-block"},[i("div",{staticClass:"item-store-title fx-ellipsis"},[t._v(t._s(e.name))]),t._l(e.details,function(t){return i("importItemInfoCell",{key:e.id+"-"+t.goodsDTO.id,attrs:{itemData:t}})})],2)}),i("emptyBill",{directives:[{name:"show",rawName:"v-show",value:0===t.storeItemData.length,expression:"storeItemData.length === 0"}],attrs:{message:"暂无可导入品项"}})],2),i("div",{staticClass:"import-bill-bottom"},[i("van-button",{staticClass:"add-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onImportConfirm}},[t._v("导入品项")])],1)],1)},E=[],A=(i("20d6"),i("a0be")),_=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-info-cell",on:{click:t.onClick}},[i("checkBox",{staticClass:"order-checkbox",attrs:{visibleFlag:!0,checked:t.itemData.checked},on:{"on-checkbox-click":t.onClick}}),i("div",{staticClass:"item-img"},[i("img",{attrs:{src:t.comptedItemImgSrc(t.itemData.goodsDTO.imageUrls||[]),onerror:t.$fxCommon.errorImg("item")}})]),i("div",{staticClass:"item-details"},[i("div",{staticClass:"item-name fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.name))]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionInBill.seewithtaxmoney"),expression:"$fxAuth('distributionInBill.seewithtaxmoney')"}],staticClass:"item-taxprice fx-ellipsis"},[i("span",[t._v("含税金额：￥")]),i("span",[t._v(t._s(t.itemData.inMoneyWithTax))])]),i("div",{staticClass:"item-amount-spec"},[i("div",{staticClass:"item-spec fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.spec))]),i("div",{staticClass:"item-amount"},[i("span",[t._v("入库数量：")]),i("span",{staticClass:"item-amount-text"},[t._v(t._s(t.itemData.busUnitInAmount))]),i("span",[t._v(t._s(t.itemData.unitDTO.name))])])])])],1)},U=[],H=i("0f38"),N={name:"importItemInfoCell",components:{checkBox:H["a"]},props:{itemData:{type:Object,default:function(){return{}}}},computed:{comptedItemImgSrc:function(t){return function(t){return 0===t.length?"":t[0]}}},methods:{onClick:function(){this.$set(this.itemData,"checked",!this.itemData.checked)}}},W=N,j=(i("d65a"),Object(x["a"])(W,_,U,!1,null,"6ac15e13",null)),M=j.exports,q={name:"impportBill",components:{headSelectAllBtn:A["a"],importItemInfoCell:M,emptyBill:D["a"]},props:{visibleFlag:Boolean,storeItemData:{type:Array,default:function(){return[]}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0}}},computed:{isSelectAll:function(){for(var t=!0,e=0;e<this.storeItemData.length;e++){var i=this.storeItemData[e].details.findIndex(function(t){return!0!==t.checked});if(~i){t=!1;break}}return t}},methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onSelectAllClick:function(){this.selectAllHandler()},selectAllHandler:function(){var t=this,e=this.isSelectAll;this.storeItemData.forEach(function(i){i.details.forEach(function(i){t.$set(i,"checked",!e)})})},onImportConfirm:function(){var t=this.findSelectItem();if(0===t.length)return this.$fxToast.fail("请选择导入品项"),!1;this.$emit("on-item-import-confirm",this.findSelectItem())},findSelectItem:function(){return this.storeItemData.reduce(function(t,e){var i=e.details.filter(function(t){return!0===t.checked});return t.push.apply(t,Object(f["a"])(i)),t},[])}}},z=q,Z=(i("cddf"),Object(x["a"])(z,F,E,!1,null,"91605492",null)),G=Z.exports,K=50,J={name:"impportBill",components:{emptyBill:D["a"],inStoreDateComp:P,importBillBlock:R,importItemComp:G},props:{visibleFlag:Boolean,orderInfo:{type:Object,default:function(){return{}}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},dateType:"",currentDate:new Date,beginDate:this.$fxCommon.orderFilterStartDate(),endDate:this.$fxCommon.orderFilterEndDate(),datePickerShow:!1,billListParams:{},orderList:[],listStart:0,pullRefreshLoading:!1,listLoading:!1,loadFinished:!1,listError:!1,importItemPopShow:!1,importItemData:[],formatterSysPointKey:["price","inMoney","taxInMoney","inMoneyWithTax","busUnitInAmount"]}},computed:Object(b["a"])({},Object(S["c"])({sysPointSize:"sysPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}})),watch:{visibleFlag:{handler:function(t){t&&this.initImportBill()},immediate:!0}},methods:{initImportBill:function(){this.beginDate=this.$fxCommon.orderFilterStartDate(),this.endDate=this.$fxCommon.orderFilterEndDate(),this.refreshOrderList()},onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onBeginDateClick:function(){this.dateType="begin",this.beginDate&&(this.currentDate=new Date(this.beginDate)),this.datePickerShow=!0},onEndDateClick:function(){this.dateType="end",this.endDate&&(this.currentDate=new Date(this.endDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){var e=this.$fxUtils.setDateTime(t,"时分");"begin"===this.dateType?this.beginDate=e:this.endDate=e,this.datePickerShow=!1},onSearchClick:function(){this.refreshOrderList()},orderListPostHandler:function(t){var e=this;return new g.a(function(i){e.billListParams=t,e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/distributionRtn/users/").concat(e.loginerId),data:t,query:{m:"importBill"}}).then(function(t){e.listStart+=K,e.listLoading=!1,t.storeBills.length<K&&(e.loadFinished=!0),i(t)})})},refreshOrderList:function(){var t=this;return new g.a(function(e){t.listStart=0;var i={start:t.listStart,size:K,paged:!0,businessDateStart:t.beginDate,businessDateEnd:t.endDate,billId:t.orderInfo.id,billState:1,shopId:t.orderInfo.shopDTO.id,rdcId:t.orderInfo.rdcDTO.id};t.orderListPostHandler(i).then(function(i){t.orderList=i.storeBills,e(i)})})},onPullRefresh:function(){var t=this;this.refreshOrderList().then(function(e){t.pullRefreshLoading=!1})},onLoadMore:function(){var t=this,e=m()(this.billListParams,{start:this.listStart});this.orderListPostHandler(e).then(function(e){var i;(i=t.orderList).push.apply(i,Object(f["a"])(e.storeBills))})},onClickOrder:function(t){this.importItemPopShow=!0,this.formatterSysPoint(t.details),this.importItemData=this.filterStoreItem(t.details)},formatterSysPoint:function(t){var e=this,i=function(t){return h()(e.$fxUtils.toFixedSHW(t,e.sysPointSize))};t.forEach(function(t){e.formatterSysPointKey.forEach(function(e){t[e]=i(t[e])})})},filterStoreItem:function(t){var e=u()(new l.a(t.map(function(t){return t.inHouseDTO.id}))),i=e.map(function(e){var i=t.find(function(t){return t.inHouseDTO.id===e}).inHouseDTO;return i=JSON.parse(a()(i)),i.details=t.filter(function(t){return t.inHouseDTO.id===e}),i});return i},onImportConfirm:function(t){this.importItemPopShow=!1,this.$emit("update:visibleFlag",!1),this.$emit("on-item-import-confirm",t)}}},Y=J,Q=(i("b3d8"),Object(x["a"])(Y,n,o,!1,null,"5dcba948",null));e["a"]=Q.exports},cddf:function(t,e,i){"use strict";var n=i("20fc"),o=i.n(n);o.a},cf1d:function(t,e,i){"use strict";var n=i("60bc"),o=i.n(n);o.a},d65a:function(t,e,i){"use strict";var n=i("b10f"),o=i.n(n);o.a},d738:function(t,e,i){},db98:function(t,e,i){"use strict";var n=i("2ad6"),o=i.n(n);o.a},ddd3:function(t,e,i){"use strict";var n=i("a0d6"),o=i.n(n);o.a},f255:function(t,e,i){"use strict";var n=i("8371"),o=i.n(n);o.a}}]);
//# sourceMappingURL=uniformDistributionRtnBill.2d8deb9b.js.map