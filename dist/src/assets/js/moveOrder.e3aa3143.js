(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["moveOrder"],{"01f7":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"details-content",staticClass:"item-details-content"},[i("van-list",{attrs:{finished:t.loadFinished,"finished-text":"没有更多了",error:t.listError,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.listError=e},load:t.onLoadMore},model:{value:t.currentListLoading,callback:function(e){t.currentListLoading=e},expression:"currentListLoading"}},t._l(t.itemList,function(e,o){return i("div",{key:e.goodsDTO.id,ref:"details-row-"+o,refInFor:!0,staticClass:"item-detail"},[t._t("item-cell",null,{$item:e,$index:o})],2)}),0)],1)},n=[],s=i("795b"),a=i.n(s),r=(i("c5f6"),{name:"addItemList",props:{value:[String,Number],itemList:{type:Array,default:function(){return[]}},listLoading:Boolean,loadFinished:Boolean,listError:{type:Boolean,default:!1}},data:function(){return{currentListLoading:!1}},watch:{listLoading:{handler:function(t){this.currentListLoading=t},immediate:!0},currentListLoading:function(t){this.$emit("update:listLoading",t)}},computed:{comptedItemImgSrc:function(t){return function(t){return 0===t.length?"":t[0]}}},methods:{onLoadMore:function(){this.$emit("on-load-more")},onSelectLetter:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40,i=this.$refs["details-row-".concat(t)];if(!i||0===i.length)return!1;var o=i[0].offsetTop,n=this.$refs["details-content"];this.$fxUtils.scrollTopW({offsetTop:o,$el:n,distance:e})},prev:function(t){var e=this;return new a.a(function(i){if(0===t)return!1;var o=t-1,n=e.itemList[o];e.onSelectLetter(o),i({data:n,index:o})})},next:function(t){var e=this;return new a.a(function(i){if(t===e.itemList.length-1)return!1;var o=t+1,n=e.itemList[o];e.onSelectLetter(o),i({data:n,index:o})})}}}),l=r,c=(i("2f8b"),i("2877")),u=Object(c["a"])(l,o,n,!1,null,"7690e6e7",null);e["a"]=u.exports},"02a5":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-info-cell"},[i("div",{staticClass:"item-img"},[i("img",{attrs:{src:t.comptedItemImgSrc(t.itemData.goodsDTO.imageUrls),onerror:t.$fxCommon.errorImg("item")}})]),i("div",{staticClass:"item-details"},[i("div",{staticClass:"item-name fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.name))]),i("div",{staticClass:"details-cell"},[i("div",{staticClass:"item-spec fx-ellipsis"},[t._v("\n\t\t\t\t"+t._s(t.itemData.goodsDTO.spec)+"\n\t\t\t")])]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isDisabled,expression:"isDisabled"}],staticClass:"item-amount"},[i("span",{staticClass:"item-amount-text"},[t._v(t._s(t.itemData.busUnitAmount))]),i("span",[t._v(t._s(t.itemData.unitDTO.name))])]),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"item-amount-edit"},[i("w-stepper",{ref:"amountInput",staticClass:"amount-step",attrs:{min:"0",max:t.maxAmount,stepperBtnShow:!1,intLength:t.numberLength,pointSize:t.sysPointSize,inputWidth:"28vw"},on:{change:t.onChange,focus:t.onFocus,blur:t.onBlur},model:{value:t.itemData.busUnitAmount,callback:function(e){t.$set(t.itemData,"busUnitAmount",e)},expression:"itemData.busUnitAmount"}}),i("div",{staticClass:"item-unit"},[i("span",{staticClass:"item-unit-text",on:{click:function(e){return e.stopPropagation(),t.onUnitClick(e)}}},[t._v(t._s(t.itemData.unitDTO.name))]),i("van-icon",{attrs:{name:"arrow-down"}})],1)],1)]),i("i",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&!t.disabledEditBtn,expression:"!isDisabled && !disabledEditBtn"}],staticClass:"block-item-edit",on:{click:t.onItemEditClick}}),i("i",{directives:[{name:"show",rawName:"v-show",value:t.isDisabled,expression:"isDisabled"}],staticClass:"block-item-watch",on:{click:t.onItemEditClick}})])},n=[],s=i("795b"),a=i.n(s),r=i("59ad"),l=i.n(r),c=i("cebc"),u=i("2f62"),h={name:"itemInfoCell",props:{itemData:{type:Object,default:function(){return{}}},isDisabled:Boolean,disabledEditBtn:Boolean},computed:Object(c["a"])({},Object(u["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",maxAmount:"maxAmount"}),{comptedItemImgSrc:function(t){return function(t){return 0===t.length?"":t[0]}}}),methods:{editItem:function(){this.itemData.id&&this.$set(this.itemData,"changeType","edit")},onItemEditClick:function(){var t=this;this.onCheckAmount(!1).then(function(){t.editItem(),t.$emit("on-item-edit",t.itemData)})},onChange:function(t){if("del"===this.itemData.changeType)return!1;this.editItem(),this.onAmountChange(t)},onAmountChange:function(t){this.editItem();var e=this.itemData,i=e.inMoneyWithTax,o=e.taxPrice,n=e.inMoney,s=e.taxInMoney,a=e.price,r=e.tax;i=l()(this.$fxUtils.toFixedSHW(o*t,this.sysPointSize)),n=l()(this.$fxUtils.toFixedSHW(a*t,this.sysPointSize)),s=l()(this.$fxUtils.toFixedSHW(n*r,this.sysPointSize)),this.itemData.inMoneyWithTax=i,this.itemData.inMoney=n,this.itemData.taxInMoney=s},onUnitClick:function(){var t=this;if(this.isDisabled)return!1;this.onCheckAmount(!1).then(function(){t.editItem(),t.$emit("on-unit-edit",t.itemData)})},onFocus:function(){this.$emit("on-item-focus")},onBlur:function(){var t=this;this.onCheckAmount().then(function(){t.$emit("on-item-blur")}).catch(function(){t.$refs.amountInput.setFocus(),t.$emit("on-item-focus")})},onCheckAmount:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new a.a(function(i,o){var n=t.itemData.busUnitAmount,s="数量不符合规则";0===n?t.$nextTick(function(){e&&t.$fxNotify.fail("调拨数量不能为0!"),o(s)}):i()})}}},d=h,f=(i("4457"),i("2877")),p=Object(f["a"])(d,o,n,!1,null,"7cf1f4c9",null);e["a"]=p.exports},"02b1":function(t,e,i){},"0533":function(t,e,i){},"0bc1":function(t,e,i){"use strict";var o=i("8918"),n=i.n(o);n.a},"0eee":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-search-block"},[i("w-header",{attrs:{title:"搜索品项",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("searchHead",{attrs:{initSearch:t.visibleFlag,searchKey:t.searchKey,selectActive:t.isSelectAll},on:{"update:searchKey":function(e){t.searchKey=e},"update:search-key":function(e){t.searchKey=e},"on-select-click":t.onSelectAllClick}}),i("div",{ref:"details-content",staticClass:"item-list"},t._l(t.$fxCommon.detailFilter(t.data,t.searchKey),function(e,o){return i("van-swipe-cell",{directives:[{name:"show",rawName:"v-show",value:"del"!==e.changeType,expression:"item.changeType !== 'del'"}],key:e.goodsDTO.id,ref:"details-row-"+e.goodsDTO.id,refInFor:!0,staticClass:"item-row",attrs:{"right-width":80,disabled:t.isDisabled||t.focusing}},[i("div",{staticClass:"item-cell"},[i("checkBox",{staticClass:"search-checkbox",attrs:{visibleFlag:!t.isDisabled,checked:e.checked},on:{"on-checkbox-click":function(i){return t.onCheckBoxClick(e)}}}),i("itemInfoCell",{staticClass:"search-info",attrs:{itemData:e,isDisabled:t.isDisabled,disabledEditBtn:t.focusing},on:{"on-item-focus":function(i){return t.onItemFocus(arguments,""+e.goodsDTO.id)},"on-item-blur":t.onItemBlur,"on-unit-edit":t.onUnitEdit,"on-item-edit":t.onSearchItemEdit}})],1),i("div",{staticClass:"item-row-delete",attrs:{slot:"right"},on:{click:function(i){return t.onDeleteClick(e,o,t.data)}},slot:"right"},[t._v("删除")])])}),1),i("div",{staticClass:"search-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onSearchConfirm}},[t._v("保存")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:t.onSelectConfirm}},[t._v("删除")])],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,isDisabled:t.isDisabled},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1)],1)},n=[],s=(i("7514"),i("ac6a"),i("59ad")),a=i.n(s),r=i("795b"),l=i.n(r),c=(i("20d6"),i("cebc")),u=i("2f62"),h=i("02a5"),d=i("88b2"),f=i("01db"),p=i("0f38"),m={name:"itemSearchPop",components:{itemInfoCell:h["a"],itemRowEditPop:d["a"],searchHead:f["a"],checkBox:p["a"]},props:{data:{type:Array,default:function(){return[]}},isDisabled:Boolean,visibleFlag:Boolean},data:function(){return{focusing:!1,leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",itemRowEditPopShow:!1,itemEditRowData:{},unitActions:[],unitActionShow:!1}},watch:{visibleFlag:{handler:function(t){t&&(this.searchKey="")},immediate:!0}},computed:Object(c["a"])({},Object(u["c"])({sysPointSize:"sysPointSize"}),{isSelectAll:function(){if(this.isDisabled)return"";var t=0,e=0,i=this.$fxCommon.detailFilter(this.data,this.searchKey);return t=i.filter(function(t){return"del"!==t.changeType&&t.checked}).length,e=i.length,0!==t&&t===e}}),methods:{onCloseClick:function(){if(this.focusing)return!1;this.$emit("update:visibleFlag",!1)},onDeleteClick:function(t,e,i){t.id?(this.$set(t,"changeType","del"),this.$set(t,"busUnitAmount",0)):i.splice(e,1)},onItemFocus:function(t,e){this.focusing=!0},onItemBlur:function(){this.focusing=!1},onSearchItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this.data.findIndex(function(e){return e.id===t.id});~e&&(this.data[e]=t)},onUnitEdit:function(t){var e=this;this.itemEditRowData=t,this.getItemUnit(t.goodsDTO.id).then(function(t){e.unitActions=t,e.unitActionShow=!0})},getItemUnit:function(t){var e=this;return new l.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/shopId/users/userId/goods/").concat(t,"/units"),query:{userId:e.loginerId}}).then(function(t){i(t.units)})})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemEditRowData,i=e.unitDTO,o=i.value/t.value,n=a()(this.$fxUtils.toFixedSHW(e.busUnitAmount*o,this.sysPointSize));e.unitDTO=t,e.busUnitAmount=n,e.id&&(e.changeType="edit")},onSearchConfirm:function(){if(this.focusing)return!1;this.data.forEach(function(t){delete t.checked}),this.$emit("on-search-confirm",this.data),this.$emit("update:visibleFlag",!1)},onCheckBoxClick:function(t){if(this.focusing)return!1;this.$set(t,"checked",!t.checked)},onSelectAllClick:function(){var t=this,e=!this.isSelectAll,i=this.$fxCommon.detailFilter(this.data,this.searchKey);i.forEach(function(i){"del"!==i.changeType&&t.$set(i,"checked",e)})},onSelectConfirm:function(){var t=this,e=this.data.find(function(t){return t.checked&&"del"!==t.changeType});if(!e)return this.$fxToast.top("请先选择品项!"),!0;this.$dialog.confirm({title:"提示",message:"是否删除？"}).then(function(){for(var e=t.data,i=e.length-1;i>=0;i--){var o=e[i];o.checked&&(o.id?t.$set(o,"changeType","del"):t.data.splice(i,1))}})}}},v=m,S=(i("ac3c"),i("2877")),g=Object(S["a"])(v,o,n,!1,null,"410807c1",null);e["a"]=g.exports},"1c13":function(t,e,i){},"247f2":function(t,e,i){"use strict";var o=i("0533"),n=i.n(o);n.a},"250f":function(t,e,i){},"25fa":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-info-block fx-shadow-block"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},[i("van-collapse-item",{attrs:{name:"1",disabled:t.collapseDisabled}},[i("div",{staticClass:"info-title",attrs:{slot:"title"},slot:"title"},[i("span",{staticClass:"info-title-name"},[t._v("单据信息")]),i("stateText",{staticClass:"stateTag fl-r",attrs:{billState:t.data.billState}})],1),i("van-tabs",{attrs:{animated:""},model:{value:t.tabActive,callback:function(e){t.tabActive=e},expression:"tabActive"}},[i("van-tab",{attrs:{title:"表头"}},[i("van-cell",{staticClass:"info-item",attrs:{title:"调入机构","value-class":"info-item-value",value:t.data.inShopDTO&&t.data.inShopDTO.name,"is-link":!t.isDisabled},on:{click:function(e){return t.onEmitClick("on-inShop-click")}}}),i("van-cell",{staticClass:"info-item",attrs:{title:"调入仓库","value-class":"info-item-value",value:t.data.inHouseDTO&&t.data.inHouseDTO.name,"is-link":!t.isDisabled},on:{click:function(e){return t.onEmitClick("on-inStore-click")}}}),i("van-cell",{staticClass:"info-item",attrs:{title:"调出机构","value-class":"info-item-value",value:t.data.outShopDTO&&t.data.outShopDTO.name,"is-link":!t.isDisabled},on:{click:function(e){return t.onEmitClick("on-outShop-click")}}}),i("van-cell",{staticClass:"info-item",attrs:{title:"调出仓库","value-class":"info-item-value",value:t.data.outHouseDTO&&t.data.outHouseDTO.name,"is-link":!t.isDisabled},on:{click:function(e){return t.onEmitClick("on-outStore-click")}}}),i("van-cell",{staticClass:"info-item",attrs:{title:"系统单号","value-class":"info-item-value",value:t.data.sysbillCode}}),i("van-cell",{staticClass:"info-item",attrs:{title:"业务日期",value:t.formatterDate(t.data.businessDate),"is-link":!t.isDisabled&&t.$fxSysAuth("shopMoveApplyBill.editWorkDate")},on:{click:t.onBusdateClick}}),i("van-cell",{staticClass:"info-item",attrs:{title:"单据类型","value-class":"info-item-value",value:t.data.businessTypeDTO&&t.data.businessTypeDTO.name},on:{click:function(e){return t.onEmitClick("on-billType-click")}}},[i("van-icon",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"item-clear-btn",attrs:{slot:"right-icon",name:t.hasBillType?"close":"arrow"},on:{click:function(e){e.stopPropagation(),t.hasBillType?t.onEmitClick("on-billType-clear"):t.onEmitClick("on-billType-click")}},slot:"right-icon"})],1)],1),i("van-tab",{attrs:{title:"更多"}},[i("van-cell",{staticClass:"info-item",attrs:{title:"制单人",value:t.data.billEmp}}),i("van-cell",{staticClass:"info-item",attrs:{title:"制单日期",value:t.formatterDate(t.data.billDate)}}),i("van-cell",{staticClass:"info-item",attrs:{title:"审核人",value:t.data.checkEmp}}),i("van-cell",{staticClass:"info-item",attrs:{title:"审核日期",value:t.formatterDate(t.data.checkDate)}}),i("van-pro-field",{staticClass:"info-item",attrs:{label:"手工单号",placeholder:t.isDisabled?"":"请输入手工单号","input-align":"right",maxlength:"50",disabled:t.isDisabled},model:{value:t.data.manualCode,callback:function(e){t.$set(t.data,"manualCode",e)},expression:"data.manualCode"}}),i("van-pro-field",{staticClass:"info-item",attrs:{label:"整单备注",placeholder:t.isDisabled?"":"请输入整单备注","input-align":"right",maxlength:"50",disabled:t.isDisabled},model:{value:t.data.billMemo,callback:function(e){t.$set(t.data,"billMemo",e)},expression:"data.billMemo"}})],1)],1)],1)],1)],1)},n=[],s=i("4760"),a={name:"orderInfo",components:{stateText:s["a"]},props:{data:{type:Object,default:function(){return{}}},isDisabled:Boolean,collapseDisabled:Boolean},data:function(){return{activeNames:["1"],tabActive:0}},computed:{formatterDate:function(t){var e=this;return function(t){return"number"===typeof t?e.$fxUtils.setDateTime(new Date(t),"时分"):""}},hasBillType:function(){return this.data.businessTypeDTO&&this.data.businessTypeDTO.id}},methods:{onEmitClick:function(t){if(this.isDisabled)return!1;this.$emit(t)},onBusdateClick:function(){if(!this.$fxSysAuth("shopMoveApplyBill.editWorkDate"))return!1;this.$emit("on-busdate-click")},closeCollapse:function(){this.activeNames=[]}}},r=a,l=(i("0bc1"),i("ddfe"),i("2877")),c=Object(l["a"])(r,o,n,!1,null,"1cb112da",null);e["a"]=c.exports},"28af":function(t,e,i){},"2f8b":function(t,e,i){"use strict";var o=i("8c37"),n=i.n(o);n.a},"359e":function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-shopOrder-details"},[i("w-header",{attrs:{title:t.orderInfoData.sysbillCode,titleFontSize:"3.733vw",border:!0}}),i("orderInfo",{ref:"orderInfo",attrs:{data:t.orderInfoData,isDisabled:t.isBillState(1)||!t.$fxAuth("shopMoveApplyBill.save"),collapseDisabled:t.itemInputFocusing},on:{"on-busdate-click":t.onBusinessDateClick,"on-inShop-click":t.onInShopClick,"on-inStore-click":t.onInStoreClick,"on-outShop-click":t.onOutShopClick,"on-outStore-click":t.onOutStoreClick,"on-billType-click":t.onBillTypeClick,"on-billType-clear":t.onBillTypeClear}}),i("orderItem",{attrs:{data:t.orderItemList,isDisabled:t.isBillState(1)||!t.$fxAuth("shopMoveApplyBill.save"),itemInputFocusing:t.itemInputFocusing},on:{"update:itemInputFocusing":function(e){t.itemInputFocusing=e},"update:item-input-focusing":function(e){t.itemInputFocusing=e},"on-add-click":t.onAddClick,"on-search-click":t.onSearchClick,"on-unit-edit":t.onUnitEdit,"on-item-edit":t.onItemEdit,"on-item-focus":t.onItemFocus}}),i("div",{staticClass:"shopOrder-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillState(0)&&t.$fxAuth("shopMoveApplyBill.delete"),expression:"isBillState(0) && $fxAuth('shopMoveApplyBill.delete')"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onDeleteClick")}}},[t._v("删除")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillState(0)&&t.$fxAuth("shopMoveApplyBill.check"),expression:"isBillState(0) && $fxAuth('shopMoveApplyBill.check')"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onExpressClick")}}},[t._v("审核")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillState(1)&&t.isMoveState(2)&&!t.outShopIsLoginShop&&t.$fxAuth("shopMoveApplyBill.unCheck"),expression:"isBillState(1) &&\n\t\t\t\t\tisMoveState(2) &&\n\t\t\t\t\t!outShopIsLoginShop &&\n\t\t\t\t\t$fxAuth('shopMoveApplyBill.unCheck')"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onUnExpressClick")}}},[t._v("反审")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillState(0)&&t.$fxAuth("shopMoveApplyBill.save"),expression:"isBillState(0) && $fxAuth('shopMoveApplyBill.save')"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:function(e){return t.onClickHandler("onSaveClick")}}},[t._v("保存")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillState(1)&&t.isMoveState(0)&&!t.inShopIsLoginShop,expression:"isBillState(1) && isMoveState(0) && !inShopIsLoginShop"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:function(e){return t.onClickHandler("onAgreeClick")}}},[t._v("同意")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillState(1)&&t.isMoveState(0)&&!t.inShopIsLoginShop,expression:"isBillState(1) && isMoveState(0) && !inShopIsLoginShop"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onRejectClick")}}},[t._v("拒绝")])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.billTypePopShow,callback:function(e){t.billTypePopShow=e},expression:"billTypePopShow"}},[i("listComp",{attrs:{visibleFlag:t.billTypePopShow,data:t.billTypeList,loadFinished:!0,title:"单据类型检索"},on:{"update:visibleFlag":function(e){t.billTypePopShow=e},"update:visible-flag":function(e){t.billTypePopShow=e},"on-search":t.searchBillType,"on-select":t.selectBillType}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.inShopPopShow,callback:function(e){t.inShopPopShow=e},expression:"inShopPopShow"}},[i("listComp",{attrs:{visibleFlag:t.inShopPopShow,data:t.inShopList,loadFinished:!0,title:"调入机构检索"},on:{"update:visibleFlag":function(e){t.inShopPopShow=e},"update:visible-flag":function(e){t.inShopPopShow=e},"on-search":t.searchInShop,"on-select":t.selectInShop}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.inStorePopShow,callback:function(e){t.inStorePopShow=e},expression:"inStorePopShow"}},[i("listComp",{attrs:{visibleFlag:t.inStorePopShow,data:t.inStoreList,loadFinished:!0,title:"调入仓库检索"},on:{"update:visibleFlag":function(e){t.inStorePopShow=e},"update:visible-flag":function(e){t.inStorePopShow=e},"on-search":t.searchInStore,"on-select":t.selectInStore}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.outShopPopShow,callback:function(e){t.outShopPopShow=e},expression:"outShopPopShow"}},[i("listComp",{attrs:{visibleFlag:t.outShopPopShow,data:t.outShopList,loadFinished:!0,title:"调出机构检索"},on:{"update:visibleFlag":function(e){t.outShopPopShow=e},"update:visible-flag":function(e){t.outShopPopShow=e},"on-search":t.searchOutShop,"on-select":t.selectOutShop}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.outStorePopShow,callback:function(e){t.outStorePopShow=e},expression:"outStorePopShow"}},[i("listComp",{attrs:{visibleFlag:t.outStorePopShow,data:t.outStoreList,loadFinished:!0,title:"调出仓库检索"},on:{"update:visibleFlag":function(e){t.outStorePopShow=e},"update:visible-flag":function(e){t.outStorePopShow=e},"on-search":t.searchOutStore,"on-select":t.selectOutStore}})],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemPopShow,callback:function(e){t.itemPopShow=e},expression:"itemPopShow"}},[i("itemEditComp",{attrs:{visibleFlag:t.itemPopShow,inHouseId:t.orderInfoData.inHouseDTO&&t.orderInfoData.inHouseDTO.id,outHouseId:t.orderInfoData.outHouseDTO&&t.orderInfoData.outHouseDTO.id,inShopDTO:t.orderInfoData.inShopDTO&&t.orderInfoData.inShopDTO.id,parentStoreItem:t.orderItemList},on:{"update:visibleFlag":function(e){t.itemPopShow=e},"update:visible-flag":function(e){t.itemPopShow=e},"on-confirm":t.onItemEditConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,isDisabled:t.isBillState(1)||!t.$fxAuth("shopMoveApplyBill.save")},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemSearchPopShow,callback:function(e){t.itemSearchPopShow=e},expression:"itemSearchPopShow"}},[i("itemSearchPop",{attrs:{visibleFlag:t.itemSearchPopShow,data:t.searchItem,isDisabled:t.isBillState(1)||!t.$fxAuth("shopMoveApplyBill.save")},on:{"update:visibleFlag":function(e){t.itemSearchPopShow=e},"update:visible-flag":function(e){t.itemSearchPopShow=e},"on-search-confirm":t.onSearchConfirm}})],1)],1)},n=[],s=(i("20d6"),i("5176")),a=i.n(s),r=i("f499"),l=i.n(r),c=(i("ac6a"),i("59ad")),u=i.n(c),h=i("795b"),d=i.n(h),f=(i("6762"),i("2fdb"),i("6b54"),i("cebc")),p=i("2f62"),m=i("25fa"),v=i("f07e"),S=i("f6bb"),g=i("f074"),b=i("88b2"),I=i("0eee"),w={name:"moveOrderDetails",components:{orderInfo:m["a"],orderItem:v["a"],listComp:S["a"],itemEditComp:g["a"],itemRowEditPop:b["a"],itemSearchPop:I["a"]},data:function(){return{query:this.$route.query,activeNames:["1"],tabActive:"选项1",orderInfoData:{},orderItemList:[],currentDate:new Date,datePickerShow:!1,inShopPopShow:!1,outShopPopShow:!1,inStorePopShow:!1,outStorePopShow:!1,itemPopShow:!1,billTypePopShow:!1,billTypeList:[],inShopList:[],outShopList:[],inStoreList:[],outStoreList:[],itemEditRowData:{},unitActionShow:!1,unitActions:[],itemRowEditPopShow:!1,itemInputFocusing:!1,orderDeleteFlag:!1,formatterSysPointKey:["busUnitAmount"],itemSearchPopShow:!1,searchItem:[]}},created:function(){this.createOrderDetails()},beforeRouteLeave:function(t,e,i){var o=this;if(this.itemInputFocusing)return this.$router.go(1),!1;"/moveOrder"!==t.path||this.orderDeleteFlag||0!==this.orderInfoData.billState?i():this.$dialog.confirm({title:"提示",message:"若已修改,请先保存单据<br/>是否关闭页面?"}).then(function(){i()}).catch(function(){return o.$router.go(1),!1})},computed:Object(f["a"])({},Object(p["c"])({sysPointSize:"sysPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerShopName:function(t){return t.loginer.loginerShopName},loginerOrganType:function(t){return t.loginer.loginerOrganType},loginerId:function(t){return t.loginer.loginerId}}),{isBillState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.billState):e.orderInfoData.billState===t}},isMoveState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.moveState):e.orderInfoData.moveState===t}},inShopIsLoginShop:function(){return this.orderInfoData.inShopDTO.id===this.loginerShopId},outShopIsLoginShop:function(){return this.orderInfoData.outShopDTO.id===this.loginerShopId}}),methods:{createOrderDetails:function(){var t=this;return new d.a(function(e){t.getOrderDetails().then(function(i){var o=i.storeBills[0];t.formatterSysPoint(o.details),t.orderInfoData=o,t.orderItemList=o.details,e()})})},getOrderDetails:function(){var t=this;return new d.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shopmoveapplybills/users/").concat(t.loginerId,"/").concat(t.query.orderId)}).then(function(t){e(t)})})},formatterSysPoint:function(t){var e=this,i=function(t){return u()(e.$fxUtils.toFixedSHW(t,e.sysPointSize))};t.forEach(function(t){e.formatterSysPointKey.forEach(function(e){t[e]=i(t[e])})})},onBusinessDateClick:function(){this.orderInfoData.businessDate&&(this.currentDate=new Date(this.orderInfoData.businessDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){var e=t.getTime();this.orderInfoData.businessDate=e,this.datePickerShow=!1},clearItemConfim:function(t){var e=this;return new d.a(function(i){var o=e.orderItemList.filter(function(t){return"del"!==t.changeType});0===o.length?i():e.$dialog.confirm({title:"提示",message:t}).then(function(){e.clearItemHandler(),i()}).catch(function(){})})},clearItemHandler:function(){var t=this.orderItemList.filter(function(t){return!!t.id});t.forEach(function(t){t.changeType="del"}),this.orderItemList=t},checkInShop2OutShop:function(t,e){var i=this;return new d.a(function(o){if(!t.id||!e.id)return o(),!0;var n=(t.shopAreaId?t.shopAreaId:"")===(e.shopAreaId?e.shopAreaId:"");return t.id===e.id?(i.$fxToast.top("调入机构与调出机构不能相同！"),!1):i.$fxSysAuth("shopMoveApplyBill.limitOrgan")?i.$fxUtils.isDef(t.organType)&&i.$fxUtils.isDef(e.organType)&&t.organType!==e.organType?(i.$fxToast.top("调出机构和调入机构应同为区域配送中心、配送中心或门店！"),!1):0===t.organType&&0===e.organType&&i.$fxAuth("shopMoveApplyBill.checkRegion")&&!n?(i.$fxToast.top("请选择同一区域的门店！"),!1):void o():(o(),!0)})},onBillTypeClick:function(){this.onBillTYpeRefresh()},searchBillType:function(t){this.onBillTYpeRefresh(t)},selectBillType:function(t){this.orderInfoData.businessTypeDTO=t,this.orderInfoData=JSON.parse(l()(this.orderInfoData))},onBillTypeClear:function(){this.orderInfoData.businessTypeDTO={}},onBillTYpeRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getBillTypeListData(e).then(function(e){t.billTypeList=e.businessTypes,t.billTypePopShow=!0})},getBillTypeListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new d.a(function(i){var o={billType:"6_1",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/businessTypes"),data:o}).then(function(t){i(t)})})},onInShopClick:function(){this.onInShopRefresh()},searchInShop:function(t){this.onInShopRefresh(t)},selectInShop:function(t){var e=this;this.checkInShop(t).then(function(){e.clearItemConfim("更换调入机构会清空品项,是否继续?").then(function(){e.orderInfoData.inShopDTO=t,e.orderInfoData.inHouseDTO={},e.getInStoreListData().then(function(t){if(!t.shops)return!0;e.orderInfoData.inHouseDTO=t.shops[0]})})})},checkInShop:function(t){var e=this;return new d.a(function(i){var o=e.orderInfoData.inShopDTO;o.id!==t.id&&e.checkInShop2OutShop(t,e.orderInfoData.outShopDTO).then(function(){i()})})},onInShopRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getInShopListData(e).then(function(e){t.inShopList=e.shops,t.inShopPopShow=!0})},getInShopListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new d.a(function(i){var o={keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/inshops"),data:o}).then(function(t){i(t)})})},onInStoreClick:function(){if(!this.orderInfoData.inShopDTO.id)return this.$fxToast.fail("请先选择调入机构!"),!1;this.onInStoreRefresh()},searchInStore:function(t){this.onInStoreRefresh(t)},selectInStore:function(t){var e=this;this.clearItemConfim("更换调入仓库会清空品项,是否继续?").then(function(){e.orderInfoData.inHouseDTO=t})},onInStoreRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getInStoreListData(e).then(function(e){t.inStoreList=e.shops,t.inStorePopShow=!0})},getInStoreListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new d.a(function(i){var o={searchText:e};t.$fxHttp.requestPost({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.orderInfoData.inShopDTO.id,"/users/").concat(t.loginerId,"/houses"),data:o,query:{m:"getInHouses"}}).then(function(t){i(t)})})},onOutShopClick:function(){this.onOutShopRefresh()},searchOutShop:function(t){this.onOutShopRefresh(t)},selectOutShop:function(t){var e=this;this.checkOutShop(t).then(function(){e.clearItemConfim("更换调出机构会清空品项,是否继续?").then(function(){e.orderInfoData.outShopDTO=t,e.orderInfoData.outHouseDTO={},e.getOutStoreListData().then(function(t){if(!t.shops)return!0;e.orderInfoData.outHouseDTO=t.shops[0]})})})},checkOutShop:function(t){var e=this;return new d.a(function(i){var o=e.orderInfoData.outShopDTO;o.id!==t.id&&e.checkInShop2OutShop(e.orderInfoData.inShopDTO,t).then(function(){i()})})},onOutShopRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getOutShopListData(e).then(function(e){t.outShopList=e.shops,t.outShopPopShow=!0})},getOutShopListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new d.a(function(i){var o={keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/outshops"),data:o}).then(function(t){i(t)})})},onOutStoreClick:function(){if(!this.orderInfoData.outShopDTO.id)return this.$fxToast.fail("请先选择调出机构!"),!1;this.onOutStoreRefresh()},searchOutStore:function(t){this.onOutStoreRefresh(t)},selectOutStore:function(t){var e=this;this.clearItemConfim("更换调出仓库会清空品项,是否继续?").then(function(){e.orderInfoData.outHouseDTO=t})},onOutStoreRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getOutStoreListData(e).then(function(e){t.outStoreList=e.shops,t.outStorePopShow=!0})},getOutStoreListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new d.a(function(i){var o={searchText:e};t.$fxHttp.requestPost({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.orderInfoData.outShopDTO.id,"/users/").concat(t.loginerId,"/houses"),data:o,query:{m:"getOutHouses"}}).then(function(t){i(t)})})},onUnitEdit:function(t){var e=this;this.itemEditRowData=t,this.getItemUnit(t.goodsDTO.id).then(function(t){e.unitActions=t,e.unitActionShow=!0})},getItemUnit:function(t){var e=this;return new d.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/shopId/users/userId/goods/").concat(t,"/units"),query:{userId:e.loginerId}}).then(function(t){i(t.units)})})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemEditRowData,i=e.unitDTO,o=i.value/t.value,n=u()(this.$fxUtils.toFixedSHW(e.busUnitAmount*o,this.sysPointSize));e.unitDTO=t,e.busUnitAmount=n,e.id&&(e.changeType="edit")},onAddClick:function(){var t=this;this.checkOrderInfo().then(function(){t.itemPopShow=!0})},checkOrderInfo:function(){var t=this;return new d.a(function(e,i){for(var o=[[t.orderInfoData.inShopDTO.id,"调入机构"],[t.orderInfoData.inHouseDTO.id,"调入仓库"],[t.orderInfoData.outShopDTO.id,"调出机构"],[t.orderInfoData.outHouseDTO.id,"调出仓库"]],n=!0,s=0;s<o.length;s++)if(!o[s][0]){t.$toast.fail("请选择".concat(o[s][1],"!")),n=!1;break}if(n){var a=t.$fxStateMiddleware.stateIs("loginerOrganType")(["shop","center"])(t.loginerOrganType);if(a&&t.loginerShopId!==t.orderInfoData.inShopDTO.id&&t.loginerShopId!==t.orderInfoData.outShopDTO.id)return void t.$fxToast({message:"调出机构和调入机构应有一个为“"+t.loginerShopName+"”机构！",position:"top"});t.compareHouse().then(function(){e()})}})},compareHouse:function(){var t=this;return new d.a(function(e){t.$fxHttp.requestPost({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shopmoveapplybills"),query:{userId:t.loginerId,m:"getQXHouseByInOrOutHouseId",inHouseId:t.orderInfoData.inHouseDTO.id,outHouseId:t.orderInfoData.outHouseDTO.id}}).then(function(t){e(t)})})},onItemEditConfirm:function(t){this.orderItemList=t},onSaveClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要保存该单据吗?"}).then(function(){t.checkHasDetails().then(function(){var e=t.getSaveParams();t.saveHandler(e)})}).catch(function(){})},saveHandler:function(t){var e=this;this.$fxHttp.requestPut({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/shopmoveapplybills/").concat(this.query.orderId),data:t,query:{userId:this.loginerId,m:"modify"}}).then(function(t){e.createOrderDetails().then(function(){e.$fxToast.success("保存成功")})})},onExpressClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要审核该单据吗?"}).then(function(){t.checkHasDetails().then(function(){var e=t.getSaveParams();t.expressHandler(e)})}).catch(function(){})},expressHandler:function(t){var e=this;this.$fxHttp.requestPut({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/shopmoveapplybills/").concat(this.query.orderId),data:t,query:{userId:this.loginerId,m:"editAndCheck"}}).then(function(t){e.createOrderDetails().then(function(){e.$fxToast.success("审核成功")})}).catch(function(t){"1"===t.errorCode&&e.createOrderDetails()})},onUnExpressClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要反审该单据吗?"}).then(function(){t.checkHasDetails().then(function(){var e=t.getSaveParams();t.unExpressHandler(e)})}).catch(function(){})},unExpressHandler:function(t){var e=this;this.$fxHttp.requestPut({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/shopmoveapplybills/").concat(this.query.orderId),data:t,query:{userId:this.loginerId,m:"unCheck"}}).then(function(t){e.createOrderDetails().then(function(){e.$fxToast.success("反审成功")})})},onDeleteClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要删除该单据吗?"}).then(function(){var e=t.getSaveParams();t.$fxHttp.requestDel({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shopmoveapplybills/").concat(t.query.orderId),data:e,query:{userId:t.loginerId}}).then(function(e){t.$fxToast.success("删除成功").then(function(){t.orderDeleteFlag=!0,t.$router.go(-1)})})}).catch(function(){})},onAgreeClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要同意调拨吗?确认后将自动生成调出单!"}).then(function(){t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shopmoveapplybills/").concat(t.query.orderId),query:{userId:t.loginerId,m:"agree"}}).then(function(e){t.createOrderDetails().then(function(e){t.$fxToast.success("同意调拨操作成功")})})}).catch(function(){})},onRejectClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要拒绝调拨申请单吗?"}).then(function(){t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shopmoveapplybills/").concat(t.query.orderId),query:{userId:t.loginerId,m:"disagree"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("拒绝调拨操作成功")})})}).catch(function(){})},getSaveParams:function(){var t=this.orderItemList.filter(function(t){return"add"===t.changeType}),e=this.orderItemList.filter(function(t){return"del"===t.changeType}),i=this.orderItemList.filter(function(t){return"edit"===t.changeType}),o=a()({},this.orderInfoData,{detailAdd:t.length>0?t:null,detailDel:e.length>0?e:null,detailMdf:i.length>0?i:null,details:[]});return o},checkHasDetails:function(){var t=this;return new d.a(function(e){var i=t.orderItemList.filter(function(t){return"del"!==t.changeType});0===i.length?t.$fxToast.fail("单据明细不能为空"):e()})},onItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this.orderItemList.findIndex(function(e){return e.id===t.id});~e&&(this.orderItemList[e]=t)},onClickHandler:function(t){if(this.itemInputFocusing)return!1;this[t]()},onItemFocus:function(){this.$refs.orderInfo.closeCollapse()},onSearchClick:function(){this.itemSearchPopShow=!0,this.searchItem=JSON.parse(l()(this.orderItemList))},onSearchConfirm:function(t){this.orderItemList=t}}},k=w,D=(i("7867"),i("2877")),C=Object(D["a"])(k,o,n,!1,null,"3ef9173e",null);e["default"]=C.exports},"3e54":function(t,e,i){"use strict";var o=i("4619"),n=i.n(o);n.a},"3f29":function(t,e,i){"use strict";var o=i("28af"),n=i.n(o);n.a},4457:function(t,e,i){"use strict";var o=i("63cf"),n=i.n(o);n.a},4619:function(t,e,i){},5402:function(t,e,i){"use strict";var o=i("73b7"),n=i.n(o);n.a},"63cf":function(t,e,i){},6686:function(t,e,i){},"6c28":function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-shopOrder-create"},[i("w-header",{attrs:{title:"新增调拨申请单",border:!0}}),i("orderInfo",{ref:"orderInfo",attrs:{data:t.orderInfoData,collapseDisabled:t.itemInputFocusing},on:{"on-busdate-click":t.onBusinessDateClick,"on-inShop-click":t.onInShopClick,"on-inStore-click":t.onInStoreClick,"on-outShop-click":t.onOutShopClick,"on-outStore-click":t.onOutStoreClick,"on-billType-click":t.onBillTypeClick,"on-billType-clear":t.onBillTypeClear}}),i("orderItem",{attrs:{data:t.orderItemList,itemInputFocusing:t.itemInputFocusing},on:{"update:itemInputFocusing":function(e){t.itemInputFocusing=e},"update:item-input-focusing":function(e){t.itemInputFocusing=e},"on-add-click":t.onAddClick,"on-search-click":t.onSearchClick,"on-unit-edit":t.onUnitEdit,"on-item-edit":t.onItemEdit,"on-item-focus":t.onItemFocus}}),i("div",{staticClass:"shopOrder-bottom"},[i("van-button",{staticClass:"add-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onCreateClick}},[t._v("生成单据")])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.billTypePopShow,callback:function(e){t.billTypePopShow=e},expression:"billTypePopShow"}},[i("listComp",{attrs:{visibleFlag:t.billTypePopShow,data:t.billTypeList,loadFinished:!0,title:"单据类型检索"},on:{"update:visibleFlag":function(e){t.billTypePopShow=e},"update:visible-flag":function(e){t.billTypePopShow=e},"on-search":t.searchBillType,"on-select":t.selectBillType}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.inShopPopShow,callback:function(e){t.inShopPopShow=e},expression:"inShopPopShow"}},[i("listComp",{attrs:{visibleFlag:t.inShopPopShow,data:t.inShopList,loadFinished:!0,title:"调入机构检索"},on:{"update:visibleFlag":function(e){t.inShopPopShow=e},"update:visible-flag":function(e){t.inShopPopShow=e},"on-search":t.searchInShop,"on-select":t.selectInShop}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.inStorePopShow,callback:function(e){t.inStorePopShow=e},expression:"inStorePopShow"}},[i("listComp",{attrs:{visibleFlag:t.inStorePopShow,data:t.inStoreList,loadFinished:!0,title:"调入仓库检索"},on:{"update:visibleFlag":function(e){t.inStorePopShow=e},"update:visible-flag":function(e){t.inStorePopShow=e},"on-search":t.searchInStore,"on-select":t.selectInStore}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.outShopPopShow,callback:function(e){t.outShopPopShow=e},expression:"outShopPopShow"}},[i("listComp",{attrs:{visibleFlag:t.outShopPopShow,data:t.outShopList,loadFinished:!0,title:"调出机构检索"},on:{"update:visibleFlag":function(e){t.outShopPopShow=e},"update:visible-flag":function(e){t.outShopPopShow=e},"on-search":t.searchOutShop,"on-select":t.selectOutShop}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.outStorePopShow,callback:function(e){t.outStorePopShow=e},expression:"outStorePopShow"}},[i("listComp",{attrs:{visibleFlag:t.outStorePopShow,data:t.outStoreList,loadFinished:!0,title:"调出仓库检索"},on:{"update:visibleFlag":function(e){t.outStorePopShow=e},"update:visible-flag":function(e){t.outStorePopShow=e},"on-search":t.searchOutStore,"on-select":t.selectOutStore}})],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemPopShow,callback:function(e){t.itemPopShow=e},expression:"itemPopShow"}},[i("itemEditComp",{attrs:{visibleFlag:t.itemPopShow,inHouseId:t.orderInfoData.inHouseDTO&&t.orderInfoData.inHouseDTO.id,outHouseId:t.orderInfoData.outHouseDTO&&t.orderInfoData.outHouseDTO.id,inShopDTO:t.orderInfoData.inShopDTO&&t.orderInfoData.inShopDTO.id,parentStoreItem:t.orderItemList},on:{"update:visibleFlag":function(e){t.itemPopShow=e},"update:visible-flag":function(e){t.itemPopShow=e},"on-confirm":t.onItemEditConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemSearchPopShow,callback:function(e){t.itemSearchPopShow=e},expression:"itemSearchPopShow"}},[i("itemSearchPop",{attrs:{visibleFlag:t.itemSearchPopShow,data:t.searchItem,isDisabled:!t.$fxAuth("shopMoveApplyBill.save")},on:{"update:visibleFlag":function(e){t.itemSearchPopShow=e},"update:visible-flag":function(e){t.itemSearchPopShow=e},"on-search-confirm":t.onSearchConfirm}})],1)],1)},n=[],s=(i("20d6"),i("5176")),a=i.n(s),r=(i("a481"),i("59ad")),l=i.n(r),c=i("f499"),u=i.n(c),h=i("795b"),d=i.n(h),f=i("cebc"),p=i("2f62"),m=i("25fa"),v=i("f07e"),S=i("f6bb"),g=i("f074"),b=i("88b2"),I=i("0eee"),w={name:"createMoveOrder",components:{orderInfo:m["a"],orderItem:v["a"],listComp:S["a"],itemEditComp:g["a"],itemRowEditPop:b["a"],itemSearchPop:I["a"]},data:function(){return{query:this.$route.query,activeNames:["1"],tabActive:"选项1",orderInfoData:{accountDTO:{},billEmp:"",billMemo:"",billState:0,businessDate:(new Date).getTime(),inHouseDTO:{},inShopDTO:{},manualCode:"",outHouseDTO:{},outShopDTO:{},updateIndicator:"Append"},orderItemList:[],currentDate:new Date,datePickerShow:!1,inShopPopShow:!1,outShopPopShow:!1,inStorePopShow:!1,outStorePopShow:!1,itemPopShow:!1,billTypePopShow:!1,billTypeList:[],inShopList:[],outShopList:[],inStoreList:[],outStoreList:[],itemEditRowData:{},unitActionShow:!1,unitActions:[],itemRowEditPopShow:!1,itemInputFocusing:!1,itemSearchPopShow:!1,searchItem:[]}},computed:Object(f["a"])({},Object(p["c"])({sysPointSize:"sysPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerShopName:function(t){return t.loginer.loginerShopName},loginerOrganType:function(t){return t.loginer.loginerOrganType},loginerId:function(t){return t.loginer.loginerId}})),created:function(){var t=this;if(this.$fxSysAuth("shopMoveApplyBill.shopMoveOutAdd"))return!0;this.getDefaultShopListData().then(function(e){if(!e.shops)return!1;t.orderInfoData.inShopDTO=e.shops[0],t.getInStoreListData().then(function(e){e.shops&&e.shops.length&&(t.orderInfoData.inHouseDTO=e.shops[0])})})},beforeRouteLeave:function(t,e,i){var o=this;if(this.itemInputFocusing)return this.$router.go(1),!1;"/moveOrder"===t.path?this.$dialog.confirm({title:"提示",message:"若已修改,请先保存单据<br/>是否关闭页面?"}).then(function(){i()}).catch(function(){return o.$router.go(1),!1}):i()},methods:{getDefaultShopListData:function(){var t=this;return new d.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/inshopDefault")}).then(function(t){e(t)})})},onBusinessDateClick:function(){this.orderInfoData.businessDate&&(this.currentDate=new Date(this.orderInfoData.businessDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){var e=t.getTime();this.orderInfoData.businessDate=e,this.datePickerShow=!1},clearItemConfim:function(t){var e=this;return new d.a(function(i){var o=e.orderItemList.filter(function(t){return"del"!==t.changeType});0===o.length?i():e.$dialog.confirm({title:"提示",message:t}).then(function(){e.clearItemHandler(),i()}).catch(function(){})})},clearItemHandler:function(){this.orderItemList=[]},checkInShop2OutShop:function(t,e){var i=this;return new d.a(function(o){if(!t.id||!e.id)return o(),!0;var n=(t.shopAreaId?t.shopAreaId:"")===(e.shopAreaId?e.shopAreaId:"");return t.id===e.id?(i.$fxToast.top("调入机构与调出机构不能相同！"),!1):i.$fxSysAuth("shopMoveApplyBill.limitOrgan")?i.$fxUtils.isDef(t.organType)&&i.$fxUtils.isDef(e.organType)&&t.organType!==e.organType?(i.$fxToast.top("调出机构和调入机构应同为区域配送中心、配送中心或门店！"),!1):0===t.organType&&0===e.organType&&i.$fxAuth("shopMoveApplyBill.checkRegion")&&!n?(i.$fxToast.top("请选择同一区域的门店！"),!1):void o():(o(),!0)})},onBillTypeClick:function(){this.onBillTYpeRefresh()},searchBillType:function(t){this.onBillTYpeRefresh(t)},selectBillType:function(t){this.orderInfoData.businessTypeDTO=t,this.orderInfoData=JSON.parse(u()(this.orderInfoData))},onBillTypeClear:function(){this.orderInfoData.businessTypeDTO={}},onBillTYpeRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getBillTypeListData(e).then(function(e){t.billTypeList=e.businessTypes,t.billTypePopShow=!0})},getBillTypeListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new d.a(function(i){var o={billType:"6_1",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/businessTypes"),data:o}).then(function(t){i(t)})})},onInShopClick:function(){this.onInShopRefresh()},searchInShop:function(t){this.onInShopRefresh(t)},selectInShop:function(t){var e=this;this.checkInShop(t).then(function(){e.clearItemConfim("更换调入机构会清空品项,是否继续?").then(function(){e.orderInfoData.inShopDTO=t,e.orderInfoData.inHouseDTO={},e.getInStoreListData().then(function(t){if(!t.shops)return!0;e.orderInfoData.inHouseDTO=t.shops[0]})})})},checkInShop:function(t){var e=this;return new d.a(function(i){var o=e.orderInfoData.inShopDTO||{};o.id!==t.id&&e.checkInShop2OutShop(t,e.orderInfoData.outShopDTO||{}).then(function(){i()})})},onInShopRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getInShopListData(e).then(function(e){t.inShopList=e.shops,t.inShopPopShow=!0})},getInShopListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new d.a(function(i){var o={keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/inshops"),data:o}).then(function(t){i(t)})})},onInStoreClick:function(){if(!this.orderInfoData.inShopDTO.id)return this.$fxToast.top("请先选择调入机构！"),!1;this.onInStoreRefresh()},searchInStore:function(t){this.onInStoreRefresh(t)},selectInStore:function(t){var e=this;this.clearItemConfim("更换调入仓库会清空品项,是否继续?").then(function(){e.orderInfoData.inHouseDTO=t})},onInStoreRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getInStoreListData(e).then(function(e){t.inStoreList=e.shops,t.inStorePopShow=!0})},getInStoreListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new d.a(function(i){var o={searchText:e};t.$fxHttp.requestPost({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.orderInfoData.inShopDTO.id,"/users/").concat(t.loginerId,"/houses"),data:o,query:{m:"getInHouses"}}).then(function(t){i(t)})})},onOutShopClick:function(){this.onOutShopRefresh()},searchOutShop:function(t){this.onOutShopRefresh(t)},selectOutShop:function(t){var e=this;this.checkOutShop(t).then(function(){e.clearItemConfim("更换调出机构会清空品项,是否继续?").then(function(){e.orderInfoData.outShopDTO=t,e.orderInfoData.outHouseDTO={},e.getOutStoreListData().then(function(t){if(!t.shops)return!0;e.orderInfoData.outHouseDTO=t.shops[0]})})})},checkOutShop:function(t){var e=this;return new d.a(function(i){var o=e.orderInfoData.outShopDTO;o.id!==t.id&&e.checkInShop2OutShop(e.orderInfoData.inShopDTO,t).then(function(){i()})})},onOutShopRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getOutShopListData(e).then(function(e){t.outShopList=e.shops,t.outShopPopShow=!0})},getOutShopListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new d.a(function(i){var o={keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/outshops"),data:o}).then(function(t){i(t)})})},onOutStoreClick:function(){if(!this.orderInfoData.outShopDTO.id)return this.$fxToast.top("请先选择调出机构！"),!1;this.onOutStoreRefresh()},searchOutStore:function(t){this.onOutStoreRefresh(t)},selectOutStore:function(t){var e=this;this.clearItemConfim("更换调出仓库会清空品项,是否继续?").then(function(){e.orderInfoData.outHouseDTO=t})},onOutStoreRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getOutStoreListData(e).then(function(e){t.outStoreList=e.shops,t.outStorePopShow=!0})},getOutStoreListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new d.a(function(i){var o={searchText:e};t.$fxHttp.requestPost({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.orderInfoData.outShopDTO.id,"/users/").concat(t.loginerId,"/houses"),data:o,query:{m:"getOutHouses"}}).then(function(t){i(t)})})},onUnitEdit:function(t){var e=this;this.itemEditRowData=t,this.getItemUnit(t.goodsDTO.id).then(function(t){e.unitActions=t,e.unitActionShow=!0})},getItemUnit:function(t){var e=this;return new d.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/shopId/users/userId/goods/").concat(t,"/units"),query:{userId:e.loginerId}}).then(function(t){i(t.units)})})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemEditRowData,i=e.unitDTO,o=i.value/t.value,n=l()(this.$fxUtils.toFixedSHW(e.busUnitAmount*o,this.sysPointSize));e.unitDTO=t,e.busUnitAmount=n},onAddClick:function(){var t=this;this.checkOrderInfo().then(function(){t.itemPopShow=!0})},checkOrderInfo:function(){var t=this;return new d.a(function(e,i){for(var o=[[t.orderInfoData.businessDate,"业务日期"],[t.orderInfoData.inShopDTO.id,"调入机构"],[t.orderInfoData.inHouseDTO.id,"调入仓库"],[t.orderInfoData.outShopDTO.id,"调出机构"],[t.orderInfoData.outHouseDTO.id,"调出仓库"]],n=!0,s=0;s<o.length;s++)if(!o[s][0]){t.$fxToast.top("请选择".concat(o[s][1],"！")),n=!1;break}if(n){var a=t.$fxStateMiddleware.stateIs("loginerOrganType")(["shop","center"])(t.loginerOrganType);if(a&&t.loginerShopId!==t.orderInfoData.inShopDTO.id&&t.loginerShopId!==t.orderInfoData.outShopDTO.id)return void t.$fxToast({message:"调出机构和调入机构应有一个为“"+t.loginerShopName+"”机构！",position:"top"});t.compareHouse().then(function(){e()})}})},compareHouse:function(){var t=this;return new d.a(function(e){t.$fxHttp.requestPost({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shopmoveapplybills"),query:{userId:t.loginerId,m:"getQXHouseByInOrOutHouseId",inHouseId:t.orderInfoData.inHouseDTO.id,outHouseId:t.orderInfoData.outHouseDTO.id}}).then(function(t){e(t)})})},onItemEditConfirm:function(t){this.orderItemList=t},onCreateClick:function(){var t=this;if(this.itemInputFocusing)return!1;this.$dialog.confirm({title:"提示",message:"确定生成单据吗?"}).then(function(){t.checkHasDetails().then(function(){var e=t.getSaveParams();t.createHandler(e)})}).catch(function(){})},createHandler:function(t){var e=this;this.$fxHttp.requestPost({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/shopmoveapplybills"),data:t}).then(function(t){e.$fxToast.success("生成单据成功").then(function(){e.$router.replace({path:"moveOrderDetails",query:{orderId:t.storeBills[0].id}})})})},getSaveParams:function(){var t=this.orderItemList.filter(function(t){return"add"===t.changeType}),e=a()(this.orderInfoData,{detailAdd:t,accountDTO:{id:this.loginerId}});return e},checkHasDetails:function(){var t=this;return new d.a(function(e){var i=t.orderItemList.filter(function(t){return"del"!==t.changeType});0===i.length?t.onAddClick():e()})},onItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this.orderItemList.findIndex(function(e){return e.id===t.id});~e&&(this.orderItemList[e]=t)},onItemFocus:function(){this.$refs.orderInfo.closeCollapse()},onSearchClick:function(){this.itemSearchPopShow=!0,this.searchItem=JSON.parse(u()(this.orderItemList))},onSearchConfirm:function(t){this.orderItemList=t}}},k=w,D=(i("c50e"),i("2877")),C=Object(D["a"])(k,o,n,!1,null,"27b5f2ca",null);e["default"]=C.exports},"6e15":function(t,e,i){"use strict";var o=i("9a1c"),n=i.n(o);n.a},"73b7":function(t,e,i){},"75ec":function(t,e,i){},7867:function(t,e,i){"use strict";var o=i("c5de"),n=i.n(o);n.a},"879a":function(t,e,i){"use strict";var o=i("75ec"),n=i.n(o);n.a},"88b2":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"itemRowEdit-popup"},[i("w-header",{attrs:{title:t.currentItemData.goodsDTO.name,leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{staticClass:"itemRowEdit-content"},[i("van-cell-group",[i("van-cell",{attrs:{title:"调出数量",value:t.currentItemData.busUnitAmount,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"品项编号",value:t.currentItemData.goodsDTO.code,"value-class":"info-item-value"}}),i("van-pro-field",{attrs:{placeholder:t.setPlaceholder("请输入备注"),disabled:t.isDisabled,label:"备注","value-class":"info-item-value","input-align":"right"},model:{value:t.currentItemData.memo,callback:function(e){t.$set(t.currentItemData,"memo",e)},expression:"currentItemData.memo"}})],1)],1),i("div",{staticClass:"itemRowEdit-bottom"},[t.isDisabled?i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onCloseClick}},[t._v("确定")]):i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onConfirmClick}},[t._v("保存")])],1)],1)},n=[],s=i("f499"),a=i.n(s),r={name:"itemRowEdit",props:{visibleFlag:Boolean,itemData:{type:Object,default:function(){return{}}},isDisabled:Boolean},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},currentItemData:{}}},computed:{setPlaceholder:function(t){var e=this;return function(t){return e.isDisabled?"":t}}},watch:{visibleFlag:{handler:function(t){t&&(this.currentItemData=JSON.parse(a()(this.itemData)))},immediate:!0}},methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onConfirmClick:function(){this.currentItemData.id&&(this.currentItemData.changeType="edit"),this.$emit("on-Confirm",this.currentItemData),this.$emit("update:visibleFlag",!1)}}},l=r,c=(i("9be8"),i("2877")),u=Object(c["a"])(l,o,n,!1,null,"3ce20fa2",null);e["a"]=u.exports},8918:function(t,e,i){},"8c37":function(t,e,i){},9435:function(t,e,i){"use strict";var o=i("e5ab"),n=i.n(o);n.a},"95a8":function(t,e,i){"use strict";var o=i("fd54"),n=i.n(o);n.a},9636:function(t,e,i){"use strict";var o=i("6686"),n=i.n(o);n.a},"9a1c":function(t,e,i){},"9be8":function(t,e,i){"use strict";var o=i("a157"),n=i.n(o);n.a},"9c7f":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-detail-cell",class:{"is-active":t.rowActive===t.itemIndex,"is-error":t.isError},on:{click:t.onItemClick}},[i("div",{staticClass:"item-details-img"},[i("w-img",{attrs:{src:t.itemData.goodsDTO.imageUrls}})],1),i("div",{staticClass:"item-details-params"},[i("div",{staticClass:"item-details-name fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.name))]),t.sysShowCode?i("div",{staticClass:"item-details-name fx-ellipsis"},[t._v("编号："+t._s(t.itemData.goodsDTO.code))]):t._e(),i("div",{staticClass:"item-details-spec fx-ellipsis"},[t._v("\n\t\t\t"+t._s(t.showBom?t.itemData.bomDTO.name:"")+"\n\t\t\t"+t._s(!t.showBom&&t.showSpec?t.itemData.goodsDTO.spec:"")+"\n\t\t")]),i("div",{staticClass:"item-details-amount"},[i("span",{staticClass:"item-details-count"},[t._v(t._s(t.getItemAmount()))]),i("span",{staticClass:"item-details-unit"},[t._v(t._s(t.itemData.unitDTO.name))])]),i("i",{directives:[{name:"show",rawName:"v-show",value:t.getItemAmount()>0||t.isActive,expression:"(getItemAmount()>0 || isActive)"}],staticClass:"item-selected-icon"})])])},n=[],s=i("cebc"),a=(i("c5f6"),i("2f62")),r={name:"addItemCell",props:{itemData:{type:Object,default:function(){return{}}},itemIndex:Number,rowActive:[Number,String],isActive:Boolean,isError:Boolean,showBom:{type:Boolean,default:!1},showSpec:{type:Boolean,default:!0},itemAmoutName:{type:String,default:""}},computed:Object(s["a"])({},Object(a["c"])({sysShowCode:function(t){return t.systemParams.sysShowCode}})),methods:{onItemClick:function(){this.$emit("on-item-click",this.itemIndex)},getItemAmount:function(){return""===this.itemAmoutName?this.itemData.busUnitAmount:this.itemData[this.itemAmoutName]}}},l=r,c=(i("3e54"),i("2877")),u=Object(c["a"])(l,o,n,!1,null,"70501ba1",null);e["a"]=u.exports},a157:function(t,e,i){},ac3c:function(t,e,i){"use strict";var o=i("cf58"),n=i.n(o);n.a},af41:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-number-keyboard fx-shadow-up"},[i("div",{staticClass:"number-keyboard-title"},[i("div",{staticClass:"title-name fx-ellipsis"},[t._v(t._s(t.title))]),i("div",{staticClass:"title-amount"},[t._v(t._s(t.amount))]),i("div",{staticClass:"title-unit",on:{click:t.onUnitClick}},[i("span",{staticClass:"title-unit-text fx-ellipsis"},[t._v(t._s(t.unit))]),i("i",{directives:[{name:"show",rawName:"v-show",value:t.unitEdit,expression:"unitEdit"}],staticClass:"title-unit-select"})])]),i("div",{staticClass:"number-keyboard-content"},[i("div",{staticClass:"keyboard-number"},[i("div",{staticClass:"keyboard-number-row"},[i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("1")}}},[t._v("1")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("2")}}},[t._v("2")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("3")}}},[t._v("3")]),i("i",{staticClass:"keyboard-btn-1 keyboard-btn-hide fx-Pseudo-btn",on:{click:t.hideKeyboardBtnClick}})]),i("div",{staticClass:"keyboard-number-row"},[i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("4")}}},[t._v("4")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("5")}}},[t._v("5")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("6")}}},[t._v("6")]),i("i",{staticClass:"keyboard-btn-1 keyboard-btn-del fx-Pseudo-btn",on:{click:t.delBtnClick}})]),i("div",{staticClass:"keyboard-number-row"},[i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("7")}}},[t._v("7")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("8")}}},[t._v("8")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("9")}}},[t._v("9")]),t.shortcutBtn?i("i",{staticClass:"keyboard-btn-1 keyboard-btn-pre fx-Pseudo-btn",on:{click:t.preBtnClick}},[t._v("上一个")]):i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn"})]),i("div",{staticClass:"keyboard-number-row"},[i("i",{staticClass:"keyboard-btn-2 keyboard-btn-zero fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("0")}}},[t._v("0")]),i("i",{staticClass:"keyboard-btn-1 keyboard-btn-dot fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick(".")}}},[t._v(".")]),t.shortcutBtn?i("i",{staticClass:"keyboard-btn-1 keyboard-btn-next fx-Pseudo-btn",on:{click:t.nextBtnClick}},[t._v("下一个")]):i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn"})])])])])},n=[],s=(i("3b2b"),i("c5f6"),{name:"itemNumberKeyboard",props:{title:String,unit:String,amount:[String,Number],unitEdit:{type:Boolean,default:!1},integer:Boolean,pointSize:{type:[String,Number],default:4},intLength:{type:[String,Number],default:8},shortcutBtn:{type:Boolean,default:!0}},computed:{computedNumberReg:function(){return new RegExp("^\\d+(\\.|\\.\\d{1,".concat(this.pointSize-1,"})?$"))}},methods:{numberBtnClick:function(t){this.$emit("input",t),this.$emit("change",this.getAddValue(t))},delBtnClick:function(t){this.$emit("delete"),this.$emit("change",this.getDelValue(t))},preBtnClick:function(){this.$emit("pre")},nextBtnClick:function(){this.$emit("next")},hideKeyboardBtnClick:function(){this.$emit("hide")},onUnitClick:function(){this.$emit("on-unit-unitEdit")},getAddValue:function(t){var e=this.amount+"";return-1===e.indexOf(".")&&e.length>=this.intLength&&"."!==t||-1!==e.indexOf(".")&&("."===t||!this.computedNumberReg.test(e))||"."===t&&this.integer?e:("0"===e&&"."!==t?e=t:e+=t,e)},getDelValue:function(t){var e=this.amount+"";return"0"===e?e:(e=1===e.length?"0":e.substr(0,e.length-1),e)}}}),a=s,r=(i("95a8"),i("2877")),l=Object(r["a"])(a,o,n,!1,null,"2fae3907",null);e["a"]=l.exports},c50e:function(t,e,i){"use strict";var o=i("1c13"),n=i.n(o);n.a},c5de:function(t,e,i){},cdb6:function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-shopOrder"},[i("w-header",{attrs:{title:"调拨申请单",border:!0}},[i("headEditBtn",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopMoveApplyBill.check"),expression:"$fxAuth('shopMoveApplyBill.check')"}],attrs:{slot:"header-right",active:t.orderEditFlag},on:{click:t.onOrderEditClick},slot:"header-right"}),i("headSearchBtn",{directives:[{name:"show",rawName:"v-show",value:!t.orderEditFlag,expression:"!orderEditFlag"}],attrs:{slot:"header-right"},on:{click:t.onSearchClick},slot:"header-right"}),i("headSelectAllBtn",{directives:[{name:"show",rawName:"v-show",value:t.orderEditFlag,expression:"orderEditFlag"}],attrs:{slot:"header-right",active:t.isSelectAll},on:{click:t.onSelectAllClick},slot:"header-right"})],1),i("filterTab",{attrs:{state:t.computedState,moveState:t.computedMoveState},on:{"on-state-click":t.onStateClick,"on-moveState-click":t.onMoveStateClick}}),i("div",{staticClass:"shopOrder-content"},[i("van-pull-refresh",{directives:[{name:"show",rawName:"v-show",value:0!==t.orderList.length,expression:"orderList.length !== 0"}],staticClass:"shopOrder-list",on:{refresh:t.onPullRefresh},model:{value:t.pullRefreshLoading,callback:function(e){t.pullRefreshLoading=e},expression:"pullRefreshLoading"}},[i("van-list",{attrs:{finished:t.loadFinished,"finished-text":"没有更多了",error:t.listError,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.listError=e},load:t.onLoadMore},model:{value:t.listLoading,callback:function(e){t.listLoading=e},expression:"listLoading"}},t._l(t.orderList,function(e){return i("orderBlock",{directives:[{name:"show",rawName:"v-show",value:t.computedShowOrder(e.billState),expression:"computedShowOrder(item.billState)"}],key:e.id,attrs:{data:e,showCheckBox:t.orderEditFlag},on:{"on-click":function(i){return t.onClickOrder(e)}}})}),1)],1),i("emptyBill",{directives:[{name:"show",rawName:"v-show",value:0===t.orderList.length,expression:"orderList.length === 0"}]})],1),i("div",{staticClass:"shopOrder-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.orderEditFlag&&t.$fxAuth("shopMoveApplyBill.add"),expression:"!orderEditFlag && $fxAuth('shopMoveApplyBill.add')"}],staticClass:"add-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onCreateClick}},[t._v("添加单据")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.orderEditFlag&&t.$fxAuth("shopMoveApplyBill.check"),expression:"orderEditFlag && $fxAuth('shopMoveApplyBill.check')"}],staticClass:"add-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onExpressClick}},[t._v("批量审核")])],1),i("van-actionsheet",{attrs:{actions:t.stateActions,"cancel-text":"取消"},on:{select:t.onStateSelect},model:{value:t.stateActionShow,callback:function(e){t.stateActionShow=e},expression:"stateActionShow"}}),i("van-actionsheet",{attrs:{actions:t.moveStateActions,"cancel-text":"取消"},on:{select:t.onMoveSateSelect},model:{value:t.moveStateActionShow,callback:function(e){t.moveStateActionShow=e},expression:"moveStateActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.filterPopShow,callback:function(e){t.filterPopShow=e},expression:"filterPopShow"}},[i("filterPop",{attrs:{visibleFlag:t.filterPopShow,filterParams:t.filterParams},on:{"update:visibleFlag":function(e){t.filterPopShow=e},"update:visible-flag":function(e){t.filterPopShow=e},"update:filterParams":function(e){t.filterParams=e},"update:filter-params":function(e){t.filterParams=e},"on-confirm":t.onFilterConfirm}})],1)],1)},n=[],s=(i("ac6a"),i("75fc")),a=i("5176"),r=i.n(a),l=i("795b"),c=i.n(l),u=(i("7514"),i("7f7f"),i("cebc")),h=(i("6762"),i("2f62")),d=i("b215"),f=i("46aa"),p=i("a0be"),m=i("4102"),v=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-block fx-shadow-block",on:{click:t.onClick}},[i("checkBox",{staticClass:"order-checkbox",attrs:{visibleFlag:t.showCheckBox,checked:t.data.checked},on:{"on-checkbox-click":t.onClick}}),i("div",{staticClass:"block-content"},[i("div",{staticClass:"block-title"},[i("i",{staticClass:"block-icon"}),i("span",{staticClass:"title-text fx-ellipsis"},[t._v(t._s(t.data.outShopDTO.name))]),i("stateTag",{staticClass:"state-tag",attrs:{billState:t.data.billState}})],1),i("div",{staticClass:"block-title"},[i("i",{staticClass:"block-icon"}),i("span",{staticClass:"title-text fx-ellipsis"},[t._v(t._s(t.data.inShopDTO.name))]),i("moveStateTag",{attrs:{moveState:t.data.moveState}})],1),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-date"},[i("span",{staticClass:"order-date-key"},[t._v("业务日期")]),i("span",{staticClass:"order-date-value"},[t._v(t._s(t._f("filterDateYMD")(t.data.businessDate)))]),i("van-icon",{staticClass:"order-date-arrow",attrs:{name:"arrow"}})],1),i("div",{staticClass:"order-count"},[i("span",{staticClass:"order-count-key"},[t._v("明细数：")]),i("span",{staticClass:"order-count-value"},[t._v(t._s(t.data.detailCount))])])])])],1)},S=[],g=i("0f38"),b=i("0b26"),I=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("span",{staticClass:"moveStateTag",class:t.computedClass},[t._v(t._s(t.moveStateText))])},w=[],k=(i("c5f6"),{name:"moveStateTag",props:{moveState:Number},computed:{moveStateText:function(){var t="";switch(this.moveState){case 0:t="未处理";break;case 1:t="同意";break;case 2:t="拒绝";break;case 3:t="等待处理";break}return t},computedClass:function(){var t="";switch(this.moveState){case 0:t="";break;case 1:t="fx-green-font";break;case 2:t="fx-warn-font";break;case 3:t="";break}return t}}}),D=k,C=(i("879a"),i("2877")),x=Object(C["a"])(D,I,w,!1,null,"60061be9",null),y=x.exports,T={name:"orderBlock",components:{stateTag:b["a"],moveStateTag:y,checkBox:g["a"]},props:{data:{type:Object,default:function(){return{}}},showCheckBox:{type:Boolean,default:!1}},methods:{onClick:function(){this.showCheckBox?this.$set(this.data,"checked",!this.data.checked):this.$emit("on-click",this.data)}}},O=T,P=(i("3f29"),Object(C["a"])(O,v,S,!1,null,"07988aa0",null)),A=P.exports,$=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"filter-popup"},[i("w-header",{attrs:{title:"筛选条件",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{ref:"filterContent",staticClass:"filter-content"},[i("van-cell-group",[i("van-cell",{attrs:{title:"业务日期"}}),i("van-cell",{attrs:{title:"起始时间",value:t.beginDate,"is-link":""},on:{click:t.onBeginDateClick}}),i("van-cell",{attrs:{title:"结束时间",value:t.endDate,"is-link":""},on:{click:t.endDateClick}}),i("van-cell",{attrs:{title:"调出机构",value:t.outShop,"value-class":"info-item-value","is-link":""},on:{click:t.onOutShopClick}}),i("van-cell",{attrs:{title:"调入机构",value:t.inShop,"value-class":"info-item-value","is-link":""},on:{click:t.onInShopClick}}),i("van-cell",{attrs:{title:"调入仓库",value:t.store,"value-class":"info-item-value","is-link":""},on:{click:t.onStoreClick}}),i("van-cell",{attrs:{title:"品项",value:t.item,"value-class":"info-item-value","is-link":""},on:{click:t.onItemClick}}),i("van-field",{ref:"billNo",attrs:{label:"系统单号","value-class":"info-item-value",placeholder:"请输入系统单号","input-align":"right"},model:{value:t.billNo,callback:function(e){t.billNo=e},expression:"billNo"}})],1)],1),i("div",{staticClass:"filter-bottom"},[i("van-button",{staticClass:"reset-btn fx-no-radius",attrs:{type:"info"},on:{click:t.onResetClick}},[t._v("重置")]),i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onConfirmClick}},[t._v("确定")])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("filterListPopup",{attrs:{title:"调出机构检索",rollingLoad:!0,getDataApi:t.getShopListData},on:{"on-select":function(e){return t.selectOutShop(arguments)}},model:{value:t.outShopPopShow,callback:function(e){t.outShopPopShow=e},expression:"outShopPopShow"}}),i("filterListPopup",{attrs:{title:"调入机构检索",rollingLoad:!0,getDataApi:t.getShopListData},on:{"on-select":function(e){return t.selectInShop(arguments)}},model:{value:t.inShopPopShow,callback:function(e){t.inShopPopShow=e},expression:"inShopPopShow"}}),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.storePopShow,callback:function(e){t.storePopShow=e},expression:"storePopShow"}},[i("listComp",{attrs:{visibleFlag:t.storePopShow,data:t.storeList,loadFinished:!0,title:"调入仓库检索"},on:{"update:visibleFlag":function(e){t.storePopShow=e},"update:visible-flag":function(e){t.storePopShow=e},"on-search":t.searchStore,"on-select":t.selectStore}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.itemPopShow,callback:function(e){t.itemPopShow=e},expression:"itemPopShow"}},[i("listComp",{attrs:{visibleFlag:t.itemPopShow,data:t.itemList,loadFinished:t.itemListLoadFinished,loading:t.onItemLoading,title:"品项检索"},on:{"update:visibleFlag":function(e){t.itemPopShow=e},"update:visible-flag":function(e){t.itemPopShow=e},"update:loading":function(e){t.onItemLoading=e},"on-search":t.searchItem,"on-select":t.selectItem,"on-load":t.onItemLoad}})],1)],1)},L=[],B=i("768b"),E=i("f6bb"),F=i("eb03"),H=50,_={name:"filterPop",components:{listComp:E["a"],filterListPopup:F["a"]},props:{visibleFlag:Boolean,filterParams:{type:Object,default:function(){return{}}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},dateType:"",currentDate:new Date,beginDate:this.$fxCommon.orderFilterStartDate(),endDate:this.$fxCommon.orderFilterEndDate(),outShop:"请选择",outShopId:"",inShop:"请选择",inShopId:"",store:"请选择",storeId:"",item:"请选择",itemId:"",billNo:"",datePickerShow:!1,outShopPopShow:!1,inShopPopShow:!1,storePopShow:!1,itemPopShow:!1,storeList:[],itemList:[],itemListStart:0,onItemLoading:!1,itemListLoadFinished:!1}},watch:{visibleFlag:{handler:function(t){t&&this.$fxUtils.isEmptyObjSHW(this.filterParams)&&this.resetHandler()},immediate:!0}},computed:Object(u["a"])({},Object(h["c"])({loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}})),methods:{getFilterParams:function(){return{beginDate:this.beginDate||this.$fxCommon.orderFilterStartDate(),endDate:this.endDate||this.$fxCommon.orderFilterEndDate(),outShopId:this.outShopId,inShopId:this.inShopId,storeId:this.storeId,itemId:this.itemId}},onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onConfirmClick:function(){this.$emit("update:visibleFlag",!1),this.$emit("update:filterParams",this.getFilterParams()),this.$emit("on-confirm",this.getFilterParams())},onResetClick:function(){this.resetHandler()},resetHandler:function(){this.beginDate=this.$fxCommon.orderFilterStartDate(),this.endDate=this.$fxCommon.orderFilterEndDate(),this.outShop="请选择",this.outShopId="",this.inShop="请选择",this.inShopId="",this.store="请选择",this.storeId="",this.item="请选择",this.itemId="",this.billNo=""},onBeginDateClick:function(){this.dateType="begin",this.beginDate&&(this.currentDate=new Date(this.beginDate)),this.datePickerShow=!0},endDateClick:function(){this.dateType="end",this.endDate&&(this.currentDate=new Date(this.endDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){"begin"===this.dateType?(this.beginDate=this.$fxUtils.setDateTime(t,"时分"),this.endDate&&this.$fxCommon.orderFilterRangeDate(this.beginDate,this.endDate)||(this.endDate=this.$fxCommon.orderFilterDate(t))):(this.endDate=this.$fxUtils.setDateTime(t,"时分"),this.beginDate&&this.$fxCommon.orderFilterRangeDate(this.beginDate,this.endDate)||(this.beginDate=this.$fxCommon.orderFilterStartDate(t))),this.datePickerShow=!1},onOutShopClick:function(){this.outShopPopShow=!0},selectOutShop:function(t){var e=Object(B["a"])(t,1),i=e[0];this.outShop=i.name,this.outShopId=i.id},getShopListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,o={keyword:t,start:e,size:i};return this.$fxApi("z5common.getUserManageShop")({data:o}).then(function(t){return t.shops})},onInShopClick:function(){this.inShopPopShow=!0},selectInShop:function(t){var e=Object(B["a"])(t,1),i=e[0];this.inShop=i.name,this.inShopId=i.id},onStoreClick:function(){if(!this.inShopId)return this.$fxToast.fail("请先选择调入机构!"),!1;this.onStoreRefresh()},searchStore:function(t){this.onStoreRefresh(t)},selectStore:function(t){this.store=t.name,this.storeId=t.id},onStoreRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getStoreListData(e).then(function(e){t.storeList=e.shops,t.storePopShow=!0})},getStoreListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new c.a(function(i){var o={keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.inShopId,"/users/").concat(t.loginerId,"/houses"),data:o}).then(function(t){i(t)})})},onItemClick:function(){this.onItemRefresh()},searchItem:function(t){this.onItemRefresh(t)},selectItem:function(t){this.item=t.name,this.itemId=t.id},onItemRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.itemListStart=0,this.itemListLoadFinished=!1,this.getItemListData(e).then(function(e){t.itemPopShow=!0,t.onItemLoading=!1,t.itemListStart+=H,e.goods.length<H&&(t.itemListLoadFinished=!0),t.itemList=e.goods})},onItemLoad:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getItemListData(e).then(function(e){var i;t.onItemLoading=!1,t.itemListStart+=H,e.goods.length<H&&(t.itemListLoadFinished=!0),(i=t.itemList).push.apply(i,Object(s["a"])(e.goods))})},getItemListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new c.a(function(i){var o={start:t.itemListStart,size:H,paged:!0,keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/goods"),data:o}).then(function(t){i(t)})})},onFocus:function(t){this.onScrollTop(t)},onScrollTop:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,i=this.$refs[t];if(!i||0===i.length)return!1;var o=i.$el.offsetTop,n=this.$refs["filterContent"];this.$fxUtils.scrollTopW({offsetTop:o,$el:n,distance:e})}}},R=_,U=(i("247f2"),Object(C["a"])(R,$,L,!1,null,"1fb61ddd",null)),N=U.exports,M=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"shopOrder-filter fx-shadow-down"},[i("div",{staticClass:"filter-item",on:{click:t.onStateClick}},[i("span",[t._v("审核状态")]),i("van-icon",{staticClass:"filter-arrow",attrs:{name:"arrow-down"}}),i("span",[t._v(t._s(t.state))])],1),i("div",{staticClass:"filter-item",on:{click:t.onMoveStateClick}},[i("span",[t._v("调拨状态")]),i("van-icon",{staticClass:"filter-arrow",attrs:{name:"arrow-down"}}),i("span",[t._v(t._s(t.moveState))])],1)])},q=[],j={name:"filterTab",props:{state:String,moveState:String},methods:{onStateClick:function(){this.$emit("on-state-click")},onMoveStateClick:function(){this.$emit("on-moveState-click")}}},K=j,z=(i("fd39"),Object(C["a"])(K,M,q,!1,null,"2b5a32e1",null)),G=z.exports,W=50,J={name:"moveOrder",components:{headSearchBtn:d["a"],headEditBtn:f["a"],headSelectAllBtn:p["a"],emptyBill:m["a"],orderBlock:A,filterPop:N,filterTab:G},data:function(){return{orderList:[],filterPopShow:!1,filterState:null,stateActionShow:!1,stateActions:[{id:null,name:"全部"},{id:"0",name:"未审核"},{id:"1",name:"已审核"}],filterMoveState:null,moveStateActionShow:!1,moveStateActions:[{id:null,name:"全部"},{id:"0",name:"未处理"},{id:"1",name:"同意"},{id:"2",name:"拒绝"},{id:"3",name:"等待处理"}],listStart:0,pullRefreshLoading:!1,listLoading:!1,loadFinished:!0,listError:!1,orderEditFlag:!1,filterParams:{}}},beforeRouteEnter:function(t,e,i){var o=["/main/home","/"],n=["/moveOrderDetails"];o.includes(e.path)?i(function(e){e.restFilterParams(),e.restRouterParams(t.params),e.refreshOrderList()}):n.includes(e.path)?i(function(t){t.refreshOrderList()}):i()},computed:Object(u["a"])({},Object(h["c"])({billListPostParams:"billListPostParams",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{computedState:function(){var t=this;return this.stateActions.find(function(e){return e.id===t.filterState}).name},computedMoveState:function(){var t=this;return this.moveStateActions.find(function(e){return e.id===t.filterMoveState}).name},computedShowOrder:function(t){var e=this;return function(t){return!e.orderEditFlag||1!==t}},isSelectAll:function(){var t=this.orderList.filter(function(t){return 1!==t.billState});if(0===t.length)return!1;var e=t.filter(function(t){return!!t.checked});return e.length===t.length}}),methods:{orderListPostHandler:function(t){var e=this;return new c.a(function(i){e.$store.commit({type:"SETSTATE",billListPostParams:t}),e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/shopmoveapplybills/users/").concat(e.loginerId),data:t}).then(function(t){i(t)})})},refreshOrderList:function(){var t=this;return new c.a(function(e){t.listStart=0;var i={start:t.listStart,size:W,paged:!0,businessDateStart:t.$fxCommon.orderFilterStartDate(),businessDateEnd:t.$fxCommon.orderFilterEndDate(),billState:t.filterState,moveState:t.filterMoveState};i=r()(i,t.translateFilterParams(t.filterParams)),t.orderListPostHandler(i).then(function(i){t.orderList=i.storeBills,e(i)})})},onFilterConfirm:function(t){var e=this;this.listStart=0;var i={start:this.listStart,size:W,paged:!0,businessDateStart:t.beginDate,businessDateEnd:t.endDate,billState:this.filterState,moveState:this.filterMoveState,outShopId:""===t.outShopId?null:t.outShopId,inShopId:""===t.inShopId?null:t.inShopId,houseId:""===t.storeId?null:t.storeId,goodsId:""===t.itemId?null:t.itemId};this.orderListPostHandler(i).then(function(t){e.orderList=t.storeBills})},translateFilterParams:function(t){return this.$fxUtils.isEmptyObjSHW(t)?{}:{businessDateStart:t.beginDate,businessDateEnd:t.endDate,outShopId:""===t.outShopId?null:t.outShopId,inShopId:""===t.inShopId?null:t.inShopId,houseId:""===t.storeId?null:t.storeId,goodsId:""===t.itemId?null:t.itemId}},onPullRefresh:function(){var t=this;this.refreshOrderList().then(function(e){t.pullRefreshLoading=!1})},onLoadMore:function(){var t=this,e=r()(this.billListPostParams,{start:this.listStart});this.orderListPostHandler(e).then(function(e){var i;(i=t.orderList).push.apply(i,Object(s["a"])(e.storeBills))})},onSearchClick:function(){this.filterPopShow=!0},onStateClick:function(){this.stateActionShow=!0},onStateSelect:function(t){this.filterState=t.id,this.stateActionShow=!1,this.refreshOrderList()},onMoveStateClick:function(){this.moveStateActionShow=!0},onMoveSateSelect:function(t){this.filterMoveState=t.id,this.moveStateActionShow=!1,this.refreshOrderList()},onClickOrder:function(t){this.$router.push({path:"moveOrderDetails",query:{orderId:t.id}})},onCreateClick:function(){this.$router.push("createMoveOrder")},onOrderEditClick:function(){this.orderEditFlag=!this.orderEditFlag},onExpressClick:function(){var t=this,e=this.orderList.reduce(function(t,e){var i=e.checked?t.concat(e.id):t;return i},[]);if(0===e.length)return!1;this.$dialog.confirm({title:"提示",message:"确定要审核所选单据?"}).then(function(){t.expressHandler(e).then(function(e){t.orderEditFlag=!t.orderEditFlag,t.refreshOrderList().then(function(){t.$fxToast.success(e.message)})})})},expressHandler:function(t){var e=this;return new c.a(function(i){e.$fxHttp.requestPut({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/shopmoveapplybills/users/").concat(e.loginerId),data:t,query:{m:"batchCheck"}}).then(function(t){i(t)})})},onSelectAllClick:function(){var t=this,e=!this.isSelectAll;this.orderList.forEach(function(i){1!==i.billState&&t.$set(i,"checked",e)})},restFilterParams:function(){this.filterParams={},this.filterState=null,this.filterMoveState=null,this.orderEditFlag=!1},restRouterParams:function(t){this.$fxUtils.isEmptyObjSHW(t)||(this.filterState=t.billState,this.filterMoveState=t.moveState?t.moveState:null)}}},Y=J,V=(i("9636"),Object(C["a"])(Y,o,n,!1,null,"492dc4a5",null));e["default"]=V.exports},cf58:function(t,e,i){},d444:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"add-item-class-content fx-vant-class-collapse"},[i("div",{staticClass:"all-class",class:{"is-active":""===t.value},on:{click:function(e){return e.stopPropagation(),t.selectClass("")}}},[t._v(t._s(t.classTitle))]),i("van-collapse",{attrs:{accordion:!0},model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},t._l(t.itemClassList,function(e){return i("van-collapse-item",{key:e.id,attrs:{name:e.id}},[i("div",{staticClass:"big-class",attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),t._l(e.smallType,function(e){return i("van-cell",{key:e.id,staticClass:"small-class",class:{"is-active":t.value===e.id},attrs:{title:e.name},on:{click:function(i){return i.stopPropagation(),t.selectClass(e.id)}}})})],2)}),1)],1)},n=[],s=(i("c5f6"),{name:"addItemClassList",props:{value:[String,Number],itemClassList:{type:Array,default:function(){return[]}},classTitle:{type:String,default:"全部品项"}},data:function(){return{activeNames:[]}},methods:{selectClass:function(t){this.$emit("input",t),this.$emit("on-select-class",t),this.$emit("on-change-class",[t,this.value])}}}),a=s,r=(i("5402"),i("2877")),l=Object(r["a"])(a,o,n,!1,null,"df69e854",null);e["a"]=l.exports},ddfe:function(t,e,i){"use strict";var o=i("250f"),n=i.n(o);n.a},e5ab:function(t,e,i){},f074:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-edit"},[i("w-header",{attrs:{title:"选择品项",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}},[i("van-icon",{staticClass:"header-confirm-btn",attrs:{slot:"header-right",name:"success"},on:{click:t.onItemConfirm},slot:"header-right"})],1),i("div",{staticClass:"item-search clearfix"},[i("van-search",{attrs:{placeholder:"请输入搜索关键词",shape:"round"},on:{search:t.search},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}})],1),i("div",{staticClass:"item-edit-content"},[i("addItemClassList",{attrs:{itemClassList:t.itemClassList},on:{"on-select-class":t.selectClass},model:{value:t.currentClass,callback:function(e){t.currentClass=e},expression:"currentClass"}}),i("addItemList",{ref:"addItemList",attrs:{listLoading:t.listLoading,loadFinished:t.loadFinished,itemList:t.itemList},on:{"update:listLoading":function(e){t.listLoading=e},"update:list-loading":function(e){t.listLoading=e},"on-load-more":t.onLoadMore},scopedSlots:t._u([{key:"item-cell",fn:function(e){return[i("addItemCell",{attrs:{itemData:e.$item,itemIndex:e.$index,rowActive:t.rowActive},on:{"on-item-click":t.onItemEdit}})]}}]),model:{value:t.rowActive,callback:function(e){t.rowActive=e},expression:"rowActive"}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.numberKeyboardShow,expression:"numberKeyboardShow"}],staticClass:"details-number-keyboard"},[i("itemNumberKeyboard",{attrs:{title:t.keyboardTitleCompted,unit:t.keyboardUnitCompted,amount:t.keyboardAmountCompted,unitEdit:!0,pointSize:t.sysPointSize,intLength:t.numberLength},on:{change:t.onKeyboardChange,pre:t.onKeyboardPre,next:t.onKeyboardNext,hide:t.onKeyboardHide,"on-unit-unitEdit":t.onUnitEdit}})],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}})],1)},n=[],s=i("59ad"),a=i.n(s),r=(i("20d6"),i("ac6a"),i("75fc")),l=i("795b"),c=i.n(l),u=i("f499"),h=i.n(u),d=(i("7f7f"),i("cebc")),f=i("2f62"),p=i("d444"),m=i("01f7"),v=i("9c7f"),S=i("af41"),g=10,b={name:"itemEditComp",components:{addItemClassList:p["a"],addItemList:m["a"],addItemCell:v["a"],itemNumberKeyboard:S["a"]},props:{visibleFlag:Boolean,inShopDTO:String,inHouseId:String,outHouseId:String,parentStoreItem:{type:Array,default:function(){return[]}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",currentClass:"",itemClassList:[],itemList:[],numberKeyboardShow:!1,rowActive:"",selectedItemArr:[],itemListStart:0,listLoading:!1,loadFinished:!0,listError:!1,unitActionShow:!1,unitActions:[]}},computed:Object(d["a"])({},Object(f["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{keyboardTitleCompted:function(){if(""===this.rowActive)return"";var t=this.itemList[this.rowActive];return t.goodsDTO.name},keyboardUnitCompted:function(){if(""===this.rowActive)return"";var t=this.itemList[this.rowActive];return t.unitDTO.name},keyboardAmountCompted:function(){if(""===this.rowActive)return"0";var t=this.itemList[this.rowActive];return t.busUnitAmount}}),watch:{visibleFlag:{handler:function(t){t&&(this.selectedItemArr=JSON.parse(h()(this.parentStoreItem)),this.refresh())},immediate:!0},rowActive:function(t,e){""!==e&&(this.numberStringAmount(e),this.pushSelectedItem(this.itemList[e]),""===t&&(this.numberKeyboardShow=!1))}},methods:{refresh:function(){var t=this;this.searchKey="",this.getItemClass().then(function(e){t.itemClassList=e.goodsTypes,t.currentClass="",t.getItemByClass()})},onCloseClick:function(){this.rowActive="",this.$emit("update:visibleFlag",!1)},onItemConfirm:function(){var t=this;this.rowActive="",this.$nextTick(function(){t.$emit("on-confirm",t.selectedItemArr),t.$emit("update:visibleFlag",!1)})},search:function(){this.getItemByClass()},getItemClass:function(){var t=this;return new c.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.inHouseId,"/users/").concat(t.loginerId,"/goodTypes")}).then(function(t){e(t)})})},getItem:function(){var t=this;return new c.a(function(e){var i={start:t.itemListStart,size:g,paged:!0,goodsSmallTypeId:t.currentClass||null,inHouseId:t.inHouseId,outHouseId:t.outHouseId,searchText:t.searchKey||null};t.$fxHttp.requestPost({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.inShopDTO,"/users/").concat(t.loginerId,"/shopmoveapplydetails"),data:i}).then(function(t){e(t)})})},getItemByClass:function(){var t=this;this.itemListStart=0,this.getItem().then(function(e){t.itemList=t.setResItem(e.billAndDetails),t.setListLoading(e.billAndDetails.length),t.$nextTick(function(){t.$refs.addItemList&&t.$refs.addItemList.onSelectLetter(0,5)})})},onLoadMore:function(){var t=this;this.getItem().then(function(e){var i;(i=t.itemList).push.apply(i,Object(r["a"])(t.setResItem(e.billAndDetails))),t.setListLoading(e.billAndDetails.length)})},setResItem:function(t){var e=this;return t.forEach(function(t){var i=e.selectedItemArr.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id});~i?"del"!==e.selectedItemArr[i].changeType&&(t.busUnitAmount=e.selectedItemArr[i].busUnitAmount,t.unitDTO=e.selectedItemArr[i].unitDTO):t.busUnitAmount="0"}),t},setListLoading:function(t){this.listLoading=!1,this.itemListStart+=g,this.loadFinished=t<g},selectClass:function(t){this.searchKey="",this.onKeyboardHide(),this.getItemByClass()},onItemEdit:function(t){this.rowActive=t,this.numberKeyboardShow=!0,this.$refs.addItemList.onSelectLetter(this.rowActive,20)},onKeyboardChange:function(t){this.itemList[this.rowActive].busUnitAmount=t},numberStringAmount:function(t){var e=this.itemList[t].busUnitAmount;this.itemList[t].busUnitAmount=a()(e)},pushSelectedItem:function(t){var e=this.selectedItemArr.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id});~e?this.selectedItemArr[e].id||0!==t.busUnitAmount?(this.selectedItemArr[e].id&&(this.selectedItemArr[e].id&&0===t.busUnitAmount?this.selectedItemArr[e].changeType="del":this.selectedItemArr[e].changeType="edit"),this.selectedItemArr[e].busUnitAmount=t.busUnitAmount,this.selectedItemArr[e].unitDTO=t.unitDTO):this.selectedItemArr.splice(e,1):t.busUnitAmount>0&&(t.changeType="add",this.selectedItemArr.push(t))},onKeyboardPre:function(){if(!this.rowActive)return!1;this.rowActive--,this.$refs.addItemList.onSelectLetter(this.rowActive,5)},onKeyboardNext:function(){if(""===this.rowActive||this.rowActive===this.itemList.length-1)return!1;this.rowActive++,this.$refs.addItemList.onSelectLetter(this.rowActive,5)},onKeyboardHide:function(){this.rowActive=""},onUnitEdit:function(){var t=this,e=this.itemList[this.rowActive].goodsDTO.id;this.getItemUnit(e).then(function(e){t.unitActions=e,t.unitActionShow=!0})},getItemUnit:function(t){var e=this;return new c.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/shopId/users/userId/goods/").concat(t,"/units"),query:{userId:e.loginerId}}).then(function(t){i(t.units)})})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemList[this.rowActive],i=e.unitDTO,o=i.value/t.value,n=a()(this.$fxUtils.toFixedSHW(e.busUnitAmount*o,this.sysPointSize));e.unitDTO=t,e.busUnitAmount=n}}},I=b,w=(i("6e15"),i("2877")),k=Object(w["a"])(I,o,n,!1,null,"83f684c8",null);e["a"]=k.exports},f07e:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-item-block fx-shadow-block"},[i("div",{staticClass:"item-title"},[i("span",{staticClass:"title-name"},[t._v("单据明细")]),i("span",{staticClass:"title-count"},[t._v("明细：")]),i("span",[t._v(t._s(t.detailsLength))]),i("i",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"title-add-icon fl-r",on:{click:t.onAddClick}}),i("i",{staticClass:"title-search-icon fl-r",on:{click:t.onSearchClick}})]),i("div",{ref:"details-content",staticClass:"item-list"},t._l(t.data,function(e,o){return i("van-swipe-cell",{directives:[{name:"show",rawName:"v-show",value:"del"!==e.changeType,expression:"item.changeType !== 'del'"}],key:e.goodsDTO.id,ref:"details-row-"+e.goodsDTO.id,refInFor:!0,staticClass:"item-row",attrs:{"right-width":80,disabled:t.isDisabled||t.focusing}},[i("itemInfoCell",t._g({attrs:{itemData:e,isDisabled:t.isDisabled,disabledEditBtn:t.focusing},on:{"on-item-focus":function(i){return t.onItemFocus(arguments,""+e.goodsDTO.id)},"on-item-blur":t.onItemBlur}},t.$listeners)),i("div",{staticClass:"item-row-delete",attrs:{slot:"right"},on:{click:function(i){return t.onDeleteClick(e,o,t.data)}},slot:"right"},[t._v("删除")])],1)}),1)])},n=[],s=i("02a5"),a={name:"orderItem",components:{itemInfoCell:s["a"]},props:{data:{type:Array,default:function(){return[]}},isDisabled:Boolean,itemInputFocusing:Boolean},data:function(){return{focusing:!1}},computed:{detailsLength:function(){return this.data.filter(function(t){return"del"!==t.changeType}).length}},watch:{focusing:function(t){this.$emit("update:itemInputFocusing",t)}},methods:{onAddClick:function(){if(this.isDisabled||this.focusing)return!1;this.$emit("on-add-click")},onSearchClick:function(){if(this.focusing)return!1;this.$emit("on-search-click")},onDeleteClick:function(t,e,i){t.id?(this.$set(t,"changeType","del"),this.$set(t,"busUnitAmount",0)):i.splice(e,1)},onItemFocus:function(t,e){this.focusing=!0},onItemBlur:function(){this.focusing=!1}}},r=a,l=(i("9435"),i("2877")),c=Object(l["a"])(r,o,n,!1,null,"3315ce81",null);e["a"]=c.exports},fd39:function(t,e,i){"use strict";var o=i("02b1"),n=i.n(o);n.a},fd54:function(t,e,i){}}]);
//# sourceMappingURL=moveOrder.e3aa3143.js.map