(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["shopOrder"],{"01f7":function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"details-content",staticClass:"item-details-content"},[i("van-list",{attrs:{finished:t.loadFinished,"finished-text":"没有更多了",error:t.listError,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.listError=e},load:t.onLoadMore},model:{value:t.currentListLoading,callback:function(e){t.currentListLoading=e},expression:"currentListLoading"}},t._l(t.itemList,function(e,a){return i("div",{key:e.goodsDTO.id,ref:"details-row-"+a,refInFor:!0,staticClass:"item-detail"},[t._t("item-cell",null,{$item:e,$index:a})],2)}),0)],1)},n=[],o=i("795b"),s=i.n(o),r=(i("c5f6"),{name:"addItemList",props:{value:[String,Number],itemList:{type:Array,default:function(){return[]}},listLoading:Boolean,loadFinished:Boolean,listError:{type:Boolean,default:!1}},data:function(){return{currentListLoading:!1}},watch:{listLoading:{handler:function(t){this.currentListLoading=t},immediate:!0},currentListLoading:function(t){this.$emit("update:listLoading",t)}},computed:{comptedItemImgSrc:function(t){return function(t){return 0===t.length?"":t[0]}}},methods:{onLoadMore:function(){this.$emit("on-load-more")},onSelectLetter:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40,i=this.$refs["details-row-".concat(t)];if(!i||0===i.length)return!1;var a=i[0].offsetTop,n=this.$refs["details-content"];this.$fxUtils.scrollTopW({offsetTop:a,$el:n,distance:e})},prev:function(t){var e=this;return new s.a(function(i){if(0===t)return!1;var a=t-1,n=e.itemList[a];e.onSelectLetter(a),i({data:n,index:a})})},next:function(t){var e=this;return new s.a(function(i){if(t===e.itemList.length-1)return!1;var a=t+1,n=e.itemList[a];e.onSelectLetter(a),i({data:n,index:a})})}}}),l=r,c=(i("2f8b"),i("2877")),u=Object(c["a"])(l,a,n,!1,null,"7690e6e7",null);e["a"]=u.exports},"0a07":function(t,e,i){},"0a4b":function(t,e,i){"use strict";var a=i("14dc"),n=i.n(a);n.a},"0b93":function(t,e,i){},"0ced":function(t,e,i){},"0ef4":function(t,e,i){"use strict";var a=i("e202"),n=i.n(a);n.a},"10dd":function(t,e,i){"use strict";var a=i("ad72"),n=i.n(a);n.a},"11fa":function(t,e,i){"use strict";var a=i("d281"),n=i.n(a);n.a},1262:function(t,e,i){"use strict";var a=i("7fc0"),n=i.n(a);n.a},"14dc":function(t,e,i){},"177d":function(t,e,i){"use strict";var a=i("17d8"),n=i.n(a);n.a},"17d8":function(t,e,i){},"22cb":function(t,e,i){"use strict";var a=i("8943"),n=i.n(a);n.a},2606:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"itemRowEdit-popup"},[i("w-header",{attrs:{title:t.currentItemData.goodsDTO.name,leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{staticClass:"itemRowEdit-content"},[i("van-cell-group",[i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopOrderBill.goodsSize"),expression:"$fxAuth('shopOrderBill.goodsSize')"}],staticClass:"fx-van-cell",attrs:{title:"品项规格",value:t.currentItemData.goodsDTO.spec,"value-class":"info-item-value"}}),i("van-cell",{staticClass:"fx-van-cell",attrs:{title:"订货单位",value:t.currentItemData.unitDTO.name,"value-class":"info-item-value"}}),i("van-cell",{staticClass:"fx-van-cell",attrs:{title:"实际分派数量",value:t.currentItemData.assignAmount,"value-class":"info-item-value"}}),i("van-pro-field",{staticClass:"fx-van-cell",attrs:{label:"备注","value-class":"info-item-value",placeholder:t.setPlaceholder("请输入备注"),"input-align":"right",disabled:t.isDisabled},model:{value:t.currentItemData.memo,callback:function(e){t.$set(t.currentItemData,"memo",e)},expression:"currentItemData.memo"}}),t.$fxAuth("shopOrderBill.showReferenceMoney")?i("van-cell",{staticClass:"fx-van-cell",attrs:{title:"参考税率",value:t.fomatterTaxes(t.currentItemData.consultTax),"value-class":"info-item-value"}}):t._e(),t.$fxAuth("shopOrderBill.showReferenceMoney")?i("van-cell",{staticClass:"fx-van-cell",attrs:{title:"参考税额",value:t.currentItemData.consultTaxMoney,"value-class":"info-item-value"}}):t._e(),t.$fxAuth("shopOrderBill.showReferenceMoney")?i("van-cell",{staticClass:"fx-van-cell",attrs:{title:"参考含税单价",value:t.currentItemData.consultTaxPrice,"value-class":"info-item-value"}}):t._e(),t.$fxAuth("shopOrderBill.showReferenceMoney")?i("van-cell",{staticClass:"fx-van-cell",attrs:{title:"参考含税金额",value:t.currentItemData.consultMoneyWithTax,"value-class":"info-item-value"}}):t._e(),i("van-cell",{staticClass:"fx-van-cell",attrs:{title:"配送属性",value:t.fomatterDT(t.currentItemData.dispatchAttr),"value-class":"info-item-value"}}),"2"===t.currentItemData.dispatchAttr&&t.$fxSysAuth("shopOrderBill.directSelectSup")?i("van-cell",{staticClass:"fx-van-cell",attrs:{title:"供货商",value:t.currentItemData.expectSupplierDTO&&t.currentItemData.expectSupplierDTO.name,"value-class":"info-item-value","is-link":""},on:{click:t.onSupplierClick}}):t._e()],1)],1),i("div",{staticClass:"itemRowEdit-bottom"},[t.isDisabled?i("van-button",{staticClass:"confirm-btn fx-no-radius fx-btn",attrs:{type:"primary"},on:{click:t.onCloseClick}},[t._v("确定")]):i("van-button",{staticClass:"confirm-btn fx-no-radius fx-btn",attrs:{type:"primary"},on:{click:t.onConfirmClick}},[t._v("保存")]),i("filterListPopup",{attrs:{title:"供货商检索",rollingLoad:!0,getDataApi:t.getSupplierListData},on:{"on-select":function(e){return t.selectSupplier(arguments)}},model:{value:t.supplierPopShow,callback:function(e){t.supplierPopShow=e},expression:"supplierPopShow"}})],1)],1)},n=[],o=i("768b"),s=i("f499"),r=i.n(s),l=i("eb03"),c={name:"itemRowEdit",components:{filterListPopup:l["a"]},props:{visibleFlag:Boolean,itemData:{type:Object,default:function(){return{}}},shopId:String,isDisabled:Boolean},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},supplierPopShow:!1,currentItemData:{}}},computed:{setPlaceholder:function(t){var e=this;return function(t){return e.isDisabled?"":t}},fomatterTaxes:function(t){var e=this;return function(t){if(t){var i=e.$fxUtils.toFixedSHW(100*t,2,!1);return"".concat(i,"%")}return"0%"}},fomatterDT:function(t){return function(t){var e="";switch(t){case"0":e="统配";break;case"1":e="直配";break;case"2":e="直送";break;case"3":e="直通";break}return e}}},watch:{visibleFlag:{handler:function(t){t&&(this.currentItemData=JSON.parse(r()(this.itemData)))},immediate:!0}},methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onConfirmClick:function(){this.currentItemData.id&&(this.currentItemData.changeType="edit"),this.$emit("on-Confirm",this.currentItemData),this.$emit("update:visibleFlag",!1)},onSupplierClick:function(){this.supplierPopShow=!0},selectSupplier:function(t){var e=Object(o["a"])(t,1),i=e[0];this.currentItemData.expectSupplierDTO=i},getSupplierListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,a={pid:this.currentItemData.goodsDTO.id,sendGoodsId:this.currentItemData.sendGoodPlanDetailId,searchText:t,start:e,size:i};return this.$fxApi("shopOrderBill.getDirectGoodsSupplier",this.shopId)({data:a}).then(function(t){return t.suppliers})}}},u=c,d=(i("329f"),i("2877")),h=Object(d["a"])(u,a,n,!1,null,"322e2520",null);e["a"]=h.exports},2741:function(t,e,i){},2750:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-estimateDay-details"},[i("w-header",{attrs:{title:t.isDisabled?"查看录入的日额":"日额预估",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{staticClass:"estimateDay-content"},[i("div",{staticClass:"table-wrap"},[t._m(0),t._l(t.dataList,function(e,a){return i("div",{key:a,staticClass:"row-wrap"},[i("span",{staticClass:"cell-style col-cell-1"},[t._v(t._s(a+1))]),i("span",{staticClass:"cell-style col-cell-2"},[t._v(t._s(e.rq))]),i("span",{staticClass:"cell-style col-cell-3"},[t.isDisabled?i("span",[t._v(t._s(e.money))]):i("w-stepper",{staticClass:"amount-step",attrs:{min:"0",max:t.maxAmount,stepperBtnShow:!1,intLength:t.numberLength,inputWidth:"28vw"},model:{value:e.money,callback:function(i){t.$set(e,"money",i)},expression:"item.money"}})],1)])}),i("div",{staticClass:"row-wrap"},[i("span",{staticClass:"cell-style col-cell-1"},[t._v(t._s(t.dataList.length+1))]),i("span",{staticClass:"cell-style col-cell-2"},[t._v("合计")]),i("span",{staticClass:"cell-style col-cell-3"},[t.isDisabled?i("span",[t._v(t._s(t.sumMoney))]):i("w-stepper",{staticClass:"amount-step",attrs:{min:"0",max:t.maxAmount,stepperBtnShow:!1,intLength:t.numberLength,pointSize:t.sysPointSize,disabled:!0,inputWidth:"28vw"},model:{value:t.sumMoney,callback:function(e){t.sumMoney=e},expression:"sumMoney"}})],1)]),i("div",{staticClass:"row-wrap"},[i("span",{staticClass:"cell-style col-cell-1"},[t._v(t._s(t.dataList.length+2))]),i("span",{staticClass:"cell-style col-cell-2"},[t._v("日均")]),i("span",{staticClass:"cell-style col-cell-3"},[t.isDisabled?i("span",[t._v(t._s(t.dayMoney))]):i("w-stepper",{staticClass:"amount-step",attrs:{min:"0",max:t.maxAmount,stepperBtnShow:!1,intLength:t.numberLength,pointSize:t.sysPointSize,disabled:!0,inputWidth:"28vw"},model:{value:t.dayMoney,callback:function(e){t.dayMoney=e},expression:"dayMoney"}})],1)])],2)]),t.isDisabled?t._e():i("div",{staticClass:"estimateDay-bottom"},[i("van-button",{attrs:{type:"primary fx-btn",round:"",size:"small"},on:{click:t.onSaveDayMoney}},[t._v("保存至预估营业额")])],1)],1)},n=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"row-wrap row-head"},[i("span",{staticClass:"cell-style col-cell-1"},[t._v("序号")]),i("span",{staticClass:"cell-style col-cell-2"},[t._v("日期")]),i("span",{staticClass:"cell-style col-cell-3"},[t._v("营业额")])])}],o=i("59ad"),s=i.n(o),r=i("cebc"),l=(i("c5f6"),i("2f62")),c={name:"EstimateDayPop",components:{},props:{visibleFlag:Boolean,checkDate:{type:[String,Number],default:""},forecastAvailable:{type:Number,default:0},estimateDayList:{type:Array,default:function(){return[]}},isDisabled:{type:Boolean,default:!1}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},money:0,dataList:[]}},watch:{visibleFlag:{handler:function(t){t&&(this.estimateDayList.length?this.dataList=this.estimateDayList:this.setData())},immediate:!0}},computed:Object(r["a"])({},Object(l["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",maxAmount:"maxAmount"}),{sumMoney:function(){var t=this;return this.dataList.reduce(function(e,i){return e+t.toFixedNumberSize(i.money)},0)},dayMoney:function(){var t=this,e=this.dataList.filter(function(e){return t.toFixedNumberSize(e.money)>0&&"fullMoney"!==e.id&&"安全额"!==e.rq}).length;return e?s()(this.$fxUtils.toFixedSHW(this.sumMoney/e)):0}}),methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},toFixedNumberSize:function(t){return s()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},setData:function(){this.dataList=[];for(var t=0;t<this.forecastAvailable;t++){var e={};e.rq=this.$fxUtils.setDate(this.$fxUtils.getCustomAssignDate(this.$fxUtils.setDate(new Date(this.checkDate)),t)),e.money=0,this.dataList.push(e)}var i={id:"fullMoney",rq:"安全额",money:0};this.dataList.push(i)},onSaveDayMoney:function(){var t=[{id:"dayMoneyTotal",rq:"合计",money:this.sumMoney},{id:"dayMoneyAvg",rq:"日均",money:this.dayMoney}];this.$emit("update:visibleFlag",!1),this.$emit("on-saveDayMoney-click",{dayList:this.dataList,allMoney:t})}}},u=c,d=(i("b83c"),i("2877")),h=Object(d["a"])(u,a,n,!1,null,"62a3dca7",null);e["a"]=h.exports},2833:function(t,e,i){"use strict";var a=i("ccf0"),n=i.n(a);n.a},2912:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("w-app-page",{staticClass:"inteledi-shopOrder"},[i("w-header",{attrs:{title:"门店订货单",border:!0}},[i("headEditBtn",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopOrderBill.batch"),expression:"$fxAuth('shopOrderBill.batch')"}],attrs:{slot:"header-right",active:t.orderEditFlag},on:{click:t.onOrderEditClick},slot:"header-right"}),i("headSearchBtn",{directives:[{name:"show",rawName:"v-show",value:!t.orderEditFlag,expression:"!orderEditFlag"}],attrs:{slot:"header-right"},on:{click:t.onSearchClick},slot:"header-right"}),i("headSelectAllBtn",{directives:[{name:"show",rawName:"v-show",value:t.orderEditFlag,expression:"orderEditFlag"}],attrs:{slot:"header-right",active:t.isSelectAll},on:{click:t.onSelectAllClick},slot:"header-right"})],1),i("filterTab",{attrs:{state:t.computedState,urgency:t.computedUrgency},on:{"on-state-click":t.onStateClick,"on-urgency-click":t.onUrgencyClick}}),i("div",{staticClass:"shopOrder-content"},[i("van-pull-refresh",{directives:[{name:"show",rawName:"v-show",value:0!==t.orderList.length,expression:"orderList.length !== 0"}],staticClass:"shopOrder-list",on:{refresh:t.onPullRefresh},model:{value:t.pullRefreshLoading,callback:function(e){t.pullRefreshLoading=e},expression:"pullRefreshLoading"}},[i("van-list",{attrs:{finished:t.loadFinished,"finished-text":"没有更多了",error:t.listError,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.listError=e},load:t.onLoadMore},model:{value:t.listLoading,callback:function(e){t.listLoading=e},expression:"listLoading"}},t._l(t.orderList,function(e){return i("orderBlock",{directives:[{name:"show",rawName:"v-show",value:t.computedShowOrder(e.billState),expression:"computedShowOrder(item.billState)"}],key:e.id,attrs:{data:e,showCheckBox:t.orderEditFlag},on:{"on-click":function(i){return t.onClickOrder(e)}}})}),1)],1),i("emptyBill",{directives:[{name:"show",rawName:"v-show",value:0===t.orderList.length,expression:"orderList.length === 0"}]})],1),i("w-bottom-btn-bar",{staticClass:"shopOrder-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.orderEditFlag&&t.$fxAuth("shopOrderBill.add"),expression:"!orderEditFlag && $fxAuth('shopOrderBill.add')"}],staticClass:"add-btn fx-no-radius fx-btn",attrs:{type:"primary"},on:{click:t.onCreateClick}},[t._v("添加单据")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.orderEditFlag&&t.$fxAuth("shopOrderBill.batch"),expression:"orderEditFlag && $fxAuth('shopOrderBill.batch')"}],staticClass:"add-btn fx-no-radius fx-btn",attrs:{type:"primary"},on:{click:t.onExpressClick}},[t._v("批量审核")])],1),i("van-actionsheet",{attrs:{actions:t.stateActions,"cancel-text":"取消"},on:{select:t.onStateSelect},model:{value:t.stateActionShow,callback:function(e){t.stateActionShow=e},expression:"stateActionShow"}}),i("van-actionsheet",{attrs:{actions:t.urgencyActions,"cancel-text":"取消"},on:{select:t.onUrgencySelect},model:{value:t.urgencyActionShow,callback:function(e){t.urgencyActionShow=e},expression:"urgencyActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.filterPopShow,callback:function(e){t.filterPopShow=e},expression:"filterPopShow"}},[i("filterPop",{attrs:{visibleFlag:t.filterPopShow,filterParams:t.filterParams},on:{"update:visibleFlag":function(e){t.filterPopShow=e},"update:visible-flag":function(e){t.filterPopShow=e},"update:filterParams":function(e){t.filterParams=e},"update:filter-params":function(e){t.filterParams=e},"on-confirm":t.onFilterConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.attachListPopShow,callback:function(e){t.attachListPopShow=e},expression:"attachListPopShow"}},[i("attachListPop",{attrs:{attachPopTitle:"附属列表",data:t.attachList,visibleFlag:t.attachListPopShow},on:{"update:visibleFlag":function(e){t.attachListPopShow=e},"update:visible-flag":function(e){t.attachListPopShow=e},"on-continue-check":t.expressBillList}})],1)],1)},n=[],o=(i("ac6a"),i("75fc")),s=i("5176"),r=i.n(s),l=i("795b"),c=i.n(l),u=(i("7514"),i("7f7f"),i("cebc")),d=(i("6762"),i("2f62")),h=i("b215"),f=i("46aa"),m=i("a0be"),p=i("4102"),v=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-block fx-shadow-block",on:{click:t.onClick}},[i("checkBox",{staticClass:"order-checkbox",attrs:{visibleFlag:t.showCheckBox,checked:t.data.checked},on:{"on-checkbox-click":t.onClick}}),i("div",{staticClass:"block-content"},[i("div",{staticClass:"block-title"},[i("i",{staticClass:"block-icon"}),i("span",{staticClass:"title-text fx-ellipsis"},[t._v(t._s(t.data.shopDTO.name))]),i("stateTag",{staticClass:"state-tag",attrs:{billState:t.data.billState,reCheckState:t.data.reCheckState}})],1),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No fx-ellipsis"},[t._v(t._s(t.data.sysbillCode))])]),i("div",{staticClass:"block-value houseName-item"},[t.data.houseName?[i("div",[t._v("订货仓库：")]),i("span",{staticClass:"order-warehouse"},[t._v(t._s(t.data.houseName))])]:t._e()],2),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-date"},[i("span",[t._v("业务日期：")]),i("span",[t._v(t._s(t._f("filterDateYMD")(t.data.businessDate)))]),i("van-icon",{staticClass:"order-date-arrow",attrs:{name:"arrow"}})],1)]),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-date"},[i("span",[t._v("到货日期：")]),i("span",[t._v(t._s(t._f("filterDateYMD")(t.data.arriveDate)))]),i("van-icon",{staticClass:"order-date-arrow",attrs:{name:"arrow"}})],1)])])],1)},b=[],g=i("0f38"),C=i("0b26"),S={name:"orderBlock",components:{stateTag:C["a"],checkBox:g["a"]},props:{data:{type:Object,default:function(){return{}}},showCheckBox:{type:Boolean,default:!1}},methods:{onClick:function(){this.showCheckBox?this.$set(this.data,"checked",!this.data.checked):this.$emit("on-click",this.data)}}},D=S,k=(i("2833"),i("2877")),y=Object(k["a"])(D,v,b,!1,null,"98dfb074",null),w=y.exports,x=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"filter-popup"},[i("w-header",{attrs:{title:"筛选条件",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{ref:"filterContent",staticClass:"filter-content"},[i("van-cell-group",[i("van-cell",{staticClass:"fx-van-cell",attrs:{title:"业务日期"}}),i("van-cell",{staticClass:"fx-van-cell",attrs:{title:"起始时间",value:t.beginDate,"is-link":""},on:{click:t.onBeginDateClick}}),i("van-cell",{staticClass:"fx-van-cell",attrs:{title:"结束时间",value:t.endDate,"is-link":""},on:{click:t.onEndDateClick}}),i("van-cell",{staticClass:"fx-van-cell",attrs:{title:"到货日期"}}),i("van-cell",{staticClass:"fx-van-cell",attrs:{title:"起始时间",value:t.arriveBeginDate,"is-link":""},on:{click:t.onArriveBeginDateClick}}),i("van-cell",{staticClass:"fx-van-cell",attrs:{title:"结束时间",value:t.arriveEndDate,"is-link":""},on:{click:t.onArriveEndDateClick}}),i("van-cell",{staticClass:"fx-van-cell",attrs:{title:"门店",value:t.shop,"value-class":"info-item-value","is-link":""},on:{click:t.onShopClick}}),i("van-cell",{staticClass:"fx-van-cell",attrs:{title:"仓库",value:t.store,"value-class":"info-item-value","is-link":""},on:{click:t.onStoreClick}}),i("van-cell",{staticClass:"fx-van-cell",attrs:{title:"品项",value:t.item,"value-class":"info-item-value","is-link":""},on:{click:t.onItemClick}}),i("van-cell",{staticClass:"fx-van-cell",attrs:{title:"单据类型",value:t.billType,"value-class":"info-item-value"},on:{click:t.onBillTypeClick}},[i("van-icon",{staticClass:"item-clear-btn",attrs:{slot:"right-icon",name:t.billTypeId?"close":"arrow"},on:{click:function(e){e.stopPropagation(),t.billTypeId?t.onBillTypeClearClick():t.onBillTypeClick()}},slot:"right-icon"})],1),i("van-field",{ref:"billNo",staticClass:"fx-van-cell",attrs:{label:"系统单号","value-class":"info-item-value",placeholder:"请输入系统单号","input-align":"right"},on:{focus:function(e){return t.onFocus("billNo")}},model:{value:t.billNo,callback:function(e){t.billNo=e},expression:"billNo"}})],1)],1),i("div",{staticClass:"filter-bottom"},[i("van-button",{staticClass:"reset-btn fx-no-radius",attrs:{type:"info"},on:{click:t.onResetClick}},[t._v("重置")]),i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onConfirmClick}},[t._v("确定")])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("filterListPopup",{attrs:{title:"门店检索",rollingLoad:!0,getDataApi:t.getShopListData},on:{"on-select":function(e){return t.selectShop(arguments)}},model:{value:t.shopPopShow,callback:function(e){t.shopPopShow=e},expression:"shopPopShow"}}),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.storePopShow,callback:function(e){t.storePopShow=e},expression:"storePopShow"}},[i("listComp",{attrs:{visibleFlag:t.storePopShow,data:t.storeList,loadFinished:!0,title:"仓库检索"},on:{"update:visibleFlag":function(e){t.storePopShow=e},"update:visible-flag":function(e){t.storePopShow=e},"on-search":t.searchStore,"on-select":t.selectStore}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.itemPopShow,callback:function(e){t.itemPopShow=e},expression:"itemPopShow"}},[i("listComp",{attrs:{visibleFlag:t.itemPopShow,data:t.itemList,loadFinished:t.itemListLoadFinished,loading:t.onItemLoading,title:"品项检索"},on:{"update:visibleFlag":function(e){t.itemPopShow=e},"update:visible-flag":function(e){t.itemPopShow=e},"update:loading":function(e){t.onItemLoading=e},"on-search":t.searchItem,"on-select":t.selectItem,"on-load":t.onItemLoad}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.billTypePopShow,callback:function(e){t.billTypePopShow=e},expression:"billTypePopShow"}},[i("listComp",{attrs:{visibleFlag:t.billTypePopShow,data:t.billTypeList,loadFinished:!0,title:"单据类型检索"},on:{"update:visibleFlag":function(e){t.billTypePopShow=e},"update:visible-flag":function(e){t.billTypePopShow=e},"on-search":t.searchBillType,"on-select":t.selectBillType}})],1)],1)},I=[],P=i("768b"),O=i("f6bb"),A=i("eb03"),T=50,$={name:"filterPop",components:{listComp:O["a"],filterListPopup:A["a"]},props:{visibleFlag:Boolean,filterParams:{type:Object,default:function(){return{}}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},dateType:"",currentDate:new Date,beginDate:this.$fxCommon.orderFilterStartDate(),endDate:this.$fxCommon.orderFilterEndDate(),arriveBeginDate:"",arriveEndDate:"",shop:"请选择",shopId:"",store:"请选择",storeId:"",item:"请选择",itemId:"",billType:"请选择",billTypeId:"",billNo:"",datePickerShow:!1,shopPopShow:!1,storePopShow:!1,itemPopShow:!1,billTypePopShow:!1,storeList:[],itemList:[],billTypeList:[],itemListStart:0,onItemLoading:!1,itemListLoadFinished:!1}},watch:{visibleFlag:{handler:function(t){this.datePickerShow=!1,t&&this.$fxUtils.isEmptyObjSHW(this.filterParams)&&this.resetHandler()},immediate:!0}},computed:Object(u["a"])({},Object(d["c"])({loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}})),methods:{getFilterParams:function(){return{beginDate:this.beginDate||this.$fxCommon.orderFilterStartDate(),endDate:this.endDate||this.$fxCommon.orderFilterEndDate(),arriveBeginDate:this.arriveBeginDate||"",arriveEndDate:this.arriveEndDate||"",shopId:this.shopId,storeId:this.storeId,billTypeId:this.billTypeId,itemId:this.itemId,billNo:this.billNo}},onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onConfirmClick:function(){this.$emit("update:visibleFlag",!1),this.$emit("update:filterParams",this.getFilterParams()),this.$emit("on-confirm",this.getFilterParams())},onResetClick:function(){this.resetHandler()},resetHandler:function(){this.beginDate=this.$fxCommon.orderFilterStartDate(),this.endDate=this.$fxCommon.orderFilterEndDate(),this.arriveBeginDate="",this.arriveEndDate="",this.shop="请选择",this.shopId="",this.store="请选择",this.storeId="",this.billType="请选择",this.billTypeId="",this.item="请选择",this.itemId="",this.billNo=""},onBeginDateClick:function(){this.dateType="begin",this.beginDate&&(this.currentDate=new Date(this.beginDate)),this.datePickerShow=!0},onEndDateClick:function(){this.dateType="end",this.endDate&&(this.currentDate=new Date(this.endDate)),this.datePickerShow=!0},onArriveBeginDateClick:function(){this.dateType="arriveBegin",this.arriveBeginDate&&(this.currentDate=new Date(this.arriveBeginDate)),this.datePickerShow=!0},onArriveEndDateClick:function(){this.dateType="arriveEnd",this.arriveEndDate&&(this.currentDate=new Date(this.arriveEndDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){"begin"===this.dateType?(this.beginDate=this.$fxUtils.setDateTime(t,"时分"),this.endDate&&this.$fxCommon.orderFilterRangeDate(this.beginDate,this.endDate)||(this.endDate=this.$fxCommon.orderFilterDate(t))):"end"===this.dateType?(this.endDate=this.$fxUtils.setDateTime(t,"时分"),this.beginDate&&this.$fxCommon.orderFilterRangeDate(this.beginDate,this.endDate)||(this.beginDate=this.$fxCommon.orderFilterStartDate(t))):"arriveBegin"===this.dateType?(this.arriveBeginDate=this.$fxUtils.setDateTime(t,"时分"),this.arriveEndDate&&this.$fxCommon.orderFilterRangeDate(this.arriveBeginDate,this.arriveEndDate)||(this.arriveEndDate=this.$fxCommon.orderFilterDate(t))):"arriveEnd"===this.dateType&&(this.arriveEndDate=this.$fxUtils.setDateTime(t,"时分"),this.arriveBeginDate&&this.$fxCommon.orderFilterRangeDate(this.arriveBeginDate,this.arriveEndDate)||(this.arriveBeginDate=this.$fxCommon.orderFilterStartDate(t))),this.datePickerShow=!1},onShopClick:function(){this.shopPopShow=!0},selectShop:function(t){var e=Object(P["a"])(t,1),i=e[0];this.shop=i.name,this.shopId=i.id},getShopListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,a={keyword:t,start:e,size:i,orgFlag:0};return this.$fxApi("z5common.getUserManageShop")({data:a}).then(function(t){return t.shops})},onStoreClick:function(){if(!this.shopId)return this.$fxToast.fail("请先选择门店!"),!1;this.onStoreRefresh()},searchStore:function(t){this.onStoreRefresh(t)},selectStore:function(t){this.store=t.name,this.storeId=t.id},onStoreRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getStoreListData(e).then(function(e){t.storeList=e.shops,t.storePopShow=!0})},getStoreListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new c.a(function(i){var a={keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/houses"),data:a}).then(function(t){i(t)})})},onItemClick:function(){this.onItemRefresh()},searchItem:function(t){this.onItemRefresh(t)},selectItem:function(t){this.item=t.name,this.itemId=t.id},onItemRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.itemListStart=0,this.getItemListData(e).then(function(e){t.itemPopShow=!0,t.onItemLoading=!1,t.itemListStart+=T,t.itemListLoadFinished=e.goods.length<T,t.itemList=e.goods})},onItemLoad:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getItemListData(e).then(function(e){var i;t.onItemLoading=!1,t.itemListStart+=T,e.goods.length<T&&(t.itemListLoadFinished=!0),(i=t.itemList).push.apply(i,Object(o["a"])(e.goods))})},getItemListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new c.a(function(i){var a={start:t.itemListStart,size:T,paged:!0,keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/goods"),data:a}).then(function(t){i(t)})})},onBillTypeClick:function(){this.onBillTypeRefresh()},searchBillType:function(t){this.onBillTypeRefresh(t)},selectBillType:function(t){this.billType=t.name,this.billTypeId=t.id},onBillTypeRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getBillTypeListData(e).then(function(e){t.billTypeList=e.businessTypes,t.billTypePopShow=!0})},getBillTypeListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new c.a(function(i){var a={m:"list4ShopOrderBill",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/businessTypes"),data:a}).then(function(t){i(t)})})},onFocus:function(t){this.onScrollTop(t)},onScrollTop:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,i=this.$refs[t];if(!i||0===i.length)return!1;var a=i.$el.offsetTop,n=this.$refs["filterContent"];this.$fxUtils.scrollTopW({offsetTop:a,$el:n,distance:e})},onBillTypeClearClick:function(){this.billType="请选择",this.billTypeId=""}}},B=$,F=(i("4d8f"),Object(k["a"])(B,x,I,!1,null,"bd8ab8c8",null)),L=F.exports,_=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"shopOrder-filter fx-shadow-down",class:{"fx-big-size":"normal"!==t.fontSizeType}},[i("div",{staticClass:"filter-item",on:{click:t.onStateClick}},[i("span",[t._v("审核状态")]),i("van-icon",{staticClass:"filter-arrow",attrs:{name:"arrow-down"}}),i("span",[t._v(t._s(t.state))])],1),i("div",{staticClass:"filter-item",on:{click:t.onUrgencyClick}},[i("span",[t._v("是否加急")]),i("van-icon",{staticClass:"filter-arrow",attrs:{name:"arrow-down"}}),i("span",[t._v(t._s(t.urgency))])],1)])},E=[],N={name:"filterTab",props:{state:String,urgency:String},computed:Object(u["a"])({},Object(d["c"])({fontSizeType:function(t){return t.stylusDynamic.fontSizeType}})),methods:{onStateClick:function(){this.$emit("on-state-click")},onUrgencyClick:function(){this.$emit("on-urgency-click")}}},R=N,M=(i("11fa"),Object(k["a"])(R,_,E,!1,null,"d70762b6",null)),U=M.exports,H=i("f3e4"),W=50,G={name:"shopOrder",components:{headSearchBtn:h["a"],headEditBtn:f["a"],headSelectAllBtn:m["a"],emptyBill:p["a"],orderBlock:w,filterPop:L,filterTab:U,attachListPop:H["a"]},data:function(){return{orderList:[],filterPopShow:!1,filterState:null,stateActionShow:!1,stateActions:[{id:null,name:"全部"},{id:"0",name:"未审核"},{id:"1",name:"已审核"}],filterUrgency:null,urgencyActionShow:!1,urgencyActions:[{id:null,name:"全部"},{id:!0,name:"加急"},{id:!1,name:"不加急"}],listStart:0,pullRefreshLoading:!1,listLoading:!1,loadFinished:!0,listError:!1,orderEditFlag:!1,filterParams:{},attachList:[],attachListPopShow:!1}},beforeRouteLeave:function(t,e,i){if("/login"===t.path)i();else{if(this.filterPopShow)return this.filterPopShow=!1,this.$router.go(1),!1;i()}},beforeRouteEnter:function(t,e,i){var a=["/main/home","/"],n=["/shopOrderDetails"];a.includes(e.path)?i(function(e){e.restFilterParams(),e.restRouterParams(t.params),e.refreshOrderList()}):n.includes(e.path)?i(function(t){t.refreshOrderList()}):i()},computed:Object(u["a"])({},Object(d["c"])({billListPostParams:"billListPostParams",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{computedState:function(){var t=this;return this.stateActions.find(function(e){return e.id===t.filterState}).name},computedUrgency:function(){var t=this;return this.urgencyActions.find(function(e){return e.id===t.filterUrgency}).name},computedShowOrder:function(t){var e=this;return function(t){return!e.orderEditFlag||1!==t}},isSelectAll:function(){var t=this.orderList.filter(function(t){return 1!==t.billState});if(0===t.length)return!1;var e=t.filter(function(t){return!!t.checked});return e.length===t.length}}),methods:{orderListPostHandler:function(t){var e=this;return new c.a(function(i){e.$store.commit({type:"SETSTATE",billListPostParams:t}),e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/shoporders/users/").concat(e.loginerId),data:t}).then(function(t){i(t)})})},refreshOrderList:function(){var t=this;return new c.a(function(e){t.listStart=0;var i={start:t.listStart,size:W,paged:!0,businessDateStart:t.$fxCommon.orderFilterStartDate(),businessDateEnd:t.$fxCommon.orderFilterEndDate(),billState:t.filterState,urgentFlag:t.filterUrgency};i=r()(i,t.translateFilterParams(t.filterParams)),t.orderListPostHandler(i).then(function(i){t.orderList=i.shopOrderBills,e(i)})})},onFilterConfirm:function(t){var e=this;this.listStart=0;var i={start:this.listStart,size:W,paged:!0,businessDateStart:t.beginDate,businessDateEnd:t.endDate,arriveDateStart:t.arriveBeginDate,arriveDateEnd:t.arriveEndDate,billState:this.filterState,urgentFlag:this.filterUrgency,shopId:""===t.shopId?null:t.shopId,houseId:""===t.storeId?null:t.storeId,goodsId:""===t.itemId?null:t.itemId,businessType:""===t.billTypeId?null:t.billTypeId,sysBillCode:""===t.billNo?null:t.billNo};this.orderListPostHandler(i).then(function(t){e.orderList=t.shopOrderBills})},translateFilterParams:function(t){return this.$fxUtils.isEmptyObjSHW(t)?{}:{businessDateStart:t.beginDate,businessDateEnd:t.endDate,arriveDateStart:t.arriveBeginDate,arriveDateEnd:t.arriveEndDate,shopId:""===t.shopId?null:t.shopId,houseId:""===t.storeId?null:t.storeId,goodsId:""===t.itemId?null:t.itemId,businessType:""===t.billTypeId?null:t.billTypeId,sysBillCode:""===t.billNo?null:t.billNo}},onPullRefresh:function(){var t=this;this.refreshOrderList().then(function(e){t.pullRefreshLoading=!1})},onLoadMore:function(){var t=this,e=r()(this.billListPostParams,{start:this.listStart});this.orderListPostHandler(e).then(function(e){var i;(i=t.orderList).push.apply(i,Object(o["a"])(e.shopOrderBills))})},onSearchClick:function(){this.filterPopShow=!0},onStateClick:function(){this.stateActionShow=!0},onStateSelect:function(t){this.filterState=t.id,this.stateActionShow=!1,this.refreshOrderList()},onUrgencyClick:function(){this.urgencyActionShow=!0},onUrgencySelect:function(t){this.filterUrgency=t.id,this.urgencyActionShow=!1,this.refreshOrderList()},onClickOrder:function(t){this.$router.push({path:"shopOrderDetails",query:{orderId:t.id}})},onCreateClick:function(){this.$router.push("createShopOrder")},onOrderEditClick:function(){this.orderEditFlag=!this.orderEditFlag},onExpressClick:function(){var t=this,e=this.orderList.reduce(function(t,e){var i=e.checked?t.concat(e.id):t;return i},[]);if(0===e.length)return!1;this.$fxAuth("shopOrderBill.attachFlag")&&this.$fxSysAuth("shopOrderBill.sysOrderGoodsAttachPlan")?this.$fxHttp.requestPost({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/shoporders/assistantGoods"),data:e}).then(function(e){e.shopOrderBills.length?(t.attachListPopShow=!0,t.attachList=e.shopOrderBills):t.$dialog.confirm({title:"提示",message:"无可导入的附属明细，确定要审核单据吗？"}).then(function(){t.expressBillList()})}):this.$dialog.confirm({title:"提示",message:"确定要审核所选单据?"}).then(function(){t.expressBillList()})},expressBillList:function(){var t=this,e=this.orderList.reduce(function(t,e){var i=e.checked?t.concat(e.id):t;return i},[]);if(0===e.length)return!1;this.expressHandler(e).then(function(e){t.orderEditFlag=!t.orderEditFlag,t.refreshOrderList().then(function(){t.$fxToast.success(e.message)})}).catch(function(){t.refreshOrderList()})},expressHandler:function(t){var e=this;return new c.a(function(i,a){e.$fxHttp.requestPut({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/shoporders/users/").concat(e.loginerId),data:t,query:{m:"batchCheck"}}).then(function(t){i(t)}).catch(function(t){a(t)})})},onSelectAllClick:function(){var t=this,e=!this.isSelectAll;this.orderList.forEach(function(i){1!==i.billState&&t.$set(i,"checked",e)})},restFilterParams:function(){this.filterParams={},this.filterState=null,this.filterUrgency=null,this.orderEditFlag=!1},restRouterParams:function(t){this.$fxUtils.isEmptyObjSHW(t)||(this.filterState=t.billState)}}},z=G,j=(i("53a2"),Object(k["a"])(z,a,n,!1,null,"a494d7d6",null));e["default"]=j.exports},"2bea":function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-info-block fx-shadow-block"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},[i("van-collapse-item",{attrs:{name:"1",disabled:t.collapseDisabled}},[i("div",{staticClass:"fx-info-title",attrs:{slot:"title"},slot:"title"},[i("span",[t._v("单据信息")]),i("stateText",{staticClass:"stateTag fl-r",attrs:{billState:t.data.billState}})],1),i("van-tabs",{staticClass:"fx-info-tab",attrs:{animated:""},model:{value:t.tabActive,callback:function(e){t.tabActive=e},expression:"tabActive"}},[i("van-tab",{attrs:{title:"表头"}},[i("van-cell",{staticClass:"fx-info-item",attrs:{title:"门店","title-class":"info-item-title","value-class":"info-item-value",value:t.data.shopDTO&&t.data.shopDTO.name,"is-link":!t.isDisabled},on:{click:function(e){return t.onEmitClick("on-shop-click")}}}),i("van-cell",{staticClass:"fx-info-item",attrs:{title:"业务日期",value:t.formatterDate(t.data.businessDate),"is-link":!t.isDisabled},on:{click:t.onBusDateClick}}),i("van-cell",{staticClass:"fx-info-item",attrs:{title:"到货日期",value:t.formatterDate(t.data.arriveDate),"is-link":!t.isDisabled},on:{click:function(e){return t.onEmitClick("on-arriveDate-click")}}}),i("van-cell",{staticClass:"fx-info-item",attrs:{title:"单据类型","value-class":"info-item-value",value:t.data.businessTypeDTO&&t.data.businessTypeDTO.name},on:{click:function(e){return t.onEmitClick("on-billType-click")}}},[i("van-icon",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"item-clear-btn",attrs:{slot:"right-icon",name:t.hasBillType?"close":"arrow"},on:{click:function(e){e.stopPropagation(),t.hasBillType?t.onEmitClick("on-billType-clear"):t.onEmitClick("on-billType-click")}},slot:"right-icon"})],1),i("van-cell",{staticClass:"fx-info-item",attrs:{title:"订货方案","value-class":"info-item-value",value:t.data.orderGoodsPlanDTO&&t.data.orderGoodsPlanDTO.name,"is-link":!t.isDisabled},on:{click:function(e){return t.onEmitClick("on-orderGoodsPlan-click")}}}),i("van-switch-cell",{staticClass:"fx-info-item",attrs:{disabled:t.isDisabled||!t.$fxAuth("shopOrderBill.urgentOrder"),title:"加急标识"},on:{input:t.onUrgentInput},model:{value:t.data.urgentFlag,callback:function(e){t.$set(t.data,"urgentFlag",e)},expression:"data.urgentFlag"}}),i("van-switch-cell",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopOrderBill.attachFlag")&&t.$fxSysAuth("shopOrderBill.sysOrderGoodsAttachPlan"),expression:"$fxAuth('shopOrderBill.attachFlag') && $fxSysAuth('shopOrderBill.sysOrderGoodsAttachPlan')"}],staticClass:"fx-info-item",attrs:{value:t.formatType(t.data.attachFlag),disabled:t.isDisabled,title:"本次订货启用附属关系"},on:{input:t.onAttachFlagInput}})],1),i("van-tab",{attrs:{title:"更多"}},[i("van-cell",{staticClass:"fx-info-item",attrs:{title:"制单人",value:t.data.billEmp}}),i("van-cell",{staticClass:"fx-info-item",attrs:{title:"制单日期",value:t.formatterDate(t.data.billDate)}}),i("van-cell",{staticClass:"fx-info-item",attrs:{title:"审核人",value:t.data.checkEmp}}),i("van-cell",{staticClass:"fx-info-item",attrs:{title:"审核日期",value:t.formatterDate(t.data.checkDate)}}),i("van-pro-field",{staticClass:"fx-info-item",attrs:{label:"手工单号",placeholder:t.isDisabled?"":"请输入手工单号","input-align":"right",maxlength:"50",disabled:t.isDisabled},model:{value:t.data.manualCode,callback:function(e){t.$set(t.data,"manualCode",e)},expression:"data.manualCode"}}),i("van-pro-field",{staticClass:"fx-info-item",attrs:{label:"整单备注",placeholder:t.isDisabled?"":"请输入整单备注","input-align":"right",maxlength:"50",disabled:t.isDisabled},model:{value:t.data.billMemo,callback:function(e){t.$set(t.data,"billMemo",e)},expression:"data.billMemo"}})],1)],1)],1)],1)],1)},n=[],o=i("4760"),s={name:"orderInfo",components:{stateText:o["a"]},props:{data:{type:Object,default:function(){return{}}},isDisabled:Boolean,collapseDisabled:Boolean},data:function(){return{activeNames:["1"],tabActive:0}},computed:{formatterDate:function(t){var e=this;return function(t){return"number"===typeof t?e.$fxUtils.setDateTime(new Date(t),"时分"):""}},hasBillType:function(){return this.data.businessTypeDTO&&this.data.businessTypeDTO.id},formatType:function(t){return function(t){return"0"===t}}},methods:{onEmitClick:function(t){if(this.isDisabled)return!1;this.$emit(t)},onBusDateClick:function(){if(!this.$fxAuth("shopOrderBill.modifyBusinessDate"))return this.$toast({message:"当前没有修改业务日期权限!",position:"top"}),!1;this.onEmitClick("on-busdate-click")},onUrgentInput:function(t){var e=this;if(t)return!1;var i=this.data.details.filter(function(t){return"del"!==t.changeType});i.length>0&&this.$dialog.confirm({title:"提示",message:"确定要更换加急标识吗？会清空明细！"}).then(function(){e.data.urgentFlag=!1,e.$emit("on-item-clear")},function(){e.data.urgentFlag=!0})},onAttachFlagInput:function(t){this.data.attachFlag=t?"0":"1"},closeCollapse:function(){this.activeNames=[]}}},r=s,l=(i("6a8e"),i("2877")),c=Object(l["a"])(r,a,n,!1,null,"b445cc42",null);e["a"]=c.exports},"2dc8":function(t,e,i){"use strict";var a=i("e0fa"),n=i.n(a);n.a},"2ddf":function(t,e,i){"use strict";var a=i("4500"),n=i.n(a);n.a},"2e08":function(t,e,i){"use strict";var a=i("ec94"),n=i.n(a);n.a},"2f8b":function(t,e,i){"use strict";var a=i("8c37"),n=i.n(a);n.a},3113:function(t,e,i){},3198:function(t,e,i){"use strict";var a=i("bd2a"),n=i.n(a);n.a},"329f":function(t,e,i){"use strict";var a=i("0ced"),n=i.n(a);n.a},"3e54":function(t,e,i){"use strict";var a=i("4619"),n=i.n(a);n.a},"3f45":function(t,e,i){},"41bd":function(t,e,i){"use strict";var a=i("c51b"),n=i.n(a);n.a},4500:function(t,e,i){},4619:function(t,e,i){},"463e":function(t,e,i){},"4d8f":function(t,e,i){"use strict";var a=i("7bb3"),n=i.n(a);n.a},"4dba":function(t,e,i){"use strict";var a=i("5cad"),n=i.n(a);n.a},"4dc9":function(t,e,i){i("5737"),t.exports=i("584a").Number.isNaN},"50d5":function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-info-cell"},[i("div",{staticClass:"item-img"},[i("img",{attrs:{src:t.comptedItemImgSrc(t.itemData.goodsDTO.imageUrls||[]),onerror:t.$fxCommon.errorImg("item")}})]),i("div",{staticClass:"item-details"},[i("div",{staticClass:"item-name fx-title fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.name))]),t.sysShowCode?i("div",{staticClass:"details-cell fx-small-title"},[t._v("\n\t\t\t编号："+t._s(t.itemData.goodsDTO.code)+"\n\t\t")]):t._e(),t.$fxAuth("shopOrderBill.showReferenceMoney")?i("div",{staticClass:"details-cell"},[i("div",{staticClass:"item-spec fx-small-title fx-ellipsis"},[t._v("\n\t\t\t\t参考非税单价："+t._s(t.itemData.consultPrice)+"\n\t\t\t")])]):t._e(),t.$fxAuth("shopOrderBill.showReferenceMoney")?i("div",{staticClass:"details-cell"},[i("div",{staticClass:"item-spec fx-small-title fx-ellipsis"},[t._v("\n\t\t\t\t参考非税金额："+t._s(t.itemData.consultMoney)+"\n\t\t\t")])]):t._e(),i("div",{staticClass:"details-cell fx-title"},[i("div",{staticClass:"item-store fx-ellipsis"},[t._v(t._s(t.$fxAuth("shopOrderBill.goodsSize")?t.itemData.goodsDTO.spec:""))]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isDisabled,expression:"isDisabled"}],staticClass:"item-amount"},[i("span",[t._v(t._s(t.itemData.busUnitAmount))]),i("span",{staticClass:"fx-ellipsis"},[t._v(t._s(t.itemData.unitDTO.name))])]),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"item-amount-edit"},[i("w-stepper",{ref:"amountInput",staticClass:"amount-step",attrs:{min:"0",max:t.maxAmount,stepperBtnShow:!1,intLength:t.numberLength,pointSize:t.sysPointSize,inputWidth:"28vw"},on:{change:t.onChange,focus:t.onFocus,blur:t.onBlur},model:{value:t.itemData.busUnitAmount,callback:function(e){t.$set(t.itemData,"busUnitAmount",e)},expression:"itemData.busUnitAmount"}}),i("span",{staticClass:"unit-text fx-unit fx-ellipsis"},[t._v(t._s(t.itemData.unitDTO.name))])],1)])]),i("i",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&!t.disabledEditBtn,expression:"!isDisabled && !disabledEditBtn"}],staticClass:"block-item-edit",on:{click:t.onItemEditClick}}),i("i",{directives:[{name:"show",rawName:"v-show",value:t.isDisabled&&!t.disabledWatchBtn,expression:"isDisabled && !disabledWatchBtn"}],staticClass:"block-item-watch",on:{click:t.onItemEditClick}})])},n=[],o=i("795b"),s=i.n(o),r=i("59ad"),l=i.n(r),c=i("cebc"),u=i("2f62"),d={name:"itemInfoCell",props:{itemData:{type:Object,default:function(){return{}}},isDisabled:Boolean,disabledEditBtn:Boolean,disabledWatchBtn:Boolean,shopId:String,orderPlanId:String,blurSetFocusFlag:{type:Boolean,default:!0}},computed:Object(c["a"])({},Object(u["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",maxAmount:"maxAmount",sysShowCode:function(t){return t.systemParams.sysShowCode},loginerShopId:function(t){return t.loginer.loginerShopId}}),{comptedItemImgSrc:function(t){return function(t){return 0===t.length?"":t[0]}},computedAssignState:function(){var t="";switch(this.itemData.reCheckState){case 0:t="未发送";break;case 1:t="已发送";break;case 2:t="已同意";break;case 3:t="已发货";break;case 4:t="已收货";break;case 9:t="被退回";break;default:t="未发送"}return t}}),methods:{setFocus:function(){this.$refs.amountInput.setFocus()},editItem:function(){this.itemData.id&&this.$set(this.itemData,"changeType","edit")},onItemEditClick:function(){this.editItem(),this.$emit("on-item-edit",this.itemData)},onChange:function(t){if("del"===this.itemData.changeType)return!1;this.itemData.consultMoney=this.toFixedNumberSize(this.itemData.consultPrice*t),this.itemData.consultMoneyWithTax=this.toFixedNumberSize(this.itemData.consultTaxPrice*t),this.itemData.consultTaxMoney=this.toFixedNumberSize(this.itemData.consultMoneyWithTax-this.itemData.consultMoney),this.editItem(),this.$emit("on-item-change",this.itemData)},toFixedNumberSize:function(t){return l()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},onCheckAmount:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new s.a(function(i,a){var n=t.itemData,o=n.busUnitAmount,s=n.must,r=n.maxOrder,l=n.minOrder,c=n.rounding,u=r?"订货数量不能大于最大数量".concat(r,"\n"):"",d=l?"订货数量不能小于最小数量".concat(l,"\n"):"",h=c?"订货数量必须是".concat(c,"的倍数"):"",f=u+d+h,m="数量不符合规则";r&&o>r||l&&o<l||c&&o%c!==0?(e&&t.$fxNotify.fail(f),a(m)):0!==o||s?i():(e&&t.$fxNotify.fail("非必订品项订货数量不能为0"),a(m))})},onFocus:function(){this.$emit("on-item-focus"),this.$fxUtils.isDef(this.shopId)&&this.$fxUtils.isDef(this.orderPlanId)&&this.getCurrentItemRoundAndMin()},onBlur:function(){var t=this,e=!0;this.blurSetFocusFlag||(e=!1),this.onCheckAmount(e).then(function(){t.$emit("on-item-blur")}).catch(function(){t.blurSetFocusFlag?(t.$refs.amountInput.setFocus(),t.$emit("on-item-focus")):t.$emit("on-item-blur-fail")})},getCurrentItemRoundAndMin:function(){var t=this;this.$fxHttp.requestGet({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.shopId,"/shoporders/rondAndMin/").concat(this.itemData.goodsDTO.id,"/orderPlanId/").concat(this.orderPlanId),loading:!1,autoErrorMsg:!1}).then(function(e){t.itemData.maxOrder=l()(e.rondAndMins[0].maxOrder),t.itemData.minOrder=l()(e.rondAndMins[0].minOrder),t.itemData.must=e.rondAndMins[0].must,t.itemData.rounding=l()(e.rondAndMins[0].rounding)})}}},h=d,f=(i("0ef4"),i("2877")),m=Object(f["a"])(h,a,n,!1,null,"e8118aa2",null);e["a"]=m.exports},5311:function(t,e,i){},"53a2":function(t,e,i){"use strict";var a=i("e5ce"),n=i.n(a);n.a},"53dd":function(t,e,i){},5402:function(t,e,i){"use strict";var a=i("73b7"),n=i.n(a);n.a},5737:function(t,e,i){var a=i("63b6");a(a.S,"Number",{isNaN:function(t){return t!=t}})},"5b3e":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("w-app-page",{staticClass:"inteledi-shopOrder-create"},[i("w-header",{attrs:{title:"新增门店订货单",border:!0}}),i("orderInfo",{ref:"orderInfo",attrs:{data:t.orderInfoData,collapseDisabled:t.itemInputFocusing},on:{"on-shop-click":t.onShopClick,"on-busdate-click":t.onBusinessDateClick,"on-arriveDate-click":t.onArriveDateClick,"on-billType-click":t.onBillTypeClick,"on-orderGoodsPlan-click":t.onOrderGoodsPlanClick,"on-item-clear":t.onItemClear,"on-billType-clear":t.onBillTypeClear}}),i("orderItem",{attrs:{data:t.orderItemList,itemInputFocusing:t.itemInputFocusing,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,orderPlanId:t.orderInfoData.orderGoodsPlanDTO&&t.orderInfoData.orderGoodsPlanDTO.id},on:{"update:itemInputFocusing":function(e){t.itemInputFocusing=e},"update:item-input-focusing":function(e){t.itemInputFocusing=e},"on-add-click":t.onAddClick,"on-search-click":t.onSearchClick,"on-item-edit":t.onItemEdit,"on-item-focus":t.onItemFocus,"on-intellectorder-click":t.onIntellectOrderClick,"on-intellectbasis-click":t.onIntellectBasisClick}}),i("w-bottom-btn-bar",{staticClass:"shopOrder-bottom"},[i("van-button",{staticClass:"add-btn fx-no-radius fx-btn",attrs:{type:"primary"},on:{click:t.onCreateClick}},[t._v("生成单据")])],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.shopPopShow,callback:function(e){t.shopPopShow=e},expression:"shopPopShow"}},[i("listComp",{attrs:{visibleFlag:t.shopPopShow,data:t.shopList,loadFinished:!0,title:"请选择门店"},on:{"update:visibleFlag":function(e){t.shopPopShow=e},"update:visible-flag":function(e){t.shopPopShow=e},"on-search":t.searchShop,"on-select":t.selectShop}})],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.billTypePopShow,callback:function(e){t.billTypePopShow=e},expression:"billTypePopShow"}},[i("listComp",{attrs:{visibleFlag:t.billTypePopShow,data:t.billTypeList,loadFinished:!0,title:"单据类型检索"},on:{"update:visibleFlag":function(e){t.billTypePopShow=e},"update:visible-flag":function(e){t.billTypePopShow=e},"on-search":t.searchBillType,"on-select":t.selectBillType}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.orderGoodsPlanPopShow,callback:function(e){t.orderGoodsPlanPopShow=e},expression:"orderGoodsPlanPopShow"}},[i("listComp",{attrs:{visibleFlag:t.orderGoodsPlanPopShow,data:t.orderGoodsPlanList,loadFinished:!0,title:"订货方案检索"},on:{"update:visibleFlag":function(e){t.orderGoodsPlanPopShow=e},"update:visible-flag":function(e){t.orderGoodsPlanPopShow=e},"on-search":t.searchOrderGoodsPlan,"on-select":t.selectOrderGoodsPlan}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemStorePopShow,callback:function(e){t.itemStorePopShow=e},expression:"itemStorePopShow"}},[i("storeItemComp",{attrs:{visibleFlag:t.itemStorePopShow,storeItemData:t.storeItem,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,businessDate:t.orderInfoData.businessDate,urgentFlag:t.orderInfoData.urgentFlag,orderPlanId:t.orderInfoData.orderGoodsPlanDTO&&t.orderInfoData.orderGoodsPlanDTO.id},on:{"update:visibleFlag":function(e){t.itemStorePopShow=e},"update:visible-flag":function(e){t.itemStorePopShow=e},"on-save":t.onStoreItemSave}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemSearchPopShow,callback:function(e){t.itemSearchPopShow=e},expression:"itemSearchPopShow"}},[i("itemSearchPop",{attrs:{visibleFlag:t.itemSearchPopShow,data:t.searchItem,isDisabled:!t.$fxAuth("shopOrderBill.save")},on:{"update:visibleFlag":function(e){t.itemSearchPopShow=e},"update:visible-flag":function(e){t.itemSearchPopShow=e},"on-search-confirm":t.onSearchConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.intellectOrderPopShow,callback:function(e){t.intellectOrderPopShow=e},expression:"intellectOrderPopShow"}},[i("intellectOrderPop",{attrs:{visibleFlag:t.intellectOrderPopShow,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,orderPlanId:t.orderInfoData.orderGoodsPlanDTO&&t.orderInfoData.orderGoodsPlanDTO.id,urgentFlag:t.orderInfoData.urgentFlag,businessDate:t.orderInfoData.businessDate,arriveDate:t.orderInfoData.arriveDate,orderInfoData:t.orderInfoData},on:{"update:visibleFlag":function(e){t.intellectOrderPopShow=e},"update:visible-flag":function(e){t.intellectOrderPopShow=e},"on-creat-detail":t.onCreatDetail}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.intellectBasisPopShow,callback:function(e){t.intellectBasisPopShow=e},expression:"intellectBasisPopShow"}},[i("intellectBasisPop",{attrs:{visibleFlag:t.intellectBasisPopShow},on:{"update:visibleFlag":function(e){t.intellectBasisPopShow=e},"update:visible-flag":function(e){t.intellectBasisPopShow=e}}})],1)],1)},n=[],o=(i("20d6"),i("5176")),s=i.n(o),r=i("75fc"),l=(i("a481"),i("f499")),c=i.n(l),u=i("b6d0"),d=i.n(u),h=i("774e"),f=i.n(h),m=(i("ac6a"),i("795b")),p=i.n(m),v=i("cebc"),b=i("2f62"),g=i("2bea"),C=i("ad57"),S=i("f6bb"),D=i("d7c3"),k=i("2606"),y=i("9cca"),w=i("5f1c"),x=i("aedc"),I={name:"createShopOrder",components:{orderInfo:g["a"],orderItem:C["a"],listComp:S["a"],storeItemComp:D["a"],itemRowEditPop:k["a"],itemSearchPop:y["a"],intellectOrderPop:w["a"],intellectBasisPop:x["a"]},data:function(){return{query:this.$route.query,activeNames:["1"],tabActive:"选项1",orderInfoData:{oldDetails:"",accountDTO:{},arriveDate:this.$fxUtils.getCustomDate(1).getTime(),assignState:0,billEmp:"",billMemo:"",billState:0,businessDate:(new Date).getTime(),businessTypeDTO:{},orderGoodsPlanDTO:{},shopDTO:{},details:[],updateIndicator:"Append",urgentFlag:!1,attachFlag:"0"},orderItemList:[],dateType:"business",currentDate:new Date,shopPopShow:!1,shopList:[],datePickerShow:!1,billTypePopShow:!1,billTypeList:[],orderGoodsPlanPopShow:!1,orderGoodsPlanList:[],itemStorePopShow:!1,storeItem:[],itemRowEditPopShow:!1,itemEditRowData:{},itemInputFocusing:!1,itemSearchPopShow:!1,searchItem:[],intellectOrderPopShow:!1,intellectBasisPopShow:!1}},computed:Object(v["a"])({},Object(b["c"])({sysPointSize:"sysPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerShopName:function(t){return t.loginer.loginerShopName},loginerOrganType:function(t){return t.loginer.loginerOrganType},loginerId:function(t){return t.loginer.loginerId}})),created:function(){var t=this;this.loginerShopId&&this.$fxStateMiddleware.stateIs("loginerOrganType")("shop")(this.loginerOrganType)&&(this.orderInfoData.shopDTO={id:this.loginerShopId,name:this.loginerShopName},this.getDistributionRelation().then(function(e){t.orderInfoData.orderGoodsPlanDTO=e.distributionRelations[0].orderGoodsPlan}).catch(function(){t.getOrderGoodsPlanListData().then(function(e){e.orderGoodsPlans.length&&(t.orderInfoData.orderGoodsPlanDTO=e.orderGoodsPlans[0])})})),this.$fxAuth("shopOrderBill.sysArriveDateNull")&&(this.orderInfoData.arriveDate="")},beforeRouteLeave:function(t,e,i){var a=this;if(this.itemInputFocusing)return this.$router.go(1),!1;"/shopOrder"===t.path?this.$dialog.confirm({title:"提示",message:"若已修改,请先保存单据<br/>是否关闭页面?"}).then(function(){i()}).catch(function(){return a.$router.go(1),!1}):i()},methods:{clearItemConfim:function(t){var e=this;return new p.a(function(i){var a=e.orderItemList.filter(function(t){var e=t.details.filter(function(t){return"del"!==t.changeType});return 0!==e.length});0===a.length?i():e.$dialog.confirm({title:"提示",message:t}).then(function(){e.onItemClear(),i()}).catch(function(){})})},onShopClick:function(){this.onShopRefresh()},searchShop:function(t){this.onShopRefresh(t)},selectShop:function(t){var e=this;this.checkShop(t).then(function(){e.clearItemConfim("更换门店会清空品项和订货方案,是否继续?").then(function(){e.orderInfoData.shopDTO=t,e.orderInfoData.orderGoodsPlanDTO={},e.getDistributionRelation().then(function(t){e.orderInfoData.orderGoodsPlanDTO=t.distributionRelations[0].orderGoodsPlan,e.getArrivalDate()}).catch(function(){e.getOrderGoodsPlanListData().then(function(t){t.orderGoodsPlans.length&&(e.orderInfoData.orderGoodsPlanDTO=t.orderGoodsPlans[0],e.getArrivalDate())})})})})},getDistributionRelation:function(){var t=this;return new p.a(function(e,i){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.orderInfoData.shopDTO.id,"/distributionRelation"),autoErrorMsg:!1}).then(function(t){e(t)}).catch(function(t){i(t)})})},checkShop:function(t){var e=this;return new p.a(function(i){var a=e.orderInfoData.shopDTO;a.id!==t.id&&i()})},onShopRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getShopListData(e).then(function(e){t.shopList=e.shops,t.shopPopShow=!0})},getShopListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new p.a(function(i){var a={m:"list4ShopOrderBill4Edit",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/shops"),data:a}).then(function(t){i(t)})})},onBillTypeClick:function(){this.onBillTYpeRefresh()},searchBillType:function(t){this.onBillTYpeRefresh(t)},selectBillType:function(t){this.orderInfoData.businessTypeDTO=t},onBillTypeClear:function(){this.orderInfoData.businessTypeDTO={}},onBillTYpeRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getBillTypeListData(e).then(function(e){t.billTypeList=e.businessTypes,t.billTypePopShow=!0})},getBillTypeListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new p.a(function(i){var a={m:"list4ShopOrderBill",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/businessTypes"),data:a}).then(function(t){i(t)})})},onOrderGoodsPlanClick:function(){if(!this.orderInfoData.shopDTO.id)return this.$fxToast.top("请先选择门店!"),!1;this.orderGoodsPlanRefresh()},searchOrderGoodsPlan:function(t){this.orderGoodsPlanRefresh(t)},selectOrderGoodsPlan:function(t){var e=this;this.checkOrderGoodsPlan(t).then(function(){e.clearItemConfim("更换订货方案会清空品项,是否继续?").then(function(){e.orderInfoData.orderGoodsPlanDTO=t,e.getArrivalDate()})})},checkOrderGoodsPlan:function(t){var e=this;return new p.a(function(i){var a=e.orderInfoData.orderGoodsPlanDTO;a.id!==t.id&&i()})},orderGoodsPlanRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getOrderGoodsPlanListData(e).then(function(e){t.orderGoodsPlanList=e.orderGoodsPlans,t.orderGoodsPlanPopShow=!0})},getOrderGoodsPlanListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new p.a(function(i){var a={keyWord:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.orderInfoData.shopDTO.id,"/users/").concat(t.loginerId,"/orderGoodPlans"),data:a}).then(function(t){i(t)})})},onBusinessDateClick:function(){this.dateType="business",this.orderInfoData.businessDate&&(this.currentDate=new Date(this.orderInfoData.businessDate)),this.datePickerShow=!0},onArriveDateClick:function(){this.dateType="arrive",this.orderInfoData.arriveDate&&(this.currentDate=new Date(this.orderInfoData.arriveDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){var e=this,i=t.getTime();"business"===this.dateType?this.checkBusinessDate2Item(i).then(function(){e.orderInfoData.businessDate=i,e.getArrivalDate()}).catch(function(){e.clearItemConfim("确定要更改业务日期吗?新业务日期不能订货的明细将会被删除!").then(function(){e.orderInfoData.businessDate=i,e.getMBDetailList4ModifyWorkDateURl(),e.getArrivalDate()})}):this.orderInfoData.arriveDate=i,this.datePickerShow=!1},getMBDetailList4ModifyWorkDateURl:function(){var t=this;return new p.a(function(e,i){var a={businessDate:t.orderInfoData.businessDate,id:t.orderInfoData.id};t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.orderInfoData.shopDTO.id,"/shoporders/").concat(t.orderInfoData.id,"/?userId=").concat(t.loginerId),data:a,query:{m:"getMBDetailList4ModifyWorkDate"}}).then(function(i){console.log(t.orderItemList),console.log(t.orderInfoData),t.oldDetails=t.orderInfoData.details;var a=i.shopOrderBills[0];a.details.forEach(function(t){t.changeType="add"}),t.orderInfoData=a,t.orderItemList=a.details,e()}).catch(function(t){console.log(t),i(t)})})},getShopOrderBillDetailDTO:function(){var t=this.getValidItem(),e=f()(new d.a(t.map(function(t){return t.goodsDTO.id})));return e.map(function(t){return{goodsDTO:{id:t}}})},checkBusinessDate2Item:function(t){var e=this;return new p.a(function(i,a){if(0===e.getItemLength())i();else{var n={businessDate:t,urgentFlag:e.orderInfoData.urgentFlag,details:e.getShopOrderBillDetailDTO(),orderGoodsPlanDTO:e.orderInfoData.orderGoodsPlanDTO};e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.orderInfoData.shopDTO.id,"/users/").concat(e.loginerId,"/shoporderdetails"),data:n,query:{m:"validBill"},autoErrorMsg:!1}).then(function(t){i()}).catch(function(t){"ShopOrderBillDetailDTO"===t.entity?a(t):e.$dialog.alert({title:"提示",message:t.message}).then(function(){i()})})}})},getArrivalDate:function(){var t=this;if(!this.orderInfoData.orderGoodsPlanDTO.id)return!1;var e={businessDateStart:this.$fxUtils.setDateTime(new Date(this.orderInfoData.businessDate),"时分"),shopId:this.orderInfoData.shopDTO.id};return this.$fxApi("shopOrderBill.getArrivalDate",this.orderInfoData.orderGoodsPlanDTO.id)({data:e}).then(function(e){t.orderInfoData.arriveDate=e,t.$fxToast.top("到货日期已按订货方案中设置的到货间隔日期重置到货日期默认值")})},onAddClick:function(){var t=this;this.checkOrderInfo().then(function(){t.storeItem=JSON.parse(c()(t.orderItemList)),t.itemStorePopShow=!0})},checkOrderInfo:function(){var t=this;return new p.a(function(e,i){t.orderInfoData.businessDate?t.orderInfoData.shopDTO.id?t.$fxUtils.isEmptyObjSHW(t.orderInfoData.orderGoodsPlanDTO)?t.$toast.fail("请先选择订货方案!"):t.orderInfoData.arriveDate?e():t.$toast.fail("请先选择到货日期!"):t.$fxToast.top("请先选择门店!"):t.$fxToast.top("请先选择业务日期!")})},onStoreItemSave:function(t){this.orderInfoData.details=t,this.orderItemList=this.orderInfoData.details},onCreateClick:function(){var t=this;if(this.itemInputFocusing)return!1;this.$dialog.confirm({title:"提示",message:"确定生成单据吗?"}).then(function(){t.checkHasDetails().then(function(){var e=t.getSaveParams();t.createHandler(e)})}).catch(function(){})},createHandler:function(t){var e=this;this.$fxHttp.requestPost({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/shoporders"),data:t}).then(function(t){e.$fxToast.success("生成单据成功").then(function(){e.$router.replace({path:"shopOrderDetails",query:{orderId:t.shopOrderBills[0].id}})})})},getSaveParams:function(){var t=[];this.orderItemList.forEach(function(e){t.push.apply(t,Object(r["a"])(e.details))});var e=t.filter(function(t){return"add"===t.changeType}),i=s()({},this.orderInfoData,{detailAdd:e,accountDTO:{id:this.loginerId}});return i},getValidItem:function(){var t=[];return this.orderItemList.forEach(function(e){t.push.apply(t,Object(r["a"])(e.details))}),t},getItemLength:function(){return this.getValidItem().length},checkHasDetails:function(){var t=this;return new p.a(function(e){0===t.getItemLength()?t.onAddClick():e()})},onItemClear:function(){this.orderInfoData.details=[],this.orderItemList=this.orderInfoData.details},onItemFocus:function(){this.$refs.orderInfo.closeCollapse()},onItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this.orderItemList.findIndex(function(e){return e.id===t.houseDTO.id});if(~e){var i=this.orderItemList[e].details.findIndex(function(e){return e.goodsDTO.id===t.goodsDTO.id});~i&&(this.orderItemList[e].details[i]=t)}},onIntellectOrderClick:function(){var t=this;this.checkOrderInfo().then(function(){t.clearItemConfim("智能订货会清空品项,是否继续?").then(function(){t.intellectOrderPopShow=!0})})},onIntellectBasisClick:function(){this.intellectBasisPopShow=!0},onSearchClick:function(){this.itemSearchPopShow=!0,this.searchItem=JSON.parse(c()(this.orderItemList))},onSearchConfirm:function(t){this.orderItemList=t},onCreatDetail:function(t){var e=this;this.$fxToast.success("生成单据成功").then(function(){e.$router.replace({path:"shopOrderDetails",query:{orderId:t.id}})})}}},P=I,O=(i("5f39"),i("2877")),A=Object(O["a"])(P,a,n,!1,null,"73b343a0",null);e["default"]=A.exports},"5cad":function(t,e,i){},"5ddd":function(t,e,i){"use strict";var a=i("9c9f"),n=i.n(a);n.a},"5f1c":function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-intellectOrderPop"},[i("w-header",{attrs:{title:"智能订货",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{staticClass:"intellectOrderPop-content"},[i("FilterParams",{staticClass:"filter-block",attrs:{filterParams:t.filterParams,forecastAvailable:t.filterParams.forecastAvailable,isDisabled:!!t.filterSale.estimateDayList.length},on:{"on-checkdate-click":t.onCheckDateClick,"on-arrivedate-click":t.onArriveDateClick,"on-house-click":t.onHouseClick,"on-intellectplan-click":t.onIntellectPlanClick,"on-refCycle-change":t.onRefCycleChange,"on-forecastAvailable-change":t.onForecastAvailableChange}}),i("FilterRange",{staticClass:"filter-block",attrs:{filterRange:t.filterRange}}),i("FilterWeather",{staticClass:"filter-block",attrs:{filterWeather:t.filterWeather},on:{"on-weatherraido-click":t.onWeatherraidoClick}}),i("FilterOther",{staticClass:"filter-block",attrs:{filterOther:t.filterOther,isDisabled:t.filterOther.isDisabled},on:{"on-othershop-click":t.onOtherShopClick,"on-calculate-click":t.onCalculateClick,"on-instructions-click":t.onInstructionsClick}}),i("FilterSaleData",{staticClass:"filter-block",attrs:{filterSale:t.filterSale},on:{"on-dayEstimate-click":t.onDayEstimateClick,"on-hisEstimate-click":t.onHisEstimateClick}})],1),i("div",{staticClass:"intellectOrderPop-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopOrderBill.add"),expression:"$fxAuth('shopOrderBill.add')"}],staticClass:"bottom-btn fx-btn",attrs:{type:"primary",round:"",size:"small"},on:{click:t.onNextClick}},[t._v("下一步")])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.housePopShow,callback:function(e){t.housePopShow=e},expression:"housePopShow"}},[i("listComp",{attrs:{visibleFlag:t.housePopShow,data:t.houseList,loadFinished:!0,title:"仓库检索"},on:{"update:visibleFlag":function(e){t.housePopShow=e},"update:visible-flag":function(e){t.housePopShow=e},"on-search":t.searchHouse,"on-select":t.selectHouse}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.intellectPlanPopShow,callback:function(e){t.intellectPlanPopShow=e},expression:"intellectPlanPopShow"}},[i("listComp",{attrs:{visibleFlag:t.intellectPlanPopShow,data:t.intellectPlanList,loadFinished:!0,title:"智能订货方案检索"},on:{"update:visibleFlag":function(e){t.intellectPlanPopShow=e},"update:visible-flag":function(e){t.intellectPlanPopShow=e},"on-search":t.searchIntellectPlan,"on-select":t.selectIntellectPlan}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.otherShopPopShow,callback:function(e){t.otherShopPopShow=e},expression:"otherShopPopShow"}},[i("listComp",{attrs:{visibleFlag:t.otherShopPopShow,data:t.otherShopList,loadFinished:!0,title:"请选择门店"},on:{"update:visibleFlag":function(e){t.otherShopPopShow=e},"update:visible-flag":function(e){t.otherShopPopShow=e},"on-search":t.searchOtherShop,"on-select":t.selectOtherShop}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.estimateEditPopShow,callback:function(e){t.estimateEditPopShow=e},expression:"estimateEditPopShow"}},[i("EstimateEditPop",{attrs:{visibleFlag:t.estimateEditPopShow,foodsStoreItem:t.foodsStoreItem,goodsStoreItem:t.goodsStoreItem,recMoney:t.filterOther.estimate},on:{"update:visibleFlag":function(e){t.estimateEditPopShow=e},"update:visible-flag":function(e){t.estimateEditPopShow=e},"on-creatdetails-click":t.onCreatdetailsClick}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.estimateDayPopShow,callback:function(e){t.estimateDayPopShow=e},expression:"estimateDayPopShow"}},[i("EstimateDayPop",{attrs:{estimateDayList:t.filterSale.estimateDayList,checkDate:t.filterParams.checkDate,forecastAvailable:t.filterParams.forecastAvailable,visibleFlag:t.estimateDayPopShow},on:{"update:visibleFlag":function(e){t.estimateDayPopShow=e},"update:visible-flag":function(e){t.estimateDayPopShow=e},"on-saveDayMoney-click":t.onSaveDayMoneyClick}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.estimateHisPopShow,callback:function(e){t.estimateHisPopShow=e},expression:"estimateHisPopShow"}},[i("EstimateHisPop",{attrs:{hisDayList:t.filterSale.hisData,checkDate:t.filterParams.checkDate,referenceCycle:t.filterParams.referenceCycle,visibleFlag:t.estimateHisPopShow},on:{"update:visibleFlag":function(e){t.estimateHisPopShow=e},"update:visible-flag":function(e){t.estimateHisPopShow=e}}})],1),i("van-popup",{staticClass:"fx-list-popup-full",style:{height:"39%"},attrs:{position:"bottom","lock-scroll":!1},model:{value:t.instructionsPopShow,callback:function(e){t.instructionsPopShow=e},expression:"instructionsPopShow"}},[t.instructionsData?i("div",{staticClass:"filter-instructions"},[i("h3",{staticClass:"instructions-title"},[t._v("合计")]),i("p",{staticClass:"filter-instructions-p"},[t._v("\n\t\t\t\t预订"),t._l(t.instructionsData.date,function(e,a){return i("span",{key:a},[t._v(t._s(e.instructionsDate)+"（周"+t._s(e.instructionsDay)+"）"),a<t.instructionsData.date.length-1?i("span",[t._v("、")]):t._e()])}),t._v("的品项，"),i("span",{directives:[{name:"show",rawName:"v-show",value:t.filterRange.sameCompare,expression:"filterRange.sameCompare"}]},[t._v("以前"+t._s(t.instructionsData.sameCompareDay)+"周的每周"+t._s(t.instructionsData.date[0].instructionsDay)+"的营业数据")]),i("span",[t.filterRange.ringCompare&&t.filterRange.sameCompare?i("span",[t._v("、")]):t._e(),t.filterRange.ringCompare?i("span",[t._v("前"+t._s(t.filterParams.referenceCycle)+"天的所有营业数据")]):t._e(),t.filterRange.ringCompare&&!t.filterRange.orderBeforeDay?i("span",[t._v("之和")]):t._e()]),t.filterRange.orderBeforeDay&&(t.filterRange.sameCompare||t.filterRange.ringCompare)?i("span",[t._v("、订货前一天营业数据之和")]):t.filterRange.orderBeforeDay?i("span",[t._v("订货前一天营业数据，")]):t._e(),i("span",[t._v("作为参考，")]),t._v("预计可用"+t._s(t.filterParams.forecastAvailable)+"天，"),t._v("参考营业额"+t._s(t.filterOther.reference)+"元，"),t.filterOther.reference===t.filterOther.estimate?i("span",[t._v("预估营业额"+t._s(t.filterOther.estimate)+"元")]):i("span",[t._v("预估营业额已手工修改为"+t._s(t.filterOther.estimate)+"元")]),t.instructionsData.weather?i("span",[t._v("，可能会受"+t._s(t.instructionsData.weather)+"天影响，"),t.instructionsData.weatherMinus?i("span",[t._v("减少")]):i("span",[t._v("增加")]),t._v("预估总量"+t._s(t.instructionsData.weatherCount)+"%的订货量")]):t._e(),t.filterWeather.otherFactorCount>0?i("span",[t._v("，受到其它因素“"+t._s(t.filterWeather.otherFactor)+"”影响，预估总量"),t.filterWeather.otherFactorMinus?i("span",[t._v("减少")]):i("span",[t._v("增加")]),t._v(t._s(t.filterWeather.otherFactorCount)+"%的订货量")]):t._e(),i("span",[t._v("。")])],2),i("div",{staticClass:"instructions-bottom"},[i("van-button",{attrs:{type:"primary",round:"",size:"small"},on:{click:t.onInstructionsDataClick}},[t._v("确认")])],1)]):t._e()])],1)},n=[],o=i("e814"),s=i.n(o),r=i("f499"),l=i.n(r),c=(i("7514"),i("a4bb")),u=i.n(c),d=i("59ad"),h=i.n(d),f=(i("ac6a"),i("5df3"),i("5176")),m=i.n(f),p=i("795b"),v=i.n(p),b=(i("7f7f"),i("cebc")),g=(i("c5f6"),i("2f62")),C=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"filter-info-popup fx-shadow-block"},[i("div",{staticClass:"block-content"},[t._m(0),i("div",{staticClass:"block-wrap"},[i("div",{staticClass:"block-name fx-ellipsis"},[t._v("订货仓库：")]),i("div",{staticClass:"block-right",on:{click:function(e){return t.onEmitClick("on-house-click")}}},[i("span",[t._v(t._s(t.filterParams.house))]),i("van-icon",{attrs:{name:"arrow"}})],1)]),i("div",{staticClass:"block-wrap"},[i("div",{staticClass:"block-name fx-ellipsis"},[t._v("智能订货方案：")]),i("div",{staticClass:"block-right",on:{click:function(e){return t.onEmitClick("on-intellectplan-click")}}},[i("span",[t._v(t._s(t.filterParams.intellectPlan))]),i("van-icon",{attrs:{name:"arrow"}})],1)]),i("div",{staticClass:"block-wrap"},[i("div",{staticClass:"block-name fx-ellipsis"},[t._v("订货日期：")]),i("div",{staticClass:"block-right",on:{click:function(e){return t.onEmitClick("on-checkdate-click")}}},[i("span",[t._v(t._s(t.formatterDate(t.filterParams.checkDate)))]),i("van-icon",{attrs:{name:"arrow"}})],1)]),i("div",{staticClass:"block-wrap"},[i("div",{staticClass:"block-name fx-ellipsis"},[t._v("到货日期：")]),i("div",{staticClass:"block-right",on:{click:function(e){return t.onEmitClick("on-arrivedate-click")}}},[i("span",[t._v(t._s(t.formatterDate(t.filterParams.arriveDate)))]),i("van-icon",{attrs:{name:"arrow"}})],1)]),i("div",{staticClass:"block-wrap"},[i("div",{staticClass:"block-name fx-ellipsis"},[t._v("参考周期：")]),i("div",{staticClass:"block-right"},[i("span",{staticClass:"block-amount"},[i("w-stepper",{ref:"amountInput",staticClass:"amount-step",attrs:{min:"1",max:t.maxAmount,stepperBtnShow:!1,intLength:6,inputWidth:"28vw"},on:{change:function(e){return t.onEmitClick("on-refCycle-change")}},model:{value:t.filterParams.referenceCycle,callback:function(e){t.$set(t.filterParams,"referenceCycle",e)},expression:"filterParams.referenceCycle"}})],1),i("span",{staticClass:"block-right-text"},[t._v("天")])])]),i("div",{staticClass:"block-wrap"},[i("div",{staticClass:"block-name fx-ellipsis"},[t._v("预计可用（采购周期）：")]),i("div",{staticClass:"block-right"},[i("span",{staticClass:"block-amount"},[i("w-stepper",{ref:"amountInput",staticClass:"amount-step",attrs:{min:"1",max:30,stepperBtnShow:!1,intLength:t.numberLength,inputWidth:"28vw"},on:{change:function(e){return t.changeDays()}},model:{value:t.availableDays,callback:function(e){t.availableDays=e},expression:"availableDays"}})],1),i("span",{staticClass:"block-right-text"},[t._v("天")])])])])])},S=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"block-wrap"},[i("h3",{staticClass:"block-name fx-ellipsis fx-block-title"},[t._v("参数设置：")])])}],D={name:"filterParams",props:{filterParams:{type:Object,default:function(){return{}}},forecastAvailable:Number,isDisabled:Boolean},watch:{forecastAvailable:{handler:function(t){t&&(this.availableDays=this.forecastAvailable)},immediate:!0}},computed:Object(b["a"])({},Object(g["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",maxAmount:"maxAmount"}),{formatterDate:function(t){var e=this;return function(t){return"number"===typeof t?e.$fxUtils.setDateTime(new Date(t),"时分"):""}}}),data:function(){return{availableDays:0}},methods:{onEmitClick:function(t,e){this.$emit(t,e)},changeDays:function(){var t=this;this.clearItemConfim().then(function(){t.$emit("on-forecastAvailable-change",t.availableDays)})},clearItemConfim:function(){var t=this;return new v.a(function(e){t.isDisabled?t.$dialog.confirm({title:"提示",message:"修改预计可用，将会清空日额预估数据，是否确认修改?"}).then(function(){e()}).catch(function(){t.availableDays=t.forecastAvailable}):e()})}}},k=D,y=(i("e65b"),i("2877")),w=Object(y["a"])(k,C,S,!1,null,"535bedde",null),x=w.exports,I=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"filter-info-popup fx-shadow-block"},[i("div",{staticClass:"block-content"},[t._m(0),i("div",{staticClass:"block-wrap"},[i("div",{staticClass:"block-name fx-ellipsis"},[t._v("考虑同比：")]),i("div",{staticClass:"block-right"},[i("w-switch",{attrs:{type:"normal"},model:{value:t.filterRange.sameCompare,callback:function(e){t.$set(t.filterRange,"sameCompare",e)},expression:"filterRange.sameCompare"}})],1)]),i("div",{staticClass:"block-wrap"},[i("div",{staticClass:"block-name fx-ellipsis"},[t._v("考虑环比：")]),i("div",{staticClass:"block-right"},[i("w-switch",{attrs:{type:"normal"},model:{value:t.filterRange.ringCompare,callback:function(e){t.$set(t.filterRange,"ringCompare",e)},expression:"filterRange.ringCompare"}})],1)]),i("div",{staticClass:"block-wrap"},[i("div",{staticClass:"block-name fx-ellipsis"},[t._v("考虑订货前一天：")]),i("div",{staticClass:"block-right"},[i("w-switch",{attrs:{type:"normal"},model:{value:t.filterRange.orderBeforeDay,callback:function(e){t.$set(t.filterRange,"orderBeforeDay",e)},expression:"filterRange.orderBeforeDay"}})],1)])])])},P=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"block-wrap"},[i("h3",{staticClass:"block-name fx-ellipsis fx-block-title"},[t._v("预估范围：")])])}],O={name:"filterRange",props:{filterRange:{type:Object,default:function(){return{}}}},computed:Object(b["a"])({},Object(g["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",maxAmount:"maxAmount"})),methods:{onEmitClick:function(t){this.$emit(t)}}},A=O,T=(i("fa97"),Object(y["a"])(A,I,P,!1,null,"d3a18858",null)),$=T.exports,B=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"filter-info-popup fx-shadow-block"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},[i("van-collapse-item",{attrs:{name:"1"},scopedSlots:t._u([{key:"title",fn:function(){return[i("h3",{staticClass:"block-name fx-ellipsis fx-block-title fx-info-title"},[t._v("天气影响：")])]},proxy:!0}])},[i("van-radio-group",{model:{value:t.filterWeather.weatherRaido,callback:function(e){t.$set(t.filterWeather,"weatherRaido",e)},expression:"filterWeather.weatherRaido"}},[i("div",{staticClass:"block-content"},[t._l(t.filterWeather.days,function(e){return i("div",{key:e.code,staticClass:"block-wrap"},[i("div",{staticClass:"block-name fx-ellipsis"},[i("van-radio",{attrs:{name:e.code},on:{click:function(e){return t.onEmitClick("on-weatherraido-click")}}},[i("i",{staticClass:"title-icon",class:"icon-"+e.code}),i("span",[t._v(t._s(e.name)+"：")])])],1),i("div",{staticClass:"block-right"},[i("button",{staticClass:"filter-minus",class:{"filter-btn-active":e.minus},on:{click:function(i){return t.onFilterBtnClick(e,"minus","add")}}}),i("span",{staticClass:"block-amount block-middle"},[i("w-stepper",{ref:"amountInput",refInFor:!0,staticClass:"amount-step",attrs:{min:"0",max:t.maxAmount,stepperBtnShow:!1,intLength:6,inputWidth:"28vw"},model:{value:e.count,callback:function(i){t.$set(e,"count",i)},expression:"item.count"}})],1),i("span",{staticClass:"block-right-text"},[t._v("%")]),i("button",{staticClass:"filter-add",class:{"filter-btn-active":e.add},on:{click:function(i){return t.onFilterBtnClick(e,"add","minus")}}})])])}),i("div",{staticClass:"block-wrap"},[i("div",{staticClass:"block-name fx-ellipsis"},[t._v("其他因素：")]),i("div",{staticClass:"block-right"},[i("span",{staticClass:"block-amount"},[i("van-field",{attrs:{"input-align":"right",placeholder:"请输入其他原因"},model:{value:t.filterWeather.otherFactor,callback:function(e){t.$set(t.filterWeather,"otherFactor",e)},expression:"filterWeather.otherFactor"}})],1)])]),i("div",{staticClass:"block-wrap"},[i("div",{staticClass:"block-name fx-ellipsis"}),i("div",{staticClass:"block-right"},[i("button",{staticClass:"filter-minus",class:{"filter-btn-active":t.filterWeather.otherFactorMinus},on:{click:function(e){return t.onFilterBtnClick(t.filterWeather,"otherFactorMinus","otherFactorAdd")}}}),i("span",{staticClass:"block-amount block-middle"},[i("w-stepper",{ref:"amountInput",staticClass:"amount-step",attrs:{min:"0",max:t.maxAmount,stepperBtnShow:!1,intLength:t.numberLength,inputWidth:"28vw"},model:{value:t.filterWeather.otherFactorCount,callback:function(e){t.$set(t.filterWeather,"otherFactorCount",e)},expression:"filterWeather.otherFactorCount"}})],1),i("span",{staticClass:"block-right-text"},[t._v("%")]),i("button",{staticClass:"filter-add",class:{"filter-btn-active":t.filterWeather.otherFactorAdd},on:{click:function(e){return t.onFilterBtnClick(t.filterWeather,"otherFactorAdd","otherFactorMinus")}}})])])],2)])],1)],1)],1)},F=[],L={name:"filterWeather",components:{},props:{filterWeather:{type:Object,default:function(){return{}}}},computed:Object(b["a"])({},Object(g["c"])({numberLength:"numberLength",maxAmount:"maxAmount"})),data:function(){return{activeNames:[]}},methods:{onFilterBtnClick:function(t,e,i){t[e]=!0,t[i]=!1},onEmitClick:function(t){this.$emit(t)}}},_=L,E=(i("909a"),Object(y["a"])(_,B,F,!1,null,"06f59517",null)),N=E.exports,R=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"filter-info-popup fx-shadow-block"},[i("div",{staticClass:"block-content"},[t.sysSmartOrderRefShop?i("div",{staticClass:"block-wrap"},[i("checkBox",{staticClass:"filter-checkbox",attrs:{visibleFlag:!0,checked:t.filterOther.checkOtherShop},on:{"on-checkbox-click":t.onCheckBoxClick}}),i("div",{staticClass:"block-name fx-ellipsis"},[t._v("参考其他门店：")]),i("div",{staticClass:"block-right",on:{click:t.onOtherShopClick}},[i("span",{staticClass:"block-right-name fx-ellipsis"},[t._v(t._s(t.filterOther.otherShop))]),i("van-icon",{attrs:{name:"arrow"}})],1)],1):t._e(),i("div",{staticClass:"block-wrap"},[i("div",{staticClass:"block-name"},[i("span",[t._v("参考营业额：")]),i("span",{on:{click:function(e){return t.onEmitClick("on-instructions-click")}}},[i("van-icon",{staticClass:"block-middle",attrs:{size:"15px",name:"info-o",color:"#538FFD"}}),i("span",{staticClass:"icon-text fx-ellipsis"},[t._v("计算解释")])],1),i("span",{staticClass:"block-btn"},[i("van-button",{staticClass:"block-calculate",attrs:{type:"primary",plain:"",round:"",size:"mini"},on:{click:function(e){return t.onEmitClick("on-calculate-click")}}},[t._v("点击计算")])],1)]),i("div",{staticClass:"block-right"},[i("span",{staticClass:"block-amount block-middle"},[i("w-stepper",{ref:"amountInput",staticClass:"amount-step",attrs:{min:"0",max:t.maxAmount,stepperBtnShow:!1,intLength:t.numberLength,pointSize:t.sysPointSize,disabled:!0,inputWidth:"28vw"},model:{value:t.filterOther.reference,callback:function(e){t.$set(t.filterOther,"reference",e)},expression:"filterOther.reference"}})],1),i("span",{staticClass:"block-right-text"},[t._v("元")])])]),i("div",{staticClass:"block-wrap"},[i("div",{staticClass:"block-name fx-ellipsis"},[t._v("预估营业额：")]),i("div",{staticClass:"block-right"},[i("span",{staticClass:"block-amount block-middle"},[i("w-stepper",{ref:"amountInput",staticClass:"amount-step",attrs:{min:"0",stepperBtnShow:!1,intLength:12,disabled:t.isDisabled,inputWidth:"28vw"},model:{value:t.filterOther.estimate,callback:function(e){t.$set(t.filterOther,"estimate",e)},expression:"filterOther.estimate"}})],1),i("span",{staticClass:"block-right-text"},[t._v("元")])])])])])},M=[],U=i("0f38"),H={name:"filterOther",components:{checkBox:U["a"]},props:{filterOther:{type:Object,default:function(){return{}}},isDisabled:Boolean},computed:Object(b["a"])({},Object(g["c"])({sysSmartOrderRefShop:function(t){return t.systemParams.sysSmartOrderRefShop},sysPointSize:"sysPointSize",numberLength:"numberLength",maxAmount:"maxAmount"})),methods:{onCheckBoxClick:function(){this.$set(this.filterOther,"checkOtherShop",!this.filterOther.checkOtherShop),this.filterOther.checkOtherShop||(this.filterOther.otherShop="请选择",this.filterOther.otherShopId="")},onOtherShopClick:function(){if(!this.filterOther.checkOtherShop)return!1;this.$emit("on-othershop-click")},onEmitClick:function(t){this.$emit(t)}}},W=H,G=(i("c6d7"),Object(y["a"])(W,R,M,!1,null,"57751ea4",null)),z=G.exports,j=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"filter-info-popup fx-shadow-block"},[i("div",{staticClass:"block-content"},[i("div",{staticClass:"block-wrap"},[i("div",{staticClass:"block-name"},[i("span",[t._v("日额合计：")]),i("span",{on:{click:function(e){return t.onEmitClick("on-dayEstimate-click")}}},[i("van-icon",{staticClass:"block-middle",attrs:{size:"15px",name:"edit",color:"#538FFD"}}),i("span",{staticClass:"icon-text fx-ellipsis"},[t._v("日额预估")])],1)]),i("div",{staticClass:"block-right"},[i("span",{staticClass:"block-amount block-middle"},[i("w-stepper",{ref:"amountInput",staticClass:"amount-step",attrs:{min:"0",max:t.maxAmount,stepperBtnShow:!1,intLength:t.numberLength,pointSize:t.sysPointSize,disabled:!0,inputWidth:"28vw"},model:{value:t.filterSale.dayMoneyTotal,callback:function(e){t.$set(t.filterSale,"dayMoneyTotal",e)},expression:"filterSale.dayMoneyTotal"}})],1),i("span",{staticClass:"block-right-text"},[t._v("元")])])]),i("div",{staticClass:"block-wrap"},[i("div",{staticClass:"block-name fx-ellipsis"},[t._v("日额日均：")]),i("div",{staticClass:"block-right"},[i("span",{staticClass:"block-amount block-middle"},[i("w-stepper",{ref:"amountInput",staticClass:"amount-step",attrs:{min:"0",stepperBtnShow:!1,intLength:12,disabled:!0,inputWidth:"28vw"},model:{value:t.filterSale.dayMoneyAvg,callback:function(e){t.$set(t.filterSale,"dayMoneyAvg",e)},expression:"filterSale.dayMoneyAvg"}})],1),i("span",{staticClass:"block-right-text"},[t._v("元")])])]),i("div",{staticClass:"block-wrap"},[i("div",{staticClass:"block-name"},[i("span",[t._v("历史营业额合计：")]),i("span",{on:{click:function(e){return t.onEmitClick("on-hisEstimate-click")}}},[i("van-icon",{staticClass:"block-middle",attrs:{size:"15px",name:"orders-o",color:"#538FFD"}}),i("span",{staticClass:"icon-text fx-ellipsis"},[t._v("查看历史营业额")])],1)]),i("div",{staticClass:"block-right"},[i("span",{staticClass:"block-amount block-middle"},[i("w-stepper",{ref:"amountInput",staticClass:"amount-step",attrs:{min:"0",max:t.maxAmount,stepperBtnShow:!1,intLength:t.numberLength,pointSize:t.sysPointSize,disabled:!0,inputWidth:"28vw"},model:{value:t.filterSale.hisMoneyTotal,callback:function(e){t.$set(t.filterSale,"hisMoneyTotal",e)},expression:"filterSale.hisMoneyTotal"}})],1),i("span",{staticClass:"block-right-text"},[t._v("元")])])]),i("div",{staticClass:"block-wrap"},[i("div",{staticClass:"block-name fx-ellipsis"},[t._v("历史营业额日均：")]),i("div",{staticClass:"block-right"},[i("span",{staticClass:"block-amount block-middle"},[i("w-stepper",{ref:"amountInput",staticClass:"amount-step",attrs:{min:"0",stepperBtnShow:!1,intLength:12,disabled:!0,inputWidth:"28vw"},model:{value:t.filterSale.hisMoneyAvg,callback:function(e){t.$set(t.filterSale,"hisMoneyAvg",e)},expression:"filterSale.hisMoneyAvg"}})],1),i("span",{staticClass:"block-right-text"},[t._v("元")])])])])])},K=[],q={name:"filterSaleData",components:{},props:{filterSale:{type:Object,default:function(){return{}}}},computed:Object(b["a"])({},Object(g["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",maxAmount:"maxAmount"})),methods:{onCheckBoxClick:function(){this.$set(this.filterOther,"checkOtherShop",!this.filterOther.checkOtherShop),this.filterOther.checkOtherShop||(this.filterOther.otherShop="请选择",this.filterOther.otherShopId="")},onOtherShopClick:function(){if(!this.filterOther.checkOtherShop)return!1;this.$emit("on-othershop-click")},onEmitClick:function(t){this.$emit(t)}}},J=q,V=(i("5ddd"),Object(y["a"])(J,j,K,!1,null,"b6448c30",null)),Z=V.exports,Y=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-estimateEdit-details"},[i("w-header",{attrs:{title:"预估编辑",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{staticClass:"estimateEdit-content"},[i("van-tabs",{staticClass:"fx-info-tab",attrs:{color:"#538FFD",animated:""},model:{value:t.tabActive,callback:function(e){t.tabActive=e},expression:"tabActive"}},[i("van-tab",{attrs:{title:"菜品预估",name:"foods"}},[i("EstimateFoodsItem",t._b({attrs:{data:t.foodsStoreItem.details,visibleFlag:t.visibleFlag,checkFlag:t.checkFlag,breakFlag:t.breakFlag},on:{"update:visibleFlag":function(e){t.visibleFlag=e},"update:visible-flag":function(e){t.visibleFlag=e},"update:checkFlag":function(e){t.checkFlag=e},"update:check-flag":function(e){t.checkFlag=e},"update:breakFlag":function(e){t.breakFlag=e},"update:break-flag":function(e){t.breakFlag=e}}},"EstimateFoodsItem",t.$attrs,!1))],1),i("van-tab",{attrs:{title:"原料预估",name:"goods"}},[i("EstimateGoodsItem",{attrs:{data:t.goodsStoreItem.details,visibleFlag:t.visibleFlag},on:{"update:visibleFlag":function(e){t.visibleFlag=e},"update:visible-flag":function(e){t.visibleFlag=e}}})],1)],1)],1),i("div",{staticClass:"estimateEdit-bottom"},[i("van-button",{attrs:{type:"primary fx-btn",round:"",size:"small"},on:{click:t.onCreatDetails}},[t._v("生成明细")])],1)],1)},Q=[],X=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"estimateEdit-item-block"},[i("div",{staticClass:"item-head"},[i("searchHead",{attrs:{initSearch:t.visibleFlag,searchKey:t.searchKey},on:{"update:searchKey":function(e){t.searchKey=e},"update:search-key":function(e){t.searchKey=e}}}),i("div",{staticClass:"head-checkbox"},[i("checkBox",{staticClass:"filter-checkbox",attrs:{visibleFlag:!0,checked:t.checkFlag},on:{"on-checkbox-click":function(e){return t.onCheckClick()}}}),i("span",{staticClass:"checkbox-name"},[t._v("考虑盘盈盘亏")]),i("checkBox",{staticClass:"filter-checkbox",attrs:{visibleFlag:!0,checked:t.breakFlag},on:{"on-checkbox-click":function(e){return t.onBreakClick()}}}),i("span",{staticClass:"checkbox-name"},[t._v("考虑预估报损")])],1)],1),i("div",{ref:"details-content",staticClass:"item-list"},t._l(t.detailFilter(t.data,t.searchKey),function(e){return i("van-swipe-cell",{key:e.foodCode+"-"+e.foodUnitId,ref:"details-row-"+e.foodCode,refInFor:!0,staticClass:"item-row"},[i("foodsInfoCell",{attrs:{itemData:e,attrsParams:t.$attrs}})],1)}),1)])},tt=[],et=(i("6762"),i("2fdb"),i("28a5"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-block"},[i("div",{staticClass:"block-content"},[i("div",{staticClass:"block-title"},[i("span",{staticClass:"title-text fx-ellipsis"},[t._v(t._s(t.itemData.foodName))])]),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No fx-ellipsis"},[t._v("菜品编号：")]),i("div",{staticClass:"order-date"},[t._v("\n\t\t\t\t"+t._s(t.itemData.foodCode)+"\n\t\t\t")])]),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No fx-ellipsis"},[t._v("销售单位：")]),i("div",{staticClass:"order-date"},[t._v("\n\t\t\t\t"+t._s(t.itemData.foodUnitName)+"\n\t\t\t")])]),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No fx-ellipsis"},[t._v("菜品千元用量：")]),i("div",{staticClass:"order-date"},[t._v("\n\t\t\t\t"+t._s(t.itemData.foodThousandCount)+"\n\t\t\t")])]),i("div",{staticClass:"block-value block-last"},[i("div",{staticClass:"order-No fx-ellipsis"},[t._v("自定义菜品千元用量：")]),i("div",{staticClass:"order-date"},[i("span",{staticClass:"block-amount"},[i("w-stepper",{ref:"amountInput",staticClass:"amount-step",attrs:{min:"0",max:t.maxAmount,stepperBtnShow:!1,intLength:t.numberLength,pointSize:4,inputWidth:"28vw"},on:{change:t.onThousandCountChange},model:{value:t.itemData.customFoodThousandCount,callback:function(e){t.$set(t.itemData,"customFoodThousandCount",e)},expression:"itemData.customFoodThousandCount"}})],1)])]),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No fx-ellipsis"},[t._v("预估销量：")]),i("div",{staticClass:"order-date"},[t._v("\n\t\t\t\t"+t._s(t.itemData.foodReckonCount)+"\n\t\t\t")])]),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No fx-ellipsis"},[t._v("自定义销量：")]),i("div",{staticClass:"order-date"},[i("span",{staticClass:"block-amount"},[i("w-stepper",{ref:"amountInput",staticClass:"amount-step",attrs:{min:"0",max:t.maxAmount,stepperBtnShow:!1,intLength:t.numberLength,inputWidth:"28vw"},model:{value:t.itemData.foodCustomCount,callback:function(e){t.$set(t.itemData,"foodCustomCount",e)},expression:"itemData.foodCustomCount"}})],1)])])])])}),it=[],at={name:"foodsInfoCell",components:{},props:{itemData:{type:Object,default:function(){return{}}},attrsParams:{type:Object,default:function(){return{}}}},computed:Object(b["a"])({},Object(g["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",maxAmount:"maxAmount"})),methods:{onThousandCountChange:function(){var t=this.attrsParams.recMoney,e=Math.ceil(this.itemData.customFoodThousandCount*t/1e3);this.itemData.foodReckonCount=e,this.itemData.foodCustomCount=e}}},nt=at,ot=(i("4dba"),Object(y["a"])(nt,et,it,!1,null,"ac53264c",null)),st=ot.exports,rt=i("01db"),lt={name:"estimateFoodsItem",components:{foodsInfoCell:st,searchHead:rt["a"],checkBox:U["a"]},props:{data:{type:Array,default:function(){return[]}},visibleFlag:Boolean,checkFlag:Boolean,breakFlag:Boolean},inheritAttrs:!1,data:function(){return{searchKey:""}},watch:{visibleFlag:{handler:function(t){t&&(this.searchKey="",this.data.forEach(function(t){t.foodCustomCount=t.foodReckonCount,t.customFoodThousandCount=t.foodThousandCount}))},immediate:!0}},methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onCheckClick:function(){this.$emit("update:checkFlag",!this.checkFlag)},onBreakClick:function(){this.$emit("update:breakFlag",!this.breakFlag)},detailFilter:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"foodCode,foodName,foodPy";return t.filter(function(t){return"del"!==t.changeType&&!!i.split(",").find(function(i){if(t[i].toLowerCase().includes(e.toLowerCase()))return!0})})}}},ct=lt,ut=(i("6fb5"),Object(y["a"])(ct,X,tt,!1,null,"dc6b1302",null)),dt=ut.exports,ht=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"estimateEdit-item-block"},[i("div",{staticClass:"item-head"},[i("searchHead",{attrs:{initSearch:t.visibleFlag,searchKey:t.searchKey},on:{"update:searchKey":function(e){t.searchKey=e},"update:search-key":function(e){t.searchKey=e}}})],1),i("div",{ref:"details-content",staticClass:"item-list"},t._l(t.detailFilter(t.data,t.searchKey),function(e){return i("van-swipe-cell",{key:e.goods.id+"-"+e.unit.id,ref:"details-row-"+e.goods.id,refInFor:!0,staticClass:"item-row"},[i("goodsInfoCell",t._b({attrs:{itemData:e}},"goodsInfoCell",t.$attrs,!1))],1)}),1)])},ft=[],mt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-block"},[i("div",{staticClass:"block-content"},[i("div",{staticClass:"block-title"},[i("span",{staticClass:"title-text fx-ellipsis"},[t._v(t._s(t.itemData.goods.name))])]),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No fx-ellipsis"},[t._v("原料编号：")]),i("div",{staticClass:"order-date"},[t._v("\n\t\t\t\t"+t._s(t.itemData.goods.code)+"\n\t\t\t")])]),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No fx-ellipsis"},[t._v("单位：")]),i("div",{staticClass:"order-date"},[t._v("\n\t\t\t\t"+t._s(t.itemData.unit.name)+"\n\t\t\t")])]),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No fx-ellipsis"},[t._v("上期参考预估值：")]),i("div",{staticClass:"order-date"},[t._v("\n\t\t\t\t"+t._s(t.itemData.previousReckonCount)+"\n\t\t\t")])]),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No fx-ellipsis"},[t._v("预估用量：")]),i("div",{staticClass:"order-date"},[t._v("\n\t\t\t\t"+t._s(t.itemData.reckonCount)+"\n\t\t\t")])]),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No fx-ellipsis"},[t._v("自定义用量：")]),i("div",{staticClass:"order-date"},[i("span",{staticClass:"block-amount"},[i("w-stepper",{ref:"amountInput",staticClass:"amount-step",attrs:{min:"0",max:t.maxAmount,stepperBtnShow:!1,intLength:t.numberLength,inputWidth:"28vw"},model:{value:t.itemData.customCount,callback:function(e){t.$set(t.itemData,"customCount",e)},expression:"itemData.customCount"}})],1)])])])])},pt=[],vt={name:"foodsInfoCell",components:{},props:{itemData:{type:Object,default:function(){return{}}}},computed:Object(b["a"])({},Object(g["c"])({numberLength:"numberLength",maxAmount:"maxAmount"})),methods:{}},bt=vt,gt=(i("1262"),Object(y["a"])(bt,mt,pt,!1,null,"7206c335",null)),Ct=gt.exports,St={name:"estimateGoodsItem",components:{goodsInfoCell:Ct,searchHead:rt["a"]},props:{data:{type:Array,default:function(){return[]}},visibleFlag:Boolean},inheritAttrs:!1,data:function(){return{searchKey:""}},watch:{visibleFlag:{handler:function(t){t&&(this.searchKey="",this.data.forEach(function(t){t.customCount=t.reckonCount>=0?t.reckonCount:0}))},immediate:!0}},methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},detailFilter:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"code,name,pinYin";return t.filter(function(t){return"del"!==t.changeType&&!!i.split(",").find(function(i){if(t.goods[i].toLowerCase().includes(e.toLowerCase()))return!0})})}}},Dt=St,kt=(i("d4a6"),Object(y["a"])(Dt,ht,ft,!1,null,"6d2af82c",null)),yt=kt.exports,wt={name:"EstimateEditPop",components:{EstimateFoodsItem:dt,EstimateGoodsItem:yt},props:{foodsStoreItem:{type:Object,default:function(){return{details:[]}}},goodsStoreItem:{type:Object,default:function(){return{details:[]}}},visibleFlag:Boolean},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},tabActive:"foods",checkFlag:!1,breakFlag:!1}},watch:{visibleFlag:{handler:function(t){t&&(this.tabActive="foods",this.checkFlag=!1,this.breakFlag=!1)},immediate:!0}},methods:{onCloseClick:function(){if(this.focusing)return!1;this.$emit("update:visibleFlag",!1)},onCreatDetails:function(){var t=JSON.parse(l()(this.goodsStoreItem));t.details=this.goodsStoreItem.details.filter(function(t){return t.customCount>0});var e=JSON.parse(l()(this.foodsStoreItem));e.details=this.foodsStoreItem.details.filter(function(t){return t.foodCustomCount>0});var i={goodsDetails:t,foodsDetails:e,checkFlag:this.checkFlag,breakFlag:this.breakFlag};this.$emit("on-creatdetails-click",i)}}},xt=wt,It=(i("3198"),Object(y["a"])(xt,Y,Q,!1,null,"ddb9dab6",null)),Pt=It.exports,Ot=i("2750"),At=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-estimateHis-details"},[i("w-header",{attrs:{title:"查看历史营业额",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{staticClass:"estimateHis-content"},[i("div",{staticClass:"table-wrap"},[t._m(0),t._l(t.dataList,function(e,a){return i("div",{key:a,staticClass:"row-wrap"},[i("span",{staticClass:"cell-style col-cell-1"},[t._v(t._s(a+1))]),i("span",{staticClass:"cell-style col-cell-2"},[t._v(t._s(e.rq))]),i("span",{staticClass:"cell-style col-cell-3"},[t._v(t._s(e.money))])])})],2)])],1)},Tt=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"row-wrap row-head"},[i("span",{staticClass:"cell-style col-cell-1"},[t._v("序号")]),i("span",{staticClass:"cell-style col-cell-2"},[t._v("日期")]),i("span",{staticClass:"cell-style col-cell-3"},[t._v("营业额")])])}],$t={name:"EstimateHisPop",components:{},props:{visibleFlag:Boolean,checkDate:{type:[String,Number],default:""},referenceCycle:Number,hisDayList:{type:Array,default:function(){return[]}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},money:0,dataList:[]}},watch:{visibleFlag:{handler:function(t){t&&this.setData()},immediate:!0}},computed:Object(b["a"])({},Object(g["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",maxAmount:"maxAmount"}),{sumMoney:function(){return this.dataList.reduce(function(t,e){return t+e.money},0)},dayMoney:function(){var t=this.dataList.filter(function(t){return t.money>0}).length;return t?this.sumMoney/t:0}}),methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},setData:function(){var t=this;this.dataList=[];for(var e=function(e){var i={};i.rq=t.$fxUtils.setDate(t.$fxUtils.getCustomAssignDate(t.$fxUtils.setDate(new Date(t.checkDate)),-(e+1))),i.money=0;var a=t.hisDayList.find(function(t){return t.rq===i.rq});i.money=a?t.toFixedNumberSize(a.money):"--",t.dataList.push(i)},i=0;i<this.referenceCycle;i++)e(i)},toFixedNumberSize:function(t){return h()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))}}},Bt=$t,Ft=(i("41bd"),Object(y["a"])(Bt,At,Tt,!1,null,"3844ed66",null)),Lt=Ft.exports,_t=i("f6bb"),Et={name:"intellectOrderPop",components:{FilterParams:x,FilterRange:$,FilterWeather:N,FilterOther:z,FilterSaleData:Z,EstimateEditPop:Pt,EstimateDayPop:Ot["a"],EstimateHisPop:Lt,listComp:_t["a"]},props:{visibleFlag:Boolean,shopId:{type:String,default:""},orderPlanId:{type:String,default:""},urgentFlag:{type:Boolean,default:!1},businessDate:Number,arriveDate:Number,orderInfoData:{type:Object,default:function(){return{}}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},currentDate:new Date,filterParams:{checkDate:this.businessDate,arriveDate:this.arriveDate,house:"请选择",houseId:"",intellectPlan:"请选择",intellectPlanId:"",referenceCycle:21,forecastAvailable:1},filterRange:{sameCompare:!0,ringCompare:!0,orderBeforeDay:!0},filterWeather:{days:[{code:"sunnyDay",name:"晴朗",count:0,minus:!1,add:!1},{code:"cloudyDay",name:"阴天",count:0,minus:!1,add:!1},{code:"windy",name:"刮风",count:0,minus:!1,add:!1},{code:"rain",name:"下雨",count:0,minus:!1,add:!1},{code:"smog",name:"雾霾",count:0,minus:!1,add:!1},{code:"snowing",name:"下雪",count:0,minus:!1,add:!1}],weatherRaido:"",otherFactor:"",otherFactorCount:0,otherFactorMinus:!1,otherFactorAdd:!1},filterOther:{checkOtherShop:!1,otherShop:"请选择",otherShopId:"",reference:"",estimate:0,isDisabled:!1},filterSale:{estimateDayList:[],dayMoneyTotal:0,dayMoneyAvg:0,hisMoneyTotal:0,hisMoneyAvg:0,hisData:[]},currentWeather:"",datePickerShow:!1,housePopShow:!1,houseList:[],otherShopPopShow:!1,otherShopList:[],intellectPlanPopShow:!1,intellectPlanList:[],foodsStoreItem:{},goodsStoreItem:{},estimateEditPopShow:!1,instructionsPopShow:!1,estimateDayPopShow:!1,estimateHisPopShow:!1,formatterSysPointKey:["busUnitAmount","consultMoney"],calculateFlag:!1,instructionsData:null}},watch:{visibleFlag:{handler:function(t){t&&(this.resetHandler(),this.resetIntellectData())},immediate:!0},filterParams:{handler:function(t){t&&this.resetCalculate()},deep:!0},filterRange:{handler:function(t){t&&this.resetCalculate()},deep:!0},filterWeather:{handler:function(t){t&&this.resetCalculate()},deep:!0},"filterOther.checkOtherShop":{handler:function(t){t&&(this.resetCalculate(),this.resetHisData())},immediate:!0},"filterOther.otherShop":{handler:function(t){t&&(this.resetCalculate(),this.resetHisData())},immediate:!0}},computed:Object(b["a"])({},Object(g["c"])({sysPointSize:"sysPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerShopName:function(t){return t.loginer.loginerShopName},loginerId:function(t){return t.loginer.loginerId},loginerOrganType:function(t){return t.loginer.loginerOrganType}})),methods:{resetHandler:function(){this.filterParams={checkDate:this.businessDate,arriveDate:this.arriveDate,house:"请选择",houseId:"",intellectPlan:"请选择",intellectPlanId:"",referenceCycle:21,forecastAvailable:1},this.filterRange={sameCompare:!0,ringCompare:!0,orderBeforeDay:!0},this.filterWeather={days:[{code:"sunnyDay",name:"晴朗",count:0,minus:!0,add:!1},{code:"cloudyDay",name:"阴天",count:0,minus:!0,add:!1},{code:"windy",name:"刮风",count:0,minus:!0,add:!1},{code:"rain",name:"下雨",count:0,minus:!0,add:!1},{code:"smog",name:"雾霾",count:0,minus:!0,add:!1},{code:"snowing",name:"下雪",count:0,minus:!0,add:!1}],weatherRaido:"",otherFactor:"",otherFactorCount:0,otherFactorMinus:!0,otherFactorAdd:!1},this.filterOther={checkOtherShop:!1,otherShop:"请选择",otherShopId:"",reference:0,estimate:0},this.calculateFlag=!1,this.filterSale={estimateDayList:[],dayMoneyTotal:0,dayMoneyAvg:0,hisMoneyTotal:0,hisMoneyAvg:0,hisData:[]}},resetIntellectData:function(){var t=this;this.getIntellectPlanListData().then(function(e){t.filterParams.intellectPlan=e.smartOrderPlans[0].name,t.filterParams.intellectPlanId=e.smartOrderPlans[0].id,t.setIntellectOrderByPlan(e.smartOrderPlans[0])}),this.getHouseListData().then(function(e){t.filterParams.house=e.shops[0].name,t.filterParams.houseId=e.shops[0].id})},resetCalculate:function(){this.filterOther.estimate=0,this.filterOther.reference=0,this.filterOther.isDisabled=!1,this.calculateFlag=!1},onCloseClick:function(){if(this.focusing)return!1;this.$emit("update:visibleFlag",!1)},onCheckDateClick:function(){var t=this;this.clearItemConfim("修改日期，将会清空日额预估数据，是否确认修改").then(function(){t.dateType="check",t.filterParams.checkDate&&(t.currentDate=new Date(t.filterParams.checkDate)),t.datePickerShow=!0,t.resetCalculate(),t.resetHisData()})},onArriveDateClick:function(){this.dateType="arrive",this.filterParams.arriveDate&&(this.currentDate=new Date(this.filterParams.arriveDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){"check"===this.dateType?this.filterParams.checkDate=t.getTime():this.filterParams.arriveDate=t.getTime(),this.datePickerShow=!1},onHouseClick:function(){this.onHouseRefresh()},searchHouse:function(t){this.onHouseRefresh(t)},selectHouse:function(t){if(t.id===this.filterParams.houseId)return!0;this.resetHandler(),this.filterParams.house=t.name,this.filterParams.houseId=t.id},onHouseRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getHouseListData(e).then(function(e){t.houseList=e.shops,t.housePopShow=!0})},getHouseListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new v.a(function(i){var a={keyword:e,m:"list4ShopOrderBill"};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/houses"),data:a}).then(function(t){i(t)})})},onIntellectPlanClick:function(){this.onIntellectPlanRefresh()},searchIntellectPlan:function(t){this.onIntellectPlanRefresh(t)},selectIntellectPlan:function(t){if(t.id===this.filterParams.intellectPlanId)return!0;this.filterParams.intellectPlan=t.name,this.filterParams.intellectPlanId=t.id,this.resetFilterDaySale(),this.setIntellectOrderByPlan(t)},onIntellectPlanRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getIntellectPlanListData(e).then(function(e){t.intellectPlanList=e.smartOrderPlans,t.intellectPlanPopShow=!0})},getIntellectPlanListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new v.a(function(i){var a={keyWord:e,houseId:t.filterParams.houseId,m:"getSmartOrderPlans"};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/orderGoodPlans"),data:a}).then(function(t){i(t)})})},setIntellectOrderByPlan:function(t){m()(this.filterParams,{referenceCycle:t.referenceCycle?t.referenceCycle:21,forecastAvailable:t.forecastAvailable?t.forecastAvailable:1}),this.filterRange={sameCompare:"1"===t.sameCompare,ringCompare:"1"===t.ringCompare,orderBeforeDay:"1"===t.orderBeforeDay};var e=t.sunnyDayCount,i=t.cloudyDayCount,a=t.windyCount,n=t.rainCount,o=t.smogCount,s=t.snowingCount;this.filterWeather={days:[{code:"sunnyDay",name:"晴朗",count:Math.abs(e),minus:e<=0,add:e>0},{code:"cloudyDay",name:"阴天",count:Math.abs(i),minus:i<=0,add:i>0},{code:"windy",name:"刮风",count:Math.abs(a),minus:a<=0,add:a>0},{code:"rain",name:"下雨",count:Math.abs(n),minus:n<=0,add:n>0},{code:"smog",name:"雾霾",count:Math.abs(o),minus:o<=0,add:o>0},{code:"snowing",name:"下雪",count:Math.abs(s),minus:s<=0,add:s>0}],weatherRaido:"",otherFactor:t.otherFactor?t.otherFactor:"",otherFactorCount:t.otherFactorCount?Math.abs(t.otherFactorCount):0,otherFactorMinus:t.otherFactorCount<=0,otherFactorAdd:t.otherFactorCount>0}},onForecastAvailableChange:function(t){this.filterParams.forecastAvailable=t,this.resetFilterDaySale()},onRefCycleChange:function(){this.resetHisData()},resetHisData:function(){this.filterSale.hisMoneyTotal=0,this.filterSale.hisMoneyAvg=0,this.filterSale.hisData=[]},onWeatherraidoClick:function(){this.currentWeather===this.filterWeather.weatherRaido?(this.filterWeather.weatherRaido="",this.currentWeather=""):this.currentWeather=this.filterWeather.weatherRaido},onOtherShopClick:function(){this.onOtherShopRefresh()},searchOtherShop:function(t){this.onOtherShopRefresh(t)},selectOtherShop:function(t){this.filterOther.otherShop=t.name,this.filterOther.otherShopId=t.id},onOtherShopRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getOtherShopListData(e).then(function(e){t.otherShopList=e.shops,t.otherShopPopShow=!0})},getOtherShopListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new v.a(function(i){var a={m:"list4SmartOrderBill",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/shops"),data:a}).then(function(t){i(t)})})},onCalculateClick:function(){var t=this;this.validaterParams().then(function(){t.clearItemConfim("计算参考营业额，将会清空日额预估数据，是否确认修改?").then(function(){v.a.all([t.getCalculateData(),t.getHisEstimateData()]).then(function(e){t.filterOther.estimate=e[0].count,t.filterOther.reference=e[0].count,t.calculateFlag=!0;var i=e[1].smartAverDayMoneys,a=i.reduce(function(t,e){return t+h()(e.money)},0);t.filterSale.hisMoneyTotal=t.toFixedNumberSize(a),t.filterSale.hisMoneyAvg=t.toFixedNumberSize(a/i.length),t.filterSale.hisData=e[1].smartAverDayMoneys})})})},getCalculateData:function(){var t=this;return new v.a(function(e){var i={shopId:t.filterOther.checkOtherShop?t.filterOther.otherShopId:t.shopId,houseId:t.filterParams.houseId,orderDate:t.$fxUtils.setDateTime(new Date(t.filterParams.checkDate)),referenceCycle:t.filterParams.referenceCycle,sameCompare:t.filterRange.sameCompare?1:0,ringCompare:t.filterRange.ringCompare?1:0,orderBeforeDay:t.filterRange.orderBeforeDay?1:0,planId:t.filterParams.intellectPlanId};t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shoporders"),data:i,query:{userId:t.loginerId,m:"getSaleMoney"}}).then(function(t){e(t)})})},clearItemConfim:function(t){var e=this;return new v.a(function(i){e.filterSale.estimateDayList.length?e.$dialog.confirm({title:"提示",message:t}).then(function(){e.resetFilterDaySale(),i()}).catch(function(){}):i()})},resetFilterDaySale:function(){this.filterSale.estimateDayList=[],this.filterSale.dayMoneyTotal=0,this.filterSale.dayMoneyAvg=0,this.filterOther.isDisabled=!1},validaterParams:function(){var t=this;return new v.a(function(e){if(""===t.filterParams.houseId)return t.$fxToast.top("请选择仓库！"),!1;if(""===t.filterParams.intellectPlanId)return t.$fxToast.top("请选择智能订货方案！"),!1;var i=0;for(var a in t.filterRange)t.filterRange[a]||i++;if(i===u()(t.filterRange).length)return t.$fxToast.top("至少选择一种预估范围！"),!1;var n=t.filterWeather.weatherRaido,o=t.filterWeather.days.find(function(t){return t.code===n});if(o){var s=o.minus?h()(-o.count):h()(o.count),r=t.filterWeather.otherFactorMinus?h()(-t.filterWeather.otherFactorCount):h()(t.filterWeather.otherFactorCount);if(s+r<-100)return t.$fxToast.top("天气,其它因素影响量之和不能小于-100%！"),!1}if(t.filterOther.checkOtherShop&&""===t.filterOther.otherShopId)return t.$fxToast.top("请选择要参考的其他门店！"),!1;e()})},onNextClick:function(){var t=this;return new v.a(function(e){if(!t.calculateFlag)return t.$fxToast.top("请点击计算“参考营业额”！"),!1;t.validaterParams().then(function(){v.a.all([t.getFoodsDetails(),t.getGoodsDetails()]).then(function(i){var a=i[0].smartOrderFoods;t.formatterSysPoint(a),t.foodsStoreItem=t.filterStoreItem(a);var n=i[1].smartOrderGoods;t.formatterSysPoint(n),t.goodsStoreItem=t.filterStoreItem(n),t.estimateEditPopShow=!0,e()})})})},getFoodsDetails:function(){var t=this;return new v.a(function(e){var i={shopId:t.shopId,houseId:t.filterParams.houseId,orderDate:t.$fxUtils.setDateTime(new Date(t.filterParams.checkDate)),referenceCycle:t.filterParams.referenceCycle,sameCompare:t.filterRange.sameCompare?1:0,ringCompare:t.filterRange.ringCompare?1:0,orderBeforeDay:t.filterRange.orderBeforeDay?1:0,planId:t.filterParams.intellectPlanId,orderPlanId:t.orderPlanId,refMoney:t.filterOther.reference,recMoney:t.filterOther.estimate,expressFlag:t.urgentFlag?1:0,date:t.filterParams.forecastAvailable};t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shoporders"),data:i,query:{userId:t.loginerId,m:"pageFoodList"}}).then(function(t){e(t)})})},getGoodsDetails:function(){var t=this;return new v.a(function(e){var i={shopId:t.shopId,houseId:t.filterParams.houseId,orderDate:t.$fxUtils.setDateTime(new Date(t.filterParams.checkDate)),referenceCycle:t.filterParams.referenceCycle,sameCompare:t.filterRange.sameCompare?1:0,ringCompare:t.filterRange.ringCompare?1:0,orderBeforeDay:t.filterRange.orderBeforeDay?1:0,planId:t.filterParams.intellectPlanId,orderPlanId:t.orderPlanId,refMoney:t.filterOther.reference,recMoney:t.filterOther.estimate,expressFlag:t.urgentFlag?1:0,date:t.filterParams.forecastAvailable};t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shoporders"),data:i,query:{userId:t.loginerId,m:"pageGoodsList"}}).then(function(t){e(t)})})},formatterSysPoint:function(t){var e=this;t.forEach(function(t){e.formatterSysPointKey.forEach(function(i){t[i]=e.toFixedNumberSize(t[i])})})},filterStoreItem:function(t){var e=this;t.forEach(function(t){var i=h()(t.busUnitAmount);i?t.consultPrice=e.toFixedNumberSize(t.consultMoney/i):(t.consultMoney=0,t.consultPrice=0)});var i={id:this.filterParams.houseId,name:this.filterParams.house};return i=JSON.parse(l()(i)),i.details=t.length?t:[],i},toFixedNumberSize:function(t){return h()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},onInstructionsClick:function(){if(!this.calculateFlag)return!1;this.instructionsPopShow=!0,this.instructionsData={sameCompareDay:s()(this.filterParams.referenceCycle/7)};for(var t=[],e=0;e<this.filterParams.forecastAvailable;e++){var i=this.$fxUtils.getCustomAssignDate(this.$fxUtils.setDate(new Date(this.filterParams.checkDate)),e);t.push({instructionsDate:this.$fxUtils.setDate(i,"年月日"),instructionsDay:"日一二三四五六".charAt(i.getDay())})}this.instructionsData.date=t;var a=this.filterWeather.weatherRaido,n=this.filterWeather.days.find(function(t){return t.code===a});n&&n.count>0&&(this.instructionsData.weather=n.name,this.instructionsData.weatherCount=n.count,this.instructionsData.weatherMinus=n.minus)},onInstructionsDataClick:function(){this.instructionsPopShow=!1},onCreatdetailsClick:function(t){var e=this;return new v.a(function(i){var a=e.getSaveParams(t);e.$fxHttp.requestPut({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/shoporders"),data:a,query:{userId:e.loginerId,m:"getSmartOrderDetails"}}).then(function(t){e.estimateEditPopShow=!1,e.$emit("update:visibleFlag",!1),e.$emit("on-creat-detail",t.shopOrderBills[0]),i(t)})})},getSaveParams:function(t){var e=0,i=0,a=this.filterWeather.weatherRaido,n=this.filterWeather.days.find(function(t){return t.code===a});n&&(e=n.minus?h()(-n.count/100):h()(n.count/100)),i=this.filterWeather.otherFactorMinus?h()(-this.filterWeather.otherFactorCount/100):h()(this.filterWeather.otherFactorCount/100);var o=this.filterSale.estimateDayList.map(function(t){return{rq:t.rq,money:t.money}}),s=JSON.parse(l()(this.orderInfoData));delete s.details,delete s.detailDel,delete s.detailAdd,delete s.detailMdf;var r={influence:e,otherInf:i,infName:n?n.name:"",otherInfName:this.filterWeather.otherFactor,date:this.filterParams.forecastAvailable,shopId:this.shopId,houseId:this.filterParams.houseId,orderDate:this.$fxUtils.setDateTime(new Date(this.filterParams.checkDate)),referenceCycle:this.filterParams.referenceCycle,sameCompare:this.filterRange.sameCompare?1:0,ringCompare:this.filterRange.ringCompare?1:0,orderBeforeDay:this.filterRange.orderBeforeDay?1:0,planId:this.filterParams.intellectPlanId,orderPlanId:this.orderPlanId,refMoney:this.filterOther.reference,recMoney:this.filterOther.estimate,expressFlag:this.urgentFlag?1:0,averDay:o,checkFlag:t.checkFlag?1:0,breakFlag:t.breakFlag?1:0,mobileBill:s},c=t.goodsDetails.details?t.goodsDetails.details:[],u=t.foodsDetails.details?t.foodsDetails.details:[],d=m()({},r,{goods:c.length>0?c:null,foods:u.length>0?u:null});return d},onDayEstimateClick:function(){var t=this;this.validaterParams().then(function(){v.a.all([t.getCalculateData(),t.getHisEstimateData()]).then(function(e){t.filterOther.estimate=e[0].count,t.filterOther.reference=e[0].count,t.calculateFlag=!0;var i=e[1].smartAverDayMoneys,a=i.reduce(function(t,e){return t+h()(e.money)},0);t.filterSale.hisMoneyTotal=t.toFixedNumberSize(a),t.filterSale.hisMoneyAvg=t.toFixedNumberSize(a/i.length),t.filterSale.hisData=e[1].smartAverDayMoneys}),t.estimateDayPopShow=!0})},onSaveDayMoneyClick:function(t){this.filterSale.estimateDayList=JSON.parse(l()(t.dayList));var e=t.allMoney.find(function(t){return"dayMoneyTotal"===t.id}).money;this.filterSale.dayMoneyTotal=e,this.filterSale.dayMoneyAvg=t.allMoney.find(function(t){return"dayMoneyAvg"===t.id}).money,this.filterOther.estimate=s()(e),this.filterOther.isDisabled=!0,this.calculateFlag=!0},onHisEstimateClick:function(){var t=this;this.getHisEstimateData().then(function(e){var i=e.smartAverDayMoneys,a=i.reduce(function(t,e){return t+h()(e.money)},0);t.filterSale.hisMoneyTotal=t.toFixedNumberSize(a),t.filterSale.hisMoneyAvg=t.toFixedNumberSize(a/i.length),t.filterSale.hisData=e.smartAverDayMoneys,t.estimateHisPopShow=!0})},getHisEstimateData:function(){var t=this;return new v.a(function(e){var i={shopId:t.filterOther.checkOtherShop?t.filterOther.otherShopId:t.shopId,houseId:t.filterParams.houseId,orderDate:t.$fxUtils.setDateTime(new Date(t.filterParams.checkDate)),referenceCycle:t.filterParams.referenceCycle};t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shoporders"),data:i,query:{userId:t.loginerId,m:"getAverDaySaleMoney"}}).then(function(t){e(t)})})}}},Nt=Et,Rt=(i("fc41"),Object(y["a"])(Nt,a,n,!1,null,"78537c19",null));e["a"]=Rt.exports},"5f39":function(t,e,i){"use strict";var a=i("df43"),n=i.n(a);n.a},6295:function(t,e,i){},6304:function(t,e,i){},6643:function(t,e,i){"use strict";var a=i("3f45"),n=i.n(a);n.a},"680c":function(t,e,i){"use strict";var a=i("463e"),n=i.n(a);n.a},"6a8e":function(t,e,i){"use strict";var a=i("6295"),n=i.n(a);n.a},"6ed1":function(t,e,i){},"6fb5":function(t,e,i){"use strict";var a=i("6ed1"),n=i.n(a);n.a},"72a9":function(t,e,i){},"73b7":function(t,e,i){},"7bb3":function(t,e,i){},"7fc0":function(t,e,i){},8943:function(t,e,i){},"8c37":function(t,e,i){},"909a":function(t,e,i){"use strict";var a=i("72a9"),n=i.n(a);n.a},"95a8":function(t,e,i){"use strict";var a=i("fd54"),n=i.n(a);n.a},9977:function(t,e,i){"use strict";var a=i("a50e"),n=i.n(a);n.a},"9c7f":function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-detail-cell",class:{"is-active":t.rowActive===t.itemIndex,"is-error":t.isError},on:{click:t.onItemClick}},[i("div",{staticClass:"item-details-img"},[i("w-img",{attrs:{src:t.itemData.goodsDTO.imageUrls}})],1),i("div",{staticClass:"item-details-params"},[i("div",{staticClass:"item-details-name fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.name))]),t.sysShowCode?i("div",{staticClass:"item-details-name fx-ellipsis"},[t._v("编号："+t._s(t.itemData.goodsDTO.code))]):t._e(),i("div",{staticClass:"item-details-spec fx-ellipsis"},[t._v("\n\t\t\t"+t._s(t.showBom?t.itemData.bomDTO.name:"")+"\n\t\t\t"+t._s(!t.showBom&&t.showSpec?t.itemData.goodsDTO.spec:"")+"\n\t\t")]),i("div",{staticClass:"item-details-amount"},[i("span",{staticClass:"item-details-count"},[t._v(t._s(t.getItemAmount()))]),i("span",{staticClass:"item-details-unit"},[t._v(t._s(t.itemData.unitDTO.name))])]),i("i",{directives:[{name:"show",rawName:"v-show",value:t.getItemAmount()>0||t.isActive,expression:"(getItemAmount()>0 || isActive)"}],staticClass:"item-selected-icon"})])])},n=[],o=i("cebc"),s=(i("c5f6"),i("2f62")),r={name:"addItemCell",props:{itemData:{type:Object,default:function(){return{}}},itemIndex:Number,rowActive:[Number,String],isActive:Boolean,isError:Boolean,showBom:{type:Boolean,default:!1},showSpec:{type:Boolean,default:!0},itemAmoutName:{type:String,default:""}},computed:Object(o["a"])({},Object(s["c"])({sysShowCode:function(t){return t.systemParams.sysShowCode}})),methods:{onItemClick:function(){this.$emit("on-item-click",this.itemIndex)},getItemAmount:function(){return""===this.itemAmoutName?this.itemData.busUnitAmount:this.itemData[this.itemAmoutName]}}},l=r,c=(i("3e54"),i("2877")),u=Object(c["a"])(l,a,n,!1,null,"70501ba1",null);e["a"]=u.exports},"9c9f":function(t,e,i){},"9cca":function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-search-block"},[i("w-header",{attrs:{title:"搜索品项",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("searchHead",{attrs:{initSearch:t.visibleFlag,searchKey:t.searchKey,selectActive:t.isSelectAll},on:{"update:searchKey":function(e){t.searchKey=e},"update:search-key":function(e){t.searchKey=e},"on-select-click":t.onSelectAllClick}}),i("div",{ref:"details-content",staticClass:"item-list"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeStoreNames,callback:function(e){t.activeStoreNames=e},expression:"activeStoreNames"}},t._l(t.data,function(e){return i("van-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.$fxCommon.storeFilter(e,t.searchKey),expression:"$fxCommon.storeFilter(storeItem, searchKey)"}],key:e.id,staticClass:"store-row",attrs:{name:e.id}},[i("div",{staticClass:"item-store-title fx-title fx-ellipsis",attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),t._l(t.$fxCommon.detailFilter(e.details,t.searchKey),function(a,n){return i("van-swipe-cell",{key:e.id+"-"+a.goodsDTO.id,ref:"details-row-"+e.id+"-"+a.goodsDTO.id,refInFor:!0,staticClass:"item-row",attrs:{"right-width":80,disabled:t.isDisabled||t.focusing}},[i("div",{staticClass:"item-cell"},[i("checkBox",{staticClass:"search-checkbox",attrs:{visibleFlag:!t.isDisabled,checked:a.checked},on:{"on-checkbox-click":function(e){return t.onCheckBoxClick(a)}}}),i("itemInfoCell",{staticClass:"search-info",attrs:{itemData:a,isDisabled:t.isDisabled,disabledEditBtn:t.focusing},on:{"on-item-edit":t.onSearchItemEdit,"on-item-focus":function(i){return t.onItemFocus(arguments,e.id+"-"+a.goodsDTO.id)},"on-item-blur":t.onItemBlur}})],1),i("div",{staticClass:"item-row-delete fx-item-delete",attrs:{slot:"right"},on:{click:function(i){return t.onDeleteClick(a,n,e.details)}},slot:"right"},[t._v("删除")])])})],2)}),1)],1),i("div",{staticClass:"search-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"bottom-btn fx-no-radius fx-btn",attrs:{type:"primary"},on:{click:t.onSearchConfirm}},[t._v("保存")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"bottom-btn fx-no-radius fx-btn",attrs:{type:"danger"},on:{click:t.onSelectConfirm}},[t._v("删除")])],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,isDisabled:t.isDisabled},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1)],1)},n=[],o=(i("7514"),i("20d6"),i("ac6a"),i("50d5")),s=i("2606"),r=i("0f38"),l=i("01db"),c={name:"itemSearchPop",components:{itemInfoCell:o["a"],itemRowEditPop:s["a"],checkBox:r["a"],searchHead:l["a"]},props:{data:{type:Array,default:function(){return[]}},isDisabled:Boolean,visibleFlag:Boolean},data:function(){return{focusing:!1,leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",itemRowEditPopShow:!1,itemEditRowData:{},activeStoreNames:[],active:!1}},watch:{visibleFlag:{handler:function(t){var e=this;t&&(this.searchKey="",this.data.forEach(function(t){var i=t.details.filter(function(t){return"del"!==t.changeType}).length;i>0&&e.activeStoreNames.push(t.id)}))},immediate:!0}},computed:{isSelectAll:function(){var t=this;if(this.isDisabled)return"";var e=0,i=0;return this.data.forEach(function(a){var n=t.$fxCommon.detailFilter(a.details,t.searchKey);e+=n.filter(function(t){return"del"!==t.changeType&&t.checked}).length,i+=n.length}),0!==e&&e===i}},methods:{onCloseClick:function(){if(this.focusing)return!1;this.$emit("update:visibleFlag",!1)},onDeleteClick:function(t,e,i){t.id?this.$set(t,"changeType","del"):i.splice(e,1)},onItemFocus:function(t,e){this.focusing=!0},onItemBlur:function(){this.focusing=!1},onSearchItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this.data.findIndex(function(e){return e.id===t.houseDTO.id});if(~e){var i=this.data[e].details.findIndex(function(e){return e.goodsDTO.id===t.goodsDTO.id});~i&&(this.data[e].details[i]=t)}},onSearchConfirm:function(){if(this.focusing)return!1;this.data.forEach(function(t){t.details.forEach(function(t){delete t.checked})}),this.$emit("on-search-confirm",this.data),this.$emit("update:visibleFlag",!1)},onCheckBoxClick:function(t){if(this.focusing)return!1;this.$set(t,"checked",!t.checked)},onSelectAllClick:function(){var t=this;if(this.focusing)return!1;var e=!this.isSelectAll;this.data.forEach(function(i){var a=t.$fxCommon.detailFilter(i.details,t.searchKey);a.forEach(function(i){"del"!==i.changeType&&t.$set(i,"checked",e)})})},onSelectConfirm:function(){var t=this;if(this.focusing)return!1;var e=this.data.find(function(t){return t.details.find(function(t){return t.checked&&"del"!==t.changeType})});if(!e)return this.$fxToast.top("请先选择品项!"),!0;this.$dialog.confirm({title:"提示",message:"是否删除？"}).then(function(){t.data.forEach(function(e){for(var i=e.details,a=i.length-1;a>=0;a--){var n=i[a];n.checked&&(n.id?t.$set(n,"changeType","del"):e.details.splice(a,1))}})})}}},u=c,d=(i("2dc8"),i("2877")),h=Object(d["a"])(u,a,n,!1,null,"b91fa4e0",null);e["a"]=h.exports},"9fd4":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAACgCAYAAACLz2ctAAADoElEQVR4nO3cMYibZRwG8CfH0aGIOrgcXUQHcRNyg05VqdTZtUPdom5u3aybm7hYbxFdHRycWuxQJ5fvoLPlRBcdnIQq4mBLjk89Qs8SzeWRy+8HGRK++97kzZ97/3mffJkMw5AkzyZ5L8mFJGfzt7eSXDty/8Mkb+Z4jnf8w46/lORmkitJ7mwneSbJ10ke+4cTwao8muS1JC8neX7+H/Bikg+SfJPkjSQ/mGpO0E6Sj5O8muTzP5fgrSRnkvxm5lmDnfEf3d2tcaw/FB9r9OM41CPbZp2Sp+fDzgvwy3H8V7wTrNG3GQvwglmnZcvM06QHpOUgCpCip2IJpk0BUqUAqdq2/0fT9vjVGKiwBFNlG4YWWTBVsmD69IBU6QFpkQVTJQumTwFSpQCpkgVTJQumyhJMlW0YWmTBVMmC6dMDUqUHpEUWTJUsmD4FSJUCpEoWTJUsmCpLMFW2YWiRBVMlC6ZPD0iVHpAWWTBVsmD6FCBVCpAqWTBVsmCqLMFU2YahRRZMlSyYPj0gVRvfA+7u7i79N3t7e1eTvLPw8Luz2ezqsucahmHp8U8JWTBVsmD6FCBVCpAqWTBVsmCqLMFU2YahRRZMlSyYPj0gVXpAWmTBVMmC6VOAVClAqmTBVMmCqbIEUzXZhGsS9vf330/y3ApP+eR4O+q78bYy0+n0pVWe73/mcBtmU7LgefG9eMJjPKgoOZ4smD49IFWiOFo2Kgt+O8njKzzf5SSvLzz2SZJPVzjGaffXh5BTbzqd3j7uNf7LX0Z40Aea72ez2a1lz7XBv4xwSA9IlQKkShZMlSyYKkswVfYBaXFdMFWyYPr0gFTpAWlxXTBVrgumTwFSpQCpkgVTJQumyhJMlW0YWmTB/8H8AvTFr9+v9KL0DXCYBc9/GeHe+Fonmz4jrJ8ekCo9IC2yYKpkwfQpQKoUIFWyYKpkwVRZgqmyDUOLLJgq1wXTpwekSg9IiyyYKlkwfQqQKgVIlSyYKlkwVZZgqmzD0CILpkoWTJ8ekCo9IC2yYKpkwfQpQKoUIFWyYKpkwVRZgqmyDUOLLJgqWTB9ekCq9IC0yIKpkgXTpwCpUoBUyYKpkgVTZQmmyjYMLbJgqmTB9OkBqdID0iILpkoWTN+8AO+Oz2LH+8GanBuH+XW+BF9P8nOSX8w+a/BEko/GYb6YDMNwJsnvR8a995DnMFm473jHL3P8xSQ3kvyU5IWtheKDk/ZVks+SnE9ycB+z3qebG/hSKwAAAABJRU5ErkJggg=="},a50e:function(t,e,i){},aae2:function(t,e,i){"use strict";var a=i("53dd"),n=i.n(a);n.a},ac76:function(t,e,i){"use strict";var a=i("dd64"),n=i.n(a);n.a},ad57:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-item-block fx-shadow-block"},[i("div",{staticClass:"item-title fx-title"},[i("span",{staticClass:"title-name"},[t._v("单据明细")]),i("span",{staticClass:"title-count"},[t._v("明细：")]),i("span",[t._v(t._s(t.detailsLength))]),i("i",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"title-add-icon title-icon fl-r",on:{click:function(e){return t.onEmitClick("on-add-click")}}}),i("i",{staticClass:"title-search-icon title-icon fl-r",on:{click:t.onSearchClick}}),i("i",{directives:[{name:"show",rawName:"v-show",value:2===t.autoType&&t.$fxAuth("shopOrderBill.smartOrder"),expression:"autoType === 2 && $fxAuth('shopOrderBill.smartOrder')"}],staticClass:"intellect-basis-icon title-icon fl-r",on:{click:t.onIntellectbasisClick}}),i("i",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&t.$fxAuth("shopOrderBill.smartOrder"),expression:"!isDisabled && $fxAuth('shopOrderBill.smartOrder')"}],staticClass:"intellect-order-icon title-icon fl-r",on:{click:function(e){return t.onEmitClick("on-intellectorder-click")}}})]),i("div",{ref:"details-content",staticClass:"item-list"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeStoreNames,callback:function(e){t.activeStoreNames=e},expression:"activeStoreNames"}},t._l(t.data,function(e){return i("van-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.storeShowComputed(e),expression:"storeShowComputed(storeItem)"}],key:e.id,staticClass:"store-row",attrs:{name:e.id}},[i("div",{staticClass:"item-store-title fx-title fx-ellipsis",attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),t._l(e.details,function(a,n){return i("van-swipe-cell",{directives:[{name:"show",rawName:"v-show",value:"del"!==a.changeType,expression:"item.changeType !== 'del'"}],key:e.id+"-"+a.goodsDTO.id,ref:"details-row-"+e.id+"-"+a.goodsDTO.id,refInFor:!0,staticClass:"item-row",attrs:{"right-width":80,disabled:t.isDisabled||t.focusing}},[i("itemInfoCell",t._g(t._b({attrs:{itemData:a,isDisabled:t.isDisabled,disabledEditBtn:t.focusing},on:{"on-item-focus":function(i){return t.onItemFocus(arguments,e.id+"-"+a.goodsDTO.id)},"on-item-blur":t.onItemBlur}},"itemInfoCell",t.$attrs,!1),t.$listeners)),i("div",{staticClass:"fx-item-delete",attrs:{slot:"right"},on:{click:function(i){return t.onDeleteClick(a,n,e.details)}},slot:"right"},[t._v("删除")])],1)})],2)}),1)],1)])},n=[],o=(i("ac6a"),i("c5f6"),i("50d5")),s={name:"orderItem",components:{itemInfoCell:o["a"]},props:{data:{type:Array,default:function(){return[]}},isDisabled:Boolean,itemInputFocusing:Boolean,autoType:{type:Number,default:1}},inheritAttrs:!1,data:function(){return{focusing:!1,activeStoreNames:[]}},computed:{storeShowComputed:function(t){return function(t){var e=t.details.filter(function(t){return"del"!==t.changeType}).length;return e>0}},detailsLength:function(t){return this.data.reduce(function(t,e){var i=e.details.filter(function(t){return"del"!==t.changeType});return t+i.length},0)}},watch:{focusing:function(t){this.$emit("update:itemInputFocusing",t)},data:function(){var t=this;this.data.forEach(function(e){var i=e.details.filter(function(t){return"del"!==t.changeType}).length;i>0&&t.activeStoreNames.push(e.id)})}},methods:{onEmitClick:function(t){if(this.isDisabled||this.focusing)return!1;this.$emit(t)},onIntellectbasisClick:function(){this.$emit("on-intellectbasis-click")},onSearchClick:function(){if(this.focusing)return!1;this.$emit("on-search-click")},onDeleteClick:function(t,e,i){t.id?this.$set(t,"changeType","del"):i.splice(e,1)},onItemFocus:function(t,e){this.focusing=!0},onItemBlur:function(){this.focusing=!1}}},r=s,l=(i("177d"),i("2877")),c=Object(l["a"])(r,a,n,!1,null,"0c38f8a3",null);e["a"]=c.exports},ad72:function(t,e,i){},aedc:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-intellectBasisPop"},[i("w-header",{attrs:{title:"智能订货依据",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{staticClass:"intellectBasis-content"},[i("div",{staticClass:"content-house"},[i("h1",[t._v("订货仓库：")]),i("h1",{staticClass:"house-value fx-ellipsis"},[t._v(t._s(t.data.houseName))])]),i("div",[t._v("\n\t\t\t预估营业额："+t._s(t.data.recMoney)+"\n\t\t\t"),i("a",{staticClass:"content-text",on:{click:t.onDayClick}},[t._v("日额依据")])]),i("div",{staticClass:"content-block"},[i("h1",[t._v("智能订货品项：")]),i("div",{staticClass:"block-value",domProps:{innerHTML:t._s(t.data.smartGoodsMemo)}})]),i("div",{staticClass:"content-block"},[i("h1",[t._v("智能订货参数：")]),i("div",{staticClass:"block-value",domProps:{innerHTML:t._s(t.data.smartPlanMemo)}})])]),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.estimateDayPopShow,callback:function(e){t.estimateDayPopShow=e},expression:"estimateDayPopShow"}},[i("EstimateDayPop",{attrs:{estimateDayList:t.data.averDays,visibleFlag:t.estimateDayPopShow,isDisabled:!0},on:{"update:visibleFlag":function(e){t.estimateDayPopShow=e},"update:visible-flag":function(e){t.estimateDayPopShow=e}}})],1)],1)},n=[],o=i("2750"),s={name:"intellectBasisPop",components:{EstimateDayPop:o["a"]},props:{visibleFlag:Boolean,data:{type:Object,default:function(){return{}}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},estimateDayPopShow:!1}},methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onDayClick:function(){this.data.averDays.length?this.estimateDayPopShow=!0:this.$fxToast.top("没有日额依据数据!")}}},r=s,l=(i("22cb"),i("2877")),c=Object(l["a"])(r,a,n,!1,null,"3132459e",null);e["a"]=c.exports},af41:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-number-keyboard fx-shadow-up"},[i("div",{staticClass:"number-keyboard-title"},[i("div",{staticClass:"title-name fx-ellipsis"},[t._v(t._s(t.title))]),i("div",{staticClass:"title-amount"},[t._v(t._s(t.amount))]),i("div",{staticClass:"title-unit",on:{click:t.onUnitClick}},[i("span",{staticClass:"title-unit-text fx-ellipsis"},[t._v(t._s(t.unit))]),i("i",{directives:[{name:"show",rawName:"v-show",value:t.unitEdit,expression:"unitEdit"}],staticClass:"title-unit-select"})])]),i("div",{staticClass:"number-keyboard-content"},[i("div",{staticClass:"keyboard-number"},[i("div",{staticClass:"keyboard-number-row"},[i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("1")}}},[t._v("1")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("2")}}},[t._v("2")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("3")}}},[t._v("3")]),i("i",{staticClass:"keyboard-btn-1 keyboard-btn-hide fx-Pseudo-btn",on:{click:t.hideKeyboardBtnClick}})]),i("div",{staticClass:"keyboard-number-row"},[i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("4")}}},[t._v("4")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("5")}}},[t._v("5")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("6")}}},[t._v("6")]),i("i",{staticClass:"keyboard-btn-1 keyboard-btn-del fx-Pseudo-btn",on:{click:t.delBtnClick}})]),i("div",{staticClass:"keyboard-number-row"},[i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("7")}}},[t._v("7")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("8")}}},[t._v("8")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("9")}}},[t._v("9")]),t.shortcutBtn?i("i",{staticClass:"keyboard-btn-1 keyboard-btn-pre fx-Pseudo-btn",on:{click:t.preBtnClick}},[t._v("上一个")]):i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn"})]),i("div",{staticClass:"keyboard-number-row"},[i("i",{staticClass:"keyboard-btn-2 keyboard-btn-zero fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("0")}}},[t._v("0")]),i("i",{staticClass:"keyboard-btn-1 keyboard-btn-dot fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick(".")}}},[t._v(".")]),t.shortcutBtn?i("i",{staticClass:"keyboard-btn-1 keyboard-btn-next fx-Pseudo-btn",on:{click:t.nextBtnClick}},[t._v("下一个")]):i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn"})])])])])},n=[],o=(i("3b2b"),i("c5f6"),{name:"itemNumberKeyboard",props:{title:String,unit:String,amount:[String,Number],unitEdit:{type:Boolean,default:!1},integer:Boolean,pointSize:{type:[String,Number],default:4},intLength:{type:[String,Number],default:8},shortcutBtn:{type:Boolean,default:!0}},computed:{computedNumberReg:function(){return new RegExp("^\\d+(\\.|\\.\\d{1,".concat(this.pointSize-1,"})?$"))}},methods:{numberBtnClick:function(t){this.$emit("input",t),this.$emit("change",this.getAddValue(t))},delBtnClick:function(t){this.$emit("delete"),this.$emit("change",this.getDelValue(t))},preBtnClick:function(){this.$emit("pre")},nextBtnClick:function(){this.$emit("next")},hideKeyboardBtnClick:function(){this.$emit("hide")},onUnitClick:function(){this.$emit("on-unit-unitEdit")},getAddValue:function(t){var e=this.amount+"";return-1===e.indexOf(".")&&e.length>=this.intLength&&"."!==t||-1!==e.indexOf(".")&&("."===t||!this.computedNumberReg.test(e))||"."===t&&this.integer?e:("0"===e&&"."!==t?e=t:e+=t,e)},getDelValue:function(t){var e=this.amount+"";return"0"===e?e:(e=1===e.length?"0":e.substr(0,e.length-1),e)}}}),s=o,r=(i("95a8"),i("2877")),l=Object(r["a"])(s,a,n,!1,null,"2fae3907",null);e["a"]=l.exports},b577:function(t,e,i){"use strict";var a=i("0a07"),n=i.n(a);n.a},b83c:function(t,e,i){"use strict";var a=i("3113"),n=i.n(a);n.a},bd2a:function(t,e,i){},be58:function(t,e,i){},bfb3:function(t,e,i){t.exports=i("4dc9")},c51b:function(t,e,i){},c5f2:function(t,e,i){},c6d7:function(t,e,i){"use strict";var a=i("fb55"),n=i.n(a);n.a},c7a7:function(t,e,i){"use strict";var a=i("0b93"),n=i.n(a);n.a},c92d:function(t,e,i){"use strict";var a=i("e5fe"),n=i.n(a);n.a},ccf0:function(t,e,i){},cd7f:function(t,e,i){"use strict";var a=i("c5f2"),n=i.n(a);n.a},d19d:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-unify-details"},[i("w-header",{attrs:{title:t.billInfoData.sysbillCode,titleFontSize:"3.733vw",border:!0}}),i("billInfo",{ref:"billInfo",attrs:{data:t.billInfoData,isDisabled:t.isAutoState(1)||t.isBillState(1)||t.isWeightState(1)||t.isWeightState(2)||!t.$fxAuth("distributionInBill.save"),collapseDisabled:t.itemInputFocusing,checkAllItemFlag:t.checkAllItemFlag},on:{"on-arriveDate-click":t.onArriveDateClick,"on-businessDate-click":t.onBusinessDateClick}}),i("billItem",{attrs:{data:t.billItemList,isDisabled:t.isBillState(1)||t.isWeightState(1)||t.isWeightState(2)||!t.$fxAuth("distributionInBill.save")||t.isAutoState(1),itemInputFocusing:t.itemInputFocusing},on:{"update:itemInputFocusing":function(e){t.itemInputFocusing=e},"update:item-input-focusing":function(e){t.itemInputFocusing=e},"on-complete-click":t.onCompleteClick,"on-search-click":t.onSearchClick,"on-unit-edit":t.onUnitEdit,"on-item-edit":t.onItemEdit,"on-item-focus":t.onItemFocus}}),i("div",{staticClass:"details-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionInBill.check")&&t.isBillState(0)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('distributionInBill.check') && isBillState(0) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:t.onExpressClick}},[t._v("审核")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionInBill.unCheck")&&t.isBillState(1)&&!t.isAutoState(1)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('distributionInBill.unCheck') && isBillState(1) && !isAutoState(1) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:t.onUnExpressClick}},[t._v("反审")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionInBill.save")&&t.isBillState(0)&&!t.isAutoState(1)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('distributionInBill.save') && isBillState(0) && !isAutoState(1) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onSaveClick}},[t._v("保存")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionInBill.weighState")&&t.isBillState(0)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('distributionInBill.weighState') && isBillState(0) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius yellow-btn",attrs:{type:"info"},on:{click:t.onWeightClick}},[t._v("下发称重")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionInBill.weighState")&&t.isBillState(0)&&(t.isWeightState(1)||t.isWeightState(2)),expression:"$fxAuth('distributionInBill.weighState') && isBillState(0) && (isWeightState(1) || isWeightState(2))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:t.onUnWeightClick}},[t._v("取消称重")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionInBill.weighState")&&t.isBillState(0)&&t.isWeightState(2)&&t.sysDZCManyLower,expression:"$fxAuth('distributionInBill.weighState') && isBillState(0) && isWeightState(2) && sysDZCManyLower"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:t.onEndWeightClick}},[t._v("结束称重")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionInBill.quickAccess")&&t.isBillState(1),expression:"$fxAuth('distributionInBill.quickAccess') && isBillState(1)"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:t.onQuickAccessClick}},[t._v("快速领用")])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right"},model:{value:t.billTypePopShow,callback:function(e){t.billTypePopShow=e},expression:"billTypePopShow"}},[i("listComp",{attrs:{visibleFlag:t.billTypePopShow,data:t.billTypeList,title:"单据类型检索",loadFinished:!0},on:{"update:visibleFlag":function(e){t.billTypePopShow=e},"update:visible-flag":function(e){t.billTypePopShow=e},"on-select":t.selectBillType,"on-search":t.searchBillType}})],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,isDisabled:t.isAutoState(1)||t.isBillState(1)||t.isWeightState(1)||t.isWeightState(2)||!t.$fxAuth("distributionInBill.save")},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemSearchPopShow,callback:function(e){t.itemSearchPopShow=e},expression:"itemSearchPopShow"}},[i("itemSearchPop",{attrs:{visibleFlag:t.itemSearchPopShow,data:t.searchItem,isDisabled:t.isAutoState(1)||t.isBillState(1)||t.isWeightState(1)||t.isWeightState(2)||!t.$fxAuth("distributionInBill.save")},on:{"update:visibleFlag":function(e){t.itemSearchPopShow=e},"update:visible-flag":function(e){t.itemSearchPopShow=e},"on-search-confirm":t.onSearchConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemCompletePopShow,callback:function(e){t.itemCompletePopShow=e},expression:"itemCompletePopShow"}},[i("itemCompletePop",{attrs:{billId:t.billInfoData.id,visibleFlag:t.itemCompletePopShow,title:t.billInfoData.sysbillCode,data:t.completeItem,searchKeywords:"code,name,pinYin",getCheckList:t.getCheckList,completeHandle:t.completeHandle,isDisabled:t.isAutoState([1,9])||t.isBillState(1)||t.isWeightState(1)||t.isWeightState(2)||!t.$fxAuth("distributionInBill.save")},on:{"update:visibleFlag":function(e){t.itemCompletePopShow=e},"update:visible-flag":function(e){t.itemCompletePopShow=e},"on-complete-change":t.createBillDetails}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.quickAccessPopShow,callback:function(e){t.quickAccessPopShow=e},expression:"quickAccessPopShow"}},[i("quickAccessPop",{attrs:{visibleFlag:t.quickAccessPopShow,data:t.searchItem,shopId:t.billInfoData.shopDTO&&t.billInfoData.shopDTO.id,isDisabled:t.isAutoState(1)||t.isBillState(1)||t.isWeightState(1)||t.isWeightState(2)||!t.$fxAuth("distributionInBill.save"),billId:t.billInfoData.id},on:{"update:visibleFlag":function(e){t.quickAccessPopShow=e},"update:visible-flag":function(e){t.quickAccessPopShow=e}}})],1)],1)},n=[],o=i("5176"),s=i.n(o),r=i("75fc"),l=(i("20d6"),i("f499")),c=i.n(l),u=(i("7514"),i("b6d0")),d=i.n(u),h=i("774e"),f=i.n(h),m=i("59ad"),p=i.n(m),v=(i("ac6a"),i("795b")),b=i.n(v),g=i("a745"),C=i.n(g),S=(i("6762"),i("2fdb"),i("6b54"),i("cebc")),D=i("2f62"),k=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"bill-info-block fx-shadow-block"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},[i("van-collapse-item",{attrs:{name:"1",disabled:t.collapseDisabled}},[i("div",{staticClass:"info-title",attrs:{slot:"title"},slot:"title"},[i("span",{staticClass:"info-title-name"},[t._v("单据信息")]),i("stateText",{staticClass:"stateTag fl-r",attrs:{billState:t.data.billState}}),i("span",{directives:[{name:"show",rawName:"v-show",value:1===t.data.weightState,expression:"data.weightState === 1"}],staticClass:"info-title-weightState"},[t._v("待称重")])],1),i("van-tabs",{attrs:{animated:""},model:{value:t.tabActive,callback:function(e){t.tabActive=e},expression:"tabActive"}},[i("van-tab",{attrs:{title:"表头"}},[i("van-cell-group",[i("van-cell",{staticClass:"info-item",attrs:{title:"收货门店",value:t.data.shopDTO&&t.data.shopDTO.name}}),i("van-cell",{staticClass:"info-item",attrs:{title:"配送中心",value:t.data.rdcDTO&&t.data.rdcDTO.name}}),i("van-cell",{staticClass:"info-item",attrs:{title:"系统单号",value:t.data.sysbillCode}}),i("van-cell",{staticClass:"info-item",attrs:{title:"业务日期",value:t.formatterDate(t.data.businessDate),"is-link":!t.isDisabled&&t.$fxSysAuth("distributionInBill.modifyWorkDate")},on:{click:t.onBusDateClick}}),i("van-cell",{staticClass:"info-item",attrs:{title:"到货日期",value:t.formatterDate(t.data.arriveDate),"is-link":!t.isDisabled},on:{click:function(e){return t.onEmitClick("on-arriveDate-click")}}}),i("van-cell",{staticClass:"info-item",attrs:{title:"单据类型",value:t.data.businessTypeDTO&&t.data.businessTypeDTO.name}}),i("van-pro-field",{staticClass:"info-item",attrs:{label:"整单备注",placeholder:t.isDisabled?"":"请输入整单备注","input-align":"right",disabled:t.isDisabled},model:{value:t.data.billMemo,callback:function(e){t.$set(t.data,"billMemo",e)},expression:"data.billMemo"}})],1)],1),i("van-tab",{attrs:{title:"更多"}},[i("van-cell-group",[i("van-cell",{staticClass:"info-item",attrs:{title:"制单人",value:t.data.billEmp}}),i("van-cell",{staticClass:"info-item",attrs:{title:"制单时间",value:t.formatterDate(t.data.billDate)}}),i("van-cell",{staticClass:"info-item",attrs:{title:"审核人",value:t.data.checkEmp}}),i("van-cell",{staticClass:"info-item",attrs:{title:"审核日期",value:t.formatterDate(t.data.checkDate)}}),i("van-cell",{staticClass:"info-item",attrs:{title:"订货日期",value:t.formatterDate(t.data.orderDate)}}),i("van-cell",{staticClass:"info-item",attrs:{title:"发货日期",value:t.formatterDate(t.data.deliverDate)}}),i("van-pro-field",{staticClass:"info-item",attrs:{label:"手工单号",placeholder:t.isDisabled?"":"请输入手工单号","input-align":"right",maxlength:"50",disabled:t.isDisabled},model:{value:t.data.manualCode,callback:function(e){t.$set(t.data,"manualCode",e)},expression:"data.manualCode"}})],1)],1)],1)],1)],1)],1)},y=[],w=i("4760"),x={name:"billInfo",components:{stateText:w["a"]},props:{data:{type:Object,default:function(){return{}}},isDisabled:Boolean,collapseDisabled:Boolean,checkAllItemFlag:Boolean},data:function(){return{activeNames:["1"],tabActive:0}},computed:{formatterDate:function(t){var e=this;return function(t){return"number"===typeof t?e.$fxUtils.setDateTime(new Date(t),"时分"):""}}},watch:{checkAllItemFlag:{handler:function(t){this.activeNames=t?["0"]:["1"]},immediate:!0}},methods:{onEmitClick:function(t){if(this.isDisabled)return!1;this.$emit(t)},closeCollapse:function(){this.activeNames=[]},onBusDateClick:function(){if(!this.$fxSysAuth("distributionInBill.modifyWorkDate"))return this.$toast({message:"当前没有修改业务日期权限!",position:"top"}),!1;this.onEmitClick("on-businessDate-click")}}},I=x,P=(i("2e08"),i("f175"),i("2877")),O=Object(P["a"])(I,k,y,!1,null,"f4f2758c",null),A=O.exports,T=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-item-block fx-shadow-block"},[i("div",{staticClass:"item-title"},[i("span",{staticClass:"title-name"},[t._v("单据明细")]),i("span",{staticClass:"title-count"},[t._v("明细：")]),i("span",[t._v(t._s(t.detailsLength))]),i("i",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionInBill.checkAndAccept")&&!t.isDisabled&&t.$fxSysAuth("distributionInBill.SysOpenAcceptGroup"),expression:"$fxAuth('distributionInBill.checkAndAccept') && !isDisabled && $fxSysAuth('distributionInBill.SysOpenAcceptGroup')"}],staticClass:"complete title-complete-icon fl-r",on:{click:t.onCompleteClick}}),i("i",{staticClass:"complete title-search-icon  fl-r",on:{click:t.onSearchClick}})]),i("div",{ref:"details-content",staticClass:"item-list"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeStoreNames,callback:function(e){t.activeStoreNames=e},expression:"activeStoreNames"}},t._l(t.data,function(e){return i("van-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.storeShowComputed(e),expression:"storeShowComputed(storeItem)"}],key:e.id,staticClass:"store-row",attrs:{name:e.id}},[i("div",{staticClass:"item-store-title fx-ellipsis",attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),t._l(e.details,function(a,n){return i("van-swipe-cell",{directives:[{name:"show",rawName:"v-show",value:"del"!==a.changeType,expression:"item.changeType !== 'del'"}],key:""+a.id,ref:"details-row-"+e.id+"-"+a.goodsDTO.id,refInFor:!0,staticClass:"item-row",attrs:{"right-width":80,disabled:t.isDisabled||!t.$fxAuth("distributionInBill.delDetail")||t.focusing}},[i("itemInfoCell",t._g({attrs:{itemData:a,isDisabled:t.isDisabled,disabledEditBtn:t.focusing},on:{"on-item-focus":function(i){return t.onItemFocus(arguments,e.id+"-"+a.goodsDTO.id)},"on-item-blur":t.onItemBlur}},t.$listeners)),i("div",{staticClass:"item-row-delete",attrs:{slot:"right"},on:{click:function(i){return t.onDeleteClick(a,n,e.details)}},slot:"right"},[t._v("删除")])],1)})],2)}),1)],1)])},$=[],B=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-info-cell"},[i("div",{staticClass:"item-img"},[i("img",{attrs:{src:t.comptedItemImgSrc(t.itemData.goodsDTO.imageUrls),onerror:t.$fxCommon.errorImg("item")}})]),i("div",{staticClass:"item-details"},[i("div",{staticClass:"item-name fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.name))]),i("div",{staticClass:"item-amount-block"},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionInBill.seewithtaxmoney"),expression:"$fxAuth('distributionInBill.seewithtaxmoney')"}],staticClass:"item-taxprice fx-ellipsis"},[i("span",[t._v("含税金额：￥")]),i("span",[t._v(t._s(t.itemData.inMoneyWithTax))])]),i("div",{staticClass:"item-spec fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.spec))])]),i("div",{staticClass:"item-amount-block"},[i("span",{staticClass:"item-amount-title fx-ellipsis"},[t._v("门店入库数：")]),i("div",{staticClass:"item-amount"},[t.isDisabled||t.itemData.isWeightSign&&!t.sysDZCCanModifyAcount||!t.$fxAuth("distributionInBill.modifyAmount")||"1"===t.itemData.checkFlag?i("span",[t._v(t._s(t.itemData.busUnitInAmount))]):i("w-stepper",{staticClass:"amount-step",attrs:{min:"0",max:t.maxAmount,stepperBtnShow:!1,intLength:t.numberLength,pointSize:t.sysPointSize,inputWidth:"28vw"},on:{change:t.onChange,focus:t.onFocus,blur:t.onBlur},model:{value:t.itemData.busUnitInAmount,callback:function(e){t.$set(t.itemData,"busUnitInAmount",e)},expression:"itemData.busUnitInAmount"}}),i("div",{staticClass:"unit-text"},[i("span",{staticClass:"fx-ellipsis",on:{click:function(e){return e.stopPropagation(),t.onUnitClick(e)}}},[t._v(t._s(t.itemData.unitDTO.name))]),i("van-icon",{directives:[{name:"show",rawName:"v-show",value:t.$fxSysAuth("distributionInBill.modifyUnit"),expression:"$fxSysAuth('distributionInBill.modifyUnit')"}],attrs:{name:"arrow-down"}})],1)],1)]),t.$fxSysAuth("distributionInBill.SysOpenAcceptGroup")?i("div",{staticClass:"item-amount-block"},[i("span",{staticClass:"item-amount-title fx-ellipsis"},[t._v("验收数量：")]),i("div",{staticClass:"item-amount"},[i("span",{style:{color:t.completeColor(t.itemData)}},[t._v(t._s(t.itemData.checkAmount))]),i("div",{staticClass:"unit-text"},[i("span",{staticClass:"fx-ellipsis",on:{click:function(e){return e.stopPropagation(),t.onUnitClick(e)}}},[t._v(t._s(t.itemData.unitDTO.name))]),i("van-icon",{directives:[{name:"show",rawName:"v-show",value:t.$fxSysAuth("distributionInBill.modifyUnit"),expression:"$fxSysAuth('distributionInBill.modifyUnit')"}],attrs:{name:"arrow-down"}})],1)])]):t._e()]),t.$fxAuth("distributionInBill.checkAndAccept")&&t.$fxSysAuth("distributionInBill.SysOpenAcceptGroup")?i("i",{staticClass:"block-item-complete",class:{"block-item-uncomplete":"0"===t.itemData.checkFlag,"block-item-completed":"1"===t.itemData.checkFlag}}):t._e(),i("i",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&!t.disabledEditBtn,expression:"!isDisabled && !disabledEditBtn"}],staticClass:"block-item-edit",on:{click:function(e){return t.onItemEditClick("edit")}}}),i("i",{directives:[{name:"show",rawName:"v-show",value:t.isDisabled,expression:"isDisabled"}],staticClass:"block-item-watch",on:{click:function(e){return t.onItemEditClick("watch")}}})])},F=[],L={name:"itemInfoCell",props:{itemData:{type:Object,default:function(){return{}}},isDisabled:Boolean,disabledEditBtn:Boolean},data:function(){return{isHasGoods:!1}},computed:Object(S["a"])({},Object(D["c"])({sysDZCCanModifyAcount:function(t){return t.systemParams.sysDZCCanModifyAcount},sysPointSize:"sysPointSize",numberLength:"numberLength",maxAmount:"maxAmount"}),{comptedItemImgSrc:function(t){return function(t){return t?0===t.length?"":t[0]:""}},completeColor:function(t){return function(t){var e="";return t.checkAmount>t.rawAmount?e="#e4393c":t.checkAmount<t.rawAmount&&(e="#34c9ac"),e}}}),methods:{onChange:function(t){this.amountChange(t)},amountChange:function(t){var e=this;this.editItem();var i=this.toFixedNumberSize(t);if(p()(t)>p()(this.itemData.rawAmount))return this.$fxToast.fail("不能大于中心出库数量!"),this.$nextTick(function(){e.itemData.busUnitInAmount=0,e.itemData.inMoney=0,e.itemData.taxInMoney=0,e.itemData.inMoneyWithTax=0}),!0;""!==t&&(this.itemData.busUnitInAmount=i),this.itemData.inMoney=this.toFixedNumberSize(p()(this.itemData.price)*p()(i)),this.itemData.taxInMoney=this.toFixedNumberSize(p()(this.itemData.inMoney)*p()(this.itemData.tax)),this.itemData.inMoneyWithTax=this.toFixedNumberSize(p()(this.itemData.inMoney)+p()(this.itemData.taxInMoney)),this.hasGoodsChange(i)},hasGoodsChange:function(t){0!==p()(t)&&this.itemData.shortageFlag?(this.isHasGoods=this.itemData.shortageFlag,this.itemData.shortageFlag=!1):0===t&&this.isHasGoods&&(this.itemData.shortageFlag=!0)},onCheckAmountChange:function(t){this.editItem(),t<=this.itemData.rawAmount?this.itemData.busUnitInAmount=t:this.itemData.busUnitInAmount=this.itemData.rawAmount,this.itemData.inMoney=this.toFixedNumberSize(p()(this.itemData.price)*p()(this.itemData.busUnitInAmount)),this.itemData.taxInMoney=this.toFixedNumberSize(p()(this.itemData.inMoney)*p()(this.itemData.tax)),this.itemData.inMoneyWithTax=this.toFixedNumberSize(p()(this.itemData.inMoney)+p()(this.itemData.taxInMoney)),""!==t&&(this.itemData.checkAmount=t)},toFixedNumberSize:function(t){return p()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},editItem:function(){this.itemData.id&&this.$set(this.itemData,"changeType","edit")},onItemEditClick:function(t){"edit"===t&&this.editItem(),this.$emit("on-item-edit",this.itemData)},onUnitClick:function(){if(this.isDisabled||!this.$fxSysAuth("distributionInBill.modifyUnit"))return!1;this.editItem(),this.$emit("on-unit-edit",this.itemData)},onFocus:function(){this.$emit("on-item-focus")},onBlur:function(){this.$emit("on-item-blur")}}},_=L,E=(i("c92d"),Object(P["a"])(_,B,F,!1,null,"cc865342",null)),N=E.exports,R={name:"billItem",components:{itemInfoCell:N},props:{data:{type:Array,default:function(){return[]}},isDisabled:Boolean,itemInputFocusing:Boolean},data:function(){return{focusing:!1,activeStoreNames:[]}},watch:{focusing:function(t){this.$emit("update:itemInputFocusing",t)},data:function(){var t=this;this.data.forEach(function(e){var i=e.details.filter(function(t){return"del"!==t.changeType}).length;i>0&&t.activeStoreNames.push(e.id)})}},computed:{detailsLength:function(){return this.data.reduce(function(t,e){var i=e.details.filter(function(t){return"del"!==t.changeType});return t+i.length},0)},storeShowComputed:function(t){return function(t){var e=t.details.filter(function(t){return"del"!==t.changeType}).length;return e>0}}},methods:{onCompleteClick:function(){if(this.focusing)return!1;this.$emit("on-complete-click")},onSearchClick:function(){if(this.focusing)return!1;this.$emit("on-search-click")},onDeleteClick:function(t,e,i){t.id?this.$set(t,"changeType","del"):i.splice(e,1)},onItemFocus:function(t,e){this.focusing=!0},onItemBlur:function(){this.focusing=!1}}},M=R,U=(i("0a4b"),Object(P["a"])(M,T,$,!1,null,"7e6f7cb4",null)),H=U.exports,W=i("f6bb"),G=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"itemRowEdit-popup"},[i("w-header",{attrs:{title:t.currentItemData.goodsDTO.name,leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{ref:"rowEditContent",staticClass:"itemRowEdit-content"},[i("van-cell-group",[i("van-cell",{attrs:{title:"订货数量",value:t.currentItemData.outOrderAmount,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"中心出库数",value:t.currentItemData.rawAmount,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"门店入库数",value:t.currentItemData.busUnitInAmount,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"差异数量",value:t.differenceAmount,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionInBill.seeprice"),expression:"$fxAuth('distributionInBill.seeprice')"}],attrs:{title:"非税单价",value:t.currentItemData.price,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionInBill.seenotaxmoney"),expression:"$fxAuth('distributionInBill.seenotaxmoney')"}],attrs:{title:"非税金额",value:t.currentItemData.inMoney,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionInBill.seetax"),expression:"$fxAuth('distributionInBill.seetax')"}],attrs:{title:"税率",value:t.fomatterTaxes(t.currentItemData.tax),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionInBill.seetaxmoney"),expression:"$fxAuth('distributionInBill.seetaxmoney')"}],attrs:{title:"税额",value:t.currentItemData.taxInMoney,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"品项编号",value:t.currentItemData.goodsDTO.code,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"品项类型",value:t.currentItemData.goodsDTO.styleName,"value-class":"info-item-value"}}),i("van-pro-field",{attrs:{disabled:t.isDisabled,placeholder:t.setPlaceholder("请输入备注"),label:"备注","value-class":"info-item-value","input-align":"right"},on:{focus:function(e){return t.onFocus("memo")}},model:{value:t.currentItemData.memo,callback:function(e){t.$set(t.currentItemData,"memo",e)},expression:"currentItemData.memo"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"净重量",value:t.toFixedNumberSize(t.currentItemData.netWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"皮重量",value:t.toFixedNumberSize(t.currentItemData.skinWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"毛重量",value:t.toFixedNumberSize(t.currentItemData.grossWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"称重单位",value:t.currentItemData.weightUnit,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"称重状态",value:t.currentItemData.isWeightSign?"已称重":"未称重","value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"图片",border:!1,"value-class":"info-item-value"}}),i("select-image",t._g({directives:[{name:"show",rawName:"v-show",value:t.currentItemData.id,expression:"currentItemData.id"}],staticClass:"bom-select-image",attrs:{selcetPictureMode:t.selcetPictureMode,isDisabled:t.isDisabled||t.updateImageDisabled,uploadAble:6,currentItemData:t.currentItemData},on:{"on-selcet-iamge":function(e){t.selcetPictureActionsheet=!0},pictureChange:t.pictureChange}},t.$listeners))],1)],1),i("div",{staticClass:"itemRowEdit-bottom"},[t.isDisabled?t._e():i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onConfirmClick}},[t._v("保存")])],1),i("van-actionsheet",{attrs:{actions:t.actions,"cancel-text":"取消"},on:{select:t.onSelect},model:{value:t.selcetPictureActionsheet,callback:function(e){t.selcetPictureActionsheet=e},expression:"selcetPictureActionsheet"}})],1)},z=[],j=i("bfb3"),K=i.n(j),q=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"show",rawName:"v-show",value:t.picture.length||!t.isDisabled,expression:"picture.length || !isDisabled"}],staticClass:"bomSelectImage"},[t._l(t.picture,function(e,i){return a("div",{directives:[{name:"show",rawName:"v-show",value:t.picture,expression:"picture"}],key:i+e.imagUrl},[a("img",{attrs:{src:e.imagUrl}}),a("van-icon",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"img-del",attrs:{size:"20px",name:"clear",color:"#FC4E49"},on:{click:function(a){return t.del(e,i)}}})],1)}),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&(!t.picture||t.picture.length<t.uploadAble),expression:"!isDisabled && (!picture || picture.length<uploadAble)"}],on:{click:t.showSelect}},[a("img",{attrs:{src:i("9fd4")}})])],2)},J=[],V=(i("c5f6"),i("9541"),{name:"selectImage",props:{selcetPictureMode:{type:Object,default:function(){}},currentItemData:{type:Object,default:function(){}},uploadAble:{type:Number,default:1},isDisabled:{type:Boolean,default:!1}},data:function(){return{picture:[],delArr:[]}},methods:{add:function(t){this.picture.push({imagUrl:t,type:"add"})},del:function(t,e){"add"!==t.type&&this.delArr.push(t),this.picture.splice(e,1)},showSelect:function(){this.$emit("on-selcet-iamge")},getPictureData:function(t){var e=this;this.$fxCordova&&this.$fxCordova.camera?this.$fxCordova.camera["getPictureBy".concat(t)]().then(function(t){e.add("data:image/jpeg;base64,".concat(t))}):this.$fxToast.fail("未获取到$fxCordova")}},watch:{currentItemData:{handler:function(t){this.picture=t&&t.images?JSON.parse(c()(t.images)):[],this.delArr=[]},immediate:!0},selcetPictureMode:{handler:function(t){t.value&&this.getPictureData(t.value)}},picture:{handler:function(t){this.$emit("pictureChange",t,this.delArr)}}}}),Z=V,Y=(i("c7a7"),Object(P["a"])(Z,q,J,!1,null,"03af487a",null)),Q=Y.exports,X={name:"itemRowEdit",components:{selectImage:Q},props:{visibleFlag:Boolean,itemData:{type:Object,default:function(){return{}}},isDisabled:Boolean,updateImageDisabled:{type:Boolean,default:!1}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},delImagesArr:[],currentItemData:{},selcetPictureMode:{},selcetPictureActionsheet:!1,actions:[{name:"拍摄",value:"Camera"},{name:"从手机相册选择",value:"Library"}]}},computed:Object(S["a"])({},Object(D["c"])({sysShowDZCData:function(t){return t.systemParams.sysShowDZCData},sysPointSize:"sysPointSize"}),{differenceAmount:function(){var t=this.currentItemData.rawAmount-this.currentItemData.busUnitInAmount;return t=p()(this.$fxUtils.toFixedSHW(t,this.sysPointSize)),K()(t)?"":t},fomatterTaxes:function(t){var e=this;return function(t){if(t){var i=e.$fxUtils.toFixedSHW(100*t,2,!1);return"".concat(i,"%")}return"0%"}},setPlaceholder:function(t){var e=this;return function(t){return e.isDisabled?"":t}},comptedItemImgSrc:function(t){return function(t){return t?0===t.length?"":t[0].imagUrl:""}}}),watch:{visibleFlag:{handler:function(t){t&&(this.currentItemData=JSON.parse(c()(this.itemData)))},immediate:!0}},methods:{toFixedNumberSize:function(t){return p()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},pictureChange:function(t,e){this.currentItemData.images=t,this.delImagesArr=e},onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onConfirmClick:function(){var t=this;this.currentItemData.id?(this.currentItemData.changeType="edit",this.saveBill().then(function(e){return t.saveNotice()})):this.saveNotice()},saveNotice:function(){this.$emit("on-Confirm",this.currentItemData),this.$emit("update:visibleFlag",!1)},resetImagesUrl:function(t){this.currentItemData.images=t},saveBill:function(){var t=this;return new b.a(function(e,i){var a=[];t.currentItemData.images.map(function(t){t.type&&"add"===t.type&&a.push(t.imagUrl)});var n=t.delImagesArr.map(function(t){return t.imagUrl}),o={"input_files[]":a,del_filename:n};a.length||n.length?t.$fxHttp.requestPost({url:"".concat(t.$fxBaseApi.url,"/upload/detailId/").concat(t.currentItemData.id,"/uploadDetailPicturesMultipleWithMaxCount"),data:o}).then(function(i){t.resetImagesUrl(i.storeBillImags),e()}).catch(function(t){return i(t)}):e()})},onSelect:function(t){this.selcetPictureMode=Object(S["a"])({},t,{random:Math.random()}),this.selcetPictureActionsheet=!1},onFocus:function(t){this.onScrollTop(t)},onScrollTop:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,i=this.$refs[t];if(!i||0===i.length)return!1;var a=i.$el.offsetTop,n=this.$refs["rowEditContent"];this.$fxUtils.scrollTopW({offsetTop:a,$el:n,distance:e})}}},tt=X,et=(i("9977"),Object(P["a"])(tt,G,z,!1,null,"572379b5",null)),it=et.exports,at=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-search-block"},[i("w-header",{attrs:{title:"搜索品项",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{staticClass:"item-search clearfix"},[i("van-search",{attrs:{placeholder:"请输入搜索关键词",shape:"round"},on:{search:t.onConfirmKey},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}})],1),i("div",{ref:"details-content",staticClass:"item-list"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeStoreNames,callback:function(e){t.activeStoreNames=e},expression:"activeStoreNames"}},t._l(t.data,function(e){return i("van-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.storeShowComputed(e),expression:"storeShowComputed(storeItem)"}],key:e.id,staticClass:"store-row",attrs:{name:e.id}},[i("div",{staticClass:"item-store-title fx-ellipsis",attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),t._l(t.detailFilter(e.details),function(a,n){return i("van-swipe-cell",{directives:[{name:"show",rawName:"v-show",value:"del"!==a.changeType&&a.showFlag,expression:"item.changeType !== 'del' && item.showFlag"}],key:""+a.id,ref:"details-row-"+e.id+"-"+a.goodsDTO.id,refInFor:!0,staticClass:"item-row",attrs:{"right-width":80,disabled:t.isDisabled||!t.$fxAuth("distributionInBill.delDetail")||t.focusing}},[i("itemInfoCell",{attrs:{itemData:a,isDisabled:t.isDisabled,disabledEditBtn:t.focusing},on:{"on-item-edit":t.onSearchItemEdit,"on-unit-edit":t.onUnitEdit,"on-item-focus":function(i){return t.onItemFocus(arguments,e.id+"-"+a.goodsDTO.id)},"on-item-blur":t.onItemBlur}}),i("div",{staticClass:"item-row-delete",attrs:{slot:"right"},on:{click:function(i){return t.onDeleteClick(a,n,e.details)}},slot:"right"},[t._v("删除")])],1)})],2)}),1)],1),i("div",{staticClass:"search-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onSearchConfirm}},[t._v("保存")])],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,isDisabled:t.isDisabled,updateImageDisabled:!0},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1)],1)},nt=[],ot=(i("28a5"),{name:"itemSearchPop",components:{itemInfoCell:N,itemRowEditPop:it},props:{data:{type:Array,default:function(){return[]}},isDisabled:Boolean,visibleFlag:Boolean},data:function(){return{focusing:!1,leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",itemRowEditPopShow:!1,itemEditRowData:{},unitActions:[],unitActionShow:!1,activeStoreNames:[]}},created:function(){this.isDisabled||this.$fxEventBus.$on("redCode",this.getItemByRedCode)},beforeDestroy:function(){this.$fxEventBus.$off("redCode",this.getItemByRedCode)},watch:{visibleFlag:{handler:function(t){var e=this;t&&(this.searchKey="",this.showData(this.data),this.data.forEach(function(t){var i=t.details.filter(function(t){return"del"!==t.changeType}).length;i>0&&e.activeStoreNames.push(t.id)}))},immediate:!0}},computed:Object(S["a"])({},Object(D["c"])({sysPointSize:"sysPointSize"})),methods:{storeShowComputed:function(t){return this.detailFilter(t.details).length>0},detailFilter:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"code,name,pinYin";return t.filter(function(t){return"del"!==t.changeType&&t.showFlag&&!!i.split(",").find(function(i){if(t.goodsDTO[i].toLowerCase().includes(e.searchKey.toLowerCase()))return!0})})},onCloseClick:function(){if(this.focusing)return!1;this.$emit("update:visibleFlag",!1)},onDeleteClick:function(t,e,i){t.id?this.$set(t,"changeType","del"):i.splice(e,1)},onItemFocus:function(t,e){this.focusing=!0},onItemBlur:function(){this.focusing=!1},onUnitEdit:function(t){var e=this;this.itemEditRowData=t,this.getItemUnit(t.goodsDTO.id).then(function(t){e.unitActions=t,e.unitActionShow=!0})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemEditRowData,i=e.unitDTO.value,a=t;e.outOrderAmount=p()(this.$fxUtils.toFixedSHW(e.outOrderAmount*i/a.value,this.sysPointSize)),e.rawAmount=p()(this.$fxUtils.toFixedSHW(e.rawAmount*i/a.value,this.sysPointSize)),e.busUnitInAmount=p()(this.$fxUtils.toFixedSHW(e.busUnitInAmount*i/a.value,this.sysPointSize)),e.checkAmount=p()(this.$fxUtils.toFixedSHW(e.checkAmount*i/a.value,this.sysPointSize)),0===e.busUnitInAmount?e.price=p()(this.$fxUtils.toFixedSHW(e.price*a.value/i,this.sysPointSize)):e.price=p()(this.$fxUtils.toFixedSHW(e.inMoney/e.busUnitInAmount,this.sysPointSize)),e.unitDTO=t},getItemUnit:function(t){var e=this;return new b.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/shopId/users/userId/goods/").concat(t,"/units")}).then(function(t){i(t.units)})})},onSearchItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this.data.findIndex(function(e){return e.id===t.inHouseDTO.id});if(~e){var i=this.data[e].details.findIndex(function(e){return e.goodsDTO.id===t.goodsDTO.id});~i&&(this.data[e].details[i]=t)}},onSearchConfirm:function(){if(this.focusing)return!1;this.$emit("on-search-confirm",this.data),this.$emit("update:visibleFlag",!1)},getItemByRedCode:function(t){var e=this;if(!this.visibleFlag)return!1;this.getItemByCode(t).then(function(t){var i=t.billAndDetails[0];if(0===i.length)return e.$fxToast.top("当前仓库无此品项!"),!1;for(var a=null,n=0;n<e.data.length;n++)if(a=e.data[n].details.find(function(t){return t.goodsDTO.id===i.goodsDTO.id&&"del"!==t.changeType}),a)break;if("1"===a.checkFlag)return e.$fxToast.top("此品项已验收不能修改!"),!1;a?(e.hideItemData(e.data),e.itemUpdate(i,a),e.$set(a,"showFlag",!0)):e.$fxToast.top("无此品项!"),e.searchKey=""})},itemUpdate:function(t,e){var i=e.unitDTO,a=t.unitDTO,n=a.value/i.value,o=t.goodsDTO.countValue*n;e.id&&this.$set(e,"changeType","edit"),this.amountChange(o,e)},amountChange:function(t,e){var i=this.toFixedNumberSize(t);if(i>p()(e.rawAmount))return this.$fxToast.fail("不能大于中心出库数量!"),this.$nextTick(function(){e.busUnitInAmount=0,e.inMoney=0,e.taxInMoney=0,e.inMoneyWithTax=0}),!0;""!==t&&(e.busUnitInAmount=i),e.inMoney=this.toFixedNumberSize(p()(e.price)*p()(i)),e.taxInMoney=this.toFixedNumberSize(p()(e.inMoney)*p()(e.tax)),e.inMoneyWithTax=this.toFixedNumberSize(p()(e.inMoney)+p()(e.taxInMoney))},toFixedNumberSize:function(t){return p()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},getItemByCode:function(t){var e=this;return new b.a(function(i){var a={m:"getGoodsByBarCode4Modify",barCodes:t};e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/users/").concat(e.loginerId,"/goods"),data:a}).then(function(t){i(t)})})},hideItemData:function(t){var e=this;t.forEach(function(t){t.details.forEach(function(t){e.$set(t,"showFlag",!1)})})},showData:function(t){var e=this;t.forEach(function(t){t.details.forEach(function(t){e.$set(t,"showFlag",!0)})})},onConfirmKey:function(){""===this.searchKey&&this.showData(this.data)}}}),st=ot,rt=(i("d4c1"),Object(P["a"])(st,at,nt,!1,null,"0eac729d",null)),lt=rt.exports,ct=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-search-block"},[i("w-header",{attrs:{title:"快速生成部门领用",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("searchHead",{attrs:{initSearch:t.visibleFlag,searchKey:t.searchKey,selectActive:t.isSelectAll},on:{"update:searchKey":function(e){t.searchKey=e},"update:search-key":function(e){t.searchKey=e},"on-select-click":t.onSelectAllClick}}),i("div",{staticClass:"order-info-block fx-shadow-block"},[i("van-cell-group",[i("van-cell",{staticClass:"info-item",attrs:{title:"领用部门",value:t.department,"value-class":"info-item-value","is-link":""},on:{click:t.onDepartmentClick}})],1)],1),i("div",{ref:"details-content",staticClass:"item-list"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeStoreNames,callback:function(e){t.activeStoreNames=e},expression:"activeStoreNames"}},t._l(t.data,function(e){return i("van-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.storeShowComputed(e),expression:"storeShowComputed(storeItem)"}],key:e.id,staticClass:"store-row",attrs:{name:e.id}},[i("div",{staticClass:"item-store-title fx-ellipsis",attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),t._l(t.detailFilter(e.details),function(a){return i("div",{directives:[{name:"show",rawName:"v-show",value:"del"!==a.changeType,expression:"item.changeType !== 'del'"}],key:""+a.id,ref:"details-row-"+e.id+"-"+a.goodsDTO.id,refInFor:!0,staticClass:"item-row"},[i("div",{staticClass:"item-cell"},[i("checkBox",{staticClass:"search-checkbox",attrs:{visibleFlag:!0,checked:a.checked},on:{"on-checkbox-click":function(e){return t.onCheckBoxClick(a)}}}),i("itemInfoCell",{staticClass:"search-info",attrs:{itemData:a,isDisabled:t.isDisabled},on:{"on-item-edit":t.onSearchItemEdit}})],1)])})],2)}),1)],1),i("div",{staticClass:"search-bottom"},[i("van-button",{staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onConfirm}},[t._v("确认")])],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,isDisabled:t.isDisabled},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e}}})],1),i("filterListPopup",{attrs:{title:"部门检索",rollingLoad:!0,getDataApi:t.getDepartmentListData},on:{"on-select":t.selectDepartment},model:{value:t.departmentPopShow,callback:function(e){t.departmentPopShow=e},expression:"departmentPopShow"}})],1)},ut=[],dt=(i("7f7f"),i("eb03")),ht=i("01db"),ft=i("0f38"),mt={name:"quickAccessPop",components:{filterListPopup:dt["a"],itemInfoCell:N,itemRowEditPop:it,searchHead:ht["a"],checkBox:ft["a"]},props:{data:{type:Array,default:function(){return[]}},isDisabled:Boolean,visibleFlag:Boolean,shopId:String,billId:{type:String,default:function(){return""}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",itemRowEditPopShow:!1,itemEditRowData:{},activeStoreNames:[],department:"请选择",departmentId:"",departmentPopShow:!1,departmentList:[]}},watch:{visibleFlag:{handler:function(t){var e=this;t&&(this.searchKey="",this.data.forEach(function(t){var i=t.details.filter(function(t){return"del"!==t.changeType}).length;i>0&&e.activeStoreNames.push(t.id)}),this.setDefaultDepartment())},immediate:!0}},computed:{isSelectAll:function(){var t=this,e=0,i=0;return this.data.forEach(function(a){var n=t.detailFilter(a.details);e+=n.filter(function(t){return"del"!==t.changeType&&t.checked}).length,i+=n.length}),0!==e&&e===i}},methods:{storeShowComputed:function(t){return this.detailFilter(t.details).length>0},detailFilter:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"code,name,pinYin";return t.filter(function(t){return"del"!==t.changeType&&!!i.split(",").find(function(i){if(t.goodsDTO[i].toLowerCase().includes(e.searchKey.toLowerCase()))return!0})})},onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onCheckBoxClick:function(t){this.$set(t,"checked",!t.checked)},onSelectAllClick:function(){var t=this,e=!this.isSelectAll;this.data.forEach(function(i){var a=t.detailFilter(i.details);a.forEach(function(i){"del"!==i.changeType&&t.$set(i,"checked",e)})})},onSearchItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},checkSelectInfo:function(){var t=this;return new b.a(function(e){var i=t.data.filter(function(t){return t.details.find(function(t){return t.checked&&"del"!==t.changeType})});return 0===i.length?(t.$fxToast.top("请先选择品项!"),!1):t.departmentId?void e():(t.$fxToast.top("请先选择部门!"),!1)})},getSaveParams:function(){var t=[];this.data.forEach(function(e){t.push.apply(t,Object(r["a"])(e.details))});var e=t.reduce(function(t,e){var i=e.checked&&"del"!==e.changeType?t.concat(e.id):t;return i},[]);return e},onConfirm:function(){var t=this;this.checkSelectInfo().then(function(){var e={billId:t.billId,detailIds:t.getSaveParams(),departmentId:t.departmentId};return t.$fxApi("distributioninbills.quickAccess")({data:e}).then(function(e){t.$dialog.alert({title:"提示",message:e.message}),t.$emit("update:visibleFlag",!1)})})},setDefaultDepartment:function(){var t=this,e={start:0,size:1,id:this.shopId};return this.$fxApi("z5common.getDepartment")({data:e}).then(function(e){t.department=e.departmentDTOData[0].name,t.departmentId=e.departmentDTOData[0].id})},onDepartmentClick:function(){this.departmentPopShow=!0},getDepartmentListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,a={keyword:t,start:e,size:i,id:this.shopId};return this.$fxApi("z5common.getDepartment")({data:a}).then(function(t){return t.departmentDTOData})},selectDepartment:function(t){this.department=t.name,this.departmentId=t.id}}},pt=mt,vt=(i("2ddf"),Object(P["a"])(pt,ct,ut,!1,null,"1e71e358",null)),bt=vt.exports,gt=i("450d"),Ct={name:"unifyOrderDetails",components:{billInfo:A,billItem:H,listComp:W["a"],itemRowEditPop:it,itemSearchPop:lt,quickAccessPop:bt,itemCompletePop:gt["a"]},data:function(){return{query:this.$route.query,billInfoData:{},currentDate:new Date,datePickerShow:!1,datePickerType:"",billTypeList:[],billTypePopShow:!1,billItemList:[],itemRowEditPopShow:!1,itemEditRowData:{},unitActionShow:!1,unitActions:[],itemInputFocusing:!1,itemSearchPopShow:!1,itemCompletePopShow:!1,searchItem:[],completeItem:[],quickAccessPopShow:!1,checkAllItemFlag:!1}},created:function(){this.createBillDetails()},beforeRouteLeave:function(t,e,i){var a=this;if(this.itemInputFocusing)return this.$router.go(1),!1;"/unifyOrder"===t.path&&0===this.billInfoData.billState?this.$dialog.confirm({title:"提示",message:"若已修改,请先保存单据<br/>是否关闭页面?"}).then(function(){i()}).catch(function(){return a.$router.go(1),!1}):i()},computed:Object(S["a"])({},Object(D["c"])({loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId},sysDZCManyLower:function(t){return t.systemParams.sysDZCManyLower},sysPointSize:"sysPointSize"}),{isBillState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.billInfoData.billState):e.billInfoData.billState===t}},isWeightState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.billInfoData.weightState):e.billInfoData.weightState===t}},isAutoState:function(t){var e=this;return function(t){return C()(t)?t.includes(e.billInfoData.autoType):e.billInfoData.autoType===t}}}),methods:{createBillDetails:function(){var t=this;return new b.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/distributioninbills/").concat(t.query.billId)}).then(function(i){t.billInfoData=i.storeBills[0],t.billItemList=t.filterStoreItem(i.storeBills[0].details);var a=t.billItemList.reduce(function(t,e){var i=e.details.filter(function(t){return"1"===t.checkFlag});return t+i.length},0);a===i.storeBills[0].details.length&&(t.checkAllItemFlag=!0),e(i)})})},filterStoreItem:function(t){var e=this;t.forEach(function(t){var i=p()(t.busUnitInAmount);i?(t.price=e.toFixedNumberSize(t.inMoney/t.busUnitInAmount),t.busUnitInAmount=e.toFixedNumberSize(i)):t.price=e.toFixedNumberSize(t.price),t.inMoney=e.toFixedNumberSize(t.inMoney),t.rawAmount=e.toFixedNumberSize(t.rawAmount),t.taxInMoney=e.toFixedNumberSize(t.taxInMoney),t.inMoneyWithTax=e.toFixedNumberSize(t.inMoneyWithTax)});var i=f()(new d.a(t.map(function(t){return t.inHouseDTO.id}))),a=i.map(function(e){var i=t.find(function(t){return t.inHouseDTO.id===e}).inHouseDTO;return i=JSON.parse(c()(i)),i.details=t.filter(function(t){return t.inHouseDTO.id===e}),i});return a},toFixedNumberSize:function(t){return p()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},onArriveDateClick:function(){this.datePickerShow=!0,this.datePickerType="arrive"},onBusinessDateClick:function(){this.datePickerShow=!0,this.datePickerType="business"},dateConfirmhandle:function(t){var e=t.getTime();"arrive"===this.datePickerType?this.billInfoData.arriveDate=e:this.billInfoData.businessDate=e,this.datePickerShow=!1},selectBillType:function(t){this.billInfoData.businessTypeDTO=t},searchBillType:function(t){var e=this;this.getBillTypeListData(t).then(function(t){e.billTypeList=t.businessTypes})},getBillTypeListData:function(t){var e=this;return new b.a(function(i){var a={m:"list4DistributionInBill",keyword:t};e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/users/").concat(e.loginerId,"/businessTypes"),data:a}).then(function(t){i(t)})})},onItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){this.billItemList.forEach(function(e){var i=e.details.findIndex(function(e){return e.id===t.id});~i&&(e.details[i]=t)})},onSaveClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要保存该单据吗?"}).then(function(){var e=t.getSaveParams();if(!e)return!1;t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/distributioninbills/").concat(t.query.billId),data:e,query:{userId:t.loginerId,m:"modify"}}).then(function(e){t.createBillDetails().then(function(){t.$fxToast.success("保存成功")})})}).catch(function(){})},onExpressClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要审核该单据吗?"}).then(function(){var e=t.getSaveParams();if(!e)return!1;t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/distributioninbills/").concat(t.query.billId),data:e,query:{userId:t.loginerId,m:"editAndCheck"}}).then(function(e){t.createBillDetails().then(function(){t.$fxToast.success("审核成功")})})}).catch(function(){})},onUnExpressClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要反审该单据吗?"}).then(function(){var e=t.getSaveParams();if(!e)return!1;t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/distributioninbills/").concat(t.query.billId),data:e,query:{userId:t.loginerId,m:"unCheck"}}).then(function(e){t.createBillDetails().then(function(){t.$fxToast.success("反审成功")})})}).catch(function(){})},onWeightClick:function(){var t=this;this.isAutoState(1)?this.$fxToast.success("单据是差异反库生成的入库单，不允许称重"):this.checkHasDetails().then(function(){t.$dialog.confirm({title:"提示",message:"确定要下发称重吗?"}).then(function(){var e=t.getSaveParams();if(!e)return!1;t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/distributioninbills/").concat(t.query.billId,"/users/").concat(t.loginerId),data:e,query:{userId:t.loginerId,m:"weighBill"}}).then(function(e){t.createBillDetails().then(function(){t.$fxToast.success("下发称重成功")})})}).catch(function(){})})},onUnWeightClick:function(){var t=this;this.checkHasDetails().then(function(){var e="确定要取消称重吗?";2===t.billInfoData.weighState&&(e="称重中的单据，取消称重后电子秤可以继续称重并传回数据！确定要取消称重吗"),t.$dialog.confirm({title:"提示",message:e}).then(function(){t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/distributioninbills/").concat(t.query.billId,"/users/").concat(t.loginerId),query:{userId:t.loginerId,m:"unWeighBill"}}).then(function(e){t.createBillDetails().then(function(){t.$fxToast.success("取消称重成功")})})}).catch(function(){})})},onEndWeightClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"结束称重后将不再接收此单据的称重数据"}).then(function(){t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/distributioninbills/").concat(t.query.billId,"/users/").concat(t.loginerId),query:{userId:t.loginerId,m:"endWeighBill"}}).then(function(e){t.createBillDetails().then(function(){t.$fxToast.success("结束称重成功")})})}).catch(function(){})},checkHasDetails:function(){var t=this;return new b.a(function(e){var i=[];t.billItemList.forEach(function(t){i.push.apply(i,Object(r["a"])(t.details))});var a=i.filter(function(t){return"del"!==t.changeType});0===a.length?t.$fxToast.fail("单据明细不能为空"):e()})},getSaveParams:function(){var t=[];this.billItemList.forEach(function(e){t.push.apply(t,Object(r["a"])(e.details))});var e=t.filter(function(t){return"del"===t.changeType});if(e.length===t.length)return this.$fxToast.fail("单据明细不能为空！"),!1;var i=t.filter(function(t){return"edit"===t.changeType}),a=s()(this.billInfoData,{detailDel:e.length>0?e:null,detailMdf:i.length>0?i:null,details:[]});return a},onUnitEdit:function(t){var e=this;this.itemEditRowData=t,this.getItemUnit(t.goodsDTO.id).then(function(t){e.unitActions=t,e.unitActionShow=!0})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemEditRowData,i=e.unitDTO.value,a=t;e.outOrderAmount=p()(this.$fxUtils.toFixedSHW(e.outOrderAmount*i/a.value,this.sysPointSize)),e.rawAmount=p()(this.$fxUtils.toFixedSHW(e.rawAmount*i/a.value,this.sysPointSize)),e.busUnitInAmount=p()(this.$fxUtils.toFixedSHW(e.busUnitInAmount*i/a.value,this.sysPointSize)),e.checkAmount=p()(this.$fxUtils.toFixedSHW(e.checkAmount*i/a.value,this.sysPointSize)),0===e.busUnitInAmount?e.price=p()(this.$fxUtils.toFixedSHW(e.price*a.value/i,this.sysPointSize)):e.price=p()(this.$fxUtils.toFixedSHW(e.inMoney/e.busUnitInAmount,this.sysPointSize)),e.unitDTO=t},getItemUnit:function(t){var e=this;return new b.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/shopId/users/userId/goods/").concat(t,"/units")}).then(function(t){i(t.units)})})},onItemFocus:function(){this.$refs.billInfo.closeCollapse()},onCompleteClick:function(){var t=this;this.getCheckList().then(function(e){if(!e.billDetailGroup.length)return t.$fxToast.fail("该单据没有分组!"),!1;t.itemCompletePopShow=!0,t.completeItem=JSON.parse(c()(e.billDetailGroup))})},getCheckList:function(){var t=this;return new b.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/distributioninbills/").concat(t.query.billId,"/groups")}).then(function(t){e(t)})})},completeHandle:function(t,e,i){var a=this;return new b.a(function(n){var o="",s=[{id:t.id,checkAmount:e.groupAmount,inMoney:e.data.inMoney,taxInMoney:e.data.taxInMoney,inMoneyWithTax:e.data.inMoneyWithTax,bill:{id:t.billId}}];o="1"===e.checkFlag?"".concat(a.$fxBaseApi.url,"/accounts/").concat(a.loginerShopId,"/distributionindetails?m=updateCheckAmount"):"".concat(a.$fxBaseApi.url,"/accounts/").concat(a.loginerShopId,"/distributioninbills/").concat(i,"?m=accept&groupId=").concat(e.groupId),a.$fxHttp.requestPut({url:o,data:s}).then(function(t){n(t)})})},onSearchClick:function(){this.itemSearchPopShow=!0,this.searchItem=JSON.parse(c()(this.billItemList))},onSearchConfirm:function(t){this.billItemList=t},onQuickAccessClick:function(){this.quickAccessPopShow=!0,this.searchItem=JSON.parse(c()(this.billItemList))}}},St=Ct,Dt=(i("fb49"),Object(P["a"])(St,a,n,!1,null,"792c463b",null));e["default"]=Dt.exports},d281:function(t,e,i){},d444:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"add-item-class-content fx-vant-class-collapse"},[i("div",{staticClass:"all-class",class:{"is-active":""===t.value},on:{click:function(e){return e.stopPropagation(),t.selectClass("")}}},[t._v(t._s(t.classTitle))]),i("van-collapse",{attrs:{accordion:!0},model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},t._l(t.itemClassList,function(e){return i("van-collapse-item",{key:e.id,attrs:{name:e.id}},[i("div",{staticClass:"big-class",attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),t._l(e.smallType,function(e){return i("van-cell",{key:e.id,staticClass:"small-class",class:{"is-active":t.value===e.id},attrs:{title:e.name},on:{click:function(i){return i.stopPropagation(),t.selectClass(e.id)}}})})],2)}),1)],1)},n=[],o=(i("c5f6"),{name:"addItemClassList",props:{value:[String,Number],itemClassList:{type:Array,default:function(){return[]}},classTitle:{type:String,default:"全部品项"}},data:function(){return{activeNames:[]}},methods:{selectClass:function(t){this.$emit("input",t),this.$emit("on-select-class",t),this.$emit("on-change-class",[t,this.value])}}}),s=o,r=(i("5402"),i("2877")),l=Object(r["a"])(s,a,n,!1,null,"df69e854",null);e["a"]=l.exports},d4a6:function(t,e,i){"use strict";var a=i("fedf"),n=i.n(a);n.a},d4c1:function(t,e,i){"use strict";var a=i("6304"),n=i.n(a);n.a},d723:function(t,e,i){},d7c3:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"store-item"},[i("w-header",{attrs:{title:"编辑订货单明细",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{staticClass:"add-store-bar"},[i("van-button",{staticClass:"add-store-btn fx-btn",attrs:{type:"primary",round:""},on:{click:t.onAddStoreClick}},[t._v("添加仓库")])],1),i("div",{staticClass:"store-item-content"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeStoreNames,callback:function(e){t.activeStoreNames=e},expression:"activeStoreNames"}},t._l(t.currentStoreItemData,function(e,a){return i("van-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.storeShowComputed(e),expression:"storeShowComputed(storeItem)"}],key:e.id,staticClass:"store-row",attrs:{name:e.id}},[i("div",{staticClass:"item-store-title",attrs:{slot:"title"},slot:"title"},[i("span",{staticClass:"item-store-name fx-title fx-ellipsis"},[t._v(t._s(e.name))])]),i("div",{staticClass:"item-storn-btn"},[i("span",{staticClass:"edit-btn",on:{click:function(i){return t.editStoreItem(e)}}}),i("span",{staticClass:"delete-btn",on:{click:function(i){return t.deleteStoreItem(e,a)}}})]),t._l(e.details,function(t){return i("div",{directives:[{name:"show",rawName:"v-show",value:"del"!==t.changeType,expression:"item.changeType !== 'del'"}],key:e.id+"-"+t.goodsDTO.id,staticClass:"item-row"},[i("itemInfoCell",{attrs:{itemData:t,isDisabled:!0,disabledWatchBtn:!0}})],1)})],2)}),1)],1),i("div",{staticClass:"store-item-bottom"},[i("van-button",{staticClass:"save-btn fx-no-radius fx-btn",attrs:{type:"primary"},on:{click:t.onSaveClick}},[t._v("保存")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopOrderBill.importCommonGoods"),expression:"$fxAuth('shopOrderBill.importCommonGoods')"}],staticClass:"save-btn fx-no-radius fx-btn",attrs:{type:"info"},on:{click:t.onImportOftenOrderClick}},[t._v("导入常订品项")])],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.storePopShow,callback:function(e){t.storePopShow=e},expression:"storePopShow"}},[i("listComp",{attrs:{visibleFlag:t.storePopShow,data:t.storeList,loadFinished:!0,title:"仓库检索"},on:{"update:visibleFlag":function(e){t.storePopShow=e},"update:visible-flag":function(e){t.storePopShow=e},"on-search":t.searchStore,"on-select":t.selectStore}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemPopShow,callback:function(e){t.itemPopShow=e},expression:"itemPopShow"}},[i("itemEditComp",{attrs:{visibleFlag:t.itemPopShow,shopId:t.shopId,orderPlanId:t.orderPlanId,store:t.currentStoreObj,businessDate:t.businessDate,urgentFlag:t.urgentFlag,parentStoreItem:t.computedStoreItem},on:{"update:visibleFlag":function(e){t.itemPopShow=e},"update:visible-flag":function(e){t.itemPopShow=e},"on-confirm":t.onItemEditConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.oftenOrderPopShow,callback:function(e){t.oftenOrderPopShow=e},expression:"oftenOrderPopShow"}},[i("importOftenOrderPop",{attrs:{visibleFlag:t.oftenOrderPopShow,workDate:t.businessDate,shopId:t.shopId,orderPlanId:t.orderPlanId,urgentFlag:t.urgentFlag,houseGoodsArray:t.houseGoodsArray},on:{"update:visibleFlag":function(e){t.oftenOrderPopShow=e},"update:visible-flag":function(e){t.oftenOrderPopShow=e},"on-item-import-confirm":t.onImportDataConfirm}})],1)],1)},n=[],o=(i("ac6a"),i("7f7f"),i("5176")),s=i.n(o),r=i("768b"),l=i("795b"),c=i.n(l),u=(i("7514"),i("cebc")),d=(i("c5f6"),i("2f62")),h=i("f6bb"),f=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-edit"},[i("w-header",{attrs:{title:"选择品项",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}},[i("van-icon",{staticClass:"header-confirm-btn",attrs:{slot:"header-right",name:"success"},on:{click:t.onItemConfirm},slot:"header-right"})],1),i("div",{staticClass:"item-search clearfix"},[i("van-search",{staticClass:"fx-item-search",attrs:{placeholder:"请输入搜索关键词",shape:"round"},on:{search:t.search,focus:t.onSearchFocus},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}})],1),i("div",{staticClass:"item-edit-content"},[i("addItemClassList",{attrs:{itemClassList:t.itemClassList},on:{"on-change-class":t.changeClass},model:{value:t.currentClass,callback:function(e){t.currentClass=e},expression:"currentClass"}}),i("addItemList",{ref:"addItemList",attrs:{listLoading:t.listLoading,loadFinished:t.loadFinished,itemList:t.itemList},on:{"update:listLoading":function(e){t.listLoading=e},"update:list-loading":function(e){t.listLoading=e},"on-load-more":t.onLoadMore},scopedSlots:t._u([{key:"item-cell",fn:function(e){return[i("addItemCell",{attrs:{itemData:e.$item,itemIndex:e.$index,rowActive:t.rowActive,isActive:e.$item.must,isError:e.$index===t.isErrorActive,showSpec:t.$fxAuth("shopOrderBill.goodsSize")},on:{"on-item-click":t.onItemEdit}})]}}]),model:{value:t.rowActive,callback:function(e){t.rowActive=e},expression:"rowActive"}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.numberKeyboardShow,expression:"numberKeyboardShow"}],staticClass:"details-number-keyboard"},[i("itemNumberKeyboard",{attrs:{title:t.keyboardTitleCompted,unit:t.keyboardUnitCompted,amount:t.keyboardAmountCompted,pointSize:t.sysPointSize,intLength:t.numberLength},on:{change:t.onKeyboardChange,pre:t.onKeyboardPre,next:t.onKeyboardNext,hide:t.onKeyboardHide}})],1)],1)},m=[],p=i("59ad"),v=i.n(p),b=(i("20d6"),i("75fc")),g=i("f499"),C=i.n(g),S=i("d444"),D=i("01f7"),k=i("9c7f"),y=i("af41"),w=10,x={name:"itemEditComp",components:{addItemClassList:S["a"],addItemList:D["a"],addItemCell:k["a"],itemNumberKeyboard:y["a"]},props:{visibleFlag:Boolean,store:{type:Object,default:function(){return{}}},shopId:{type:String,default:""},businessDate:{type:[String,Number],default:""},urgentFlag:{type:Boolean,default:!1},orderPlanId:{type:String,default:""},parentStoreItem:{type:Array,default:function(){return[]}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",currentClass:"",itemClassList:[],itemList:[],numberKeyboardShow:!1,rowActive:"",selectedItemArr:[],itemListStart:0,listLoading:!1,loadFinished:!0,listError:!1,isErrorActive:""}},computed:Object(u["a"])({},Object(d["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{keyboardTitleCompted:function(){if(""===this.rowActive)return"";var t=this.itemList[this.rowActive];return t.goodsDTO.name},keyboardUnitCompted:function(){if(""===this.rowActive)return"";var t=this.itemList[this.rowActive];return t.unitDTO.name},keyboardAmountCompted:function(){if(""===this.rowActive)return"0";var t=this.itemList[this.rowActive];return t.busUnitAmount}}),watch:{visibleFlag:{handler:function(t){t&&(this.selectedItemArr=JSON.parse(C()(this.parentStoreItem)),this.refresh())},immediate:!0},rowActive:function(t,e){""!==e?(this.numberStringAmount(e),this.pushSelectedItem(this.itemList[e]),""===t?this.numberKeyboardShow=!1:this.scrollToActive(t)):this.scrollToActive(t)}},methods:{refresh:function(){var t=this;this.searchKey="",this.getItemClass().then(function(e){t.itemClassList=e.goodsTypes,t.currentClass="",t.getItemByClass()})},onCloseClick:function(){var t=this;this.onCheckAmount(this.rowActive).then(function(){t.rowActive="",t.$emit("update:visibleFlag",!1)})},onItemConfirm:function(){var t=this;this.onCheckAmount(this.rowActive).then(function(){t.rowActive="",t.$nextTick(function(){t.selectedItemArr.forEach(function(e){e.houseDTO||(e.houseDTO=t.store)}),t.$emit("on-confirm",[t.selectedItemArr,t.store]),t.$emit("update:visibleFlag",!1)})})},search:function(){this.getItemByClass()},getItemClass:function(){var t=this;return new c.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/goodTypes")}).then(function(t){e(t)})})},getItem:function(){var t=this;return new c.a(function(e){var i={start:t.itemListStart,size:w,paged:!0,expressFlag:t.urgentFlag?1:0,goodsSmallTypeId:t.currentClass||null,inId:t.store.id,orgId:t.shopId,orderPlanId:t.orderPlanId,workDate:t.$fxUtils.setDateTime(new Date(t.businessDate)),searchText:t.searchKey||null,isFlag:!0};t.$fxHttp.requestPost({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/shoporderdetails"),data:i}).then(function(t){e(t)})})},getItemByClass:function(){var t=this;this.itemListStart=0,this.getItem().then(function(e){t.itemList=t.setResItem(e.shopOrderBillDetails),t.setListLoading(e.shopOrderBillDetails.length),t.$nextTick(function(){t.$refs.addItemList.onSelectLetter(0,5)})})},onLoadMore:function(){var t=this;this.getItem().then(function(e){var i;(i=t.itemList).push.apply(i,Object(b["a"])(t.setResItem(e.shopOrderBillDetails))),t.setListLoading(e.shopOrderBillDetails.length)})},setResItem:function(t){var e=this;return t.forEach(function(t){var i=e.selectedItemArr.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id});~i?("del"!==e.selectedItemArr[i].changeType?t.busUnitAmount=e.selectedItemArr[i].busUnitAmount:t.must?(t.busUnitAmount=e.selectedItemArr[i].busUnitAmount,e.selectedItemArr[i].changeType="edit"):t.busUnitAmount="0",e.selectedItemArr[i].must=t.must,e.selectedItemArr[i].maxOrder=t.maxOrder,e.selectedItemArr[i].minOrder=t.minOrder,e.selectedItemArr[i].rounding=t.rounding):t.must?(t.changeType="add",t.busUnitAmount="0",e.selectedItemArr.push(t)):t.busUnitAmount="0"}),t},setListLoading:function(t){this.listLoading=!1,this.itemListStart+=w,this.loadFinished=t<w},changeClass:function(t){var e=this,i=Object(r["a"])(t,2),a=(i[0],i[1]);this.onCheckAmount(this.rowActive).then(function(){e.searchKey="",e.onKeyboardHide(),e.getItemByClass()}).catch(function(){e.currentClass=a})},onItemEdit:function(t){var e=this;this.onCheckAmount(this.rowActive).then(function(){e.rowActive=t,e.numberKeyboardShow=!0})},onKeyboardChange:function(t){this.itemList[this.rowActive].busUnitAmount=t},numberStringAmount:function(t){var e=this.itemList[t].busUnitAmount;this.itemList[t].busUnitAmount=v()(e),this.itemList[t].consultMoney=this.toFixedNumberSize(e*this.itemList[t].consultPrice),this.itemList[t].consultMoneyWithTax=this.toFixedNumberSize(e*this.itemList[t].consultTaxPrice),this.itemList[t].consultTaxMoney=this.toFixedNumberSize(this.itemList[t].consultMoneyWithTax-this.itemList[t].consultMoney)},toFixedNumberSize:function(t){return v()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},pushSelectedItem:function(t){var e=this.selectedItemArr.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id});~e?t.must?(this.selectedItemArr[e].id&&(this.selectedItemArr[e].changeType="edit"),this.selectedItemArr[e].busUnitAmount=t.busUnitAmount,this.selectedItemArr[e].consultMoney=t.consultMoney):this.selectedItemArr[e].id||0!==t.busUnitAmount?(this.selectedItemArr[e].id&&(0===t.busUnitAmount?"del"!==this.selectedItemArr[e].changeType&&(this.selectedItemArr[e].changeType="del",this.$fxToast({message:"删除已选品项".concat(t.goodsDTO.name),position:"top"})):this.selectedItemArr[e].changeType="edit"),this.selectedItemArr[e].busUnitAmount=t.busUnitAmount,this.selectedItemArr[e].consultMoney=t.consultMoney):(this.selectedItemArr.splice(e,1),this.$fxToast({message:"删除已选品项".concat(t.goodsDTO.name),position:"top"})):(t.busUnitAmount>0||t.must)&&(t.changeType="add",this.selectedItemArr.push(t))},onKeyboardPre:function(){var t=this;if(!this.rowActive)return!1;this.onCheckAmount(this.rowActive).then(function(){t.rowActive--})},onKeyboardNext:function(){var t=this;if(""===this.rowActive||this.rowActive===this.itemList.length-1)return!1;this.onCheckAmount(this.rowActive).then(function(){t.rowActive++})},onKeyboardHide:function(){var t=this;this.onCheckAmount(this.rowActive).then(function(){t.rowActive=""})},onCheckAmount:function(t){var e=this;return new c.a(function(i,a){if(""===t)i();else{var n=v()(e.itemList[t].busUnitAmount),o=e.itemList[t],s=o.must,r=o.maxOrder,l=o.minOrder,c=o.rounding,u=r?"订货数量不能大于最大数量".concat(r,"\n"):"",d=l?"订货数量不能小于最小数量".concat(l,"\n"):"",h=c?"订货数量必须是".concat(c,"的倍数"):"",f=u+d+h;e.isErrorActive="",(0!==n||s)&&(r&&n>r||l&&n<l||e.checkRoundingError(c,n))?(e.$fxNotify.fail(f),e.isErrorActive=t,e.scrollToActive(t),a(t)):i()}})},checkRoundingError:function(t,e){return t&&e%t!==0},scrollToActive:function(t){var e=this;this.$nextTick(function(){e.$refs.addItemList.onSelectLetter(t,20)})},onSearchFocus:function(){var t=this;this.onCheckAmount(this.rowActive).then(function(){t.rowActive=""}).catch(function(){document.activeElement.blur()})}}},I=x,P=(i("fe23"),i("2877")),O=Object(P["a"])(I,f,m,!1,null,"176a627a",null),A=O.exports,T=i("50d5"),$=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"ofterOrder-wrap"},[i("w-header",{attrs:{title:"导入常订品项",leftOptions:t.leftOptions,border:!0},on:{"on-click-back":t.onCloseClick}}),i("div",{staticClass:"order-info-block fx-shadow-block"},[i("van-cell-group",[i("van-cell",{staticClass:"fx-info-title",attrs:{title:"常订品项方案",value:t.ofterOrderPlan,"value-class":"info-item-value","is-link":""},on:{click:t.onOfterOrderPlanClick}})],1)],1),i("div",{staticClass:"order-item-block fx-shadow-block"},[i("div",{staticClass:"item-title fx-title"},[i("span",{staticClass:"title-name"},[t._v("单据明细")]),i("span",{staticClass:"title-count"},[t._v("明细：")]),i("span",[t._v(t._s(t.detailsLength))]),i("i",{staticClass:"title-search-icon title-icon fl-r",on:{click:t.onSearchClick}})]),i("oftenItemList",{ref:"addItemList",attrs:{data:t.data,rowActive:t.rowActive,amount:t.amount},on:{"update:amount":function(e){t.amount=e},"on-item-click":t.onItemClick}}),i("div",{staticClass:"import-bill-bottom"},[i("van-button",{staticClass:"add-btn fx-no-radius fx-btn",attrs:{type:"primary"},on:{click:t.onImportConfirm}},[t._v("导入")])],1)],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.ofterOrderPlanPopShow,callback:function(e){t.ofterOrderPlanPopShow=e},expression:"ofterOrderPlanPopShow"}},[i("checkboxListComp",{attrs:{visibleFlag:t.ofterOrderPlanPopShow,data:t.ofterOrderPlansList,loadFinished:!0,title:"常订方案检索"},on:{"update:visibleFlag":function(e){t.ofterOrderPlanPopShow=e},"update:visible-flag":function(e){t.ofterOrderPlanPopShow=e},"on-search":t.searchOfterOrderPlan,"on-select":t.selectOfterOrderPlan}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.oftenItemSearchPopShow,callback:function(e){t.oftenItemSearchPopShow=e},expression:"oftenItemSearchPopShow"}},[i("oftenItemSearchPop",{attrs:{visibleFlag:t.oftenItemSearchPopShow,data:t.data,isDisabled:!1},on:{"update:visibleFlag":function(e){t.oftenItemSearchPopShow=e},"update:visible-flag":function(e){t.oftenItemSearchPopShow=e},"on-search-confirm":t.onSearchConfirm}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.numberKeyboardShow,expression:"numberKeyboardShow"}],staticClass:"details-number-keyboard"},[i("itemNumberKeyboard",{attrs:{title:t.keyboardTitleCompted,amount:t.keyboardAmountCompted,pointSize:t.sysPointSize,intLength:t.numberLength,unit:t.keyboardUnitCompted,unitEdit:!1},on:{change:t.onKeyboardChange,pre:t.onKeyboardPre,next:t.onKeyboardNext,hide:t.onKeyboardHide}})],1)],1)},B=[],F=i("b6d0"),L=i.n(F),_=i("774e"),E=i.n(_),N=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"shop-popup"},[i("w-header",{attrs:{title:t.title,leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("van-search",{staticClass:"search-pro",attrs:{placeholder:"请输入搜索关键词",shape:"round"},on:{search:t.search},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}}),i("div",{staticClass:"popup-content"},[i("van-checkbox-group",{model:{value:t.selectDataNames,callback:function(e){t.selectDataNames=e},expression:"selectDataNames"}},[i("van-list",{attrs:{finished:t.loadFinished,"finished-text":"没有更多了",error:t.listError,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.listError=e},load:t.onLoad},model:{value:t.listLoading,callback:function(e){t.listLoading=e},expression:"listLoading"}},t._l(t.data,function(e,a){return i("van-cell",{key:e.id,staticClass:"fx-van-cell",attrs:{title:e.name},on:{click:function(e){return t.indexListClick(a)}}},[i("div",{staticClass:"list-checkbox",attrs:{slot:"icon"},slot:"icon"},[i("van-checkbox",{ref:"checkboxes",refInFor:!0,attrs:{shape:"square",name:e.name,value:e.id},scopedSlots:t._u([{key:"icon",fn:function(e){return i("img",{staticClass:"checkbox-img",attrs:{src:e.checked?t.checkedIcon.active:t.checkedIcon.normal}})}}],null,!0)})],1)])}),1)],1)],1),i("div",{staticClass:"filter-bottom"},[i("van-button",{staticClass:"confirm-btn fx-no-radius fx-btn",attrs:{type:"primary"},on:{click:t.onConfirmClick}},[t._v("确定")])],1)],1)},R=[],M={name:"filterPop",props:{loading:Boolean,visibleFlag:Boolean,title:String,data:{type:Array,default:function(){return[]}},loadFinished:Boolean},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",listLoading:!1,listError:!1,selectDataNames:[],checkedIcon:{normal:i("41c0"),active:i("f3c0")}}},watch:{loading:{handler:function(t){t||(this.listLoading=!1)},immediate:!0},visibleFlag:function(t){t&&(this.searchKey="",this.selectDataNames=[])}},methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},indexListClick:function(t){this.$refs.checkboxes[t].toggle()},search:function(){this.$emit("on-search",this.searchKey)},onLoad:function(){this.$emit("update:loading",!0),this.$emit("on-load",this.searchKey)},onConfirmClick:function(){var t=[];if(this.$refs.checkboxes.forEach(function(e){e.checked&&t.push(e.value)}),!t.length)return this.$fxToast.fail("请先选择常订品项方案!"),!1;var e={names:this.selectDataNames,ids:t};this.$emit("on-select",e),this.$emit("update:visibleFlag",!1)}}},U=M,H=(i("aae2"),Object(P["a"])(U,N,R,!1,null,"994ca3b6",null)),W=H.exports,G=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-search-block"},[i("w-header",{attrs:{title:"搜索品项",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("searchHead",{attrs:{initSearch:t.visibleFlag,searchKey:t.searchKey,beforeChange:t.onBeforeChange},on:{"update:searchKey":function(e){t.searchKey=e},"update:search-key":function(e){t.searchKey=e}}}),i("oftenItemList",{ref:"addItemList",staticClass:"often-item-list",attrs:{data:t.currentData,rowActive:t.rowActive,amount:t.amount,searchKey:t.searchKey},on:{"update:amount":function(e){t.amount=e},"on-item-click":t.onItemClick}}),i("div",{staticClass:"search-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"bottom-btn fx-no-radius fx-btn",attrs:{type:"primary"},on:{click:t.onSearchConfirm}},[t._v("保存")])],1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.numberKeyboardShow,expression:"numberKeyboardShow"}],staticClass:"details-number-keyboard"},[i("itemNumberKeyboard",{attrs:{title:t.keyboardTitleCompted,amount:t.keyboardAmountCompted,pointSize:t.sysPointSize,intLength:t.numberLength,unit:t.keyboardUnitCompted,unitEdit:!1},on:{change:t.onKeyboardChange,pre:t.onKeyboardPre,next:t.onKeyboardNext,hide:t.onKeyboardHide}})],1)],1)},z=[],j=i("01db"),K=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"details-content",staticClass:"item-list"},t._l(t.data,function(e,a){return i("div",{directives:[{name:"show",rawName:"v-show",value:t.$fxCommon.storeFilter(e,t.searchKey),expression:"$fxCommon.storeFilter(storeItem, searchKey)"}],key:e.id,staticClass:"store-row"},[i("div",{staticClass:"item-store-title fx-title fx-ellipsis"},[t._v(t._s(e.name))]),t._l(t.$fxCommon.detailFilter(e.details,t.searchKey),function(n,o){return i("div",{directives:[{name:"show",rawName:"v-show",value:"del"!==n.changeType,expression:"item.changeType !== 'del'"}],key:e.id+"-"+n.goodsDTO.id,ref:"details-row-"+a+"-"+o,refInFor:!0,staticClass:"item-row",class:{"is-active":t.rowActive[0]===a&&t.rowActive[1]===o},on:{click:function(e){return t.onItemClick(a,o)}}},[i("checkBox",{staticClass:"order-checkbox",attrs:{visibleFlag:!0,checked:n.checked},on:{"on-checkbox-click":function(i){return t.onClick(n,e.id+"-"+n.goodsDTO.id)}}}),i("itemInfoCell",t._b({ref:"itemInfoCell-"+e.id+"-"+n.goodsDTO.id,refInFor:!0,staticClass:"order-item-cell",attrs:{itemData:n,isDisabled:!0,disabledEditBtn:!0,disabledWatchBtn:!0}},"itemInfoCell",t.$attrs,!1))],1)})],2)}),0)},q=[],J=i("0f38"),V={name:"oftenItemList",components:{itemInfoCell:T["a"],checkBox:J["a"]},props:{data:{type:Array,default:function(){return[]}},amount:[Number,String],rowActive:[Number,String,Array],searchKey:{type:String,default:function(){return""}}},inheritAttrs:!1,data:function(){return{}},watch:{amount:{handler:function(t){t>=0&&this.itemChange(t)}}},computed:{storeShowComputed:function(t){return function(t){var e=t.details.filter(function(t){return"del"!==t.changeType}).length;return e>0}}},methods:{onClick:function(t,e){if(this.focusing)return!1;if(t.checked){if(t.must)return!1;t.busUnitAmount=0,t.consultMoney=0,this.$set(t,"checked",!t.checked)}},onItemClick:function(t,e){this.$emit("on-item-click",[t,e])},itemChange:function(t){var e=this.$fxCommon.detailFilter(this.data[this.rowActive[0]].details,this.searchKey)[this.rowActive[1]];e.busUnitAmount=t;var i=!1;t>0&&(i=!0),this.$set(e,"checked",i),this.$emit("update:amount",-1)},onSelectLetter:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40,i=this.$refs["details-row-".concat(t[0],"-").concat(t[1])];if(!i||0===i.length)return!1;var a=i[0].offsetTop-5,n=this.$refs["details-content"];this.$fxUtils.scrollTopW({offsetTop:a,$el:n,distance:e})}}},Z=V,Y=(i("cd7f"),Object(P["a"])(Z,K,q,!1,null,"2ff81de6",null)),Q=Y.exports,X={name:"oftenItemSearchPop",components:{searchHead:j["a"],itemNumberKeyboard:y["a"],oftenItemList:Q},props:{data:{type:Array,default:function(){return[]}},isDisabled:Boolean,visibleFlag:Boolean},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},currentData:[],searchKey:"",numberKeyboardShow:!1,rowActive:[],amount:0}},watch:{visibleFlag:{handler:function(t){t&&(this.searchKey="",this.currentData=JSON.parse(C()(this.data)),this.resetHandler())},immediate:!0},rowActiveData:{handler:function(t,e){if(!this.currentData.length)return!0;if(e.length){var i=this.$fxCommon.detailFilter(this.currentData[e[0]].details,this.searchKey)[e[1]];i.busUnitAmount=v()(i.busUnitAmount),t.length?this.scrollToActive(t):this.numberKeyboardShow=!1}else this.scrollToActive(t)},deep:!0}},computed:Object(u["a"])({},Object(d["c"])({loginerId:function(t){return t.loginer.loginerId},numberLength:"numberLength",sysPointSize:"sysPointSize"}),{keyboardTitleCompted:function(){var t=this.rowActive;if(t.length&&this.data.length){var e=this.rowActive,i=this.$fxCommon.detailFilter(this.currentData[e[0]].details,this.searchKey)[e[1]];return i.goodsDTO.name}return""},keyboardUnitCompted:function(){var t=this.rowActive;if(t.length&&this.data.length){var e=this.rowActive,i=this.$fxCommon.detailFilter(this.currentData[e[0]].details,this.searchKey)[e[1]];return i.unitDTO.name}return""},keyboardAmountCompted:function(){var t=this.rowActive;if(t.length&&this.data.length){var e=this.$fxCommon.detailFilter(this.currentData[t[0]].details,this.searchKey)[t[1]];return e.busUnitAmount}return"0"},rowActiveData:function(){return Object(b["a"])(this.rowActive)}}),methods:{onCloseClick:function(){this.resetHandler(),this.$emit("update:visibleFlag",!1)},onItemClick:function(t){this.rowActive=t,this.numberKeyboardShow=!0},onBeforeChange:function(){return this.numberKeyboardShow=!1,this.rowActive=[],!0},onKeyboardChange:function(t){this.amount=t},onKeyboardPre:function(){var t=this,e=this.rowActive,i=this.currentData.filter(function(e){return t.$fxCommon.storeFilter(e,t.searchKey)});if(!e.length||0===e[0]&&0===e[1])return!1;0===e[1]?(e[0]--,e[1]=this.$fxCommon.detailFilter(i[e[0]].details,this.searchKey).length-1):e[1]--,this.$set(this.rowActive,0,e[0]),this.$set(this.rowActive,1,e[1])},onKeyboardNext:function(){var t=this,e=this.rowActive,i=this.currentData.filter(function(e){return t.$fxCommon.storeFilter(e,t.searchKey)});if(!e.length||e[0]===i.length-1&&e[1]===this.$fxCommon.detailFilter(i[i.length-1].details,this.searchKey).length-1)return!1;e[1]+1===this.$fxCommon.detailFilter(i[e[0]].details,this.searchKey).length?(e[0]++,e[1]=0):e[1]++,this.$set(this.rowActive,0,e[0]),this.$set(this.rowActive,1,e[1])},onKeyboardHide:function(){this.rowActive=[]},scrollToActive:function(t){var e=this;this.$nextTick(function(){e.$refs.addItemList.onSelectLetter(t,20)})},onSearchConfirm:function(){var t=this;this.resetHandler();var e=this.findSelectItem();if(0===e.length)return this.$fxToast.fail("请选择常订品项，并填写订货数量"),!1;this.$nextTick(function(){t.$emit("on-search-confirm",t.currentData),t.$emit("update:visibleFlag",!1)})},findSelectItem:function(){var t=[];return this.currentData.forEach(function(e){var i=e.details.filter(function(t){return!0===t.checked&&(t.changeType="add",!0)});if(i.length){var a=JSON.parse(C()(e));a.details=i,t.push(a)}}),t},resetHandler:function(){this.rowActive="",this.numberKeyboardShow=!1}}},tt=X,et=(i("b577"),Object(P["a"])(tt,G,z,!1,null,"27ab1f50",null)),it=et.exports,at={name:"orderItem",components:{checkboxListComp:W,oftenItemSearchPop:it,itemNumberKeyboard:y["a"],oftenItemList:Q},props:{visibleFlag:Boolean,isDisabled:{type:Boolean,default:!1},shopId:{type:String,default:""},workDate:{type:[String,Number],default:""},urgentFlag:{type:Boolean,default:!1},orderPlanId:{type:String,default:""},houseGoodsArray:{type:Array,default:function(){return[]}}},inheritAttrs:!1,data:function(){return{data:[],leftOptions:{showBackBtn:!0,preventGoBack:!0},ofterOrderPlansList:[],ofterOrderPlan:"",ofterOrderPlanPopShow:!1,oftenItemSearchPopShow:!1,numberKeyboardShow:!1,rowActive:[],amount:0}},watch:{visibleFlag:{handler:function(t){t&&this.resetHandler()},immediate:!0},rowActiveData:{handler:function(t,e){if(!this.data.length)return!0;e.length?(this.data[e[0]].details[e[1]].busUnitAmount=v()(this.data[e[0]].details[e[1]].busUnitAmount),t.length?this.scrollToActive(t):this.numberKeyboardShow=!1):this.scrollToActive(t)},deep:!0}},computed:Object(u["a"])({},Object(d["c"])({loginerId:function(t){return t.loginer.loginerId},numberLength:"numberLength",sysPointSize:"sysPointSize"}),{detailsLength:function(t){return this.data.reduce(function(t,e){var i=e.details.filter(function(t){return"del"!==t.changeType});return t+i.length},0)},keyboardTitleCompted:function(){if(this.rowActive.length&&this.data.length){var t=this.data[this.rowActive[0]].details[this.rowActive[1]];return t.goodsDTO.name}return""},keyboardUnitCompted:function(){if(this.rowActive.length&&this.data.length){var t=this.data[this.rowActive[0]].details[this.rowActive[1]];return t.unitDTO.name}return""},keyboardAmountCompted:function(){if(this.rowActive.length&&this.data.length){var t=this.data[this.rowActive[0]].details[this.rowActive[1]];return t.busUnitAmount}return"0"},rowActiveData:function(){return Object(b["a"])(this.rowActive)}}),methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},getOrderPlansListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new c.a(function(i){var a={m:"getOrderPlans",keyWord:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/oftenOrderGoodPlans"),data:a}).then(function(t){i(t)})})},ofterOrderPlansRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getOrderPlansListData(e).then(function(e){t.ofterOrderPlansList=e.orderGoodsPlans,t.ofterOrderPlanPopShow=!0})},onOfterOrderPlanClick:function(){var t=this;this.numberKeyboardShow=!1,this.clearItemConfim("更换常订方案清空常订品项,是否继续?").then(function(){t.data=[],t.ofterOrderPlansList=[],t.ofterOrderPlan="",t.ofterOrderPlansRefresh()})},clearItemConfim:function(t){var e=this;return new c.a(function(i){0===e.data.length?i():e.$dialog.confirm({title:"提示",message:t}).then(function(){i()}).catch(function(){})})},searchOfterOrderPlan:function(t){this.ofterOrderPlansRefresh(t)},selectOfterOrderPlan:function(t){var e=this;this.ofterOrderPlan=t.names.join(","),this.getOrderGoodsListData(t).then(function(t){var i=t.shopOrderBillDetails,a=E()(new L.a(i.map(function(t){return t.houseDTO.id}))),n=a.map(function(t){var a=i.find(function(e){return e.houseDTO.id===t}).houseDTO;return a=JSON.parse(C()(a)),a.details=i.filter(function(i){return i.must&&(i.checked=!0),i.consultPrice=e.toFixedNumberSize(i.consultPrice),i.consultMoney=0,i.consultTaxPrice=e.toFixedNumberSize(i.consultTaxPrice),i.consultTax=e.toFixedNumberSize(i.consultTax),i.consultMoneyWithTax=0,i.houseDTO.id===t}),a});e.data=n})},getOrderGoodsListData:function(t){var e=this;return new c.a(function(i){var a={shopId:e.shopId,workDate:e.$fxUtils.setDateTime(new Date(e.workDate),"时分"),expressFlag:e.urgentFlag,orderPlanId:e.orderPlanId,delIds:e.houseGoodsArray.join(","),oftenOrderIds:t.ids.join(",")};e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.shopId,"/users/").concat(e.loginerId,"/shoporderdetails"),data:a,query:{m:"getOftenOrderGoods"}}).then(function(t){i(t)})})},toFixedNumberSize:function(t){return v()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},onImportConfirm:function(){var t=this;this.resetKeyBoard();var e=this.findSelectItem();if(0===e.length)return this.$fxToast.fail("请选择常订品项，并填写订货数量"),!1;this.$nextTick(function(){t.$emit("on-item-import-confirm",e),t.$emit("update:visibleFlag",!1)})},findSelectItem:function(){var t=[];return this.data.forEach(function(e){var i=e.details.filter(function(t){return!0===t.checked&&(t.changeType="add",!0)});if(i.length){var a=JSON.parse(C()(e));a.details=i,t.push(a)}}),t},onSearchClick:function(){this.resetKeyBoard(),this.oftenItemSearchPopShow=!0},onSearchConfirm:function(t){this.data=JSON.parse(C()(t))},resetHandler:function(){this.data=[],this.ofterOrderPlansList=[],this.ofterOrderPlan="",this.ofterOrderPlanPopShow=!1,this.resetKeyBoard()},onItemClick:function(t){this.rowActive=t,this.numberKeyboardShow=!0},resetKeyBoard:function(){this.rowActive=[],this.numberKeyboardShow=!1},onKeyboardChange:function(t){this.amount=t},onKeyboardPre:function(){var t=this.rowActive;if(!t.length||0===t[0]&&0===t[1])return!1;0===t[1]?(t[0]--,t[1]=this.data[t[0]].details.length-1):t[1]--,this.$set(this.rowActive,0,t[0]),this.$set(this.rowActive,1,t[1])},onKeyboardNext:function(){var t=this.data,e=this.rowActive;if(!e.length||e[0]===t.length-1&&e[1]===t[t.length-1].details.length-1)return!1;e[1]+1===t[e[0]].details.length?(e[0]++,e[1]=0):e[1]++,this.$set(this.rowActive,0,e[0]),this.$set(this.rowActive,1,e[1])},onKeyboardHide:function(){this.rowActive=[]},scrollToActive:function(t){var e=this;this.$nextTick(function(){e.$refs.addItemList.onSelectLetter(t,20)})}}},nt=at,ot=(i("680c"),Object(P["a"])(nt,$,B,!1,null,"6e1b5818",null)),st=ot.exports,rt={name:"storeItemComp",components:{listComp:h["a"],itemEditComp:A,itemInfoCell:T["a"],importOftenOrderPop:st},props:{visibleFlag:Boolean,shopId:{type:String,default:""},businessDate:{type:[String,Number],default:""},urgentFlag:{type:Boolean,default:!1},orderPlanId:{type:String,default:""},storeItemData:{type:Array,default:function(){return[]}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},storePopShow:!1,storeList:[],itemPopShow:!1,currentStoreObj:{},currentStoreItemData:[],oftenOrderPopShow:!1,houseGoodsArray:[],activeStoreNames:[]}},computed:Object(u["a"])({},Object(d["c"])({loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{computedStoreItem:function(){var t=this;if(this.$fxUtils.isEmptyObjSHW(this.currentStoreObj))return[];var e=this.currentStoreItemData.find(function(e){return e.id===t.currentStoreObj.id});return e?e.details:[]},storeShowComputed:function(t){return function(t){var e=t.details.filter(function(t){return"del"!==t.changeType}).length;return e>0}}}),watch:{visibleFlag:{handler:function(t){t&&(this.currentStoreItemData=this.storeItemData,this.openStoreItemList(this.currentStoreItemData))},immediate:!0}},methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onAddStoreClick:function(){this.onStoreRefresh()},searchStore:function(t){this.onStoreRefresh(t)},selectStore:function(t){this.currentStoreObj=t,this.itemPopShow=!0},onStoreRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getStoreListData(e).then(function(e){t.storeList=e.shops,t.storePopShow=!0})},getStoreListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new c.a(function(i){var a={keyword:e,m:"list4ShopOrderBill"};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/houses"),data:a}).then(function(t){i(t)})})},onItemEditConfirm:function(t){var e=Object(r["a"])(t,2),i=e[0],a=e[1],n=this.currentStoreItemData.find(function(t){return t.id===a.id});if(n)n.details=i;else{var o=s()({},a);o.details=i,this.currentStoreItemData.push(o)}this.openStoreItemList(this.currentStoreItemData)},editStoreItem:function(t){this.currentStoreObj=s()({},{code:t.code,id:t.id,name:t.name,pinYin:t.pinYin,updateIndicator:t.updateIndicator}),this.itemPopShow=!0},deleteStoreItem:function(t,e){var i=this;this.$dialog.confirm({title:"提示",message:"确定要删除当前仓库品项吗?"}).then(function(){var a=t.details.filter(function(t){return!!t.id});if(0===a.length)return i.currentStoreItemData.splice(e,1),!1;a.forEach(function(t){t.changeType="del"}),i.currentStoreItemData[e].details=a}).catch(function(){})},onSaveClick:function(){this.$emit("on-save",this.currentStoreItemData),this.$emit("update:visibleFlag",!1)},onImportOftenOrderClick:function(){var t=[];this.currentStoreItemData.forEach(function(e){e.details.forEach(function(i){"del"!==i.changeType&&t.push(e.id+i.goodsDTO.id)})}),this.houseGoodsArray=t,this.oftenOrderPopShow=!0},onImportDataConfirm:function(t){var e=this;t.forEach(function(t){var i=e.currentStoreItemData.find(function(e){return e.id===t.id});i?t.details.forEach(function(t){var e=i.details.find(function(e){return e.goodsDTO.id===t.goodsDTO.id});if(e){var a=e.id;s()(e,t),e.changeType="edit",e.id=a}else i.details.push(t)}):e.currentStoreItemData.push(t)})},openStoreItemList:function(t){var e=this;t.forEach(function(t){var i=t.details.filter(function(t){return"del"!==t.changeType}).length;i>0&&e.activeStoreNames.push(t.id)})}}},lt=rt,ct=(i("6643"),Object(P["a"])(lt,a,n,!1,null,"008a9dc4",null));e["a"]=ct.exports},dd64:function(t,e,i){},df43:function(t,e,i){},e0fa:function(t,e,i){},e202:function(t,e,i){},e5ce:function(t,e,i){},e5fe:function(t,e,i){},e65b:function(t,e,i){"use strict";var a=i("fc00"),n=i.n(a);n.a},ec94:function(t,e,i){},ecd2:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("w-app-page",{staticClass:"inteledi-shopOrder-details"},[i("w-header",{attrs:{title:t.orderInfoData.sysbillCode,border:!0}}),i("orderInfo",{ref:"orderInfo",attrs:{data:t.orderInfoData,isDisabled:t.isBillState(1)||!t.$fxAuth("shopOrderBill.save"),collapseDisabled:t.itemInputFocusing},on:{"on-shop-click":t.onShopClick,"on-busdate-click":t.onBusinessDateClick,"on-arriveDate-click":t.onArriveDateClick,"on-billType-click":t.onBillTypeClick,"on-orderGoodsPlan-click":t.onOrderGoodsPlanClick,"on-item-clear":t.onItemClear,"on-billType-clear":t.onBillTypeClear}}),i("orderItem",{ref:"orderItem",attrs:{data:t.orderItemList,isDisabled:t.isBillState(1)||!t.$fxAuth("shopOrderBill.save"),itemInputFocusing:t.itemInputFocusing,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,orderPlanId:t.orderInfoData.orderGoodsPlanDTO&&t.orderInfoData.orderGoodsPlanDTO.id,autoType:t.orderInfoData.autoType},on:{"update:itemInputFocusing":function(e){t.itemInputFocusing=e},"update:item-input-focusing":function(e){t.itemInputFocusing=e},"on-add-click":t.onAddClick,"on-search-click":t.onSearchClick,"on-item-edit":t.onItemEdit,"on-item-focus":t.onItemFocus,"on-intellectorder-click":t.onIntellectOrderClick,"on-intellectbasis-click":t.onIntellectBasisClick}}),i("w-bottom-btn-bar",{staticClass:"shopOrder-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillState(0)&&t.$fxAuth("shopOrderBill.del"),expression:"isBillState(0) && $fxAuth('shopOrderBill.del')"}],staticClass:"bottom-btn fx-no-radius fx-btn",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onDeleteClick")}}},[t._v("删除")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopOrderBill.copy"),expression:"$fxAuth('shopOrderBill.copy')"}],staticClass:"bottom-btn fx-no-radius fx-btn",attrs:{type:"primary"},on:{click:function(e){return t.onClickHandler("onCopyClick")}}},[t._v("复制")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillState(0)&&t.$fxAuth("shopOrderBill.check"),expression:"isBillState(0) && $fxAuth('shopOrderBill.check')"}],staticClass:"bottom-btn fx-no-radius fx-btn",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onExpressClick")}}},[t._v("审核")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isReCheckState([0,2])&&t.isBillState(1)&&t.$fxAuth("shopOrderBill.unCheck")&&t.isAssignState(0),expression:"isReCheckState([0, 2]) && isBillState(1) && $fxAuth('shopOrderBill.unCheck') && isAssignState(0)"}],staticClass:"bottom-btn fx-no-radius fx-btn",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onUnExpressClick")}}},[t._v("反审")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillState(0)&&t.$fxAuth("shopOrderBill.save"),expression:"isBillState(0) && $fxAuth('shopOrderBill.save')"}],staticClass:"bottom-btn fx-no-radius fx-btn",attrs:{type:"primary"},on:{click:function(e){return t.onClickHandler("onSaveClick")}}},[t._v("保存")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isReCheckState(0)&&t.isBillState(1)&&t.$fxAuth("shopOrderBill.reCheck"),expression:"isReCheckState(0) && isBillState(1) && $fxAuth('shopOrderBill.reCheck')"}],staticClass:"bottom-btn fx-no-radius fx-btn",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onExpressAgainClick")}}},[t._v("复审")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isReCheckState(1)&&t.isBillState(1)&&t.$fxAuth("shopOrderBill.unReCheck"),expression:"isReCheckState(1) && isBillState(1) && $fxAuth('shopOrderBill.unReCheck')"}],staticClass:"bottom-btn fx-no-radius fx-btn",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onUnExpressAgainClick")}}},[t._v("取消复审")])],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.shopPopShow,callback:function(e){t.shopPopShow=e},expression:"shopPopShow"}},[i("listComp",{attrs:{visibleFlag:t.shopPopShow,data:t.shopList,loadFinished:!0,title:"请选择门店"},on:{"update:visibleFlag":function(e){t.shopPopShow=e},"update:visible-flag":function(e){t.shopPopShow=e},"on-search":t.searchShop,"on-select":t.selectShop}})],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.billTypePopShow,callback:function(e){t.billTypePopShow=e},expression:"billTypePopShow"}},[i("listComp",{attrs:{visibleFlag:t.billTypePopShow,data:t.billTypeList,loadFinished:!0,title:"单据类型检索"},on:{"update:visibleFlag":function(e){t.billTypePopShow=e},"update:visible-flag":function(e){t.billTypePopShow=e},"on-search":t.searchBillType,"on-select":t.selectBillType}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.orderGoodsPlanPopShow,callback:function(e){t.orderGoodsPlanPopShow=e},expression:"orderGoodsPlanPopShow"}},[i("listComp",{attrs:{visibleFlag:t.orderGoodsPlanPopShow,data:t.orderGoodsPlanList,loadFinished:!0,title:"订货方案检索"},on:{"update:visibleFlag":function(e){t.orderGoodsPlanPopShow=e},"update:visible-flag":function(e){t.orderGoodsPlanPopShow=e},"on-search":t.searchOrderGoodsPlan,"on-select":t.selectOrderGoodsPlan}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemStorePopShow,callback:function(e){t.itemStorePopShow=e},expression:"itemStorePopShow"}},[i("storeItemComp",{attrs:{visibleFlag:t.itemStorePopShow,storeItemData:t.storeItem,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,businessDate:t.orderInfoData.businessDate,urgentFlag:t.orderInfoData.urgentFlag,orderPlanId:t.orderInfoData.orderGoodsPlanDTO&&t.orderInfoData.orderGoodsPlanDTO.id},on:{"update:visibleFlag":function(e){t.itemStorePopShow=e},"update:visible-flag":function(e){t.itemStorePopShow=e},"on-save":t.onStoreItemSave}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,isDisabled:t.isBillState(1)||!t.$fxAuth("shopOrderBill.save"),shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.attachListPopShow,callback:function(e){t.attachListPopShow=e},expression:"attachListPopShow"}},[i("attachListPop",{attrs:{attachPopTitle:t.orderInfoData.sysbillCode,data:t.attachList,visibleFlag:t.attachListPopShow},on:{"update:visibleFlag":function(e){t.attachListPopShow=e},"update:visible-flag":function(e){t.attachListPopShow=e},"on-continue-check":t.expressHandler}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemSearchPopShow,callback:function(e){t.itemSearchPopShow=e},expression:"itemSearchPopShow"}},[i("itemSearchPop",{attrs:{visibleFlag:t.itemSearchPopShow,data:t.searchItem,isDisabled:t.isBillState(1)||!t.$fxAuth("shopOrderBill.save")},on:{"update:visibleFlag":function(e){t.itemSearchPopShow=e},"update:visible-flag":function(e){t.itemSearchPopShow=e},"on-search-confirm":t.onSearchConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.intellectOrderPopShow,callback:function(e){t.intellectOrderPopShow=e},expression:"intellectOrderPopShow"}},[i("intellectOrderPop",{attrs:{visibleFlag:t.intellectOrderPopShow,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,orderPlanId:t.orderInfoData.orderGoodsPlanDTO&&t.orderInfoData.orderGoodsPlanDTO.id,urgentFlag:t.orderInfoData.urgentFlag,businessDate:t.orderInfoData.businessDate,arriveDate:t.orderInfoData.arriveDate,orderInfoData:t.orderInfoData},on:{"update:visibleFlag":function(e){t.intellectOrderPopShow=e},"update:visible-flag":function(e){t.intellectOrderPopShow=e},"on-creat-detail":t.onCreatDetail}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.intellectBasisPopShow,callback:function(e){t.intellectBasisPopShow=e},expression:"intellectBasisPopShow"}},[i("intellectBasisPop",{attrs:{visibleFlag:t.intellectBasisPopShow,data:t.intellectBasisData},on:{"update:visibleFlag":function(e){t.intellectBasisPopShow=e},"update:visible-flag":function(e){t.intellectBasisPopShow=e}}})],1)],1)},n=[],o=(i("20d6"),i("5176")),s=i.n(o),r=i("75fc"),l=i("f499"),c=i.n(l),u=(i("7514"),i("b6d0")),d=i.n(u),h=i("774e"),f=i.n(h),m=i("59ad"),p=i.n(m),v=(i("ac6a"),i("795b")),b=i.n(v),g=(i("6762"),i("2fdb"),i("6b54"),i("cebc")),C=i("2f62"),S=i("2bea"),D=i("ad57"),k=i("f6bb"),y=i("d7c3"),w=i("2606"),x=i("f3e4"),I=i("9cca"),P=i("5f1c"),O=i("aedc"),A={name:"shopOrderDetails",components:{orderInfo:S["a"],orderItem:D["a"],listComp:k["a"],storeItemComp:y["a"],itemRowEditPop:w["a"],attachListPop:x["a"],itemSearchPop:I["a"],intellectOrderPop:P["a"],intellectBasisPop:O["a"]},data:function(){return{oldDetails:"",query:this.$route.query,activeNames:["1"],tabActive:"选项1",orderInfoData:{},orderItemList:[],dateType:"business",currentDate:new Date,shopPopShow:!1,shopList:[],datePickerShow:!1,billTypePopShow:!1,billTypeList:[],orderGoodsPlanPopShow:!1,orderGoodsPlanList:[],itemStorePopShow:!1,storeItem:[],itemSearchPopShow:!1,itemRowEditPopShow:!1,itemEditRowData:{},attachListPopShow:!1,attachList:[],itemInputFocusing:!1,orderDeleteFlag:!1,formatterSysPointKey:["busUnitAmount","consultMoney","consultTaxMoney","consultTax"],searchItem:[],intellectOrderPopShow:!1,intellectBasisPopShow:!1,intellectBasisData:null}},created:function(){this.createOrderDetails()},beforeRouteLeave:function(t,e,i){var a=this;if(this.itemInputFocusing)return this.$router.go(1),!1;"/shopOrder"!==t.path||this.orderDeleteFlag||0!==this.orderInfoData.billState?i():this.$dialog.confirm({title:"提示",message:"若已修改,请先保存单据<br/>是否关闭页面?"}).then(function(){i()}).catch(function(){return a.$router.go(1),!1})},computed:Object(g["a"])({},Object(C["c"])({sysPointSize:"sysPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{isBillState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.billState):e.orderInfoData.billState===t}},isReCheckState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.reCheckState):e.orderInfoData.reCheckState===t}},isAssignState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.assignState):e.orderInfoData.assignState===t}}}),methods:{createOrderDetails:function(){var t=this;return new b.a(function(e){t.getOrderDetails().then(function(i){var a=i.shopOrderBills[0];t.formatterSysPoint(a.details),t.orderInfoData=a,t.orderItemList=t.filterStoreItem(a.details),e()})})},getOrderDetails:function(){var t=this;return new b.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shoporders/").concat(t.query.orderId)}).then(function(t){e(t)})})},formatterSysPoint:function(t){var e=this;t.forEach(function(t){e.formatterSysPointKey.forEach(function(i){t[i]=e.toFixedNumberSize(t[i])})})},filterStoreItem:function(t){var e=this;t.forEach(function(t){var i=p()(t.busUnitAmount);i?(t.consultPrice=e.toFixedNumberSize(t.consultMoney/i),t.consultTaxPrice=e.toFixedNumberSize(t.consultMoneyWithTax/i)):(t.consultMoney=0,t.consultMoneyWithTax=0,t.consultPrice=0,t.consultTaxPrice=0)});var i=f()(new d.a(t.map(function(t){return t.houseDTO.id}))),a=i.map(function(e){var i=t.find(function(t){return t.houseDTO.id===e}).houseDTO;return i=JSON.parse(c()(i)),i.details=t.filter(function(t){return t.houseDTO.id===e}),i});return a},toFixedNumberSize:function(t){return p()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},clearItemConfim:function(t){var e=this;return new b.a(function(i){var a=e.orderItemList.filter(function(t){var e=t.details.filter(function(t){return"del"!==t.changeType});return 0!==e.length});0===a.length?i():e.$dialog.confirm({title:"提示",message:t}).then(function(){e.onItemClear(),i()}).catch(function(){})})},onShopClick:function(){this.onShopRefresh()},searchShop:function(t){this.onShopRefresh(t)},selectShop:function(t){var e=this;this.checkShop(t).then(function(){e.clearItemConfim("更换门店会清空品项和订货方案,是否继续?").then(function(){e.orderInfoData.shopDTO=t,e.orderInfoData.orderGoodsPlanDTO={},e.getDistributionRelation().then(function(t){e.orderInfoData.orderGoodsPlanDTO=t.distributionRelations[0].orderGoodsPlan,e.getArrivalDate()}).catch(function(){e.getOrderGoodsPlanListData().then(function(t){t.orderGoodsPlans.length&&(e.orderInfoData.orderGoodsPlanDTO=t.orderGoodsPlans[0],e.getArrivalDate())})})})})},getDistributionRelation:function(){var t=this;return new b.a(function(e,i){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.orderInfoData.shopDTO.id,"/distributionRelation"),autoErrorMsg:!1}).then(function(t){e(t)}).catch(function(t){i(t)})})},checkShop:function(t){var e=this;return new b.a(function(i){var a=e.orderInfoData.shopDTO;a.id!==t.id&&i()})},onShopRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getShopListData(e).then(function(e){t.shopList=e.shops,t.shopPopShow=!0})},getShopListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new b.a(function(i){var a={m:"list4ShopOrderBill4Edit",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/shops"),data:a}).then(function(t){i(t)})})},onBillTypeClick:function(){this.onBillTYpeRefresh()},searchBillType:function(t){this.onBillTYpeRefresh(t)},selectBillType:function(t){this.orderInfoData.businessTypeDTO=t},onBillTypeClear:function(){this.orderInfoData.businessTypeDTO={}},onBillTYpeRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getBillTypeListData(e).then(function(e){t.billTypeList=e.businessTypes,t.billTypePopShow=!0})},getBillTypeListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new b.a(function(i){var a={m:"list4ShopOrderBill",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/businessTypes"),data:a}).then(function(t){i(t)})})},onOrderGoodsPlanClick:function(){if(!this.orderInfoData.shopDTO.id)return this.$fxToast.top("请先选择门店!"),!1;this.orderGoodsPlanRefresh()},searchOrderGoodsPlan:function(t){this.orderGoodsPlanRefresh(t)},selectOrderGoodsPlan:function(t){var e=this;this.checkOrderGoodsPlan(t).then(function(){e.clearItemConfim("更换订货方案会清空品项,是否继续?").then(function(){e.orderInfoData.orderGoodsPlanDTO=t,e.getArrivalDate()})})},checkOrderGoodsPlan:function(t){var e=this;return new b.a(function(i){var a=e.orderInfoData.orderGoodsPlanDTO;a.id!==t.id&&i()})},orderGoodsPlanRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getOrderGoodsPlanListData(e).then(function(e){t.orderGoodsPlanList=e.orderGoodsPlans,t.orderGoodsPlanPopShow=!0})},getOrderGoodsPlanListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new b.a(function(i){var a={keyWord:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.orderInfoData.shopDTO.id,"/users/").concat(t.loginerId,"/orderGoodPlans"),data:a}).then(function(t){i(t)})})},onBusinessDateClick:function(){this.dateType="business",this.orderInfoData.businessDate&&(this.currentDate=new Date(this.orderInfoData.businessDate)),this.datePickerShow=!0},onArriveDateClick:function(){this.dateType="arrive",this.orderInfoData.arriveDate&&(this.currentDate=new Date(this.orderInfoData.arriveDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){var e=this,i=t.getTime();"business"===this.dateType?this.checkBusinessDate2Item(i).then(function(){e.orderInfoData.businessDate=i,e.getArrivalDate()}).catch(function(){e.clearItemConfim("确定要更改业务日期吗?新业务日期不能订货的明细将会被删除!").then(function(){e.orderInfoData.businessDate=i,e.getMBDetailList4ModifyWorkDateURl(),e.getArrivalDate()})}):this.orderInfoData.arriveDate=i,this.datePickerShow=!1},getMBDetailList4ModifyWorkDateURl:function(){var t=this;return new b.a(function(e,i){var a={businessDate:t.orderInfoData.businessDate,id:t.orderInfoData.id};t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.orderInfoData.shopDTO.id,"/shoporders/").concat(t.orderInfoData.id,"/?userId=").concat(t.loginerId),data:a,query:{m:"getMBDetailList4ModifyWorkDate"}}).then(function(i){t.oldDetails=t.orderInfoData.details;var a=i.shopOrderBills[0];a.details.forEach(function(t){t.changeType="add"}),t.formatterSysPoint(a.details),t.orderInfoData=a,t.orderItemList=t.filterStoreItem(a.details),e()}).catch(function(t){console.log(t),i(t)})})},MBDetailList4ModifyWorkDate:function(){var t={businessDate:this.orderInfoData.businessDate,id:this.orderInfoData.id};return this.$fxApi("shopOrderBill.getMBDetailList4ModifyWorkDate")({data:t})},getShopOrderBillDetailDTO:function(){var t=this.getValidItem(),e=f()(new d.a(t.map(function(t){return t.goodsDTO.id})));return e.map(function(t){return{goodsDTO:{id:t}}})},checkBusinessDate2Item:function(t){var e=this;return new b.a(function(i,a){if(0===e.getItemLength())i();else{var n={businessDate:t,urgentFlag:e.orderInfoData.urgentFlag,details:e.getShopOrderBillDetailDTO(),orderGoodsPlanDTO:e.orderInfoData.orderGoodsPlanDTO};e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.orderInfoData.shopDTO.id,"/users/").concat(e.loginerId,"/shoporderdetails"),data:n,query:{m:"validBill"},autoErrorMsg:!1}).then(function(t){i()}).catch(function(t){"ShopOrderBillDetailDTO"===t.entity?a(t):e.$dialog.alert({title:"提示",message:t.message}).then(function(){i()})})}})},getArrivalDate:function(){var t=this;if(!this.orderInfoData.orderGoodsPlanDTO.id)return!1;var e={businessDateStart:this.$fxUtils.setDateTime(new Date(this.orderInfoData.businessDate),"时分"),shopId:this.orderInfoData.shopDTO.id};return this.$fxApi("shopOrderBill.getArrivalDate",this.orderInfoData.orderGoodsPlanDTO.id)({data:e}).then(function(e){t.orderInfoData.arriveDate=e,t.$fxToast.top("到货日期已按订货方案中设置的到货间隔日期重置到货日期默认值")})},onAddClick:function(){var t=this;this.checkOrderInfo().then(function(){t.storeItem=JSON.parse(c()(t.orderItemList)),t.itemStorePopShow=!0})},checkOrderInfo:function(){var t=this;return new b.a(function(e,i){t.orderInfoData.businessDate?t.$fxUtils.isEmptyObjSHW(t.orderInfoData.orderGoodsPlanDTO)?t.$toast.fail("请先选择订货方案!"):t.orderInfoData.arriveDate?e():t.$toast.fail("请先选择到货日期!"):t.$toast.fail("请先选择业务日期!")})},onIntellectOrderClick:function(){var t=this;this.checkOrderInfo().then(function(){t.clearItemConfim("智能订货会清空品项,是否继续?").then(function(){t.intellectOrderPopShow=!0})})},onIntellectBasisClick:function(){var t=this;2===this.orderInfoData.autoType&&this.getIntellectBasis().then(function(e){t.intellectBasisPopShow=!0,t.intellectBasisData=e.basis[0]})},getIntellectBasis:function(){var t=this;return new b.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shoporders/orderId/").concat(t.orderInfoData.id)}).then(function(t){e(t)})})},onSearchClick:function(){this.itemSearchPopShow=!0,this.searchItem=JSON.parse(c()(this.orderItemList))},onStoreItemSave:function(t){this.orderItemList=t},onSaveClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要保存该单据吗?"}).then(function(){t.checkHasDetails().then(function(){t.saveHandler().then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success(e.message)})})})}).catch(function(){})},saveHandler:function(){var t=this;return new b.a(function(e){var i=t.getSaveParams();t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shoporders/").concat(t.query.orderId),data:i,query:{userId:t.loginerId,m:"modify"}}).then(function(t){e(t)})})},onExpressClick:function(){var t=this;this.checkHasDetails().then(function(){t.$fxAuth("shopOrderBill.attachFlag")&&t.$fxSysAuth("shopOrderBill.sysOrderGoodsAttachPlan")&&"0"===t.orderInfoData.attachFlag?t.saveHandler().then(function(){t.createOrderDetails().then(function(){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.orderInfoData.shopDTO.id,"/shoporders/assistantGoods/").concat(t.orderInfoData.id,"/orderPlanId/").concat(t.orderInfoData.orderGoodsPlanDTO.id)}).then(function(e){e.shopOrderBillDetails.length?(t.attachListPopShow=!0,t.attachList=[{sysbillCode:t.orderInfoData.sysbillCode,details:e.shopOrderBillDetails}]):t.$dialog.confirm({title:"提示",message:"无可导入的附属明细，确定要审核该单据吗？"}).then(function(){t.expressHandler()})})})}):t.$dialog.confirm({title:"提示",message:"确定要审核该单据吗?"}).then(function(){t.expressHandler()})})},expressHandler:function(){var t=this;this.checkHasDetails().then(function(){var e=t.getSaveParams();t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shoporders/").concat(t.query.orderId),data:e,query:{userId:t.loginerId,m:"editAndCheck"}}).then(function(e){t.createOrderDetails().then(function(){t.$dialog.alert({title:"提示",message:e.message})})}).catch(function(e){"1"===e.errorCode&&t.createOrderDetails()})})},onUnExpressClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要反审该单据吗?"}).then(function(){t.checkHasDetails().then(function(){var e=t.getSaveParams();t.unExpressHandler(e)})}).catch(function(){})},unExpressHandler:function(t){var e=this;this.$fxHttp.requestPut({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/shoporders/").concat(this.query.orderId),data:t,query:{userId:this.loginerId,m:"unCheck"}}).then(function(t){e.createOrderDetails().then(function(){e.$fxToast.success("反审成功")})})},onCopyClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要复制该单据吗?"}).then(function(){t.checkHasDetails().then(function(){var e=t.getSaveParams();t.copyHandler(e)})}).catch(function(){})},copyHandler:function(t){var e=this;this.$fxHttp.requestPut({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/shoporders/").concat(this.query.orderId),data:t,query:{userId:this.loginerId,m:"copy"}}).then(function(t){e.createOrderDetails().then(function(){e.$fxToast.success("复制成功")})})},onDeleteClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要删除该单据吗?"}).then(function(){var e=t.getSaveParams();t.$fxHttp.requestDel({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shoporders/").concat(t.query.orderId),data:e,query:{userId:t.loginerId}}).then(function(e){t.$fxToast.success({message:"删除成功",mask:!0}).then(function(){t.orderDeleteFlag=!0,t.$router.go(-1)})})}).catch(function(){})},getSaveParams:function(){var t=[],e=[],i=[],a=this.oldDetails;this.orderItemList.forEach(function(e){t.push.apply(t,Object(r["a"])(e.details))}),a.length>0&&(i=a.filter(function(t){return"del"===t.changeType}));var n=t.filter(function(t){return"add"===t.changeType}),o=t.filter(function(t){return"del"===t.changeType}),l=t.filter(function(t){return"edit"===t.changeType});e=o.length>0?o:i.length>0?i:null;var c=s()({},this.orderInfoData,{detailAdd:n.length>0?n:null,detailDel:e,detailMdf:l.length>0?l:null,details:[]});return c},getValidItem:function(){var t=[];return this.orderItemList.forEach(function(e){t.push.apply(t,Object(r["a"])(e.details))}),t.filter(function(t){return"del"!==t.changeType})},getItemLength:function(){return this.getValidItem().length},checkHasDetails:function(){var t=this;return new b.a(function(e){0===t.getItemLength()?t.$fxToast.fail("单据明细不能为空"):e()})},onItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this.orderItemList.findIndex(function(e){return e.id===t.houseDTO.id});if(~e){var i=this.orderItemList[e].details.findIndex(function(e){return e.goodsDTO.id===t.goodsDTO.id});~i&&(this.orderItemList[e].details[i]=t)}},onExpressAgainClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要复审该单据吗?"}).then(function(){var e=t.getSaveParams();t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shoporders/").concat(t.query.orderId),data:e,query:{userId:t.loginerId,m:"reCheck"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("复审成功")})})}).catch(function(){})},onUnExpressAgainClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要取消复审该单据吗?"}).then(function(){var e=t.getSaveParams();t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shoporders/").concat(t.query.orderId),data:e,query:{userId:t.loginerId,m:"unReCheck"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("取消复审成功")})})}).catch(function(){})},onItemClear:function(){var t=this.orderInfoData.details.filter(function(t){return!!t.id});t.forEach(function(t){t.changeType="del"}),this.orderInfoData.details=t,this.orderItemList=this.filterStoreItem(t)},onItemFocus:function(){this.$refs.orderInfo.closeCollapse()},onClickHandler:function(t){if(this.itemInputFocusing)return!1;this[t]()},onSearchConfirm:function(t){this.orderItemList=t},onPayClick:function(){this.$fxPay({payTypes:["alipay"],payer:"这是收款方",payee:"这是付款方",money:"200.10"}).then(function(){})},onCreatDetail:function(){var t=this;this.createOrderDetails().then(function(){t.$fxToast.success("成功！")})}}},T=A,$=(i("ac76"),i("2877")),B=Object($["a"])(T,a,n,!1,null,"6b3e0f3a",null);e["default"]=B.exports},f175:function(t,e,i){"use strict";var a=i("be58"),n=i.n(a);n.a},f39d:function(t,e,i){},f3e4:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-wrap"},[i("w-header",{attrs:{title:t.attachPopTitle,leftOptions:t.leftOptions,titleFontSize:"3.733vw",border:!0},on:{"on-click-back":t.onCloseClick}}),i("div",{staticClass:"order-item-block fx-shadow-block"},[t._m(0),i("div",{ref:"details-content",staticClass:"item-list"},t._l(t.data,function(e){return i("div",{key:e.sysbillCode,staticClass:"item-row"},[i("div",{staticClass:"item-info-title fx-ellipsis"},[t._v(t._s(e.sysbillCode))]),t._l(e.details,function(e){return i("div",{key:e.goodsDTO.id,staticClass:"item-info-cell"},[i("div",{staticClass:"item-img"},[i("img",{attrs:{src:t.comptedItemImgSrc(e.goodsDTO.imageUrls||[]),onerror:t.$fxCommon.errorImg("item")}})]),i("div",{staticClass:"item-details"},[i("div",{staticClass:"item-name fx-ellipsis"},[t._v(t._s(e.goodsDTO.name))]),i("div",{staticClass:"details-cell"},[i("div",{staticClass:"item-spec fx-ellipsis"},[t._v("\n\t\t\t\t\t\t\t\t"+t._s(t.$fxAuth("shopOrderBill.goodsSize")?e.goodsDTO.spec:"")+"\n\t\t\t\t\t\t\t")])]),i("div",{staticClass:"details-cell"},[i("div",{staticClass:"item-store fx-ellipsis"},[t._v(t._s(e.houseDTO.name))]),i("div",{staticClass:"item-amount"},[i("span",[t._v(t._s(e.busUnitAmount))]),i("span",{staticClass:"fx-ellipsis"},[t._v(t._s(e.unitDTO.name))])])])])])})],2)}),0)]),i("div",{staticClass:"order-bottom"},[i("van-button",{staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:t.onCloseClick}},[t._v("取消")]),i("van-button",{staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:t.onCheckClick}},[t._v("继续审核")])],1)],1)},n=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-title"},[i("span",{staticClass:"title-name"},[t._v("附属明细")])])}],o={name:"orderItem",props:{data:{type:Array,default:function(){return[]}},attachPopTitle:String,visibleFlag:Boolean},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0}}},computed:{comptedItemImgSrc:function(t){return function(t){return 0===t.length?"":t[0]}}},methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onCheckClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要审核所选单据?"}).then(function(){t.$emit("update:visibleFlag",!1),t.$emit("on-continue-check")})}}},s=o,r=(i("10dd"),i("2877")),l=Object(r["a"])(s,a,n,!1,null,"d52c9a4a",null);e["a"]=l.exports},fa97:function(t,e,i){"use strict";var a=i("f39d"),n=i.n(a);n.a},fb49:function(t,e,i){"use strict";var a=i("5311"),n=i.n(a);n.a},fb55:function(t,e,i){},fc00:function(t,e,i){},fc41:function(t,e,i){"use strict";var a=i("2741"),n=i.n(a);n.a},fd54:function(t,e,i){},fe23:function(t,e,i){"use strict";var a=i("d723"),n=i.n(a);n.a},fedf:function(t,e,i){}}]);
//# sourceMappingURL=shopOrder.f452663a.js.map