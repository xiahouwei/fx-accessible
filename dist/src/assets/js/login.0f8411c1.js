(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["login"],{"033a":function(e,s,t){"use strict";t.r(s);var n=function(){var e=this,s=e.$createElement,n=e._self._c||s;return n("w-app-page",{staticClass:"inteledi-login"},[n("div",{staticClass:"login-container"},[n("div",{staticClass:"login-welcome clearfix"},[n("div",{staticClass:"welcome-text fl-l"},[e._v("欢迎您使用"+e._s(e.appSubjectName)+"！")]),n("img",{staticClass:"welcome-login fl-r",attrs:{src:t("0673"),alt:""}})]),n("div",{staticClass:"login-form"},[n("van-cell-group",{staticClass:"login-cell-group",attrs:{border:!1}},[n("van-field",{ref:"netAddress",staticClass:"login-cell",attrs:{placeholder:"请输入网址","error-message":e.errorMessage.netAddress},nativeOn:{keyup:function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"enter",13,s.key,"Enter")?null:e.onKeyupInput("netAddress")}},model:{value:e.netAddress,callback:function(s){e.netAddress=s},expression:"netAddress"}},[n("img",{staticClass:"login-cell-icon",attrs:{slot:"left-icon",src:t("a1fe")},slot:"left-icon"}),n("van-icon",{directives:[{name:"show",rawName:"v-show",value:e.netAddressClearBtnVisible,expression:"netAddressClearBtnVisible"}],staticClass:"login-cell-right-icon",attrs:{slot:"right-icon",name:"close"},on:{click:e.netAddressClear},slot:"right-icon"})],1),n("van-field",{ref:"urserName",staticClass:"login-cell",attrs:{placeholder:"请输入账号",autocomplete:"off","error-message":e.errorMessage.urserName},nativeOn:{keyup:function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"enter",13,s.key,"Enter")?null:e.onKeyupInput("urserName")}},model:{value:e.urserName,callback:function(s){e.urserName=s},expression:"urserName"}},[n("img",{staticClass:"login-cell-icon",attrs:{slot:"left-icon",src:t("c3cd")},slot:"left-icon"})]),n("van-field",{ref:"password",staticClass:"login-cell",attrs:{placeholder:"请输入密码",type:e.passwordType,"error-message":e.errorMessage.password},nativeOn:{keyup:function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"enter",13,s.key,"Enter")?null:e.onKeyupInput("password")}},model:{value:e.password,callback:function(s){e.password=s},expression:"password"}},[n("img",{staticClass:"login-cell-icon",attrs:{slot:"left-icon",src:t("ef30")},slot:"left-icon"}),n("van-icon",{staticClass:"login-cell-right-icon",attrs:{slot:"right-icon",name:e.passwordWatchBtn},on:{click:e.passwordWatchClick},slot:"right-icon"})],1)],1),n("van-button",{staticClass:"login-btn",attrs:{type:"primary",round:""},on:{click:e.loginHanle}},[e._v("登录")])],1)]),n("div",{staticClass:"login-bottom"},[n("div",{staticClass:"version"},[e._v("version:"+e._s(e.appSubjectVersion))])])])},o=[],r=(t("7f7f"),t("795b")),i=t.n(r),a=t("cebc"),c=t("2f62"),l=t("58ab"),u={name:"login",mixins:[l["a"]],data:function(){return{formFieldRef:["netAddress","urserName","password"],netAddress:"",urserName:"",password:"",errorMessage:{netAddress:"",urserName:"",password:""},showPassword:!1}},computed:Object(a["a"])({},Object(c["c"])({netAddressX:"netAddressX",urserNameX:"urserNameX",appSubjectName:function(e){return e.appSubject.appSubjectName},appSubjectNetAddress:function(e){return e.appSubject.appSubjectNetAddress},appSubjectVersion:function(e){return e.appSubject.appSubjectVersion},loginerUuid:function(e){return e.loginer.loginerUuid}}),{netAddressClearBtnVisible:function(){return!!this.netAddress},passwordWatchBtn:function(){return this.showPassword?"eye-o":"closed-eye"},passwordType:function(){return this.showPassword?"text":"password"}}),created:function(){this.netAddress=this.netAddressX||this.appSubjectNetAddress,this.urserName=this.urserNameX},mounted:function(){this.silentLogin()},methods:{onKeyupInput:function(e){var s=this;this.$fxCommon.inputAutoFocusMoblie.apply(this,[e,this.formFieldRef]).then(function(){s.loginHanle()})},silentLogin:function(){var e=this;this.$nextTick(function(){e.$fxUtils.appTypeCheck(["z5"]).then(e.silentLoginHandler)})},silentLoginHandler:function(){var e=this;this.netAddress&&this.loginerUuid&&(this.$store.commit({type:"SETSTATE",netAddressX:this.netAddress}),this.$fxApi("common.silentLogin").then(this.loginSuccessHandler).catch(function(){e.$fxCordova.jpushCleanAlias()}))},loginHanle:function(){var e=this;this.validate().then(function(s){s&&e.loginPost()})},loginPost:function(){this.$store.commit({type:"SETSTATE",netAddressX:this.netAddress});var e={username:this.urserName,password:this.password};this.$fxApi("common.login")({data:e}).then(this.handLoginSuccess).then(this.loginSuccessHandler)},handLoginSuccess:function(e){return this.$store.commit({type:"SET_LOGINER",loginerPassword:this.password}),i.a.resolve(e)},loginSuccessHandler:function(e){var s=this,t=e.accounts[0];this.$store.commit({type:"SET_STATE_LOCAL",netAddressX:this.netAddress,urserNameX:this.urserName}),this.$store.commit({type:"SET_LOGINER",loginerCode:t.code,loginerId:t.id,loginFlag:t.loginFlag,loginerName:t.name,loginerUserName:t.username,loginerUuid:t.uuid,loginerOrganType:t.organType,loginerShopId:t.shopId,loginerShopName:t.shopName}),"admin"!==this.urserName&&this.$fxCordova.jpushSetAlias(t.id),this.syncAuth().then(function(){s.$router.push("/main/home")})},validate:function(){var e=this;return new i.a(function(s){e.clearValidate();var t=!0;""===e.urserName&&(e.errorMessage.urserName="请输入账号",t=!1),""===e.netAddress&&(e.errorMessage.netAddress="请输入网址",t=!1),""===e.password&&(e.errorMessage.password="请输入密码",t=!1),s(t)})},clearValidate:function(){for(var e in this.errorMessage)this.errorMessage[e]=""},netAddressClear:function(){this.netAddress=""},passwordWatchClick:function(){this.showPassword=!this.showPassword}}},d=u,p=(t("3912"),t("2877")),h=Object(p["a"])(d,n,o,!1,null,"4b3c29aa",null);s["default"]=h.exports},"0673":function(e,s,t){e.exports=t.p+"src/assets/img/logo-login.58f8d58a.png"},"2da6":function(e,s,t){},3912:function(e,s,t){"use strict";var n=t("2da6"),o=t.n(n);o.a},"58ab":function(e,s,t){"use strict";var n=t("a4bb"),o=t.n(n),r=(t("ac6a"),t("795b")),i=t.n(r),a=t("cebc"),c=t("2f62");s["a"]={computed:Object(a["a"])({},Object(c["c"])({loginerShopId:function(e){return e.loginer.loginerShopId},loginerId:function(e){return e.loginer.loginerId}})),methods:{getAuth:function(){var e=this;return new i.a(function(s){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/users/").concat(e.loginerId,"/function"),loading:!1}).then(function(e){s(e.functionMapData[0])})})},syncAuth:function(){var e=this;return this.getAuth().then(function(s){return e.commitAuth(s),i.a.resolve(s)})},commitAuth:function(e){var s=this.$fxAuthModule.fxAuthInit(e),t=this.$fxAuthModule.fxSysAuthInit(e),n=this.$fxAuthModule.fxReportFormAuthInit(e);this.$store.commit({type:"SET_AUTH_LOCAL_JSON",billAuth:s,billSysAuth:t,reportFormAuth:n}),console.log(s),console.log(t),console.log(n),this.getAuthHaveSysParam(e)},getAuthHaveSysParam:function(e){var s={};o()(e).forEach(function(t){var n=e[t];s[t]={},n.forEach(function(e){s[t][e.functionCode]=e})}),console.log("包含系统参数的权限:"),console.log(s)}}}},a1fe:function(e,s,t){e.exports=t.p+"src/assets/img/icon-netname.c4b6184e.png"},c3cd:function(e,s,t){e.exports=t.p+"src/assets/img/icon-ursename.17a1193a.png"},ef30:function(e,s,t){e.exports=t.p+"src/assets/img/icon-password.cce5a51f.png"}}]);
//# sourceMappingURL=login.0f8411c1.js.map