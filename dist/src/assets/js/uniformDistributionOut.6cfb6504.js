(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["uniformDistributionOut"],{"01f7":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"details-content",staticClass:"item-details-content"},[i("van-list",{attrs:{finished:t.loadFinished,"finished-text":"没有更多了",error:t.listError,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.listError=e},load:t.onLoadMore},model:{value:t.currentListLoading,callback:function(e){t.currentListLoading=e},expression:"currentListLoading"}},t._l(t.itemList,function(e,o){return i("div",{key:e.goodsDTO.id,ref:"details-row-"+o,refInFor:!0,staticClass:"item-detail"},[t._t("item-cell",null,{$item:e,$index:o})],2)}),0)],1)},n=[],s=i("795b"),a=i.n(s),r=(i("c5f6"),{name:"addItemList",props:{value:[String,Number],itemList:{type:Array,default:function(){return[]}},listLoading:Boolean,loadFinished:Boolean,listError:{type:Boolean,default:!1}},data:function(){return{currentListLoading:!1}},watch:{listLoading:{handler:function(t){this.currentListLoading=t},immediate:!0},currentListLoading:function(t){this.$emit("update:listLoading",t)}},computed:{comptedItemImgSrc:function(t){return function(t){return 0===t.length?"":t[0]}}},methods:{onLoadMore:function(){this.$emit("on-load-more")},onSelectLetter:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40,i=this.$refs["details-row-".concat(t)];if(!i||0===i.length)return!1;var o=i[0].offsetTop,n=this.$refs["details-content"];this.$fxUtils.scrollTopW({offsetTop:o,$el:n,distance:e})},prev:function(t){var e=this;return new a.a(function(i){if(0===t)return!1;var o=t-1,n=e.itemList[o];e.onSelectLetter(o),i({data:n,index:o})})},next:function(t){var e=this;return new a.a(function(i){if(t===e.itemList.length-1)return!1;var o=t+1,n=e.itemList[o];e.onSelectLetter(o),i({data:n,index:o})})}}}),c=r,l=(i("2f8b"),i("2877")),u=Object(l["a"])(c,o,n,!1,null,"7690e6e7",null);e["a"]=u.exports},"060f":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"itemRowEdit-popup"},[i("w-header",{attrs:{title:t.currentItemData.goodsDTO.name,leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{ref:"rowEditContent",staticClass:"itemRowEdit-content"},[i("van-cell-group",[i("van-cell",{attrs:{title:"品项类型",value:t.currentItemData.goodsDTO.styleName,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"规格",value:t.currentItemData.goodsDTO.spec,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"订货数量",value:t.currentItemData.outOrderAmount,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionOutBill.seeNoTaxMoney"),expression:"$fxAuth('distributionOutBill.seeNoTaxMoney')"}],attrs:{value:t.currentItemData.sendMoney,title:"非税金额","value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionOutBill.seeTax"),expression:"$fxAuth('distributionOutBill.seeTax')"}],attrs:{title:"税率",value:t.fomatterTaxes(t.currentItemData.sendTaxes),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionOutBill.seeTaxMoney"),expression:"$fxAuth('distributionOutBill.seeTaxMoney')"}],attrs:{title:"税额",value:t.currentItemData.sendTaxMoney,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionOutBill.costPrice"),expression:"$fxAuth('distributionOutBill.costPrice')"}],attrs:{value:t.currentItemData.costPrice,title:"成本单价","value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionOutBill.costMoney"),expression:"$fxAuth('distributionOutBill.costMoney')"}],attrs:{value:t.currentItemData.outMoney,title:"成本金额","value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"品项编号",value:t.currentItemData.goodsDTO.code,"value-class":"info-item-value"}}),i("van-switch-cell",{staticClass:"info-item-value",attrs:{disabled:t.isDisabled,title:"赠送"},on:{change:t.changeGiftFlag},model:{value:t.currentItemData.giftFlag,callback:function(e){t.$set(t.currentItemData,"giftFlag",e)},expression:"currentItemData.giftFlag"}}),i("van-cell",{attrs:{title:"批次号",value:t.currentItemData.batchCode,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"生产日期",value:t.fomatterDate(t.currentItemData.productDate)}}),i("van-pro-field",{ref:"memo",attrs:{placeholder:t.setPlaceholder("请输入备注"),disabled:t.isDisabled,label:"备注","value-class":"info-item-value","input-align":"right"},on:{focus:function(e){return t.onFocus("memo")}},model:{value:t.currentItemData.memo,callback:function(e){t.$set(t.currentItemData,"memo",e)},expression:"currentItemData.memo"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"净重量",value:t.toFixedNumberSize(t.currentItemData.netWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"皮重量",value:t.toFixedNumberSize(t.currentItemData.skinWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"毛重量",value:t.toFixedNumberSize(t.currentItemData.grossWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"称重单位",value:t.currentItemData.weightUnit,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"称重状态",value:t.currentItemData.isWeightSign?"已称重":"未称重","value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"图片",border:!1,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData&&t.currentItemData.images.length,expression:"sysShowDZCData && currentItemData.images.length"}],staticClass:"info-cell-img",attrs:{"value-class":"info-item-img"}},[i("img",{attrs:{src:t.comptedItemImgSrc(t.currentItemData.images)}})])],1)],1),i("div",{staticClass:"itemRowEdit-bottom"},[t.isDisabled?t._e():i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onConfirmClick}},[t._v("保存")])],1)],1)},n=[],s=i("59ad"),a=i.n(s),r=i("f499"),c=i.n(r),l=i("cebc"),u=i("2f62"),d={name:"itemRowEdit",props:{visibleFlag:Boolean,itemData:{type:Object,default:function(){return{}}},isDisabled:Boolean},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},currentItemData:{},currentDate:new Date}},computed:Object(l["a"])({},Object(u["c"])({sysPointSize:"sysPointSize",sysMoneyPointSize:"sysMoneyPointSize",numberLength:"numberLength",maxAmount:"maxAmount",sysShowDZCData:function(t){return t.systemParams.sysShowDZCData},loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{fomatterTaxes:function(t){var e=this;return function(t){if(t){var i=e.$fxUtils.toFixedSHW(100*t,2,!1);return"".concat(i,"%")}return"0%"}},fomatterDate:function(t){var e=this;return function(t){return t?e.$fxUtils.setDateTime(new Date(t),"时分"):""}},setPlaceholder:function(t){var e=this;return function(t){return e.isDisabled?"":t}},comptedItemImgSrc:function(t){return function(t){return t?0===t.length?"":t[0].imagUrl:""}}}),watch:{visibleFlag:{handler:function(t){t&&(this.currentItemData=JSON.parse(c()(this.itemData)))},immediate:!0}},methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onConfirmClick:function(){this.currentItemData.id&&(this.currentItemData.changeType="edit"),this.$emit("on-Confirm",this.currentItemData),this.$emit("update:visibleFlag",!1)},calcMoney:function(t,e,i){var o=i.taxPrice,n=i.busUnitOutAmount,s=i.price,a=i.sendTaxes,r=0,c=0,l=0,u=0,d=this.toFixedNumberSize(e);if(i.giftFlag||"money"===t&&0===d)return i.sendMoney=0,i.sendMoneyWithTax=0,i.sendTaxMoney=0,!0;"money"===t?(r=d,l=this.toFixedNumberSize(r/n),c=this.toFixedNumberSize(r*(1+a)),u=this.toFixedNumberSize(c/n)):"amount"===t?(i.busUnitOutAmount=this.toFixedNumberSize(e,this.sysPointSize),l=s,u=o,r=this.toFixedNumberSize(s*d),c=this.toFixedNumberSize(o*d)):"moneyWithTax"===t?(c=d,u=this.toFixedNumberSize(c/n),r=this.toFixedNumberSize(c/(1+a)),l=this.toFixedNumberSize(r/n)):"taxPrice"===t?(u=d,c=this.toFixedNumberSize(n*u),l=this.toFixedNumberSize(u/(1+a)),r=this.toFixedNumberSize(l*n)):"price"===t&&(l=d,r=this.toFixedNumberSize(l*n),u=this.toFixedNumberSize(l*(1+a)),c=this.toFixedNumberSize(n*u)),i.sendMoney=r,i.sendMoneyWithTax=c,i.sendTaxMoney=this.toFixedNumberSize(this.toFixedNumberSize(c)-this.toFixedNumberSize(r)),i.price=l,i.taxPrice=u},toFixedNumberSize:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sysMoneyPointSize;return a()(this.$fxUtils.toFixedSHW(t,e))},changeGiftFlag:function(){this.currentItemData.giftFlag?(this.currentItemData.sendMoney=0,this.currentItemData.sendMoneyWithTax=0,this.currentItemData.sendTaxMoney=0):this.calcMoney("price",this.currentItemData.price,this.currentItemData)},onFocus:function(t){this.onScrollTop(t)},onScrollTop:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,i=this.$refs[t];if(!i||0===i.length)return!1;var o=i.$el.offsetTop,n=this.$refs["rowEditContent"];this.$fxUtils.scrollTopW({offsetTop:o,$el:n,distance:e})}}},h=d,f=(i("f007"),i("2877")),m=Object(f["a"])(h,o,n,!1,null,"2f33dd4e",null);e["a"]=m.exports},"0ea3":function(t,e,i){"use strict";var o=i("fb8c"),n=i.n(o);n.a},"1af4":function(t,e,i){},"1c3f":function(t,e,i){"use strict";var o=i("1af4"),n=i.n(o);n.a},2209:function(t,e,i){"use strict";var o=i("5c5e"),n=i.n(o);n.a},"22bf":function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-uniformDistributionOut-create"},[i("w-header",{attrs:{title:"新增统配出库单",border:!0}}),i("orderInfo",{ref:"orderInfo",attrs:{data:t.orderInfoData,collapseDisabled:t.itemInputFocusing},on:{"on-shop-click":t.onInShopClick,"on-rdc-click":t.onRdcClick,"on-busdate-click":t.onBusinessDateClick,"on-arriveDate-click":t.onArriveDateClick,"on-billType-click":t.onBillTypeClick,"on-item-clear":t.onItemClear,"on-billType-clear":t.onBillTypeClear}}),i("orderItem",{attrs:{data:t.orderItemList,itemInputFocusing:t.itemInputFocusing,inShopId:t.orderInfoData.inShopDTO&&t.orderInfoData.inShopDTO.id,rdcId:t.orderInfoData.rdcDTO&&t.orderInfoData.rdcDTO.id},on:{"update:itemInputFocusing":function(e){t.itemInputFocusing=e},"update:item-input-focusing":function(e){t.itemInputFocusing=e},"on-add-click":t.onAddClick,"on-search-click":t.onSearchClick,"on-item-edit":t.onItemEdit,"on-unit-edit":t.onUnitEdit,"on-item-focus":t.onItemFocus}}),i("div",{staticClass:"uniformDistributionOut-bottom"},[i("van-button",{staticClass:"add-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onCreateClick}},[t._v("生成单据")])],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.rdcPopShow,callback:function(e){t.rdcPopShow=e},expression:"rdcPopShow"}},[i("listComp",{attrs:{visibleFlag:t.rdcPopShow,data:t.rdcList,loadFinished:!0,title:"请选择配送中心"},on:{"update:visibleFlag":function(e){t.rdcPopShow=e},"update:visible-flag":function(e){t.rdcPopShow=e},"on-search":t.searchRdc,"on-select":t.selectRdc}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.inShopPopShow,callback:function(e){t.inShopPopShow=e},expression:"inShopPopShow"}},[i("listComp",{attrs:{visibleFlag:t.inShopPopShow,data:t.inShopList,loadFinished:!0,title:"请选择门店"},on:{"update:visibleFlag":function(e){t.inShopPopShow=e},"update:visible-flag":function(e){t.inShopPopShow=e},"on-search":t.searchInShop,"on-select":t.selectInShop}})],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.billTypePopShow,callback:function(e){t.billTypePopShow=e},expression:"billTypePopShow"}},[i("listComp",{attrs:{visibleFlag:t.billTypePopShow,data:t.billTypeList,loadFinished:!0,title:"单据类型检索"},on:{"update:visibleFlag":function(e){t.billTypePopShow=e},"update:visible-flag":function(e){t.billTypePopShow=e},"on-search":t.searchBillType,"on-select":t.selectBillType}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemStorePopShow,callback:function(e){t.itemStorePopShow=e},expression:"itemStorePopShow"}},[i("storeItemComp",{attrs:{visibleFlag:t.itemStorePopShow,storeItemData:t.storeItem,inShopId:t.orderInfoData.inShopDTO&&t.orderInfoData.inShopDTO.id,rdcId:t.orderInfoData.rdcDTO&&t.orderInfoData.rdcDTO.id,businessDate:t.orderInfoData.businessDate},on:{"update:visibleFlag":function(e){t.itemStorePopShow=e},"update:visible-flag":function(e){t.itemStorePopShow=e},"on-save":t.onStoreItemSave,"on-select-store":t.onStoreItemSelect}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemPopShow,callback:function(e){t.itemPopShow=e},expression:"itemPopShow"}},[i("itemEditComp",{attrs:{visibleFlag:t.itemPopShow,inShopId:t.orderInfoData.inShopDTO&&t.orderInfoData.inShopDTO.id,rdcId:t.orderInfoData.rdcDTO&&t.orderInfoData.rdcDTO.id,shopHouseDTO:t.currentShopHouseObj,outHouse:t.currentOutHouseObj,businessDate:t.orderInfoData.businessDate,parentStoreItem:t.getStoreItem()},on:{"update:visibleFlag":function(e){t.itemPopShow=e},"update:visible-flag":function(e){t.itemPopShow=e},"on-confirm":t.onItemEditConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemSearchPopShow,callback:function(e){t.itemSearchPopShow=e},expression:"itemSearchPopShow"}},[i("itemSearchPop",{attrs:{visibleFlag:t.itemSearchPopShow,data:t.searchItem,rdcId:t.orderInfoData.rdcDTO&&t.orderInfoData.rdcDTO.id,inShopId:t.orderInfoData.inShopDTO&&t.orderInfoData.inShopDTO.id,isDisabled:!t.$fxAuth("distributionOutBill.save")},on:{"update:visibleFlag":function(e){t.itemSearchPopShow=e},"update:visible-flag":function(e){t.itemSearchPopShow=e},"on-search-confirm":t.onSearchConfirm}})],1)],1)},n=[],s=i("768b"),a=(i("7514"),i("20d6"),i("59ad")),r=i.n(a),c=i("5176"),l=i.n(c),u=i("75fc"),d=(i("ac6a"),i("a481"),i("f499")),h=i.n(d),f=i("795b"),m=i.n(f),p=i("cebc"),v=i("2f62"),b=i("463e2"),S=i("415d"),g=i("f6bb"),D=i("9cfb"),x=i("060f"),y=i("f330"),C=i("4e92"),w={name:"createUniformDistributionOut",components:{orderInfo:b["a"],orderItem:S["a"],listComp:g["a"],storeItemComp:D["a"],itemRowEditPop:x["a"],itemSearchPop:y["a"],itemEditComp:C["a"]},data:function(){return{query:this.$route.query,activeNames:["1"],tabActive:"选项1",orderInfoData:{accountDTO:{},arriveDate:(new Date).getTime(),billEmp:"",billMemo:"",billState:0,businessDate:(new Date).getTime(),businessTypeDTO:{},inShopDTO:{},rdcDTO:{},details:[],updateIndicator:"Append",expressFlag:!1},orderItemList:[],dateType:"business",currentDate:new Date,inShopPopShow:!1,inShopList:[],rdcPopShow:!1,rdcList:[],datePickerShow:!1,billTypePopShow:!1,billTypeList:[],itemStorePopShow:!1,storeItem:[],unitActions:[],unitActionShow:!1,itemRowEditPopShow:!1,itemEditRowData:{},itemInputFocusing:!1,itemSearchPopShow:!1,searchItem:[],currentShopHouseObj:{},currentOutHouseObj:{},itemPopShow:!1}},computed:Object(p["a"])({},Object(v["c"])({sysPointSize:"sysPointSize",sysMoneyPointSize:"sysMoneyPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerShopName:function(t){return t.loginer.loginerShopName},loginerOrganType:function(t){return t.loginer.loginerOrganType},loginerId:function(t){return t.loginer.loginerId}})),created:function(){this.loginerShopId&&this.$fxStateMiddleware.stateIs("loginerOrganType")("center")(this.loginerOrganType)&&(this.orderInfoData.rdcDTO={id:this.loginerShopId,name:this.loginerShopName})},beforeRouteLeave:function(t,e,i){var o=this;if(this.itemInputFocusing)return this.$router.go(1),!1;"/uniformDistributionOut"===t.path?this.$dialog.confirm({title:"提示",message:"若已修改,请先保存单据<br/>是否关闭页面?"}).then(function(){i()}).catch(function(){return o.$router.go(1),!1}):i()},methods:{clearItemConfim:function(t){var e=this;return new m.a(function(i){var o=e.orderItemList.filter(function(t){var e=t.details.filter(function(t){return"del"!==t.changeType});return 0!==e.length});0===o.length?i():e.$dialog.confirm({title:"提示",message:t}).then(function(){e.onItemClear(),i()}).catch(function(){})})},onInShopClick:function(){if(!this.orderInfoData.rdcDTO.id)return this.$fxToast.top("请先选择配送中心!"),!1;this.onInShopRefresh()},searchInShop:function(t){this.onInShopRefresh(t)},selectInShop:function(t){var e=this;this.checkInShop(t).then(function(){e.clearItemConfim("更换门店会清空品项,是否继续?").then(function(){e.orderInfoData.inShopDTO=t})})},checkInShop:function(t){var e=this;return new m.a(function(i){var o=e.orderInfoData.inShopDTO;o.id!==t.id&&i()})},onInShopRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getInShopListData(e).then(function(e){t.inShopList=e.shops,t.inShopPopShow=!0})},getInShopListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new m.a(function(i){var o={pid:t.orderInfoData.rdcDTO.id,keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/shopsByRdc"),data:o}).then(function(t){i(t)})})},onRdcClick:function(){this.onRdcRefresh()},searchRdc:function(t){this.onRdcRefresh(t)},selectRdc:function(t){var e=this;this.checkRdc(t).then(function(){e.clearItemConfim("修改配送中心将清空发货仓库、门店和单据明细，是否继续?").then(function(){e.orderInfoData.rdcDTO=t,e.orderInfoData.inShopDTO={}})})},checkRdc:function(t){var e=this;return new m.a(function(i){var o=e.orderInfoData.rdcDTO;o.id!==t.id&&i()})},onRdcRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getRdcListData(e).then(function(e){t.rdcList=e.shops,t.rdcPopShow=!0})},getRdcListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new m.a(function(i){var o={keyword:e,selAll:"on"};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/rdcs"),data:o}).then(function(t){i(t)})})},onBillTypeClick:function(){this.onBillTYpeRefresh()},searchBillType:function(t){this.onBillTYpeRefresh(t)},selectBillType:function(t){this.orderInfoData.businessTypeDTO=t},onBillTypeClear:function(){this.orderInfoData.businessTypeDTO={}},onBillTYpeRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getBillTypeListData(e).then(function(e){t.billTypeList=e.businessTypes,t.billTypePopShow=!0})},getBillTypeListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new m.a(function(i){var o={m:"list4DistributionOutListBillEdit",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/businessTypes"),data:o}).then(function(t){i(t)})})},onBusinessDateClick:function(){this.dateType="business",this.orderInfoData.businessDate&&(this.currentDate=new Date(this.orderInfoData.businessDate)),this.datePickerShow=!0},onArriveDateClick:function(){this.dateType="arrive",this.orderInfoData.arriveDate&&(this.currentDate=new Date(this.orderInfoData.arriveDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){var e=t.getTime();"business"===this.dateType?this.orderInfoData.businessDate=e:this.orderInfoData.arriveDate=e,this.datePickerShow=!1},onAddClick:function(){var t=this;this.checkOrderInfo().then(function(){t.storeItem=JSON.parse(h()(t.orderItemList)),t.itemStorePopShow=!0})},checkOrderInfo:function(){var t=this;return new m.a(function(e,i){t.orderInfoData.businessDate?t.orderInfoData.rdcDTO.id?t.orderInfoData.inShopDTO.id?e():t.$fxToast.top("请先选择门店!"):t.$fxToast.top("请先选择配送中心!"):t.$fxToast.top("请先选择业务日期!")})},onStoreItemSave:function(t){this.orderInfoData.details=t,this.orderItemList=this.orderInfoData.details},onCreateClick:function(){var t=this;if(this.itemInputFocusing)return!1;this.$dialog.confirm({title:"提示",message:"确定生成单据吗?"}).then(function(){t.checkHasDetails().then(function(){var e=t.getSaveParams();t.createHandler(e)})}).catch(function(){})},createHandler:function(t){var e=this;this.$fxHttp.requestPost({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/distributionOutBills"),data:t}).then(function(t){e.$fxToast.success("生成单据成功").then(function(){e.$router.replace({path:"uniformDistributionOutDetails",query:{orderId:t.storeBills[0].id}})})})},getSaveParams:function(){var t=[];this.orderItemList.forEach(function(e){t.push.apply(t,Object(u["a"])(e.details))});var e=t.filter(function(t){return"add"===t.changeType}),i=l()({},this.orderInfoData,{detailAdd:e,accountDTO:{id:this.loginerId},houseDTO:JSON.parse(h()(e[0].outHouseDTO))});return i},getValidItem:function(){var t=[];return this.orderItemList.forEach(function(e){t.push.apply(t,Object(u["a"])(e.details))}),t},getItemLength:function(){return this.getValidItem().length},checkHasDetails:function(){var t=this;return new m.a(function(e){0===t.getItemLength()?t.onAddClick():e()})},onItemClear:function(){this.orderInfoData.details=[],this.orderItemList=this.orderInfoData.details},onItemFocus:function(){this.$refs.orderInfo.closeCollapse()},onItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onUnitEdit:function(t){var e=this;this.itemEditRowData=t,this.getItemUnit(t.goodsDTO.id).then(function(t){e.unitActions=t,e.unitActionShow=!0})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemEditRowData,i=e.unitDTO.value,o=t,n=r()(e.busUnitOutAmount);n>0?(n=n*i/o.value,e.busUnitOutAmount=r()(this.$fxUtils.toFixedSHW(n,this.sysPointSize)),this.calcMoney("moneyWithTax",e.sendMoneyWithTax,e),this.calcCostMoney("outMoney",e.outMoney,e)):(e.taxPrice=r()(e.taxPrice)*o.value/i,this.calcMoney("taxPrice",e.taxPrice,e),this.calcCostMoney("taxPrice",e.costPrice,e));var s=r()(e.outOrderAmount);s=s*i/o.value,e.outOrderAmount=s,e.unitDTO=t},getItemUnit:function(t){var e=this;return new m.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/users/").concat(e.loginerId,"/goods/").concat(t,"/units")}).then(function(t){i(t.units)})})},calcMoney:function(t,e,i){var o=i.taxPrice,n=i.busUnitOutAmount,s=i.price,a=i.sendTaxes,r=0,c=0,l=0,u=0,d=this.toFixedNumberSize(e);if(i.giftFlag||"money"===t&&0===d)return i.sendMoney=0,i.sendMoneyWithTax=0,i.sendTaxMoney=0,!0;"money"===t?(r=d,l=this.toFixedNumberSize(r/n),c=r*(1+a),u=this.toFixedNumberSize(c/n)):"amount"===t?(i.busUnitOutAmount=this.toFixedNumberSize(e,this.sysPointSize),l=s,u=o,r=this.toFixedNumberSize(s*d),c=this.toFixedNumberSize(o*d)):"moneyWithTax"===t?(c=d,u=this.toFixedNumberSize(c/n),r=this.toFixedNumberSize(c/(1+a)),l=this.toFixedNumberSize(r/n)):"taxPrice"===t?(u=d,c=this.toFixedNumberSize(n*u),l=this.toFixedNumberSize(u/(1+a)),r=this.toFixedNumberSize(l*n)):"price"===t&&(l=d,r=this.toFixedNumberSize(l*n),u=this.toFixedNumberSize(l*(1+a)),c=this.toFixedNumberSize(n*u)),i.sendMoney=r,i.sendMoneyWithTax=c,i.sendTaxMoney=this.toFixedNumberSize(this.toFixedNumberSize(c)-this.toFixedNumberSize(r)),i.price=l,i.taxPrice=u},calcCostMoney:function(t,e,i){var o=i.costPrice,n=i.busUnitOutAmount,s=0,a=0,r=this.toFixedNumberSize(e);"amount"===t?(i.busUnitOutAmount=this.toFixedNumberSize(e,this.sysPointSize),a=o,s=this.toFixedNumberSize(o*r)):"outMoney"===t?(s=r,a=this.toFixedNumberSize(s/n)):"taxPrice"===t&&(a=r,s=this.toFixedNumberSize(n*a)),i.outMoney=s,i.costPrice=a},toFixedNumberSize:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sysMoneyPointSize;return r()(this.$fxUtils.toFixedSHW(t,e))},onEditRowConfirm:function(t){var e=this.orderItemList.findIndex(function(e){return e.id===t.outHouseDTO.id&&e.shopHouseDTO.id===t.shopHouseDTO.id});if(~e){var i=this.orderItemList[e].details.findIndex(function(e){return e.goodsDTO.id===t.goodsDTO.id&&"del"!==e.changeType});~i&&(this.orderItemList[e].details[i]=t)}},onSearchClick:function(){this.itemSearchPopShow=!0,this.searchItem=JSON.parse(h()(this.orderItemList))},onSearchConfirm:function(t){this.orderItemList=t},onStoreItemSelect:function(t,e){this.currentOutHouseObj=t,this.currentShopHouseObj=e,this.itemPopShow=!0},getStoreItem:function(){var t=this;if(this.$fxUtils.isEmptyObjSHW(this.currentShopHouseObj)||this.$fxUtils.isEmptyObjSHW(this.currentOutHouseObj))return[];var e=this.orderItemList.find(function(e){return e.shopHouseDTO.id===t.currentShopHouseObj.id&&e.id===t.currentOutHouseObj.id});return e?e.details:[]},onItemEditConfirm:function(t){var e=Object(s["a"])(t,3),i=e[0],o=e[1],n=e[2],a=this.orderItemList.find(function(t){return t.id===o.id&&t.shopHouseDTO.id===n.id});if(a)a.details=i;else{var r=l()({},o);r.shopHouseDTO=n,r.details=i,this.orderItemList.push(r)}}}},I=w,T=(i("4667"),i("2877")),O=Object(T["a"])(I,o,n,!1,null,"50b960d4",null);e["default"]=O.exports},2508:function(t,e,i){"use strict";var o=i("ce82"),n=i.n(o);n.a},"2ed7":function(t,e,i){},"2f8b":function(t,e,i){"use strict";var o=i("8c37"),n=i.n(o);n.a},"2fe6":function(t,e,i){},"35ce":function(t,e,i){},"3a7d":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-info-cell"},[i("div",{staticClass:"item-img"},[i("img",{attrs:{src:t.comptedItemImgSrc(t.itemData.goodsDTO.imageUrls),onerror:t.$fxCommon.errorImg("item")}})]),i("div",{staticClass:"item-details"},[i("div",{staticClass:"item-name fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.name))]),i("div",{staticClass:"details-cell"},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionOutBill.seeWithTaxMoney"),expression:"$fxAuth('distributionOutBill.seeWithTaxMoney')"}],staticClass:"item-taxprice fx-ellipsis"},[i("span",[t._v("含税金额：￥")]),i("span",[t._v(t._s(t.itemData.sendMoneyWithTax))])])]),i("div",{staticClass:"details-cell"},[i("div",{staticClass:"item-spec fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.spec))]),t.isDisabled||t.itemData.isWeightSign&&!t.sysDZCCanModifyAcount?i("div",{staticClass:"item-amount"},[i("span",[t._v(t._s(t.itemData.busUnitOutAmount))])]):i("div",{staticClass:"item-amount-edit"},[i("w-stepper",{staticClass:"amount-step",attrs:{min:"0",max:t.maxAmount,stepperBtnShow:!1,intLength:t.numberLength,pointSize:t.sysPointSize},on:{change:t.onChange,focus:t.onFocus,blur:t.onBlur},model:{value:t.itemData.busUnitOutAmount,callback:function(e){t.$set(t.itemData,"busUnitOutAmount",e)},expression:"itemData.busUnitOutAmount"}})],1),i("div",{staticClass:"unit-text"},[i("span",{staticClass:"fx-ellipsis cell-unit",on:{click:function(e){return e.stopPropagation(),t.onUnitClick(e)}}},[t._v(t._s(t.itemData.unitDTO.name))]),i("van-icon",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&!(t.itemData.isWeightSign&&!t.sysDZCCanModifyAcount),expression:"!isDisabled && !(itemData.isWeightSign && !sysDZCCanModifyAcount)"}],staticClass:"unit-icon",attrs:{name:"arrow-down"}})],1)])]),i("i",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&!t.disabledEditBtn,expression:"!isDisabled && !disabledEditBtn"}],staticClass:"block-item-edit",on:{click:t.onItemEditClick}}),i("i",{directives:[{name:"show",rawName:"v-show",value:t.isDisabled&&t.showEditBtn,expression:"isDisabled && showEditBtn"}],staticClass:"block-item-watch",on:{click:t.onItemEditClick}})])},n=[],s=i("59ad"),a=i.n(s),r=i("cebc"),c=i("2f62"),l={name:"itemInfoCell",props:{itemData:{type:Object,default:function(){return{}}},isDisabled:Boolean,disabledEditBtn:Boolean,showEditBtn:{type:Boolean,default:function(){return!0}}},computed:Object(r["a"])({},Object(c["c"])({sysDZCCanModifyAcount:function(t){return t.systemParams.sysDZCCanModifyAcount},sysPointSize:"sysPointSize",sysMoneyPointSize:"sysMoneyPointSize",numberLength:"numberLength",maxAmount:"maxAmount"}),{comptedItemImgSrc:function(t){return function(t){return null===t?"":t[0]}}}),data:function(){return{isHasGoods:!1}},methods:{onChange:function(t){this.amountChange(t)},editItem:function(){this.itemData.id&&this.$set(this.itemData,"changeType","edit")},amountChange:function(t){this.editItem(),this.calcMoney("amount",t,this.itemData),this.calcCostMoney("amount",t,this.itemData)},onMoneyChange:function(t){this.editItem(),this.calcMoney("moneyWithTax",t,this.itemData),this.calcCostMoney("outMoney",t,this.itemData)},calcMoney:function(t,e,i){var o=i.taxPrice,n=i.busUnitOutAmount,s=i.price,a=i.sendTaxes,r=0,c=0,l=0,u=0,d=this.toFixedNumberSize(e);if(i.giftFlag||"money"===t&&0===d)return i.sendMoney=0,i.sendMoneyWithTax=0,i.sendTaxMoney=0,!0;"money"===t?(r=d,l=this.toFixedNumberSize(r/n),c=r*(1+a),u=this.toFixedNumberSize(c/n)):"amount"===t?(""!==e&&(i.busUnitOutAmount=this.toFixedNumberSize(e,this.sysPointSize)),l=s,u=o,r=this.toFixedNumberSize(s*d),c=this.toFixedNumberSize(o*d)):"moneyWithTax"===t?(c=d,u=this.toFixedNumberSize(c/n),r=this.toFixedNumberSize(c/(1+a)),l=this.toFixedNumberSize(r/n)):"taxPrice"===t?(u=d,c=this.toFixedNumberSize(n*u),l=this.toFixedNumberSize(u/(1+a)),r=this.toFixedNumberSize(l*n)):"price"===t&&(l=d,r=this.toFixedNumberSize(l*n),u=this.toFixedNumberSize(l*(1+a)),c=this.toFixedNumberSize(n*u)),i.sendMoney=r,""!==e&&(i.sendMoneyWithTax=c),i.sendTaxMoney=this.toFixedNumberSize(this.toFixedNumberSize(c)-this.toFixedNumberSize(r)),i.price=l,i.taxPrice=u},calcCostMoney:function(t,e,i){var o=i.costPrice,n=i.busUnitOutAmount,s=0,a=0,r=this.toFixedNumberSize(e);"amount"===t?(i.busUnitOutAmount=this.toFixedNumberSize(e,this.sysPointSize),a=o,s=this.toFixedNumberSize(o*r)):"outMoney"===t?(s=r,a=this.toFixedNumberSize(s/n)):"taxPrice"===t&&(a=r,s=this.toFixedNumberSize(n*a)),i.outMoney=s,i.costPrice=a},toFixedNumberSize:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sysMoneyPointSize;return a()(this.$fxUtils.toFixedSHW(t,e))},hasGoodsChange:function(t){0!==a()(t)&&this.itemData.shortageFlag?(this.isHasGoods=this.itemData.shortageFlag,this.itemData.shortageFlag=!1):0===t&&this.isHasGoods&&(this.itemData.shortageFlag=!0)},onItemEditClick:function(){this.editItem(),this.$emit("on-item-edit",this.itemData)},onUnitClick:function(){if(this.isDisabled||this.itemData.isWeightSign&&!this.sysDZCCanModifyAcount)return!1;this.editItem(),this.$emit("on-unit-edit",this.itemData)},onFocus:function(){this.$emit("on-item-focus")},onBlur:function(){this.$emit("on-item-blur")}}},u=l,d=(i("2508"),i("2877")),h=Object(d["a"])(u,o,n,!1,null,"50cbd582",null);e["a"]=h.exports},"3e54":function(t,e,i){"use strict";var o=i("4619"),n=i.n(o);n.a},"415d":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-item-block fx-shadow-block"},[i("div",{staticClass:"item-title"},[i("span",{staticClass:"title-name"},[t._v("单据明细")]),i("span",{staticClass:"title-count"},[t._v("明细：")]),i("span",[t._v(t._s(t.detailsLength))]),i("i",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&t.isAutoType([1,6]),expression:"!isDisabled && isAutoType([1, 6])"}],staticClass:"title-add-icon fl-r",on:{click:function(e){return t.onEmitClick("on-add-click")}}}),i("i",{staticClass:"title-search-icon fl-r",on:{click:t.onSearchClick}})]),i("div",{ref:"details-content",staticClass:"item-list"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeStoreNames,callback:function(e){t.activeStoreNames=e},expression:"activeStoreNames"}},t._l(t.data,function(e){return i("van-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.storeShowComputed(e),expression:"storeShowComputed(storeItem)"}],key:e.id+"-"+e.shopHouseDTO.id,staticClass:"store-row",attrs:{name:e.id+"-"+e.shopHouseDTO.id}},[i("div",{attrs:{slot:"title"},slot:"title"},[i("span",{staticClass:"item-store-title fx-ellipsis"},[t._v("出库仓库："+t._s(e.name))]),i("span",{staticClass:"store-right-name fx-ellipsis"},[t._v("入库仓库："+t._s(e.shopHouseDTO.name))])]),t._l(e.details,function(o,n){return i("van-swipe-cell",{directives:[{name:"show",rawName:"v-show",value:"del"!==o.changeType,expression:"item.changeType !== 'del'"}],key:e.shopHouseDTO.id+"-"+o.goodsDTO.id+"-"+o.goodsUUid,ref:"details-row-"+e.shopHouseDTO.id+"-"+o.goodsDTO.id,refInFor:!0,staticClass:"item-row",attrs:{"right-width":80,disabled:t.isDisabled||t.focusing}},[i("itemInfoCell",t._g(t._b({attrs:{itemData:o,isDisabled:t.isDisabled,disabledEditBtn:t.focusing},on:{"on-item-focus":function(i){return t.onItemFocus(arguments,e.shopHouseDTO.id+"-"+o.goodsDTO.id)},"on-item-blur":t.onItemBlur}},"itemInfoCell",t.$attrs,!1),t.$listeners)),i("div",{staticClass:"item-row-delete",attrs:{slot:"right"},on:{click:function(i){return t.onDeleteClick(o,n,e.details)}},slot:"right"},[t._v("删除")])],1)})],2)}),1)],1)])},n=[],s=(i("ac6a"),i("6762"),i("2fdb"),i("6b54"),i("c5f6"),i("3a7d")),a={name:"orderItem",components:{itemInfoCell:s["a"]},props:{data:{type:Array,default:function(){return[]}},billId:{type:String,default:""},isDisabled:Boolean,itemInputFocusing:Boolean,autoType:{type:Number,default:1}},inheritAttrs:!1,data:function(){return{focusing:!1,activeStoreNames:[]}},computed:{storeShowComputed:function(t){return function(t){var e=t.details.filter(function(t){return"del"!==t.changeType}).length;return e>0}},detailsLength:function(t){return this.data.reduce(function(t,e){var i=e.details.filter(function(t){return"del"!==t.changeType});return t+i.length},0)},isAutoType:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.autoType):e.autoType===t}}},watch:{focusing:function(t){this.$emit("update:itemInputFocusing",t)},data:function(){var t=this;this.setDetailGoodsUUid(this.data),this.data.forEach(function(e){var i=e.details.filter(function(t){return"del"!==t.changeType}).length;i>0&&t.activeStoreNames.push("".concat(e.id,"-").concat(e.shopHouseDTO.id))})}},methods:{setDetailGoodsUUid:function(t){var e=this;t.forEach(function(t){t.details.forEach(function(t){t.goodsUUid=e.$fxUtils.createUUID()})})},onEmitClick:function(t){if(this.isDisabled||this.focusing)return!1;this.$emit(t)},onSearchClick:function(){if(this.focusing)return!1;this.$emit("on-search-click")},onSendOutClick:function(){if(this.focusing)return!1;this.$emit("on-send-click")},onDeleteClick:function(t,e,i){t.id?this.$set(t,"changeType","del"):i.splice(e,1)},onItemFocus:function(t,e){this.focusing=!0},onItemBlur:function(){this.focusing=!1}}},r=a,c=(i("b91d"),i("2877")),l=Object(c["a"])(r,o,n,!1,null,"3d2125b8",null);e["a"]=l.exports},4619:function(t,e,i){},"463e2":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-info-block fx-shadow-block"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},[i("van-collapse-item",{attrs:{name:"1",disabled:t.collapseDisabled}},[i("div",{staticClass:"info-title",attrs:{slot:"title"},slot:"title"},[i("span",{staticClass:"info-title-name"},[t._v("单据信息")]),i("stateText",{staticClass:"stateTag fl-r",attrs:{billState:t.data.billState}}),i("span",{directives:[{name:"show",rawName:"v-show",value:1===t.data.weightState,expression:"data.weightState === 1"}],staticClass:"info-title-weightState"},[t._v("待称重")])],1),i("van-tabs",{attrs:{animated:""},model:{value:t.tabActive,callback:function(e){t.tabActive=e},expression:"tabActive"}},[i("van-tab",{attrs:{title:"表头"}},[i("van-cell",{staticClass:"info-item",attrs:{title:"配送中心","value-class":"info-item-value",value:t.data.rdcDTO&&t.data.rdcDTO.name,"is-link":!t.isDisabled&&(1===t.data.autoType||void 0===t.data.autoType)},on:{click:function(e){return t.onEmitClick("on-rdc-click")}}}),i("van-cell",{staticClass:"info-item",attrs:{title:"业务日期",value:t.formatterDate(t.data.businessDate),"is-link":!t.isDisabled},on:{click:t.onBusDateClick}}),i("van-cell",{staticClass:"info-item",attrs:{title:"门店","value-class":"info-item-value",value:t.data.inShopDTO&&t.data.inShopDTO.name,"is-link":!t.isDisabled&&(1===t.data.autoType||void 0===t.data.autoType)},on:{click:function(e){return t.onEmitClick("on-shop-click")}}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:1===t.data.autoType||void 0===t.data.autoType,expression:"data.autoType === 1 || data.autoType === undefined"}],staticClass:"info-item",attrs:{title:"到货日期",value:t.formatterDate(t.data.arriveDate),"is-link":!t.isDisabled},on:{click:function(e){return t.onEmitClick("on-arriveDate-click")}}}),i("van-pro-field",{staticClass:"info-item",attrs:{label:"手工单号",placeholder:t.isDisabled?"":"请输入手工单号","input-align":"right",maxlength:"50",disabled:t.isDisabled},model:{value:t.data.manualCode,callback:function(e){t.$set(t.data,"manualCode",e)},expression:"data.manualCode"}}),i("van-switch-cell",{directives:[{name:"show",rawName:"v-show",value:t.$fxSysAuth("distributionOutBill.seeExpressFlag"),expression:"$fxSysAuth('distributionOutBill.seeExpressFlag')"}],staticClass:"info-item",attrs:{disabled:t.isDisabled||1!==t.data.autoType&&void 0!==t.data.autoType,title:"加急标识"},on:{input:t.onUrgentInput},model:{value:t.data.expressFlag,callback:function(e){t.$set(t.data,"expressFlag",e)},expression:"data.expressFlag"}}),i("van-pro-field",{staticClass:"info-item",attrs:{label:"整单备注",placeholder:t.isDisabled?"":"请输入整单备注","input-align":"right",maxlength:"50",disabled:t.isDisabled},model:{value:t.data.billMemo,callback:function(e){t.$set(t.data,"billMemo",e)},expression:"data.billMemo"}})],1),i("van-tab",{attrs:{title:"更多"}},[i("van-cell",{staticClass:"info-item",attrs:{title:"制单人",value:t.data.billEmp}}),i("van-cell",{staticClass:"info-item",attrs:{title:"制单日期",value:t.formatterDate(t.data.billDate)}}),i("van-cell",{staticClass:"info-item",attrs:{title:"审核人",value:t.data.checkEmp}}),i("van-cell",{staticClass:"info-item",attrs:{title:"审核日期",value:t.formatterDate(t.data.checkDate)}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.$fxSysAuth("distributionOutBill.seeBillType"),expression:"$fxSysAuth('distributionOutBill.seeBillType')"}],staticClass:"info-item",attrs:{title:"单据类型","value-class":"info-item-value",value:t.data.businessTypeDTO&&t.data.businessTypeDTO.name},on:{click:function(e){return t.onEmitClick("on-billType-click")}}},[i("van-icon",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&(1===t.data.autoType||void 0===t.data.autoType),expression:"!isDisabled && (data.autoType === 1 || data.autoType === undefined)"}],staticClass:"item-clear-btn",attrs:{slot:"right-icon",name:t.hasBillType?"close":"arrow"},on:{click:function(e){e.stopPropagation(),t.hasBillType?t.onEmitClick("on-billType-clear"):t.onEmitClick("on-billType-click")}},slot:"right-icon"})],1),i("van-pro-number-field",{directives:[{name:"show",rawName:"v-show",value:t.$fxSysAuth("distributionOutBill.seeFreight"),expression:"$fxSysAuth('distributionOutBill.seeFreight')"}],staticClass:"info-item info-number",attrs:{label:"运费","input-align":"right",min:"0",defaultValue:0,max:t.maxAmount,intLength:t.numberLength,pointSize:t.sysPointSize,disabled:t.isDisabled},model:{value:t.data.freight,callback:function(e){t.$set(t.data,"freight",e)},expression:"data.freight"}}),i("van-pro-number-field",{directives:[{name:"show",rawName:"v-show",value:t.$fxSysAuth("distributionOutBill.seePieceAmount"),expression:"$fxSysAuth('distributionOutBill.seePieceAmount')"}],staticClass:"info-item",attrs:{label:"件数",type:"number","input-align":"right",min:"1",max:t.maxAmount,intLength:8,integer:!0,disabled:t.isDisabled},model:{value:t.data.pieceAmount,callback:function(e){t.$set(t.data,"pieceAmount",e)},expression:"data.pieceAmount"}})],1)],1)],1)],1)],1)},n=[],s=i("cebc"),a=i("2f62"),r=i("4760"),c={name:"orderInfo",components:{stateText:r["a"]},props:{data:{type:Object,default:function(){return{}}},isDisabled:Boolean,collapseDisabled:Boolean},data:function(){return{activeNames:["1"],tabActive:0}},computed:Object(s["a"])({},Object(a["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",maxAmount:"maxAmount"}),{formatterDate:function(t){var e=this;return function(t){return"number"===typeof t?e.$fxUtils.setDateTime(new Date(t),"时分"):""}},hasBillType:function(){return this.data.businessTypeDTO&&this.data.businessTypeDTO.id}}),methods:{onEmitClick:function(t){if(this.isDisabled||1!==this.data.autoType&&void 0!==this.data.autoType)return!1;this.$emit(t)},onBusDateClick:function(){this.onEmitClick("on-busdate-click")},onUrgentInput:function(){if(1!==this.data.autoType&&void 0!==this.data.autoType)return!1},closeCollapse:function(){this.activeNames=[]}}},l=c,u=(i("2209"),i("2877")),d=Object(u["a"])(l,o,n,!1,null,"73c552d2",null);e["a"]=d.exports},4667:function(t,e,i){"use strict";var o=i("2fe6"),n=i.n(o);n.a},"4e92":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-edit"},[i("w-header",{attrs:{title:"选择品项",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}},[i("van-icon",{staticClass:"header-confirm-btn",attrs:{slot:"header-right",name:"success"},on:{click:t.onItemConfirm},slot:"header-right"})],1),i("div",{staticClass:"item-search clearfix"},[i("van-search",{attrs:{placeholder:"请输入搜索关键词",shape:"round"},on:{search:t.search,focus:t.onSearchFocus},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}})],1),i("div",{staticClass:"item-edit-content"},[i("addItemClassList",{attrs:{itemClassList:t.itemClassList},on:{"on-change-class":t.changeClass},model:{value:t.currentClass,callback:function(e){t.currentClass=e},expression:"currentClass"}}),i("addItemList",{ref:"addItemList",attrs:{listLoading:t.listLoading,loadFinished:t.loadFinished,itemList:t.itemList},on:{"update:listLoading":function(e){t.listLoading=e},"update:list-loading":function(e){t.listLoading=e},"on-load-more":t.onLoadMore},scopedSlots:t._u([{key:"item-cell",fn:function(e){return[i("addItemCell",{attrs:{itemData:e.$item,itemIndex:e.$index,rowActive:t.rowActive,itemAmoutName:"busUnitOutAmount"},on:{"on-item-click":t.onItemEdit}})]}}]),model:{value:t.rowActive,callback:function(e){t.rowActive=e},expression:"rowActive"}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.numberKeyboardShow,expression:"numberKeyboardShow"}],staticClass:"details-number-keyboard"},[i("itemNumberKeyboard",{attrs:{title:t.keyboardTitleCompted,unit:t.keyboardUnitCompted,unitEdit:!0,amount:t.keyboardAmountCompted,pointSize:t.sysPointSize,intLength:t.numberLength},on:{change:t.onKeyboardChange,"on-unit-unitEdit":t.onUnitEdit,pre:t.onKeyboardPre,next:t.onKeyboardNext,hide:t.onKeyboardHide}})],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("w-action-sheet",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.scanActionShow,expression:"scanActionShow"}],ref:"scanActionSheet",attrs:{actions:t.scanActions},model:{value:t.scanActionShow,callback:function(e){t.scanActionShow=e},expression:"scanActionShow"}})],1)},n=[],s=i("59ad"),a=i.n(s),r=i("768b"),c=(i("20d6"),i("75fc")),l=i("795b"),u=i.n(l),d=(i("ac6a"),i("f499")),h=i.n(d),f=(i("7f7f"),i("cebc")),m=(i("c5f6"),i("2f62")),p=i("d444"),v=i("01f7"),b=i("9c7f"),S=i("af41"),g=10,D={name:"itemEditComp",components:{addItemClassList:p["a"],addItemList:v["a"],addItemCell:b["a"],itemNumberKeyboard:S["a"]},props:{visibleFlag:Boolean,outHouse:{type:Object,default:function(){return{}}},shopHouseDTO:{type:Object,default:function(){return{}}},inShopId:{type:String,default:""},rdcId:{type:String,default:""},businessDate:{type:[String,Number],default:""},parentStoreItem:{type:Array,default:function(){return[]}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",currentClass:"",itemClassList:[],itemList:[],numberKeyboardShow:!1,rowActive:"",selectedItemArr:[],itemListStart:0,listLoading:!1,loadFinished:!0,listError:!1,isErrorActive:"",unitActionShow:!1,unitActions:[],scanActionShow:!1,scanActions:[{name:"累加数量"},{name:"覆盖数量"}]}},computed:Object(f["a"])({},Object(m["c"])({sysPointSize:"sysPointSize",sysMoneyPointSize:"sysMoneyPointSize",numberLength:"numberLength",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{keyboardTitleCompted:function(){if(""===this.rowActive)return"";var t=this.itemList[this.rowActive];return t.goodsDTO.name},keyboardUnitCompted:function(){if(""===this.rowActive)return"";var t=this.itemList[this.rowActive];return t.unitDTO.name},keyboardAmountCompted:function(){if(""===this.rowActive)return"0";var t=this.itemList[this.rowActive];return t.busUnitOutAmount}}),watch:{visibleFlag:{handler:function(t){t?(this.selectedItemArr=JSON.parse(h()(this.parentStoreItem)),this.refresh(),this.$fxEventBus.$on("redCode",this.getItemByRedCode)):this.$fxEventBus.$off("redCode",this.getItemByRedCode)},immediate:!0},rowActive:function(t,e){""!==e?(this.numberStringAmount(e),this.pushSelectedItem(this.itemList[e]),""===t?this.numberKeyboardShow=!1:this.scrollToActive(t)):this.scrollToActive(t)}},methods:{refresh:function(){var t=this;this.searchKey="",this.getItemClass().then(function(e){t.itemClassList=e.goodsTypes,t.currentClass="",t.getItemByClass()})},onCloseClick:function(){this.rowActive="",this.$emit("update:visibleFlag",!1)},onItemConfirm:function(){var t=this;this.rowActive="",this.$nextTick(function(){t.selectedItemArr.forEach(function(e){e.shopHouseDTO||(e.shopHouseDTO=t.shopHouseDTO),e.outHouseDTO||(e.outHouseDTO=t.outHouse)}),t.$emit("on-confirm",[t.selectedItemArr,t.outHouse,t.shopHouseDTO]),t.$emit("update:visibleFlag",!1)})},search:function(){this.getItemByClass()},getItemClass:function(){var t=this;return new u.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.inShopId,"/users/").concat(t.loginerId,"/goodTypes")}).then(function(t){e(t)})})},getItem:function(){var t=this;return new u.a(function(e){var i={start:t.itemListStart,size:g,paged:!0,goodsTypeId:t.currentClass||null,shopId:t.inShopId,rdcId:t.rdcId,outHouseId:t.outHouse.id,inHouseId:t.shopHouseDTO.id,workDate:t.businessDate,searchText:t.searchKey||""};t.$fxHttp.requestPost({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.inShopId,"/users/").concat(t.loginerId,"/distributionOutDetails"),data:i}).then(function(t){e(t)})})},getItemByClass:function(){var t=this;this.itemListStart=0,this.getItem().then(function(e){var i=t.setDataMoneyAndPrice(e.billAndDetails);t.itemList=t.setResItem(i),t.setListLoading(i.length),t.$nextTick(function(){t.$refs.addItemList&&t.$refs.addItemList.onSelectLetter(0,5)})})},onLoadMore:function(){var t=this;this.getItem().then(function(e){var i,o=t.setDataMoneyAndPrice(e.billAndDetails);(i=t.itemList).push.apply(i,Object(c["a"])(t.setResItem(o))),t.setListLoading(o.length)})},setDataMoneyAndPrice:function(t){var e=this;return t.forEach(function(t){e.$fxUtils.isDef(t.pricePlanDTO)?(t.price=e.toFixedNumberSize(t.pricePlanDTO.price),t.sendTaxes=e.toFixedNumberSize(t.pricePlanDTO.taxes),t.taxPrice=e.toFixedNumberSize(t.pricePlanDTO.price*(1+t.pricePlanDTO.taxes)),t.unitDTO=t.pricePlanDTO.unit):(t.price=0,t.sendTaxes=0,t.taxPrice=0)}),t},setResItem:function(t){var e=this;return t.forEach(function(t){var i=e.selectedItemArr.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id});~i&&"del"!==e.selectedItemArr[i].changeType?(t.busUnitOutAmount=e.selectedItemArr[i].busUnitOutAmount,t.unitDTO=e.selectedItemArr[i].unitDTO):t.busUnitOutAmount="0"}),t},setListLoading:function(t){this.listLoading=!1,this.itemListStart+=g,this.loadFinished=t<g},changeClass:function(t){var e=Object(r["a"])(t,2);e[0],e[1];this.searchKey="",this.onKeyboardHide(),this.getItemByClass()},onItemEdit:function(t){this.rowActive=t,this.numberKeyboardShow=!0},onKeyboardChange:function(t){this.itemList[this.rowActive].busUnitOutAmount=t},numberStringAmount:function(t){var e=this.itemList[t].busUnitOutAmount;this.itemList[t].busUnitOutAmount=a()(e)},pushSelectedItem:function(t){var e=this.selectedItemArr.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id&&"del"!==e.changeType});~e?this.selectedItemArr[e].id||0!==t.busUnitOutAmount?(this.selectedItemArr[e].id&&(0===t.busUnitOutAmount?"del"!==this.selectedItemArr[e].changeType&&(this.selectedItemArr[e].changeType="del",this.$fxToast({message:"删除已选品项".concat(t.goodsDTO.name),position:"top"})):this.selectedItemArr[e].changeType="edit"),this.changeSelectedItem(t,e)):(this.selectedItemArr.splice(e,1),this.$fxToast({message:"删除已选品项".concat(t.goodsDTO.name),position:"top"})):t.busUnitOutAmount>0&&(t.changeType="add",this.selectedItemArr.push(t),this.changeSelectedItem(t,this.selectedItemArr.length-1))},changeSelectedItem:function(t,e){this.selectedItemArr[e].unitDTO=t.unitDTO,this.selectedItemArr[e].busUnitOutAmount=t.busUnitOutAmount,this.calcMoney("amount",t.busUnitOutAmount,this.selectedItemArr[e]),this.calcCostMoney("amount",t.busUnitOutAmount,this.selectedItemArr[e])},onKeyboardPre:function(){if(!this.rowActive)return!1;this.rowActive--},onKeyboardNext:function(){if(""===this.rowActive||this.rowActive===this.itemList.length-1)return!1;this.rowActive++},onKeyboardHide:function(){this.rowActive=""},scrollToActive:function(t){var e=this;this.$nextTick(function(){e.$refs.addItemList.onSelectLetter(t,20)})},onSearchFocus:function(){this.rowActive=""},onUnitEdit:function(){var t=this,e=this.itemList[this.rowActive].goodsDTO.id;this.getItemUnit(e).then(function(e){t.unitActions=e,t.unitActionShow=!0})},getItemUnit:function(t){var e=this;return new u.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/shopId/users/userId/goods/").concat(t,"/units"),query:{userId:e.loginerId}}).then(function(t){i(t.units)})})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemList[this.rowActive],i=e.unitDTO.value,o=t,n=a()(e.busUnitOutAmount);n>0?(n=n*i/o.value,e.busUnitOutAmount=a()(this.$fxUtils.toFixedSHW(n,this.sysPointSize)),this.calcMoney("moneyWithTax",e.sendMoneyWithTax,e),this.calcCostMoney("outMoney",e.outMoney,e)):(e.taxPrice=a()(e.taxPrice)*o.value/i,this.calcMoney("taxPrice",e.taxPrice,e),this.calcCostMoney("taxPrice",e.costPrice,e));var s=a()(e.outOrderAmount);s=s*i/o.value,e.outOrderAmount=s;var r=this.selectedItemArr.findIndex(function(t){return e.goodsDTO.id===t.goodsDTO.id});~r&&(this.selectedItemArr[r].unitDTO=t),e.unitDTO=t},calcMoney:function(t,e,i){var o=i.taxPrice,n=i.busUnitOutAmount,s=i.price,a=i.sendTaxes,r=0,c=0,l=0,u=0,d=this.toFixedNumberSize(e);if(i.giftFlag||"money"===t&&0===d)return i.sendMoney=0,i.sendMoneyWithTax=0,i.sendTaxMoney=0,!0;"money"===t?(r=d,l=this.toFixedNumberSize(r/n),c=r*(1+a),u=this.toFixedNumberSize(c/n)):"amount"===t?(i.busUnitOutAmount=this.toFixedNumberSize(e,this.sysPointSize),l=s,u=o,r=this.toFixedNumberSize(s*d),c=this.toFixedNumberSize(o*d)):"moneyWithTax"===t?(c=d,u=this.toFixedNumberSize(c/n),r=this.toFixedNumberSize(c/(1+a)),l=this.toFixedNumberSize(r/n)):"taxPrice"===t?(u=d,c=this.toFixedNumberSize(n*u),l=this.toFixedNumberSize(u/(1+a)),r=this.toFixedNumberSize(l*n)):"price"===t&&(l=d,r=this.toFixedNumberSize(l*n),u=this.toFixedNumberSize(l*(1+a)),c=this.toFixedNumberSize(n*u)),i.sendMoney=r,i.sendMoneyWithTax=c,i.sendTaxMoney=this.toFixedNumberSize(this.toFixedNumberSize(c)-this.toFixedNumberSize(r)),i.price=l,i.taxPrice=u},calcCostMoney:function(t,e,i){var o=i.costPrice,n=i.busUnitOutAmount,s=0,a=0,r=this.toFixedNumberSize(e);"amount"===t?(i.busUnitOutAmount=this.toFixedNumberSize(e,this.sysPointSize),a=o,s=this.toFixedNumberSize(o*r)):"outMoney"===t?(s=r,a=this.toFixedNumberSize(s/n)):"taxPrice"===t&&(a=r,s=this.toFixedNumberSize(n*a)),i.outMoney=s,i.costPrice=a},toFixedNumberSize:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sysMoneyPointSize;return a()(this.$fxUtils.toFixedSHW(t,e))},createBreakBill:function(t){var e=this;return new u.a(function(i){var o={billEmp:"",billMemo:"",billState:0,businessDate:(new Date).getTime(),businessTypeDTO:{},shopDTO:{id:e.rdcId},details:[],updateIndicator:"Append",autoType:1,reckonBreak:"0",detailAdd:[t],accountDTO:{id:e.loginerId}};e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/breakBills"),data:o,query:{m:"addAndCheckBill"}}).then(function(t){i(),e.$fxToast.success("报损成功！")})})},getItemByRedCode:function(t){return!!this.visibleFlag&&(t.length<=24?this.onRedCodeHandler(t):this.onRedTwoCodeHandler(t))},onRedCodeHandler:function(t){var e=this;return this.rowActive="",this.getItemByRedCodeHandler(t).then(function(t){var i=t.billAndDetails[0];i=e.itemUpdate(i);var o=i.goodsDTO.countValue;e.calcMoney("amount",o,i),e.calcCostMoney("amount",o,i),e.pushSelectedItem(i),e.itemList=[i],e.setListLoading(1),e.$nextTick(function(){e.$refs.addItemList.onSelectLetter(0,5)})})},itemUpdate:function(t){this.$fxUtils.isDef(t.pricePlanDTO)?(t.price=this.toFixedNumberSize(t.pricePlanDTO.price),t.sendTaxes=this.toFixedNumberSize(t.pricePlanDTO.taxes),t.taxPrice=this.toFixedNumberSize(t.pricePlanDTO.price*(1+t.pricePlanDTO.taxes)),t.unitDTO=t.pricePlanDTO.unit):(t.price=0,t.sendTaxes=0,t.taxPrice=0);var e=this.$fxUtils.appointedMap(this.selectedItemArr,function(e,i){if(e.goodsDTO.id===t.goodsDTO.id&&"del"!==e.changeType)return i});if(1===e.length&&this.selectedItemArr[e[0]].id){var i=this.selectedItemArr[e[0]],o=i.unitDTO,n=t.unitDTO,s=n.value/o.value,a=t.goodsDTO.countValue*s;i.goodsDTO.countValue=a,t=this.$fxUtils.JSONcopy(i)}return t},getItemByRedCodeHandler:function(t){var e=this;return new u.a(function(i){var o={goodsTypeId:e.currentClass||null,shopId:e.inShopId,rdcId:e.rdcId,outHouseId:e.outHouse.id,inHouseId:e.shopHouseDTO.id,workDate:e.businessDate};e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.inShopId,"/users/").concat(e.loginerId,"/distributionOutDetails/barCode/").concat(t),data:o}).then(function(t){i(t)})})},onRedTwoCodeHandler:function(t){var e=this;return this.getItemByTwoCode(t,!1).then(function(i){return"100"===i.errorCode||"101"===i.errorCode?e.$dialog.confirm({title:"提示",message:i.message}).then(function(){return"100"===i.errorCode?e.createBreakBill(i.storeBillDetailDTO):e.getItemByTwoCode(t,!0).then(function(t){return e.getScanGoodData(t.storeBillDetailDTO)})}):e.getScanGoodData(i.storeBillDetailDTO)})},getItemByTwoCode:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new u.a(function(o){var n={qrCodeContent:t,houseId:e.shopHouseDTO.id,outHouseId:e.outHouse.id,billType:32,nextFlag:i};e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.inShopId,"/users/").concat(e.loginerId,"/getscancodedata"),query:n}).then(function(t){o(t)})})},getScanGoodData:function(t){t.autoType=3,t.costPrice=this.toFixedNumberSize(t.outMoney/t.busUnitOutAmount),this.setScanGood(t)},setScanGood:function(t){var e=this,i=[];i=this.selectedItemArr;var o=i.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id&&"del"!==e.changeType});if(~o){var n=i.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id&&t.unitDTO.id===e.unitDTO.id&&"del"!==e.changeType});if(!~n)return this.$fxToast.fail("不能重复添加品项！"),!1;var s=i[o];if(s.batchCode!==t.batchCode&&this.$fxUtils.isDef(s.batchCode)&&""!==s.batchCode)return this.$fxToast.fail("不能重复添加品项！"),!1;var a=t.busUnitOutAmount;this.$refs.scanActionSheet.doSelect().then(function(i){"累加数量"===i.name&&e.computedScanItemAmount(t,s),e.refreshSelectItem(t,s,a),e.itemList=[t]})}else this.itemList=[t],this.pushSelectedItem(t),this.$fxToast.success("扫码添加品项成功！")},computedScanItemAmount:function(t,e){var i=this.toFixedNumberSize(t.busUnitOutAmount+e.busUnitOutAmount);t.busUnitOutAmount=this.$fxCommon.checkAmountRange(i)},refreshSelectItem:function(t,e,i){e.busUnitOutAmount=t.busUnitOutAmount,e.batchCode=t.batchCode,this.editItem(e),this.calcMoney("amount",e.busUnitOutAmount,e),e.costPrice=this.toFixedNumberSize(t.outMoney/i),e.outMoney=this.toFixedNumberSize(t.busUnitOutAmount*e.costPrice)},editItem:function(t){t.id&&this.$set(t,"changeType","edit")}}},x=D,y=(i("7f7b"),i("2877")),C=Object(y["a"])(x,o,n,!1,null,"94f198d4",null);e["a"]=C.exports},5307:function(t,e,i){"use strict";var o=i("f3e9"),n=i.n(o);n.a},5402:function(t,e,i){"use strict";var o=i("73b7"),n=i.n(o);n.a},"5c5e":function(t,e,i){},"6b4b":function(t,e,i){"use strict";var o=i("e7e2"),n=i.n(o);n.a},7108:function(t,e,i){"use strict";var o=i("2ed7"),n=i.n(o);n.a},"71af":function(t,e,i){},"73b7":function(t,e,i){},7987:function(t,e,i){"use strict";var o=i("35ce"),n=i.n(o);n.a},"7d3b":function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-uniformDistributionOut"},[i("w-header",{attrs:{title:"统配出库单",border:!0}},[i("headEditBtn",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionOutBill.check"),expression:"$fxAuth('distributionOutBill.check')"}],attrs:{slot:"header-right",active:t.orderEditFlag},on:{click:t.onOrderEditClick},slot:"header-right"}),i("headSearchBtn",{directives:[{name:"show",rawName:"v-show",value:!t.orderEditFlag,expression:"!orderEditFlag"}],attrs:{slot:"header-right"},on:{click:t.onSearchClick},slot:"header-right"}),i("headSelectAllBtn",{directives:[{name:"show",rawName:"v-show",value:t.orderEditFlag,expression:"orderEditFlag"}],attrs:{slot:"header-right",active:t.isSelectAll},on:{click:t.onSelectAllClick},slot:"header-right"})],1),i("filterTab",{attrs:{state:t.computedState,billReState:t.computedBillReState},on:{"on-state-click":t.onStateClick,"on-billReState-click":t.onBillReStateClick}}),i("div",{staticClass:"uniformDistributionOut-content"},[i("van-pull-refresh",{directives:[{name:"show",rawName:"v-show",value:0!==t.orderList.length,expression:"orderList.length !== 0"}],staticClass:"uniformDistributionOut-list",on:{refresh:t.onPullRefresh},model:{value:t.pullRefreshLoading,callback:function(e){t.pullRefreshLoading=e},expression:"pullRefreshLoading"}},[i("van-list",{attrs:{finished:t.loadFinished,"finished-text":"没有更多了",error:t.listError,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.listError=e},load:t.onLoadMore},model:{value:t.listLoading,callback:function(e){t.listLoading=e},expression:"listLoading"}},t._l(t.orderList,function(e){return i("orderBlock",{directives:[{name:"show",rawName:"v-show",value:t.computedShowOrder(e.billState),expression:"computedShowOrder(item.billState)"}],key:e.id,attrs:{data:e,showCheckBox:t.orderEditFlag},on:{"on-click":function(i){return t.onClickOrder(e)}}})}),1)],1),i("emptyBill",{directives:[{name:"show",rawName:"v-show",value:0===t.orderList.length,expression:"orderList.length === 0"}]})],1),i("div",{staticClass:"uniformDistributionOut-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.orderEditFlag&&t.$fxAuth("distributionOutBill.add"),expression:"!orderEditFlag && $fxAuth('distributionOutBill.add')"}],staticClass:"add-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onCreateClick}},[t._v("添加单据")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.orderEditFlag&&t.$fxAuth("distributionOutBill.check"),expression:"orderEditFlag && $fxAuth('distributionOutBill.check')"}],staticClass:"add-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onExpressClick}},[t._v("批量审核")])],1),i("van-actionsheet",{attrs:{actions:t.stateActions,"cancel-text":"取消"},on:{select:t.onStateSelect},model:{value:t.stateActionShow,callback:function(e){t.stateActionShow=e},expression:"stateActionShow"}}),i("van-actionsheet",{attrs:{actions:t.billReStateActions,"cancel-text":"取消"},on:{select:t.onUrgencySelect},model:{value:t.billReStateActionShow,callback:function(e){t.billReStateActionShow=e},expression:"billReStateActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.filterPopShow,callback:function(e){t.filterPopShow=e},expression:"filterPopShow"}},[i("filterPop",{attrs:{visibleFlag:t.filterPopShow,filterParams:t.filterParams},on:{"update:visibleFlag":function(e){t.filterPopShow=e},"update:visible-flag":function(e){t.filterPopShow=e},"update:filterParams":function(e){t.filterParams=e},"update:filter-params":function(e){t.filterParams=e},"on-confirm":t.onFilterConfirm}})],1)],1)},n=[],s=(i("ac6a"),i("75fc")),a=i("5176"),r=i.n(a),c=i("795b"),l=i.n(c),u=(i("7514"),i("7f7f"),i("cebc")),d=(i("6762"),i("2f62")),h=i("b215"),f=i("46aa"),m=i("a0be"),p=i("4102"),v=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-block fx-shadow-block",on:{click:t.onClick}},[i("checkBox",{staticClass:"order-checkbox",attrs:{visibleFlag:t.showCheckBox,checked:t.data.checked},on:{"on-checkbox-click":t.onClick}}),i("div",{staticClass:"block-content"},[i("div",{staticClass:"block-title"},[i("i",{staticClass:"block-icon"}),i("span",{staticClass:"title-text"},[t._v(t._s(t.data.rdcDTO.name))]),i("stateTag",{staticClass:"state-tag",attrs:{billState:t.data.billState,reCheckState:t.data.billReState}}),i("i",{directives:[{name:"show",rawName:"v-show",value:t.data.expressFlag,expression:"data.expressFlag"}],staticClass:"block-urgency fl-r"})],1),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No"},[t._v(t._s(t.data.inShopDTO.name))]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionOutBill.seeWithTaxMoney"),expression:"$fxAuth('distributionOutBill.seeWithTaxMoney')"}],staticClass:"order-date fx-price-font"},[i("span",[t._v("含税金额：")]),i("span",[t._v("￥"+t._s(t.toFixedNumberSize(t.data.sumSendMoney)))])])]),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No"},[i("span",[t._v("明细数：")]),i("span",[t._v(t._s(t.data.detailCount))])]),i("div",{staticClass:"order-date"},[i("span",[t._v("业务日期：")]),i("span",[t._v(t._s(t._f("filterDateYMD")(t.data.businessDate)))]),i("van-icon",{staticClass:"order-date-arrow",attrs:{name:"arrow"}})],1)])])],1)},b=[],S=i("59ad"),g=i.n(S),D=i("0f38"),x=i("0b26"),y={name:"orderBlock",components:{stateTag:x["a"],checkBox:D["a"]},props:{data:{type:Object,default:function(){return{}}},showCheckBox:{type:Boolean,default:!1}},computed:Object(u["a"])({},Object(d["c"])({sysMoneyPointSize:"sysMoneyPointSize"}),{toFixedNumberSize:function(t){var e=this;return function(t){return g()(e.$fxUtils.toFixedSHW(t,e.sysMoneyPointSize))}}}),methods:{onClick:function(){this.showCheckBox?this.$set(this.data,"checked",!this.data.checked):this.$emit("on-click",this.data)}}},C=y,w=(i("7987"),i("2877")),I=Object(w["a"])(C,v,b,!1,null,"43d80668",null),T=I.exports,O=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"filter-popup"},[i("w-header",{attrs:{title:"筛选条件",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{ref:"filterContent",staticClass:"filter-content"},[i("van-cell-group",[i("van-cell",{attrs:{title:"业务日期"}}),i("van-cell",{attrs:{title:"起始时间",value:t.beginDate,"is-link":""},on:{click:t.onBeginDateClick}}),i("van-cell",{attrs:{title:"结束时间",value:t.endDate,"is-link":""},on:{click:t.endDateClick}}),i("van-cell",{attrs:{title:"到货日期"}}),i("van-cell",{attrs:{title:"起始时间",value:t.arriveBeginDate,"is-link":""},on:{click:t.onArriveBeginDateClick}}),i("van-cell",{attrs:{title:"结束时间",value:t.arriveEndDate,"is-link":""},on:{click:t.onArriveEndDateClick}}),i("van-cell",{attrs:{title:"配送中心",value:t.rdc.name,"value-class":"info-item-value","is-link":""},on:{click:t.onRdcClick}}),i("van-cell",{attrs:{title:"门店",value:t.inShop.name,"value-class":"info-item-value","is-link":""},on:{click:t.onInShopClick}}),i("van-cell",{attrs:{title:"仓库",value:t.house.name,"value-class":"info-item-value","is-link":""},on:{click:t.onHouseClick}}),i("van-cell",{attrs:{title:"品项",value:t.goods.name,"value-class":"info-item-value","is-link":""},on:{click:t.onGoodsClick}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.$fxSysAuth("distributionOutBill.seeBillType"),expression:"$fxSysAuth('distributionOutBill.seeBillType')"}],attrs:{title:"单据类型",value:t.billType.name,"value-class":"info-item-value"},on:{click:t.onBillTypeClick}},[i("van-icon",{staticClass:"item-clear-btn",attrs:{slot:"right-icon",name:t.billType.id?"close":"arrow"},on:{click:function(e){e.stopPropagation(),t.billType.id?t.onBillTypeClearClick():t.onBillTypeClick()}},slot:"right-icon"})],1),i("van-field",{ref:"billNo",attrs:{label:"系统单号","value-class":"info-item-value",placeholder:"请输入系统单号","input-align":"right"},on:{focus:function(e){return t.onFocus("billNo")}},model:{value:t.billNo,callback:function(e){t.billNo=e},expression:"billNo"}})],1)],1),i("div",{staticClass:"filter-bottom"},[i("van-button",{staticClass:"reset-btn fx-no-radius",attrs:{type:"info"},on:{click:t.onResetClick}},[t._v("重置")]),i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onConfirmClick}},[t._v("确定")])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("filterListPopup",{attrs:{title:"配送中心检索",rollingLoad:!0,getDataApi:t.getRdcListData},on:{"on-select":function(e){return t.selectRdc(arguments)}},model:{value:t.rdcPopShow,callback:function(e){t.rdcPopShow=e},expression:"rdcPopShow"}}),i("filterListPopup",{attrs:{title:"门店检索",rollingLoad:!0,getDataApi:t.getShopListData},on:{"on-select":function(e){return t.selectInShop(arguments)}},model:{value:t.inShopPopShow,callback:function(e){t.inShopPopShow=e},expression:"inShopPopShow"}}),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right"},model:{value:t.housePopShow,callback:function(e){t.housePopShow=e},expression:"housePopShow"}},[i("listComp",{attrs:{visibleFlag:t.housePopShow,data:t.houseList,title:"仓库检索",loadFinished:!0},on:{"update:visibleFlag":function(e){t.housePopShow=e},"update:visible-flag":function(e){t.housePopShow=e},"on-select":t.selectHouse,"on-search":t.searchHouse}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right"},model:{value:t.goodsPopShow,callback:function(e){t.goodsPopShow=e},expression:"goodsPopShow"}},[i("listComp",{attrs:{visibleFlag:t.goodsPopShow,data:t.goodsList,title:"品项检索",loading:t.goodsLoading,loadFinished:t.goodsLoadFinished},on:{"update:visibleFlag":function(e){t.goodsPopShow=e},"update:visible-flag":function(e){t.goodsPopShow=e},"update:loading":function(e){t.goodsLoading=e},"on-select":t.selectGoods,"on-search":t.searchGoods,"on-load":t.loadGoodsList}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right"},model:{value:t.billTypePopShow,callback:function(e){t.billTypePopShow=e},expression:"billTypePopShow"}},[i("listComp",{attrs:{visibleFlag:t.billTypePopShow,data:t.billTypeList,title:"单据类型检索",loadFinished:!0},on:{"update:visibleFlag":function(e){t.billTypePopShow=e},"update:visible-flag":function(e){t.billTypePopShow=e},"on-select":t.selectBillType,"on-search":t.searchBillType}})],1)],1)},k=[],P=i("768b"),A=i("f6bb"),F=i("eb03"),B=50,$={name:"FilterPop",components:{listComp:A["a"],filterListPopup:F["a"]},props:{visibleFlag:Boolean,filterParams:{type:Object,default:function(){return{}}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},currentDate:new Date,datePickerShow:!1,beginDate:this.$fxCommon.orderFilterStartDate(),endDate:this.$fxCommon.orderFilterEndDate(),arriveBeginDate:"",arriveEndDate:"",rdc:{name:"请选择"},rdcPopShow:!1,inShop:{name:"请选择"},inShopList:[],inShopPopShow:!1,house:{name:"请选择"},houseList:[],housePopShow:!1,goods:{name:"请选择"},goodsListStart:0,goodsList:[],goodsLoading:!1,goodsLoadFinished:!1,goodsPopShow:!1,searchGoodsKeyword:"",billType:{name:"请选择"},billTypeList:[],billTypePopShow:!1,billNo:""}},watch:{visibleFlag:{handler:function(t){this.datePickerShow=!1,t&&this.$fxUtils.isEmptyObjSHW(this.filterParams)&&this.resetHandler()},immediate:!0}},computed:Object(u["a"])({},Object(d["c"])({loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}})),methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onArriveBeginDateClick:function(){this.dateType="arriveBegin",this.arriveBeginDate&&(this.currentDate=new Date(this.arriveBeginDate)),this.datePickerShow=!0},onArriveEndDateClick:function(){this.dateType="arriveEnd",this.arriveEndDate&&(this.currentDate=new Date(this.arriveEndDate)),this.datePickerShow=!0},onBeginDateClick:function(){this.datePickerShow=!0,this.beginDate&&(this.currentDate=new Date(this.beginDate)),this.dateType="begin"},endDateClick:function(){this.datePickerShow=!0,this.endDate&&(this.currentDate=new Date(this.endDate)),this.dateType="end"},dateConfirmhandle:function(t){"begin"===this.dateType?(this.beginDate=this.$fxUtils.setDateTime(t,"时分"),this.endDate&&this.$fxCommon.orderFilterRangeDate(this.beginDate,this.endDate)||(this.endDate=this.$fxCommon.orderFilterDate(t))):"end"===this.dateType?(this.endDate=this.$fxUtils.setDateTime(t,"时分"),this.beginDate&&this.$fxCommon.orderFilterRangeDate(this.beginDate,this.endDate)||(this.beginDate=this.$fxCommon.orderFilterStartDate(t))):"arriveBegin"===this.dateType?(this.arriveBeginDate=this.$fxUtils.setDateTime(t,"时分"),this.arriveEndDate&&this.$fxCommon.orderFilterRangeDate(this.arriveBeginDate,this.arriveEndDate)||(this.arriveEndDate=this.$fxCommon.orderFilterDate(t))):"arriveEnd"===this.dateType&&(this.arriveEndDate=this.$fxUtils.setDateTime(t,"时分"),this.arriveBeginDate&&this.$fxCommon.orderFilterRangeDate(this.arriveBeginDate,this.arriveEndDate)||(this.arriveBeginDate=this.$fxCommon.orderFilterStartDate(t))),this.datePickerShow=!1},onRdcClick:function(){this.rdcPopShow=!0},selectRdc:function(t){var e=Object(P["a"])(t,1),i=e[0];this.rdc=i},getRdcListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,o={keyword:t,start:e,size:i,orgFlag:1};return this.$fxApi("z5common.getUserManageShop")({data:o}).then(function(t){return t.shops})},onInShopClick:function(){this.inShopPopShow=!0},selectInShop:function(t){var e=Object(P["a"])(t,1),i=e[0];this.inShop=i},getShopListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,o={keyword:t,start:e,size:i,orgFlag:0};return this.$fxApi("z5common.getUserManageShop")({data:o}).then(function(t){return t.shops})},onHouseClick:function(){var t=this;if(!this.inShop.id)return this.$fxToast.fail("请先选择门店!"),!1;this.getHouseListData().then(function(e){t.houseList=e.shops,t.housePopShow=!0})},selectHouse:function(t){this.house=t},searchHouse:function(t){var e=this;this.getHouseListData(t).then(function(t){e.houseList=t.shops})},getHouseListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new l.a(function(i){var o={keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.inShop.id,"/users/").concat(t.loginerId,"/houses"),data:o}).then(function(t){i(t)})})},onGoodsClick:function(){var t=this;this.goodsListStart=0,this.searchGoodsKeyword="",this.getGoodsListData().then(function(e){t.goodsLoading=!1,t.goodsPopShow=!0,t.goodsList=e.goods})},selectGoods:function(t){this.goods=t},searchGoods:function(t){var e=this;this.goodsListStart=0,this.searchGoodsKeyword=t,this.getGoodsListData(t).then(function(t){t.goods.length<B&&(e.goodsLoadFinished=!0),e.goodsList=t.goods})},loadGoodsList:function(){var t=this;!0!==this.goodsLoadFinished&&(this.goodsListStart=this.goodsListStart+B,this.getGoodsListData(this.searchGoodsKeyword).then(function(e){var i;t.goodsLoading=!1,e.goods.length<B&&(t.goodsLoadFinished=!0),(i=t.goodsList).push.apply(i,Object(s["a"])(e.goods))}))},getGoodsListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new l.a(function(i){var o={start:t.goodsListStart,size:B,paged:!0,m:"list4ShopOrderBill",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/goods"),data:o}).then(function(t){i(t)})})},onBillTypeClick:function(){var t=this;this.getBillTypeListData().then(function(e){t.billTypeList=e.businessTypes,t.billTypePopShow=!0})},selectBillType:function(t){this.billType=t},searchBillType:function(t){var e=this;this.getBillTypeListData(t).then(function(t){e.billTypeList=t.businessTypes})},getBillTypeListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new l.a(function(i){var o={m:"list4DistributionOutListBill",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/businessTypes"),data:o}).then(function(t){i(t)})})},onResetClick:function(){this.resetHandler()},resetHandler:function(){this.beginDate=this.$fxCommon.orderFilterStartDate(),this.endDate=this.$fxCommon.orderFilterEndDate(),this.arriveBeginDate="",this.arriveEndDate="",this.datePickerShow=!1,this.rdc={name:"请选择"},this.inShop={name:"请选择"},this.house={name:"请选择"},this.billType={name:"请选择"},this.goods={name:"请选择"},this.billNo=""},onConfirmClick:function(){this.$emit("update:visibleFlag",!1),this.$emit("update:filterParams",this.getFilterParams()),this.$emit("on-confirm",this.getFilterParams())},getFilterParams:function(){return{beginDate:this.beginDate||this.$fxCommon.orderFilterStartDate(),endDate:this.endDate||this.$fxCommon.orderFilterEndDate(),arriveBeginDate:this.arriveBeginDate||"",arriveEndDate:this.arriveEndDate||"",rdcId:this.rdc.id,inShopId:this.inShop.id,houseId:this.house.id,billTypeId:this.billType.id,goodsId:this.goods.id,billNo:this.billNo}},onFocus:function(t){this.onScrollTop(t)},onScrollTop:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,i=this.$refs[t];if(!i||0===i.length)return!1;var o=i.$el.offsetTop,n=this.$refs["filterContent"];this.$fxUtils.scrollTopW({offsetTop:o,$el:n,distance:e})},onBillTypeClearClick:function(){this.billType={name:"请选择",id:""}}}},N=$,L=(i("7108"),Object(w["a"])(N,O,k,!1,null,"70f44997",null)),E=L.exports,H=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"uniformDistributionOut-filter fx-shadow-down"},[i("div",{staticClass:"filter-item",on:{click:t.onStateClick}},[i("span",[t._v("审核状态")]),i("van-icon",{staticClass:"filter-arrow",attrs:{name:"arrow-down"}}),i("span",[t._v(t._s(t.state))])],1),i("div",{staticClass:"filter-item",on:{click:t.onBillReStateClick}},[i("span",[t._v("复审状态")]),i("van-icon",{staticClass:"filter-arrow",attrs:{name:"arrow-down"}}),i("span",[t._v(t._s(t.billReState))])],1)])},z=[],R={name:"filterTab",props:{state:String,billReState:String},methods:{onStateClick:function(){this.$emit("on-state-click")},onBillReStateClick:function(){this.$emit("on-billReState-click")}}},U=R,M=(i("b739"),Object(w["a"])(U,H,z,!1,null,"d433ebb8",null)),_=M.exports,j=50,W={name:"uniformDistributionOut",components:{headSearchBtn:h["a"],headEditBtn:f["a"],headSelectAllBtn:m["a"],emptyBill:p["a"],orderBlock:T,filterPop:E,filterTab:_},data:function(){return{orderList:[],filterPopShow:!1,filterState:null,stateActionShow:!1,stateActions:[{id:null,name:"全部"},{id:"0",name:"未审核"},{id:"1",name:"已审核"}],filterBillReState:null,billReStateActionShow:!1,billReStateActions:[{id:null,name:"全部"},{id:"0",name:"未复审"},{id:"1",name:"已复审"}],listStart:0,pullRefreshLoading:!1,listLoading:!1,loadFinished:!0,listError:!1,orderEditFlag:!1,filterParams:{}}},beforeRouteLeave:function(t,e,i){if("/login"===t.path)i();else{if(this.filterPopShow)return this.filterPopShow=!1,this.$router.go(1),!1;i()}},beforeRouteEnter:function(t,e,i){var o=["/main/home","/"],n=["/uniformDistributionOutDetails"];o.includes(e.path)?i(function(e){e.restFilterParams(),e.restRouterParams(t.params),e.refreshOrderList()}):n.includes(e.path)?i(function(t){t.refreshOrderList()}):i()},computed:Object(u["a"])({},Object(d["c"])({billListPostParams:"billListPostParams",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{computedState:function(){var t=this;return this.stateActions.find(function(e){return e.id===t.filterState}).name},computedBillReState:function(){var t=this;return this.billReStateActions.find(function(e){return e.id===t.filterBillReState}).name},computedShowOrder:function(t){var e=this;return function(t){return!e.orderEditFlag||1!==t}},isSelectAll:function(){var t=this.orderList.filter(function(t){return 1!==t.billState});if(0===t.length)return!1;var e=t.filter(function(t){return!!t.checked});return e.length===t.length}}),methods:{orderListPostHandler:function(t){var e=this;return new l.a(function(i){e.$store.commit({type:"SETSTATE",billListPostParams:t}),e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/distributionOutBills/users/").concat(e.loginerId),data:t}).then(function(t){i(t)})})},refreshOrderList:function(){var t=this;return new l.a(function(e){t.listStart=0;var i={start:t.listStart,size:j,paged:!0,businessDateStart:t.$fxCommon.orderFilterStartDate(),businessDateEnd:t.$fxCommon.orderFilterEndDate(),billState:t.filterState,reCheckState:t.filterBillReState};i=r()(i,t.translateFilterParams(t.filterParams)),t.orderListPostHandler(i).then(function(i){t.orderList=i.storeBills,e(i)})})},onFilterConfirm:function(t){var e=this;this.listStart=0;var i={start:this.listStart,size:j,paged:!0,businessDateStart:t.beginDate,businessDateEnd:t.endDate,arriveDateStart:t.arriveBeginDate,arriveDateEnd:t.arriveEndDate,billState:this.filterState,reCheckState:this.filterBillReState,rdcId:""===t.rdcId?null:t.rdcId,inShopId:""===t.inShopId?null:t.inShopId,houseId:""===t.houseId?null:t.houseId,goodsId:""===t.goodsId?null:t.goodsId,businessType:""===t.billTypeId?null:t.billTypeId,sysBillCode:""===t.billNo?null:t.billNo};this.orderListPostHandler(i).then(function(t){e.orderList=t.storeBills})},translateFilterParams:function(t){return this.$fxUtils.isEmptyObjSHW(t)?{}:{businessDateStart:t.beginDate,businessDateEnd:t.endDate,arriveDateStart:t.arriveBeginDate,arriveDateEnd:t.arriveEndDate,rdcId:""===t.rdcId?null:t.rdcId,inShopId:""===t.inShopId?null:t.inShopId,houseId:""===t.houseId?null:t.houseId,goodsId:""===t.goodsId?null:t.goodsId,businessType:""===t.billTypeId?null:t.billTypeId,sysBillCode:""===t.billNo?null:t.billNo}},onPullRefresh:function(){var t=this;this.refreshOrderList().then(function(e){t.pullRefreshLoading=!1})},onLoadMore:function(){var t=this,e=r()(this.billListPostParams,{start:this.listStart});this.orderListPostHandler(e).then(function(e){var i;(i=t.orderList).push.apply(i,Object(s["a"])(e.storeBills))})},onSearchClick:function(){this.filterPopShow=!0},onStateClick:function(){this.stateActionShow=!0},onStateSelect:function(t){this.filterState=t.id,this.stateActionShow=!1,this.refreshOrderList()},onBillReStateClick:function(){this.billReStateActionShow=!0},onUrgencySelect:function(t){this.filterBillReState=t.id,this.billReStateActionShow=!1,this.refreshOrderList()},onClickOrder:function(t){this.$router.push({path:"uniformDistributionOutDetails",query:{orderId:t.id}})},onCreateClick:function(){this.$router.push("createUniformDistributionOut")},onOrderEditClick:function(){this.orderEditFlag=!this.orderEditFlag},onExpressClick:function(){var t=this,e=this.orderList.reduce(function(t,e){var i=e.checked?t.concat(e.id):t;return i},[]);if(0===e.length)return!1;this.$dialog.confirm({title:"提示",message:"确定要审核所选单据?"}).then(function(){t.expressBillList()})},expressBillList:function(){var t=this.orderList.reduce(function(t,e){var i=e.checked?t.concat(e.id):t;return i},[]);if(0===t.length)return!1;this.expressHandler(t)},expressHandler:function(t){var e=this,i={billIds:t,otherCheck:1};this.expressRequest(i).then(function(t){e.refreshOrderList().then(function(){e.$fxToast.success("审核成功")})}).catch(function(t){"1"===t.errorCode?(e.$dialog.alert({title:"提示",message:t.message}),e.refreshOrderList()):"otherCheck"===t.errorCode?e.$dialog.confirm({title:"提示",message:t.message+"，继续审核吗？"}).then(function(){i.otherCheck=0,e.expressRequest(i).then(function(t){e.refreshOrderList().then(function(){e.$fxToast.success("审核成功")})}).catch(function(t){e.$dialog.alert({title:"提示",message:t.message}),e.refreshOrderList()})}):e.$dialog.alert({title:"提示",message:t.message})})},expressRequest:function(t){var e=this;return new l.a(function(i,o){e.$fxHttp.requestPut({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/distributionOutBills/users/").concat(e.loginerId),data:t,query:{m:"batchCheck"},autoErrorMsg:!1}).then(function(t){i(t)}).catch(function(t){o(t)})})},onSelectAllClick:function(){var t=this,e=!this.isSelectAll;this.orderList.forEach(function(i){1!==i.billState&&t.$set(i,"checked",e)})},restFilterParams:function(){this.filterParams={},this.filterState=null,this.filterBillReState=null,this.orderEditFlag=!1},restRouterParams:function(t){this.$fxUtils.isEmptyObjSHW(t)||(this.filterState=t.billState)}}},q=W,G=(i("0ea3"),Object(w["a"])(q,o,n,!1,null,"110aa306",null));e["default"]=G.exports},"7f7b":function(t,e,i){"use strict";var o=i("71af"),n=i.n(o);n.a},8233:function(t,e,i){},"86ac":function(t,e,i){"use strict";var o=i("e3ab"),n=i.n(o);n.a},"8c37":function(t,e,i){},"95a8":function(t,e,i){"use strict";var o=i("fd54"),n=i.n(o);n.a},"9c7f":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-detail-cell",class:{"is-active":t.rowActive===t.itemIndex,"is-error":t.isError},on:{click:t.onItemClick}},[i("div",{staticClass:"item-details-img"},[i("w-img",{attrs:{src:t.itemData.goodsDTO.imageUrls}})],1),i("div",{staticClass:"item-details-params"},[i("div",{staticClass:"item-details-name fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.name))]),t.sysShowCode?i("div",{staticClass:"item-details-name fx-ellipsis"},[t._v("编号："+t._s(t.itemData.goodsDTO.code))]):t._e(),i("div",{staticClass:"item-details-spec fx-ellipsis"},[t._v("\n\t\t\t"+t._s(t.showBom?t.itemData.bomDTO.name:"")+"\n\t\t\t"+t._s(!t.showBom&&t.showSpec?t.itemData.goodsDTO.spec:"")+"\n\t\t")]),i("div",{staticClass:"item-details-amount"},[i("span",{staticClass:"item-details-count"},[t._v(t._s(t.getItemAmount()))]),i("span",{staticClass:"item-details-unit"},[t._v(t._s(t.itemData.unitDTO.name))])]),i("i",{directives:[{name:"show",rawName:"v-show",value:t.getItemAmount()>0||t.isActive,expression:"(getItemAmount()>0 || isActive)"}],staticClass:"item-selected-icon"})])])},n=[],s=i("cebc"),a=(i("c5f6"),i("2f62")),r={name:"addItemCell",props:{itemData:{type:Object,default:function(){return{}}},itemIndex:Number,rowActive:[Number,String],isActive:Boolean,isError:Boolean,showBom:{type:Boolean,default:!1},showSpec:{type:Boolean,default:!0},itemAmoutName:{type:String,default:""}},computed:Object(s["a"])({},Object(a["c"])({sysShowCode:function(t){return t.systemParams.sysShowCode}})),methods:{onItemClick:function(){this.$emit("on-item-click",this.itemIndex)},getItemAmount:function(){return""===this.itemAmoutName?this.itemData.busUnitAmount:this.itemData[this.itemAmoutName]}}},c=r,l=(i("3e54"),i("2877")),u=Object(l["a"])(c,o,n,!1,null,"70501ba1",null);e["a"]=u.exports},"9cfb":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"store-item"},[i("w-header",{attrs:{title:"编辑统配出库单明细",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{staticClass:"add-store-bar"},[t.currentOutHouseObj.id?i("van-button",{staticClass:"add-store-btn",attrs:{disabled:!t.$fxSysAuth("distributionOutBill.sysMultiOutHouseForTPC"),type:"primary",round:""},on:{click:t.onAddOutHouseClick}},[t._v(t._s(t.currentOutHouseObj.name))]):i("van-button",{staticClass:"add-store-btn",attrs:{type:"primary",round:""},on:{click:t.onAddOutHouseClick}},[t._v("添加发货仓库")])],1),i("div",{staticClass:"add-store-bar"},[i("van-button",{staticClass:"add-store-btn",attrs:{type:"primary",round:""},on:{click:t.onAddShopHouseClick}},[t._v("添加收货仓库")])],1),i("div",{staticClass:"store-item-content"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeStoreNames,callback:function(e){t.activeStoreNames=e},expression:"activeStoreNames"}},t._l(t.currentStoreItemData,function(e,o){return i("van-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.storeShowComputed(e),expression:"storeShowComputed(storeItem)"}],key:e.id+"-"+e.shopHouseDTO.id,staticClass:"store-row",attrs:{name:e.id+"-"+e.shopHouseDTO.id}},[i("div",{staticClass:"item-store-title",attrs:{slot:"title"},slot:"title"},[i("span",{staticClass:"item-store-name fx-ellipsis"},[t._v("出库仓库："+t._s(e.name))]),i("span",{staticClass:"item-store-name fx-ellipsis"},[t._v("入库仓库："+t._s(e.shopHouseDTO.name))])]),i("div",{staticClass:"item-storn-btn"},[i("i",{staticClass:"edit-btn",on:{click:function(i){return t.editStoreItem(e)}}}),i("i",{staticClass:"delete-btn",on:{click:function(i){return t.deleteStoreItem(e,o)}}})]),t._l(e.details,function(t){return i("div",{directives:[{name:"show",rawName:"v-show",value:"del"!==t.changeType,expression:"item.changeType !== 'del'"}],key:e.shopHouseDTO.id+"-"+t.goodsDTO.id+"-"+t.goodsUUid,staticClass:"item-row"},[i("itemInfoCell",{attrs:{itemData:t,isDisabled:!0,disabledWatchBtn:!0,showEditBtn:!1}})],1)})],2)}),1)],1),i("div",{staticClass:"store-item-bottom"},[i("van-button",{staticClass:"save-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onSaveClick}},[t._v("保存")])],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.storePopShow,callback:function(e){t.storePopShow=e},expression:"storePopShow"}},[i("listComp",{attrs:{visibleFlag:t.storePopShow,data:t.storeList,loadFinished:!0,title:"仓库检索"},on:{"update:visibleFlag":function(e){t.storePopShow=e},"update:visible-flag":function(e){t.storePopShow=e},"on-search":t.searchStore,"on-select":t.selectStore}})],1)],1)},n=[],s=(i("7f7f"),i("5176")),a=i.n(s),r=(i("7514"),i("795b")),c=i.n(r),l=(i("ac6a"),i("cebc")),u=(i("c5f6"),i("2f62")),d=i("f6bb"),h=i("3a7d"),f={name:"storeItemComp",components:{listComp:d["a"],itemInfoCell:h["a"]},props:{visibleFlag:Boolean,inShopId:{type:String,default:""},rdcId:{type:String,default:""},businessDate:{type:[String,Number],default:""},storeItemData:{type:Array,default:function(){return[]}},autoType:{type:Number,default:1}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},storePopShow:!1,storeList:[],currentOutHouseObj:{},currentShopHouseObj:{},currentStoreObj:{},currentStoreItemData:[],listCompType:"",activeStoreNames:[]}},computed:Object(l["a"])({},Object(u["c"])({loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{storeShowComputed:function(t){return function(t){var e=t.details.filter(function(t){return"del"!==t.changeType}).length;return e>0}}}),watch:{visibleFlag:{handler:function(t){if(t){this.resetHandler(),this.currentStoreItemData=this.storeItemData;var e=0,i={};this.storeItemData.forEach(function(t){e+=t.details.filter(function(t){return"del"!==t.changeType&&(i=t.outHouseDTO,!0)}).length}),e>0&&!this.$fxSysAuth("distributionOutBill.sysMultiOutHouseForTPC")&&(this.currentOutHouseObj=i),this.openStoreItemList(this.currentStoreItemData),this.setDetailGoodsUUid(this.currentStoreItemData)}},immediate:!0}},methods:{setDetailGoodsUUid:function(t){var e=this;t.forEach(function(t){t.details.forEach(function(t){t.goodsUUid=e.$fxUtils.createUUID()})})},resetHandler:function(){this.currentOutHouseObj={},this.currentShopHouseObj={},this.currentStoreItemData=[]},onCloseClick:function(){this.$emit("update:visibleFlag",!1)},clearItemConfim:function(t){var e=this;return new c.a(function(i){var o=e.currentStoreItemData.filter(function(t){var e=t.details.filter(function(t){return"del"!==t.changeType});return 0!==e.length});0===o.length?i():e.$dialog.confirm({title:"提示",message:t}).then(function(){e.onItemClear(),i()}).catch(function(){})})},onAddOutHouseClick:function(){var t=this.currentStoreItemData.find(function(t){return t.details.find(function(t){return"del"!==t.changeType})});return!(t&&!this.$fxSysAuth("distributionOutBill.sysMultiOutHouseForTPC"))&&(1===this.autoType&&void this.onOutHouseRefresh())},onOutHouseRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.listCompType="outHouse",this.getStoreListData(e).then(function(e){t.storeList=e.shops,t.storePopShow=!0})},getStoreListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i="",o="";return"outHouse"===this.listCompType?(i=this.rdcId,o="list4ShopOrderBill"):"shopHouse"===this.listCompType&&(i=this.inShopId,o="list4DistributionOutBillTC"),new c.a(function(n){var s={keyword:e,m:o};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(i,"/users/").concat(t.loginerId,"/houses"),data:s}).then(function(t){n(t)})})},onAddShopHouseClick:function(){if(1===this.autoType||6===this.autoType){if(!this.currentOutHouseObj.id)return this.$fxToast.top("请先选择发货仓库!"),!1;this.onShopHouseRefresh()}},onShopHouseRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.listCompType="shopHouse",this.getStoreListData(e).then(function(e){t.storeList=e.shops,t.storePopShow=!0})},searchStore:function(t){"outHouse"===this.listCompType?this.onOutHouseRefresh(t):"shopHouse"===this.listCompType&&this.onShopHouseRefresh(t)},selectStore:function(t){"outHouse"===this.listCompType?this.currentOutHouseObj=t:"shopHouse"===this.listCompType&&(this.currentShopHouseObj=t,this.$emit("on-select-store",this.currentOutHouseObj,this.currentShopHouseObj),this.$emit("update:visibleFlag",!1)),this.listCompType=""},editStoreItem:function(t){this.currentOutHouseObj=a()({},{code:t.code,id:t.id,name:t.name,pinYin:t.pinYin,updateIndicator:t.updateIndicator}),this.currentShopHouseObj=a()({},{id:t.shopHouseDTO.id,code:t.shopHouseDTO.code,name:t.shopHouseDTO.name,pinYin:t.shopHouseDTO.pinYin}),this.$emit("on-select-store",this.currentOutHouseObj,this.currentShopHouseObj),this.$emit("update:visibleFlag",!1)},deleteStoreItem:function(t,e){var i=this;this.$dialog.confirm({title:"提示",message:"确定要删除当前仓库品项吗?"}).then(function(){var o=t.details.filter(function(t){return!!t.id});if(0===o.length)return i.currentStoreItemData.splice(e,1),!1;o.forEach(function(t){t.changeType="del"}),i.currentStoreItemData[e].details=o}).catch(function(){})},onSaveClick:function(){this.$emit("on-save",this.currentStoreItemData),this.$emit("update:visibleFlag",!1)},openStoreItemList:function(t){var e=this;t.forEach(function(t){var i=t.details.filter(function(t){return"del"!==t.changeType}).length;i>0&&e.activeStoreNames.push("".concat(t.id,"-").concat(t.shopHouseDTO.id))})}}},m=f,p=(i("baed"),i("2877")),v=Object(p["a"])(m,o,n,!1,null,"020c0436",null);e["a"]=v.exports},af41:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-number-keyboard fx-shadow-up"},[i("div",{staticClass:"number-keyboard-title"},[i("div",{staticClass:"title-name fx-ellipsis"},[t._v(t._s(t.title))]),i("div",{staticClass:"title-amount"},[t._v(t._s(t.amount))]),i("div",{staticClass:"title-unit",on:{click:t.onUnitClick}},[i("span",{staticClass:"title-unit-text fx-ellipsis"},[t._v(t._s(t.unit))]),i("i",{directives:[{name:"show",rawName:"v-show",value:t.unitEdit,expression:"unitEdit"}],staticClass:"title-unit-select"})])]),i("div",{staticClass:"number-keyboard-content"},[i("div",{staticClass:"keyboard-number"},[i("div",{staticClass:"keyboard-number-row"},[i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("1")}}},[t._v("1")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("2")}}},[t._v("2")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("3")}}},[t._v("3")]),i("i",{staticClass:"keyboard-btn-1 keyboard-btn-hide fx-Pseudo-btn",on:{click:t.hideKeyboardBtnClick}})]),i("div",{staticClass:"keyboard-number-row"},[i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("4")}}},[t._v("4")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("5")}}},[t._v("5")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("6")}}},[t._v("6")]),i("i",{staticClass:"keyboard-btn-1 keyboard-btn-del fx-Pseudo-btn",on:{click:t.delBtnClick}})]),i("div",{staticClass:"keyboard-number-row"},[i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("7")}}},[t._v("7")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("8")}}},[t._v("8")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("9")}}},[t._v("9")]),t.shortcutBtn?i("i",{staticClass:"keyboard-btn-1 keyboard-btn-pre fx-Pseudo-btn",on:{click:t.preBtnClick}},[t._v("上一个")]):i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn"})]),i("div",{staticClass:"keyboard-number-row"},[i("i",{staticClass:"keyboard-btn-2 keyboard-btn-zero fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("0")}}},[t._v("0")]),i("i",{staticClass:"keyboard-btn-1 keyboard-btn-dot fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick(".")}}},[t._v(".")]),t.shortcutBtn?i("i",{staticClass:"keyboard-btn-1 keyboard-btn-next fx-Pseudo-btn",on:{click:t.nextBtnClick}},[t._v("下一个")]):i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn"})])])])])},n=[],s=(i("3b2b"),i("c5f6"),{name:"itemNumberKeyboard",props:{title:String,unit:String,amount:[String,Number],unitEdit:{type:Boolean,default:!1},integer:Boolean,pointSize:{type:[String,Number],default:4},intLength:{type:[String,Number],default:8},shortcutBtn:{type:Boolean,default:!0}},computed:{computedNumberReg:function(){return new RegExp("^\\d+(\\.|\\.\\d{1,".concat(this.pointSize-1,"})?$"))}},methods:{numberBtnClick:function(t){this.$emit("input",t),this.$emit("change",this.getAddValue(t))},delBtnClick:function(t){this.$emit("delete"),this.$emit("change",this.getDelValue(t))},preBtnClick:function(){this.$emit("pre")},nextBtnClick:function(){this.$emit("next")},hideKeyboardBtnClick:function(){this.$emit("hide")},onUnitClick:function(){this.$emit("on-unit-unitEdit")},getAddValue:function(t){var e=this.amount+"";return-1===e.indexOf(".")&&e.length>=this.intLength&&"."!==t||-1!==e.indexOf(".")&&("."===t||!this.computedNumberReg.test(e))||"."===t&&this.integer?e:("0"===e&&"."!==t?e=t:e+=t,e)},getDelValue:function(t){var e=this.amount+"";return"0"===e?e:(e=1===e.length?"0":e.substr(0,e.length-1),e)}}}),a=s,r=(i("95a8"),i("2877")),c=Object(r["a"])(a,o,n,!1,null,"2fae3907",null);e["a"]=c.exports},b739:function(t,e,i){"use strict";var o=i("e009"),n=i.n(o);n.a},b91d:function(t,e,i){"use strict";var o=i("8233"),n=i.n(o);n.a},baed:function(t,e,i){"use strict";var o=i("fd12"),n=i.n(o);n.a},cc46:function(t,e,i){},ce82:function(t,e,i){},d444:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"add-item-class-content fx-vant-class-collapse"},[i("div",{staticClass:"all-class",class:{"is-active":""===t.value},on:{click:function(e){return e.stopPropagation(),t.selectClass("")}}},[t._v(t._s(t.classTitle))]),i("van-collapse",{attrs:{accordion:!0},model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},t._l(t.itemClassList,function(e){return i("van-collapse-item",{key:e.id,attrs:{name:e.id}},[i("div",{staticClass:"big-class",attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),t._l(e.smallType,function(e){return i("van-cell",{key:e.id,staticClass:"small-class",class:{"is-active":t.value===e.id},attrs:{title:e.name},on:{click:function(i){return i.stopPropagation(),t.selectClass(e.id)}}})})],2)}),1)],1)},n=[],s=(i("c5f6"),{name:"addItemClassList",props:{value:[String,Number],itemClassList:{type:Array,default:function(){return[]}},classTitle:{type:String,default:"全部品项"}},data:function(){return{activeNames:[]}},methods:{selectClass:function(t){this.$emit("input",t),this.$emit("on-select-class",t),this.$emit("on-change-class",[t,this.value])}}}),a=s,r=(i("5402"),i("2877")),c=Object(r["a"])(a,o,n,!1,null,"df69e854",null);e["a"]=c.exports},e009:function(t,e,i){},e3ab:function(t,e,i){},e7e2:function(t,e,i){},f007:function(t,e,i){"use strict";var o=i("cc46"),n=i.n(o);n.a},f330:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-search-block"},[i("w-header",{attrs:{title:"搜索品项",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("searchHead",{attrs:{initSearch:t.visibleFlag,searchKey:t.searchKey,selectActive:t.isSelectAll},on:{"update:searchKey":function(e){t.searchKey=e},"update:search-key":function(e){t.searchKey=e},"on-select-click":t.onSelectAllClick,"on-confirm-key":t.onConfirmKey}}),i("div",{ref:"details-content",staticClass:"item-list"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeStoreNames,callback:function(e){t.activeStoreNames=e},expression:"activeStoreNames"}},t._l(t.data,function(e){return i("van-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.storeShowComputed(e),expression:"storeShowComputed(storeItem)"}],key:e.id+"-"+e.shopHouseDTO.id,staticClass:"store-row",attrs:{name:e.id+"-"+e.shopHouseDTO.id}},[i("div",{staticClass:"item-store-title-container",attrs:{slot:"title"},slot:"title"},[i("w-icon",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&!t.isAutoType(9),expression:"!isDisabled && !isAutoType(9)"}],attrs:{type:"camera"},on:{click:function(i){return t.onCameraClick(e)}}}),i("div",{staticClass:"item-store-title"},[i("span",{staticClass:"store-left-name fx-ellipsis"},[t._v("出库仓库："+t._s(e.name))]),i("span",{staticClass:"store-right-name fx-ellipsis"},[t._v("入库仓库："+t._s(e.shopHouseDTO.name))])])],1),t._l(t.detailFilter(e.details),function(o,n){return i("van-swipe-cell",{directives:[{name:"show",rawName:"v-show",value:"del"!==o.changeType&&o.showFlag,expression:"item.changeType !== 'del' && item.showFlag"}],key:e.shopHouseDTO.id+"-"+o.goodsDTO.id+"-"+o.goodsUUid,ref:"details-row-"+e.shopHouseDTO.id+"-"+o.goodsDTO.id,refInFor:!0,staticClass:"item-row",attrs:{"right-width":80,disabled:t.isDisabled||t.focusing}},[i("div",{staticClass:"item-cell"},[i("checkBox",{staticClass:"search-checkbox",attrs:{visibleFlag:!t.isDisabled,checked:o.checked},on:{"on-checkbox-click":function(e){return t.onCheckBoxClick(o)}}}),i("itemInfoCell",{staticClass:"search-info",attrs:{itemData:o,isDisabled:t.isDisabled,disabledEditBtn:t.focusing},on:{"on-item-edit":t.onSearchItemEdit,"on-unit-edit":t.onUnitEdit,"on-item-focus":function(i){return t.onItemFocus(arguments,e.shopHouseDTO.id+"-"+o.goodsDTO.id)},"on-item-blur":t.onItemBlur}})],1),i("div",{staticClass:"item-row-delete",attrs:{slot:"right"},on:{click:function(i){return t.onDeleteClick(o,n,e.details)}},slot:"right"},[t._v("删除")])])})],2)}),1)],1),i("div",{staticClass:"search-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onSearchConfirm}},[t._v("保存")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:t.onSelectConfirm}},[t._v("删除")])],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,isDisabled:t.isDisabled},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("w-action-sheet",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.scanActionShow,expression:"scanActionShow"}],ref:"scanActionSheet",attrs:{actions:t.scanActions},model:{value:t.scanActionShow,callback:function(e){t.scanActionShow=e},expression:"scanActionShow"}})],1)},n=[],s=(i("7f7f"),i("795b")),a=i.n(s),r=i("59ad"),c=i.n(r),l=(i("20d6"),i("28a5"),i("7514"),i("6762"),i("2fdb"),i("6b54"),i("cebc")),u=(i("ac6a"),i("c5f6"),i("2f62")),d=i("3a7d"),h=i("060f"),f=i("01db"),m=i("0f38"),p={name:"itemSearchPop",components:{itemInfoCell:d["a"],itemRowEditPop:h["a"],searchHead:f["a"],checkBox:m["a"]},props:{data:{type:Array,default:function(){return[]}},inShopId:{type:String,default:""},rdcId:{type:String,default:""},isDisabled:Boolean,visibleFlag:Boolean,autoType:{type:Number,default:1}},data:function(){return{focusing:!1,leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",itemRowEditPopShow:!1,itemEditRowData:{},unitActions:[],unitActionShow:!1,activeStoreNames:[],scanActionShow:!1,scanActions:[{name:"累加数量"},{name:"覆盖数量"}],scanStoreItem:{}}},watch:{visibleFlag:{handler:function(t){var e=this;t&&(this.searchKey="",this.showData(this.data),this.setDetailGoodsUUid(this.data),this.data.forEach(function(t){var i=t.details.filter(function(t){return"del"!==t.changeType}).length;i>0&&e.activeStoreNames.push("".concat(t.id,"-").concat(t.shopHouseDTO.id))}))},immediate:!0}},computed:Object(l["a"])({},Object(u["c"])({sysPointSize:"sysPointSize",sysMoneyPointSize:"sysMoneyPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{isSelectAll:function(){var t=this;if(this.isDisabled)return"";var e=0,i=0;return this.data.forEach(function(o){var n=t.detailFilter(o.details);e+=n.filter(function(t){return"del"!==t.changeType&&t.checked}).length,i+=n.length}),0!==e&&e===i},isAutoType:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.autoType):e.autoType===t}}}),methods:{setDetailGoodsUUid:function(t){var e=this;t.forEach(function(t){t.details.forEach(function(t){t.goodsUUid=e.$fxUtils.createUUID()})})},storeShowComputed:function(t){return this.detailFilter(t.details).length>0},detailFilter:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"code,name,pinYin";return t.filter(function(t){return"del"!==t.changeType&&t.showFlag&&!!i.split(",").find(function(i){if(t.goodsDTO[i].toLowerCase().includes(e.searchKey.toLowerCase()))return!0})})},onCloseClick:function(){if(this.focusing)return!1;this.$emit("update:visibleFlag",!1)},onDeleteClick:function(t,e,i){t.id?this.$set(t,"changeType","del"):i.splice(e,1)},onItemFocus:function(t,e){this.focusing=!0},onItemBlur:function(){this.focusing=!1},onSearchItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this.data.findIndex(function(e){return e.id===t.outHouseDTO.id&&e.shopHouseDTO.id===t.shopHouseDTO.id});if(~e){var i=this.data[e].details.findIndex(function(e){return e.goodsDTO.id===t.goodsDTO.id&&"del"!==e.changeType});~i&&(this.data[e].details[i]=t)}},onUnitEdit:function(t){var e=this;this.itemEditRowData=t,this.getItemUnit(t.goodsDTO.id).then(function(t){e.unitActions=t,e.unitActionShow=!0})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemEditRowData,i=e.unitDTO.value,o=t,n=c()(e.busUnitOutAmount);n>0?(n=n*i/o.value,e.busUnitOutAmount=c()(this.$fxUtils.toFixedSHW(n,this.sysPointSize)),this.calcMoney("moneyWithTax",e.sendMoneyWithTax,e),this.calcCostMoney("outMoney",e.outMoney,e)):(e.taxPrice=c()(e.taxPrice)*o.value/i,this.calcMoney("taxPrice",e.taxPrice,e),this.calcCostMoney("taxPrice",e.taxPrice,e));var s=c()(e.outOrderAmount);s=s*i/o.value,e.outOrderAmount=s,e.unitDTO=t},getItemUnit:function(t){var e=this;return new a.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/users/").concat(e.loginerId,"/goods/").concat(t,"/units")}).then(function(t){i(t.units)})})},calcMoney:function(t,e,i){var o=i.taxPrice,n=i.busUnitOutAmount,s=i.price,a=i.sendTaxes,r=0,c=0,l=0,u=0,d=this.toFixedNumberSize(e);if(i.giftFlag||"money"===t&&0===d)return i.sendMoney=0,i.sendMoneyWithTax=0,i.sendTaxMoney=0,!0;"money"===t?(r=d,l=this.toFixedNumberSize(r/n),c=r*(1+a),u=this.toFixedNumberSize(c/n)):"amount"===t?(i.busUnitOutAmount=this.toFixedNumberSize(e,this.sysPointSize),l=s,u=o,r=this.toFixedNumberSize(s*d),c=this.toFixedNumberSize(o*d)):"moneyWithTax"===t?(c=d,u=this.toFixedNumberSize(c/n),r=this.toFixedNumberSize(c/(1+a)),l=this.toFixedNumberSize(r/n)):"taxPrice"===t?(u=d,c=this.toFixedNumberSize(n*u),l=this.toFixedNumberSize(u/(1+a)),r=this.toFixedNumberSize(l*n)):"price"===t&&(l=d,r=this.toFixedNumberSize(l*n),u=this.toFixedNumberSize(l*(1+a)),c=this.toFixedNumberSize(n*u)),i.sendMoney=r,i.sendMoneyWithTax=c,i.sendTaxMoney=this.toFixedNumberSize(this.toFixedNumberSize(c)-this.toFixedNumberSize(r)),i.price=l,i.taxPrice=u},calcCostMoney:function(t,e,i){var o=i.costPrice,n=i.busUnitOutAmount,s=0,a=0,r=this.toFixedNumberSize(e);"amount"===t?(i.busUnitOutAmount=this.toFixedNumberSize(e,this.sysPointSize),a=o,s=this.toFixedNumberSize(o*r)):"outMoney"===t?(s=r,a=this.toFixedNumberSize(s/n)):"taxPrice"===t&&(a=r,s=this.toFixedNumberSize(n*a)),i.outMoney=s,i.costPrice=a},toFixedNumberSize:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sysMoneyPointSize;return c()(this.$fxUtils.toFixedSHW(t,e))},onSearchConfirm:function(){if(this.focusing)return!1;this.data.forEach(function(t){t.details.forEach(function(t){delete t.checked})}),this.$emit("on-search-confirm",this.data),this.$emit("update:visibleFlag",!1)},onCheckBoxClick:function(t){if(this.focusing)return!1;this.$set(t,"checked",!t.checked)},onSelectAllClick:function(){var t=this,e=!this.isSelectAll;this.data.forEach(function(i){var o=t.detailFilter(i.details);o.forEach(function(i){"del"!==i.changeType&&t.$set(i,"checked",e)})})},onSelectConfirm:function(){var t=this,e=this.data.find(function(t){return t.details.find(function(t){return t.checked&&"del"!==t.changeType})});if(!e)return this.$fxToast.top("请先选择品项!"),!0;this.$dialog.confirm({title:"提示",message:"是否删除？"}).then(function(){t.data.forEach(function(e){for(var i=e.details,o=i.length-1;o>=0;o--){var n=i[o];n.checked&&(n.id?t.$set(n,"changeType","del"):e.details.splice(o,1))}})})},createBreakBill:function(t){var e=this;return new a.a(function(i){var o={billEmp:"",billMemo:"",billState:0,businessDate:(new Date).getTime(),businessTypeDTO:{},shopDTO:{id:e.rdcId},details:[],updateIndicator:"Append",autoType:1,reckonBreak:"0",detailAdd:[t],accountDTO:{id:e.loginerId}};e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/breakBills"),data:o,query:{m:"addAndCheckBill"}}).then(function(t){i(),e.$fxToast.success("报损成功！")})})},onCameraClick:function(t){this.scanStoreItem=t,this.$fxEventBus.initEvent(this,"redCode",this.getItemByRedCode),this.$dialog.alert({title:"请扫码",message:"当前出库仓库：".concat(t.name),confirmButtonText:"取消扫码",beforeClose:function(t,e){this.$fxEventBus.$off("redCode",this.getItemByRedCode),e()}})},getItemByRedCode:function(t){return!!this.visibleFlag&&(t.length<=24?this.onRedCodeHandler(t):this.onRedTwoCodeHandler(t))},onRedCodeHandler:function(t){var e=this;return this.getItemByCode(t).then(function(t){var i=t.billAndDetails[0];if(0===i.length)return e.$fxToast.top("当前仓库无此品项!"),!1;e.hideItemData(e.data);for(var o=null,n=0;n<e.data.length;n++)if(o=e.data[n].details.find(function(t){return t.goodsDTO.id===i.goodsDTO.id&&"del"!==t.changeType}),o)break;o?(e.itemUpdate(i,o),e.$set(o,"showFlag",!0)):e.$fxToast.top("无此品项!"),e.searchKey=""})},itemUpdate:function(t,e){var i=e.unitDTO,o=t.unitDTO,n=o.value/i.value,s=t.goodsDTO.countValue*n;e.id&&this.$set(e,"changeType","edit"),this.calcMoney("amount",s,e)},getItemByCode:function(t){var e=this;return new a.a(function(i){var o={m:"getGoodsByBarCode4Modify",barCodes:t};e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/users/").concat(e.loginerId,"/goods"),data:o}).then(function(t){i(t)})})},hideItemData:function(t){var e=this;t.forEach(function(t){t.details.forEach(function(t){e.$set(t,"showFlag",!1)})})},onRedTwoCodeHandler:function(t){var e=this;return this.getItemByTwoCode(t,!1).then(function(i){return"100"===i.errorCode||"101"===i.errorCode?e.$dialog.confirm({title:"提示",message:i.message}).then(function(){return"100"===i.errorCode?e.createBreakBill(i.storeBillDetailDTO):e.getItemByTwoCode(t,!0).then(function(t){return e.getScanGoodData(t.storeBillDetailDTO)})}).catch(function(){return!1}):e.getScanGoodData(i.storeBillDetailDTO)})},getItemByTwoCode:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new a.a(function(o){var n={qrCodeContent:t,houseId:e.scanStoreItem.shopHouseDTO.id,outHouseId:e.scanStoreItem.id,billType:32,nextFlag:i};e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.inShopId,"/users/").concat(e.loginerId,"/getscancodedata"),query:n}).then(function(t){o(t)})})},getScanGoodData:function(t){this.setScanGood(t)},setScanGood:function(t){var e=this,i=this.scanStoreItem.details.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id&&"del"!==e.changeType});if(!~i)return this.$fxToast.fail("当前仓库无此品项！"),!1;var o=this.scanStoreItem.details.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id&&t.unitDTO.id===e.unitDTO.id&&"del"!==e.changeType});if(!~o)return this.$fxToast.fail("不能重复添加品项！"),!1;var n=this.scanStoreItem.details[o];if(n.batchCode!==t.batchCode&&this.$fxUtils.isDef(n.batchCode)&&""!==n.batchCode)return this.$fxToast.fail("不能重复添加品项！"),!1;if(this.isAutoType(0))return this.$fxToast.top("扫码成功！"),n.batchCode=t.batchCode,!0;var s=t.busUnitOutAmount;this.$refs.scanActionSheet.doSelect().then(function(i){"累加数量"===i.name&&e.computedScanItemAmount(t,n),e.refreshSelectItem(t,n,s)})},computedScanItemAmount:function(t,e){var i=this.toFixedNumberSize(t.busUnitOutAmount+e.busUnitOutAmount);t.busUnitOutAmount=this.$fxCommon.checkAmountRange(i)},refreshSelectItem:function(t,e,i){e.busUnitOutAmount=t.busUnitOutAmount,e.batchCode=t.batchCode,this.editItem(e),this.calcMoney("amount",e.busUnitOutAmount,e),e.costPrice=this.toFixedNumberSize(t.outMoney/i),e.outMoney=this.toFixedNumberSize(t.busUnitOutAmount*e.costPrice)},editItem:function(t){t.id&&this.$set(t,"changeType","edit")},showData:function(t){var e=this;t.forEach(function(t){t.details.forEach(function(t){e.$set(t,"showFlag",!0)})})},onConfirmKey:function(){""===this.searchKey&&this.showData(this.data)}}},v=p,b=(i("5307"),i("2877")),S=Object(b["a"])(v,o,n,!1,null,"2c40ec46",null);e["a"]=S.exports},f3e9:function(t,e,i){},f9fe:function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-uniformDistributionOut-details"},[i("w-header",{attrs:{title:t.orderInfoData.sysbillCode,titleFontSize:"3.733vw",border:!0}}),i("orderInfo",{ref:"orderInfo",attrs:{data:t.orderInfoData,isDisabled:t.isBillState(1)||!t.$fxAuth("distributionOutBill.save")||t.isWeightState(1)||t.isWeightState(2),collapseDisabled:t.itemInputFocusing},on:{"on-shop-click":t.onInShopClick,"on-rdc-click":t.onRdcClick,"on-busdate-click":t.onBusinessDateClick,"on-arriveDate-click":t.onArriveDateClick,"on-billType-click":t.onBillTypeClick,"on-item-clear":t.onItemClear,"on-billType-clear":t.onBillTypeClear}}),i("orderItem",{ref:"orderItem",attrs:{billId:t.orderInfoData.id,data:t.orderItemList,itemInputFocusing:t.itemInputFocusing,isDisabled:t.isBillState(1)||!t.$fxAuth("distributionOutBill.save")||t.isWeightState(1)||t.isWeightState(2),autoType:t.orderInfoData.autoType,inShopId:t.orderInfoData.inShopDTO&&t.orderInfoData.inShopDTO.id,rdcId:t.orderInfoData.rdcDTO&&t.orderInfoData.rdcDTO.id},on:{"update:itemInputFocusing":function(e){t.itemInputFocusing=e},"update:item-input-focusing":function(e){t.itemInputFocusing=e},"on-add-click":t.onAddClick,"on-search-click":t.onSearchClick,"on-send-click":t.onSendOutClick,"on-item-edit":t.onItemEdit,"on-unit-edit":t.onUnitEdit,"on-item-focus":t.onItemFocus}}),i("div",{staticClass:"uniformDistributionOut-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillState(0)&&t.$fxAuth("distributionOutBill.del")&&(t.isWeightState(0)||t.isWeightState(3)),expression:"isBillState(0) && $fxAuth('distributionOutBill.del') && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onDeleteClick")}}},[t._v("删除")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillState(0)&&t.$fxAuth("distributionOutBill.check")&&(t.isWeightState(0)||t.isWeightState(3)),expression:"isBillState(0) && $fxAuth('distributionOutBill.check') && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onExpressClick")}}},[t._v("审核")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillReState([0,2])&&t.isBillState(1)&&t.$fxAuth("distributionOutBill.unCheck")&&(t.isWeightState(0)||t.isWeightState(3)),expression:"isBillReState([0, 2]) && isBillState(1) && $fxAuth('distributionOutBill.unCheck') && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onUnExpressClick")}}},[t._v("反审")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillState(0)&&t.$fxAuth("distributionOutBill.save")&&(t.isWeightState(0)||t.isWeightState(3)),expression:"isBillState(0) && $fxAuth('distributionOutBill.save') && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:function(e){return t.onClickHandler("onSaveClick")}}},[t._v("保存")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillReState(0)&&t.isBillState(1)&&t.$fxAuth("distributionOutBill.reCheck"),expression:"isBillReState(0) && isBillState(1) && $fxAuth('distributionOutBill.reCheck')"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onExpressAgainClick")}}},[t._v("复审")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillReState(1)&&t.isBillState(1)&&t.$fxAuth("distributionOutBill.unReCheck"),expression:"isBillReState(1) && isBillState(1) && $fxAuth('distributionOutBill.unReCheck')"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onUnExpressAgainClick")}}},[t._v("取消复审")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionOutBill.billWeighState")&&t.isBillState(0)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('distributionOutBill.billWeighState') && isBillState(0) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius yellow-btn",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onWeightClick")}}},[t._v("下发称重")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionOutBill.billWeighState")&&t.isBillState(0)&&(t.isWeightState(1)||t.isWeightState(2)),expression:"$fxAuth('distributionOutBill.billWeighState') && isBillState(0) && (isWeightState(1) || isWeightState(2))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onUnWeightClick")}}},[t._v("取消称重")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("distributionOutBill.billWeighState")&&t.isBillState(0)&&t.isWeightState(2)&&t.sysDZCManyLower,expression:"$fxAuth('distributionOutBill.billWeighState') && isBillState(0) && isWeightState(2) && sysDZCManyLower"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onEndWeightClick")}}},[t._v("结束称重")])],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.rdcPopShow,callback:function(e){t.rdcPopShow=e},expression:"rdcPopShow"}},[i("listComp",{attrs:{visibleFlag:t.rdcPopShow,data:t.rdcList,loadFinished:!0,title:"请选择配送中心"},on:{"update:visibleFlag":function(e){t.rdcPopShow=e},"update:visible-flag":function(e){t.rdcPopShow=e},"on-search":t.searchRdc,"on-select":t.selectRdc}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.inShopPopShow,callback:function(e){t.inShopPopShow=e},expression:"inShopPopShow"}},[i("listComp",{attrs:{visibleFlag:t.inShopPopShow,data:t.inShopList,loadFinished:!0,title:"请选择门店"},on:{"update:visibleFlag":function(e){t.inShopPopShow=e},"update:visible-flag":function(e){t.inShopPopShow=e},"on-search":t.searchInShop,"on-select":t.selectInShop}})],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.billTypePopShow,callback:function(e){t.billTypePopShow=e},expression:"billTypePopShow"}},[i("listComp",{attrs:{visibleFlag:t.billTypePopShow,data:t.billTypeList,loadFinished:!0,title:"单据类型检索"},on:{"update:visibleFlag":function(e){t.billTypePopShow=e},"update:visible-flag":function(e){t.billTypePopShow=e},"on-search":t.searchBillType,"on-select":t.selectBillType}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemStorePopShow,callback:function(e){t.itemStorePopShow=e},expression:"itemStorePopShow"}},[i("storeItemComp",{attrs:{visibleFlag:t.itemStorePopShow,storeItemData:t.storeItem,autoType:t.orderInfoData.autoType,inShopId:t.orderInfoData.inShopDTO&&t.orderInfoData.inShopDTO.id,rdcId:t.orderInfoData.rdcDTO&&t.orderInfoData.rdcDTO.id,businessDate:t.orderInfoData.businessDate},on:{"update:visibleFlag":function(e){t.itemStorePopShow=e},"update:visible-flag":function(e){t.itemStorePopShow=e},"on-save":t.onStoreItemSave,"on-select-store":t.onStoreItemSelect}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemPopShow,callback:function(e){t.itemPopShow=e},expression:"itemPopShow"}},[i("itemEditComp",{attrs:{visibleFlag:t.itemPopShow,inShopId:t.orderInfoData.inShopDTO&&t.orderInfoData.inShopDTO.id,rdcId:t.orderInfoData.rdcDTO&&t.orderInfoData.rdcDTO.id,shopHouseDTO:t.currentShopHouseObj,outHouse:t.currentOutHouseObj,businessDate:t.orderInfoData.businessDate,parentStoreItem:t.getStoreItem()},on:{"update:visibleFlag":function(e){t.itemPopShow=e},"update:visible-flag":function(e){t.itemPopShow=e},"on-confirm":t.onItemEditConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,isDisabled:t.isBillState(1)||!t.$fxAuth("distributionOutBill.save")||t.isWeightState(1)||t.isWeightState(2)},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemSearchPopShow,callback:function(e){t.itemSearchPopShow=e},expression:"itemSearchPopShow"}},[i("itemSearchPop",{attrs:{visibleFlag:t.itemSearchPopShow,data:t.searchItem,rdcId:t.orderInfoData.rdcDTO&&t.orderInfoData.rdcDTO.id,inShopId:t.orderInfoData.inShopDTO&&t.orderInfoData.inShopDTO.id,autoType:t.orderInfoData.autoType,isDisabled:t.isBillState(1)||!t.$fxAuth("distributionOutBill.save")||t.isWeightState(1)||t.isWeightState(2)},on:{"update:visibleFlag":function(e){t.itemSearchPopShow=e},"update:visible-flag":function(e){t.itemSearchPopShow=e},"on-search-confirm":t.onSearchConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemSendPopShow,callback:function(e){t.itemSendPopShow=e},expression:"itemSendPopShow"}},[i("itemSendOutPop",{attrs:{visibleFlag:t.itemSendPopShow,data:t.searchItem,orderId:t.orderInfoData.id,rdcId:t.orderInfoData.rdcDTO&&t.orderInfoData.rdcDTO.id,inShopId:t.orderInfoData.inShopDTO&&t.orderInfoData.inShopDTO.id,autoType:t.orderInfoData.autoType,isDisabled:t.isBillState(1)||!t.$fxAuth("distributionOutBill.save")||t.isWeightState(1)||t.isWeightState(2)},on:{"update:visibleFlag":function(e){t.itemSendPopShow=e},"update:visible-flag":function(e){t.itemSendPopShow=e},"on-send-confirm":t.onSendConfirm}})],1)],1)},n=[],s=i("768b"),a=(i("7514"),i("20d6"),i("5176")),r=i.n(a),c=i("75fc"),l=i("f499"),u=i.n(l),d=i("b6d0"),h=i.n(d),f=i("774e"),m=i.n(f),p=i("59ad"),v=i.n(p),b=(i("ac6a"),i("795b")),S=i.n(b),g=(i("6762"),i("2fdb"),i("6b54"),i("cebc")),D=i("2f62"),x=i("463e2"),y=i("415d"),C=i("f6bb"),w=i("9cfb"),I=i("060f"),T=i("f330"),O=i("4e92"),k=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-search-block"},[i("w-header",{attrs:{title:"库存不足发货",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{staticClass:"item-title"},[i("span",{staticClass:"title-count"},[t._v("明细：")]),i("span",[t._v(t._s(t.detailsLength))])]),i("div",{staticClass:"item-title",on:{click:t.onAllCenterHouseClick}},[i("span",{staticClass:"fx-ellipsis title-house"},[t._v("发货仓库")]),i("van-icon",{staticClass:"house-icon",attrs:{name:"arrow"}})],1),i("div",{ref:"details-content",staticClass:"item-list"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeStoreNames,callback:function(e){t.activeStoreNames=e},expression:"activeStoreNames"}},t._l(t.data,function(e){return i("van-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.storeShowComputed(e),expression:"storeShowComputed(storeItem)"}],key:""+e.id,staticClass:"store-row",attrs:{name:""+e.id}},[i("div",{staticClass:"item-store-title-container",attrs:{slot:"title"},slot:"title"},[i("div",{staticClass:"item-store-title"},[i("span",{staticClass:"store-left-name fx-ellipsis"},[t._v("收货仓库："+t._s(e.name))])])]),t._l(t.detailFilter(e.details),function(e){return i("div",{directives:[{name:"show",rawName:"v-show",value:"del"!==e.changeType,expression:"item.changeType !== 'del'"}],key:e.goodsDTO.id+"-"+e.goodsUUid,ref:"details-row-"+e.goodsDTO.id,refInFor:!0,staticClass:"item-row",attrs:{disabled:t.isDisabled}},[i("div",{staticClass:"item-cell"},[i("itemInfoCell",{staticClass:"search-info",attrs:{itemData:e,isDisabled:t.isDisabled},on:{"on-centerHouse-edit":t.onCenterHouseEdit}})],1)])})],2)}),1)],1),i("div",{staticClass:"search-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onCreatConfirm}},[t._v("生成出库单")])],1),i("filterListPopup",{attrs:{title:"发货仓库检索",rollingLoad:!0,getDataApi:t.getAllCenterHouseListData},on:{"on-select":function(e){return t.selectAllCenterHouse(arguments)}},model:{value:t.allCenterHousePopShow,callback:function(e){t.allCenterHousePopShow=e},expression:"allCenterHousePopShow"}}),i("filterListPopup",{attrs:{title:"发货仓库检索",rollingLoad:!0,getDataApi:t.getCenterHouseListData},on:{"on-select":function(e){return t.selectCenterHouse(arguments)}},model:{value:t.centerHousePopShow,callback:function(e){t.centerHousePopShow=e},expression:"centerHousePopShow"}})],1)},P=[],A=(i("28a5"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-info-cell"},[i("div",{staticClass:"item-img"},[i("img",{attrs:{src:t.comptedItemImgSrc(t.itemData.goodsDTO.imageUrls),onerror:t.$fxCommon.errorImg("item")}})]),i("div",{staticClass:"item-details"},[i("div",{staticClass:"item-name fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.name))]),i("div",{staticClass:"details-cell"},[i("div",{staticClass:"item-spec fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.spec))]),i("div",{staticClass:"item-amount"},[i("span",[t._v(t._s(t.itemData.busUnitOutAmount))])]),i("div",{staticClass:"unit-text"},[i("span",{staticClass:"fx-ellipsis cell-unit"},[t._v(t._s(t.itemData.unitDTO.name))])])]),i("div",{staticClass:"details-cell"},[i("div",{staticClass:"item-spec fx-ellipsis"},[t._v("发货仓库")]),i("div",{staticClass:"item-house"},[i("span",{staticClass:"fx-ellipsis cell-house"},[i("label",{on:{click:t.onCenterHouseClick}},[t._v(t._s(t.itemData.centerHouseDTO.name))])]),i("van-icon",{staticClass:"unit-icon",attrs:{name:"arrow"},on:{click:function(e){return e.stopPropagation(),t.onCenterHouseClick(e)}}})],1)]),i("div",{staticClass:"details-cell"},[i("div",{staticClass:"item-spec fx-ellipsis"},[t._v("库存数量")]),i("div",{staticClass:"item-amount"},[i("span",{class:{"text-red":t.itemData.currentAmount<t.itemData.busUnitOutAmount}},[t._v(t._s(t.itemData.currentAmount))])]),i("div",{staticClass:"unit-text"},[i("span",{staticClass:"fx-ellipsis cell-unit"},[t._v(t._s(t.itemData.unitDTO.name))])])])])])}),F=[],B={name:"itemInfoCell",props:{itemData:{type:Object,default:function(){return{}}},isDisabled:Boolean},computed:{comptedItemImgSrc:function(t){return function(t){return null===t?"":t[0]}}},data:function(){return{}},methods:{onCenterHouseClick:function(){this.$emit("on-centerHouse-edit",this.itemData)}}},$=B,N=(i("86ac"),i("2877")),L=Object(N["a"])($,A,F,!1,null,"01d0750e",null),E=L.exports,H=i("eb03"),z={name:"itemListPop",components:{itemInfoCell:E,filterListPopup:H["a"]},props:{data:{type:Array,default:function(){return[]}},orderId:{type:String,default:""},isDisabled:Boolean,visibleFlag:Boolean},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",itemEditRowData:{},activeStoreNames:[],centerHousePopShow:!1,allCenterHousePopShow:!1}},watch:{visibleFlag:{handler:function(t){var e=this;t&&(this.searchKey="",this.setDetailGoodsUUid(this.data),this.data.forEach(function(t){var i=t.details.filter(function(t){return"del"!==t.changeType}).length;i>0&&e.activeStoreNames.push("".concat(t.id))}))},immediate:!0}},computed:Object(g["a"])({},Object(D["c"])({sysPointSize:"sysPointSize",sysMoneyPointSize:"sysMoneyPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{detailsLength:function(t){return this.data.reduce(function(t,e){var i=e.details.filter(function(t){return"del"!==t.changeType});return t+i.length},0)}}),methods:{setDetailGoodsUUid:function(t){var e=this;t.forEach(function(t){t.details.forEach(function(t){t.goodsUUid=e.$fxUtils.createUUID()})})},storeShowComputed:function(t){return this.detailFilter(t.details).length>0},detailFilter:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"code,name,pinYin";return t.filter(function(t){return"del"!==t.changeType&&!!i.split(",").find(function(i){if(t.goodsDTO[i].toLowerCase().includes(e.searchKey.toLowerCase()))return!0})})},onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onCenterHouseEdit:function(t){this.itemEditRowData=t,this.centerHousePopShow=!0},selectCenterHouse:function(t){var e=Object(s["a"])(t,1),i=e[0];this.itemEditRowData.centerHouseDTO=i,this.itemEditRowData.currentAmount=this.toFixedNumberSize(i.amount/this.itemEditRowData.unitDTO.value)},toFixedNumberSize:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sysMoneyPointSize;return v()(this.$fxUtils.toFixedSHW(t,e))},getCenterHouseListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e={keyword:t,orderId:this.orderId,goodsId:this.itemEditRowData.goodsDTO.id},i={keyword:t};return this.$fxApi("uniformDistributionOutBill.getHouse4NoEnoughAmountGoods",e)({data:i}).then(function(t){return t.noEnoughGoods})},onAllCenterHouseClick:function(){this.allCenterHousePopShow=!0},selectAllCenterHouse:function(t){var e=this,i=Object(s["a"])(t,1),o=i[0];this.data.forEach(function(t){t.details.forEach(function(t){t.centerHouseDTO=o})});var n=[];this.data.forEach(function(t){n.push.apply(n,Object(c["a"])(t.details))}),this.$fxApi("uniformDistributionOutBill.getOutHouseGidAmount",this.orderId)({data:n}).then(function(t){if(t.noEnoughGoods){var i=t.noEnoughGoods;e.data.forEach(function(t){t.details.forEach(function(t){var o=i.find(function(e){return e.detailId===t.detailId}).amount;t.currentAmount=e.toFixedNumberSize(o/t.unitDTO.value)})})}})},getAllCenterHouseListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e={keyword:t};return this.$fxApi("uniformDistributionOutBill.getHouseList4UniformNoEnoughSet",this.orderId)({data:e}).then(function(t){return t.shops})},onCreatConfirm:function(){var t=this,e=[];this.data.forEach(function(t){e.push.apply(e,Object(c["a"])(t.details))}),this.$emit("update:visibleFlag",!1),this.$fxApi("uniformDistributionOutBill.createUniform",this.orderId)({data:e}).then(function(e){t.$emit("on-send-confirm",e.message)}).catch(function(e){t.$emit("on-send-confirm","")})}}},R=z,U=(i("6b4b"),Object(N["a"])(R,k,P,!1,null,"a7e771e0",null)),M=U.exports,_={name:"uniformDistributionOutDetails",components:{orderInfo:x["a"],orderItem:y["a"],listComp:C["a"],storeItemComp:w["a"],itemRowEditPop:I["a"],itemSearchPop:T["a"],itemEditComp:O["a"],itemSendOutPop:M},data:function(){return{query:this.$route.query,activeNames:["1"],tabActive:"选项1",orderInfoData:{},orderItemList:[],dateType:"business",currentDate:new Date,inShopPopShow:!1,inShopList:[],rdcPopShow:!1,rdcList:[],datePickerShow:!1,billTypePopShow:!1,billTypeList:[],itemStorePopShow:!1,storeItem:[],unitActions:[],unitActionShow:!1,itemSearchPopShow:!1,itemSendPopShow:!1,itemRowEditPopShow:!1,itemEditRowData:{},itemInputFocusing:!1,orderDeleteFlag:!1,formatterSysPointKey:["busUnitAmount"],searchItem:[],currentShopHouseObj:{},currentOutHouseObj:{},itemPopShow:!1}},created:function(){this.createOrderDetails()},beforeRouteLeave:function(t,e,i){var o=this;if(this.itemInputFocusing)return this.$router.go(1),!1;"/uniformDistributionOut"!==t.path||this.orderDeleteFlag||0!==this.orderInfoData.billState?i():this.$dialog.confirm({title:"提示",message:"若已修改,请先保存单据<br/>是否关闭页面?"}).then(function(){i()}).catch(function(){return o.$router.go(1),!1})},computed:Object(g["a"])({},Object(D["c"])({sysPointSize:"sysPointSize",sysMoneyPointSize:"sysMoneyPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId},sysDZCManyLower:function(t){return t.systemParams.sysDZCManyLower}}),{isBillState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.billState):e.orderInfoData.billState===t}},isBillReState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.billReState):e.orderInfoData.billReState===t}},isWeightState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.weightState):e.orderInfoData.weightState===t}}}),methods:{createOrderDetails:function(){var t=this;return new S.a(function(e){t.getOrderDetails().then(function(i){var o=i.storeBills[0];t.formatterSysPoint(o.details),t.orderInfoData=o,t.orderItemList=t.filterStoreItem(o.details),e()})})},getOrderDetails:function(){var t=this;return new S.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/distributionOutBills/").concat(t.query.orderId)}).then(function(t){e(t)})})},formatterSysPoint:function(t){var e=this;t.forEach(function(t){e.formatterSysPointKey.forEach(function(i){t[i]=e.toFixedNumberSize(t[i],e.sysPointSize)})})},filterStoreItem:function(t){var e=this;t.forEach(function(t){var i=v()(t.busUnitOutAmount);i&&!t.giftFlag?(t.price=e.toFixedNumberSize(t.sendMoney/i),t.taxPrice=e.toFixedNumberSize(t.sendMoneyWithTax/i),t.costPrice=e.toFixedNumberSize(t.outMoney/i)):(t.price=e.toFixedNumberSize(t.price),t.taxPrice=e.toFixedNumberSize(t.taxPrice),t.costPrice=e.toFixedNumberSize(t.costPrice)),t.busUnitOutAmount=e.toFixedNumberSize(i),t.sendMoney=e.toFixedNumberSize(t.sendMoney),t.sendTaxMoney=e.toFixedNumberSize(t.sendTaxMoney),t.sendMoneyWithTax=e.toFixedNumberSize(t.sendMoneyWithTax),t.outMoney=e.toFixedNumberSize(t.outMoney)});var i=m()(new h.a(t.map(function(t){return t.shopHouseDTO.id}))),o=m()(new h.a(t.map(function(t){return t.outHouseDTO.id}))),n=[];return i.forEach(function(e){o.forEach(function(i){var o=t.filter(function(t){return t.outHouseDTO.id===i&&t.shopHouseDTO.id===e});if(o.length){var s=JSON.parse(u()(o[0].outHouseDTO));s.shopHouseDTO=o[0].shopHouseDTO,s.details=o,n.push(s)}})}),n},clearItemConfim:function(t){var e=this;return new S.a(function(i){var o=e.orderItemList.filter(function(t){var e=t.details.filter(function(t){return"del"!==t.changeType});return 0!==e.length});0===o.length?i():e.$dialog.confirm({title:"提示",message:t}).then(function(){e.onItemClear(),i()}).catch(function(){})})},onInShopClick:function(){this.onInShopRefresh()},searchInShop:function(t){this.onInShopRefresh(t)},selectInShop:function(t){var e=this;this.checkShop(t).then(function(){e.clearItemConfim("更换门店会清空品项,是否继续?").then(function(){e.orderInfoData.inShopDTO=t})})},checkShop:function(t){var e=this;return new S.a(function(i){var o=e.orderInfoData.inShopDTO;o.id!==t.id&&i()})},onInShopRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getInShopListData(e).then(function(e){t.inShopList=e.shops,t.inShopPopShow=!0})},getInShopListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new S.a(function(i){var o={pid:t.orderInfoData.rdcDTO.id,keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/shopsByRdc"),data:o}).then(function(t){i(t)})})},onRdcClick:function(){this.onRdcRefresh()},searchRdc:function(t){this.onRdcRefresh(t)},selectRdc:function(t){var e=this;this.checkRdc(t).then(function(){e.clearItemConfim("修改配送中心将清空发货仓库、门店和单据明细，是否继续?").then(function(){e.orderInfoData.rdcDTO=t,e.orderInfoData.inShopDTO={}})})},checkRdc:function(t){var e=this;return new S.a(function(i){var o=e.orderInfoData.rdcDTO;o.id!==t.id&&i()})},onRdcRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getRdcListData(e).then(function(e){t.rdcList=e.shops,t.rdcPopShow=!0})},getRdcListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new S.a(function(i){var o={keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/rdcs"),data:o}).then(function(t){i(t)})})},onBillTypeClick:function(){this.onBillTYpeRefresh()},searchBillType:function(t){this.onBillTYpeRefresh(t)},selectBillType:function(t){this.orderInfoData.businessTypeDTO=t},onBillTypeClear:function(){this.orderInfoData.businessTypeDTO={}},onBillTYpeRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getBillTypeListData(e).then(function(e){t.billTypeList=e.businessTypes,t.billTypePopShow=!0})},getBillTypeListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new S.a(function(i){var o={m:"list4DistributionOutListBillEdit",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/businessTypes"),data:o}).then(function(t){i(t)})})},onBusinessDateClick:function(){this.dateType="business",this.orderInfoData.businessDate&&(this.currentDate=new Date(this.orderInfoData.businessDate)),this.datePickerShow=!0},onArriveDateClick:function(){this.dateType="arrive",this.orderInfoData.arriveDate&&(this.currentDate=new Date(this.orderInfoData.arriveDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){var e=t.getTime();"business"===this.dateType?this.orderInfoData.businessDate=e:this.orderInfoData.arriveDate=e,this.datePickerShow=!1},onAddClick:function(){var t=this;this.checkOrderInfo().then(function(){t.storeItem=JSON.parse(u()(t.orderItemList)),t.itemStorePopShow=!0})},checkOrderInfo:function(){var t=this;return new S.a(function(e,i){t.orderInfoData.businessDate?t.orderInfoData.rdcDTO.id?t.orderInfoData.inShopDTO.id?e():t.$fxToast.top("请先选择门店!"):t.$fxToast.top("请先选择配送中心!"):t.$toast.fail("请先选择业务日期!")})},onSearchClick:function(){this.itemSearchPopShow=!0,this.searchItem=JSON.parse(u()(this.orderItemList))},onSendOutClick:function(){var t=this;this.saveBill().then(function(){t.getoEnoughAmountIsExist().then(function(e){t.getNoEnoughAmountGoodsList().then(function(e){t.itemSendPopShow=!0,t.searchItem=t.filterShopHouseItem(e.noEnoughGoods)})})})},getoEnoughAmountIsExist:function(){return this.$fxApi("uniformDistributionOutBill.noEnoughAmountIsExist",this.query.orderId).then(function(t){return t})},getNoEnoughAmountGoodsList:function(){return this.$fxApi("uniformDistributionOutBill.getNoEnoughAmountGoodsList",this.query.orderId).then(function(t){return t})},filterShopHouseItem:function(t){var e=this;t.forEach(function(t){t.busUnitOutAmount=e.toFixedNumberSize(t.busUnitOutAmount),t.amount=e.toFixedNumberSize(t.amount),t.currentAmount=e.toFixedNumberSize(t.amount/t.unitDTO.value)});var i=m()(new h.a(t.map(function(t){return t.shopHouseDTO.id}))),o=[];return i.forEach(function(e){var i=t.filter(function(t){return t.shopHouseDTO.id===e});if(i.length){var n=JSON.parse(u()(i[0].shopHouseDTO));n.details=i,o.push(n)}}),o},onSendConfirm:function(t){""!==t&&this.$dialog.alert({title:"提示",message:t}),this.createOrderDetails()},onStoreItemSave:function(t){this.orderItemList=t},onSaveClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要保存该单据吗?"}).then(function(){t.saveBill()}).catch(function(){})},saveBill:function(){var t=this;return this.checkHasDetails().then(function(){return t.saveHandler().then(function(e){return t.createOrderDetails().then(function(){t.$fxToast.success(e.message)})})})},saveHandler:function(){var t=this;return new S.a(function(e){var i=t.getSaveParams();t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/distributionOutBills/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:i,query:{m:"modify"}}).then(function(t){e(t)})})},onExpressClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要审核该单据吗?"}).then(function(){t.expressHandler()})},expressHandler:function(){var t=this;this.checkHasDetails().then(function(){var e=t.getSaveParams();e.otherCheck=1,t.expressRequest(e).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("审核成功")})}).catch(function(i){"1"===i.errorCode?(t.$dialog.alert({title:"提示",message:i.message}),t.createOrderDetails()):"otherCheck"===i.errorCode&&t.$dialog.confirm({title:"提示",message:i.message+"，继续审核吗？"}).then(function(){e.otherCheck=0,t.expressRequest(e).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("审核成功")})}).catch(function(e){t.$dialog.alert({title:"提示",message:e.message})})})})})},expressRequest:function(t){var e=this;return new S.a(function(i,o){e.$fxHttp.requestPut({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/distributionOutBills/").concat(e.query.orderId,"/users/").concat(e.loginerId),data:t,query:{m:"editAndCheck"},autoErrorMsg:!1}).then(function(t){i(t)}).catch(function(t){o(t)})})},onUnExpressClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要反审该单据吗?"}).then(function(){t.checkHasDetails().then(function(){var e=t.getSaveParams();t.unExpressHandler(e)})}).catch(function(){})},unExpressHandler:function(t){var e=this;this.$fxHttp.requestPut({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/distributionOutBills/").concat(this.query.orderId,"/users/").concat(this.loginerId),data:t,query:{m:"unCheck"}}).then(function(t){e.createOrderDetails().then(function(){e.$fxToast.success("反审成功")})})},onCopyClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要复制该单据吗?"}).then(function(){t.checkHasDetails().then(function(){var e=t.getSaveParams();t.copyHandler(e)})}).catch(function(){})},copyHandler:function(t){var e=this;this.$fxHttp.requestPut({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/distributionOutBills/").concat(this.query.orderId),data:t,query:{userId:this.loginerId,m:"copy"}}).then(function(t){e.createOrderDetails().then(function(){e.$fxToast.success("复制成功")})})},onDeleteClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要删除该单据吗?"}).then(function(){var e=t.getSaveParams();t.$fxHttp.requestDel({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/distributionOutBills/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:e}).then(function(e){t.$fxToast.success({message:"删除成功",mask:!0}).then(function(){t.orderDeleteFlag=!0,t.$router.go(-1)})})}).catch(function(){})},onWeightClick:function(){var t=this;this.checkHasDetails().then(function(){t.$dialog.confirm({title:"提示",message:"确定要下发称重吗?"}).then(function(){var e=t.getSaveParams();if(!e)return!1;t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/distributionOutBills/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:e,query:{userId:t.loginerId,m:"weighBill"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("下发称重成功")})})}).catch(function(){})})},onUnWeightClick:function(){var t=this;this.checkHasDetails().then(function(){var e="确定要取消称重吗?";2===t.orderInfoData.weighState&&(e="称重中的单据，取消称重后电子秤可以继续称重并传回数据！确定要取消称重吗"),t.$dialog.confirm({title:"提示",message:e}).then(function(){t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/distributionOutBills/").concat(t.query.orderId,"/users/").concat(t.loginerId),query:{userId:t.loginerId,m:"unWeighBill"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("取消称重成功")})})}).catch(function(){})})},onEndWeightClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"结束称重后将不再接收此单据的称重数据"}).then(function(){t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/distributionOutBills/").concat(t.query.orderId,"/users/").concat(t.loginerId),query:{userId:t.loginerId,m:"endWeighBill"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("结束称重成功")})})}).catch(function(){})},getSaveParams:function(){var t=[];this.orderItemList.forEach(function(e){t.push.apply(t,Object(c["a"])(e.details))});var e=t.filter(function(t){return"add"===t.changeType}),i=t.filter(function(t){return"del"===t.changeType}),o=t.filter(function(t){return"edit"===t.changeType}),n=r()({},this.orderInfoData,{detailAdd:e.length>0?e:null,detailDel:i.length>0?i:null,detailMdf:o.length>0?o:null,details:[],houseDTO:e.length>0?JSON.parse(u()(e[0].outHouseDTO)):this.orderInfoData.houseDTO});return n},getValidItem:function(){var t=[];return this.orderItemList.forEach(function(e){t.push.apply(t,Object(c["a"])(e.details))}),t.filter(function(t){return"del"!==t.changeType})},getItemLength:function(){return this.getValidItem().length},checkHasDetails:function(){var t=this;return new S.a(function(e){0===t.getItemLength()?t.$fxToast.fail("单据明细不能为空"):e()})},onItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onUnitEdit:function(t){var e=this;this.itemEditRowData=t,this.getItemUnit(t.goodsDTO.id).then(function(t){e.unitActions=t,e.unitActionShow=!0})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemEditRowData,i=e.unitDTO.value,o=t,n=v()(e.busUnitOutAmount);n>0?(n=n*i/o.value,e.busUnitOutAmount=this.toFixedNumberSize(n,this.sysPointSize),this.calcMoney("moneyWithTax",e.sendMoneyWithTax,e),this.calcCostMoney("outMoney",e.outMoney,e)):(e.taxPrice=v()(e.taxPrice)*o.value/i,this.calcMoney("taxPrice",e.taxPrice,e),this.calcCostMoney("taxPrice",e.costPrice,e));var s=v()(e.outOrderAmount);s=s*i/o.value,e.outOrderAmount=this.toFixedNumberSize(s),e.unitDTO=t},getItemUnit:function(t){var e=this;return new S.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/users/").concat(e.loginerId,"/goods/").concat(t,"/units")}).then(function(t){i(t.units)})})},calcMoney:function(t,e,i){var o=i.taxPrice,n=i.busUnitOutAmount,s=i.price,a=i.sendTaxes,r=0,c=0,l=0,u=0,d=this.toFixedNumberSize(e);if(i.giftFlag||"money"===t&&0===d)return i.sendMoney=0,i.sendMoneyWithTax=0,i.sendTaxMoney=0,!0;"money"===t?(r=d,l=this.toFixedNumberSize(r/n),c=r*(1+a),u=this.toFixedNumberSize(c/n)):"amount"===t?(i.busUnitOutAmount=this.toFixedNumberSize(e,this.sysPointSize),l=s,u=o,r=this.toFixedNumberSize(s*d),c=this.toFixedNumberSize(o*d)):"moneyWithTax"===t?(c=d,u=this.toFixedNumberSize(c/n),r=this.toFixedNumberSize(c/(1+a)),l=this.toFixedNumberSize(r/n)):"taxPrice"===t?(u=d,c=this.toFixedNumberSize(n*u),l=this.toFixedNumberSize(u/(1+a)),r=this.toFixedNumberSize(l*n)):"price"===t&&(l=d,r=this.toFixedNumberSize(l*n),u=this.toFixedNumberSize(l*(1+a)),c=this.toFixedNumberSize(n*u)),i.sendMoney=r,i.sendMoneyWithTax=c,i.sendTaxMoney=this.toFixedNumberSize(this.toFixedNumberSize(c)-this.toFixedNumberSize(r)),i.price=l,i.taxPrice=u},calcCostMoney:function(t,e,i){var o=i.costPrice,n=i.busUnitOutAmount,s=0,a=0,r=this.toFixedNumberSize(e);"amount"===t?(i.busUnitOutAmount=this.toFixedNumberSize(e,this.sysPointSize),a=o,s=this.toFixedNumberSize(o*r)):"outMoney"===t?(s=r,a=this.toFixedNumberSize(s/n)):"taxPrice"===t&&(a=r,s=this.toFixedNumberSize(n*a)),i.outMoney=s,i.costPrice=a},toFixedNumberSize:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sysMoneyPointSize;return v()(this.$fxUtils.toFixedSHW(t,e))},onEditRowConfirm:function(t){var e=this.orderItemList.findIndex(function(e){return e.id===t.outHouseDTO.id&&e.shopHouseDTO.id===t.shopHouseDTO.id});if(~e){var i=this.orderItemList[e].details.findIndex(function(e){return e.goodsDTO.id===t.goodsDTO.id&&"del"!==e.changeType});~i&&(this.orderItemList[e].details[i]=t)}},onExpressAgainClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要复审该单据吗?"}).then(function(){var e=t.getSaveParams();t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/distributionOutBills/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:e,query:{m:"reCheck"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("复审成功")})})}).catch(function(){})},onUnExpressAgainClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要取消复审该单据吗?"}).then(function(){var e=t.getSaveParams();t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/distributionOutBills/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:e,query:{userId:t.loginerId,m:"unReCheck"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("取消复审成功")})})}).catch(function(){})},onItemClear:function(){var t=this.orderInfoData.details.filter(function(t){return!!t.id});t.forEach(function(t){t.changeType="del"}),this.orderInfoData.details=t,this.orderItemList=this.filterStoreItem(t)},onItemFocus:function(){this.$refs.orderInfo.closeCollapse()},onClickHandler:function(t){if(this.itemInputFocusing)return!1;this[t]()},onSearchConfirm:function(t){this.orderItemList=t},onStoreItemSelect:function(t,e){this.currentOutHouseObj=t,this.currentShopHouseObj=e,this.itemPopShow=!0},getStoreItem:function(){var t=this;if(this.$fxUtils.isEmptyObjSHW(this.currentShopHouseObj)||this.$fxUtils.isEmptyObjSHW(this.currentOutHouseObj))return[];var e=this.orderItemList.find(function(e){return e.shopHouseDTO.id===t.currentShopHouseObj.id&&e.id===t.currentOutHouseObj.id});return e?e.details:[]},onItemEditConfirm:function(t){var e=Object(s["a"])(t,3),i=e[0],o=e[1],n=e[2],a=this.orderItemList.find(function(t){return t.id===o.id&&t.shopHouseDTO.id===n.id});if(a)a.details=i;else{var c=r()({},o);c.shopHouseDTO=n,c.details=i,this.orderItemList.push(c)}}}},j=_,W=(i("1c3f"),Object(N["a"])(j,o,n,!1,null,"fe716776",null));e["default"]=W.exports},fb8c:function(t,e,i){},fd12:function(t,e,i){},fd54:function(t,e,i){}}]);
//# sourceMappingURL=uniformDistributionOut.6cfb6504.js.map