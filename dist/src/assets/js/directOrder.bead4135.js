(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["directOrder"],{"0621":function(t,e,i){},"0b90":function(t,e,i){},"1f9b":function(t,e,i){"use strict";var n=i("9611"),a=i.n(n);a.a},2789:function(t,e,i){},"31f9":function(t,e,i){},"3d71":function(t,e,i){},"3fa8":function(t,e,i){"use strict";var n=i("31f9"),a=i.n(n);a.a},"445f":function(t,e,i){"use strict";var n=i("638d"),a=i.n(n);a.a},"4dc9":function(t,e,i){i("5737"),t.exports=i("584a").Number.isNaN},5116:function(t,e,i){},"54a2":function(t,e,i){"use strict";var n=i("7078"),a=i.n(n);a.a},"56eb":function(t,e,i){},5737:function(t,e,i){var n=i("63b6");n(n.S,"Number",{isNaN:function(t){return t!=t}})},"5e15":function(t,e,i){"use strict";var n=i("0b90"),a=i.n(n);a.a},"638d":function(t,e,i){},"6c9d":function(t,e,i){"use strict";var n=i("cea9"),a=i.n(n);a.a},7078:function(t,e,i){},9611:function(t,e,i){},"9aaf":function(t,e,i){"use strict";var n=i("2789"),a=i.n(n);a.a},bfb3:function(t,e,i){t.exports=i("4dc9")},c4f8:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-shopOrder-details"},[i("w-header",{attrs:{title:t.orderInfoData.sysbillCode,titleFontSize:"3.733vw",border:!0}}),i("orderInfo",{ref:"orderInfo",attrs:{data:t.orderInfoData,collapseDisabled:t.itemInputFocusing,isDisabled:t.isBillState(1)||!t.$fxAuth("shopStraightInBill.save")||t.isWeightState(1)||t.isWeightState(2)}}),i("orderItem",{attrs:{data:t.orderItemList,isDisabled:t.isBillState(1)||!t.$fxAuth("shopStraightInBill.save")||t.isWeightState(1)||t.isWeightState(2),itemInputFocusing:t.itemInputFocusing},on:{"update:itemInputFocusing":function(e){t.itemInputFocusing=e},"update:item-input-focusing":function(e){t.itemInputFocusing=e},"on-item-edit":t.onItemEdit,"on-unit-edit":t.onUnitEdit,"on-item-focus":t.onItemFocus,"on-search-click":t.onSearchClick}}),i("div",{staticClass:"shopOrder-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillState(1)&&t.$fxAuth("shopStraightInBill.unCheck")&&(t.isWeightState(0)||t.isWeightState(3)),expression:"isBillState(1) && $fxAuth('shopStraightInBill.unCheck') && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onUnExpressClick")}}},[t._v("反审单据")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillState(0)&&t.$fxAuth("shopStraightInBill.check")&&(t.isWeightState(0)||t.isWeightState(3)),expression:"isBillState(0) && $fxAuth('shopStraightInBill.check') && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onExpressClick")}}},[t._v("审核单据")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillState(0)&&t.$fxAuth("shopStraightInBill.save")&&(t.isWeightState(0)||t.isWeightState(3)),expression:"isBillState(0) && $fxAuth('shopStraightInBill.save') && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:function(e){return t.onClickHandler("onSaveClick")}}},[t._v("保存单据")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopStraightInBill.weighState")&&t.isBillState(0)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('shopStraightInBill.weighState') && isBillState(0) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius yellow-btn",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onWeightClick")}}},[t._v("下发称重")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopStraightInBill.weighState")&&t.isBillState(0)&&(t.isWeightState(1)||t.isWeightState(2)),expression:"$fxAuth('shopStraightInBill.weighState') && isBillState(0) && (isWeightState(1) || isWeightState(2))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onUnWeightClick")}}},[t._v("取消称重")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopStraightInBill.weighState")&&t.isBillState(0)&&t.isWeightState(2)&&t.sysDZCManyLower,expression:"$fxAuth('shopStraightInBill.weighState') && isBillState(0) && isWeightState(2) && sysDZCManyLower"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onEndWeightClick")}}},[t._v("结束称重")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopStraightInBill.quickAccess")&&t.isBillState(1),expression:"$fxAuth('shopStraightInBill.quickAccess') && isBillState(1)"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onQuickAccessClick")}}},[t._v("快速领用")])],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,isDisabled:t.isBillState(1)||!t.$fxAuth("shopStraightInBill.save")||t.isWeightState(1)||t.isWeightState(2)},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemSearchPopShow,callback:function(e){t.itemSearchPopShow=e},expression:"itemSearchPopShow"}},[i("itemSearchPop",{attrs:{visibleFlag:t.itemSearchPopShow,data:t.searchItem,isDisabled:t.isBillState(1)||!t.$fxAuth("shopStraightInBill.save")||t.isWeightState(1)||t.isWeightState(2)},on:{"update:visibleFlag":function(e){t.itemSearchPopShow=e},"update:visible-flag":function(e){t.itemSearchPopShow=e},"on-search-confirm":t.onSearchConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.quickAccessPopShow,callback:function(e){t.quickAccessPopShow=e},expression:"quickAccessPopShow"}},[i("quickAccessPop",{attrs:{visibleFlag:t.quickAccessPopShow,data:t.searchItem,billId:t.orderInfoData.id,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,isDisabled:t.isBillState(1)||!t.$fxAuth("shopStraightInBill.save")||t.isWeightState(1)||t.isWeightState(2)},on:{"update:visibleFlag":function(e){t.quickAccessPopShow=e},"update:visible-flag":function(e){t.quickAccessPopShow=e}}})],1)],1)},a=[],s=(i("20d6"),i("5176")),o=i.n(s),r=i("75fc"),l=i("f499"),c=i.n(l),u=(i("7514"),i("b6d0")),h=i.n(u),d=i("774e"),f=i.n(d),m=(i("ac6a"),i("59ad")),p=i.n(m),v=i("795b"),S=i.n(v),g=(i("6762"),i("2fdb"),i("6b54"),i("cebc")),b=i("2f62"),w=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-info-block fx-shadow-block"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},[i("van-collapse-item",{attrs:{name:"1",disabled:t.collapseDisabled}},[i("div",{staticClass:"info-title",attrs:{slot:"title"},slot:"title"},[i("span",{staticClass:"info-title-name"},[t._v("单据信息")]),i("stateText",{staticClass:"stateTag fl-r",attrs:{billState:t.data.billState}}),i("span",{directives:[{name:"show",rawName:"v-show",value:1===t.data.weightState,expression:"data.weightState === 1"}],staticClass:"info-title-weightState"},[t._v("待称重")])],1),i("van-tabs",{attrs:{animated:""},model:{value:t.tabActive,callback:function(e){t.tabActive=e},expression:"tabActive"}},[i("van-tab",{attrs:{title:"表头"}},[i("van-cell",{staticClass:"info-item",attrs:{title:"配送中心","value-class":"info-item-value",value:t.data.rdcDTO&&t.data.rdcDTO.name}}),i("van-cell",{staticClass:"info-item",attrs:{title:"门店","value-class":"info-item-value",value:t.data.shopDTO&&t.data.shopDTO.name}}),i("van-cell",{staticClass:"info-item",attrs:{title:"系统单号","value-class":"info-item-value",value:t.data.sysbillCode}}),i("van-cell",{staticClass:"info-item",attrs:{title:"业务日期",value:t.formatterDate(t.data.businessDate)}}),i("van-cell",{staticClass:"info-item",attrs:{title:"单据类型","value-class":"info-item-value",value:t.data.businessTypeDTO&&t.data.businessTypeDTO.name}}),i("van-pro-field",{staticClass:"info-item",attrs:{label:"手工单号",placeholder:t.isDisabled?"":"请输入手工单号","input-align":"right",maxlength:"50",disabled:t.isDisabled},model:{value:t.data.manualCode,callback:function(e){t.$set(t.data,"manualCode",e)},expression:"data.manualCode"}}),i("van-cell",{staticClass:"info-item",attrs:{title:"称重状态",value:t.weightStateComputed}})],1),i("van-tab",{attrs:{title:"更多"}},[i("van-cell",{staticClass:"info-item",attrs:{title:"制单人",value:t.data.billEmp}}),i("van-cell",{staticClass:"info-item",attrs:{title:"制单日期",value:t.formatterDate(t.data.billDate)}}),i("van-cell",{staticClass:"info-item",attrs:{title:"审核人",value:t.data.checkEmp}}),i("van-cell",{staticClass:"info-item",attrs:{title:"审核日期",value:t.formatterDate(t.data.checkDate)}}),i("van-cell",{staticClass:"info-item",attrs:{title:"订货日期",value:t.formatterDate(t.data.orderDate)}}),i("van-cell",{staticClass:"info-item",attrs:{title:"到货日期",value:t.formatterDate(t.data.arriveDate)}}),i("van-pro-field",{staticClass:"info-item",attrs:{label:"整单备注",placeholder:t.isDisabled?"":"请输入整单备注","input-align":"right",maxlength:"50",disabled:t.isDisabled},model:{value:t.data.billMemo,callback:function(e){t.$set(t.data,"billMemo",e)},expression:"data.billMemo"}})],1)],1)],1)],1)],1)},x=[],D=i("4760"),I={name:"orderInfo",components:{stateText:D["a"]},props:{data:{type:Object,default:function(){return{}}},isDisabled:Boolean,collapseDisabled:Boolean},data:function(){return{activeNames:["1"],tabActive:0}},computed:{formatterDate:function(t){var e=this;return function(t){return"number"===typeof t?e.$fxUtils.setDateTime(new Date(t),"时分"):""}},weightStateComputed:function(){var t=["未称重","待称重","称重中","已称重"];return t[this.data.weightState]}},methods:{closeCollapse:function(){this.activeNames=[]}}},C=I,k=(i("f5e5"),i("2877")),y=Object(k["a"])(C,w,x,!1,null,"5f27ba84",null),P=y.exports,$=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-item-block fx-shadow-block"},[i("div",{staticClass:"item-title"},[i("span",{staticClass:"title-name"},[t._v("单据明细")]),i("span",{staticClass:"title-count"},[t._v("明细：")]),i("span",[t._v(t._s(t.detailsLength))]),i("i",{staticClass:"title-search-icon fl-r",on:{click:t.onSearchClick}})]),i("div",{ref:"details-content",staticClass:"item-list"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeStoreNames,callback:function(e){t.activeStoreNames=e},expression:"activeStoreNames"}},t._l(t.data,function(e){return i("van-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.storeShowComputed(e),expression:"storeShowComputed(storeItem)"}],key:e.id,staticClass:"store-row",attrs:{name:e.id}},[i("div",{staticClass:"item-store-title fx-ellipsis",attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),t._l(e.details,function(n){return i("div",{key:e.id+"-"+n.goodsDTO.id,ref:"details-row-"+e.id+"-"+n.goodsDTO.id,refInFor:!0,staticClass:"item-row"},[i("itemInfoCell",t._g({attrs:{itemData:n,isDisabled:t.isDisabled,disabledEditBtn:t.focusing},on:{"on-item-focus":function(i){return t.onItemFocus(arguments,e.id+"-"+n.goodsDTO.id)},"on-item-blur":t.onItemBlur}},t.$listeners))],1)})],2)}),1)],1)])},F=[],A=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-info-cell"},[i("div",{staticClass:"item-img"},[i("img",{attrs:{src:t.comptedItemImgSrc(t.itemData.goodsDTO.imageUrls),onerror:t.$fxCommon.errorImg("item")}})]),i("div",{staticClass:"item-details"},[i("div",{staticClass:"item-name fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.name))]),i("div",{staticClass:"item-taxprice fx-ellipsis"},[i("span",[t._v("含税金额：￥")]),!t.isDisabled&&t.$fxAuth("shopStraightInBill.editWithTaxMoney")?i("w-number-input",{staticClass:"item-taxprice-input",attrs:{min:"0",max:t.maxAmount,intLength:t.numberLength,pointSize:t.sysPointSize,disabled:t.busUnitInAmountIs0},on:{change:t.onPriceChange,focus:t.onFocus,blur:t.onBlur},model:{value:t.itemData.inMoneyWithTax,callback:function(e){t.$set(t.itemData,"inMoneyWithTax",e)},expression:"itemData.inMoneyWithTax"}}):i("span",[t._v(t._s(t.itemData.inMoneyWithTax))])],1),i("div",{staticClass:"item-amount-spec"},[i("div",{staticClass:"item-spec fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.spec))]),t.isDisabled||t.itemData.isWeightSign&&!t.sysDZCCanModifyAcount||!t.$fxAuth("shopStraightInBill.editAmount")?i("div",{staticClass:"item-amount"},[i("span",[t._v(t._s(t.itemData.busUnitInAmount))]),i("span",{staticClass:"fx-ellipsis"},[t._v(t._s(t.itemData.unitDTO.name))])]):i("div",{staticClass:"item-amount"},[i("w-stepper",{ref:"amountInput",staticClass:"amount-step",attrs:{min:"0",max:t.maxAmount,stepperBtnShow:!1,intLength:t.numberLength,pointSize:t.sysPointSize,inputWidth:"28vw"},on:{change:t.onChange,focus:t.onFocus,blur:t.onBlur},model:{value:t.itemData.busUnitInAmount,callback:function(e){t.$set(t.itemData,"busUnitInAmount",e)},expression:"itemData.busUnitInAmount"}}),i("div",{staticClass:"item-unit"},[i("span",{staticClass:"fx-ellipsis cell-unit",on:{click:function(e){return e.stopPropagation(),t.onUnitClick(e)}}},[t._v(t._s(t.itemData.unitDTO.name))]),i("van-icon",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],attrs:{name:"arrow-down"}})],1)],1)])]),i("i",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&!t.disabledEditBtn,expression:"!isDisabled && !disabledEditBtn"}],staticClass:"block-item-edit",on:{click:t.onItemEditClick}}),i("i",{directives:[{name:"show",rawName:"v-show",value:t.isDisabled,expression:"isDisabled"}],staticClass:"block-item-watch",on:{click:t.onItemEditClick}})])},T=[],B={name:"itemInfoCell",props:{itemData:{type:Object,default:function(){return{}}},disabledEditBtn:Boolean,isDisabled:Boolean,blurSetFocusFlag:{type:Boolean,default:!0}},computed:Object(g["a"])({},Object(b["c"])({sysDZCCanModifyAcount:function(t){return t.systemParams.sysDZCCanModifyAcount},sysPointSize:"sysPointSize",numberLength:"numberLength",maxAmount:"maxAmount"}),{comptedItemImgSrc:function(t){return function(t){return t?0===t.length?"":t[0]:""}},busUnitInAmountIs0:function(){return 0===this.itemData.busUnitInAmount||"0"===this.itemData.busUnitInAmount}}),methods:{onPriceChange:function(){this.editItem();var t=this.itemData,e=t.busUnitInAmount,i=t.taxPrice,n=t.inMoney,a=t.price,s=t.tax,o=t.inMoneyWithTax,r=t.taxInMoney;i=p()(this.$fxUtils.toFixedSHW(o/e,this.sysPointSize)),n=p()(this.$fxUtils.toFixedSHW(o/(1+s),this.sysPointSize)),a=p()(this.$fxUtils.toFixedSHW(n/e,this.sysPointSize)),r=p()(this.$fxUtils.toFixedSHW(n*s,this.sysPointSize)),this.itemData.taxPrice=i,this.itemData.inMoney=n,this.itemData.price=a,this.itemData.taxInMoney=r},onChange:function(t){this.onAmountChange(t)},onAmountChange:function(t){this.editItem();var e=this.itemData,i=e.inMoneyWithTax,n=e.taxPrice,a=e.inMoney,s=e.taxInMoney,o=e.price,r=e.tax;i=p()(this.$fxUtils.toFixedSHW(n*t,this.sysPointSize)),a=p()(this.$fxUtils.toFixedSHW(o*t,this.sysPointSize)),s=p()(this.$fxUtils.toFixedSHW(a*r,this.sysPointSize)),this.itemData.inMoneyWithTax=i,this.itemData.inMoney=a,this.itemData.taxInMoney=s},editItem:function(){this.$set(this.itemData,"changeType","edit")},onItemEditClick:function(){this.editItem(),this.$emit("on-item-edit",this.itemData)},onUnitClick:function(){if(this.isDisabled)return!1;this.editItem(),this.$emit("on-unit-edit",this.itemData)},onFocus:function(){this.$emit("on-item-focus")},onBlur:function(){var t=this,e=!0;this.blurSetFocusFlag||(e=!1),this.onCheckAmount(e).then(function(){t.$emit("on-item-blur")}).catch(function(){t.blurSetFocusFlag?(t.$refs.amountInput.setFocus(),t.$emit("on-item-focus")):t.$emit("on-item-blur-fail")})},onCheckAmount:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new S.a(function(i,n){var a=t.itemData.goodsDTO,s=t.itemData,o=s.busUnitInAmount,r=s.rawAmount,l="数量不符合规则";r>0&&"0"===a.disOvercharge&&o>r+r*a.overchargePortion/100?(e&&t.$fxNotify.fail("入库数量不能超出订货数量"+a.overchargePortion+"%"),n(l)):i()})}}},E=B,O=(i("6c9d"),Object(k["a"])(E,A,T,!1,null,"2626f9ec",null)),L=O.exports,W={name:"orderItem",components:{itemInfoCell:L},props:{data:{type:Array,default:function(){return[]}},itemInputFocusing:Boolean,isDisabled:Boolean},data:function(){return{focusing:!1,activeStoreNames:[]}},computed:Object(g["a"])({},Object(b["c"])({loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{storeShowComputed:function(t){return function(t){var e=t.details.length;return e>0}},detailsLength:function(){return this.data.reduce(function(t,e){var i=e.details.filter(function(t){return"del"!==t.changeType});return t+i.length},0)}}),watch:{focusing:function(t){this.$emit("update:itemInputFocusing",t)},data:function(){var t=this;this.data.forEach(function(e){var i=e.details.filter(function(t){return"del"!==t.changeType}).length;i>0&&t.activeStoreNames.push(e.id)})}},methods:{onSearchClick:function(){if(this.focusing)return!1;this.$emit("on-search-click")},onItemFocus:function(t,e){this.focusing=!0},onItemBlur:function(){this.focusing=!1}}},U=W,_=(i("ef37"),Object(k["a"])(U,$,F,!1,null,"ac7bc2a6",null)),N=_.exports,R=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"itemRowEdit-popup"},[i("w-header",{attrs:{title:t.currentItemData.goodsDTO.name,leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{ref:"rowEditContent",staticClass:"itemRowEdit-content"},[i("van-cell-group",[i("van-cell",{attrs:{title:"入库数量",value:t.currentItemData.busUnitInAmount,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"差异数量",value:t.differenceAmount,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"非税单价",value:t.currentItemData.price,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"非税金额",value:t.currentItemData.inMoney,"value-class":"info-item-value"}}),i("van-cell",{class:{"text-tax":!t.isDisabled},attrs:{title:"税率",value:t.fomatterTaxes(t.currentItemData.tax),"is-link":!t.isDisabled,"value-class":"info-item-value"},on:{click:t.onTaxClick}}),i("van-cell",{attrs:{title:"税额",value:t.currentItemData.taxInMoney,"value-class":"info-item-value"}}),i("van-pro-number-field",{ref:"taxPrice",attrs:{label:"含税单价","input-align":"right",min:"0",max:t.maxAmount,intLength:t.numberLength,pointSize:t.sysPointSize,disabled:t.isDisabled||!t.$fxAuth("shopStraightInBill.ediPrice")||t.busUnitInAmountIs0},on:{change:function(e){return t.onTaxInMoneyChange(t.currentItemData.taxPrice)},focus:function(e){return t.onFocus("taxPrice")}},model:{value:t.currentItemData.taxPrice,callback:function(e){t.$set(t.currentItemData,"taxPrice",e)},expression:"currentItemData.taxPrice"}}),i("van-cell",{attrs:{title:"生产日期",value:t.fomatterDate(t.currentItemData.productDate),"is-link":!t.isDisabled},on:{click:t.onProductDateClick}}),i("van-cell",{attrs:{title:"品项编号",value:t.currentItemData.goodsDTO.code,"value-class":"info-item-value"}}),i("van-pro-field",{attrs:{placeholder:t.setPlaceholder("请输入备注"),disabled:t.isDisabled,label:"备注","input-align":"right"},on:{focus:function(e){return t.onFocus("memo")}},model:{value:t.currentItemData.memo,callback:function(e){t.$set(t.currentItemData,"memo",e)},expression:"currentItemData.memo"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"净重量",value:t.toFixedNumberSize(t.currentItemData.netWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"皮重量",value:t.toFixedNumberSize(t.currentItemData.skinWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"毛重量",value:t.toFixedNumberSize(t.currentItemData.grossWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"称重单位",value:t.currentItemData.weightUnit,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"称重状态",value:t.currentItemData.isWeightSign?"已称重":"未称重","value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"图片",border:!1,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData&&t.currentItemData.images.length,expression:"sysShowDZCData && currentItemData.images.length"}],staticClass:"info-cell-img",attrs:{"value-class":"info-item-img"}},[i("img",{attrs:{src:t.comptedItemImgSrc(t.currentItemData.images)}})])],1)],1),i("div",{staticClass:"itemRowEdit-bottom"},[t.isDisabled?i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onCloseClick}},[t._v("确定")]):i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onConfirmClick}},[t._v("保存")])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("taxesActionSheet",{attrs:{sync:!0},on:{"on-taxes-select":t.onTaxesSelect},model:{value:t.taxesActionShow,callback:function(e){t.taxesActionShow=e},expression:"taxesActionShow"}})],1)},H=[],M=i("bfb3"),z=i.n(M),q=i("f729"),j={name:"itemRowEdit",components:{taxesActionSheet:q["a"]},props:{visibleFlag:Boolean,itemData:{type:Object,default:function(){return{}}},isDisabled:Boolean},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},currentItemData:{},currentDate:new Date,datePickerShow:!1,taxesActionShow:!1}},computed:Object(g["a"])({},Object(b["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",maxAmount:"maxAmount",sysShowDZCData:function(t){return t.systemParams.sysShowDZCData},loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{differenceAmount:function(){var t=this.toFixedNumberSize(this.currentItemData.rawAmount-this.currentItemData.busUnitInAmount);return z()(t)?"":t},fomatterDate:function(t){var e=this;return function(t){return t?e.$fxUtils.setDateTime(new Date(t),"时分"):""}},fomatterTaxes:function(t){var e=this;return function(t){if(t){var i=e.$fxUtils.toFixedSHW(100*t,2,!1);return"".concat(i,"%")}return"0%"}},busUnitInAmountIs0:function(){return 0===this.itemData.busUnitInAmount||"0"===this.itemData.busUnitInAmount},setPlaceholder:function(t){var e=this;return function(t){return e.isDisabled?"":t}},comptedItemImgSrc:function(t){return function(t){return t?0===t.length?"":t[0].imagUrl:""}}}),watch:{visibleFlag:{handler:function(t){t&&(this.currentItemData=JSON.parse(c()(this.itemData)))},immediate:!0}},methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onConfirmClick:function(){this.currentItemData.changeType="edit",this.$emit("on-Confirm",this.currentItemData),this.$emit("update:visibleFlag",!1)},onProductDateClick:function(){if(this.isDisabled)return!1;this.currentItemData.productDate&&(this.currentDate=new Date(this.currentItemData.productDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){this.currentItemData.productDate=t.getTime(),this.datePickerShow=!1},onTaxClick:function(){return!this.isDisabled&&!this.busUnitInAmountIs0&&(this.$fxAuth("shopStraightInBill.ediTax")?void(this.taxesActionShow=!0):(this.$fxToast({message:"当前没有修改税率的权限!",position:"top"}),!1))},onTaxesSelect:function(t){this.currentItemData.tax=t.tax,this.computedByTaxes(t.tax),this.taxesActionShow=!1},computedCurrentItemData:function(){return{price:this.currentItemData.price,taxPrice:this.currentItemData.taxPrice,inMoney:this.currentItemData.inMoney,inMoneyWithTax:this.currentItemData.inMoneyWithTax,taxInMoney:this.currentItemData.taxInMoney,tax:this.currentItemData.tax,busUnitInAmount:this.currentItemData.busUnitInAmount}},computedByTaxes:function(t){var e=this.computedCurrentItemData(),i=e.price,n=e.taxPrice,a=e.inMoney,s=e.taxInMoney,o=e.inMoneyWithTax;i=p()(this.$fxUtils.toFixedSHW(n/(1+t),this.sysPointSize)),a=p()(this.$fxUtils.toFixedSHW(o/(1+t),this.sysPointSize)),s=p()(this.$fxUtils.toFixedSHW(a*t,this.sysPointSize)),this.currentItemData.price=i,this.currentItemData.inMoney=a,this.currentItemData.taxInMoney=s},onPriceChange:function(t){var e=this.computedCurrentItemData(),i=e.tax,n=e.busUnitInAmount,a=p()(t);a=this.$fxUtils.toFixedSHW(a,this.sysPointSize),this.currentItemData.price=a,this.currentItemData.taxPrice=p()(this.$fxUtils.toFixedSHW(a*(1+i),this.sysPointSize)),this.currentItemData.inMoney=p()(this.$fxUtils.toFixedSHW(a*n,this.sysPointSize)),this.currentItemData.taxInMoney=p()(this.$fxUtils.toFixedSHW(this.currentItemData.inMoney*i,this.sysPointSize)),this.currentItemData.inMoneyWithTax=p()(this.$fxUtils.toFixedSHW(this.currentItemData.inMoney*(1+i),this.sysPointSize))},toFixedNumberSize:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sysPointSize;return p()(this.$fxUtils.toFixedSHW(t,e))},onInMoneyChange:function(t){var e=this.computedCurrentItemData(),i=e.tax,n=e.busUnitInAmount,a=p()(t);a=this.$fxUtils.toFixedSHW(a,this.sysPointSize),this.currentItemData.taxInMoney=p()(this.$fxUtils.toFixedSHW(a*i,this.sysPointSize)),this.currentItemData.price=p()(this.$fxUtils.toFixedSHW(a/n,this.sysPointSize)),this.currentItemData.taxPrice=p()(this.$fxUtils.toFixedSHW(this.currentItemData.price*(1+i),this.sysPointSize)),this.currentItemData.inMoneyWithTax=p()(this.$fxUtils.toFixedSHW(t*(1+i),this.sysPointSize))},onTaxInMoneyChange:function(t){var e=this.computedCurrentItemData(),i=e.tax,n=e.busUnitInAmount,a=p()(t);a=this.$fxUtils.toFixedSHW(a,this.sysPointSize),this.currentItemData.price=p()(this.$fxUtils.toFixedSHW(a/(1+i),this.sysPointSize)),this.currentItemData.inMoney=p()(this.$fxUtils.toFixedSHW(this.currentItemData.price*n,this.sysPointSize)),this.currentItemData.taxInMoney=p()(this.$fxUtils.toFixedSHW(this.currentItemData.inMoney*i,this.sysPointSize)),this.currentItemData.inMoneyWithTax=p()(this.$fxUtils.toFixedSHW(this.currentItemData.inMoney*(1+i),this.sysPointSize))},onFocus:function(t){this.onScrollTop(t)},onScrollTop:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,i=this.$refs[t];if(!i||0===i.length)return!1;var n=i.$el.offsetTop,a=this.$refs["rowEditContent"];this.$fxUtils.scrollTopW({offsetTop:n,$el:a,distance:e})}}},Z=j,K=(i("c9d9"),Object(k["a"])(Z,R,H,!1,null,"525ef716",null)),G=K.exports,J=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-search-block"},[i("w-header",{attrs:{title:"搜索品项",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{staticClass:"item-search clearfix"},[i("van-search",{attrs:{placeholder:"请输入搜索关键词",shape:"round"},on:{search:t.onConfirmKey},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}})],1),i("div",{ref:"details-content",staticClass:"item-list"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeStoreNames,callback:function(e){t.activeStoreNames=e},expression:"activeStoreNames"}},t._l(t.data,function(e){return i("van-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.storeShowComputed(e),expression:"storeShowComputed(storeItem)"}],key:e.id,staticClass:"store-row",attrs:{name:e.id}},[i("div",{staticClass:"item-store-title fx-ellipsis",attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),t._l(t.detailFilter(e.details),function(n){return i("van-swipe-cell",{directives:[{name:"show",rawName:"v-show",value:n.showFlag,expression:"item.showFlag"}],key:e.id+"-"+n.goodsDTO.id,ref:"details-row-"+e.id+"-"+n.goodsDTO.id,refInFor:!0,staticClass:"item-row"},[i("itemInfoCell",{attrs:{itemData:n,isDisabled:t.isDisabled,disabledEditBtn:t.focusing},on:{"on-unit-edit":t.onUnitEdit,"on-item-edit":t.onSearchItemEdit}})],1)})],2)}),1)],1),i("div",{staticClass:"search-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onSearchConfirm}},[t._v("保存")])],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,isDisabled:t.isDisabled},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}})],1)},Y=[],V=(i("28a5"),{name:"itemSearchPop",components:{itemInfoCell:L,itemRowEditPop:G},props:{data:{type:Array,default:function(){return[]}},isDisabled:Boolean,visibleFlag:Boolean},data:function(){return{focusing:!1,leftOptions:{showBackBtn:!0,preventGoBack:!0},unitActionShow:!1,unitActions:[],searchKey:"",itemRowEditPopShow:!1,itemEditRowData:{},activeStoreNames:[]}},created:function(){this.isDisabled||this.$fxEventBus.$on("redCode",this.getItemByRedCode)},beforeDestroy:function(){this.$fxEventBus.$off("redCode",this.getItemByRedCode)},watch:{visibleFlag:{handler:function(t){var e=this;t&&(this.searchKey="",this.showData(this.data),this.data.forEach(function(t){var i=t.details.filter(function(t){return"del"!==t.changeType}).length;i>0&&e.activeStoreNames.push(t.id)}))},immediate:!0}},computed:Object(g["a"])({},Object(b["c"])({sysPointSize:"sysPointSize"})),methods:{storeShowComputed:function(t){return this.detailFilter(t.details).length>0},detailFilter:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"code,name,pinYin";return t.filter(function(t){return"del"!==t.changeType&&t.showFlag&&!!i.split(",").find(function(i){if(t.goodsDTO[i].toLowerCase().includes(e.searchKey.toLowerCase()))return!0})})},onCloseClick:function(){if(this.focusing)return!1;this.$emit("update:visibleFlag",!1)},onItemFocus:function(t,e){this.focusing=!0},onItemBlur:function(){this.focusing=!1},onSearchItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this.data.findIndex(function(e){return e.id===t.inHouseDTO.id});if(~e){var i=this.data[e].details.findIndex(function(e){return e.goodsDTO.id===t.goodsDTO.id});~i&&(this.data[e].details[i]=t)}},onUnitEdit:function(t){var e=this;this.itemEditRowData=t,this.getItemUnit(t.goodsDTO.id).then(function(t){e.unitActions=t,e.unitActionShow=!0})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemEditRowData,i=e.unitDTO,n=i.value/t.value,a=p()(this.$fxUtils.toFixedSHW(e.rawAmount*n,this.sysPointSize)),s=p()(this.$fxUtils.toFixedSHW(e.busUnitInAmount*n,this.sysPointSize)),o=p()(this.$fxUtils.toFixedSHW(e.inMoneyWithTax/s,this.sysPointSize)),r=p()(this.$fxUtils.toFixedSHW(e.inMoney/s,this.sysPointSize));e.unitDTO=t,e.rawAmount=a,e.busUnitInAmount=s,e.taxPrice=o,e.price=r},getItemUnit:function(t){var e=this;return new S.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/shopId/users/userId/goods/").concat(t,"/units"),query:{userId:e.loginerId}}).then(function(t){i(t.units)})})},onSearchConfirm:function(){if(this.focusing)return!1;this.$emit("on-search-confirm",this.data),this.$emit("update:visibleFlag",!1)},toFixedNumberSize:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sysPointSize;return p()(this.$fxUtils.toFixedSHW(t,e))},getItemByRedCode:function(t){var e=this;if(!this.visibleFlag)return!1;this.getItemByCode(t).then(function(t){var i=t.billAndDetails[0];if(0===i.length)return e.$fxToast.top("当前仓库无此品项!"),!1;e.hideItemData(e.data);for(var n=null,a=0;a<e.data.length;a++)if(n=e.data[a].details.find(function(t){return t.goodsDTO.id===i.goodsDTO.id&&"del"!==t.changeType}),n)break;n?(e.itemUpdate(i,n),e.$set(n,"showFlag",!0)):e.$fxToast.top("无此品项!"),e.searchKey=""})},itemUpdate:function(t,e){var i=e.unitDTO,n=t.unitDTO,a=n.value/i.value,s=t.goodsDTO.countValue*a;e.id&&this.$set(e,"changeType","edit"),this.onAmountChange(s,e)},onAmountChange:function(t,e){var i=e.inMoneyWithTax,n=e.taxPrice,a=e.inMoney,s=e.taxInMoney,o=e.price,r=e.tax;i=this.toFixedNumberSize(n*t),a=this.toFixedNumberSize(o*t),s=this.toFixedNumberSize(a*r),e.inMoneyWithTax=i,e.inMoney=a,e.taxInMoney=s,e.busUnitInAmount=this.toFixedNumberSize(t)},getItemByCode:function(t){var e=this;return new S.a(function(i){var n={m:"getGoodsByBarCode4Modify",barCodes:t};e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/users/").concat(e.loginerId,"/goods"),data:n}).then(function(t){i(t)})})},hideItemData:function(t){var e=this;t.forEach(function(t){t.details.forEach(function(t){e.$set(t,"showFlag",!1)})})},showData:function(t){var e=this;t.forEach(function(t){t.details.forEach(function(t){e.$set(t,"showFlag",!0)})})},onConfirmKey:function(){""===this.searchKey&&this.showData(this.data)}}}),Q=V,X=(i("54a2"),Object(k["a"])(Q,J,Y,!1,null,"7b584092",null)),tt=X.exports,et=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-search-block"},[i("w-header",{attrs:{title:"快速生成部门领用",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("searchHead",{attrs:{initSearch:t.visibleFlag,searchKey:t.searchKey,selectActive:t.isSelectAll},on:{"update:searchKey":function(e){t.searchKey=e},"update:search-key":function(e){t.searchKey=e},"on-select-click":t.onSelectAllClick}}),i("div",{staticClass:"order-info-block fx-shadow-block"},[i("van-cell-group",[i("van-cell",{staticClass:"info-item",attrs:{title:"领用部门",value:t.department,"value-class":"info-item-value","is-link":""},on:{click:t.onDepartmentClick}})],1)],1),i("div",{ref:"details-content",staticClass:"item-list"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeStoreNames,callback:function(e){t.activeStoreNames=e},expression:"activeStoreNames"}},t._l(t.data,function(e){return i("van-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.storeShowComputed(e),expression:"storeShowComputed(storeItem)"}],key:e.id,staticClass:"store-row",attrs:{name:e.id}},[i("div",{staticClass:"item-store-title fx-ellipsis",attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),t._l(t.detailFilter(e.details),function(n){return i("van-swipe-cell",{key:e.id+"-"+n.goodsDTO.id,ref:"details-row-"+e.id+"-"+n.goodsDTO.id,refInFor:!0,staticClass:"item-row"},[i("div",{staticClass:"item-cell"},[i("checkBox",{staticClass:"search-checkbox",attrs:{visibleFlag:!0,checked:n.checked},on:{"on-checkbox-click":function(e){return t.onCheckBoxClick(n)}}}),i("itemInfoCell",{staticClass:"search-info",attrs:{itemData:n,isDisabled:t.isDisabled},on:{"on-item-edit":t.onSearchItemEdit}})],1)])})],2)}),1)],1),i("div",{staticClass:"search-bottom"},[i("van-button",{staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onConfirm}},[t._v("确认")])],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,isDisabled:t.isDisabled},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e}}})],1),i("filterListPopup",{attrs:{title:"部门检索",rollingLoad:!0,getDataApi:t.getDepartmentListData},on:{"on-select":t.selectDepartment},model:{value:t.departmentPopShow,callback:function(e){t.departmentPopShow=e},expression:"departmentPopShow"}})],1)},it=[],nt=(i("7f7f"),i("01db")),at=i("eb03"),st=i("0f38"),ot={name:"quickAccessPop",components:{searchHead:nt["a"],itemInfoCell:L,itemRowEditPop:G,filterListPopup:at["a"],checkBox:st["a"]},props:{data:{type:Array,default:function(){return[]}},isDisabled:Boolean,visibleFlag:Boolean,shopId:String,billId:{type:String,default:function(){return""}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},unitActionShow:!1,unitActions:[],searchKey:"",itemRowEditPopShow:!1,itemEditRowData:{},activeStoreNames:[],department:"请选择",departmentId:"",departmentPopShow:!1,departmentList:[]}},watch:{visibleFlag:{handler:function(t){var e=this;t&&(this.searchKey="",this.data.forEach(function(t){var i=t.details.filter(function(t){return"del"!==t.changeType}).length;i>0&&e.activeStoreNames.push(t.id)}),this.setDefaultDepartment())},immediate:!0}},computed:{isSelectAll:function(){var t=this,e=0,i=0;return this.data.forEach(function(n){var a=t.detailFilter(n.details);e+=a.filter(function(t){return"del"!==t.changeType&&t.checked}).length,i+=a.length}),0!==e&&e===i}},methods:{storeShowComputed:function(t){return this.detailFilter(t.details).length>0},detailFilter:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"code,name,pinYin";return t.filter(function(t){return"del"!==t.changeType&&!!i.split(",").find(function(i){if(t.goodsDTO[i].toLowerCase().includes(e.searchKey.toLowerCase()))return!0})})},onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onSearchItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onCheckBoxClick:function(t){this.$set(t,"checked",!t.checked)},onSelectAllClick:function(){var t=this,e=!this.isSelectAll;this.data.forEach(function(i){var n=t.detailFilter(i.details);n.forEach(function(i){"del"!==i.changeType&&t.$set(i,"checked",e)})})},setDefaultDepartment:function(){var t=this,e={start:0,size:1,id:this.shopId};return this.$fxApi("z5common.getDepartment")({data:e}).then(function(e){t.department=e.departmentDTOData[0].name,t.departmentId=e.departmentDTOData[0].id})},onDepartmentClick:function(){this.departmentPopShow=!0},getDepartmentListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,n={keyword:t,start:e,size:i,id:this.shopId};return this.$fxApi("z5common.getDepartment")({data:n}).then(function(t){return t.departmentDTOData})},selectDepartment:function(t){this.department=t.name,this.departmentId=t.id},checkSelectInfo:function(){var t=this;return new S.a(function(e){var i=t.data.filter(function(t){return t.details.find(function(t){return t.checked&&"del"!==t.changeType})});return 0===i.length?(t.$fxToast.top("请先选择品项!"),!1):t.departmentId?void e():(t.$fxToast.top("请先选择部门!"),!1)})},getSaveParams:function(){var t=[];this.data.forEach(function(e){t.push.apply(t,Object(r["a"])(e.details))});var e=t.reduce(function(t,e){var i=e.checked&&"del"!==e.changeType?t.concat(e.id):t;return i},[]);return e},onConfirm:function(){var t=this;this.checkSelectInfo().then(function(){var e={billId:t.billId,detailIds:t.getSaveParams(),departmentId:t.departmentId};return t.$fxApi("shopStraightInBill.quickAccess")({data:e}).then(function(e){t.$dialog.alert({title:"提示",message:e.message}),t.$emit("update:visibleFlag",!1)})})}}},rt=ot,lt=(i("5e15"),Object(k["a"])(rt,et,it,!1,null,"52a4ad4a",null)),ct=lt.exports,ut={name:"directOrderDetails",components:{orderInfo:P,orderItem:N,itemRowEditPop:G,itemSearchPop:tt,quickAccessPop:ct},data:function(){return{query:this.$route.query,activeNames:["1"],tabActive:"选项1",orderInfoData:{},orderItemList:[],itemRowEditPopShow:!1,itemEditRowData:{},unitActionShow:!1,unitActions:[],formatterSysPointKey:["price","inMoney","taxInMoney","taxPrice","inMoneyWithTax","busUnitInAmount"],itemSearchPopShow:!1,quickAccessPopShow:!1,searchItem:[],itemInputFocusing:!1}},created:function(){this.createOrderDetails()},beforeRouteLeave:function(t,e,i){var n=this;if(this.itemInputFocusing)return this.$router.go(1),!1;"/directOrder"===t.path&&0===this.orderInfoData.billState?this.$dialog.confirm({title:"提示",message:"若已修改,请先保存单据<br/>是否关闭页面?"}).then(function(){i()}).catch(function(){return n.$router.go(1),!1}):i()},computed:Object(g["a"])({},Object(b["c"])({sysPointSize:"sysPointSize",sysDZCManyLower:function(t){return t.systemParams.sysDZCManyLower},loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{isBillState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.billState):e.orderInfoData.billState===t}},isWeightState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.weightState):e.orderInfoData.weightState===t}}}),methods:{createOrderDetails:function(){var t=this;return new S.a(function(e){t.getOrderDetails().then(function(i){var n=i.storeBills[0];t.formatterSysPoint(n.details),t.orderInfoData=n,t.orderItemList=t.filterStoreItem(n.details),e()})})},getOrderDetails:function(){var t=this;return new S.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shopstraightinbills/").concat(t.query.orderId)}).then(function(t){e(t)})})},formatterSysPoint:function(t){var e=this,i=function(t){return p()(e.$fxUtils.toFixedSHW(t,e.sysPointSize))};t.forEach(function(t){e.formatterSysPointKey.forEach(function(e){t[e]=i(t[e])})})},filterStoreItem:function(t){var e=f()(new h.a(t.map(function(t){return t.inHouseDTO.id}))),i=e.map(function(e){var i=t.find(function(t){return t.inHouseDTO.id===e}).inHouseDTO;return i=JSON.parse(c()(i)),i.details=t.filter(function(t){return t.inHouseDTO.id===e}),i});return i},onSaveClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要保存该单据吗?"}).then(function(){var e=t.getSaveParams();t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shopstraightinbills/").concat(t.query.orderId),data:e,query:{userId:t.loginerId,m:"modify"}}).then(function(e){t.$fxToast.success("保存成功").then(function(){t.createOrderDetails()})})}).catch(function(){})},onExpressClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要审核该单据吗?"}).then(function(){var e=t.getSaveParams();t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shopstraightinbills/").concat(t.query.orderId),data:e,query:{userId:t.loginerId,m:"editAndCheck"}}).then(function(e){t.$fxToast.success("审核成功").then(function(){t.createOrderDetails()})})}).catch(function(){})},onUnExpressClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要反审该单据吗?"}).then(function(){var e=t.getSaveParams();t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shopstraightinbills/").concat(t.query.orderId),data:e,query:{userId:t.loginerId,m:"unCheck"}}).then(function(e){t.$fxToast.success("反审成功").then(function(){t.createOrderDetails()})})}).catch(function(){})},onRetrunClick:function(){console.log("生成退货单")},onWeightClick:function(){var t=this;this.checkHasDetails().then(function(){t.$dialog.confirm({title:"提示",message:"确定要下发称重吗?"}).then(function(){var e=t.getSaveParams();if(!e)return!1;t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shopstraightinbills/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:e,query:{userId:t.loginerId,m:"weighBill"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("下发称重成功")})})}).catch(function(){})})},onUnWeightClick:function(){var t=this;this.checkHasDetails().then(function(){var e="确定要取消称重吗?";2===t.orderInfoData.weighState&&(e="称重中的单据，取消称重后电子秤可以继续称重并传回数据！确定要取消称重吗"),t.$dialog.confirm({title:"提示",message:e}).then(function(){t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shopstraightinbills/").concat(t.query.orderId,"/users/").concat(t.loginerId),query:{userId:t.loginerId,m:"unWeighBill"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("取消称重成功")})})}).catch(function(){})})},onEndWeightClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"结束称重后将不再接收此单据的称重数据"}).then(function(){t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shopstraightinbills/").concat(t.query.orderId,"/users/").concat(t.loginerId),query:{userId:t.loginerId,m:"endWeighBill"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("结束称重成功")})})}).catch(function(){})},onClickHandler:function(t){if(this.itemInputFocusing)return!1;this[t]()},getValidItem:function(){var t=[];return this.orderItemList.forEach(function(e){t.push.apply(t,Object(r["a"])(e.details))}),t.filter(function(t){return"del"!==t.changeType})},getItemLength:function(){return this.getValidItem().length},checkHasDetails:function(){var t=this;return new S.a(function(e){0===t.getItemLength()?t.$fxToast.fail("单据明细不能为空"):e()})},getSaveParams:function(){var t=[];this.orderItemList.forEach(function(e){t.push.apply(t,Object(r["a"])(e.details))});var e=t.filter(function(t){return"edit"===t.changeType}),i=o()({},this.orderInfoData,{detailMdf:e,details:[]});return i},onItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){this.orderItemList.forEach(function(e){var i=e.details.findIndex(function(e){return e.id===t.id});~i&&(e.details[i]=t)})},onUnitEdit:function(t){var e=this;this.itemEditRowData=t,this.getItemUnit(t.goodsDTO.id).then(function(t){e.unitActions=t,e.unitActionShow=!0})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemEditRowData,i=e.unitDTO,n=i.value/t.value,a=p()(this.$fxUtils.toFixedSHW(e.rawAmount*n,this.sysPointSize)),s=p()(this.$fxUtils.toFixedSHW(e.busUnitInAmount*n,this.sysPointSize)),o=p()(this.$fxUtils.toFixedSHW(e.inMoneyWithTax/s,this.sysPointSize)),r=p()(this.$fxUtils.toFixedSHW(e.inMoney/s,this.sysPointSize));e.unitDTO=t,e.rawAmount=a,e.busUnitInAmount=s,e.taxPrice=o,e.price=r},getItemUnit:function(t){var e=this;return new S.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/shopId/users/userId/goods/").concat(t,"/units"),query:{userId:e.loginerId}}).then(function(t){i(t.units)})})},onItemFocus:function(){this.$refs.orderInfo.closeCollapse()},onSearchClick:function(){this.itemSearchPopShow=!0,this.searchItem=JSON.parse(c()(this.orderItemList))},onSearchConfirm:function(t){this.orderItemList=t},onQuickAccessClick:function(){this.quickAccessPopShow=!0,this.searchItem=JSON.parse(c()(this.orderItemList))}}},ht=ut,dt=(i("3fa8"),Object(k["a"])(ht,n,a,!1,null,"a098441c",null));e["default"]=dt.exports},c9d9:function(t,e,i){"use strict";var n=i("56eb"),a=i.n(n);a.a},cea9:function(t,e,i){},ef37:function(t,e,i){"use strict";var n=i("0621"),a=i.n(n);a.a},f53d:function(t,e,i){"use strict";var n=i("5116"),a=i.n(n);a.a},f5e5:function(t,e,i){"use strict";var n=i("3d71"),a=i.n(n);a.a},f7bd:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-directOrder"},[i("w-header",{attrs:{title:"直通入库单",border:!0}},[i("headEditBtn",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopStraightInBill.check"),expression:"$fxAuth('shopStraightInBill.check')"}],attrs:{slot:"header-right",active:t.orderEditFlag},on:{click:t.onOrderEditClick},slot:"header-right"}),i("headSearchBtn",{directives:[{name:"show",rawName:"v-show",value:!t.orderEditFlag,expression:"!orderEditFlag"}],attrs:{slot:"header-right"},on:{click:t.onSearchClick},slot:"header-right"}),i("headSelectAllBtn",{directives:[{name:"show",rawName:"v-show",value:t.orderEditFlag,expression:"orderEditFlag"}],attrs:{slot:"header-right",active:t.isSelectAll},on:{click:t.onSelectAllClick},slot:"header-right"})],1),i("filterTab",{attrs:{state:t.computedState,difference:t.computedDifference},on:{"on-state-click":t.onStateClick,"on-difference-click":t.onDifferenceClick}}),i("div",{staticClass:"directOrder-content"},[i("van-pull-refresh",{directives:[{name:"show",rawName:"v-show",value:0!==t.orderList.length,expression:"orderList.length !== 0"}],staticClass:"directOrder-list",on:{refresh:t.onPullRefresh},model:{value:t.pullRefreshLoading,callback:function(e){t.pullRefreshLoading=e},expression:"pullRefreshLoading"}},[i("van-list",{attrs:{finished:t.loadFinished,"finished-text":"没有更多了",error:t.listError,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.listError=e},load:t.onLoadMore},model:{value:t.listLoading,callback:function(e){t.listLoading=e},expression:"listLoading"}},t._l(t.orderList,function(e){return i("orderBlock",{directives:[{name:"show",rawName:"v-show",value:t.computedShowOrder(e.billState,e.weightState),expression:"computedShowOrder(item.billState, item.weightState)"}],key:e.id,attrs:{data:e,showCheckBox:t.orderEditFlag},on:{"on-click":function(i){return t.onClickOrder(e)}}})}),1)],1),i("emptyBill",{directives:[{name:"show",rawName:"v-show",value:0===t.orderList.length,expression:"orderList.length === 0"}]})],1),i("div",{staticClass:"directOrder-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.orderEditFlag&&t.$fxAuth("shopStraightInBill.check"),expression:"orderEditFlag && $fxAuth('shopStraightInBill.check')"}],staticClass:"add-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onExpressClick}},[t._v("批量审核")])],1),i("van-actionsheet",{attrs:{actions:t.stateActions,"cancel-text":"取消"},on:{select:t.onStateSelect},model:{value:t.stateActionShow,callback:function(e){t.stateActionShow=e},expression:"stateActionShow"}}),i("van-actionsheet",{attrs:{actions:t.differenceActions,"cancel-text":"取消"},on:{select:t.onDifferenceSelect},model:{value:t.differenceShow,callback:function(e){t.differenceShow=e},expression:"differenceShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.filterPopShow,callback:function(e){t.filterPopShow=e},expression:"filterPopShow"}},[i("filterPop",{attrs:{visibleFlag:t.filterPopShow,filterParams:t.filterParams},on:{"update:visibleFlag":function(e){t.filterPopShow=e},"update:visible-flag":function(e){t.filterPopShow=e},"update:filterParams":function(e){t.filterParams=e},"update:filter-params":function(e){t.filterParams=e},"on-confirm":t.onFilterConfirm}})],1)],1)},a=[],s=(i("ac6a"),i("2fdb"),i("75fc")),o=i("5176"),r=i.n(o),l=i("795b"),c=i.n(l),u=(i("7514"),i("7f7f"),i("cebc")),h=(i("6762"),i("2f62")),d=i("b215"),f=i("46aa"),m=i("a0be"),p=i("4102"),v=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-block fx-shadow-block",on:{click:t.onClick}},[i("checkBox",{staticClass:"order-checkbox",attrs:{visibleFlag:t.showCheckBox,checked:t.data.checked},on:{"on-checkbox-click":t.onClick}}),i("div",{staticClass:"block-content"},[i("div",{staticClass:"block-title"},[i("i",{staticClass:"block-icon"}),i("span",{staticClass:"title-text fx-ellipsis"},[t._v(t._s(t.data.supplierDTO.name))]),i("stateTag",{staticClass:"state-tag",attrs:{billState:t.data.billState}}),i("span",{directives:[{name:"show",rawName:"v-show",value:t.data.difference,expression:"data.difference"}],staticClass:"difference-span"},[t._v("有差异")])],1),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No fx-ellipsis"},[t._v(t._s(t.data.shopDTO.name))]),i("div",{staticClass:"order-date"},[i("span",[t._v("业务日期：")]),i("span",[t._v(t._s(t._f("filterDateYMD")(t.data.businessDate)))]),i("van-icon",{staticClass:"order-date-arrow",attrs:{name:"arrow"}})],1)]),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No fx-price-font"},[i("span",[t._v("含税金额：")]),i("span",[t._v("￥"+t._s(t.data.taxMoney))])]),i("div",{staticClass:"order-date"},[i("span",[t._v("到货日期：")]),i("span",[t._v(t._s(t._f("filterDateYMD")(t.data.arriveDate)))]),i("van-icon",{staticClass:"order-date-arrow",attrs:{name:"arrow"}})],1)])])],1)},S=[],g=i("0f38"),b=i("0b26"),w={name:"orderBlock",components:{stateTag:b["a"],checkBox:g["a"]},props:{data:{type:Object,default:function(){return{}}},showCheckBox:{type:Boolean,default:!1}},methods:{onClick:function(){this.showCheckBox?this.$set(this.data,"checked",!this.data.checked):this.$emit("on-click",this.data)}}},x=w,D=(i("445f"),i("2877")),I=Object(D["a"])(x,v,S,!1,null,"439f03ef",null),C=I.exports,k=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"filter-popup"},[i("w-header",{attrs:{title:"筛选条件",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{ref:"filterContent",staticClass:"filter-content"},[i("van-cell-group",[i("van-cell",{attrs:{title:"业务日期"}}),i("van-cell",{attrs:{title:"起始时间",value:t.beginDate,"is-link":""},on:{click:t.onBeginDateClick}}),i("van-cell",{attrs:{title:"结束时间",value:t.endDate,"is-link":""},on:{click:t.endDateClick}}),i("van-cell",{attrs:{title:"供货商",value:t.supplier,"value-class":"info-item-value","is-link":""},on:{click:t.onSupplierClick}}),i("van-cell",{attrs:{title:"配送中心",value:t.rdc,"value-class":"info-item-value","is-link":""},on:{click:t.onRdcClick}}),i("van-cell",{attrs:{title:"门店",value:t.shop,"value-class":"info-item-value","is-link":""},on:{click:t.onShopClick}}),i("van-cell",{attrs:{title:"仓库",value:t.store,"value-class":"info-item-value","is-link":""},on:{click:t.onStoreClick}}),i("van-cell",{attrs:{title:"品项",value:t.item,"value-class":"info-item-value","is-link":""},on:{click:t.onItemClick}}),i("van-cell",{attrs:{title:"单据类型",value:t.billType,"value-class":"info-item-value"},on:{click:t.onBillTypeClick}},[i("van-icon",{staticClass:"item-clear-btn",attrs:{slot:"right-icon",name:t.billTypeId?"close":"arrow"},on:{click:function(e){e.stopPropagation(),t.billTypeId?t.onBillTypeClearClick():t.onBillTypeClick()}},slot:"right-icon"})],1),i("van-field",{ref:"billNo",attrs:{label:"系统单号","value-class":"info-item-value",placeholder:"请输入系统单号","input-align":"right"},on:{focus:function(e){return t.onFocus("billNo")}},model:{value:t.billNo,callback:function(e){t.billNo=e},expression:"billNo"}})],1)],1),i("div",{staticClass:"filter-bottom"},[i("van-button",{staticClass:"reset-btn fx-no-radius",attrs:{type:"info"},on:{click:t.onResetClick}},[t._v("重置")]),i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onConfirmClick}},[t._v("确定")])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.supplierPopShow,callback:function(e){t.supplierPopShow=e},expression:"supplierPopShow"}},[i("listComp",{attrs:{visibleFlag:t.supplierPopShow,data:t.supplierList,loadFinished:!0,title:"供货商检索"},on:{"update:visibleFlag":function(e){t.supplierPopShow=e},"update:visible-flag":function(e){t.supplierPopShow=e},"on-search":t.searchSupplier,"on-select":t.selectSupplier}})],1),i("filterListPopup",{attrs:{title:"配送中心检索",rollingLoad:!0,getDataApi:t.getRdcListData},on:{"on-select":function(e){return t.selectRdc(arguments)}},model:{value:t.rdcPopShow,callback:function(e){t.rdcPopShow=e},expression:"rdcPopShow"}}),i("filterListPopup",{attrs:{title:"机构检索",rollingLoad:!0,getDataApi:t.getShopListData},on:{"on-select":function(e){return t.selectShop(arguments)}},model:{value:t.shopPopShow,callback:function(e){t.shopPopShow=e},expression:"shopPopShow"}}),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.storePopShow,callback:function(e){t.storePopShow=e},expression:"storePopShow"}},[i("listComp",{attrs:{visibleFlag:t.storePopShow,data:t.storeList,loadFinished:!0,title:"仓库检索"},on:{"update:visibleFlag":function(e){t.storePopShow=e},"update:visible-flag":function(e){t.storePopShow=e},"on-search":t.searchStore,"on-select":t.selectStore}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.itemPopShow,callback:function(e){t.itemPopShow=e},expression:"itemPopShow"}},[i("listComp",{attrs:{visibleFlag:t.itemPopShow,data:t.itemList,loadFinished:t.itemListLoadFinished,loading:t.onItemLoading,title:"品项检索"},on:{"update:visibleFlag":function(e){t.itemPopShow=e},"update:visible-flag":function(e){t.itemPopShow=e},"update:loading":function(e){t.onItemLoading=e},"on-search":t.searchItem,"on-select":t.selectItem,"on-load":t.onItemLoad}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.billTypePopShow,callback:function(e){t.billTypePopShow=e},expression:"billTypePopShow"}},[i("listComp",{attrs:{visibleFlag:t.billTypePopShow,data:t.billTypeList,loadFinished:!0,title:"单据类型检索"},on:{"update:visibleFlag":function(e){t.billTypePopShow=e},"update:visible-flag":function(e){t.billTypePopShow=e},"on-search":t.searchBillType,"on-select":t.selectBillType}})],1)],1)},y=[],P=i("768b"),$=i("f6bb"),F=i("eb03"),A=50,T={name:"filterPop",components:{listComp:$["a"],filterListPopup:F["a"]},props:{visibleFlag:Boolean,filterParams:{type:Object,default:function(){return{}}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},dateType:"",currentDate:new Date,beginDate:this.$fxCommon.orderFilterStartDate(),endDate:this.$fxCommon.orderFilterEndDate(),supplier:"请选择",supplierId:"",rdc:"请选择",rdcId:"",shop:"请选择",shopId:"",store:"请选择",storeId:"",item:"请选择",itemId:"",billType:"请选择",billTypeId:"",billNo:"",datePickerShow:!1,supplierPopShow:!1,rdcPopShow:!1,shopPopShow:!1,storePopShow:!1,itemPopShow:!1,billTypePopShow:!1,supplierList:[],storeList:[],itemList:[],billTypeList:[],itemListStart:0,onItemLoading:!1,itemListLoadFinished:!1}},watch:{visibleFlag:{handler:function(t){t&&this.$fxUtils.isEmptyObjSHW(this.filterParams)&&this.resetHandler()},immediate:!0}},computed:Object(u["a"])({},Object(h["c"])({loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}})),methods:{getFilterParams:function(){return{beginDate:this.beginDate||this.$fxCommon.orderFilterStartDate(),endDate:this.endDate||this.$fxCommon.orderFilterEndDate(),supplierId:this.supplierId,rdcId:this.rdcId,shopId:this.shopId,storeId:this.storeId,itemId:this.itemId,billTypeId:this.billTypeId,billNo:this.billNo}},onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onConfirmClick:function(){this.$emit("update:visibleFlag",!1),this.$emit("update:filterParams",this.getFilterParams()),this.$emit("on-confirm",this.getFilterParams())},onResetClick:function(){this.resetHandler()},resetHandler:function(){this.beginDate=this.$fxCommon.orderFilterStartDate(),this.endDate=this.$fxCommon.orderFilterEndDate(),this.supplier="请选择",this.supplierId="",this.rdc="请选择",this.rdcId="",this.shop="请选择",this.shopId="",this.store="请选择",this.storeId="",this.billType="请选择",this.billTypeId="",this.item="请选择",this.itemId="",this.billNo=""},onBeginDateClick:function(){this.dateType="begin",this.beginDate&&(this.currentDate=new Date(this.beginDate)),this.datePickerShow=!0},endDateClick:function(){this.dateType="end",this.endDate&&(this.currentDate=new Date(this.endDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){"begin"===this.dateType?(this.beginDate=this.$fxUtils.setDateTime(t,"时分"),this.endDate&&this.$fxCommon.orderFilterRangeDate(this.beginDate,this.endDate)||(this.endDate=this.$fxCommon.orderFilterDate(t))):(this.endDate=this.$fxUtils.setDateTime(t,"时分"),this.beginDate&&this.$fxCommon.orderFilterRangeDate(this.beginDate,this.endDate)||(this.beginDate=this.$fxCommon.orderFilterStartDate(t))),this.datePickerShow=!1},onSupplierClick:function(){this.onSupplierRefresh()},searchSupplier:function(t){this.onSupplierRefresh(t)},selectSupplier:function(t){this.supplier=t.name,this.supplierId=t.id},onSupplierRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getSupplierListData(e).then(function(e){t.supplierList=e.suppliers,t.supplierPopShow=!0})},getSupplierListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new c.a(function(i){var n={keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/suppliers"),data:n}).then(function(t){i(t)})})},onRdcClick:function(){this.rdcPopShow=!0},selectRdc:function(t){var e=Object(P["a"])(t,1),i=e[0];this.rdc=i.name,this.rdcId=i.id},getRdcListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,n={keyword:t,start:e,size:i,orgFlag:1};return this.$fxApi("z5common.getUserManageShop")({data:n}).then(function(t){return t.shops})},onShopClick:function(){this.shopPopShow=!0},selectShop:function(t){var e=Object(P["a"])(t,1),i=e[0];this.shop=i.name,this.shopId=i.id},getShopListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,n={keyword:t,start:e,size:i,orgFlag:0};return this.$fxApi("z5common.getUserManageShop")({data:n}).then(function(t){return t.shops})},onStoreClick:function(){if(!this.shopId)return this.$fxToast.fail("请先选择门店!"),!1;this.onStoreRefresh()},searchStore:function(t){this.onStoreRefresh(t)},selectStore:function(t){this.store=t.name,this.storeId=t.id},onStoreRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getStoreListData(e).then(function(e){t.storeList=e.shops,t.storePopShow=!0})},getStoreListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new c.a(function(i){var n={keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/houses"),data:n}).then(function(t){i(t)})})},onItemClick:function(){this.onItemRefresh()},searchItem:function(t){this.onItemRefresh(t)},selectItem:function(t){this.item=t.name,this.itemId=t.id},onItemRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.itemListStart=0,this.getItemListData(e).then(function(e){t.itemPopShow=!0,t.onItemLoading=!1,t.itemListStart+=A,e.goods.length<A&&(t.itemListLoadFinished=!0),t.itemList=e.goods})},onItemLoad:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getItemListData(e).then(function(e){var i;t.onItemLoading=!1,t.itemListStart+=A,e.goods.length<A&&(t.itemListLoadFinished=!0),(i=t.itemList).push.apply(i,Object(s["a"])(e.goods))})},getItemListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new c.a(function(i){var n={start:t.itemListStart,size:A,paged:!0,keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/goods"),data:n}).then(function(t){i(t)})})},onBillTypeClick:function(){this.onBillTypeRefresh()},searchBillType:function(t){this.onBillTypeRefresh(t)},selectBillType:function(t){this.billType=t.name,this.billTypeId=t.id},onBillTypeRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getBillTypeListData(e).then(function(e){t.billTypeList=e.businessTypes,t.billTypePopShow=!0})},getBillTypeListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new c.a(function(i){var n={m:"list4ShopStraightInBill",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/businessTypes"),data:n}).then(function(t){i(t)})})},onFocus:function(t){this.onScrollTop(t)},onScrollTop:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,i=this.$refs[t];if(!i||0===i.length)return!1;var n=i.$el.offsetTop,a=this.$refs["filterContent"];this.$fxUtils.scrollTopW({offsetTop:n,$el:a,distance:e})},onBillTypeClearClick:function(){this.billType="请选择",this.billTypeId=""}}},B=T,E=(i("f53d"),Object(D["a"])(B,k,y,!1,null,"1549886a",null)),O=E.exports,L=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"shopOrder-filter fx-shadow-down"},[i("div",{staticClass:"filter-item",on:{click:t.onStateClick}},[i("span",[t._v("审核状态")]),i("van-icon",{staticClass:"filter-arrow",attrs:{name:"arrow-down"}}),i("span",[t._v(t._s(t.state))])],1),i("div",{staticClass:"filter-item",on:{click:t.onDifferenceClick}},[i("span",[t._v("差异状态")]),i("van-icon",{staticClass:"filter-arrow",attrs:{name:"arrow-down"}}),i("span",[t._v(t._s(t.difference))])],1)])},W=[],U={name:"filterTab",props:{state:String,difference:String},methods:{onStateClick:function(){this.$emit("on-state-click")},onDifferenceClick:function(){this.$emit("on-difference-click")}}},_=U,N=(i("1f9b"),Object(D["a"])(_,L,W,!1,null,"13ffef4a",null)),R=N.exports,H=50,M={name:"directOrder",components:{headSearchBtn:d["a"],headEditBtn:f["a"],headSelectAllBtn:m["a"],emptyBill:p["a"],orderBlock:C,filterPop:O,filterTab:R},data:function(){return{orderList:[],filterPopShow:!1,filterState:null,stateActionShow:!1,stateActions:[{id:null,name:"全部"},{id:"0",name:"未审核"},{id:"1",name:"已审核"}],filterDifference:null,differenceShow:!1,differenceActions:[{id:null,name:"全部"},{id:"1",name:"有差异"},{id:"0",name:"无差异"}],listStart:0,pullRefreshLoading:!1,listLoading:!1,loadFinished:!0,listError:!1,orderEditFlag:!1,filterParams:{}}},beforeRouteEnter:function(t,e,i){var n=["/main/home","/"],a=["/directOrderDetails"];n.includes(e.path)?i(function(e){e.restFilterParams(),e.restRouterParams(t.params),e.refreshOrderList()}):a.includes(e.path)?i(function(t){t.refreshOrderList()}):i()},computed:Object(u["a"])({},Object(h["c"])({billListPostParams:"billListPostParams",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{computedState:function(){var t=this;return this.stateActions.find(function(e){return e.id===t.filterState}).name},computedDifference:function(){var t=this;return this.differenceActions.find(function(e){return e.id===t.filterDifference}).name},computedShowOrder:function(t,e){var i=this;return function(t,e){return!i.orderEditFlag||1!==t&&i.downSendState(e)}},isSelectAll:function(){var t=this,e=this.orderList.filter(function(e){return 1!==e.billState&&t.downSendState(e.weightState)});if(0===e.length)return!1;var i=e.filter(function(t){return!!t.checked});return i.length===e.length}}),methods:{orderListPostHandler:function(t){var e=this;return new c.a(function(i){e.$store.commit({type:"SETSTATE",billListPostParams:t}),e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/shopstraightinbills/users/").concat(e.loginerId),data:t}).then(function(t){i(t)})})},refreshOrderList:function(){var t=this;return new c.a(function(e){t.listStart=0;var i={start:t.listStart,size:H,paged:!0,businessDateStart:t.$fxCommon.orderFilterStartDate(),businessDateEnd:t.$fxCommon.orderFilterEndDate(),billState:t.filterState,differenceFlag:t.filterDifference};i=r()(i,t.translateFilterParams(t.filterParams)),t.orderListPostHandler(i).then(function(i){t.orderList=i.storeBills,e(i)})})},onFilterConfirm:function(t){var e=this;this.listStart=0;var i={start:this.listStart,size:H,paged:!0,businessDateStart:t.beginDate,businessDateEnd:t.endDate,billState:this.filterState,differenceFlag:this.filterDifference,shopId:""===t.shopId?null:t.shopId,houseId:""===t.storeId?null:t.storeId,goodsId:""===t.itemId?null:t.itemId,businessType:""===t.billTypeId?null:t.billTypeId,supplierId:""===t.supplierId?null:t.supplierId,rdcId:""===t.rdcId?null:t.rdcId,sysBillCode:""===t.billNo?null:t.billNo};this.orderListPostHandler(i).then(function(t){e.orderList=t.storeBills})},translateFilterParams:function(t){return this.$fxUtils.isEmptyObjSHW(t)?{}:{businessDateStart:t.beginDate,businessDateEnd:t.endDate,shopId:""===t.shopId?null:t.shopId,houseId:""===t.storeId?null:t.storeId,goodsId:""===t.itemId?null:t.itemId,businessType:""===t.billTypeId?null:t.billTypeId,rdcId:""===t.rdcId?null:t.rdcId,sysBillCode:""===t.billNo?null:t.billNo}},onPullRefresh:function(){var t=this;this.refreshOrderList().then(function(e){t.pullRefreshLoading=!1})},onLoadMore:function(){var t=this,e=r()(this.billListPostParams,{start:this.listStart});this.orderListPostHandler(e).then(function(e){var i;(i=t.orderList).push.apply(i,Object(s["a"])(e.storeBills))})},onSearchClick:function(){this.filterPopShow=!0},onStateClick:function(){this.stateActionShow=!0},onStateSelect:function(t){this.filterState=t.id,this.stateActionShow=!1,this.refreshOrderList()},onDifferenceClick:function(){this.differenceShow=!0},onDifferenceSelect:function(t){this.filterDifference=t.id,this.differenceShow=!1,this.refreshOrderList()},onClickOrder:function(t){this.$router.push({path:"directOrderDetails",query:{orderId:t.id}})},getShopListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new c.a(function(i){var n={m:"list4ShopOrderBill",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/shops"),data:n}).then(function(t){i(t)})})},onOrderEditClick:function(){this.orderEditFlag=!this.orderEditFlag},onExpressClick:function(){var t=this,e=this.orderList.reduce(function(t,e){var i=e.checked?t.concat(e.id):t;return i},[]);if(0===e.length)return!1;this.$dialog.confirm({title:"提示",message:"确定要审核所选单据?"}).then(function(){t.expressHandler(e).then(function(e){t.orderEditFlag=!t.orderEditFlag,t.refreshOrderList().then(function(){t.$fxToast.success(e.message)})})})},expressHandler:function(t){var e=this;return new c.a(function(i){e.$fxHttp.requestPut({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/shopstraightinbills/users/").concat(e.loginerId),data:t,query:{m:"batchCheck"}}).then(function(t){i(t)})})},downSendState:function(t){return[0,3].includes(t)},onSelectAllClick:function(){var t=this,e=!this.isSelectAll;this.orderList.forEach(function(i){1!==i.billState&&t.downSendState(i.weightState)&&t.$set(i,"checked",e)})},restFilterParams:function(){this.filterParams={},this.filterState=null,this.filterDifference=null,this.orderEditFlag=!1},restRouterParams:function(t){this.$fxUtils.isEmptyObjSHW(t)||(this.filterState=t.billState)}}},z=M,q=(i("9aaf"),Object(D["a"])(z,n,a,!1,null,"58907ea6",null));e["default"]=q.exports}}]);
//# sourceMappingURL=directOrder.bead4135.js.map