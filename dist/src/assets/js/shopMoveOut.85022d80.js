(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["shopMoveOut"],{"01bc":function(t,e,i){"use strict";var n=i("d5de"),a=i.n(n);a.a},"027d":function(t,e,i){"use strict";var n=i("77da"),a=i.n(n);a.a},"0643":function(t,e,i){},"08d9":function(t,e,i){},"0b26":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("van-tag",{staticClass:"state-class",attrs:{type:t.tagType,size:"large",plain:""}},[t._v(t._s(t.billStateText))])},a=[],o=(i("c5f6"),{name:"stateTag",props:{billState:Number,reCheckState:Number},computed:{billStateText:function(){var t="";switch(this.billState){case 0:t="未审核";break;case 1:t=1===this.reCheckState?"已复审":"已审核";break}return t},tagType:function(){var t="";switch(this.billState){case 0:t="danger";break;case 1:t="success";break}return t}}}),s=o,r=(i("eb87"),i("2877")),l=Object(r["a"])(s,n,a,!1,null,"935c03cc",null);e["a"]=l.exports},"0bb4":function(t,e,i){"use strict";var n=i("f52f"),a=i.n(n);a.a},"0f38":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("van-checkbox",{directives:[{name:"show",rawName:"v-show",value:t.visibleFlag,expression:"visibleFlag"}],staticClass:"order-checkbox",on:{click:t.onCheckboxClick},scopedSlots:t._u([{key:"icon",fn:function(e){return i("img",{staticClass:"checked-box-icon",attrs:{src:e.checked?t.checkedIcon.active:t.checkedIcon.normal}})}}]),model:{value:t.$attrs.checked,callback:function(e){t.$set(t.$attrs,"checked",e)},expression:"$attrs.checked"}})},a=[],o={name:"checkBox",props:{visibleFlag:{type:Boolean,default:!1}},data:function(){return{checkedIcon:{normal:i("41c0"),active:i("f3c0")}}},methods:{onCheckboxClick:function(){this.$emit("on-checkbox-click")}}},s=o,r=(i("dab9"),i("2877")),l=Object(r["a"])(s,n,a,!1,null,"4e0c8b3e",null);e["a"]=l.exports},"258b":function(t,e,i){},2964:function(t,e,i){},"3df1":function(t,e,i){"use strict";var n=i("0643"),a=i.n(n);a.a},4037:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-shopMoveOut"},[i("w-header",{attrs:{title:"调拨出库单",border:!0}},[i("headEditBtn",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopMoveOutBill.check"),expression:"$fxAuth('shopMoveOutBill.check')"}],attrs:{slot:"header-right",active:t.orderEditFlag},on:{click:t.onOrderEditClick},slot:"header-right"}),i("headSearchBtn",{directives:[{name:"show",rawName:"v-show",value:!t.orderEditFlag,expression:"!orderEditFlag"}],attrs:{slot:"header-right"},on:{click:t.onSearchClick},slot:"header-right"}),i("headSelectAllBtn",{directives:[{name:"show",rawName:"v-show",value:t.orderEditFlag,expression:"orderEditFlag"}],attrs:{slot:"header-right",active:t.isSelectAll},on:{click:t.onSelectAllClick},slot:"header-right"})],1),i("filterTab",{attrs:{state:t.computedState},on:{"on-state-click":t.onStateClick}}),i("div",{staticClass:"shopMoveOut-content"},[i("van-pull-refresh",{directives:[{name:"show",rawName:"v-show",value:0!==t.orderList.length,expression:"orderList.length !== 0"}],staticClass:"shopMoveOut-list",on:{refresh:t.onPullRefresh},model:{value:t.pullRefreshLoading,callback:function(e){t.pullRefreshLoading=e},expression:"pullRefreshLoading"}},[i("van-list",{attrs:{finished:t.loadFinished,"finished-text":"没有更多了",error:t.listError,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.listError=e},load:t.onLoadMore},model:{value:t.listLoading,callback:function(e){t.listLoading=e},expression:"listLoading"}},t._l(t.orderList,function(e){return i("orderBlock",{directives:[{name:"show",rawName:"v-show",value:t.computedShowOrder(e.billState),expression:"computedShowOrder(item.billState)"}],key:e.id,attrs:{data:e,showCheckBox:t.orderEditFlag},on:{"on-click":function(i){return t.onClickOrder(e)}}})}),1)],1),i("emptyBill",{directives:[{name:"show",rawName:"v-show",value:0===t.orderList.length,expression:"orderList.length === 0"}]})],1),i("div",{staticClass:"shopMoveOut-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.orderEditFlag&&t.$fxAuth("shopMoveOutBill.check"),expression:"orderEditFlag && $fxAuth('shopMoveOutBill.check')"}],staticClass:"add-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onExpressClick}},[t._v("批量审核")])],1),i("van-actionsheet",{attrs:{actions:t.stateActions,"cancel-text":"取消"},on:{select:t.onStateSelect},model:{value:t.stateActionShow,callback:function(e){t.stateActionShow=e},expression:"stateActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.filterPopShow,callback:function(e){t.filterPopShow=e},expression:"filterPopShow"}},[i("filterPop",{attrs:{visibleFlag:t.filterPopShow,filterParams:t.filterParams},on:{"update:visibleFlag":function(e){t.filterPopShow=e},"update:visible-flag":function(e){t.filterPopShow=e},"update:filterParams":function(e){t.filterParams=e},"update:filter-params":function(e){t.filterParams=e},"on-confirm":t.onFilterConfirm}})],1)],1)},a=[],o=(i("ac6a"),i("75fc")),s=i("5176"),r=i.n(s),l=i("795b"),c=i.n(l),u=(i("7514"),i("7f7f"),i("cebc")),h=(i("6762"),i("2f62")),d=i("b215"),m=i("46aa"),f=i("a0be"),p=i("4102"),v=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-block fx-shadow-block",on:{click:t.onClick}},[i("checkBox",{staticClass:"order-checkbox",attrs:{visibleFlag:t.showCheckBox,checked:t.data.checked},on:{"on-checkbox-click":t.onClick}}),i("div",{staticClass:"block-content"},[i("div",{staticClass:"block-title"},[i("i",{staticClass:"block-icon"}),i("span",{staticClass:"title-text fx-ellipsis"},[t._v(t._s(t.data.outShopDTO.name))]),i("stateTag",{staticClass:"state-tag",attrs:{billState:t.data.billState}})],1),i("div",{staticClass:"block-title"},[i("i",{staticClass:"block-icon"}),i("span",{staticClass:"title-text fx-ellipsis"},[t._v(t._s(t.data.inShopDTO.name))])]),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No fx-ellipsis"},[t._v(t._s(t.data.sysbillCode))]),i("div",{staticClass:"order-date"},[i("span",[t._v("业务日期：")]),i("span",[t._v(t._s(t._f("filterDateYMD")(t.data.businessDate)))]),i("van-icon",{staticClass:"order-date-arrow",attrs:{name:"arrow"}})],1)])])],1)},S=[],b=i("0f38"),g=i("0b26"),x={name:"orderBlock",components:{stateTag:g["a"],checkBox:b["a"]},props:{data:{type:Object,default:function(){return{}}},showCheckBox:{type:Boolean,default:!1}},methods:{onClick:function(){this.showCheckBox?this.$set(this.data,"checked",!this.data.checked):this.$emit("on-click",this.data)}}},D=x,I=(i("9b50"),i("2877")),w=Object(I["a"])(D,v,S,!1,null,"eef5f7f0",null),C=w.exports,k=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"filter-popup"},[i("w-header",{attrs:{title:"筛选条件",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{ref:"filterContent",staticClass:"filter-content"},[i("van-cell-group",[i("van-cell",{attrs:{title:"业务日期"}}),i("van-cell",{attrs:{title:"起始时间",value:t.beginDate,"is-link":""},on:{click:t.onBeginDateClick}}),i("van-cell",{attrs:{title:"结束时间",value:t.endDate,"is-link":""},on:{click:t.endDateClick}}),i("van-cell",{attrs:{title:"调出机构",value:t.outShop,"value-class":"info-item-value","is-link":""},on:{click:t.onOutShopClick}}),i("van-cell",{attrs:{title:"调出仓库",value:t.outStore,"value-class":"info-item-value","is-link":""},on:{click:t.onOutStoreClick}}),i("van-cell",{attrs:{title:"调入机构",value:t.inShop,"value-class":"info-item-value","is-link":""},on:{click:t.onInShopClick}}),i("van-cell",{attrs:{title:"调入仓库",value:t.inStore,"value-class":"info-item-value","is-link":""},on:{click:t.onInStoreClick}}),i("van-cell",{attrs:{title:"品项",value:t.item,"value-class":"info-item-value","is-link":""},on:{click:t.onItemClick}}),i("van-field",{ref:"billNo",attrs:{label:"系统单号","value-class":"info-item-value",placeholder:"请输入系统单号","input-align":"right"},model:{value:t.billNo,callback:function(e){t.billNo=e},expression:"billNo"}})],1)],1),i("div",{staticClass:"filter-bottom"},[i("van-button",{staticClass:"reset-btn fx-no-radius",attrs:{type:"info"},on:{click:t.onResetClick}},[t._v("重置")]),i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onConfirmClick}},[t._v("确定")])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("filterListPopup",{attrs:{title:"调出机构检索",rollingLoad:!0,getDataApi:t.getShopListData},on:{"on-select":function(e){return t.selectOutShop(arguments)}},model:{value:t.outShopPopShow,callback:function(e){t.outShopPopShow=e},expression:"outShopPopShow"}}),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.outStorePopShow,callback:function(e){t.outStorePopShow=e},expression:"outStorePopShow"}},[i("listComp",{attrs:{visibleFlag:t.outStorePopShow,data:t.outStoreList,loadFinished:!0,title:"调出仓库检索"},on:{"update:visibleFlag":function(e){t.outStorePopShow=e},"update:visible-flag":function(e){t.outStorePopShow=e},"on-search":t.searchOutStore,"on-select":t.selectOutStore}})],1),i("filterListPopup",{attrs:{title:"调入机构检索",rollingLoad:!0,getDataApi:t.getShopListData},on:{"on-select":function(e){return t.selectInShop(arguments)}},model:{value:t.inShopPopShow,callback:function(e){t.inShopPopShow=e},expression:"inShopPopShow"}}),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.inStorePopShow,callback:function(e){t.inStorePopShow=e},expression:"inStorePopShow"}},[i("listComp",{attrs:{visibleFlag:t.inStorePopShow,data:t.inStoreList,loadFinished:!0,title:"调入仓库检索"},on:{"update:visibleFlag":function(e){t.inStorePopShow=e},"update:visible-flag":function(e){t.inStorePopShow=e},"on-search":t.searchInStore,"on-select":t.selectInStore}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.itemPopShow,callback:function(e){t.itemPopShow=e},expression:"itemPopShow"}},[i("listComp",{attrs:{visibleFlag:t.itemPopShow,data:t.itemList,loadFinished:t.itemListLoadFinished,loading:t.onItemLoading,title:"品项检索"},on:{"update:visibleFlag":function(e){t.itemPopShow=e},"update:visible-flag":function(e){t.itemPopShow=e},"update:loading":function(e){t.onItemLoading=e},"on-search":t.searchItem,"on-select":t.selectItem,"on-load":t.onItemLoad}})],1)],1)},y=[],A=i("768b"),O=i("f6bb"),F=i("eb03"),P=50,T={name:"filterPop",components:{listComp:O["a"],filterListPopup:F["a"]},props:{visibleFlag:Boolean,filterParams:{type:Object,default:function(){return{}}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},dateType:"",currentDate:new Date,beginDate:this.$fxCommon.orderFilterStartDate(),endDate:this.$fxCommon.orderFilterEndDate(),outShop:"请选择",outShopId:"",outStore:"请选择",outStoreId:"",inShop:"请选择",inShopId:"",inStore:"请选择",inStoreId:"",item:"请选择",itemId:"",billNo:"",datePickerShow:!1,outShopPopShow:!1,outStorePopShow:!1,inShopPopShow:!1,inStorePopShow:!1,itemPopShow:!1,outStoreList:[],inStoreList:[],itemList:[],itemListStart:0,onItemLoading:!1,itemListLoadFinished:!1}},watch:{visibleFlag:{handler:function(t){t&&this.$fxUtils.isEmptyObjSHW(this.filterParams)&&this.resetHandler()},immediate:!0}},computed:Object(u["a"])({},Object(h["c"])({loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}})),methods:{getFilterParams:function(){return{beginDate:this.beginDate||this.$fxCommon.orderFilterStartDate(),endDate:this.endDate||this.$fxCommon.orderFilterEndDate(),outShopId:this.outShopId,outStoreId:this.outStoreId,inShopId:this.inShopId,inStoreId:this.inStoreId,itemId:this.itemId,billNo:this.billNo}},onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onConfirmClick:function(){this.$emit("update:visibleFlag",!1),this.$emit("update:filterParams",this.getFilterParams()),this.$emit("on-confirm",this.getFilterParams())},onResetClick:function(){this.resetHandler()},resetHandler:function(){this.beginDate=this.$fxCommon.orderFilterStartDate(),this.endDate=this.$fxCommon.orderFilterEndDate(),this.outShop="请选择",this.outShopId="",this.outStore="请选择",this.outStoreId="",this.inShop="请选择",this.inShopId="",this.inStore="请选择",this.inStoreId="",this.item="请选择",this.itemId="",this.billNo=""},onBeginDateClick:function(){this.dateType="begin",this.beginDate&&(this.currentDate=new Date(this.beginDate)),this.datePickerShow=!0},endDateClick:function(){this.dateType="end",this.endDate&&(this.currentDate=new Date(this.endDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){"begin"===this.dateType?(this.beginDate=this.$fxUtils.setDateTime(t,"时分"),this.endDate&&this.$fxCommon.orderFilterRangeDate(this.beginDate,this.endDate)||(this.endDate=this.$fxCommon.orderFilterDate(t))):(this.endDate=this.$fxUtils.setDateTime(t,"时分"),this.beginDate&&this.$fxCommon.orderFilterRangeDate(this.beginDate,this.endDate)||(this.beginDate=this.$fxCommon.orderFilterStartDate(t))),this.datePickerShow=!1},onOutShopClick:function(){this.outShopPopShow=!0},selectOutShop:function(t){var e=Object(A["a"])(t,1),i=e[0];this.outShop=i.name,this.outShopId=i.id},getShopListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,n={keyword:t,start:e,size:i};return this.$fxApi("z5common.getUserManageShop")({data:n}).then(function(t){return t.shops})},onInShopClick:function(){this.inShopPopShow=!0},selectInShop:function(t){var e=Object(A["a"])(t,1),i=e[0];this.inShop=i.name,this.inShopId=i.id},onOutStoreClick:function(){if(!this.outShopId)return this.$fxToast.fail("请先选择调出机构!"),!1;this.onOutStoreRefresh()},searchOutStore:function(t){this.onOutStoreRefresh(t)},selectOutStore:function(t){this.outStore=t.name,this.outStoreId=t.id},onOutStoreRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getOutStoreListData(e).then(function(e){t.outStoreList=e.shops,t.outStorePopShow=!0})},getOutStoreListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new c.a(function(i){var n={m:"getAllHouseList",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.outShopId,"/users/").concat(t.loginerId,"/houses"),data:n}).then(function(t){i(t)})})},onInStoreClick:function(){if(!this.inShopId)return this.$fxToast.fail("请先选择调入机构!"),!1;this.onInStoreRefresh()},searchInStore:function(t){this.onInStoreRefresh(t)},selectInStore:function(t){this.inStore=t.name,this.inStoreId=t.id},onInStoreRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getInStoreListData(e).then(function(e){t.inStoreList=e.shops,t.inStorePopShow=!0})},getInStoreListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new c.a(function(i){var n={m:"getAllHouseList",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.inShopId,"/users/").concat(t.loginerId,"/houses"),data:n}).then(function(t){i(t)})})},onItemClick:function(){this.onItemRefresh()},searchItem:function(t){this.onItemRefresh(t)},selectItem:function(t){this.item=t.name,this.itemId=t.id},onItemRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.itemListStart=0,this.getItemListData(e).then(function(e){t.itemPopShow=!0,t.onItemLoading=!1,t.itemListStart+=P,e.goods.length<P&&(t.itemListLoadFinished=!0),t.itemList=e.goods})},onItemLoad:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getItemListData(e).then(function(e){var i;t.onItemLoading=!1,t.itemListStart+=P,e.goods.length<P&&(t.itemListLoadFinished=!0),(i=t.itemList).push.apply(i,Object(o["a"])(e.goods))})},getItemListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new c.a(function(i){var n={start:t.itemListStart,size:P,paged:!0,keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/goods"),data:n}).then(function(t){i(t)})})},onFocus:function(t){this.onScrollTop(t)},onScrollTop:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,i=this.$refs[t];if(!i||0===i.length)return!1;var n=i.$el.offsetTop,a=this.$refs["filterContent"];this.$fxUtils.scrollTopW({offsetTop:n,$el:a,distance:e})}}},B=T,L=(i("0bb4"),Object(I["a"])(B,k,y,!1,null,"0ae95bae",null)),N=L.exports,M=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"shopMoveOut-filter fx-shadow-down"},[i("div",{staticClass:"filter-item",on:{click:t.onStateClick}},[i("span",[t._v("审核状态")]),i("van-icon",{staticClass:"filter-arrow",attrs:{name:"arrow-down"}}),i("span",[t._v(t._s(t.state))])],1)])},E=[],$={name:"filterTab",props:{state:String,urgency:String},methods:{onStateClick:function(){this.$emit("on-state-click")}}},z=$,R=(i("3df1"),Object(I["a"])(z,M,E,!1,null,"08bf3f2b",null)),W=R.exports,j=50,U={name:"shopMoveOut",components:{headSearchBtn:d["a"],headEditBtn:m["a"],headSelectAllBtn:f["a"],emptyBill:p["a"],orderBlock:C,filterPop:N,filterTab:W},data:function(){return{orderList:[],filterPopShow:!1,filterState:null,stateActionShow:!1,stateActions:[{id:null,name:"全部"},{id:"0",name:"未审核"},{id:"1",name:"已审核"}],listStart:0,pullRefreshLoading:!1,listLoading:!1,loadFinished:!0,listError:!1,orderEditFlag:!1,filterParams:{}}},beforeRouteLeave:function(t,e,i){if("/login"===t.path)i();else{if(this.filterPopShow)return this.filterPopShow=!1,this.$router.go(1),!1;i()}},beforeRouteEnter:function(t,e,i){var n=["/main/home","/"],a=["/shopMoveOutDetails"];n.includes(e.path)?i(function(e){e.restFilterParams(),e.restRouterParams(t.params),e.refreshOrderList()}):a.includes(e.path)?i(function(t){t.refreshOrderList()}):i()},computed:Object(u["a"])({},Object(h["c"])({billListPostParams:"billListPostParams",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{computedState:function(){var t=this;return this.stateActions.find(function(e){return e.id===t.filterState}).name},computedShowOrder:function(t){var e=this;return function(t){return!e.orderEditFlag||1!==t}},isSelectAll:function(){var t=this.orderList.filter(function(t){return 1!==t.billState});if(0===t.length)return!1;var e=t.filter(function(t){return!!t.checked});return e.length===t.length}}),methods:{orderListPostHandler:function(t){var e=this;return new c.a(function(i){e.$store.commit({type:"SETSTATE",billListPostParams:t}),e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/shopMoveOutBills/users/").concat(e.loginerId),data:t}).then(function(t){i(t)})})},refreshOrderList:function(){var t=this;return new c.a(function(e){t.listStart=0;var i={start:t.listStart,size:j,paged:!0,businessDateStart:t.$fxCommon.orderFilterStartDate(),businessDateEnd:t.$fxCommon.orderFilterEndDate(),billState:t.filterState};i=r()(i,t.translateFilterParams(t.filterParams)),t.orderListPostHandler(i).then(function(i){t.orderList=i.storeBills,e(i)})})},onFilterConfirm:function(t){var e=this;this.listStart=0;var i={start:this.listStart,size:j,paged:!0,businessDateStart:t.beginDate,businessDateEnd:t.endDate,billState:this.filterState,inShopId:""===t.shopId?null:t.inShopId,outShopId:""===t.shopId?null:t.outShopId,inHouseId:""===t.inStoreId?null:t.inStoreId,outHouseId:""===t.outStoreId?null:t.outStoreId,goodsId:""===t.itemId?null:t.itemId,sysBillCode:""===t.billNo?null:t.billNo};this.orderListPostHandler(i).then(function(t){e.orderList=t.storeBills})},translateFilterParams:function(t){return this.$fxUtils.isEmptyObjSHW(t)?{}:{businessDateStart:t.beginDate,businessDateEnd:t.endDate,inShopId:""===t.shopId?null:t.inShopId,outShopId:""===t.shopId?null:t.outShopId,inHouseId:""===t.inStoreId?null:t.inStoreId,outHouseId:""===t.outStoreId?null:t.outStoreId,goodsId:""===t.itemId?null:t.itemId,sysBillCode:""===t.billNo?null:t.billNo}},onPullRefresh:function(){var t=this;this.refreshOrderList().then(function(e){t.pullRefreshLoading=!1})},onLoadMore:function(){var t=this,e=r()(this.billListPostParams,{start:this.listStart});this.orderListPostHandler(e).then(function(e){var i;(i=t.orderList).push.apply(i,Object(o["a"])(e.storeBills))})},onSearchClick:function(){this.filterPopShow=!0},onStateClick:function(){this.stateActionShow=!0},onStateSelect:function(t){this.filterState=t.id,this.stateActionShow=!1,this.refreshOrderList()},onClickOrder:function(t){this.$router.push({path:"shopMoveOutDetails",query:{orderId:t.id}})},onOrderEditClick:function(){this.orderEditFlag=!this.orderEditFlag},onExpressClick:function(){var t=this,e=this.orderList.reduce(function(t,e){var i=e.checked?t.concat(e.id):t;return i},[]);if(0===e.length)return!1;this.$dialog.confirm({title:"提示",message:"确定要审核所选单据?"}).then(function(){t.expressBillList()})},expressBillList:function(){var t=this,e=this.orderList.reduce(function(t,e){var i=e.checked?t.concat(e.id):t;return i},[]);if(0===e.length)return!1;this.expressHandler(e).then(function(e){t.orderEditFlag=!t.orderEditFlag,t.refreshOrderList().then(function(){t.$fxToast.success(e.message)})}).catch(function(){t.refreshOrderList()})},expressHandler:function(t){var e=this;return new c.a(function(i,n){e.$fxHttp.requestPut({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/shopMoveOutBills/users/").concat(e.loginerId),data:t,query:{m:"batchCheck"}}).then(function(t){i(t)}).catch(function(t){n(t)})})},onSelectAllClick:function(){var t=this,e=!this.isSelectAll;this.orderList.forEach(function(i){1!==i.billState&&t.$set(i,"checked",e)})},restFilterParams:function(){this.filterParams={},this.filterState=null,this.orderEditFlag=!1},restRouterParams:function(t){this.$fxUtils.isEmptyObjSHW(t)||(this.filterState=t.billState)}}},H=U,Z=(i("027d"),Object(I["a"])(H,n,a,!1,null,"25f7cedb",null));e["default"]=Z.exports},4102:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"order-empty"},[n("img",{staticClass:"empty-icon",attrs:{src:i("6ee7")}}),n("div",{staticClass:"empty-text"},[t._v(t._s(t.message))])])},a=[],o={name:"emptyBill",props:{message:{type:String,default:"暂无可查看的订单"}}},s=o,r=(i("faf1"),i("2877")),l=Object(r["a"])(s,n,a,!1,null,"3c6ad708",null);e["a"]=l.exports},"41c0":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQyIDc5LjE2MDkyNCwgMjAxNy8wNy8xMy0wMTowNjozOSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjU5MzM3ODc2REY1QzExRTlBNjU4QkY2NDE0MTBEMjAzIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjU5MzM3ODc3REY1QzExRTlBNjU4QkY2NDE0MTBEMjAzIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NTkzMzc4NzRERjVDMTFFOUE2NThCRjY0MTQxMEQyMDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NTkzMzc4NzVERjVDMTFFOUE2NThCRjY0MTQxMEQyMDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6ky6P/AAACeElEQVR42sSXTW8SURSGLwNhAZLQBAhb09K6Vxd+xpWJNboxqRub9meoP0D7M5roRl36lW6tsQvtvkobd4QASUkYWPDp+07OkENtYabD1ZO8cyHMvM+9d+695xAbjUbmf0QiyE3lcjmG5hZ0H7oBLUEL8vMxdAh9gz5Au6VSaeZoYtNGDKCDZhN6JrAgwU68hLbRgWFoMKAX0byBrnpTk0iYTCZjUqmUSSaTJh6PGz7b7/c9dTod47qu6fV6vsV36DHgvwODAb2D5h2UIzCXy3nQINFqtUyj0fA6g2hAjwD/MhMM6F0076FkOp02xWLROI4TauEMh0NTrVZNu93m1y70EPCdM8GArsgUZbLZrMnn85FWbr1eN81mkx9d6ArgP/3fHAWNo3lFKKc1KpRBD3lFF+gtjEkwYoMLie+0UCjMbb/Si56ySDcnwLJPuWW8hRT2nU4LetFT4qmwxiO+zX3qb5l5Bz1l1EvCGoNX/RtshfJe1eDrvPBwsBXK+5oGl3jhiWQrlPeyBnsHPo9BW6G8F05up38ajkptZjAYWAMp72MNLnuHardrDay8f2nwHi9MbbZCee9p8Ec/pdkK5f1Jg5kvD5lDbcDpKfmZ1cnuGCw10paXuZHEmU/nFfSip8SWXw7p7bQN/WDParXa3MD0ktHuC2MyLaInXO/rTNqcGibxqEEPeXUsBJ4I4698TPgBmjWuflYOlUrlXNPOZ/isVB/cR2viPbPYu4fmLSuHiMWeK9DPYcrbS2heQ5fPKm/9E4mHwynl7b5M70GUgv45tBhwpo+gF+cu6E/pwE3ogeTuxRN/YY7kLwzL4q/TgKHANuKPAAMAun8rS4SUYuAAAAAASUVORK5CYII="},4760:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("span",{staticClass:"stateTag"},[t._v(t._s(t.billStateText))])},a=[],o=(i("c5f6"),{name:"stateText",props:{billState:Number},computed:{billStateText:function(){var t="";switch(this.billState){case 0:t="未审核";break;case 1:t="已审核";break}return t}}}),s=o,r=i("2877"),l=Object(r["a"])(s,n,a,!1,null,null,null);e["a"]=l.exports},"47b7":function(t,e,i){"use strict";var n=i("e047"),a=i.n(n);a.a},"4dc9":function(t,e,i){i("5737"),t.exports=i("584a").Number.isNaN},5737:function(t,e,i){var n=i("63b6");n(n.S,"Number",{isNaN:function(t){return t!=t}})},"71c8":function(t,e,i){},"77da":function(t,e,i){},"8d5d":function(t,e,i){"use strict";var n=i("08d9"),a=i.n(n);a.a},"8fa3":function(t,e,i){"use strict";var n=i("2964"),a=i.n(n);a.a},"977f":function(t,e,i){"use strict";var n=i("258b"),a=i.n(n);a.a},"9b50":function(t,e,i){"use strict";var n=i("71c8"),a=i.n(n);a.a},"9be87":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-shopMoveOut-details"},[i("w-header",{attrs:{title:t.orderInfoData.sysbillCode,titleFontSize:"3.733vw",border:!0}}),i("orderInfo",{ref:"orderInfo",attrs:{data:t.orderInfoData,isDisabled:t.isBillState(1)||!t.$fxAuth("shopMoveOutBill.save")||t.isWeightState(1)||t.isWeightState(2),collapseDisabled:t.itemInputFocusing},on:{"on-busdate-click":t.onBusinessDateClick,"on-item-clear":t.onItemClear}}),i("orderItem",{ref:"orderItem",attrs:{data:t.orderItemList,isDisabled:t.isBillState(1)||!t.$fxAuth("shopMoveOutBill.save")||t.isWeightState(1)||t.isWeightState(2),itemInputFocusing:t.itemInputFocusing},on:{"update:itemInputFocusing":function(e){t.itemInputFocusing=e},"update:item-input-focusing":function(e){t.itemInputFocusing=e},"on-search-click":t.onSearchClick,"on-item-edit":t.onItemEdit,"on-item-focus":t.onItemFocus}}),i("div",{staticClass:"shopMoveOut-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopMoveOutBill.delete")&&t.isBillState(0)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('shopMoveOutBill.delete') && isBillState(0) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onDeleteClick")}}},[t._v("\n\t\t\t删除\n\t\t")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillState(0)&&t.$fxAuth("shopMoveOutBill.check")&&(t.isWeightState(0)||t.isWeightState(3)),expression:"isBillState(0) && $fxAuth('shopMoveOutBill.check') && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onExpressClick")}}},[t._v("审核")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillState(1)&&t.$fxAuth("shopMoveOutBill.unCheck")&&(t.isWeightState(0)||t.isWeightState(3)),expression:"isBillState(1) && $fxAuth('shopMoveOutBill.unCheck') && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onUnExpressClick")}}},[t._v("反审")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillState(0)&&t.$fxAuth("shopMoveOutBill.save")&&(t.isWeightState(0)||t.isWeightState(3)),expression:"isBillState(0) && $fxAuth('shopMoveOutBill.save') && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:function(e){return t.onClickHandler("onSaveClick")}}},[t._v("保存")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopMoveOutBill.weighState")&&t.isBillState(0)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('shopMoveOutBill.weighState') && isBillState(0) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius yellow-btn",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onWeightClick")}}},[t._v("下发称重")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopMoveOutBill.weighState")&&t.isBillState(0)&&(t.isWeightState(1)||t.isWeightState(2)),expression:"$fxAuth('shopMoveOutBill.weighState') && isBillState(0) && (isWeightState(1) || isWeightState(2))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onUnWeightClick")}}},[t._v("取消称重")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopMoveOutBill.weighState")&&t.isBillState(0)&&t.isWeightState(2)&&t.sysDZCManyLower,expression:"$fxAuth('shopMoveOutBill.weighState') && isBillState(0) && isWeightState(2) && sysDZCManyLower"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onEndWeightClick")}}},[t._v("结束称重")])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,isDisabled:t.isBillState(1)||!t.$fxAuth("shopMoveOutBill.save")||t.isWeightState(1)||t.isWeightState(2)},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemSearchPopShow,callback:function(e){t.itemSearchPopShow=e},expression:"itemSearchPopShow"}},[i("itemSearchPop",{attrs:{visibleFlag:t.itemSearchPopShow,data:t.searchItem,house:t.orderInfoData.outHouseDTO,shopId:t.orderInfoData.outShopDTO&&t.orderInfoData.outShopDTO.id,isDisabled:t.isBillState(1)||!t.$fxAuth("shopMoveOutBill.save")||t.isWeightState(1)||t.isWeightState(2)},on:{"update:visibleFlag":function(e){t.itemSearchPopShow=e},"update:visible-flag":function(e){t.itemSearchPopShow=e},"on-search-confirm":t.onSearchConfirm}})],1)],1)},a=[],o=i("f499"),s=i.n(o),r=(i("20d6"),i("5176")),l=i.n(r),c=(i("ac6a"),i("59ad")),u=i.n(c),h=i("795b"),d=i.n(h),m=(i("6762"),i("2fdb"),i("6b54"),i("cebc")),f=i("2f62"),p=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-info-block fx-shadow-block"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},[i("van-collapse-item",{attrs:{name:"1",disabled:t.collapseDisabled}},[i("div",{staticClass:"info-title",attrs:{slot:"title"},slot:"title"},[i("span",{staticClass:"info-title-name"},[t._v("单据信息")]),i("stateText",{staticClass:"stateTag fl-r",attrs:{billState:t.data.billState}}),i("span",{directives:[{name:"show",rawName:"v-show",value:1===t.data.weightState,expression:"data.weightState === 1"}],staticClass:"info-title-weightState"},[t._v("待称重")])],1),i("van-tabs",{attrs:{animated:""},model:{value:t.tabActive,callback:function(e){t.tabActive=e},expression:"tabActive"}},[i("van-tab",{attrs:{title:"表头"}},[i("van-cell",{staticClass:"info-item",attrs:{title:"调出机构","value-class":"info-item-value",value:t.data.outShopDTO&&t.data.outShopDTO.name}}),i("van-cell",{staticClass:"info-item",attrs:{title:"调出仓库","value-class":"info-item-value",value:t.data.outHouseDTO&&t.data.outHouseDTO.name}}),i("van-cell",{staticClass:"info-item",attrs:{title:"调入机构","value-class":"info-item-value",value:t.data.inShopDTO&&t.data.inShopDTO.name}}),i("van-cell",{staticClass:"info-item",attrs:{title:"调入仓库","value-class":"info-item-value",value:t.data.inHouseDTO&&t.data.inHouseDTO.name}}),i("van-cell",{staticClass:"info-item",attrs:{title:"系统单号",value:t.data.sysbillCode}}),i("van-cell",{staticClass:"info-item",attrs:{title:"业务日期",value:t.formatterDate(t.data.businessDate),"is-link":!t.isDisabled},on:{click:t.onBusDateClick}}),i("van-pro-field",{staticClass:"info-item",attrs:{label:"整单备注",placeholder:t.isDisabled?"":"请输入整单备注","input-align":"right",maxlength:"50",disabled:t.isDisabled},model:{value:t.data.billMemo,callback:function(e){t.$set(t.data,"billMemo",e)},expression:"data.billMemo"}})],1),i("van-tab",{attrs:{title:"更多"}},[i("van-cell",{staticClass:"info-item",attrs:{title:"制单人",value:t.data.billEmp}}),i("van-cell",{staticClass:"info-item",attrs:{title:"制单日期",value:t.formatterDate(t.data.billDate)}}),i("van-cell",{staticClass:"info-item",attrs:{title:"审核人",value:t.data.checkEmp}}),i("van-cell",{staticClass:"info-item",attrs:{title:"审核日期",value:t.formatterDate(t.data.checkDate)}}),i("van-pro-field",{staticClass:"info-item",attrs:{label:"手工单号",placeholder:t.isDisabled?"":"请输入手工单号","input-align":"right",maxlength:"50",disabled:t.isDisabled},model:{value:t.data.manualCode,callback:function(e){t.$set(t.data,"manualCode",e)},expression:"data.manualCode"}}),i("van-pro-number-field",{staticClass:"info-item info-number",attrs:{label:"运费","input-align":"right",min:"0",max:t.maxAmount,intLength:t.numberLength,pointSize:t.sysPointSize,disabled:t.isDisabled},model:{value:t.data.freight,callback:function(e){t.$set(t.data,"freight",e)},expression:"data.freight"}}),i("van-pro-number-field",{staticClass:"info-item",attrs:{label:"件数","input-align":"right",min:"1",max:t.maxAmount,intLength:8,integer:!0,disabled:t.isDisabled},model:{value:t.data.pieceAmount,callback:function(e){t.$set(t.data,"pieceAmount",e)},expression:"data.pieceAmount"}})],1)],1)],1)],1)],1)},v=[],S=i("4760"),b={name:"orderInfo",components:{stateText:S["a"]},props:{data:{type:Object,default:function(){return{}}},isDisabled:Boolean,collapseDisabled:Boolean},data:function(){return{activeNames:["1"],tabActive:0}},computed:Object(m["a"])({},Object(f["c"])({sysPointSize:"sysPointSize",taxes:"taxes",numberLength:"numberLength",maxAmount:"maxAmount"}),{formatterDate:function(t){var e=this;return function(t){return"number"===typeof t?e.$fxUtils.setDateTime(new Date(t),"时分"):""}}}),methods:{onEmitClick:function(t){if(this.isDisabled)return!1;this.$emit(t)},onBusDateClick:function(){this.onEmitClick("on-busdate-click")},closeCollapse:function(){this.activeNames=[]}}},g=b,x=(i("df6c"),i("2877")),D=Object(x["a"])(g,p,v,!1,null,"7a427946",null),I=D.exports,w=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-item-block fx-shadow-block"},[i("div",{staticClass:"item-title"},[i("span",{staticClass:"title-name"},[t._v("单据明细")]),i("span",{staticClass:"title-count"},[t._v("明细：")]),i("span",[t._v(t._s(t.detailsLength))]),i("i",{staticClass:"title-search-icon fl-r",on:{click:t.onSearchClick}})]),i("div",{ref:"details-content",staticClass:"item-list"},t._l(t.data,function(e){return i("van-swipe-cell",{directives:[{name:"show",rawName:"v-show",value:"del"!==e.changeType,expression:"item.changeType !== 'del'"}],key:e.id+"-"+e.goodsDTO.id,ref:"details-row-"+e.id+"-"+e.goodsDTO.id,refInFor:!0,staticClass:"item-row",attrs:{disabled:t.isDisabled||t.focusing}},[i("itemInfoCell",t._g(t._b({attrs:{itemData:e,isDisabled:t.isDisabled,disabledEditBtn:t.focusing},on:{"on-item-focus":function(i){return t.onItemFocus(arguments,e.id+"-"+e.goodsDTO.id)},"on-item-blur":t.onItemBlur}},"itemInfoCell",t.$attrs,!1),t.$listeners))],1)}),1)])},C=[],k=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-info-cell"},[i("div",{staticClass:"item-img"},[i("img",{attrs:{src:t.comptedItemImgSrc(t.itemData.goodsDTO.imageUrls||[]),onerror:t.$fxCommon.errorImg("item")}})]),i("div",{staticClass:"item-details"},[i("div",{staticClass:"item-name fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.name))]),i("div",{staticClass:"details-cell"},[i("div",{staticClass:"item-taxprice fx-ellipsis"},[i("span",[t._v("含税金额：￥")]),!t.isDisabled&&t.$fxAuth("shopMoveOutBill.editTaxMoney")?i("w-number-input",{staticClass:"item-taxprice-input",attrs:{min:"0",max:t.maxAmount,intLength:t.numberLength,pointSize:t.sysPointSize},on:{change:function(e){return t.onMoneyChange(t.itemData.sendMoneyWithTax)},focus:t.onFocus,blur:t.onBlur},model:{value:t.itemData.sendMoneyWithTax,callback:function(e){t.$set(t.itemData,"sendMoneyWithTax",e)},expression:"itemData.sendMoneyWithTax"}}):i("span",[t._v(t._s(t.itemData.sendMoneyWithTax))])],1),i("div",{staticClass:"item-spec fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.spec))])]),i("div",{staticClass:"details-cell"},[t.isDisabled||t.itemData.isWeightSign&&!t.sysDZCCanModifyAcount||!t.$fxAuth("shopMoveOutBill.editAmount")?i("div",{staticClass:"item-amount"},[i("span",[t._v(t._s(t.itemData.busUnitOutAmount))]),i("span",{staticClass:"fx-ellipsis"},[t._v(t._s(t.itemData.unitDTO.name))])]):i("div",{staticClass:"item-amount-edit"},[i("w-stepper",{ref:"amountInput",staticClass:"amount-step",attrs:{min:"0",max:t.maxAmount,stepperBtnShow:!1,intLength:t.numberLength,pointSize:t.sysPointSize,inputWidth:"28vw"},on:{change:function(e){return t.onChange(t.itemData.busUnitOutAmount)},focus:t.onFocus,blur:t.onBlur},model:{value:t.itemData.busUnitOutAmount,callback:function(e){t.$set(t.itemData,"busUnitOutAmount",e)},expression:"itemData.busUnitOutAmount"}}),i("div",{staticClass:"unit-text"},[i("span",{staticClass:"fx-ellipsis cell-unit"},[t._v(t._s(t.itemData.unitDTO.name))])])],1)])]),i("i",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&!t.disabledEditBtn,expression:"!isDisabled && !disabledEditBtn"}],staticClass:"block-item-edit",on:{click:t.onItemEditClick}}),i("i",{directives:[{name:"show",rawName:"v-show",value:t.isDisabled&&!t.disabledWatchBtn,expression:"isDisabled && !disabledWatchBtn"}],staticClass:"block-item-watch",on:{click:t.onItemEditClick}})])},y=[],A={name:"itemInfoCell",props:{itemData:{type:Object,default:function(){return{}}},isDisabled:Boolean,disabledEditBtn:Boolean,disabledWatchBtn:Boolean,shopId:String},computed:Object(m["a"])({},Object(f["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",maxAmount:"maxAmount",sysDZCCanModifyAcount:function(t){return t.systemParams.sysDZCCanModifyAcount},loginerShopId:function(t){return t.loginer.loginerShopId}}),{comptedItemImgSrc:function(t){return function(t){return 0===t.length?"":t[0]}}}),methods:{editItem:function(){this.itemData.id&&this.$set(this.itemData,"changeType","edit")},onItemEditClick:function(){this.editItem(),this.$emit("on-item-edit",this.itemData)},onChange:function(t){if("del"===this.itemData.changeType)return!1;this.editItem(),this.calcMoney("amount",t,this.itemData)},onMoneyChange:function(t){this.editItem(),this.calcMoney("moneyWithTax",t,this.itemData)},calcMoney:function(t,e,i){var n=i.taxPrice,a=i.busUnitOutAmount,o=i.price,s=i.sendTaxes,r=0,l=0,c=0,u=0;if(e=this.toFixedNumberSize(e),i.giftFlag||"money"===t&&0===e)return i.sendMoney=0,i.sendMoneyWithTax=0,i.sendTaxMoney=0,!0;"money"===t?(r=e,c=this.toFixedNumberSize(r/a),l=this.toFixedNumberSize(r*(1+s)),u=this.toFixedNumberSize(l/a)):"amount"===t?(i.busUnitOutAmount=e,c=o,u=n,r=this.toFixedNumberSize(o*e),l=this.toFixedNumberSize(n*e)):"moneyWithTax"===t?(l=e,u=this.toFixedNumberSize(l/a),r=this.toFixedNumberSize(l/(1+s)),c=this.toFixedNumberSize(r/a)):"taxPrice"===t?(u=e,l=this.toFixedNumberSize(a*u),c=this.toFixedNumberSize(u/(1+s)),r=this.toFixedNumberSize(c*a)):"price"===t&&(c=e,r=this.toFixedNumberSize(c*a),u=this.toFixedNumberSize(c*(1+s)),l=this.toFixedNumberSize(a*u)),i.sendMoney=r,i.sendMoneyWithTax=l,i.sendTaxMoney=this.toFixedNumberSize(this.toFixedNumberSize(l)-this.toFixedNumberSize(r)),i.price=c,i.taxPrice=u},toFixedNumberSize:function(t){return u()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},onFocus:function(){this.$emit("on-item-focus")},onBlur:function(){var t=this;this.onCheckAmount().then(function(){t.$emit("on-item-blur")}).catch(function(){t.$refs.amountInput.setFocus(),t.$emit("on-item-focus")})},onCheckAmount:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new d.a(function(i,n){var a=t.itemData.busUnitOutAmount,o="数量不符合规则";0===a?t.$nextTick(function(){e&&t.$fxNotify.fail("数量不能为0!"),n(o)}):i()})}}},O=A,F=(i("b53e"),Object(x["a"])(O,k,y,!1,null,"3994d8ce",null)),P=F.exports,T={name:"orderItem",components:{itemInfoCell:P},props:{data:{type:Array,default:function(){return[]}},isDisabled:Boolean,itemInputFocusing:Boolean},inheritAttrs:!1,data:function(){return{focusing:!1}},computed:{storeShowComputed:function(t){return function(t){var e=t.details.filter(function(t){return"del"!==t.changeType}).length;return e>0}},detailsLength:function(t){return this.data.reduce(function(t,e){return"del"!==e.changeType?t+1:t},0)}},watch:{focusing:function(t){this.$emit("update:itemInputFocusing",t)}},methods:{onSearchClick:function(){if(this.focusing)return!1;this.$emit("on-search-click")},onItemFocus:function(t,e){this.focusing=!0},onItemBlur:function(){this.focusing=!1}}},B=T,L=(i("01bc"),Object(x["a"])(B,w,C,!1,null,"f3400a68",null)),N=L.exports,M=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"itemRowEdit-popup"},[i("w-header",{attrs:{title:t.currentItemData.goodsDTO.name,leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{ref:"rowEditContent",staticClass:"itemRowEdit-content"},[i("van-cell-group",[i("van-cell",{attrs:{title:"申请数量",value:t.currentItemData.busUnitApplyAmount,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"差异数量",value:t.differenceAmount,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"成本单价",value:t.currentItemData.costPrice,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"非税成本金额",value:t.currentItemData.outMoney,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"成本税率",value:t.fomatterTaxes(t.currentItemData.tax),"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"含税成本单价",value:t.currentItemData.costTaxPrice,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"含税成本金额",value:t.currentItemData.outMoneyWithTax,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"成本税额",value:t.currentItemData.taxOutMoney,"value-class":"info-item-value"}}),i("van-cell",{attrs:{value:t.currentItemData.price,title:"调拨单价","value-class":"info-item-value"}}),i("van-cell",{attrs:{value:t.currentItemData.sendMoney,title:"调拨非税金额","value-class":"info-item-value"}}),i("van-cell",{class:{"text-tax":!t.isDisabled},attrs:{title:"调拨税率",value:t.fomatterTaxes(t.currentItemData.sendTaxes),"is-link":!t.isDisabled||!t.$fxAuth("shopMoveOutBill.editPrice"),"value-class":"info-item-value"},on:{click:t.onTaxClick}}),i("van-pro-number-field",{attrs:{label:"调拨含税单价","input-align":"right",min:"0",max:t.maxAmount,intLength:t.numberLength,pointSize:t.sysPointSize,disabled:!t.$fxAuth("shopMoveOutBill.editPrice")||t.isDisabled||0===t.currentItemData.busUnitOutAmount},on:{change:function(e){return t.onTaxPriceChange(t.currentItemData.taxPrice)}},model:{value:t.currentItemData.taxPrice,callback:function(e){t.$set(t.currentItemData,"taxPrice",e)},expression:"currentItemData.taxPrice"}}),i("van-cell",{attrs:{title:"调拨税额",value:t.currentItemData.sendTaxMoney,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"品项编号",value:t.currentItemData.goodsDTO.code,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"品项类型",value:t.currentItemData.goodsDTO.styleName,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"批次号",value:t.currentItemData.batchCode,"value-class":"info-item-value"}}),i("van-pro-field",{ref:"memo",attrs:{placeholder:t.setPlaceholder("请输入备注"),disabled:t.isDisabled,label:"备注","input-align":"right"},on:{focus:function(e){return t.onFocus("memo")}},model:{value:t.currentItemData.memo,callback:function(e){t.$set(t.currentItemData,"memo",e)},expression:"currentItemData.memo"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"净重量",value:t.toFixedNumberSize(t.currentItemData.netWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"皮重量",value:t.toFixedNumberSize(t.currentItemData.skinWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"毛重量",value:t.toFixedNumberSize(t.currentItemData.grossWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"称重单位",value:t.currentItemData.weightUnit,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"称重状态",value:t.currentItemData.isWeightSign?"已称重":"未称重","value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"图片",border:!1,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData&&t.currentItemData.images.length,expression:"sysShowDZCData && currentItemData.images.length"}],staticClass:"info-cell-img",attrs:{"value-class":"info-item-img"}},[i("img",{attrs:{src:t.comptedItemImgSrc(t.currentItemData.images)}})])],1)],1),i("div",{staticClass:"itemRowEdit-bottom"},[t.isDisabled?t._e():i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onConfirmClick}},[t._v("保存")])],1),i("taxesActionSheet",{attrs:{sync:!0},on:{"on-taxes-select":t.onTaxesSelect},model:{value:t.taxesActionShow,callback:function(e){t.taxesActionShow=e},expression:"taxesActionShow"}})],1)},E=[],$=i("bfb3"),z=i.n($),R=i("f729"),W={name:"itemRowEdit",components:{taxesActionSheet:R["a"]},props:{visibleFlag:Boolean,itemData:{type:Object,default:function(){return{}}},isDisabled:Boolean},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},currentItemData:{},currentDate:new Date,datePickerShow:!1,taxesActionShow:!1}},computed:Object(m["a"])({},Object(f["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",maxAmount:"maxAmount",sysShowDZCData:function(t){return t.systemParams.sysShowDZCData},loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{fomatterDate:function(t){var e=this;return function(t){return t?e.$fxUtils.setDate(new Date(t)):""}},fomatterTaxes:function(t){var e=this;return function(t){if(t){var i=e.$fxUtils.toFixedSHW(100*t,2,!1);return"".concat(i,"%")}return"0%"}},setPlaceholder:function(t){var e=this;return function(t){return e.isDisabled?"":t}},differenceAmount:function(){var t=this.currentItemData.busUnitApplyAmount-this.currentItemData.busUnitOutAmount;return t=u()(this.$fxUtils.toFixedSHW(t,this.sysPointSize)),z()(t)?"":t},comptedItemImgSrc:function(t){return function(t){return t?0===t.length?"":t[0].imagUrl:""}}}),watch:{visibleFlag:{handler:function(t){t&&(this.currentItemData=JSON.parse(s()(this.itemData)))},immediate:!0}},methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onConfirmClick:function(){this.currentItemData.id&&(this.currentItemData.changeType="edit"),this.$emit("on-Confirm",this.currentItemData),this.$emit("update:visibleFlag",!1)},onProductDateClick:function(){if(this.isDisabled)return!1;this.currentItemData.productDate&&(this.currentDate=new Date(this.currentItemData.productDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){this.currentItemData.productDate=t.getTime(),this.datePickerShow=!1},onTaxClick:function(){if(this.isDisabled||!this.$fxAuth("shopMoveOutBill.editTax"))return!1;this.taxesActionShow=!0},onTaxesSelect:function(t){this.currentItemData.sendTaxes=t.tax,this.computedByTaxes(t.tax)},computedByTaxes:function(t){var e=this.currentItemData,i=e.price,n=e.busUnitOutAmount,a=e.sendMoney,o=e.sendTaxMoney,s=e.sendMoneyWithTax;i=u()(this.$fxUtils.toFixedSHW(s/n/(1+t),this.sysPointSize)),a=u()(this.$fxUtils.toFixedSHW(i*n,this.sysPointSize)),o=u()(this.$fxUtils.toFixedSHW(s-a,this.sysPointSize)),this.currentItemData.price=i,this.currentItemData.sendMoney=a,this.currentItemData.sendTaxMoney=o},onTaxPriceChange:function(t){this.calcMoney("taxPrice",t,this.currentItemData)},calcMoney:function(t,e,i){var n=i.taxPrice,a=i.busUnitOutAmount,o=i.price,s=i.sendTaxes,r=0,l=0,c=0,u=0;if(e=this.toFixedNumberSize(e),i.giftFlag||"money"===t&&0===e)return i.sendMoney=0,i.sendMoneyWithTax=0,i.sendTaxMoney=0,!0;"money"===t?(r=e,c=this.toFixedNumberSize(r/a),l=this.toFixedNumberSize(r*(1+s)),u=this.toFixedNumberSize(l/a)):"amount"===t?(i.busUnitOutAmount=e,c=o,u=n,r=this.toFixedNumberSize(o*e),l=this.toFixedNumberSize(n*e)):"moneyWithTax"===t?(l=e,u=this.toFixedNumberSize(l/a),r=this.toFixedNumberSize(l/(1+s)),c=this.toFixedNumberSize(r/a)):"taxPrice"===t?(u=e,l=this.toFixedNumberSize(a*u),c=this.toFixedNumberSize(u/(1+s)),r=this.toFixedNumberSize(c*a)):"price"===t&&(c=e,r=this.toFixedNumberSize(c*a),u=this.toFixedNumberSize(c*(1+s)),l=this.toFixedNumberSize(a*u)),i.sendMoney=r,i.sendMoneyWithTax=l,i.sendTaxMoney=this.toFixedNumberSize(this.toFixedNumberSize(l)-this.toFixedNumberSize(r)),i.price=c,i.taxPrice=u},toFixedNumberSize:function(t){return u()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},changeGiftFlag:function(){this.currentItemData.giftFlag?(this.currentItemData.sendMoney=0,this.currentItemData.sendMoneyWithTax=0,this.currentItemData.sendTaxMoney=0):this.calcMoney("price",this.currentItemData.price,this.currentItemData)},onFocus:function(t){this.onScrollTop(t)},onScrollTop:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,i=this.$refs[t];if(!i||0===i.length)return!1;var n=i.$el.offsetTop,a=this.$refs["rowEditContent"];this.$fxUtils.scrollTopW({offsetTop:n,$el:a,distance:e})}}},j=W,U=(i("8fa3"),Object(x["a"])(j,M,E,!1,null,"709973ec",null)),H=U.exports,Z=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-search-block"},[i("w-header",{attrs:{title:"搜索品项",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{staticClass:"item-search clearfix"},[i("van-search",{attrs:{placeholder:"请输入搜索关键词",shape:"round"},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}})],1),i("div",{ref:"details-content",staticClass:"item-list"},[i("div",{staticClass:"item-store-title-container"},[i("w-icon",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],attrs:{type:"camera"},on:{click:t.onCameraClick}})],1),t._l(t.$fxCommon.detailFilter(t.data,t.searchKey),function(e){return i("van-swipe-cell",{directives:[{name:"show",rawName:"v-show",value:"del"!==e.changeType,expression:"item.changeType !== 'del'"}],key:e.id+"-"+e.goodsDTO.id,ref:"details-row-"+e.id+"-"+e.goodsDTO.id,refInFor:!0,staticClass:"item-row",attrs:{disabled:t.isDisabled||t.focusing}},[i("itemInfoCell",{attrs:{itemData:e,isDisabled:t.isDisabled,disabledEditBtn:t.focusing},on:{"on-item-edit":t.onSearchItemEdit,"on-item-focus":function(i){return t.onItemFocus(arguments,e.id+"-"+e.goodsDTO.id)},"on-item-blur":t.onItemBlur}})],1)})],2),i("div",{staticClass:"search-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onSearchConfirm}},[t._v("保存")])],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,isDisabled:t.isDisabled},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1),i("w-action-sheet",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.scanActionShow,expression:"scanActionShow"}],ref:"scanActionSheet",attrs:{actions:t.scanActions},model:{value:t.scanActionShow,callback:function(e){t.scanActionShow=e},expression:"scanActionShow"}})],1)},G=[],Y=(i("7f7f"),{name:"itemSearchPop",components:{itemInfoCell:P,itemRowEditPop:H},props:{data:{type:Array,default:function(){return[]}},shopId:{type:String,default:""},isDisabled:Boolean,visibleFlag:Boolean,house:{type:Object,default:function(){return{}}}},data:function(){return{focusing:!1,leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",itemRowEditPopShow:!1,itemEditRowData:{},activeStoreNames:[],scanActionShow:!1,scanActions:[{name:"累加数量"},{name:"覆盖数量"}],scanStoreItem:{}}},watch:{visibleFlag:{handler:function(t){t&&(this.searchKey="")},immediate:!0}},computed:Object(m["a"])({},Object(f["c"])({sysPointSize:"sysPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}})),methods:{onCloseClick:function(){if(this.focusing)return!1;this.$emit("update:visibleFlag",!1)},onDeleteClick:function(t,e,i){t.id?this.$set(t,"changeType","del"):i.splice(e,1)},onItemFocus:function(t,e){this.focusing=!0},onItemBlur:function(){this.focusing=!1},onSearchItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this.data.findIndex(function(e){return e.goodsDTO.id===t.goodsDTO.id});~e&&(this.data[e]=t)},onSearchConfirm:function(){if(this.focusing)return!1;this.$emit("on-search-confirm",this.data),this.$emit("update:visibleFlag",!1)},createBreakBill:function(t){var e=this;return new d.a(function(i){var n={billEmp:"",billMemo:"",billState:0,businessDate:(new Date).getTime(),businessTypeDTO:{},shopDTO:{id:e.shopId},details:[],updateIndicator:"Append",autoType:1,reckonBreak:"0",detailAdd:[t],accountDTO:{id:e.loginerId}};e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/breakBills"),data:n,query:{m:"addAndCheckBill"}}).then(function(t){i(),e.$fxToast.success("报损成功！")})})},onCameraClick:function(){this.scanStoreItem=this.data,this.$fxEventBus.$on("redCode",this.getItemByRedCode),this.$dialog.alert({title:"请扫码",message:"当前出库仓库：".concat(this.house.name),confirmButtonText:"取消扫码",beforeClose:function(t,e){this.$fxEventBus.$off("redCode",this.getItemByRedCode),e()}})},getItemByRedCode:function(t){var e=this;if(this.$dialog.close(),this.$fxEventBus.$off("redCode",this.getItemByRedCode),!this.visibleFlag)return!1;this.getItemByCode(t,!1).then(function(i){"100"===i.errorCode||"101"===i.errorCode?e.$dialog.confirm({title:"提示",message:i.message}).then(function(){if("100"===i.errorCode)return e.createBreakBill(i.storeBillDetailDTO),!0;e.getItemByCode(t,!0).then(function(t){e.getScanGoodData(t.storeBillDetailDTO)})}).catch(function(){return!1}):e.getScanGoodData(i.storeBillDetailDTO)})},getItemByCode:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new d.a(function(n){var a={billType:36,qrCodeContent:t,houseId:e.house.id,nextFlag:i};e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.shopId,"/users/").concat(e.loginerId,"/getscancodedata"),query:a}).then(function(t){n(t)})})},getScanGoodData:function(t){this.setScanGood(t)},setScanGood:function(t){var e=this,i=this.scanStoreItem.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id&&"del"!==e.changeType});if(!~i)return this.$fxToast.fail("当前仓库无此品项！"),!1;var n=this.scanStoreItem.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id&&t.unitDTO.id===e.unitDTO.id&&"del"!==e.changeType});if(!~n)return this.$fxToast.fail("不能重复添加品项！"),!1;var a=this.scanStoreItem[n];if(a.batchCode!==t.batchCode&&this.$fxUtils.isDef(a.batchCode))return this.$fxToast.fail("不能重复添加品项！"),!1;this.$refs.scanActionSheet.doSelect().then(function(i){"累加数量"===i.name&&e.computedScanItemAmount(t,a),e.refreshSelectItem(t,a)})},computedScanItemAmount:function(t,e){var i=this.toFixedNumberSize(t.busUnitApplyAmount+e.busUnitOutAmount);t.busUnitApplyAmount=this.$fxCommon.checkAmountRange(i)},refreshSelectItem:function(t,e){e.batchCode=t.batchCode,e.busUnitOutAmount=t.busUnitApplyAmount,this.editItem(e),this.calcMoney("amount",t.busUnitApplyAmount,e)},editItem:function(t){t.id&&this.$set(t,"changeType","edit")},toFixedNumberSize:function(t){return u()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},calcMoney:function(t,e,i){var n=i.taxPrice,a=i.busUnitOutAmount,o=i.price,s=i.sendTaxes,r=0,l=0,c=0,u=0;if(e=this.toFixedNumberSize(e),i.giftFlag||"money"===t&&0===e)return i.sendMoney=0,i.sendMoneyWithTax=0,i.sendTaxMoney=0,!0;"money"===t?(r=e,c=this.toFixedNumberSize(r/a),l=this.toFixedNumberSize(r*(1+s)),u=this.toFixedNumberSize(l/a)):"amount"===t?(i.busUnitOutAmount=e,c=o,u=n,r=this.toFixedNumberSize(o*e),l=this.toFixedNumberSize(n*e)):"moneyWithTax"===t?(l=e,u=this.toFixedNumberSize(l/a),r=this.toFixedNumberSize(l/(1+s)),c=this.toFixedNumberSize(r/a)):"taxPrice"===t?(u=e,l=this.toFixedNumberSize(a*u),c=this.toFixedNumberSize(u/(1+s)),r=this.toFixedNumberSize(c*a)):"price"===t&&(c=e,r=this.toFixedNumberSize(c*a),u=this.toFixedNumberSize(c*(1+s)),l=this.toFixedNumberSize(a*u)),i.sendMoney=r,i.sendMoneyWithTax=l,i.sendTaxMoney=this.toFixedNumberSize(this.toFixedNumberSize(l)-this.toFixedNumberSize(r)),i.price=c,i.taxPrice=u}}}),_=Y,Q=(i("47b7"),Object(x["a"])(_,Z,G,!1,null,"004c7344",null)),J=Q.exports,V={name:"shopMoveOutDetails",components:{orderInfo:I,orderItem:N,itemRowEditPop:H,itemSearchPop:J},data:function(){return{query:this.$route.query,activeNames:["1"],tabActive:"选项1",orderInfoData:{},orderItemList:[],dateType:"business",currentDate:new Date,datePickerShow:!1,storeItem:[],itemRowEditPopShow:!1,itemEditRowData:{},itemInputFocusing:!1,orderDeleteFlag:!1,formatterSysPointKey:["busUnitOutAmount"],itemSearchPopShow:!1,searchItem:[]}},created:function(){this.createOrderDetails()},beforeRouteLeave:function(t,e,i){var n=this;if(this.itemInputFocusing)return this.$router.go(1),!1;"/shopMoveOut"!==t.path||this.orderDeleteFlag||0!==this.orderInfoData.billState?i():this.$dialog.confirm({title:"提示",message:"若已修改,请先保存单据<br/>是否关闭页面?"}).then(function(){i()}).catch(function(){return n.$router.go(1),!1})},computed:Object(m["a"])({},Object(f["c"])({sysPointSize:"sysPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId},sysDZCManyLower:function(t){return t.systemParams.sysDZCManyLower}}),{isBillState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.billState):e.orderInfoData.billState===t}},isWeightState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.weightState):e.orderInfoData.weightState===t}}}),methods:{createOrderDetails:function(){var t=this;return new d.a(function(e){t.getOrderDetails().then(function(i){var n=i.storeBills[0];t.formatterSysPoint(n.details),t.orderInfoData=n,t.orderItemList=n.details,e()})})},getOrderDetails:function(){var t=this;return new d.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shopMoveOutBills/").concat(t.query.orderId)}).then(function(t){e(t)})})},formatterSysPoint:function(t){var e=this,i=function(t){return u()(e.$fxUtils.toFixedSHW(t,e.sysPointSize))};t.forEach(function(t){var n=u()(t.busUnitOutAmount);n?(t.price=i(t.sendMoney/n),t.taxPrice=i(t.sendMoneyWithTax/n),t.costPrice=i(t.outMoney/n),t.costTaxPrice=i(t.outMoneyWithTax/n)):(t.price=i(t.price),t.taxPrice=i(t.taxPrice),t.costPrice=i(t.costPrice),t.costTaxPrice=i(t.costTaxPrice)),e.formatterSysPointKey.forEach(function(e){t[e]=i(t[e])})})},clearItemConfim:function(t){var e=this;return new d.a(function(i){var n=e.orderItemList.filter(function(t){return"del"!==t.changeType});0===n.length?i():e.$dialog.confirm({title:"提示",message:t}).then(function(){e.onItemClear(),i()}).catch(function(){})})},onBusinessDateClick:function(){this.dateType="business",this.orderInfoData.businessDate&&(this.currentDate=new Date(this.orderInfoData.businessDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){var e=t.getTime();"business"===this.dateType&&(this.orderInfoData.businessDate=e),this.datePickerShow=!1},onDeleteClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要删除该单据吗?"}).then(function(){var e=t.getSaveParams();t.$fxHttp.requestDel({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shopMoveOutBills/").concat(t.query.orderId),data:e,query:{userId:t.loginerId}}).then(function(e){t.$fxToast.success("删除成功").then(function(){t.orderDeleteFlag=!0,t.$router.go(-1)})})}).catch(function(){})},onSaveClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要保存该单据吗?"}).then(function(){t.checkHasDetails().then(function(){t.saveHandler().then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success(e.message)})})})}).catch(function(){})},saveHandler:function(){var t=this;return new d.a(function(e){var i=t.getSaveParams();t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shopMoveOutBills/").concat(t.query.orderId),data:i,query:{userId:t.loginerId,m:"modify"}}).then(function(t){e(t)})})},onExpressClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要审核该单据吗?"}).then(function(){t.expressHandler()})},expressHandler:function(){var t=this;this.checkHasDetails().then(function(){var e=t.getSaveParams();t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shopMoveOutBills/").concat(t.query.orderId),data:e,query:{userId:t.loginerId,m:"editAndCheck"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("审核成功")})}).catch(function(e){"1"===e.errorCode&&t.createOrderDetails()})})},onUnExpressClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要反审该单据吗?"}).then(function(){t.checkHasDetails().then(function(){var e=t.getSaveParams();t.unExpressHandler(e)})}).catch(function(){})},unExpressHandler:function(t){var e=this;this.$fxHttp.requestPut({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/shopMoveOutBills/").concat(this.query.orderId),data:t,query:{userId:this.loginerId,m:"unCheck"}}).then(function(t){e.createOrderDetails().then(function(){e.$fxToast.success("反审成功")})})},onWeightClick:function(){var t=this;this.checkHasDetails().then(function(){t.$dialog.confirm({title:"提示",message:"确定要下发称重吗?"}).then(function(){var e=t.getSaveParams();if(!e)return!1;t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shopMoveOutBills/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:e,query:{userId:t.loginerId,m:"weighBill"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("下发称重成功")})})}).catch(function(){})})},onUnWeightClick:function(){var t=this;this.checkHasDetails().then(function(){var e="确定要取消称重吗?";2===t.orderInfoData.weighState&&(e="称重中的单据，取消称重后电子秤可以继续称重并传回数据！确定要取消称重吗"),t.$dialog.confirm({title:"提示",message:e}).then(function(){t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shopMoveOutBills/").concat(t.query.orderId,"/users/").concat(t.loginerId),query:{userId:t.loginerId,m:"unWeighBill"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("取消称重成功")})})}).catch(function(){})})},onEndWeightClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"结束称重后将不再接收此单据的称重数据"}).then(function(){t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/shopMoveOutBills/").concat(t.query.orderId,"/users/").concat(t.loginerId),query:{userId:t.loginerId,m:"endWeighBill"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("结束称重成功")})})}).catch(function(){})},getSaveParams:function(){var t=this.orderItemList,e=t.filter(function(t){return"add"===t.changeType}),i=t.filter(function(t){return"del"===t.changeType}),n=t.filter(function(t){return"edit"===t.changeType}),a=l()({},this.orderInfoData,{detailAdd:e.length>0?e:null,detailDel:i.length>0?i:null,detailMdf:n.length>0?n:null,details:[]});return a},getValidItem:function(){return this.orderItemList.filter(function(t){return"del"!==t.changeType})},getItemLength:function(){return this.getValidItem().length},checkHasDetails:function(){var t=this;return new d.a(function(e){0===t.getItemLength()?t.$fxToast.fail("单据明细不能为空"):e()})},onItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this.orderItemList.findIndex(function(e){return e.goodsDTO.id===t.goodsDTO.id});~e&&(this.orderItemList[e]=t)},onItemClear:function(){var t=this.orderInfoData.details.filter(function(t){return!!t.id});t.forEach(function(t){t.changeType="del"}),this.orderInfoData.details=t,this.orderItemList=t},onItemFocus:function(){this.$refs.orderInfo.closeCollapse()},onClickHandler:function(t){if(this.itemInputFocusing)return!1;this[t]()},onSearchClick:function(){this.itemSearchPopShow=!0,this.searchItem=JSON.parse(s()(this.orderItemList))},onSearchConfirm:function(t){this.orderItemList=t}}},q=V,X=(i("977f"),Object(x["a"])(q,n,a,!1,null,"d76433c4",null));e["default"]=X.exports},a09d:function(t,e,i){},b53e:function(t,e,i){"use strict";var n=i("be14"),a=i.n(n);a.a},be14:function(t,e,i){},bfb3:function(t,e,i){t.exports=i("4dc9")},c137:function(t,e,i){},cf93:function(t,e,i){},d5de:function(t,e,i){},dab9:function(t,e,i){"use strict";var n=i("a09d"),a=i.n(n);a.a},df6c:function(t,e,i){"use strict";var n=i("e1a3"),a=i.n(n);a.a},e047:function(t,e,i){},e1a3:function(t,e,i){},eb03:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.popupShowFlag,callback:function(e){t.popupShowFlag=e},expression:"popupShowFlag"}},[i("listComp",{attrs:{visibleFlag:t.popupShowFlag,title:t.title,data:t.listData,loadFinished:t.currentLoadFinish,loading:t.onItemLoading},on:{"update:visibleFlag":function(e){t.popupShowFlag=e},"update:visible-flag":function(e){t.popupShowFlag=e},"update:loading":function(e){t.onItemLoading=e},"on-search":t.onSearchHandler,"on-select":t.onSelectHandler,"on-load":t.onListLoad}})],1)},a=[],o=i("75fc"),s=i("795b"),r=i.n(s),l=(i("c5f6"),i("f6bb")),c=50,u={name:"filterListPopup",components:{listComp:l["a"]},props:{value:Boolean,title:String,rollingLoad:Boolean,itemSize:{type:Number,default:c},getDataApi:Function},data:function(){return{popupShowFlag:!1,itemListLoadFinished:!1,onItemLoading:!1,listStart:0,listData:[]}},computed:{currentLoadFinish:function(){return this.itemListLoadFinished||!this.rollingLoad}},watch:{value:{immediate:!0,handler:function(t){var e=this;t&&this.onListRefresh().then(function(){e.$emit("on-show")})}},popupShowFlag:{immediate:!0,handler:function(t){t||this.$emit("input",!1)}}},methods:{onSearchHandler:function(t){this.onListRefresh(t)},onSelectHandler:function(t){this.$emit("on-select",t)},onListRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.listStart=0,new r.a(function(i){t.getDataApi(e,t.listStart,t.itemSize).then(function(e){t.popupShowFlag=!0,t.onItemLoading=!1,t.listStart+=t.itemSize,t.itemListLoadFinished=e.length<t.itemSize,t.listData=e,i()})})},onListLoad:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getDataApi(e,this.listStart,this.itemSize).then(function(e){var i;t.onItemLoading=!1,t.listStart+=t.itemSize,e.length<t.itemSize&&(t.itemListLoadFinished=!0),(i=t.listData).push.apply(i,Object(o["a"])(e))})}}},h=u,d=i("2877"),m=Object(d["a"])(h,n,a,!1,null,null,null);e["a"]=m.exports},eb87:function(t,e,i){"use strict";var n=i("c137"),a=i.n(n);a.a},f3c0:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQyIDc5LjE2MDkyNCwgMjAxNy8wNy8xMy0wMTowNjozOSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjRFMEVGQjYxREY1QzExRTk4NEQxQzk4RUQzQjYwMzQxIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjRFMEVGQjYyREY1QzExRTk4NEQxQzk4RUQzQjYwMzQxIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NEUwRUZCNUZERjVDMTFFOTg0RDFDOThFRDNCNjAzNDEiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NEUwRUZCNjBERjVDMTFFOTg0RDFDOThFRDNCNjAzNDEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5jgS7LAAAC50lEQVR42sSXy2tTQRTGzyS1KFgxYqkLQaWtAREXYiJpNUQLEaqCj/pAfBStuHHhRtC/wG4EX4hvKrpR3NWapq2KsZigreimBJtErSsfNYipSKh3/KYZ4zWZ3HtjEnrgy+ZOzm/mnJkzZxjnnKbDqsRP2xnNbByD1kIboWaoAXLIb0koBj2D7kNPIcPV3Dtmy4ANzAa1QyclTGV1UmJCx+UkTkFdkGbkuJAtgSLQdQOoyhrkfyLSR1FgH/QccpWQRpf04bUK9kNBaH4Z9pDw0Q9tMAM7Re6h6jJu4Grp01kIbIduQTUVOD2zpW+7CnygxJxayXl7LpjJI1M28y1jdHZ/3hY6IVlZsLfII2NoLcsZdaxjtGCu8qh59eDWckH9Kxgd9DGagWzejSgLWGu2ZMKalHUSQbFjapO/rEE3rWS0p4lRFaC3Bzl1v1SCPXpwo2rEkRZGNsDvhDmNpwwKOcZsXcVox2o2lcGuJ5wCrzkVuH+W6sEOZe2rY7S4FmdhJtHVR5ySE2rwdhejXR5Gk6jMN0OcggJaeJ4Os1pNlwY0+jBO5K7P5G3OrH+/izTsRmiF0kjHlYeceo2heQUkqfoY+0h0oU+jMcA9jYwOr2dUI+HViJVYZZub0fefRJcHOD0esXS3J/Xg0UKj4oCfD/6Fd2DlC+fRVD63IcTffojIcApFLTcUb/Q5DkNrCo18+4noXK9GR/02anYyWlSbgX+dyIR3KFFUFxPWr7jHbPS7z4Bj5QlMQkDFLr/YVzRU2AM9OCQ7B0Mb+wJYv0bhUU7XsMtfvS8aGpOtURYsPHRa+adY+ekeTi8S/9Ukdv5ph/THSfRIQxW8nYYlI+9aFIVxH5SqAFT43CsZyg4kCu2E0mWEpqXPqFnPFYC2lGnlKekrYLXLDMiOYbjEnLpUULNaLULjhg6JAlYEMC7/484Nb94TxsDE1r8hd6OobJvl3V2f84SJyydMNzRo9ILIXqXT9Wj7LcAAqr/RbQBzkgIAAAAASUVORK5CYII="},f52f:function(t,e,i){},f6bb:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"shop-popup"},[i("w-header",{attrs:{title:t.title,leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("van-pro-search",{directives:[{name:"show",rawName:"v-show",value:t.searchShow,expression:"searchShow"}],attrs:{shape:"round"},on:{search:t.search},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}}),i("div",{staticClass:"popup-content"},[i("van-list",{attrs:{finished:t.loadFinished,"finished-text":"没有更多了",error:t.listError,"immediate-check":t.immediateCheck,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.listError=e},load:t.onLoad},model:{value:t.listLoading,callback:function(e){t.listLoading=e},expression:"listLoading"}},t._l(t.data,function(e){return i("van-cell",{key:e.id,staticClass:"fx-van-cell",attrs:{title:e.name},on:{click:function(i){return t.indexListClick(e)}}})}),1)],1)],1)},a=[],o={name:"filterPop",props:{loading:Boolean,visibleFlag:Boolean,title:String,data:{type:Array,default:function(){return[]}},searchShow:{type:Boolean,default:!0},loadFinished:Boolean,immediateCheck:{type:Boolean,default:!0}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",listLoading:!1,listError:!1}},watch:{loading:{handler:function(t){t||(this.listLoading=!1)},immediate:!0},visibleFlag:function(t){t&&(this.searchKey="")}},methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},indexListClick:function(t){this.$emit("on-select",t),this.$emit("update:visibleFlag",!1)},search:function(t){this.$emit("on-search",t)},onLoad:function(){this.$emit("update:loading",!0),this.$emit("on-load",this.searchKey||null)}}},s=o,r=(i("8d5d"),i("2877")),l=Object(r["a"])(s,n,a,!1,null,"2a1c11fe",null);e["a"]=l.exports},faf1:function(t,e,i){"use strict";var n=i("cf93"),a=i.n(n);a.a}}]);
//# sourceMappingURL=shopMoveOut.85022d80.js.map