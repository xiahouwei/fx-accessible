(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["foodReckonBill"],{"06c5":function(t,e,i){"use strict";var n=i("a96f"),o=i.n(n);o.a},"096c":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-foodReckon-create"},[i("w-header",{attrs:{title:"新增菜品预估单",border:!0}}),i("orderInfo",{ref:"orderInfo",attrs:{data:t.orderInfoData,reckonDays:t.reckonDays(),collapseDisabled:t.itemInputFocusing},on:{"on-shop-click":t.onShopClick,"on-busdate-click":t.onBusinessDateClick,"on-reckondays-click":t.onReckonDaysClick}}),i("orderItem",{attrs:{data:t.orderItemList,itemInputFocusing:t.itemInputFocusing},on:{"update:itemInputFocusing":function(e){t.itemInputFocusing=e},"update:item-input-focusing":function(e){t.itemInputFocusing=e},"on-add-click":t.onAddClick,"on-search-click":t.onSearchClick,"on-item-edit":t.onItemEdit}}),i("div",{staticClass:"foodReckon-bottom"},[i("van-button",{staticClass:"add-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onCreateClick}},[t._v("生成单据")])],1),i("filterListPopup",{attrs:{title:"门店检索",rollingLoad:!0,getDataApi:t.getShopListData},on:{"on-select":function(e){return t.selectShop(arguments)}},model:{value:t.shopPopShow,callback:function(e){t.shopPopShow=e},expression:"shopPopShow"}}),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right"},model:{value:t.reckonDaysPopShow,callback:function(e){t.reckonDaysPopShow=e},expression:"reckonDaysPopShow"}},[i("listComp",{attrs:{visibleFlag:t.reckonDaysPopShow,data:t.formatterReckonDays,title:"预估天数",loadFinished:!0},on:{"update:visibleFlag":function(e){t.reckonDaysPopShow=e},"update:visible-flag":function(e){t.reckonDaysPopShow=e}}})],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.reckonDatePickerShow,callback:function(e){t.reckonDatePickerShow=e},expression:"reckonDatePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.reckonDatePickerShow,currentDate:t.currentDate,type:"date",mindate:new Date((new Date).getFullYear(),(new Date).getMonth(),1),maxdate:new Date((new Date).getFullYear(),(new Date).getMonth()+2,0)},on:{"update:visibleFlag":function(e){t.reckonDatePickerShow=e},"update:visible-flag":function(e){t.reckonDatePickerShow=e},confirm:t.reckonDateConfirmhandle}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemPopShow,callback:function(e){t.itemPopShow=e},expression:"itemPopShow"}},[i("itemEditComp",{attrs:{visibleFlag:t.itemPopShow,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,parentStoreItem:t.parentStoreItem?t.parentStoreItem:[]},on:{"update:visibleFlag":function(e){t.itemPopShow=e},"update:visible-flag":function(e){t.itemPopShow=e},"on-confirm":t.onItemEditConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemSearchPopShow,callback:function(e){t.itemSearchPopShow=e},expression:"itemSearchPopShow"}},[i("itemSearchPop",{attrs:{visibleFlag:t.itemSearchPopShow,data:t.searchItem,isDisabled:!t.$fxAuth("foodReckonBill.save")},on:{"update:visibleFlag":function(e){t.itemSearchPopShow=e},"update:visible-flag":function(e){t.itemSearchPopShow=e},"on-search-confirm":t.onSearchConfirm}})],1)],1)},o=[],a=(i("7514"),i("f499")),s=i.n(a),r=(i("20d6"),i("59ad")),c=i.n(r),l=i("5176"),d=i.n(l),u=i("75fc"),h=(i("a481"),i("768b")),f=i("795b"),m=i.n(f),p=(i("55dd"),i("b6d0")),v=i.n(p),k=i("774e"),b=i.n(k),g=(i("ac6a"),i("cebc")),C=i("2f62"),D=i("f2b1"),w=i("25d6"),S=i("eb03"),y=i("f6bb"),I=i("6672"),x=i("21d3"),P=i("931a"),$={name:"createFoodReckonBill",components:{orderInfo:D["a"],orderItem:w["a"],filterListPopup:S["a"],listComp:y["a"],itemRowEditPop:I["a"],itemSearchPop:x["a"],itemEditComp:P["a"]},data:function(){return{query:this.$route.query,activeNames:["1"],tabActive:"选项1",orderInfoData:{autoType:1,accountDTO:{},billEmp:"",billMemo:"",billState:0,businessDate:(new Date).getTime(),shopDTO:{},details:[],updateIndicator:"Append"},orderItemList:[],dateType:"business",currentDate:new Date,addDetailDate:null,shopPopShow:!1,shopList:[],datePickerShow:!1,reckonDatePickerShow:!1,itemRowEditPopShow:!1,itemEditRowData:{},itemInputFocusing:!1,itemSearchPopShow:!1,searchItem:[],parentStoreItem:[],itemPopShow:!1,formatterReckonDays:[],reckonDaysPopShow:!1}},computed:Object(g["a"])({},Object(C["c"])({sysPointSize:"sysPointSize",ysMoneyPointSize:"sysMoneyPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerShopName:function(t){return t.loginer.loginerShopName},loginerOrganType:function(t){return t.loginer.loginerOrganType},loginerId:function(t){return t.loginer.loginerId}}),{reckonDays:function(){var t=this;return function(){var e=[];return t.orderItemList.forEach(function(t){t.details.forEach(function(t){"del"!==t.changeType&&e.push(t.reckonDate)})}),e=b()(new v.a(e)),e.sort(function(t,e){return t-e}),e}}}),created:function(){this.loginerShopId&&this.$fxStateMiddleware.stateIs("loginerOrganType")(["shop","center"])(this.loginerOrganType)&&(this.orderInfoData.shopDTO={id:this.loginerShopId,name:this.loginerShopName})},beforeRouteLeave:function(t,e,i){var n=this;if(this.itemInputFocusing)return this.$router.go(1),!1;"/foodReckonBill"===t.path?this.$dialog.confirm({title:"提示",message:"若已修改,请先保存单据<br/>是否关闭页面?"}).then(function(){i()}).catch(function(){return n.$router.go(1),!1}):i()},methods:{clearItemConfim:function(t){var e=this;return new m.a(function(i){var n=e.orderItemList.filter(function(t){var e=t.details.filter(function(t){return"del"!==t.changeType});return 0!==e.length});0===n.length?i():e.$dialog.confirm({title:"提示",message:t}).then(function(){e.onItemClear(),i()}).catch(function(){})})},onShopClick:function(){this.shopPopShow=!0},selectShop:function(t){var e=this,i=Object(h["a"])(t,1),n=i[0];this.checkShop(n).then(function(){e.clearItemConfim("切换门店将清空菜品预估数据，是否继续?").then(function(){e.orderInfoData.shopDTO=n})})},checkShop:function(t){var e=this;return new m.a(function(i){var n=e.orderInfoData.shopDTO;n.id!==t.id&&i()})},getShopListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,n={keyword:t,start:e,size:i};return this.$fxApi("z5common.getListShop4ExceptPS")({data:n}).then(function(t){return t.shops})},onReckonDaysClick:function(){var t=this,e=this.reckonDays();if(!e.length)return!1;this.formatterReckonDays=e.map(function(e){return{id:"",name:t.$fxUtils.setDate(new Date(e))}}),this.reckonDaysPopShow=!0},onBusinessDateClick:function(){this.dateType="business",this.orderInfoData.businessDate&&(this.currentDate=new Date(this.orderInfoData.businessDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){var e=t.getTime();this.datePickerShow=!1,"business"===this.dateType&&(this.orderInfoData.businessDate=e)},reckonDateConfirmhandle:function(t){if("addDetail"===this.dateType){this.reckonDatePickerShow=!1;var e=this.$fxUtils.getCustomerDateAndTime(t,"00:00").getTime();if(e<this.$fxUtils.getCustomerDateAndTime(new Date,"00:00").getTime())return this.$fxToast.top("只能预估当日及以后的日期!"),!1;this.addDetailDate=e,this.parentStoreItem=this.getStoreItem(),this.itemPopShow=!0}},onAddClick:function(){var t=this;this.checkOrderInfo().then(function(){t.dateType="addDetail",t.addDetailDate&&(t.currentDate=new Date(t.addDetailDate)),t.reckonDatePickerShow=!0})},checkOrderInfo:function(){var t=this;return new m.a(function(e,i){t.orderInfoData.businessDate?t.orderInfoData.shopDTO.id?e():t.$fxToast.top("请先选择门店!"):t.$fxToast.top("请先选择业务日期!")})},onCreateClick:function(){var t=this;if(this.itemInputFocusing)return!1;this.$dialog.confirm({title:"提示",message:"确定生成单据吗?"}).then(function(){t.getSaveParams().then(function(e){t.createHandler(e)})}).catch(function(){})},createHandler:function(t){var e=this;this.$fxHttp.requestPost({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/foodReckonBill"),data:t}).then(function(t){e.$fxToast.success("生成单据成功").then(function(){e.$router.replace({path:"foodReckonBillDetails",query:{orderId:t.storeBills[0].id}})})})},getSaveParams:function(){var t=this;return new m.a(function(e){if(0===t.getItemLength())t.onAddClick();else{var i=[];t.orderItemList.forEach(function(t){i.push.apply(i,Object(u["a"])(t.details))});var n=i.filter(function(t){return"add"===t.changeType}),o=d()({},t.orderInfoData,{detailAdd:n,accountDTO:{id:t.loginerId}});e(o)}})},getValidItem:function(){var t=[];return this.orderItemList.forEach(function(e){t.push.apply(t,Object(u["a"])(e.details))}),t},getItemLength:function(){return this.getValidItem().length},onItemClear:function(){this.orderInfoData.details=[],this.orderItemList=this.orderInfoData.details},onItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},toFixedNumberSize:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sysMoneyPointSize;return c()(this.$fxUtils.toFixedSHW(t,e))},onEditRowConfirm:function(t){var e=this;t.totalFoodCount=this.toFixedNumberSize(t.details.reduce(function(t,i){return t+e.toFixedNumberSize(i.foodCount)},0));var i=this.orderItemList.findIndex(function(e){return e.foodUnitId===t.foodUnitId&&"del"!==e.changeType});~i&&(this.orderItemList[i]=t)},onSearchClick:function(){this.itemSearchPopShow=!0,this.searchItem=JSON.parse(s()(this.orderItemList))},onSearchConfirm:function(t){this.orderItemList=t},getStoreItem:function(){var t=this,e=[];return this.orderItemList.forEach(function(i){var n=i.details.filter(function(e){return e.reckonDate===t.addDetailDate});e.push.apply(e,Object(u["a"])(n))}),e},onItemEditConfirm:function(t){var e=this,i=Object(h["a"])(t,1),n=i[0];n.length&&n.forEach(function(t){t.reckonDate=e.addDetailDate;var i=e.orderItemList.find(function(e){return t.foodUnitId===e.foodUnitId});if(i){var n=i.details.findIndex(function(t){return t.reckonDate&&t.reckonDate===e.addDetailDate});~n?"add"===t.changeType||"edit"===t.changeType?i.details[n]=t:"del"===t.changeType&&(i.details[n].id?i.details[n]=t:i.details.splice(n,1)):i.details.push(t),e.sumCount(i)}else{var o=JSON.parse(s()(t));o.totalFoodCount=t.foodCount,o.details=[t],e.orderItemList.push(o)}})},sumCount:function(t){var e=this;t.totalFoodCount=t.details.reduce(function(t,i){var n="del"!==i.changeType?i.foodCount:0;return t+e.$fxUtils.toFixedParseNumber(n,e.sysPointSize)},0);var i=this.orderItemList.findIndex(function(e){return t.foodUnitId===e.foodUnitId});if(!~i)return!1;var n=this.orderItemList[i].details&&this.orderItemList[i].details.filter(function(t){return"del"===t.changeType&&!t.id}).length>0;n?this.orderItemList.splice(i,1):this.orderItemList.splice(i,1,t)}}},E=$,A=(i("f064"),i("2877")),L=Object(A["a"])(E,n,o,!1,null,"2d291644",null);e["default"]=L.exports},"11f2":function(t,e,i){},"1c82":function(t,e,i){"use strict";var n=i("5016"),o=i.n(n);o.a},"20a3":function(t,e,i){"use strict";var n=i("a761"),o=i.n(n);o.a},"21d3":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-search-block"},[i("w-header",{attrs:{title:"搜索品项",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("searchHead",{attrs:{initSearch:t.visibleFlag,searchKey:t.searchKey,selectActive:t.isSelectAll},on:{"update:searchKey":function(e){t.searchKey=e},"update:search-key":function(e){t.searchKey=e},"on-select-click":t.onSelectAllClick,"on-confirm-key":t.onConfirmKey}}),i("div",{ref:"details-content",staticClass:"item-list"},t._l(t.detailFilter(t.searchData),function(e){return i("van-swipe-cell",{directives:[{name:"show",rawName:"v-show",value:t.itemDetailsLength(e),expression:"itemDetailsLength(item)"}],key:""+e.goodsUUid,ref:"details-row-"+e.goodsUUid,refInFor:!0,staticClass:"item-row",attrs:{"right-width":80,disabled:t.isDisabled||t.focusing}},[i("div",{staticClass:"item-cell"},[i("checkBox",{staticClass:"search-checkbox",attrs:{visibleFlag:!t.isDisabled,checked:e.checked},on:{"on-checkbox-click":function(i){return t.onCheckBoxClick(e)}}}),i("itemInfoCell",{staticClass:"search-info",attrs:{itemData:e,isDisabled:t.isDisabled,disabledEditBtn:t.focusing},on:{"on-item-edit":t.onSearchItemEdit}})],1),i("div",{staticClass:"item-row-delete",attrs:{slot:"right"},on:{click:function(i){return t.onDeleteClick(e)}},slot:"right"},[t._v("删除")])])}),1),i("div",{staticClass:"search-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onSearchConfirm}},[t._v("保存")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:t.onDelSelect}},[t._v("删除")])],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,isDisabled:t.isDisabled},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1)],1)},o=[],a=i("59ad"),s=i.n(a),r=(i("20d6"),i("6762"),i("2fdb"),i("28a5"),i("7514"),i("ac6a"),i("cebc")),c=i("f499"),l=i.n(c),d=i("2f62"),u=i("6bd6"),h=i("6672"),f=i("01db"),m=i("0f38"),p={name:"itemSearchPop",components:{itemInfoCell:u["a"],itemRowEditPop:h["a"],searchHead:f["a"],checkBox:m["a"]},props:{data:{type:Array,default:function(){return[]}},isDisabled:Boolean,visibleFlag:Boolean},data:function(){return{focusing:!1,leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",itemRowEditPopShow:!1,itemEditRowData:{},searchData:[],searchKeywords:"foodCode,foodName"}},watch:{visibleFlag:{handler:function(t){t&&(this.searchKey="",this.setDetailGoodsUUid(this.data),this.searchData=JSON.parse(l()(this.data)))},immediate:!0}},computed:Object(r["a"])({},Object(d["c"])({sysPointSize:"sysPointSize",sysMoneyPointSize:"sysMoneyPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{isSelectAll:function(){var t=this;if(this.isDisabled)return"";var e=this.detailFilter(this.searchData),i=e.filter(function(e){return t.itemDetailsLength(e)&&e.checked}).length,n=e.filter(function(e){return t.itemDetailsLength(e)}).length;return 0!==i&&i===n}}),methods:{setDetailGoodsUUid:function(t){var e=this;t.forEach(function(t){t.goodsUUid=e.$fxUtils.createUUID()})},itemDetailsLength:function(t){return t.details&&t.details.filter(function(t){return"del"!==t.changeType}).length>0},detailFilter:function(t){var e=this;return t.filter(function(t){return!!e.searchKeywords.split(",").find(function(i){if(t[i].toLowerCase().includes(e.searchKey.toLowerCase()))return!0})})},onCloseClick:function(){if(this.focusing)return!1;this.$emit("update:visibleFlag",!1)},onDeleteClick:function(t){t.details.forEach(function(e,i){e.id?e.changeType="del":t.details.splice(i,1)});var e=this.searchData.findIndex(function(e){return e.foodUnitId===t.foodUnitId});this.searchData.splice(e,1,t)},onSearchItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this;t.totalFoodCount=this.toFixedNumberSize(t.details.reduce(function(t,i){return t+e.toFixedNumberSize(i.foodCount)},0));var i=this.searchData.findIndex(function(e){return e.foodUnitId===t.foodUnitId});~i&&(this.searchData[i]=t)},toFixedNumberSize:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sysMoneyPointSize;return s()(this.$fxUtils.toFixedSHW(t,e))},onSearchConfirm:function(){if(this.focusing)return!1;this.searchData.forEach(function(t){delete t.checked}),this.$emit("on-search-confirm",this.searchData),this.$emit("update:visibleFlag",!1)},onCheckBoxClick:function(t){if(this.focusing)return!1;this.$set(t,"checked",!t.checked)},onSelectAllClick:function(){var t=this,e=!this.isSelectAll,i=this.detailFilter(this.searchData);i.forEach(function(i){t.itemDetailsLength(i)&&t.$set(i,"checked",e)})},onDelSelect:function(){var t=this,e=this.searchData.filter(function(e){return e.checked&&t.itemDetailsLength(e)});if(!e.length)return this.$fxToast.top("请先选择品项!"),!0;this.$dialog.confirm({title:"提示",message:"是否删除？"}).then(function(){e.forEach(function(e){e.details.forEach(function(t,i){t.id?t.changeType="del":e.details.splice(i,1)});var i=t.searchData.findIndex(function(t){return t.foodUnitId===e.foodUnitId});t.searchData.splice(i,1,e)})})},onConfirmKey:function(){if(""!==this.searchKey)return!0}}},v=p,k=(i("c7ad"),i("2877")),b=Object(k["a"])(v,n,o,!1,null,"245e0f08",null);e["a"]=b.exports},"25d6":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-item-block fx-shadow-block"},[i("div",{staticClass:"item-title"},[i("span",{staticClass:"title-name"},[t._v("单据明细")]),i("span",{staticClass:"title-count"},[t._v("明细：")]),i("span",[t._v(t._s(t.detailsLength))]),i("i",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&1===t.autoType,expression:"!isDisabled && autoType === 1"}],staticClass:"title-add-icon fl-r",on:{click:function(e){return t.onEmitClick("on-add-click")}}}),i("i",{staticClass:"title-search-icon fl-r",on:{click:t.onSearchClick}})]),i("div",{ref:"details-content",staticClass:"item-list"},t._l(t.data,function(e){return i("van-swipe-cell",{directives:[{name:"show",rawName:"v-show",value:t.itemDetailsLength(e),expression:"itemDetailsLength(item)"}],key:""+e.goodsUUid,ref:"details-row-"+e.goodsUUid,refInFor:!0,staticClass:"item-row",attrs:{"right-width":80,disabled:t.isDisabled||t.focusing}},[i("itemInfoCell",t._g(t._b({attrs:{itemData:e,isDisabled:t.isDisabled,disabledEditBtn:t.focusing}},"itemInfoCell",t.$attrs,!1),t.$listeners)),i("div",{staticClass:"item-row-delete",attrs:{slot:"right"},on:{click:function(i){return t.onDeleteClick(e)}},slot:"right"},[t._v("删除")])],1)}),1)])},o=[],a=(i("20d6"),i("ac6a"),i("c5f6"),i("6bd6")),s={name:"orderItem",components:{itemInfoCell:a["a"]},props:{data:{type:Array,default:function(){return[]}},isDisabled:Boolean,itemInputFocusing:Boolean,autoType:{type:Number,default:1}},inheritAttrs:!1,data:function(){return{focusing:!1}},computed:{detailsLength:function(){var t=this;return this.data.filter(function(e){return t.itemDetailsLength(e)}).length}},watch:{focusing:function(t){this.$emit("update:itemInputFocusing",t)},data:function(){this.setDetailGoodsUUid(this.data)}},methods:{setDetailGoodsUUid:function(t){var e=this;t.forEach(function(t){t.goodsUUid=e.$fxUtils.createUUID()})},itemDetailsLength:function(t){return t.details&&t.details.filter(function(t){return"del"!==t.changeType}).length>0},onEmitClick:function(t){if(this.isDisabled||this.focusing)return!1;this.$emit(t)},onSearchClick:function(){if(this.focusing)return!1;this.$emit("on-search-click")},onDeleteClick:function(t){t.details.forEach(function(e,i){e.id?e.changeType="del":t.details.splice(i,1)});var e=this.data.findIndex(function(e){return e.foodUnitId===t.foodUnitId});this.data.splice(e,1,t)}}},r=s,c=(i("4bb8"),i("2877")),l=Object(c["a"])(r,n,o,!1,null,"eb95b9c2",null);e["a"]=l.exports},"2f77":function(t,e,i){"use strict";var n=i("d00e"),o=i.n(n);o.a},3428:function(t,e,i){},"39f3":function(t,e,i){},"3a66":function(t,e,i){"use strict";var n=i("8dec"),o=i.n(n);o.a},"3aa0":function(t,e,i){},"3fa0":function(t,e,i){"use strict";var n=i("90f7"),o=i.n(n);o.a},4877:function(t,e,i){"use strict";var n=i("e807"),o=i.n(n);o.a},"4bb8":function(t,e,i){"use strict";var n=i("b8bd"),o=i.n(n);o.a},"4fa1":function(t,e,i){"use strict";var n=i("11f2"),o=i.n(n);o.a},5016:function(t,e,i){},5402:function(t,e,i){"use strict";var n=i("73b7"),o=i.n(n);o.a},"57c5":function(t,e,i){"use strict";var n=i("fb23"),o=i.n(n);o.a},6672:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"itemRowEdit-popup"},[i("w-header",{attrs:{title:t.currentItemData.foodName+"-"+t.currentItemData.foodUnitName,leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{ref:"rowEditContent",staticClass:"itemRowEdit-content"},[i("van-cell-group",t._l(t.currentItemData.details,function(e,n){return i("div",{directives:[{name:"show",rawName:"v-show",value:"del"!==e.changeType,expression:"item.changeType !== 'del'"}],key:""+n,ref:"count-"+n,refInFor:!0,class:{"is-active":t.rowActive===n}},[i("van-cell",{attrs:{title:t.formatterDate(e.reckonDate),"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"预估销量","input-align":"right","value-class":"info-item-value"},on:{click:function(e){return t.onItemClick(n)}},model:{value:e.foodCount,callback:function(i){t.$set(e,"foodCount",i)},expression:"item.foodCount"}})],1)}),0)],1),i("div",{staticClass:"itemRowEdit-bottom"},[t.isDisabled?t._e():i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onConfirmClick}},[t._v("保存")])],1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.numberKeyboardShow,expression:"numberKeyboardShow"}],staticClass:"details-number-keyboard"},[i("itemNumberKeyboard",{attrs:{title:t.keyboardTitleCompted,amount:t.keyboardAmountCompted,pointSize:t.sysPointSize,intLength:t.numberLength,unit:t.currentItemData.foodUnitName,unitEdit:!1},on:{change:t.onKeyboardChange,pre:t.onKeyboardPre,next:t.onKeyboardNext,hide:t.onKeyboardHide}})],1)],1)},o=[],a=i("795b"),s=i.n(a),r=i("59ad"),c=i.n(r),l=(i("55dd"),i("f499")),d=i.n(l),u=i("cebc"),h=i("2f62"),f=i("af41"),m={name:"itemRowEdit",components:{itemNumberKeyboard:f["a"]},props:{visibleFlag:Boolean,itemData:{type:Object,default:function(){return{}}},isDisabled:Boolean},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},currentItemData:{},focusing:!1,numberKeyboardShow:!1,rowActive:""}},computed:Object(u["a"])({},Object(h["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",maxAmount:"maxAmount"}),{formatterDate:function(t){var e=this;return function(t){return"number"===typeof t?e.$fxUtils.setDate(new Date(t)):""}},keyboardTitleCompted:function(){if(""!==this.rowActive&&this.currentItemData.details){var t=this.currentItemData.details[this.rowActive];return this.formatterDate(t.reckonDate)}return""},keyboardAmountCompted:function(){if(""!==this.rowActive&&this.currentItemData.details){var t=this.currentItemData.details[this.rowActive];return t.foodCount}return"0"}}),watch:{visibleFlag:{handler:function(t){if(t){this.numberKeyboardShow=!1,this.rowActive="",this.focusing=!1;var e=JSON.parse(d()(this.itemData));this.currentItemData=e,this.currentItemData.details.sort(function(t,e){return t.reckonDate-e.reckonDate})}},immediate:!0},rowActive:function(t,e){if(!this.currentItemData.details)return!0;""!==e?(this.currentItemData.details[e].foodCount=c()(this.currentItemData.details[e].foodCount),""===t?this.numberKeyboardShow=!1:this.scrollToActive(t)):this.scrollToActive(t)}},methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onConfirmClick:function(){if(this.focusing)return!1;this.numberKeyboardShow=!1,this.rowActive="",this.$emit("on-Confirm",this.currentItemData),this.$emit("update:visibleFlag",!1)},onCountChange:function(t){t.id&&(t.changeType="edit")},onCountBlur:function(t){var e=this;this.onCheckMoneyOrAmount(t).then(function(){e.focusing=!1}).catch(function(){e.focusing=!0})},onCheckMoneyOrAmount:function(t){var e=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new s.a(function(n,o){var a="不符合规则";t.foodCount<=0?e.$nextTick(function(){if(i){var t="数量必须大于0！";e.$fxNotify.fail(t)}o(a)}):n()})},onItemClick:function(t){if(this.isDisabled||this.focusing)return!1;this.rowActive=t,this.numberKeyboardShow=!0},onKeyboardChange:function(t){var e=this.currentItemData.details[this.rowActive];e.foodCount=t,e.id&&(e.changeType="edit")},onKeyboardPre:function(){var t=this;if(!this.rowActive)return!1;this.onCheckMoneyOrAmount(this.currentItemData.details[this.rowActive]).then(function(){t.rowActive--}).catch(function(){t.focusing=!0})},onKeyboardNext:function(){var t=this;if(""===this.rowActive||this.rowActive===this.currentItemData.details.length-1)return!1;this.onCheckMoneyOrAmount(this.currentItemData.details[this.rowActive]).then(function(){t.rowActive++}).catch(function(){t.focusing=!0})},onKeyboardHide:function(){var t=this;this.onCheckMoneyOrAmount(this.currentItemData.details[this.rowActive]).then(function(){t.rowActive=""}).catch(function(){t.focusing=!0})},scrollToActive:function(t){var e=this;this.$nextTick(function(){e.onSelectLetter(t,20)})},onSelectLetter:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40,i=this.$refs["count-".concat(t)];if(!i||0===i.length)return!1;var n=i[0].offsetTop-5,o=this.$refs["rowEditContent"];this.$fxUtils.scrollTopW({offsetTop:n,$el:o,distance:e})}}},p=m,v=(i("1c82"),i("2877")),k=Object(v["a"])(p,n,o,!1,null,"0c88a0c2",null);e["a"]=k.exports},"6bd6":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-info-cell"},[i("div",{staticClass:"item-img"},[i("img",{attrs:{src:t.comptedItemImgSrc(null),onerror:t.$fxCommon.errorImg("item")}})]),i("div",{staticClass:"item-details"},[i("div",{staticClass:"item-name fx-ellipsis"},[t._v(t._s(t.itemData.foodName))]),i("div",{staticClass:"details-cell"},[i("div",{staticClass:"item-spec fx-ellipsis"}),i("div",{staticClass:"item-amount"},[i("span",[t._v(t._s(t.itemData.totalFoodCount))])]),i("div",{staticClass:"unit-text"},[i("span",{staticClass:"fx-ellipsis cell-unit"},[t._v(t._s(t.itemData.foodUnitName))])])])]),i("i",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"block-item-edit",on:{click:t.onItemEditClick}}),i("i",{directives:[{name:"show",rawName:"v-show",value:t.isDisabled&&t.showEditBtn,expression:"isDisabled && showEditBtn"}],staticClass:"block-item-watch",on:{click:t.onItemEditClick}})])},o=[],a={name:"itemInfoCell",props:{itemData:{type:Object,default:function(){return{}}},isDisabled:Boolean,showEditBtn:{type:Boolean,default:function(){return!0}}},computed:{comptedItemImgSrc:function(t){return function(t){return null===t?"":t[0]}}},data:function(){return{isHasGoods:!1}},methods:{editItem:function(){this.itemData.id&&this.$set(this.itemData,"changeType","edit")},onItemEditClick:function(){this.editItem(),this.$emit("on-item-edit",this.itemData)}}},s=a,r=(i("7969"),i("2877")),c=Object(r["a"])(s,n,o,!1,null,"acf524e6",null);e["a"]=c.exports},"73b7":function(t,e,i){},7573:function(t,e,i){},7969:function(t,e,i){"use strict";var n=i("7573"),o=i.n(n);o.a},"8ae6":function(t,e,i){"use strict";var n=i("39f3"),o=i.n(n);o.a},"8dec":function(t,e,i){},"90f7":function(t,e,i){},"931a":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-edit"},[i("w-header",{attrs:{title:"选择菜品",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}},[i("van-icon",{staticClass:"header-confirm-btn",attrs:{slot:"header-right",name:"success"},on:{click:t.onItemConfirm},slot:"header-right"})],1),i("div",{staticClass:"item-search clearfix"},[i("van-search",{attrs:{placeholder:"请输入搜索关键词",shape:"round"},on:{search:t.search,focus:t.onSearchFocus},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}})],1),i("div",{staticClass:"item-edit-content"},[i("addItemClassList",{attrs:{itemClassList:t.itemClassList,classTitle:"全部菜品"},on:{"on-change-class":t.changeClass},model:{value:t.currentClass,callback:function(e){t.currentClass=e},expression:"currentClass"}}),i("addItemList",{ref:"addItemList",attrs:{listLoading:t.listLoading,loadFinished:t.loadFinished,itemList:t.itemList},on:{"update:listLoading":function(e){t.listLoading=e},"update:list-loading":function(e){t.listLoading=e},"on-load-more":t.onLoadMore},scopedSlots:t._u([{key:"item-cell",fn:function(e){return[i("addItemCell",{attrs:{itemData:e.$item,itemIndex:e.$index,rowActive:t.rowActive,itemAmoutName:"foodCount"},on:{"on-item-click":t.onItemEdit}})]}}]),model:{value:t.rowActive,callback:function(e){t.rowActive=e},expression:"rowActive"}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.numberKeyboardShow,expression:"numberKeyboardShow"}],staticClass:"details-number-keyboard"},[i("itemNumberKeyboard",{attrs:{title:t.keyboardTitleCompted,unit:t.keyboardUnitCompted,amount:t.keyboardAmountCompted,pointSize:t.sysPointSize,intLength:t.numberLength},on:{change:t.onKeyboardChange,pre:t.onKeyboardPre,next:t.onKeyboardNext,hide:t.onKeyboardHide}})],1)],1)},o=[],a=i("59ad"),s=i.n(a),r=i("768b"),c=(i("20d6"),i("ac6a"),i("75fc")),l=i("795b"),d=i.n(l),u=i("f499"),h=i.n(u),f=i("cebc"),m=i("2f62"),p=i("d444"),v=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"details-content",staticClass:"item-details-content"},[i("van-list",{attrs:{finished:t.loadFinished,"finished-text":"没有更多了",error:t.listError,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.listError=e},load:t.onLoadMore},model:{value:t.currentListLoading,callback:function(e){t.currentListLoading=e},expression:"currentListLoading"}},t._l(t.itemList,function(e,n){return i("div",{key:e.foodUnitId,ref:"details-row-"+n,refInFor:!0,staticClass:"item-detail"},[t._t("item-cell",null,{$item:e,$index:n})],2)}),0)],1)},k=[],b=(i("c5f6"),{name:"addItemList",props:{value:[String,Number],itemList:{type:Array,default:function(){return[]}},listLoading:Boolean,loadFinished:Boolean,listError:{type:Boolean,default:!1}},data:function(){return{currentListLoading:!1}},watch:{listLoading:{handler:function(t){this.currentListLoading=t},immediate:!0},currentListLoading:function(t){this.$emit("update:listLoading",t)}},computed:{comptedItemImgSrc:function(t){return function(t){return 0===t.length?"":t[0]}}},methods:{onLoadMore:function(){this.$emit("on-load-more")},onSelectLetter:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40,i=this.$refs["details-row-".concat(t)];if(!i||0===i.length)return!1;var n=i[0].offsetTop,o=this.$refs["details-content"];this.$fxUtils.scrollTopW({offsetTop:n,$el:o,distance:e})},prev:function(t){var e=this;return new d.a(function(i){if(0===t)return!1;var n=t-1,o=e.itemList[n];e.onSelectLetter(n),i({data:o,index:n})})},next:function(t){var e=this;return new d.a(function(i){if(t===e.itemList.length-1)return!1;var n=t+1,o=e.itemList[n];e.onSelectLetter(n),i({data:o,index:n})})}}}),g=b,C=(i("4877"),i("2877")),D=Object(C["a"])(g,v,k,!1,null,"2e127193",null),w=D.exports,S=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-detail-cell",class:{"is-active":t.rowActive===t.itemIndex,"is-error":t.isError},on:{click:t.onItemClick}},[i("div",{staticClass:"item-details-img"},[i("w-img",{attrs:{src:t.itemData.imageUrls}})],1),i("div",{staticClass:"item-details-params"},[i("div",{staticClass:"item-details-name fx-ellipsis"},[t._v(t._s(t.itemData.foodName))]),i("div",{staticClass:"item-details-spec fx-ellipsis"},[t._v("\n\t\t"+t._s(!t.showBom&&t.showSpec?t.itemData.spec:"")+"\n\t\t")]),i("div",{staticClass:"item-details-amount"},[i("span",{staticClass:"item-details-count"},[t._v(t._s(t.getItemAmount()))]),i("span",{staticClass:"item-details-unit"},[t._v(t._s(t.itemData.foodUnitName))])]),i("i",{directives:[{name:"show",rawName:"v-show",value:t.getItemAmount()>0||t.isActive,expression:"(getItemAmount()>0 || isActive)"}],staticClass:"item-selected-icon"})])])},y=[],I={name:"addItemCell",props:{itemData:{type:Object,default:function(){return{}}},itemIndex:Number,rowActive:[Number,String],isActive:Boolean,isError:Boolean,showBom:{type:Boolean,default:!1},showSpec:{type:Boolean,default:!0},itemAmoutName:{type:String,default:""}},methods:{onItemClick:function(){this.$emit("on-item-click",this.itemIndex)},getItemAmount:function(){return""===this.itemAmoutName?this.itemData.busUnitAmount:this.itemData[this.itemAmoutName]}}},x=I,P=(i("3a66"),Object(C["a"])(x,S,y,!1,null,"38c1939c",null)),$=P.exports,E=i("af41"),A=10,L={name:"itemEditComp",components:{addItemClassList:p["a"],addItemList:w,addItemCell:$,itemNumberKeyboard:E["a"]},props:{visibleFlag:Boolean,shopId:{type:String,default:""},parentStoreItem:{type:Array,default:function(){return[]}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",currentClass:"",itemClassList:[],itemList:[],numberKeyboardShow:!1,rowActive:"",selectedItemArr:[],itemListStart:0,listLoading:!1,loadFinished:!0}},computed:Object(f["a"])({},Object(m["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{keyboardTitleCompted:function(){if(""===this.rowActive)return"";var t=this.itemList[this.rowActive];return t.foodName},keyboardUnitCompted:function(){if(""===this.rowActive)return"";var t=this.itemList[this.rowActive];return t.foodUnitName},keyboardAmountCompted:function(){if(""===this.rowActive)return"0";var t=this.itemList[this.rowActive];return t.foodCount}}),watch:{visibleFlag:{handler:function(t){t&&(this.selectedItemArr=JSON.parse(h()(this.parentStoreItem)),this.refresh())},immediate:!0},rowActive:function(t,e){""!==e?(this.numberStringAmount(e),this.pushSelectedItem(this.itemList[e]),""===t?this.numberKeyboardShow=!1:this.scrollToActive(t)):this.scrollToActive(t)}},methods:{refresh:function(){var t=this;this.searchKey="",this.getItemClass().then(function(e){t.itemClassList=e.foodsTypes,t.currentClass="",t.getItemByClass()})},onCloseClick:function(){this.rowActive="",this.$emit("update:visibleFlag",!1)},onItemConfirm:function(){var t=this;this.rowActive="",this.$nextTick(function(){t.$emit("on-confirm",[t.selectedItemArr]),t.$emit("update:visibleFlag",!1)})},search:function(){this.getItemByClass()},getItemClass:function(){var t=this;return new d.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/food"),data:{m:"getFoodTypelist"}}).then(function(t){e(t)})})},getItem:function(){var t=this;return new d.a(function(e){var i={start:t.itemListStart,size:A,paged:!0,foodsSmallType:t.currentClass||null,shopId:t.shopId,searchText:t.searchKey||""};t.$fxApi("foodReckonBill.selFoodList")({data:i}).then(function(t){e(t)})})},getItemByClass:function(){var t=this;this.itemListStart=0,this.getItem().then(function(e){t.itemList=t.setResItem(e.foodDTOData),t.setListLoading(e.foodDTOData.length),t.$nextTick(function(){t.$refs.addItemList&&t.$refs.addItemList.onSelectLetter(0,5)})})},onLoadMore:function(){var t=this;this.getItem().then(function(e){var i;(i=t.itemList).push.apply(i,Object(c["a"])(t.setResItem(e.foodDTOData))),t.setListLoading(e.foodDTOData.length)})},setResItem:function(t){var e=this;return t.forEach(function(t){var i=e.selectedItemArr.findIndex(function(e){return t.foodUnitId===e.foodUnitId});~i&&"del"!==e.selectedItemArr[i].changeType?t.foodCount=e.selectedItemArr[i].foodCount:t.foodCount="0"}),t},setListLoading:function(t){this.listLoading=!1,this.itemListStart+=A,this.loadFinished=t<A},changeClass:function(t){var e=Object(r["a"])(t,2);e[0],e[1];this.searchKey="",this.onKeyboardHide(),this.getItemByClass()},onItemEdit:function(t){this.rowActive=t,this.numberKeyboardShow=!0},onKeyboardChange:function(t){this.itemList[this.rowActive].foodCount=t},numberStringAmount:function(t){var e=this.itemList[t].foodCount;this.itemList[t].foodCount=s()(e)},pushSelectedItem:function(t){var e=this.selectedItemArr.findIndex(function(e){return t.foodUnitId===e.foodUnitId});~e?(0===t.foodCount?"del"!==this.selectedItemArr[e].changeType&&(this.selectedItemArr[e].changeType="del",this.$fxToast({message:"删除已选品项".concat(t.foodName),position:"top"})):this.selectedItemArr[e].id&&(this.selectedItemArr[e].changeType="edit"),this.changeSelectedItem(t,e)):t.foodCount>0&&(t.changeType="add",this.selectedItemArr.push(t),this.changeSelectedItem(t,this.selectedItemArr.length-1))},changeSelectedItem:function(t,e){this.selectedItemArr[e].foodCount=t.foodCount},onKeyboardPre:function(){if(!this.rowActive)return!1;this.rowActive--},onKeyboardNext:function(){if(""===this.rowActive||this.rowActive===this.itemList.length-1)return!1;this.rowActive++},onKeyboardHide:function(){this.rowActive=""},scrollToActive:function(t){var e=this;this.$nextTick(function(){e.$refs.addItemList.onSelectLetter(t,20)})},onSearchFocus:function(){this.rowActive=""}}},F=L,B=(i("57c5"),Object(C["a"])(F,n,o,!1,null,"4f734353",null));e["a"]=B.exports},"95a8":function(t,e,i){"use strict";var n=i("fd54"),o=i.n(n);o.a},a276:function(t,e,i){"use strict";var n=i("edf1"),o=i.n(n);o.a},a437:function(t,e,i){},a761:function(t,e,i){},a96f:function(t,e,i){},ad8e:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-foodReckonBill-details"},[i("w-header",{attrs:{title:t.orderInfoData.sysbillCode,titleFontSize:"3.733vw",border:!0}}),i("orderInfo",{ref:"orderInfo",attrs:{data:t.orderInfoData,reckonDays:t.reckonDays(),isDisabled:t.isBillState(1)||!t.$fxAuth("foodReckonBill.save"),collapseDisabled:t.itemInputFocusing},on:{"on-shop-click":t.onShopClick,"on-busdate-click":t.onBusinessDateClick,"on-reckondays-click":t.onReckonDaysClick}}),i("orderItem",{ref:"orderItem",attrs:{data:t.orderItemList,itemInputFocusing:t.itemInputFocusing,isDisabled:t.isBillState(1)||!t.$fxAuth("foodReckonBill.save"),autoType:t.orderInfoData.autoType},on:{"update:itemInputFocusing":function(e){t.itemInputFocusing=e},"update:item-input-focusing":function(e){t.itemInputFocusing=e},"on-add-click":t.onAddClick,"on-search-click":t.onSearchClick,"on-item-edit":t.onItemEdit}}),i("div",{staticClass:"foodReckonBill-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillState(0)&&t.$fxAuth("foodReckonBill.del"),expression:"isBillState(0) && $fxAuth('foodReckonBill.del')"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onDeleteClick")}}},[t._v("删除")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillState(0)&&t.$fxAuth("foodReckonBill.check"),expression:"isBillState(0) && $fxAuth('foodReckonBill.check')"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onExpressClick")}}},[t._v("审核")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isAutoType(1)&&!t.orderInfoData.hasOrder&&t.isBillState(1)&&t.$fxAuth("foodReckonBill.createOrder"),expression:"isAutoType(1) && !orderInfoData.hasOrder && isBillState(1) && $fxAuth('foodReckonBill.createOrder')"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onGoodsReckonClick")}}},[t._v("原料用量预估")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.isAutoType(0)&&!t.orderInfoData.hasOrder&&t.isBillState(1)&&t.$fxAuth("foodReckonBill.createOrder"),expression:"!isAutoType(0) && !orderInfoData.hasOrder && isBillState(1) && $fxAuth('foodReckonBill.createOrder')"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:function(e){return t.onClickHandler("onCreateShopOrderClick")}}},[t._v("生成门店订货单")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isAutoType(1)&&t.isBillState(1)&&t.$fxAuth("foodReckonBill.unCheck"),expression:"isAutoType(1) && isBillState(1) && $fxAuth('foodReckonBill.unCheck')"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onUnExpressClick")}}},[t._v("反审")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.isBillState(0)&&t.$fxAuth("foodReckonBill.save"),expression:"isBillState(0) && $fxAuth('foodReckonBill.save')"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:function(e){return t.onClickHandler("onSaveClick")}}},[t._v("保存")])],1),i("filterListPopup",{attrs:{title:"门店检索",rollingLoad:!0,getDataApi:t.getShopListData},on:{"on-select":function(e){return t.selectShop(arguments)}},model:{value:t.shopPopShow,callback:function(e){t.shopPopShow=e},expression:"shopPopShow"}}),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right"},model:{value:t.reckonDaysPopShow,callback:function(e){t.reckonDaysPopShow=e},expression:"reckonDaysPopShow"}},[i("listComp",{attrs:{visibleFlag:t.reckonDaysPopShow,data:t.formatterReckonDays,title:"预估天数",loadFinished:!0,searchShow:!1},on:{"update:visibleFlag":function(e){t.reckonDaysPopShow=e},"update:visible-flag":function(e){t.reckonDaysPopShow=e}}})],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.reckonDatePickerShow,callback:function(e){t.reckonDatePickerShow=e},expression:"reckonDatePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.reckonDatePickerShow,currentDate:t.currentDate,type:"date",mindate:new Date((new Date).getFullYear(),(new Date).getMonth(),1),maxdate:new Date((new Date).getFullYear(),(new Date).getMonth()+2,0)},on:{"update:visibleFlag":function(e){t.reckonDatePickerShow=e},"update:visible-flag":function(e){t.reckonDatePickerShow=e},confirm:t.reckonDateConfirmhandle}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemPopShow,callback:function(e){t.itemPopShow=e},expression:"itemPopShow"}},[i("itemEditComp",{attrs:{visibleFlag:t.itemPopShow,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,parentStoreItem:t.parentStoreItem?t.parentStoreItem:[]},on:{"update:visibleFlag":function(e){t.itemPopShow=e},"update:visible-flag":function(e){t.itemPopShow=e},"on-confirm":t.onItemEditConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,isDisabled:t.isBillState(1)||!t.$fxAuth("foodReckonBill.save")},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemSearchPopShow,callback:function(e){t.itemSearchPopShow=e},expression:"itemSearchPopShow"}},[i("itemSearchPop",{attrs:{visibleFlag:t.itemSearchPopShow,data:t.searchItem,isDisabled:t.isBillState(1)||!t.$fxAuth("foodReckonBill.save")},on:{"update:visibleFlag":function(e){t.itemSearchPopShow=e},"update:visible-flag":function(e){t.itemSearchPopShow=e},"on-search-confirm":t.onSearchConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.goodsReckonPopShow,callback:function(e){t.goodsReckonPopShow=e},expression:"goodsReckonPopShow"}},[i("goodsReckon",{attrs:{visibleFlag:t.goodsReckonPopShow,data:t.goodsReckonData,billId:t.orderInfoData.id,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,isDisabled:t.isBillState(1)||!t.$fxAuth("foodReckonBill.save")},on:{"update:visibleFlag":function(e){t.goodsReckonPopShow=e},"update:visible-flag":function(e){t.goodsReckonPopShow=e},"on-search-confirm":t.onSearchConfirm}})],1)],1)},o=[],a=(i("7514"),i("20d6"),i("59ad")),s=i.n(a),r=i("5176"),c=i.n(r),l=i("75fc"),d=i("f499"),u=i.n(d),h=i("768b"),f=i("795b"),m=i.n(f),p=(i("55dd"),i("b6d0")),v=i.n(p),k=i("774e"),b=i.n(k),g=(i("ac6a"),i("6762"),i("2fdb"),i("6b54"),i("cebc")),C=i("2f62"),D=i("f2b1"),w=i("25d6"),S=i("eb03"),y=i("f6bb"),I=i("6672"),x=i("21d3"),P=i("931a"),$=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-search-block"},[i("w-header",{attrs:{title:"原料用量预估",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}},[i("headEditBtn",{attrs:{slot:"header-right",active:t.orderEditFlag},on:{click:t.onOrderEditClick},slot:"header-right"}),i("headSelectAllBtn",{directives:[{name:"show",rawName:"v-show",value:t.orderEditFlag,expression:"orderEditFlag"}],attrs:{slot:"header-right",active:t.isSelectAll},on:{click:t.onSelectAllClick},slot:"header-right"})],1),i("searchHead",{attrs:{initSearch:t.visibleFlag,searchKey:t.searchKey},on:{"update:searchKey":function(e){t.searchKey=e},"update:search-key":function(e){t.searchKey=e},"on-confirm-key":t.onConfirmKey}}),i("div",{ref:"details-content",staticClass:"item-list"},t._l(t.detailFilter(t.data),function(e){return i("div",{key:""+e.goodsUUid,ref:"details-row-"+e.goodsUUid,refInFor:!0,staticClass:"item-row"},[i("checkBox",{directives:[{name:"show",rawName:"v-show",value:t.orderEditFlag,expression:"orderEditFlag"}],staticClass:"search-checkbox",attrs:{checked:e.checked},on:{"on-checkbox-click":function(i){return t.onCheckBoxClick(e)}}}),i("itemInfoCell",t._g(t._b({attrs:{itemData:e},on:{"on-customizeCount-click":t.oncustomizeCountClick,"on-house-click":t.onHouseClick}},"itemInfoCell",t.$attrs,!1),t.$listeners))],1)}),0),i("div",{staticClass:"search-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.orderEditFlag,expression:"!orderEditFlag"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onSave}},[t._v("保存")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.orderEditFlag,expression:"orderEditFlag"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onBatchHouse}},[t._v("批量设置")])],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1),i("filterListPopup",{attrs:{title:"仓库检索",rollingLoad:!0,getDataApi:t.getHouseListData},on:{"on-select":function(e){return t.selectHouse(arguments)}},model:{value:t.housePopShow,callback:function(e){t.housePopShow=e},expression:"housePopShow"}}),i("filterListPopup",{attrs:{title:"批量仓库检索",rollingLoad:!0,getDataApi:t.getBatchHouseListData},on:{"on-select":function(e){return t.selectBatchHouse(arguments)}},model:{value:t.batchHousePopShow,callback:function(e){t.batchHousePopShow=e},expression:"batchHousePopShow"}})],1)},E=[],A=(i("28a5"),i("46aa")),L=i("a0be"),F=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-info-cell"},[i("div",{staticClass:"item-img"},[i("img",{attrs:{src:t.comptedItemImgSrc(null),onerror:t.$fxCommon.errorImg("item")}})]),i("div",{staticClass:"item-details"},[i("div",{staticClass:"item-name fx-ellipsis"},[t._v(t._s(t.itemData.goods.name))]),i("div",{staticClass:"details-cell"},[i("div",{staticClass:"item-title fx-ellipsis"},[t._v("系统预估用量:")]),i("div",{staticClass:"item-select"},[i("span",{staticClass:"item-num"},[t._v(t._s(t.itemData.totalGoodsCount))]),i("div",{staticClass:"unit-text"},[i("span",{staticClass:"fx-ellipsis cell-unit last-unit"},[t._v(t._s(t.itemData.unit.name))])])])]),i("div",{staticClass:"details-cell"},[i("div",{staticClass:"item-title fx-ellipsis"},[t._v("自定义预估用量:")]),i("div",{staticClass:"item-select",on:{click:function(e){return t.onEmitClick("on-customizeCount-click")}}},[i("span",{staticClass:"item-num"},[t._v(t._s(t.itemData.totalCustomizeCount))]),i("div",{staticClass:"unit-text"},[i("span",{staticClass:"fx-ellipsis cell-unit"},[t._v(t._s(t.itemData.unit.name))]),i("van-icon",{staticClass:"unit-icon",attrs:{name:"arrow"}})],1)])]),i("div",{staticClass:"details-cell"},[i("div",{staticClass:"item-title fx-ellipsis"},[t._v("异常信息:")]),i("div",{staticClass:"item-select"},[i("div",{staticClass:"info-text fx-ellipsis"},[t._v("\n\t\t\t\t\t"+t._s(t.itemData.abnormalInfo)+"\n\t\t\t\t")])])]),i("div",{staticClass:"details-cell"},[i("div",{staticClass:"item-title fx-ellipsis"},[t._v("订货仓库:")]),i("div",{staticClass:"item-select"},[i("div",{staticClass:"unit-text",on:{click:function(e){return t.onEmitClick("on-house-click")}}},[i("span",{staticClass:"item-num"}),i("span",{staticClass:"fx-ellipsis cell-house"},[t._v(t._s(t.itemData.house.name))]),i("van-icon",{staticClass:"unit-icon",attrs:{name:"arrow"}})],1)])])])])},B=[],R={name:"goodsInfoCell",props:{itemData:{type:Object,default:function(){return{}}},isDisabled:Boolean,showEditBtn:{type:Boolean,default:function(){return!0}}},computed:{comptedItemImgSrc:function(t){return function(t){return null===t?"":t[0]}}},data:function(){return{isHasGoods:!1}},methods:{onEmitClick:function(t){this.$emit(t,this.itemData)},editItem:function(){this.itemData.id&&this.$set(this.itemData,"changeType","edit")}}},O=R,T=(i("4fa1"),i("2877")),_=Object(T["a"])(O,F,B,!1,null,"d9376a30",null),N=_.exports,U=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"itemRowEdit-popup"},[i("w-header",{attrs:{title:t.currentItemData.goods.name+"-"+t.currentItemData.unit.name,leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{ref:"rowEditContent",staticClass:"itemRowEdit-content"},[i("van-cell-group",t._l(t.currentItemData.details,function(e,n){return i("div",{directives:[{name:"show",rawName:"v-show",value:"del"!==e.changeType,expression:"item.changeType !== 'del'"}],key:""+n,ref:"count-"+n,refInFor:!0,class:{"is-active":t.rowActive===n}},[i("van-cell",{attrs:{title:t.formatterDate(e.reckonDate),"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"系统预估用量",value:e.goodsCount,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"自定义预估用量","input-align":"right","value-class":"info-item-value"},on:{click:function(e){return t.onItemClick(n)}},model:{value:e.customizeCount,callback:function(i){t.$set(e,"customizeCount",i)},expression:"item.customizeCount"}})],1)}),0)],1),i("div",{staticClass:"itemRowEdit-bottom"},[t.isDisabled?t._e():i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onConfirmClick}},[t._v("保存")])],1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.numberKeyboardShow,expression:"numberKeyboardShow"}],staticClass:"details-number-keyboard"},[i("itemNumberKeyboard",{attrs:{title:t.keyboardTitleCompted,amount:t.keyboardAmountCompted,pointSize:t.sysPointSize,intLength:t.numberLength,unit:t.currentItemData.unit.name,unitEdit:!1},on:{change:t.onKeyboardChange,pre:t.onKeyboardPre,next:t.onKeyboardNext,hide:t.onKeyboardHide}})],1)],1)},H=[],K=i("af41"),z={name:"goodsRowEdit",components:{itemNumberKeyboard:K["a"]},props:{visibleFlag:Boolean,itemData:{type:Object,default:function(){return{}}},isDisabled:Boolean},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},currentItemData:{},numberKeyboardShow:!1,rowActive:""}},computed:Object(g["a"])({},Object(C["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",maxAmount:"maxAmount"}),{formatterDate:function(t){var e=this;return function(t){return"number"===typeof t?e.$fxUtils.setDate(new Date(t)):""}},keyboardTitleCompted:function(){if(""!==this.rowActive&&this.currentItemData.details){var t=this.currentItemData.details[this.rowActive];return this.formatterDate(t.reckonDate)}return""},keyboardAmountCompted:function(){if(""!==this.rowActive&&this.currentItemData.details){var t=this.currentItemData.details[this.rowActive];return t.customizeCount}return"0"}}),watch:{visibleFlag:{handler:function(t){if(t){this.numberKeyboardShow=!1,this.rowActive="";var e=JSON.parse(u()(this.itemData));this.currentItemData=e,this.currentItemData.details.sort(function(t,e){return t.reckonDate-e.reckonDate})}},immediate:!0},rowActive:function(t,e){if(!this.currentItemData.details)return!0;""!==e?(this.currentItemData.details[e].customizeCount=s()(this.currentItemData.details[e].customizeCount),""===t?this.numberKeyboardShow=!1:this.scrollToActive(t)):this.scrollToActive(t)}},methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onConfirmClick:function(){this.numberKeyboardShow=!1,this.rowActive="",this.$emit("on-Confirm",this.currentItemData),this.$emit("update:visibleFlag",!1)},onCountChange:function(t){t.changeType="edit"},onCountBlur:function(t){this.$refs["count-".concat(t.reckonDate)][0].setFocus()},onCheckMoneyOrAmount:function(t){var e=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new m.a(function(n,o){var a="不符合规则";t.customizeCount<=0?e.$nextTick(function(){if(i){var t="数量必须大于0！";e.$fxNotify.fail(t)}o(a)}):n()})},onItemClick:function(t){if(this.isDisabled)return!1;this.rowActive=t,this.numberKeyboardShow=!0},onKeyboardChange:function(t){var e=this.currentItemData.details[this.rowActive];e.customizeCount=t,e.id&&(e.changeType="edit")},onKeyboardPre:function(){if(!this.rowActive)return!1;this.rowActive--},onKeyboardNext:function(){if(""===this.rowActive||this.rowActive===this.currentItemData.details.length-1)return!1;this.rowActive++},onKeyboardHide:function(){this.rowActive=""},scrollToActive:function(t){var e=this;this.$nextTick(function(){e.onSelectLetter(t,20)})},onSelectLetter:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40,i=this.$refs["count-".concat(t)];if(!i||0===i.length)return!1;var n=i[0].offsetTop-5,o=this.$refs["rowEditContent"];this.$fxUtils.scrollTopW({offsetTop:n,$el:o,distance:e})}}},j=z,M=(i("a276"),Object(T["a"])(j,U,H,!1,null,"12103c2c",null)),q=M.exports,G=i("01db"),J=i("0f38"),W={name:"goodsListPop",components:{headEditBtn:A["a"],headSelectAllBtn:L["a"],itemInfoCell:N,itemRowEditPop:q,searchHead:G["a"],checkBox:J["a"],filterListPopup:S["a"]},props:{data:{type:Array,default:function(){return[]}},shopId:{type:String,default:""},billId:{type:String,default:""},visibleFlag:Boolean},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",itemRowEditPopShow:!1,itemEditRowData:{},scanActionShow:!1,scanActions:[{name:"累加数量"},{name:"覆盖数量"}],scanStoreItem:{},orderEditFlag:!1,housePopShow:!1,batchHousePopShow:!1}},watch:{visibleFlag:{handler:function(t){var e=this;t&&(this.searchKey="",this.setDetailGoodsUUid(this.data),this.data.forEach(function(t){t.totalCustomizeCount=e.$fxUtils.toFixedParseNumber(t.details.reduce(function(t,i){return t+e.$fxUtils.toFixedParseNumber(i.customizeCount,e.sysPointSize)},0),e.sysPointSize),t.totalGoodsCount=e.$fxUtils.toFixedParseNumber(t.details.reduce(function(t,i){return t+e.$fxUtils.toFixedParseNumber(i.goodsCount,e.sysPointSize)},0),e.sysPointSize)}))},immediate:!0}},computed:Object(g["a"])({},Object(C["c"])({sysPointSize:"sysPointSize",sysMoneyPointSize:"sysMoneyPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{isSelectAll:function(){var t=this.detailFilter(this.data).length,e=this.detailFilter(this.data).filter(function(t){return t.checked}).length;return 0!==e&&e===t}}),methods:{setDetailGoodsUUid:function(t){var e=this;t.forEach(function(t){t.goodsUUid=e.$fxUtils.createUUID()})},detailFilter:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"code,name,pinYin";return t.filter(function(t){return!!i.split(",").find(function(i){if(t.goods[i].toLowerCase().includes(e.searchKey.toLowerCase()))return!0})})},onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onSearchConfirm:function(){this.$emit("on-search-confirm",this.data),this.$emit("update:visibleFlag",!1)},oncustomizeCountClick:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this;t.totalCustomizeCount=t.details.reduce(function(t,i){return t+e.$fxUtils.toFixedParseNumber(i.customizeCount,e.sysPointSize)},0);var i=this.data.findIndex(function(e){return e.goods.id===t.goods.id});~i&&(this.data[i]=t)},onHouseClick:function(t){this.itemEditRowData=t,this.housePopShow=!0},selectHouse:function(t){var e=this,i=Object(h["a"])(t,1),n=i[0],o=this.data.findIndex(function(t){return t.goods.id===e.itemEditRowData.goods.id});~o&&(this.data[o].details.forEach(function(t){t.house=n,t.changeType="edit"}),this.data[o].house=n,this.data[o].changeType="edit")},getHouseListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,n={keyword:t,start:e,size:i,shopId:this.shopId,goodsId:this.itemEditRowData.goods.id};return this.$fxApi("z5common.selListGoodsByHouse4Food")({data:n}).then(function(t){return t.shops})},onConfirmKey:function(){this.searchKey=""},onSave:function(){var t=this;this.getSaveParams().then(function(e){t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/foodReckonBill/").concat(t.billId),data:e,query:{m:"modifyBillAndDetail",userId:t.loginerId}}).then(function(e){t.$fxToast.success("修改成功").then(function(){t.$emit("update:visibleFlag",!1)})})}).catch(function(){t.$emit("update:visibleFlag",!1)})},getSaveParams:function(){var t=this;return new m.a(function(e,i){var n=[];t.data.forEach(function(t){n.push.apply(n,Object(l["a"])(t.details))});var o=n.filter(function(t){return"edit"===t.changeType});if(!o.length){var a="没有发生改变";return i(a),!1}var s=c()({},t.orderInfoData,{goodsDetailMdf:o,accountDTO:{id:t.loginerId}});e(s)})},onOrderEditClick:function(){this.orderEditFlag=!this.orderEditFlag},onSelectAllClick:function(){var t=this,e=!this.isSelectAll;this.detailFilter(this.data).forEach(function(i){t.$set(i,"checked",e)})},onCheckBoxClick:function(t){this.$set(t,"checked",!t.checked)},onBatchHouse:function(){var t=this.data.filter(function(t){return t.checked});if(!t.length)return this.$fxToast.fail("请选择品项！"),!0;this.batchHousePopShow=!0},selectBatchHouse:function(t){var e=this,i=Object(h["a"])(t,1),n=i[0],o=this.$fxUtils.appointedMap(this.data,function(t,e){if(t.checked)return e});o.length&&o.forEach(function(t){e.data[t].details.forEach(function(t){t.house=n,t.changeType="edit"}),e.data[t].house=n,e.data[t].changeType="edit"}),this.orderEditFlag=!this.orderEditFlag},getBatchHouseListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,n=this.data.filter(function(t){return t.checked});if(n.length){var o=n.map(function(t){return t.goods.id}),a={keyword:t,start:e,size:i,shopId:this.shopId,goodsId:o.join(",")};return this.$fxApi("z5common.selJoinListGoodsByHouse4Food")({data:a}).then(function(t){return t.shops})}}}},V=W,Y=(i("20a3"),Object(T["a"])(V,$,E,!1,null,"82c3f8be",null)),Q=Y.exports,X={name:"foodReckonBillDetails",components:{orderInfo:D["a"],orderItem:w["a"],filterListPopup:S["a"],listComp:y["a"],itemRowEditPop:I["a"],itemSearchPop:x["a"],itemEditComp:P["a"],goodsReckon:Q},data:function(){return{query:this.$route.query,activeNames:["1"],tabActive:"选项1",orderInfoData:{},orderItemList:[],dateType:"business",currentDate:new Date,shopPopShow:!1,datePickerShow:!1,reckonDatePickerShow:!1,itemSearchPopShow:!1,itemRowEditPopShow:!1,itemEditRowData:{},itemInputFocusing:!1,orderDeleteFlag:!1,formatterSysPointKey:["foodCount"],searchItem:[],goodsReckonData:[],parentStoreItem:[],addDetailDate:null,itemPopShow:!1,formatterReckonDays:[],reckonDaysPopShow:!1,goodsReckonPopShow:!1}},created:function(){this.createOrderDetails()},beforeRouteLeave:function(t,e,i){var n=this;if(this.itemInputFocusing)return this.$router.go(1),!1;"/foodReckonBill"!==t.path||this.orderDeleteFlag||0!==this.orderInfoData.billState?i():this.$dialog.confirm({title:"提示",message:"若已修改,请先保存单据<br/>是否关闭页面?"}).then(function(){i()}).catch(function(){return n.$router.go(1),!1})},computed:Object(g["a"])({},Object(C["c"])({sysPointSize:"sysPointSize",sysMoneyPointSize:"sysMoneyPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{isBillState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.billState):e.orderInfoData.billState===t}},isAutoType:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.autoType):e.orderInfoData.autoType===t}},reckonDays:function(){var t=this;return function(){var e=[];return t.orderItemList.forEach(function(t){t.details.forEach(function(t){"del"!==t.changeType&&e.push(t.reckonDate)})}),e=b()(new v.a(e)),e.sort(function(t,e){return t-e}),e}}}),methods:{createOrderDetails:function(){var t=this;return new m.a(function(e){t.getOrderDetails().then(function(i){var n=i.storeBills[0];t.formatterSysPoint(n.details),t.orderInfoData=n,t.orderItemList=t.filterStoreItem(n.details),e()})})},getOrderDetails:function(){var t=this;return new m.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/foodReckonBill/").concat(t.query.orderId)}).then(function(t){e(t)})})},formatterSysPoint:function(t){var e=this;t.details&&t.details.forEach(function(t){e.formatterSysPointKey.forEach(function(i){t[i]=e.toFixedNumberSize(t[i],e.sysPointSize)})})},filterStoreItem:function(t){var e=this;return t.forEach(function(t){t.totalFoodCount=e.toFixedNumberSize(t.details.reduce(function(t,i){return t+e.toFixedNumberSize(i.foodCount)},0))}),t},clearItemConfim:function(t){var e=this;return new m.a(function(i){var n=e.orderItemList.filter(function(t){var e=t.details.filter(function(t){return"del"!==t.changeType});return 0!==e.length});0===n.length?i():e.$dialog.confirm({title:"提示",message:t}).then(function(){e.onItemClear(),i()}).catch(function(){})})},onShopClick:function(){this.shopPopShow=!0},selectShop:function(t){var e=this,i=Object(h["a"])(t,1),n=i[0];this.checkShop(n).then(function(){e.clearItemConfim("切换门店将清空菜品预估数据，是否继续?").then(function(){e.orderInfoData.shopDTO=n})})},checkShop:function(t){var e=this;return new m.a(function(i){var n=e.orderInfoData.shopDTO;n.id!==t.id&&i()})},getShopListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,n={keyword:t,start:e,size:i};return this.$fxApi("z5common.getListShop4ExceptPS")({data:n}).then(function(t){return t.shops})},onReckonDaysClick:function(){var t=this,e=this.reckonDays();if(!e.length)return!1;this.formatterReckonDays=e.map(function(e){return{id:"",name:t.$fxUtils.setDate(new Date(e))}}),this.reckonDaysPopShow=!0},onBusinessDateClick:function(){this.dateType="business",this.orderInfoData.businessDate&&(this.currentDate=new Date(this.orderInfoData.businessDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){var e=t.getTime();this.datePickerShow=!1,"business"===this.dateType&&(this.orderInfoData.businessDate=e)},reckonDateConfirmhandle:function(t){if("addDetail"===this.dateType){this.reckonDatePickerShow=!1;var e=this.$fxUtils.getCustomerDateAndTime(t,"00:00").getTime();if(e<this.$fxUtils.getCustomerDateAndTime(new Date,"00:00").getTime())return this.$fxToast.top("只能预估当日及以后的日期!"),!1;this.addDetailDate=e,this.parentStoreItem=this.getStoreItem(),this.itemPopShow=!0}},onAddClick:function(){var t=this;this.checkOrderInfo().then(function(){t.dateType="addDetail",t.addDetailDate&&(t.currentDate=new Date(t.addDetailDate)),t.reckonDatePickerShow=!0})},checkOrderInfo:function(){var t=this;return new m.a(function(e,i){t.orderInfoData.businessDate?t.orderInfoData.shopDTO.id?e():t.$fxToast.top("请先选择门店!"):t.$fxToast.top("请先选择业务日期!")})},onSearchClick:function(){this.itemSearchPopShow=!0,this.searchItem=JSON.parse(u()(this.orderItemList))},onSaveClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要保存该单据吗?"}).then(function(){t.checkHasDetails().then(function(){t.saveHandler().then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success(e.message)})})})}).catch(function(){})},saveHandler:function(t){var e=this;return new m.a(function(i){var n=e.getSaveParams(),o={url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/foodReckonBill"),data:n};t&&(o.query={tocheck:1}),e.$fxHttp.requestPost(o).then(function(t){i(t)})})},onExpressClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要审核该单据吗?"}).then(function(){t.expressHandler()})},expressHandler:function(){var t=this;this.checkHasDetails().then(function(){t.saveHandler(1).then(function(e){var i=t.getSaveParams();t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/foodReckonBill/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:i,query:{m:"editAndCheck",tocheck:1}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("审核成功")})}).catch(function(e){"1"===e.errorCode&&t.createOrderDetails()})})})},onUnExpressClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要反审该单据吗?"}).then(function(){t.checkHasDetails().then(function(){var e=t.getSaveParams();t.unExpressHandler(e)})}).catch(function(){})},unExpressHandler:function(t){var e=this;this.$fxHttp.requestPut({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/foodReckonBill/").concat(this.query.orderId),data:t,query:{userId:this.loginerId,m:"unCheck"}}).then(function(t){e.createOrderDetails().then(function(){e.$fxToast.success("反审成功")})})},onCreateShopOrderClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要生成门店订货单吗?"}).then(function(){t.checkHasDetails().then(function(){var e=t.getSaveParams();t.createShopOrderHandler(e)})}).catch(function(){})},createShopOrderHandler:function(t){var e=this;this.$fxHttp.requestPut({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/foodReckonBill/").concat(this.query.orderId),data:t,query:{userId:this.loginerId,m:"generateOrderBill"}}).then(function(t){e.createOrderDetails().then(function(){e.$fxToast.success("生成门店订货单成功")})})},onDeleteClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要删除该单据吗?"}).then(function(){var e=t.getSaveParams();t.$fxHttp.requestDel({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/foodReckonBill/").concat(t.query.orderId),data:e,query:{userId:t.loginerId}}).then(function(e){t.$fxToast.success({message:"删除成功",mask:!0}).then(function(){t.orderDeleteFlag=!0,t.$router.go(-1)})})}).catch(function(){})},getSaveParams:function(){var t=[];this.orderItemList.forEach(function(e){t.push.apply(t,Object(l["a"])(e.details))});var e=t.filter(function(t){return"add"===t.changeType}),i=t.filter(function(t){return"del"===t.changeType}),n=t.filter(function(t){return"edit"===t.changeType}),o=c()({},this.orderInfoData,{detailAdd:e.length>0?e:null,detailDel:i.length>0?i:null,detailMdf:n.length>0?n:null,details:[],accountDTO:{id:this.loginerId}});return o},getValidItem:function(){var t=[];return this.orderItemList.forEach(function(e){t.push.apply(t,Object(l["a"])(e.details))}),t.filter(function(t){return"del"!==t.changeType})},getItemLength:function(){return this.getValidItem().length},checkHasDetails:function(){var t=this;return new m.a(function(e){0===t.getItemLength()?t.$fxToast.fail("单据明细不能为空"):e()})},onGoodsReckonClick:function(){var t=this;this.getGoodsReckonList().then(function(e){t.goodsReckonPopShow=!0,t.goodsReckonData=e.foodDTOData})},getGoodsReckonList:function(){var t=this;return new m.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/foodReckonBill/").concat(t.query.orderId),data:{m:"goodsDetailByPage"}}).then(function(t){e(t)})})},onItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},toFixedNumberSize:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sysMoneyPointSize;return s()(this.$fxUtils.toFixedSHW(t,e))},onEditRowConfirm:function(t){var e=this;t.totalFoodCount=this.toFixedNumberSize(t.details.reduce(function(t,i){return t+e.toFixedNumberSize(i.foodCount)},0));var i=this.orderItemList.findIndex(function(e){return e.foodUnitId===t.foodUnitId});~i&&(this.orderItemList[i]=t)},onItemClear:function(){this.orderInfoData.details.forEach(function(t){var e=t.details.filter(function(t){return!!t.id});e.forEach(function(t){t.changeType="del"}),t.details=e}),this.orderItemList=JSON.parse(u()(this.filterStoreItem(this.orderInfoData.details)))},onClickHandler:function(t){if(this.itemInputFocusing)return!1;this[t]()},onSearchConfirm:function(t){this.orderItemList=t},getStoreItem:function(){var t=this,e=[];return this.orderItemList.forEach(function(i){var n=i.details.filter(function(e){return e.reckonDate===t.addDetailDate});e.push.apply(e,Object(l["a"])(n))}),e},onItemEditConfirm:function(t){var e=this,i=Object(h["a"])(t,1),n=i[0];n.length&&n.forEach(function(t){t.reckonDate=e.addDetailDate;var i=e.orderItemList.find(function(e){return t.foodUnitId===e.foodUnitId});if(i){var n=i.details.findIndex(function(t){return t.reckonDate&&t.reckonDate===e.addDetailDate});~n?"add"===t.changeType||"edit"===t.changeType?i.details[n]=t:"del"===t.changeType&&(i.details[n].id?i.details[n]=t:i.details.splice(n,1)):i.details.push(t),e.sumCount(i)}else{var o=JSON.parse(u()(t));o.totalFoodCount=t.foodCount,o.details=[t],e.orderItemList.push(o)}})},sumCount:function(t){var e=this;t.totalFoodCount=t.details.reduce(function(t,i){var n="del"!==i.changeType?i.foodCount:0;return t+e.$fxUtils.toFixedParseNumber(n,e.sysPointSize)},0);var i=this.orderItemList.findIndex(function(e){return t.foodUnitId===e.foodUnitId});if(!~i)return!1;var n=this.orderItemList[i].details&&this.orderItemList[i].details.filter(function(t){return"del"===t.changeType&&!t.id}).length>0;n?this.orderItemList.splice(i,1):this.orderItemList.splice(i,1,t)}}},Z=X,tt=(i("b4d5"),Object(T["a"])(Z,n,o,!1,null,"be876764",null));e["default"]=tt.exports},add7:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-foodReckon"},[i("w-header",{attrs:{title:"菜品预估单",border:!0}},[i("headEditBtn",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("foodReckonBill.check"),expression:"$fxAuth('foodReckonBill.check')"}],attrs:{slot:"header-right",active:t.orderEditFlag},on:{click:t.onOrderEditClick},slot:"header-right"}),i("headSearchBtn",{directives:[{name:"show",rawName:"v-show",value:!t.orderEditFlag,expression:"!orderEditFlag"}],attrs:{slot:"header-right"},on:{click:t.onSearchClick},slot:"header-right"}),i("headSelectAllBtn",{directives:[{name:"show",rawName:"v-show",value:t.orderEditFlag,expression:"orderEditFlag"}],attrs:{slot:"header-right",active:t.isSelectAll},on:{click:t.onSelectAllClick},slot:"header-right"})],1),i("filterTab",{attrs:{state:t.computedState,hasOrder:t.computedHasOrder},on:{"on-state-click":t.onStateClick,"on-hasOrder-click":t.onHasOrderClick}}),i("div",{staticClass:"foodReckon-content"},[i("van-pull-refresh",{directives:[{name:"show",rawName:"v-show",value:0!==t.orderList.length,expression:"orderList.length !== 0"}],staticClass:"foodReckon-list",on:{refresh:t.onPullRefresh},model:{value:t.pullRefreshLoading,callback:function(e){t.pullRefreshLoading=e},expression:"pullRefreshLoading"}},[i("van-list",{attrs:{finished:t.loadFinished,"finished-text":"没有更多了",error:t.listError,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.listError=e},load:t.onLoadMore},model:{value:t.listLoading,callback:function(e){t.listLoading=e},expression:"listLoading"}},t._l(t.orderList,function(e){return i("orderBlock",{directives:[{name:"show",rawName:"v-show",value:t.computedShowOrder(e.billState),expression:"computedShowOrder(item.billState)"}],key:e.id,attrs:{data:e,showCheckBox:t.orderEditFlag},on:{"on-click":function(i){return t.onClickOrder(e)}}})}),1)],1),i("emptyBill",{directives:[{name:"show",rawName:"v-show",value:0===t.orderList.length,expression:"orderList.length === 0"}]})],1),i("div",{staticClass:"foodReckon-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.orderEditFlag&&t.$fxAuth("foodReckonBill.add"),expression:"!orderEditFlag && $fxAuth('foodReckonBill.add')"}],staticClass:"add-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onCreateClick}},[t._v("添加单据")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.orderEditFlag&&t.$fxAuth("foodReckonBill.check"),expression:"orderEditFlag && $fxAuth('foodReckonBill.check')"}],staticClass:"add-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onExpressClick}},[t._v("批量审核")])],1),i("van-actionsheet",{attrs:{actions:t.stateActions,"cancel-text":"取消"},on:{select:t.onStateSelect},model:{value:t.stateActionShow,callback:function(e){t.stateActionShow=e},expression:"stateActionShow"}}),i("van-actionsheet",{attrs:{actions:t.hasOrderActions,"cancel-text":"取消"},on:{select:t.onHasOrderSelect},model:{value:t.hasOrderActionShow,callback:function(e){t.hasOrderActionShow=e},expression:"hasOrderActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.filterPopShow,callback:function(e){t.filterPopShow=e},expression:"filterPopShow"}},[i("filterPop",{attrs:{visibleFlag:t.filterPopShow,filterParams:t.filterParams},on:{"update:visibleFlag":function(e){t.filterPopShow=e},"update:visible-flag":function(e){t.filterPopShow=e},"update:filterParams":function(e){t.filterParams=e},"update:filter-params":function(e){t.filterParams=e},"on-confirm":t.onFilterConfirm}})],1)],1)},o=[],a=(i("ac6a"),i("75fc")),s=i("5176"),r=i.n(s),c=i("795b"),l=i.n(c),d=(i("7514"),i("7f7f"),i("cebc")),u=(i("6762"),i("2f62")),h=i("b215"),f=i("46aa"),m=i("a0be"),p=i("4102"),v=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-block fx-shadow-block",on:{click:t.onClick}},[i("checkBox",{staticClass:"order-checkbox",attrs:{visibleFlag:t.showCheckBox,checked:t.data.checked},on:{"on-checkbox-click":t.onClick}}),i("div",{staticClass:"block-content"},[i("div",{staticClass:"block-title"},[i("i",{staticClass:"block-icon"}),i("span",{staticClass:"title-text"},[t._v(t._s(t.data.shopDTO.name))]),i("stateTag",{staticClass:"state-tag",attrs:{billState:t.data.billState,reCheckState:t.data.billReState}})],1),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No"},[i("span",[t._v(t._s(t.data.undownBillDTOS.length?t.data.undownBillDTOS[0].sysBillCode:""))])]),i("div",{staticClass:"order-date"},[i("span",[t._v("预估天数：")]),i("span",[t._v(t._s(t.data.reckonDateCount))])])]),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No"},[i("span",[t._v(t._s(t.data.sysbillCode))])]),i("div",{staticClass:"order-date"},[i("span",[t._v("创建时间：")]),i("span",[t._v(t._s(t._f("filterDateYMD")(t.data.billDate)))]),i("van-icon",{staticClass:"order-date-arrow",attrs:{name:"arrow"}})],1)])])],1)},k=[],b=i("0f38"),g=i("0b26"),C={name:"orderBlock",components:{stateTag:g["a"],checkBox:b["a"]},props:{data:{type:Object,default:function(){return{}}},showCheckBox:{type:Boolean,default:!1}},computed:{},methods:{onClick:function(){this.showCheckBox?this.$set(this.data,"checked",!this.data.checked):this.$emit("on-click",this.data)}}},D=C,w=(i("2f77"),i("2877")),S=Object(w["a"])(D,v,k,!1,null,"1bddba76",null),y=S.exports,I=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"filter-popup"},[i("w-header",{attrs:{title:"筛选条件",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{ref:"filterContent",staticClass:"filter-content"},[i("van-cell-group",[i("van-cell",{attrs:{title:"创建日期"}}),i("van-cell",{attrs:{title:"起始时间",value:t.beginDate,"is-link":""},on:{click:t.onBeginDateClick}}),i("van-cell",{attrs:{title:"结束时间",value:t.endDate,"is-link":""},on:{click:t.onEndDateClick}}),i("van-cell",{attrs:{title:"预估日期"}}),i("van-cell",{attrs:{title:"起始时间",value:t.beginReckonDate,"is-link":""},on:{click:t.onBeginReckonDateClick}}),i("van-cell",{attrs:{title:"结束时间",value:t.endReckonDate,"is-link":""},on:{click:t.onEndReckonDateClick}}),i("van-cell",{attrs:{title:"门店",value:t.shop.name,"value-class":"info-item-value","is-link":""},on:{click:t.onShopClick}}),i("van-field",{ref:"billNo",attrs:{label:"系统单号","value-class":"info-item-value",placeholder:"请输入系统单号","input-align":"right"},model:{value:t.billNo,callback:function(e){t.billNo=e},expression:"billNo"}})],1)],1),i("div",{staticClass:"filter-bottom"},[i("van-button",{staticClass:"reset-btn fx-no-radius",attrs:{type:"info"},on:{click:t.onResetClick}},[t._v("重置")]),i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onConfirmClick}},[t._v("确定")])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("filterListPopup",{attrs:{title:"门店检索",rollingLoad:!0,getDataApi:t.getShopListData},on:{"on-select":function(e){return t.selectShop(arguments)}},model:{value:t.shopPopShow,callback:function(e){t.shopPopShow=e},expression:"shopPopShow"}})],1)},x=[],P=i("768b"),$=i("eb03"),E={name:"FilterPop",components:{filterListPopup:$["a"]},props:{visibleFlag:Boolean,filterParams:{type:Object,default:function(){return{}}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},currentDate:new Date,datePickerShow:!1,beginDate:this.$fxCommon.orderFilterStartDate(),endDate:this.$fxCommon.orderFilterEndDate(),beginReckonDate:this.$fxCommon.orderFilterStartDate(),endReckonDate:this.$fxCommon.orderFilterEndDate(),shop:{name:"请选择"},shopPopShow:!1,searchGoodsKeyword:"",billNo:""}},watch:{visibleFlag:{handler:function(t){t&&this.$fxUtils.isEmptyObjSHW(this.filterParams)&&this.resetHandler()},immediate:!0}},computed:Object(d["a"])({},Object(u["c"])({loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}})),methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onBeginDateClick:function(){this.datePickerShow=!0,this.beginDate&&(this.currentDate=new Date(this.beginDate)),this.dateType="begin"},onEndDateClick:function(){this.datePickerShow=!0,this.endDate&&(this.currentDate=new Date(this.endDate)),this.dateType="end"},onBeginReckonDateClick:function(){this.datePickerShow=!0,this.beginReckonDate&&(this.currentDate=new Date(this.beginReckonDate)),this.dateType="beginReckon"},onEndReckonDateClick:function(){this.datePickerShow=!0,this.endReckonDate&&(this.currentDate=new Date(this.endReckonDate)),this.dateType="endReckon"},dateConfirmhandle:function(t){"begin"===this.dateType?(this.beginDate=this.$fxUtils.setDateTime(t,"时分"),this.endDate&&this.$fxCommon.orderFilterRangeDate(this.beginDate,this.endDate)||(this.endDate=this.$fxCommon.orderFilterDate(t))):"end"===this.dateType?(this.endDate=this.$fxUtils.setDateTime(t,"时分"),this.beginDate&&this.$fxCommon.orderFilterRangeDate(this.beginDate,this.endDate)||(this.beginDate=this.$fxCommon.orderFilterStartDate(t))):"beginReckon"===this.dateType?(this.beginReckonDate=this.$fxUtils.setDateTime(t,"时分"),this.endReckonDate&&this.$fxCommon.orderFilterRangeDate(this.beginReckonDate,this.endReckonDate)||(this.endReckonDate=this.$fxCommon.orderFilterDate(t))):"endReckon"===this.dateType&&(this.endReckonDate=this.$fxUtils.setDateTime(t,"时分"),this.beginReckonDate&&this.$fxCommon.orderFilterRangeDate(this.beginReckonDate,this.endReckonDate)||(this.beginReckonDate=this.$fxCommon.orderFilterStartDate(t))),this.datePickerShow=!1},onShopClick:function(){this.shopPopShow=!0},selectShop:function(t){var e=Object(P["a"])(t,1),i=e[0];this.shop=i},getShopListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,n={keyword:t,start:e,size:i};return this.$fxApi("z5common.getListShop4ExceptPS")({data:n}).then(function(t){return t.shops})},onResetClick:function(){this.resetHandler()},resetHandler:function(){this.beginDate=this.$fxCommon.orderFilterStartDate(),this.endDate=this.$fxCommon.orderFilterEndDate(),this.beginReckonDate=this.$fxCommon.orderFilterStartDate(),this.endReckonDate=this.$fxCommon.orderFilterEndDate(),this.billNo="",this.shop={name:"请选择"}},onConfirmClick:function(){this.$emit("update:visibleFlag",!1),this.$emit("update:filterParams",this.getFilterParams()),this.$emit("on-confirm",this.getFilterParams())},getFilterParams:function(){return{beginDate:this.beginDate||this.$fxCommon.orderFilterStartDate(),endDate:this.endDate||this.$fxCommon.orderFilterEndDate(),beginReckonDate:this.beginReckonDate||this.$fxCommon.orderFilterStartDate(),endReckonDate:this.endReckonDate||this.$fxCommon.orderFilterEndDate(),shopId:this.shop.id,billNo:this.billNo}},onFocus:function(t){this.onScrollTop(t)},onScrollTop:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,i=this.$refs[t];if(!i||0===i.length)return!1;var n=i.$el.offsetTop,o=this.$refs["filterContent"];this.$fxUtils.scrollTopW({offsetTop:n,$el:o,distance:e})}}},A=E,L=(i("3fa0"),Object(w["a"])(A,I,x,!1,null,"f2494470",null)),F=L.exports,B=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"foodReckon-filter fx-shadow-down"},[i("div",{staticClass:"filter-item",on:{click:t.onStateClick}},[i("span",[t._v("审核状态")]),i("van-icon",{staticClass:"filter-arrow",attrs:{name:"arrow-down"}}),i("span",[t._v(t._s(t.state))])],1),i("div",{staticClass:"filter-item",on:{click:t.onHasOrderClick}},[i("span",[t._v("已生成订货单")]),i("van-icon",{staticClass:"filter-arrow",attrs:{name:"arrow-down"}}),i("span",[t._v(t._s(t.hasOrder))])],1)])},R=[],O={name:"filterTab",props:{state:String,hasOrder:String},methods:{onStateClick:function(){this.$emit("on-state-click")},onHasOrderClick:function(){this.$emit("on-hasOrder-click")}}},T=O,_=(i("8ae6"),Object(w["a"])(T,B,R,!1,null,"61c45c42",null)),N=_.exports,U=50,H={name:"foodReckonBill",components:{headSearchBtn:h["a"],headEditBtn:f["a"],headSelectAllBtn:m["a"],emptyBill:p["a"],orderBlock:y,filterPop:F,filterTab:N},data:function(){return{orderList:[],filterPopShow:!1,filterState:null,stateActionShow:!1,stateActions:[{id:null,name:"全部"},{id:"0",name:"未审核"},{id:"1",name:"已审核"}],filterHasOrder:null,hasOrderActionShow:!1,hasOrderActions:[{id:null,name:"全部"},{id:"1",name:"是"},{id:"0",name:"否"}],listStart:0,pullRefreshLoading:!1,listLoading:!1,loadFinished:!0,listError:!1,orderEditFlag:!1,filterParams:{}}},beforeRouteLeave:function(t,e,i){if("/login"===t.path)i();else{if(this.filterPopShow)return this.filterPopShow=!1,this.$router.go(1),!1;i()}},beforeRouteEnter:function(t,e,i){var n=["/main/home","/"],o=["/foodReckonBillDetails"];n.includes(e.path)?i(function(e){e.restFilterParams(),e.restRouterParams(t.params),e.refreshOrderList()}):o.includes(e.path)?i(function(t){t.refreshOrderList()}):i()},computed:Object(d["a"])({},Object(u["c"])({billListPostParams:"billListPostParams",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{computedState:function(){var t=this;return this.stateActions.find(function(e){return e.id===t.filterState}).name},computedHasOrder:function(){var t=this;return this.hasOrderActions.find(function(e){return e.id===t.filterHasOrder}).name},computedShowOrder:function(t){var e=this;return function(t){return!e.orderEditFlag||1!==t}},isSelectAll:function(){var t=this.orderList.filter(function(t){return 1!==t.billState});if(0===t.length)return!1;var e=t.filter(function(t){return!!t.checked});return e.length===t.length}}),methods:{orderListPostHandler:function(t){var e=this;return new l.a(function(i){e.$store.commit({type:"SETSTATE",billListPostParams:t}),e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/foodReckonBill/users/").concat(e.loginerId),data:t}).then(function(t){i(t)})})},refreshOrderList:function(){var t=this;return new l.a(function(e){t.listStart=0;var i={start:t.listStart,size:U,paged:!0,createDateStart:t.$fxCommon.orderFilterStartDate(),createateEnd:t.$fxCommon.orderFilterEndDate(),reckonDateStart:t.$fxCommon.orderFilterStartDate(),reckonDateEnd:t.$fxCommon.orderFilterEndDate(),billState:t.filterState,hasOrder:t.filterHasOrder};i=r()(i,t.translateFilterParams(t.filterParams)),t.orderListPostHandler(i).then(function(i){t.orderList=i.storeBills,e(i)})})},onFilterConfirm:function(t){var e=this;this.listStart=0;var i={start:this.listStart,size:U,paged:!0,createDateStart:t.beginDate,createateEnd:t.endDate,reckonDateStart:t.beginReckonDate,reckonDateEnd:t.endReckonDate,sysBillCode:""===t.billNo?null:t.billNo,billState:this.filterState,hasOrder:this.filterHasOrder,shopId:""===t.shopId?null:t.shopId};this.orderListPostHandler(i).then(function(t){e.orderList=t.storeBills})},translateFilterParams:function(t){return this.$fxUtils.isEmptyObjSHW(t)?{}:{createDateStart:t.beginDate,createateEnd:t.endDate,reckonDateStart:t.beginReckonDate,reckonDateEnd:t.endReckonDate,sysBillCode:""===t.billNo?null:t.billNo,shopId:""===t.shopId?null:t.shopId}},onPullRefresh:function(){var t=this;this.refreshOrderList().then(function(e){t.pullRefreshLoading=!1})},onLoadMore:function(){var t=this,e=r()(this.billListPostParams,{start:this.listStart});this.orderListPostHandler(e).then(function(e){var i;(i=t.orderList).push.apply(i,Object(a["a"])(e.storeBills))})},onSearchClick:function(){this.filterPopShow=!0},onStateClick:function(){this.stateActionShow=!0},onStateSelect:function(t){this.filterState=t.id,this.stateActionShow=!1,this.refreshOrderList()},onHasOrderClick:function(){this.hasOrderActionShow=!0},onHasOrderSelect:function(t){this.filterHasOrder=t.id,this.hasOrderActionShow=!1,this.refreshOrderList()},onClickOrder:function(t){this.$router.push({path:"foodReckonBillDetails",query:{orderId:t.id}})},onCreateClick:function(){this.$router.push("createFoodReckonBill")},onOrderEditClick:function(){this.orderEditFlag=!this.orderEditFlag},onExpressClick:function(){var t=this,e=this.orderList.reduce(function(t,e){var i=e.checked?t.concat(e.id):t;return i},[]);if(0===e.length)return!1;this.$dialog.confirm({title:"提示",message:"确定要审核所选单据?"}).then(function(){t.expressBillList()})},expressBillList:function(){var t=this,e=this.orderList.reduce(function(t,e){var i=e.checked?t.concat(e.id):t;return i},[]);if(0===e.length)return!1;this.expressHandler(e).then(function(e){t.orderEditFlag=!t.orderEditFlag,t.refreshOrderList().then(function(){t.$fxToast.success(e.message)})}).catch(function(){t.refreshOrderList()})},expressHandler:function(t){var e=this;return new l.a(function(i,n){e.$fxHttp.requestPut({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/foodReckonBill/users/").concat(e.loginerId),data:t,query:{m:"batchCheck"}}).then(function(t){i(t)}).catch(function(t){n(t)})})},onSelectAllClick:function(){var t=this,e=!this.isSelectAll;this.orderList.forEach(function(i){1!==i.billState&&t.$set(i,"checked",e)})},restFilterParams:function(){this.filterParams={},this.filterState=null,this.filterHasOrder=null,this.orderEditFlag=!1},restRouterParams:function(t){this.$fxUtils.isEmptyObjSHW(t)||(this.filterState=t.billState)}}},K=H,z=(i("06c5"),Object(w["a"])(K,n,o,!1,null,"87abe702",null));e["default"]=z.exports},af41:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-number-keyboard fx-shadow-up"},[i("div",{staticClass:"number-keyboard-title"},[i("div",{staticClass:"title-name fx-ellipsis"},[t._v(t._s(t.title))]),i("div",{staticClass:"title-amount"},[t._v(t._s(t.amount))]),i("div",{staticClass:"title-unit",on:{click:t.onUnitClick}},[i("span",{staticClass:"title-unit-text fx-ellipsis"},[t._v(t._s(t.unit))]),i("i",{directives:[{name:"show",rawName:"v-show",value:t.unitEdit,expression:"unitEdit"}],staticClass:"title-unit-select"})])]),i("div",{staticClass:"number-keyboard-content"},[i("div",{staticClass:"keyboard-number"},[i("div",{staticClass:"keyboard-number-row"},[i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("1")}}},[t._v("1")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("2")}}},[t._v("2")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("3")}}},[t._v("3")]),i("i",{staticClass:"keyboard-btn-1 keyboard-btn-hide fx-Pseudo-btn",on:{click:t.hideKeyboardBtnClick}})]),i("div",{staticClass:"keyboard-number-row"},[i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("4")}}},[t._v("4")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("5")}}},[t._v("5")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("6")}}},[t._v("6")]),i("i",{staticClass:"keyboard-btn-1 keyboard-btn-del fx-Pseudo-btn",on:{click:t.delBtnClick}})]),i("div",{staticClass:"keyboard-number-row"},[i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("7")}}},[t._v("7")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("8")}}},[t._v("8")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("9")}}},[t._v("9")]),t.shortcutBtn?i("i",{staticClass:"keyboard-btn-1 keyboard-btn-pre fx-Pseudo-btn",on:{click:t.preBtnClick}},[t._v("上一个")]):i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn"})]),i("div",{staticClass:"keyboard-number-row"},[i("i",{staticClass:"keyboard-btn-2 keyboard-btn-zero fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("0")}}},[t._v("0")]),i("i",{staticClass:"keyboard-btn-1 keyboard-btn-dot fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick(".")}}},[t._v(".")]),t.shortcutBtn?i("i",{staticClass:"keyboard-btn-1 keyboard-btn-next fx-Pseudo-btn",on:{click:t.nextBtnClick}},[t._v("下一个")]):i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn"})])])])])},o=[],a=(i("3b2b"),i("c5f6"),{name:"itemNumberKeyboard",props:{title:String,unit:String,amount:[String,Number],unitEdit:{type:Boolean,default:!1},integer:Boolean,pointSize:{type:[String,Number],default:4},intLength:{type:[String,Number],default:8},shortcutBtn:{type:Boolean,default:!0}},computed:{computedNumberReg:function(){return new RegExp("^\\d+(\\.|\\.\\d{1,".concat(this.pointSize-1,"})?$"))}},methods:{numberBtnClick:function(t){this.$emit("input",t),this.$emit("change",this.getAddValue(t))},delBtnClick:function(t){this.$emit("delete"),this.$emit("change",this.getDelValue(t))},preBtnClick:function(){this.$emit("pre")},nextBtnClick:function(){this.$emit("next")},hideKeyboardBtnClick:function(){this.$emit("hide")},onUnitClick:function(){this.$emit("on-unit-unitEdit")},getAddValue:function(t){var e=this.amount+"";return-1===e.indexOf(".")&&e.length>=this.intLength&&"."!==t||-1!==e.indexOf(".")&&("."===t||!this.computedNumberReg.test(e))||"."===t&&this.integer?e:("0"===e&&"."!==t?e=t:e+=t,e)},getDelValue:function(t){var e=this.amount+"";return"0"===e?e:(e=1===e.length?"0":e.substr(0,e.length-1),e)}}}),s=a,r=(i("95a8"),i("2877")),c=Object(r["a"])(s,n,o,!1,null,"2fae3907",null);e["a"]=c.exports},b409:function(t,e,i){},b4d5:function(t,e,i){"use strict";var n=i("3428"),o=i.n(n);o.a},b8bd:function(t,e,i){},beea:function(t,e,i){"use strict";var n=i("b409"),o=i.n(n);o.a},c7ad:function(t,e,i){"use strict";var n=i("a437"),o=i.n(n);o.a},d00e:function(t,e,i){},d444:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"add-item-class-content fx-vant-class-collapse"},[i("div",{staticClass:"all-class",class:{"is-active":""===t.value},on:{click:function(e){return e.stopPropagation(),t.selectClass("")}}},[t._v(t._s(t.classTitle))]),i("van-collapse",{attrs:{accordion:!0},model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},t._l(t.itemClassList,function(e){return i("van-collapse-item",{key:e.id,attrs:{name:e.id}},[i("div",{staticClass:"big-class",attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),t._l(e.smallType,function(e){return i("van-cell",{key:e.id,staticClass:"small-class",class:{"is-active":t.value===e.id},attrs:{title:e.name},on:{click:function(i){return i.stopPropagation(),t.selectClass(e.id)}}})})],2)}),1)],1)},o=[],a=(i("c5f6"),{name:"addItemClassList",props:{value:[String,Number],itemClassList:{type:Array,default:function(){return[]}},classTitle:{type:String,default:"全部品项"}},data:function(){return{activeNames:[]}},methods:{selectClass:function(t){this.$emit("input",t),this.$emit("on-select-class",t),this.$emit("on-change-class",[t,this.value])}}}),s=a,r=(i("5402"),i("2877")),c=Object(r["a"])(s,n,o,!1,null,"df69e854",null);e["a"]=c.exports},e807:function(t,e,i){},edf1:function(t,e,i){},f064:function(t,e,i){"use strict";var n=i("3aa0"),o=i.n(n);o.a},f2b1:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-info-block fx-shadow-block"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},[i("van-collapse-item",{attrs:{name:"1",disabled:t.collapseDisabled}},[i("div",{staticClass:"info-title",attrs:{slot:"title"},slot:"title"},[i("span",{staticClass:"info-title-name"},[t._v("单据信息")]),i("stateText",{staticClass:"stateTag fl-r",attrs:{billState:t.data.billState}})],1),i("van-tabs",{attrs:{animated:""},model:{value:t.tabActive,callback:function(e){t.tabActive=e},expression:"tabActive"}},[i("van-tab",{attrs:{title:"表头"}},[i("van-cell",{staticClass:"info-item",attrs:{title:"门店","value-class":"info-item-value",value:t.data.shopDTO&&t.data.shopDTO.name,"is-link":!t.isDisabled&&1===t.data.autoType},on:{click:function(e){return t.onEmitClick("on-shop-click")}}}),i("van-cell",{staticClass:"info-item",attrs:{title:"业务日期",value:t.formatterDate(t.data.businessDate),"is-link":!t.isDisabled},on:{click:function(e){return t.onEmitClick("on-busdate-click")}}}),i("van-cell",{staticClass:"info-item",attrs:{title:"预估天数",value:t.reckonDays.length,"is-link":!0},on:{click:t.onReckondaysClick}}),i("van-pro-field",{staticClass:"info-item",attrs:{label:"整单备注",placeholder:t.isDisabled?"":"请输入整单备注","input-align":"right",maxlength:"50",disabled:t.isDisabled},model:{value:t.data.billMemo,callback:function(e){t.$set(t.data,"billMemo",e)},expression:"data.billMemo"}})],1),i("van-tab",{attrs:{title:"更多"}},[i("van-cell",{staticClass:"info-item",attrs:{title:"制单人",value:t.data.billEmp}}),i("van-cell",{staticClass:"info-item",attrs:{title:"制单日期",value:t.formatterDate(t.data.billDate)}}),i("van-cell",{staticClass:"info-item",attrs:{title:"审核人",value:t.data.checkEmp}}),i("van-cell",{staticClass:"info-item",attrs:{title:"审核日期",value:t.formatterDate(t.data.checkDate)}})],1)],1)],1)],1)],1)},o=[],a=i("4760"),s={name:"orderInfo",components:{stateText:a["a"]},props:{data:{type:Object,default:function(){return{}}},reckonDays:{type:Array,default:function(){return[]}},isDisabled:Boolean,collapseDisabled:Boolean},data:function(){return{activeNames:["1"],tabActive:0}},computed:{formatterDate:function(t){var e=this;return function(t){return"number"===typeof t?e.$fxUtils.setDateTime(new Date(t),"时分"):""}}},methods:{onEmitClick:function(t){if(this.isDisabled)return!1;this.$emit(t)},onReckondaysClick:function(){this.$emit("on-reckondays-click")},closeCollapse:function(){this.activeNames=[]}}},r=s,c=(i("beea"),i("2877")),l=Object(c["a"])(r,n,o,!1,null,"d90f6d8e",null);e["a"]=l.exports},fb23:function(t,e,i){},fd54:function(t,e,i){}}]);
//# sourceMappingURL=foodReckonBill.269579f6.js.map