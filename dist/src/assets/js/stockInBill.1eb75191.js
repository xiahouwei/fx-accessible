(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["stockInBill"],{"12a8":function(t,e,i){"use strict";var n=i("cefa"),o=i.n(n);o.a},"166f":function(t,e,i){},"190c":function(t,e,i){"use strict";var n=i("fb5d"),o=i.n(n);o.a},"1d3e":function(t,e,i){},"1db1":function(t,e,i){"use strict";var n=i("f4c8"),o=i.n(n);o.a},2056:function(t,e,i){},2479:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-shopOrder"},[i("w-header",{attrs:{title:"采购入库单",border:!0}},[i("headEditBtn",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopStockInBill.check"),expression:"$fxAuth('shopStockInBill.check')"}],attrs:{slot:"header-right",active:t.orderEditFlag},on:{click:t.onOrderEditClick},slot:"header-right"}),i("headSearchBtn",{directives:[{name:"show",rawName:"v-show",value:!t.orderEditFlag,expression:"!orderEditFlag"}],attrs:{slot:"header-right"},on:{click:t.onSearchClick},slot:"header-right"}),i("headSelectAllBtn",{directives:[{name:"show",rawName:"v-show",value:t.orderEditFlag,expression:"orderEditFlag"}],attrs:{slot:"header-right",active:t.isSelectAll},on:{click:t.onSelectAllClick},slot:"header-right"})],1),i("filterTab",{attrs:{state:t.computedState,reCheckState:t.computedReCheckState},on:{"on-state-click":t.onStateClick,"on-recheckstate-click":t.reCheckStateClick}}),i("div",{staticClass:"shopOrder-content"},[i("van-pull-refresh",{directives:[{name:"show",rawName:"v-show",value:0!==t.orderList.length,expression:"orderList.length !== 0"}],staticClass:"shopOrder-list",on:{refresh:t.onPullRefresh},model:{value:t.pullRefreshLoading,callback:function(e){t.pullRefreshLoading=e},expression:"pullRefreshLoading"}},[i("van-list",{attrs:{finished:t.loadFinished,"finished-text":"没有更多了",error:t.listError,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.listError=e},load:t.onLoadMore},model:{value:t.listLoading,callback:function(e){t.listLoading=e},expression:"listLoading"}},t._l(t.orderList,function(e){return i("orderBlock",{directives:[{name:"show",rawName:"v-show",value:t.computedShowOrder(e.billState),expression:"computedShowOrder(item.billState)"}],key:e.id,attrs:{data:e,showCheckBox:t.orderEditFlag},on:{"on-click":function(i){return t.onClickOrder(e)}}})}),1)],1),i("emptyBill",{directives:[{name:"show",rawName:"v-show",value:0===t.orderList.length,expression:"orderList.length === 0"}]})],1),i("div",{staticClass:"shopOrder-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.orderEditFlag&&t.$fxAuth("shopStockInBill.add"),expression:"!orderEditFlag && $fxAuth('shopStockInBill.add')"}],staticClass:"add-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onCreateClick}},[t._v("添加单据")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.orderEditFlag&&t.$fxAuth("shopStockInBill.check"),expression:"orderEditFlag && $fxAuth('shopStockInBill.check')"}],staticClass:"add-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onExpressClick}},[t._v("批量审核")])],1),i("van-actionsheet",{attrs:{actions:t.stateActions,"cancel-text":"取消"},on:{select:t.onStateSelect},model:{value:t.stateActionShow,callback:function(e){t.stateActionShow=e},expression:"stateActionShow"}}),i("van-actionsheet",{attrs:{actions:t.reCheckStateActions,"cancel-text":"取消"},on:{select:t.onReCheckStateSelect},model:{value:t.reCheckStateActionShow,callback:function(e){t.reCheckStateActionShow=e},expression:"reCheckStateActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.filterPopShow,callback:function(e){t.filterPopShow=e},expression:"filterPopShow"}},[i("filterPop",{attrs:{visibleFlag:t.filterPopShow,filterParams:t.filterParams},on:{"update:visibleFlag":function(e){t.filterPopShow=e},"update:visible-flag":function(e){t.filterPopShow=e},"update:filterParams":function(e){t.filterParams=e},"update:filter-params":function(e){t.filterParams=e},"on-confirm":t.onFilterConfirm}})],1)],1)},o=[],s=(i("ac6a"),i("75fc")),a=i("5176"),r=i.n(a),c=i("795b"),l=i.n(c),u=(i("7514"),i("7f7f"),i("cebc")),d=(i("6762"),i("2f62")),h=i("b215"),p=i("46aa"),f=i("a0be"),m=i("4102"),S=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-block fx-shadow-block",style:t.orderBlockStyle,on:{click:t.onClick}},[i("div",{staticClass:"block-title"},[i("i",{staticClass:"block-icon"}),i("span",{staticClass:"title-text"},[t._v(t._s(t.data.supplierDTO.name))]),i("stateTag",{staticClass:"state-tag",attrs:{billState:t.data.billState}}),i("span",{directives:[{name:"show",rawName:"v-show",value:t.data.difference,expression:"data.difference"}],staticClass:"difference-span"},[t._v("有差异")])],1),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No"},[t._v(t._s(t.data.shopDTO.name))]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopStockInBill.seeWithTaxMoney"),expression:"$fxAuth('shopStockInBill.seeWithTaxMoney')"}],staticClass:"order-date fx-price-font"},[i("span",[t._v("含税金额：")]),i("span",[t._v("￥"+t._s(t.toFixedNumberSize(t.data.taxMoney)))])])]),i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No"},[i("span",[t._v("明细数：")]),i("span",[t._v(t._s(t.data.detailCount))])]),i("div",{staticClass:"order-date"},[i("span",[t._v("业务日期：")]),i("span",[t._v(t._s(t._f("filterDateYMD")(t.data.businessDate)))]),i("van-icon",{staticClass:"order-date-arrow",attrs:{name:"arrow"}})],1)]),t.$fxSysAuth("shopOrderBill.SysShopOrderViewHouses")?i("div",{staticClass:"block-value"},[i("div",{staticClass:"order-No"},[i("span",[t._v(t._s(t.data.houseName))])])]):t._e(),i("checkBox",{staticClass:"order-checkbox",attrs:{visibleFlag:t.showCheckBox,checked:t.data.checked}})],1)},v=[],b=i("59ad"),g=i.n(b),I=i("0f38"),y=i("0b26"),k={name:"orderBlock",components:{stateTag:y["a"],checkBox:I["a"]},props:{data:{type:Object,default:function(){return{}}},showCheckBox:{type:Boolean,default:!1}},computed:Object(u["a"])({},Object(d["c"])({sysPointSize:"sysPointSize"}),{orderBlockStyle:function(){var t=this.showCheckBox?"50px":"15px";return{paddingLeft:t}},toFixedNumberSize:function(t){var e=this;return function(t){return g()(e.$fxUtils.toFixedSHW(t,e.sysPointSize))}}}),methods:{onClick:function(){this.showCheckBox?this.$set(this.data,"checked",!this.data.checked):this.$emit("on-click",this.data)}}},x=k,w=(i("12a8"),i("2877")),C=Object(w["a"])(x,S,v,!1,null,"0054fe08",null),D=C.exports,T=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"filter-popup"},[i("w-header",{attrs:{title:"筛选条件",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{ref:"filterContent",staticClass:"filter-content"},[i("van-cell-group",[i("van-cell",{attrs:{title:"业务日期"}}),i("van-cell",{attrs:{title:"起始时间",value:t.beginDate,"is-link":""},on:{click:t.onBeginDateClick}}),i("van-cell",{attrs:{title:"结束时间",value:t.endDate,"is-link":""},on:{click:t.endDateClick}}),i("van-cell",{attrs:{title:"供货商",value:t.supplier,"value-class":"info-item-value","is-link":""},on:{click:t.onSupplierClick}}),i("van-cell",{attrs:{title:"入库机构",value:t.shop,"value-class":"info-item-value","is-link":""},on:{click:t.onShopClick}}),i("van-cell",{attrs:{title:"仓库",value:t.store,"value-class":"info-item-value","is-link":""},on:{click:t.onStoreClick}}),i("van-cell",{attrs:{title:"品项",value:t.item,"value-class":"info-item-value","is-link":""},on:{click:t.onItemClick}}),i("van-cell",{attrs:{title:"单据类型",value:t.billType,"value-class":"info-item-value"},on:{click:t.onBillTypeClick}},[i("van-icon",{staticClass:"item-clear-btn",attrs:{slot:"right-icon",name:t.billTypeId?"close":"arrow"},on:{click:function(e){e.stopPropagation(),t.billTypeId?t.onBillTypeClearClick():t.onBillTypeClick()}},slot:"right-icon"})],1),i("van-field",{ref:"billNo",attrs:{label:"系统单号","value-class":"info-item-value",placeholder:"请输入系统单号","input-align":"right"},on:{focus:function(e){return t.onFocus("billNo")}},model:{value:t.billNo,callback:function(e){t.billNo=e},expression:"billNo"}})],1)],1),i("div",{staticClass:"filter-bottom"},[i("van-button",{staticClass:"reset-btn fx-no-radius",attrs:{type:"info"},on:{click:t.onResetClick}},[t._v("重置")]),i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onConfirmClick}},[t._v("确定")])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.supplierPopShow,callback:function(e){t.supplierPopShow=e},expression:"supplierPopShow"}},[i("listComp",{attrs:{visibleFlag:t.supplierPopShow,data:t.supplierList,loadFinished:t.supplierListLoadFinished,loading:t.onSupplierLoading,title:"供货商检索"},on:{"update:visibleFlag":function(e){t.supplierPopShow=e},"update:visible-flag":function(e){t.supplierPopShow=e},"update:loading":function(e){t.onSupplierLoading=e},"on-search":t.searchSupplier,"on-select":t.selectSupplier,"on-load":t.onSupplierLoad}})],1),i("filterListPopup",{attrs:{title:"机构检索",rollingLoad:!0,getDataApi:t.getShopListData},on:{"on-select":function(e){return t.selectShop(arguments)}},model:{value:t.shopPopShow,callback:function(e){t.shopPopShow=e},expression:"shopPopShow"}}),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.storePopShow,callback:function(e){t.storePopShow=e},expression:"storePopShow"}},[i("listComp",{attrs:{visibleFlag:t.storePopShow,data:t.storeList,loadFinished:!0,title:"仓库检索"},on:{"update:visibleFlag":function(e){t.storePopShow=e},"update:visible-flag":function(e){t.storePopShow=e},"on-search":t.searchStore,"on-select":t.selectStore}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.itemPopShow,callback:function(e){t.itemPopShow=e},expression:"itemPopShow"}},[i("listComp",{attrs:{visibleFlag:t.itemPopShow,data:t.itemList,loadFinished:t.itemListLoadFinished,loading:t.onItemLoading,title:"品项检索"},on:{"update:visibleFlag":function(e){t.itemPopShow=e},"update:visible-flag":function(e){t.itemPopShow=e},"update:loading":function(e){t.onItemLoading=e},"on-search":t.searchItem,"on-select":t.selectItem,"on-load":t.onItemLoad}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.billTypePopShow,callback:function(e){t.billTypePopShow=e},expression:"billTypePopShow"}},[i("listComp",{attrs:{visibleFlag:t.billTypePopShow,data:t.billTypeList,loadFinished:!0,title:"单据类型检索"},on:{"update:visibleFlag":function(e){t.billTypePopShow=e},"update:visible-flag":function(e){t.billTypePopShow=e},"on-search":t.searchBillType,"on-select":t.selectBillType}})],1)],1)},P=[],F=i("768b"),A=i("f6bb"),B=i("eb03"),$=50,O={name:"filterPop",components:{listComp:A["a"],filterListPopup:B["a"]},props:{visibleFlag:Boolean,filterParams:{type:Object,default:function(){return{}}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},supplierListStart:0,supplierListLoadFinished:!1,onSupplierLoading:!1,supplierPopShow:!1,supplierList:[],supplierKeyword:null,supplier:"请选择",supplierId:"",shopPopShow:!1,shop:"请选择",shopId:"",storeListStart:0,storeListLoadFinished:!1,onStoreLoading:!1,storePopShow:!1,storeList:[],storeKeyword:null,store:"请选择",storeId:"",itemListStart:0,itemListLoadFinished:!1,onItemLoading:!1,itemPopShow:!1,itemList:[],itemKeyword:null,item:"请选择",itemId:"",billTypeListStart:0,billTypeListLoadFinished:!1,onBillTypeLoading:!1,billTypePopShow:!1,billTypeList:[],billTypeKeyword:null,billType:"请选择",billTypeId:"",billNo:"",datePickerShow:!1,currentDate:new Date,beginDate:this.$fxCommon.orderFilterStartDate(),endDate:this.$fxCommon.orderFilterEndDate(),dateType:""}},watch:{visibleFlag:{handler:function(t){t&&this.$fxUtils.isEmptyObjSHW(this.filterParams)&&this.resetHandler()},immediate:!0}},computed:Object(u["a"])({},Object(d["c"])({loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}})),methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onConfirmClick:function(){this.$emit("update:visibleFlag",!1),this.$emit("on-confirm",this.getFilterParams()),this.$emit("update:filterParams",this.getFilterParams())},getFilterParams:function(){return{beginDate:this.beginDate||this.$fxCommon.orderFilterStartDate(),endDate:this.endDate||this.$fxCommon.orderFilterEndDate(),supplierId:this.supplierId,shopId:this.shopId,storeId:this.storeId,itemId:this.itemId,billTypeId:this.billTypeId,billNo:this.billNo}},onResetClick:function(){this.resetHandler()},resetHandler:function(){this.beginDate=this.$fxCommon.orderFilterStartDate(),this.endDate=this.$fxCommon.orderFilterEndDate(),this.supplier="请选择",this.supplierId="",this.supplierKeyword=null,this.shop="请选择",this.shopId="",this.store="请选择",this.storeId="",this.storeKeyword=null,this.item="请选择",this.itemId="",this.itemKeyword=null,this.billType="请选择",this.billTypeId="",this.billTypeKeyword=null,this.billNo=""},onSupplierClick:function(){this.supplierKeyword=null,this.supplierListLoadFinished=!1,this.onSupplierRefresh()},searchSupplier:function(t){this.supplierKeyword=t,this.onSupplierRefresh()},selectSupplier:function(t){this.supplier=t.name,this.supplierId=t.id},onSupplierLoad:function(){var t=this;this.getSupplierListData().then(function(e){var i;(i=t.supplierList).push.apply(i,Object(s["a"])(e.suppliers))})},onSupplierRefresh:function(){var t=this;this.supplierListStart=0,this.getSupplierListData().then(function(e){t.supplierPopShow=!0,t.supplierList=e.suppliers})},getSupplierListData:function(){var t=this;return new l.a(function(e){var i={start:t.supplierListStart,size:$,keyword:t.supplierKeyword};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/suppliers"),data:i}).then(function(i){t.onSupplierLoading=!1,t.supplierListStart+=$,i.suppliers.length<$?t.supplierListLoadFinished=!0:t.supplierListLoadFinished=!1,e(i)})})},onShopClick:function(){this.shopPopShow=!0},selectShop:function(t){var e=Object(F["a"])(t,1),i=e[0];this.shop=i.name,this.shopId=i.id},getShopListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,n={keyword:t,start:e,size:i};return this.$fxApi("z5common.getUserManageShop")({data:n}).then(function(t){return t.shops})},onStoreClick:function(){this.onStoreRefresh()},searchStore:function(t){this.storeKeyword=t,this.onStoreRefresh()},selectStore:function(t){this.store=t.name,this.storeId=t.id},onStoreLoad:function(){var t=this;this.getStoreListData().then(function(e){var i;t.onStoreLoading=!1,t.storeListStart+=$,e.shops.length<$&&(t.storeListLoadFinished=!0),(i=t.storeList).push.apply(i,Object(s["a"])(e.shops))})},onStoreRefresh:function(){var t=this;this.storeListStart=0,this.storeListLoadFinished=!1,this.getStoreListData().then(function(e){t.onStoreLoading=!1,t.storePopShow=!0,t.storeListStart+=$,e.shops.length<$&&(t.storeListLoadFinished=!0),t.storeList=e.shops})},getStoreListData:function(){var t=this;return new l.a(function(e){if(!t.shopId)return t.$fxToast.fail("请选择入库机构！"),!1;var i={start:t.storeListStart,size:$,keyword:t.storeKeyword};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/houses"),data:i}).then(function(t){e(t)})})},onItemClick:function(){this.itemKeyword=null,this.onItemRefresh()},searchItem:function(t){this.itemKeyword=t,this.onItemRefresh(t)},selectItem:function(t){this.item=t.name,this.itemId=t.id},onItemRefresh:function(){var t=this;this.itemListStart=0,this.getItemListData().then(function(e){t.itemPopShow=!0,t.itemList=e.goods})},onItemLoad:function(){var t=this;this.getItemListData().then(function(e){var i;(i=t.itemList).push.apply(i,Object(s["a"])(e.goods))})},getItemListData:function(){var t=this;return new l.a(function(e){var i={start:t.itemListStart,size:$,paged:!0,keyword:t.itemKeyword};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/goods"),data:i}).then(function(i){t.onItemLoading=!1,t.itemListStart+=$,i.goods.length<$?t.itemListLoadFinished=!0:t.itemListLoadFinished=!1,e(i)})})},onBillTypeClick:function(){this.onBillTypeRefresh()},searchBillType:function(t){this.billTypeKeyword=t,this.onBillTypeRefresh()},selectBillType:function(t){this.billType=t.name,this.billTypeId=t.id},onBillTypeLoad:function(){var t=this;this.getBillTypeListData().then(function(e){var i;t.onBillTypeLoading=!1,t.billTypeListStart+=$,e.billTypes.length<$&&(t.billTypeListLoadFinished=!0),(i=t.billTypeList).push.apply(i,Object(s["a"])(e.billTypes))})},onBillTypeRefresh:function(){var t=this;this.billTypeListStart=0,this.billTypeListLoadFinished=!1,this.getBillTypeListData().then(function(e){t.onBillTypeLoading=!1,t.billTypePopShow=!0,t.billTypeListStart+=$,e.businessTypes.length<$&&(t.billTypeListLoadFinished=!0),t.billTypeList=e.businessTypes})},getBillTypeListData:function(){var t=this;return new l.a(function(e){var i={start:t.billTypeListStart,size:$,m:"list4ShopStockInBillQuery",keyword:t.billTypeKeyword};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/businessTypes"),data:i}).then(function(t){e(t)})})},onBeginDateClick:function(){this.dateType="begin",this.beginDate&&(this.currentDate=new Date(this.beginDate)),this.datePickerShow=!0},endDateClick:function(){this.dateType="end",this.endDate&&(this.currentDate=new Date(this.endDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){"begin"===this.dateType?(this.beginDate=this.$fxUtils.setDateTime(t,"时分"),this.endDate&&this.$fxCommon.orderFilterRangeDate(this.beginDate,this.endDate)||(this.endDate=this.$fxCommon.orderFilterDate(t))):(this.endDate=this.$fxUtils.setDateTime(t,"时分"),this.beginDate&&this.$fxCommon.orderFilterRangeDate(this.beginDate,this.endDate)||(this.beginDate=this.$fxCommon.orderFilterStartDate(t))),this.datePickerShow=!1},onFocus:function(t){this.onScrollTop(t)},onScrollTop:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,i=this.$refs[t];if(!i||0===i.length)return!1;var n=i.$el.offsetTop,o=this.$refs["filterContent"];this.$fxUtils.scrollTopW({offsetTop:n,$el:o,distance:e})},onBillTypeClearClick:function(){this.billType="请选择",this.billTypeId=""}}},L=O,N=(i("7b2e"),Object(w["a"])(L,T,P,!1,null,"6804425a",null)),E=N.exports,U=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"shopOrder-filter fx-shadow-down"},[i("div",{staticClass:"filter-state",on:{click:t.onStateClick}},[i("span",[t._v("审核状态")]),i("van-icon",{staticClass:"filter-arrow",attrs:{name:"arrow-down"}}),i("span",[t._v(t._s(t.state))])],1),i("div",{staticClass:"filter-reCheckState",on:{click:t.onReCheckStateClick}},[i("span",[t._v("复审状态")]),i("van-icon",{staticClass:"filter-arrow",attrs:{name:"arrow-down"}}),i("span",[t._v(t._s(t.reCheckState))])],1)])},z=[],_={name:"filterTab",props:{state:String,reCheckState:String},methods:{onStateClick:function(){this.$emit("on-state-click")},onReCheckStateClick:function(){this.$emit("on-recheckstate-click")}}},M=_,R=(i("697a"),Object(w["a"])(M,U,z,!1,null,"55416a1d",null)),W=R.exports,H=50,j={name:"stockInBill",components:{headSearchBtn:h["a"],headEditBtn:p["a"],headSelectAllBtn:f["a"],emptyBill:m["a"],orderBlock:D,filterPop:E,filterTab:W},data:function(){return{orderList:[],filterPopShow:!1,filterState:null,stateActionShow:!1,stateActions:[{id:null,name:"全部"},{id:"0",name:"未审核"},{id:"1",name:"已审核"}],filterReCheckState:null,reCheckStateActionShow:!1,reCheckStateActions:[{id:null,name:"全部"},{id:"1",name:"已复审"},{id:"0",name:"未复审"}],listStart:0,pullRefreshLoading:!1,listLoading:!1,loadFinished:!0,listError:!1,orderEditFlag:!1,filterParams:{}}},beforeRouteEnter:function(t,e,i){var n=["/main/home","/"],o=["/stockInBillDetails"];n.includes(e.path)?i(function(e){e.restFilterParams(),e.restRouterParams(t.params),e.refreshOrderList()}):o.includes(e.path)?i(function(t){t.refreshOrderList()}):i()},computed:Object(u["a"])({},Object(d["c"])({billListPostParams:"billListPostParams",sysStockInPriceIsZeroPrompt:function(t){return t.systemParams.sysStockInPriceIsZeroPrompt},loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{computedState:function(){var t=this;return this.stateActions.find(function(e){return e.id===t.filterState}).name},computedReCheckState:function(){var t=this;return this.reCheckStateActions.find(function(e){return e.id===t.filterReCheckState}).name},computedShowOrder:function(t){var e=this;return function(t){return!e.orderEditFlag||1!==t}},isSelectAll:function(){var t=this.orderList.filter(function(t){return 1!==t.billState});if(0===t.length)return!1;var e=t.filter(function(t){return!!t.checked});return e.length===t.length}}),methods:{orderListPostHandler:function(t){var e=this;return new l.a(function(i){e.$store.commit({type:"SETSTATE",billListPostParams:t}),e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/stockinbills/users/").concat(e.loginerId),data:t}).then(function(t){e.listLoading=!1,i(t)})})},refreshOrderList:function(){var t=this;return new l.a(function(e){t.listStart=0;var i={start:t.listStart,size:H,paged:!0,businessDateStart:t.$fxCommon.orderFilterStartDate(),businessDateEnd:t.$fxCommon.orderFilterEndDate(),billState:t.filterState,reCheckState:t.filterReCheckState};i=r()(i,t.translateFilterParams(t.filterParams)),t.orderListPostHandler(i).then(function(i){t.orderList=i.storeBills,e(i)})})},translateFilterParams:function(t){return this.$fxUtils.isEmptyObjSHW(t)?{}:{businessDateStart:t.beginDate,businessDateEnd:t.endDate,sysBillCode:""===t.billNo?null:t.billNo,shopId:""===t.shopId?null:t.shopId,supplierId:""===t.supplierId?null:t.supplierId,houseId:""===t.storeId?null:t.storeId,goodsId:""===t.itemId?null:t.itemId,businessType:""===t.billTypeId?null:t.billTypeId}},onFilterConfirm:function(t){var e=this;this.listStart=0;var i={start:this.listStart,size:H,paged:!0,businessDateStart:t.beginDate,businessDateEnd:t.endDate,billState:this.filterState,reCheckState:this.filterReCheckState,sysBillCode:""===t.billNo?null:t.billNo,shopId:""===t.shopId?null:t.shopId,supplierId:""===t.supplierId?null:t.supplierId,houseId:""===t.storeId?null:t.storeId,goodsId:""===t.itemId?null:t.itemId,businessType:""===t.billTypeId?null:t.billTypeId};this.orderListPostHandler(i).then(function(t){e.orderList=t.storeBills})},onPullRefresh:function(){var t=this;this.refreshOrderList().then(function(e){t.pullRefreshLoading=!1})},onLoadMore:function(){var t=this,e=r()(this.billListPostParams,{start:this.listStart});this.orderListPostHandler(e).then(function(e){var i;(i=t.orderList).push.apply(i,Object(s["a"])(e.storeBills))})},onSearchClick:function(){this.filterPopShow=!0},onStateClick:function(){this.stateActionShow=!0},onStateSelect:function(t){this.filterState=t.id,this.stateActionShow=!1,this.refreshOrderList()},reCheckStateClick:function(){this.reCheckStateActionShow=!0},onReCheckStateSelect:function(t){this.filterReCheckState=t.id,this.reCheckStateActionShow=!1,this.refreshOrderList()},onClickOrder:function(t){this.$router.push({path:"stockInBillDetails",query:{orderId:t.id}})},onCreateClick:function(){this.$router.push("createStockInBill")},onOrderEditClick:function(){this.orderEditFlag=!this.orderEditFlag},onExpressClick:function(){var t=this,e=this.orderList.reduce(function(t,e){var i=e.checked?t.concat(e.id):t;return i},[]);if(0===e.length)return!1;var i="确定要审核所选单据?";this.checkZeroBill(e).then(function(e){e.length&&(i="存在非赠品价格为0的单据，是否继续审核?"+e),t.$dialog.confirm({title:"提示",message:i}).then(function(){t.expressBillList()})})},checkZeroBill:function(t){var e=this;return new l.a(function(i,n){e.sysStockInPriceIsZeroPrompt||i(""),e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/stockinbills"),data:{billIds:t.join(","),m:"getBill4MoneyIsZero"}}).then(function(t){i(t)}).catch(function(t){n(t)})})},expressBillList:function(){var t=this,e=this.orderList.reduce(function(t,e){var i=e.checked?t.concat(e.id):t;return i},[]);if(0===e.length)return!1;this.expressHandler(e).then(function(e){t.orderEditFlag=!t.orderEditFlag,t.refreshOrderList().then(function(){t.$dialog.confirm({title:"提示",message:e.message})})}).catch(function(){t.refreshOrderList()})},expressHandler:function(t){var e=this;return new l.a(function(i){e.$fxHttp.requestPut({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/stockinbills/users/").concat(e.loginerId),data:t,query:{m:"batchCheck"}}).then(function(t){i(t)})})},onSelectAllClick:function(){var t=this,e=!this.isSelectAll;this.orderList.forEach(function(i){1!==i.billState&&t.$set(i,"checked",e)})},restFilterParams:function(){this.filterParams={},this.filterState=null,this.filterReCheckState=null,this.orderEditFlag=!1},restRouterParams:function(t){this.$fxUtils.isEmptyObjSHW(t)||(this.filterState=t.billState)}}},q=j,G=(i("ff3f"),Object(w["a"])(q,n,o,!1,null,"66de4d3f",null));e["default"]=G.exports},"2ad9":function(t,e,i){"use strict";var n=i("f75d"),o=i.n(n);o.a},"2d53":function(t,e,i){"use strict";var n=i("2056"),o=i.n(n);o.a},"30b4":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"store-item"},[i("w-header",{attrs:{title:"编辑入库单明细",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{staticClass:"add-store-bar"},[i("van-button",{staticClass:"add-store-btn",attrs:{type:"primary",round:""},on:{click:t.onAddStoreClick}},[t._v("添加仓库")])],1),i("div",{staticClass:"store-item-content"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeStoreNames,callback:function(e){t.activeStoreNames=e},expression:"activeStoreNames"}},t._l(t.currentStoreItemData,function(e,n){return i("van-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.storeShowComputed(e),expression:"storeShowComputed(storeItem)"}],key:e.id,staticClass:"store-row",attrs:{name:e.id}},[i("div",{staticClass:"item-store-title",attrs:{slot:"title"},slot:"title"},[i("span",[t._v(t._s(e.name))])]),i("div",{staticClass:"item-storn-btn"},[i("span",{staticClass:"edit-btn",on:{click:function(i){return t.editStoreItem(e)}}}),i("span",{staticClass:"delete-btn",on:{click:function(i){return t.deleteStoreItem(e,n)}}})]),t._l(e.details,function(t,n){return i("div",{directives:[{name:"show",rawName:"v-show",value:"del"!==t.changeType,expression:"item.changeType !== 'del'"}],key:e.id+"-"+t.goodsDTO.id+"-"+n,staticClass:"item-row"},[i("itemInfoCell",{attrs:{itemData:t,isDisabled:!0,showEditBtn:!1}})],1)})],2)}),1)],1),i("div",{staticClass:"store-item-bottom"},[i("van-button",{staticClass:"save-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onSaveClick}},[t._v("保存")])],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.storePopShow,callback:function(e){t.storePopShow=e},expression:"storePopShow"}},[i("listComp",{attrs:{visibleFlag:t.storePopShow,data:t.storeList,loadFinished:!0,title:"仓库检索"},on:{"update:visibleFlag":function(e){t.storePopShow=e},"update:visible-flag":function(e){t.storePopShow=e},"on-search":t.searchStore,"on-select":t.selectStore}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemPopShow,callback:function(e){t.itemPopShow=e},expression:"itemPopShow"}},[i("itemEditComp",t._b({attrs:{visibleFlag:t.itemPopShow,supplierId:t.supplierId,shopId:t.shopId,store:t.currentStoreObj,businessDate:t.businessDate,parentStoreItem:t.computedStoreItem,orderItemList:t.currentStoreItemData,sysStockInSameGoods:t.sysStockInSameGoods,sysStockInChangeUnit:t.sysStockInChangeUnit},on:{"update:visibleFlag":function(e){t.itemPopShow=e},"update:visible-flag":function(e){t.itemPopShow=e},"on-confirm":t.onItemEditConfirm}},"itemEditComp",t.$attrs,!1))],1)],1)},o=[],s=(i("7f7f"),i("ac6a"),i("5176")),a=i.n(s),r=i("768b"),c=i("795b"),l=i.n(c),u=(i("20d6"),i("7514"),i("cebc")),d=(i("c5f6"),i("2f62")),h=i("f6bb"),p=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-edit"},[i("w-header",{attrs:{title:"选择品项",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}},[i("van-icon",{staticClass:"header-confirm-btn",attrs:{slot:"header-right",name:"success"},on:{click:t.onItemConfirm},slot:"header-right"})],1),i("div",{staticClass:"item-search clearfix"},[i("van-search",{attrs:{placeholder:"请输入搜索关键词",shape:"round"},on:{search:t.search},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}})],1),i("div",{staticClass:"item-edit-content"},[i("div",{staticClass:"item-class-content fx-vant-class-collapse"},[i("div",{staticClass:"all-class",class:{"is-active":""===t.currentClass},on:{click:function(e){return e.stopPropagation(),t.selectClass("")}}},[t._v("全部品项")]),i("van-collapse",{attrs:{accordion:!0},model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},t._l(t.itemClassList,function(e){return i("van-collapse-item",{key:e.id,attrs:{name:e.id}},[i("div",{staticClass:"big-class",attrs:{slot:"title"},on:{click:function(i){return i.stopPropagation(),t.selectClass(e.id,"bigType")}},slot:"title"},[t._v(t._s(e.name))]),t._l(e.smallType,function(e){return i("van-cell",{key:e.id,staticClass:"small-class",class:{"is-active":t.currentClass===e.id},attrs:{title:e.name},on:{click:function(i){return i.stopPropagation(),t.selectClass(e.id,"smallType")}}})})],2)}),1)],1),i("div",{ref:"details-content",staticClass:"item-details-content"},[i("van-list",{attrs:{finished:t.loadFinished,"finished-text":"没有更多了","error-text":"请求失败，点击重新加载"},on:{load:t.onLoadMore},model:{value:t.listLoading,callback:function(e){t.listLoading=e},expression:"listLoading"}},t._l(t.itemList,function(e,n){return i("div",{key:e.goodsDTO.id,ref:"details-row-"+n,refInFor:!0,staticClass:"item-detail"},[i("div",{staticClass:"item-detail-cell",class:{"is-active":t.rowActive===n},on:{click:function(e){return t.onItemEdit(n)}}},[i("div",{staticClass:"item-details-img"},[i("img",{attrs:{src:t.comptedItemImgSrc(e.goodsDTO.imageUrls),onerror:t.$fxCommon.errorImg("item")}})]),i("div",{staticClass:"item-details-params"},[i("div",{staticClass:"item-details-name fx-ellipsis"},[t._v(t._s(e.goodsDTO.name))]),i("div",{staticClass:"item-details-spec fx-ellipsis"},[t._v(t._s(e.goodsDTO.spec))]),i("div",{staticClass:"item-details-amount"},[i("span",{staticClass:"item-details-count"},[t._v(t._s(e.busUnitInAmount))]),i("span",{staticClass:"item-details-unit",on:{click:function(i){return i.stopPropagation(),t.onUnitClick(e)}}},[t._v(t._s(e.unitDTO.name))]),i("van-icon",{directives:[{name:"show",rawName:"v-show",value:t.sysStockInChangeUnit,expression:"sysStockInChangeUnit"}],attrs:{name:"arrow-down"}})],1),i("i",{directives:[{name:"show",rawName:"v-show",value:t.rowActive===n,expression:"rowActive===index"}],staticClass:"item-edit-icon"}),i("i",{directives:[{name:"show",rawName:"v-show",value:t.rowActive!==n&&e.busUnitInAmount>0,expression:"rowActive!==index && item.busUnitInAmount>0"}],staticClass:"item-selected-icon"})])])])}),0)],1)]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.numberKeyboardShow,expression:"numberKeyboardShow"}],staticClass:"details-number-keyboard"},[i("itemNumberKeyboard",{attrs:{title:t.keyboardTitleCompted,unit:t.keyboardUnitCompted,amount:t.keyboardAmountCompted,pointSize:t.sysPointSize,intLength:t.numberLength},on:{change:t.onKeyboardChange,pre:t.onKeyboardPre,next:t.onKeyboardNext,hide:t.onKeyboardHide}})],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("w-action-sheet",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.scanActionShow,expression:"scanActionShow"}],ref:"scanActionSheet",attrs:{actions:t.scanActions},model:{value:t.scanActionShow,callback:function(e){t.scanActionShow=e},expression:"scanActionShow"}})],1)},f=[],m=i("59ad"),S=i.n(m),v=i("75fc"),b=i("af41"),g=10,I={name:"itemEditComp",components:{itemNumberKeyboard:b["a"]},props:{visibleFlag:Boolean,store:{type:Object,default:function(){return{}}},supplierId:{type:String,default:""},shopId:{type:String,default:""},businessDate:{type:[String,Number],default:""},parentStoreItem:{type:Array,default:function(){return[]}},orderItemList:{type:Array,default:function(){return[]}},sysStockInSameGoods:Boolean,sysStockInChangeUnit:Boolean,billId:{type:String,default:function(){return""}}},data:function(){return{activeNames:[],leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",currentClass:"",currentClassType:"",itemClassList:[],itemList:[],numberKeyboardShow:!1,rowActive:"",selectedItemArr:[],itemListStart:0,listLoading:!1,loadFinished:!0,listError:!1,unitActions:[],unitActionShow:!1,itemEditRowData:{},removeIds:[],scanActionShow:!1,scanActions:[{name:"累加数量"},{name:"覆盖数量"}]}},computed:Object(u["a"])({},Object(d["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{comptedItemImgSrc:function(t){return function(t){return null===t?"":t[0]}},keyboardTitleCompted:function(){if(""===this.rowActive)return"";var t=this.itemList[this.rowActive];return t.goodsDTO.name},keyboardUnitCompted:function(){if(""===this.rowActive)return"";var t=this.itemList[this.rowActive];return t.unitDTO.name},keyboardAmountCompted:function(){if(""===this.rowActive)return"0";var t=this.itemList[this.rowActive];return t.busUnitInAmount}}),watch:{visibleFlag:{handler:function(t){t?(this.refresh(),this.$fxEventBus.$on("redCode",this.getItemByRedCode)):this.$fxEventBus.$off("redCode",this.getItemByRedCode)},immediate:!0},rowActive:function(t,e){""===t&&(this.numberKeyboardShow=!1),""!==e&&(this.numberStringAmount(e),this.pushSelectedItem(this.itemList[e]))}},methods:{refresh:function(){var t=this;this.resetHandler(),this.getItemClass().then(function(e){t.itemClassList=e.goodsTypes,t.getItemByClass()})},resetHandler:function(){this.currentClass="",this.currentClassType="",this.searchKey="",this.selectedItemArr=[],this.itemList=[],this.removeIds=[]},onCloseClick:function(){this.rowActive="",this.$emit("update:visibleFlag",!1)},onItemConfirm:function(){var t=this;this.rowActive="",this.$nextTick(function(){t.selectedItemArr.forEach(function(e){e.inHouseDTO||(e.inHouseDTO=t.store),e.giftFlag=!1}),t.$emit("on-confirm",[t.selectedItemArr,t.store]),t.$emit("update:visibleFlag",!1)})},search:function(t){this.rowActive="",this.searchKey=t,this.getItemByClass()},onLoadMore:function(){var t=this;this.getItem().then(function(e){var i,n=t.setDataMoneyAndPrice(e.billAndDetails);(i=t.itemList).push.apply(i,Object(v["a"])(t.setResItem(n))),t.setListLoading(n.length)})},setDataMoneyAndPrice:function(t){var e=this;return t.forEach(function(t){t.unitDTO=e.$fxUtils.JSONcopy(t.pricePlanDTO.unit),t.pricePlanDTO=e.$fxUtils.JSONcopy(t.pricePlanDTO);var i=t.pricePlanDTO;e.$fxUtils.isDef(i)?(t.price=e.toFixedNumberSize(i.price),t.tax=e.toFixedNumberSize(i.taxes),t.taxPrice=e.toFixedNumberSize(i.priceWithTax),"1"===t.getPriceWay&&"0"===t.goodsDTO.barCodeFlag&&(t.taxPrice=e.toFixedNumberSize(t.taxPrice/i.unit.value*t.goodsDTO.unitValue),t.unitDTO={id:t.goodsDTO.unitsId,name:t.goodsDTO.unitName,value:t.goodsDTO.unitValue,codeFlag:t.goodsDTO.barCodeFlag})):(t.price=0,t.tax=0,t.taxPrice=0)}),t},setListLoading:function(t){this.listLoading=!1,this.itemListStart+=g,this.loadFinished=t<g},getItemClass:function(){var t=this;return new l.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/goodTypes")}).then(function(t){e(t)})})},getItem:function(){var t=this;return new l.a(function(e){var i={start:t.itemListStart,size:g,paged:!0,houseId:t.store.id,supplierId:t.supplierId,workDate:t.businessDate,searchText:t.searchKey,removeIds:t.removeIds};"bigType"===t.currentClassType?i.goodsBigTypeId=t.currentClass:"smallType"===t.currentClassType&&(i.goodsTypeId=t.currentClass),t.$fxHttp.requestPost({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/stockindetails"),data:i}).then(function(t){e(t)})})},getItemByClass:function(){var t=this;this.itemListStart=0,this.getItem().then(function(e){var i=t.setDataMoneyAndPrice(e.billAndDetails);t.itemList=t.setResItem(i),t.setListLoading(i.length),t.$nextTick(function(){t.onSelectLetter(0,5)})})},setResItem:function(t){var e=this;return t.forEach(function(t){var i=e.selectedItemArr.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id});~i?(t.busUnitInAmount=e.selectedItemArr[i].busUnitInAmount,t.unitDTO=e.selectedItemArr[i].unitDTO):t.busUnitInAmount="0"}),t},selectClass:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.onKeyboardHide(),this.currentClassType=e,this.currentClass=t,this.searchKey="",this.getItemByClass()},onItemEdit:function(t){this.rowActive=t,this.numberKeyboardShow=!0,this.onSelectLetter(this.rowActive,20)},onKeyboardChange:function(t){this.itemList[this.rowActive].busUnitInAmount=t},numberStringAmount:function(t){var e=this.itemList[t].busUnitInAmount;this.itemList[t].busUnitInAmount=S()(e)+"",this.calcMoney("amount",e,this.itemList[t])},calcMoney:function(t,e,i){var n=i.taxPrice,o=i.busUnitInAmount,s=i.price,a=i.tax,r=0,c=0,l=0,u=0;if(e=this.toFixedNumberSize(e),i.giftFlag||"money"===t&&0===e)return i.inMoney=0,i.inMoneyWithTax=0,i.taxInMoney=0,!0;"money"===t?(r=e,l=this.toFixedNumberSize(r/o),c=r*(1+a),u=this.toFixedNumberSize(c/o)):"amount"===t?(i.busUnitInAmount=e,l=s,u=n,r=this.toFixedNumberSize(s*e),c=this.toFixedNumberSize(n*e)):"moneyWithTax"===t?(c=e,u=this.toFixedNumberSize(c/o),r=this.toFixedNumberSize(c/(1+a)),l=this.toFixedNumberSize(r/o)):"taxPrice"===t?(u=e,c=this.toFixedNumberSize(o*u),l=this.toFixedNumberSize(u/(1+a)),r=this.toFixedNumberSize(l*o)):"price"===t&&(l=e,r=this.toFixedNumberSize(l*o),u=this.toFixedNumberSize(l*(1+a)),c=this.toFixedNumberSize(o*u)),i.inMoney=r,i.inMoneyWithTax=c,i.taxInMoney=this.toFixedNumberSize(this.toFixedNumberSize(c)-this.toFixedNumberSize(r)),i.price=l,i.taxPrice=u},toFixedNumberSize:function(t){return S()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},pushSelectedItem:function(t){var e=this.selectedItemArr.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id});~e?this.selectedItemArr[e].busUnitInAmount=t.busUnitInAmount:t.busUnitInAmount>0&&(t.changeType="add",this.selectedItemArr.push(t))},onKeyboardPre:function(){if(!this.rowActive)return!1;this.rowActive--,this.onSelectLetter(this.rowActive,5)},onKeyboardNext:function(){if(""===this.rowActive||this.rowActive===this.itemList.length-1)return!1;this.rowActive++,this.onSelectLetter(this.rowActive,5)},onKeyboardHide:function(){this.rowActive=""},onSelectLetter:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40,i=this.$refs["details-row-".concat(t)];if(!i||0===i.length)return!1;var n=i[0].offsetTop,o=this.$refs["details-content"];this.$fxUtils.scrollTopW({offsetTop:n,$el:o,distance:e})},onUnitClick:function(t){var e=this;if(!this.sysStockInChangeUnit)return!1;this.itemEditRowData=t,this.getItemUnit(t.goodsDTO.id).then(function(t){e.unitActions=t,e.unitActionShow=!0})},getItemUnit:function(t){var e=this;return new l.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/users/").concat(e.loginerId,"/goods/").concat(t,"/units")}).then(function(t){i(t.units)})})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemEditRowData,i=e.unitDTO.value,n=t,o=S()(e.busUnitInAmount);o>0?(o=o*i/n.value,e.busUnitInAmount=S()(this.$fxUtils.toFixedSHW(o,this.sysPointSize)),this.calcMoney("moneyWithTax",e.inMoneyWithTax,e)):(e.taxPrice=S()(e.taxPrice)*n.value/i,e.costTaxPrice=S()(e.costTaxPrice)*n.value/i,this.calcMoney("taxPrice",e.taxPrice,e));var s=S()(e.outOrderAmount);s=s*i/n.value,e.outOrderAmount=s;var a=this.selectedItemArr.findIndex(function(t){return e.goodsDTO.id===t.goodsDTO.id});~a&&(this.selectedItemArr[a].unitDTO=t),e.unitDTO=t},getItemByRedCode:function(t){var e=this;if(!this.visibleFlag)return!1;t.length<=24?this.onRedCodeHandler(t):this.getItemByTwoCode(t).then(function(t){if(0===t.length)return e.$fxToast.top("当前仓库无此品项!"),!1;e.getScanGoodData(t)})},onRedCodeHandler:function(t){var e=this;this.rowActive="",this.getItemByRedCodeHandler(t).then(function(t){var i=e.itemUpdate(t.billAndDetails[0]),n=i.goodsDTO.countValue;e.calcMoney("amount",n,i),e.pushSelectedItem(i),e.itemList=[i],e.setListLoading(1),e.$nextTick(function(){e.onSelectLetter(0,5)})})},itemUpdate:function(t){if(!this.sysStockInSameGoods){var e=this.$fxUtils.appointedMap(this.parentStoreItem,function(e,i){if(e.goodsDTO.id===t.goodsDTO.id&&"del"!==e.changeType)return i});if(1===e.length&&this.parentStoreItem[e[0]].id){var i=this.parentStoreItem[e[0]],n=i.unitDTO,o=t.unitDTO,s=o.value/n.value,a=t.goodsDTO.countValue*s;i.goodsDTO.countValue=a,t=this.$fxUtils.JSONcopy(i)}}return t},getItemByRedCodeHandler:function(t){var e=this;return new l.a(function(i){var n={workDate:e.businessDate,supplierId:e.supplierId,houseId:e.store.id,billType:"20_0"};e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.shopId,"/users/").concat(e.loginerId,"/goods/barCode/").concat(t),data:n}).then(function(t){i(t)})})},getItemByTwoCode:function(t){var e=this;return new l.a(function(i){var n={qrCodeContent:t,houseId:e.store.id,supplierId:e.supplierId,billType:"20",billId:e.billId};e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.shopId,"/users/").concat(e.loginerId,"/getscancodedata"),query:n}).then(function(t){i(t.storeBillDetailDTO)})})},getScanGoodData:function(t){t.autoType=3,this.setScanGood(t)},setScanGood:function(t){var e=this,i=[];i=this.selectedItemArr;var n=i.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id&&"del"!==e.changeType}),o=this.orderItemList.find(function(e){return e.details.find(function(e){return e.batchCode===t.batchCode&&"del"!==e.changeType})});if(~n){var s=i.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id&&t.unitDTO.id===e.unitDTO.id&&"del"!==e.changeType});if(!~s)return this.$fxToast.fail("不能重复添加品项！"),!1;if(o&&o.id!==this.store.id)return this.$fxToast.success("该批次号已存在,不能扫码入库！"),!1;var a=i[n];if(a.batchCode!==t.batchCode&&this.$fxUtils.isDef(a.batchCode))return this.itemList=[t],this.refreshSelectItem(t,a),!1;this.$refs.scanActionSheet.doSelect().then(function(i){"累加数量"===i.name&&e.computedScanItemAmount(t,a),e.refreshSelectItem(t,a),e.itemList=[t]})}else o?this.$fxToast.success("该批次号已存在,不能扫码入库！"):(this.itemList=[t],this.addScanGood(t),this.$fxToast.success("扫码添加品项成功！"))},addScanGood:function(t){this.calcMoney("amount",t.busUnitInAmount,t),this.pushSelectedItem(t)},computedScanItemAmount:function(t,e){var i=this.toFixedNumberSize(t.busUnitInAmount+e.busUnitInAmount);t.busUnitInAmount=this.$fxCommon.checkAmountRange(i)},refreshSelectItem:function(t,e){e.busUnitInAmount=t.busUnitInAmount,e.batchCode=t.batchCode,e.productDate=t.productDate,e.autoType=3,this.editItem(e),this.calcMoney("amount",e.busUnitInAmount,e)},editItem:function(t){t.id&&this.$set(t,"changeType","edit")}}},y=I,k=(i("f425"),i("2877")),x=Object(k["a"])(y,p,f,!1,null,"95edceb4",null),w=x.exports,C=i("987b"),D={name:"storeItemComp",components:{listComp:h["a"],itemEditComp:w,itemInfoCell:C["a"]},props:{visibleFlag:Boolean,shopId:{type:String,default:""},supplierId:{type:String,default:""},businessDate:{type:[String,Number],default:""},storeItemData:{type:Array,default:function(){return[]}},sysStockInSameGoods:Boolean,sysStockInChangeUnit:Boolean},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},storePopShow:!1,storeList:[],itemPopShow:!1,currentStoreObj:{},currentStoreItemData:[],activeStoreNames:[]}},computed:Object(u["a"])({},Object(d["c"])({loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{computedStoreItem:function(){var t=this;if(this.$fxUtils.isEmptyObjSHW(this.currentStoreObj))return[];var e=this.currentStoreItemData.find(function(e){return e.id===t.currentStoreObj.id});return e?e.details:[]},storeShowComputed:function(t){return function(t){var e=t.details.filter(function(t){return"del"!==t.changeType}).length;return e>0}}}),watch:{visibleFlag:{handler:function(t){t&&(this.currentStoreItemData=this.storeItemData,this.openStoreItemList(this.currentStoreItemData))},immediate:!0}},methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onAddStoreClick:function(){this.onStoreRefresh()},searchStore:function(t){this.onStoreRefresh(t)},onStoreRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getStoreListData(e).then(function(e){t.storeList=e.shops.filter(function(e){var i=t.currentStoreItemData.find(function(t){var i=t.details.findIndex(function(t){return"del"!==t.changeType});return~i&&t.id===e.id});if(!i)return!0}),t.storePopShow=!0})},getStoreListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new l.a(function(i){var n={keyword:e,m:"list4ShopOrderBill"};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/houses"),data:n}).then(function(t){i(t)})})},selectStore:function(t){this.currentStoreObj=t,this.itemPopShow=!0},onItemEditConfirm:function(t){var e=Object(r["a"])(t,2),i=e[0],n=e[1];if(0===i.length)return!1;var o=this.currentStoreItemData.find(function(t){return t.id===n.id});if(o)this.sysStockInSameGoods?this.updateSameItem(o,i):this.updateItemByStore(o,i);else{var s=a()({},n);s.details=i,this.currentStoreItemData.push(s)}this.openStoreItemList(this.currentStoreItemData)},updateSameItem:function(t,e){var i=this;e.forEach(function(e){var n=i.$fxUtils.appointedMap(t.details,function(t,i){if(t.batchCode&&e.batchCode&&t.batchCode===e.batchCode&&t.goodsDTO.id===e.goodsDTO.id&&"del"!==t.changeType)return i});1===n.length?(t.details[n[0]].id?t.details[n[0]].changeType="del":t.details.splice(n[0],1),t.details.push(e)):t.details.push(e)})},updateItemByStore:function(t,e){var i=this;e.forEach(function(e){var n=i.$fxUtils.appointedMap(t.details,function(t,i){if(t.goodsDTO.id===e.goodsDTO.id&&"del"!==t.changeType)return i});if(1===n.length)t.details[n[0]].id?t.details[n[0]].changeType="del":t.details.splice(n[0],1),t.details.push(e);else{if(0!==n.length)return!1;t.details.push(e)}})},editStoreItem:function(t){this.currentStoreObj=a()({},{code:t.code,id:t.id,name:t.name,pinYin:t.pinYin,updateIndicator:t.updateIndicator}),this.itemPopShow=!0},deleteStoreItem:function(t,e){var i=this;this.$dialog.confirm({title:"提示",message:"确定要删除当前仓库品项吗?"}).then(function(){var n=t.details.filter(function(t){return!!t.id});if(0===n.length)return i.currentStoreItemData.splice(e,1),!1;n.forEach(function(t){t.changeType="del"}),i.currentStoreItemData[e].details=n}).catch(function(){})},onSaveClick:function(){this.$emit("on-save",this.currentStoreItemData),this.$emit("update:visibleFlag",!1)},openStoreItemList:function(t){var e=this;t.forEach(function(t){var i=t.details.filter(function(t){return"del"!==t.changeType}).length;i>0&&e.activeStoreNames.push(t.id)})}}},T=D,P=(i("2d53"),Object(k["a"])(T,n,o,!1,null,"5fb38f64",null));e["a"]=P.exports},"3d83":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-item-block fx-shadow-block"},[i("div",{staticClass:"item-title"},[i("span",{staticClass:"title-name"},[t._v("单据明细")]),i("span",{staticClass:"title-count"},[t._v("明细：")]),i("span",[t._v(t._s(t.detailsLength))]),i("w-icon",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&(!t.hasFatherBillFlag||t.$fxSysAuth("shopStockInBill.SysEnableAutoShopInAddDetail"))&&t.$fxAuth("shopStockInBill.add")&&t.$fxAuth("shopStockInBill.editAmount"),expression:"!isDisabled && (!hasFatherBillFlag||$fxSysAuth('shopStockInBill.SysEnableAutoShopInAddDetail')) && $fxAuth('shopStockInBill.add') && $fxAuth('shopStockInBill.editAmount')"}],staticClass:"title-add-icon fl-r",attrs:{type:"camera"},on:{click:t.onScanClick}}),i("i",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&(!t.hasFatherBillFlag||t.$fxSysAuth("shopStockInBill.SysEnableAutoShopInAddDetail"))&&t.$fxAuth("shopStockInBill.add")&&t.$fxAuth("shopStockInBill.editAmount"),expression:"!isDisabled && (!hasFatherBillFlag||$fxSysAuth('shopStockInBill.SysEnableAutoShopInAddDetail')) && $fxAuth('shopStockInBill.add') && $fxAuth('shopStockInBill.editAmount')"}],staticClass:"title-add-icon fl-r",on:{click:t.onAddClick}}),i("i",{staticClass:"title-search-icon fl-r",on:{click:t.onSearchClick}})],1),i("div",{ref:"details-content",staticClass:"item-list"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeStoreNames,callback:function(e){t.activeStoreNames=e},expression:"activeStoreNames"}},t._l(t.data,function(e){return i("van-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.storeShowComputed(e),expression:"storeShowComputed(storeItem)"}],key:e.id,staticClass:"store-row",attrs:{name:e.id}},[i("div",{staticClass:"item-store-title",attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),t._l(e.details,function(n,o){return i("van-swipe-cell",{directives:[{name:"show",rawName:"v-show",value:"del"!==n.changeType,expression:"item.changeType !== 'del'"}],key:e.id+"-"+n.goodsDTO.id+"-"+o,ref:"details-row-"+e.id+"-"+n.goodsDTO.id,refInFor:!0,staticClass:"item-row",attrs:{"right-width":80,disabled:t.isDisabled||t.focusing}},[i("itemInfoCell",t._g({attrs:{itemData:n,isDisabled:t.isDisabled,sysStockInChangeUnit:t.sysStockInChangeUnit,disabledEditBtn:t.focusing},on:{"on-item-focus":function(i){return t.onItemFocus(arguments,e.id+"-"+n.goodsDTO.id)},"on-item-blur":t.onItemBlur}},t.$listeners)),i("div",{staticClass:"item-row-delete",attrs:{slot:"right"},on:{click:function(i){return t.onDeleteClick(n,o,e.details)}},slot:"right"},[t._v("删除")])],1)})],2)}),1)],1)])},o=[],s=(i("ac6a"),i("cebc")),a=i("2f62"),r=i("987b"),c={name:"orderItem",components:{itemInfoCell:r["a"]},props:{data:{type:Array,default:function(){return[]}},isDisabled:Boolean,sysStockInChangeUnit:Boolean,itemInputFocusing:Boolean,hasFatherBillFlag:Boolean},data:function(){return{focusing:!1,activeStoreNames:[]}},computed:Object(s["a"])({},Object(a["c"])({loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{storeShowComputed:function(t){return function(t){var e=t.details.filter(function(t){return"del"!==t.changeType}).length;return e>0}},detailsLength:function(){return this.data.reduce(function(t,e){var i=e.details.filter(function(t){return"del"!==t.changeType});return t+i.length},0)}}),watch:{focusing:function(t){this.$emit("update:itemInputFocusing",t)},data:function(){var t=this;this.data.forEach(function(e){var i=e.details.filter(function(t){return"del"!==t.changeType}).length;i>0&&t.activeStoreNames.push(e.id)})}},methods:{onAddClick:function(){if(this.isDisabled||this.focusing)return!1;this.$emit("on-add-click")},onScanClick:function(){if(this.isDisabled||this.focusing)return!1;this.$emit("on-scan-click")},onSearchClick:function(){if(this.focusing)return!1;this.$emit("on-search-click")},onDeleteClick:function(t,e,i){t.id?(this.$set(t,"changeType","del"),this.$set(t,"busUnitInAmount",0)):i.splice(e,1)},onItemFocus:function(t,e){this.focusing=!0},onItemBlur:function(){this.focusing=!1}}},l=c,u=(i("90bc"),i("2877")),d=Object(u["a"])(l,n,o,!1,null,"307f4bc2",null);e["a"]=d.exports},4980:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-shopOrder-create"},[i("w-header",{attrs:{title:"新增采购入库单",border:!0}}),i("orderInfo",{ref:"orderInfo",attrs:{data:t.orderInfoData,collapseDisabled:t.itemInputFocusing,modifyBusinessDateFlag:t.modifyBusinessDateFlag},on:{"on-shop-click":t.onShopClick,"on-supplier-click":t.onSupplierClick,"on-busdate-click":t.onBusinessDateClick,"on-orderDate-click":t.onOrderDateClick,"on-billType-click":t.onBillTypeClick,"on-billType-clear":t.onBillTypeClear}}),i("orderItem",{attrs:{data:t.orderItemList,sysStockInChangeUnit:t.systemParams.sysStockInChangeUnit,itemInputFocusing:t.itemInputFocusing},on:{"update:itemInputFocusing":function(e){t.itemInputFocusing=e},"update:item-input-focusing":function(e){t.itemInputFocusing=e},"on-scan-click":t.onScanClick,"on-search-click":t.onSearchClick,"on-add-click":t.onAddClick,"on-item-edit":t.onItemEdit,"on-unit-edit":t.onUnitEdit,"on-item-focus":t.onItemFocus}}),i("div",{staticClass:"shopOrder-bottom"},[i("van-button",{staticClass:"add-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onCreateClick}},[t._v("生成单据")])],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.shopPopShow,callback:function(e){t.shopPopShow=e},expression:"shopPopShow"}},[i("listComp",{attrs:{visibleFlag:t.shopPopShow,data:t.shopList,loadFinished:t.shopListLoadFinished,loading:t.onShopLoading,title:"请选择门店"},on:{"update:visibleFlag":function(e){t.shopPopShow=e},"update:visible-flag":function(e){t.shopPopShow=e},"update:loading":function(e){t.onShopLoading=e},"on-search":t.searchShop,"on-select":t.selectShop,"on-load":t.onShopLoad}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.supplierPopShow,callback:function(e){t.supplierPopShow=e},expression:"supplierPopShow"}},[i("listComp",{attrs:{visibleFlag:t.supplierPopShow,data:t.supplierList,loadFinished:!0,title:"请选择供货商"},on:{"update:visibleFlag":function(e){t.supplierPopShow=e},"update:visible-flag":function(e){t.supplierPopShow=e},"on-search":t.searchSupplier,"on-select":t.selectSupplier}})],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.billTypePopShow,callback:function(e){t.billTypePopShow=e},expression:"billTypePopShow"}},[i("listComp",{attrs:{visibleFlag:t.billTypePopShow,data:t.billTypeList,loadFinished:!0,title:"单据类型检索"},on:{"update:visibleFlag":function(e){t.billTypePopShow=e},"update:visible-flag":function(e){t.billTypePopShow=e},"on-search":t.searchBillType,"on-select":t.selectBillType}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemStorePopShow,callback:function(e){t.itemStorePopShow=e},expression:"itemStorePopShow"}},[i("storeItemComp",{attrs:{visibleFlag:t.itemStorePopShow,storeItemData:t.storeItem,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,supplierId:t.orderInfoData.supplierDTO&&t.orderInfoData.supplierDTO.id,businessDate:t.orderInfoData.businessDate,sysStockInSameGoods:t.systemParams.sysStockInSameGoods,sysStockInChangeUnit:t.systemParams.sysStockInChangeUnit},on:{"update:visibleFlag":function(e){t.itemStorePopShow=e},"update:visible-flag":function(e){t.itemStorePopShow=e},"on-save":t.onStoreItemSave}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.storeScanPopShow,callback:function(e){t.storeScanPopShow=e},expression:"storeScanPopShow"}},[i("scanStoreComp",{attrs:{visibleFlag:t.storeScanPopShow,storeItemData:t.storeItem,orderItemList:t.orderItemList,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,supplierId:t.orderInfoData.supplierDTO&&t.orderInfoData.supplierDTO.id},on:{"update:visibleFlag":function(e){t.storeScanPopShow=e},"update:visible-flag":function(e){t.storeScanPopShow=e},"on-save":t.onStoreItemSave}})],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-Confirm":t.onEditRowConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemSearchPopShow,callback:function(e){t.itemSearchPopShow=e},expression:"itemSearchPopShow"}},[i("itemSearchPop",{attrs:{visibleFlag:t.itemSearchPopShow,data:t.searchItem,isDisabled:!t.$fxAuth("shopStockInBill.save"),supplierId:t.orderInfoData.supplierDTO&&t.orderInfoData.supplierDTO.id,sysStockInChangeUnit:t.systemParams.sysStockInChangeUnit},on:{"update:visibleFlag":function(e){t.itemSearchPopShow=e},"update:visible-flag":function(e){t.itemSearchPopShow=e},"on-search-confirm":t.onSearchConfirm}})],1)],1)},o=[],s=(i("20d6"),i("59ad")),a=i.n(s),r=(i("7f7f"),i("5176")),c=i.n(r),l=(i("a481"),i("f499")),u=i.n(l),d=i("795b"),h=i.n(d),p=i("75fc"),f=(i("ac6a"),i("6762"),i("2fdb"),i("6b54"),i("cebc")),m=i("2f62"),S=i("bc59"),v=i("3d83"),b=i("f6bb"),g=i("30b4"),I=i("8533"),y=i("b3be"),k=i("b05e"),x=50,w={name:"createStockInBill",components:{orderInfo:S["a"],orderItem:v["a"],listComp:b["a"],storeItemComp:g["a"],itemRowEditPop:I["a"],itemSearchPop:y["a"],scanStoreComp:k["a"]},data:function(){return{query:this.$route.query,selcetPictureActionsheet:!1,actions:[{name:"拍摄",value:"Camera"},{name:"从手机相册选择",value:"Library"}],orderInfoData:{accountDTO:{},orderDate:(new Date).getTime(),assignState:0,billEmp:"",billMemo:"",billState:0,businessDate:(new Date).getTime(),businessTypeDTO:{},supplierDTO:{},shopDTO:{},details:[],updateIndicator:"Append"},selcetPictureMode:{},orderItemList:[],dateType:"business",currentDate:new Date,shopPopShow:!1,shopList:[],searchShopKey:null,onShopLoading:!1,shopListLoadFinished:!1,datePickerShow:!1,supplierPopShow:!1,supplierList:[],billTypePopShow:!1,billTypeList:[],itemStorePopShow:!1,storeItem:[],unitActions:[],unitActionShow:!1,itemRowEditPopShow:!1,itemEditRowData:{},itemInputFocusing:!1,modifyBusinessDateFlag:!0,itemSearchPopShow:!1,searchItem:[],storeScanPopShow:!1}},created:function(){var t=this;this.$fxStateMiddleware.stateIs("loginerOrganType")(["shop","center"])(this.loginerOrganType)&&(this.orderInfoData.shopDTO={id:this.loginerShopId,name:this.loginerShopName},2===this.systemParams.sysShopInWorkDate&&this.$fxHttp.requestGet({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/users/").concat(this.loginerId,"/nextaccountperiod")}).then(function(e){e.shopAccountPeriods.length&&(t.orderInfoData.businessDate=e.shopAccountPeriods[0].beginDate)})),this.modifyBusinessDateFlag=!0},beforeRouteLeave:function(t,e,i){var n=this;if(this.itemInputFocusing)return this.$router.go(1),!1;"/stockInBill"===t.path?this.$dialog.confirm({title:"提示",message:"若已修改,请先保存单据<br/>是否关闭页面?"}).then(function(){i()}).catch(function(){return n.$router.go(1),!1}):i()},computed:Object(f["a"])({},Object(m["c"])({sysPointSize:"sysPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerShopName:function(t){return t.loginer.loginerShopName},loginerOrganType:function(t){return t.loginer.loginerOrganType},loginerId:function(t){return t.loginer.loginerId},systemParams:"systemParams"}),{isBillState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.billState):e.orderInfoData.billState===t}}}),methods:{setDetailGoodsUUid:function(t){var e=this;t.forEach(function(t){t.details.forEach(function(t){t.goodsUUid=e.$fxUtils.createUUID()})})},onShopClick:function(){if(this.$fxStateMiddleware.stateIs("loginerOrganType")("shop")(this.loginerOrganType))return!0;this.shopListStart=0,this.searchShopKey=null,this.shopListLoadFinished=!1,this.onShopRefresh()},searchShop:function(t){this.shopListStart=0,this.searchShopKey=t,this.onShopRefresh()},onShopLoad:function(){var t=this;this.getShopListData().then(function(e){var i;(i=t.shopList).push.apply(i,Object(p["a"])(e.shops))})},onShopRefresh:function(){var t=this;this.getShopListData().then(function(e){t.shopList=e.shops,t.shopPopShow=!0})},getShopListData:function(){var t=this;return new h.a(function(e){var i={start:t.shopListStart,size:x,m:"list4ShopOtherOrderBill4Edit",keyword:t.searchShopKey};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/shops"),data:i}).then(function(i){t.onShopLoading=!1,t.shopListStart+=x,i.shops.length<x?t.shopListLoadFinished=!0:t.shopListLoadFinished=!1,e(i)})})},selectShop:function(t){var e=this;this.checkShop(t).then(function(){e.clearItemConfim("更换入库机构清空供货商和明细,是否继续?").then(function(){e.orderInfoData.shopDTO=t,e.orderInfoData.supplierDTO={},2===e.systemParams.sysShopInWorkDate&&e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(t.id,"/users/").concat(e.loginerId,"/nextaccountperiod")}).then(function(t){t.shopAccountPeriods.length&&(e.orderInfoData.businessDate=t.shopAccountPeriods[0].beginDate)})})})},checkShop:function(t){var e=this;return new h.a(function(i){var n=e.orderInfoData.shopDTO||{};n.id!==t.id&&i()})},onSupplierClick:function(){var t=this;if(!this.orderInfoData.shopDTO.id)return this.$fxToast.fail("请选择入库机构！"),!1;this.getSupplierListData().then(function(e){t.supplierList=e.suppliers,t.supplierPopShow=!0})},searchSupplier:function(t){var e=this;this.getSupplierListData(t).then(function(t){e.supplierList=t.suppliers,e.supplierPopShow=!0})},getSupplierListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new h.a(function(i){var n={paged:!0,size:50,start:0,searchText:e};t.$fxHttp.requestPost({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.orderInfoData.shopDTO.id,"/users/").concat(t.loginerId,"/suppliers"),data:n}).then(function(t){i(t)})})},selectSupplier:function(t){var e=this;this.checkSupplier(t).then(function(){e.clearItemConfim("更换供货商清空明细，是否确认修改?").then(function(){e.orderInfoData.supplierDTO=t})})},checkSupplier:function(t){var e=this;return new h.a(function(i){var n=e.orderInfoData.supplierDTO||{};n.id!==t.id&&i()})},onBusinessDateClick:function(){this.dateType="business",this.orderInfoData.businessDate&&(this.currentDate=new Date(this.orderInfoData.businessDate)),this.datePickerShow=!0},onOrderDateClick:function(){this.dateType="order",this.datePickerShow=!0},dateConfirmhandle:function(t){var e=t.getTime();"business"===this.dateType?this.orderInfoData.businessDate=e:this.orderInfoData.orderDate=e,this.datePickerShow=!1},getBillTypeListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new h.a(function(i){var n={m:"list4ShopStockInBillEdit",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/businessTypes"),data:n}).then(function(t){i(t)})})},onBillTypeClick:function(){var t=this;this.getBillTypeListData().then(function(e){t.billTypeList=e.businessTypes,t.billTypePopShow=!0})},searchBillType:function(t){var e=this;this.getBillTypeListData(t).then(function(t){e.billTypeList=t.businessTypes,e.billTypePopShow=!0})},selectBillType:function(t){this.orderInfoData.businessTypeDTO=t},onBillTypeClear:function(){this.orderInfoData.businessTypeDTO={}},clearItemConfim:function(t){var e=this;return new h.a(function(i){var n=e.orderItemList.filter(function(t){var e=t.details.filter(function(t){return"del"!==t.changeType});return 0!==e.length});0===n.length?i():e.$dialog.confirm({title:"提示",message:t}).then(function(){e.onItemClear(),i()}).catch(function(){})})},onItemClear:function(){this.orderInfoData.details=[],this.orderItemList=this.orderInfoData.details},onAddClick:function(){var t=this;this.checkOrderInfo().then(function(){t.storeItem=JSON.parse(u()(t.orderItemList)),t.itemStorePopShow=!0})},onScanClick:function(){var t=this;this.checkOrderInfo().then(function(){t.storeItem=JSON.parse(u()(t.orderItemList)),t.storeScanPopShow=!0})},checkOrderInfo:function(){var t=this;return new h.a(function(e,i){t.orderInfoData.businessDate?t.orderInfoData.shopDTO.id?t.orderInfoData.supplierDTO.id?!t.orderInfoData.billMemo&&t.$fxAuth("shopStockInBill.billMemoRequired")?t.$fxToast.fail("请填写备注!"):e():t.$fxToast.fail("请先选择供货商!"):t.$fxToast.fail("请先选择入库机构!"):t.$fxToast.fail("请先选择业务日期!")})},onStoreItemSave:function(t){this.orderInfoData.details=t,this.orderItemList=this.orderInfoData.details,this.setDetailGoodsUUid(this.orderItemList)},onCreateClick:function(){var t=this;if(this.itemInputFocusing)return!1;this.$dialog.confirm({title:"提示",message:"确定生成单据吗?"}).then(function(){t.checkDetails().then(function(){var e=t.getSaveParams();t.createHandler(e)})}).catch(function(){})},createHandler:function(t){var e=this;this.$fxHttp.requestPost({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/stockinbills"),data:t}).then(function(t){e.$fxToast.success("生成单据成功").then(function(){e.$router.replace({path:"stockInBillDetails",query:{orderId:t.storeBills[0].id}})})})},getSaveParams:function(){var t=[];this.orderItemList.forEach(function(e){t.push.apply(t,Object(p["a"])(e.details))});var e=t.filter(function(t){return"add"===t.changeType}),i=c()({},this.orderInfoData,{detailAdd:e,accountDTO:{id:this.loginerId}});return i},getValidItem:function(){var t=[];return this.orderItemList.forEach(function(e){t.push.apply(t,Object(p["a"])(e.details))}),t},getItemLength:function(){return this.getValidItem().length},checkDetails:function(){var t=this;return new h.a(function(e){if(t.$fxSysAuth("shopStockInBill.sysStockProductionDate")){var i=t.getValidItem(),n=i.reduce(function(t,e){var i="";return i=!e.productDate&&e.goodsDTO.periodFlag?""===t?t+e.goodsDTO.name:t+"<br/>"+e.goodsDTO.name:t,i},"");if(""!==n)return t.$dialog.alert({title:"提示",message:n+"生产日期不能为空！"}),!1}0===t.getItemLength()?t.onAddClick():e()})},onItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onUnitEdit:function(t){var e=this;this.itemEditRowData=t,this.getItemUnit(t.goodsDTO.id).then(function(t){e.unitActions=t,e.unitActionShow=!0})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemEditRowData,i=e.unitDTO.value,n=t,o=a()(e.busUnitInAmount);o>0?(o=o*i/n.value,e.busUnitInAmount=a()(this.$fxUtils.toFixedSHW(o,this.sysPointSize)),this.calcMoney("moneyWithTax",e.inMoneyWithTax,e)):(e.taxPrice=a()(e.taxPrice)*n.value/i,e.costTaxPrice=a()(e.costTaxPrice)*n.value/i,this.calcMoney("taxPrice",e.taxPrice,e));var s=a()(e.outOrderAmount);s=s*i/n.value,e.outOrderAmount=s,e.unitDTO=t},getItemUnit:function(t){var e=this;return new h.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/users/").concat(e.loginerId,"/goods/").concat(t,"/units")}).then(function(t){i(t.units)})})},calcMoney:function(t,e,i){var n=i.taxPrice,o=i.busUnitInAmount,s=i.price,a=i.tax,r=0,c=0,l=0,u=0;if(e=this.toFixedNumberSize(e),i.giftFlag||"money"===t&&0===e)return i.inMoney=0,i.inMoneyWithTax=0,i.taxInMoney=0,!0;"money"===t?(r=e,l=this.toFixedNumberSize(r/o),c=r*(1+a),u=this.toFixedNumberSize(c/o)):"amount"===t?(i.busUnitInAmount=e,l=s,u=n,r=this.toFixedNumberSize(s*e),c=this.toFixedNumberSize(n*e)):"moneyWithTax"===t?(c=e,u=this.toFixedNumberSize(c/o),r=this.toFixedNumberSize(c/(1+a)),l=this.toFixedNumberSize(r/o)):"taxPrice"===t?(u=e,c=this.toFixedNumberSize(o*u),l=this.toFixedNumberSize(u/(1+a)),r=this.toFixedNumberSize(l*o)):"price"===t&&(l=e,r=this.toFixedNumberSize(l*o),u=this.toFixedNumberSize(l*(1+a)),c=this.toFixedNumberSize(o*u)),i.inMoney=r,i.inMoneyWithTax=c,i.taxInMoney=this.toFixedNumberSize(this.toFixedNumberSize(c)-this.toFixedNumberSize(r)),i.price=l,i.taxPrice=u},toFixedNumberSize:function(t){return a()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},onEditRowConfirm:function(t){var e=this.orderItemList.findIndex(function(e){return e.id===t.inHouseDTO.id});if(~e){var i=this.orderItemList[e].details.findIndex(function(e){return e.goodsDTO.id===t.goodsDTO.id});~i&&(this.orderItemList[e].details[i]=t)}},onItemFocus:function(){this.$refs.orderInfo.closeCollapse()},onSearchClick:function(){this.itemSearchPopShow=!0,this.searchItem=JSON.parse(u()(this.orderItemList))},onSearchConfirm:function(t){this.orderItemList=t},onSelect:function(t){this.selcetPictureMode=Object(f["a"])({},t,{random:Math.random()}),this.selcetPictureActionsheet=!1}}},C=w,D=(i("2ad9"),i("2877")),T=Object(D["a"])(C,n,o,!1,null,"cc307010",null);e["default"]=T.exports},"56f5":function(t,e,i){"use strict";var n=i("c0db"),o=i.n(n);o.a},"5d48":function(t,e,i){"use strict";var n=i("c5bf"),o=i.n(n);o.a},6053:function(t,e,i){},"673b":function(t,e,i){"use strict";var n=i("fc9a"),o=i.n(n);o.a},"697a":function(t,e,i){"use strict";var n=i("e0a9"),o=i.n(n);o.a},"6cf2":function(t,e,i){"use strict";var n=i("7da0"),o=i.n(n);o.a},"72e4":function(t,e,i){},"786c":function(t,e,i){},"7b2e":function(t,e,i){"use strict";var n=i("8a0e"),o=i.n(n);o.a},"7da0":function(t,e,i){},8533:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"itemRowEdit-popup"},[i("w-header",{attrs:{title:t.currentItemData.goodsDTO.name,leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{ref:"rowEditContent",staticClass:"itemRowEdit-content"},[i("van-cell-group",[i("van-cell",{attrs:{title:"入库数量",value:t.currentItemData.busUnitInAmount,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"单位",value:t.currentItemData.unitDTO.name,"value-class":"info-item-value"}}),i("van-cell",{attrs:{title:"仓位编号",value:t.currentItemData.positionCode,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopStockInBill.seePrice"),expression:"$fxAuth('shopStockInBill.seePrice')"}],attrs:{value:t.currentItemData.price,title:"非税单价","value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopStockInBill.seeNoTaxMoney"),expression:"$fxAuth('shopStockInBill.seeNoTaxMoney')"}],attrs:{value:t.currentItemData.inMoney,title:"非税金额","value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopStockInBill.seeTaxMoney"),expression:"$fxAuth('shopStockInBill.seeTaxMoney')"}],class:{"text-tax":!t.isDisabled},attrs:{title:"税率",value:t.fomatterTaxes(t.currentItemData.tax),"is-link":!t.isDisabled,"value-class":"info-item-value"},on:{click:t.onTaxClick}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopStockInBill.seeTaxMoney"),expression:"$fxAuth('shopStockInBill.seeTaxMoney')"}],attrs:{title:"税额",value:t.currentItemData.taxInMoney,"value-class":"info-item-value"}}),i("van-pro-number-field",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopStockInBill.seePrice"),expression:"$fxAuth('shopStockInBill.seePrice')"}],ref:"taxPriceInput",attrs:{label:"含税单价","input-align":"right",min:"0",max:t.maxAmount,intLength:t.numberLength,pointSize:t.sysPointSize,disabled:!t.$fxAuth("shopStockInBill.editPrice")||t.isDisabled||0===t.currentItemData.busUnitInAmount},on:{change:function(e){return t.onTaxPriceChange(t.currentItemData.taxPrice)}},model:{value:t.currentItemData.taxPrice,callback:function(e){t.$set(t.currentItemData,"taxPrice",e)},expression:"currentItemData.taxPrice"}}),i("van-cell",{attrs:{title:"生产日期",value:t.fomatterDate(t.currentItemData.productDate),"is-link":!t.isDisabled},on:{click:t.onProductDateClick}}),i("van-cell",{attrs:{title:"品项编号",value:t.currentItemData.goodsDTO.code,"value-class":"info-item-value"}}),i("van-switch-cell",{staticClass:"info-item-value",attrs:{disabled:t.isDisabled||t.hasFatherIsEdit,title:"赠送"},on:{change:t.changeGiftFlag},model:{value:t.currentItemData.giftFlag,callback:function(e){t.$set(t.currentItemData,"giftFlag",e)},expression:"currentItemData.giftFlag"}}),i("van-cell",{attrs:{title:"批次号",value:t.currentItemData.batchCode,"value-class":"info-item-value"}}),i("van-pro-field",{ref:"memo",attrs:{placeholder:t.setPlaceholder("请输入备注"),disabled:t.isDisabled,label:"备注","input-align":"right"},on:{focus:function(e){return t.onFocus("memo")}},model:{value:t.currentItemData.memo,callback:function(e){t.$set(t.currentItemData,"memo",e)},expression:"currentItemData.memo"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.hasFatherIsEdit,expression:"hasFatherIsEdit"}],attrs:{title:"EDI发货数量",value:t.currentItemData.ediDeliveryAmount,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.hasFatherIsEdit,expression:"hasFatherIsEdit"}],attrs:{title:"EDI单价",value:t.currentItemData.ediDeliveryPrice,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.hasFatherIsEdit,expression:"hasFatherIsEdit"}],attrs:{title:"EDI含税金额",value:t.currentItemData.ediDeliveryMoneyWithTaxes,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.hasFatherIsEdit,expression:"hasFatherIsEdit"}],attrs:{title:"EDI税率",value:t.currentItemData.ediDeliveryTaxes+"%","value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"净重量",value:t.toFixedNumberSize(t.currentItemData.netWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"皮重量",value:t.toFixedNumberSize(t.currentItemData.skinWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"毛重量",value:t.toFixedNumberSize(t.currentItemData.grossWeight),"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"称重单位",value:t.currentItemData.weightUnit,"value-class":"info-item-value"}}),i("van-cell",{directives:[{name:"show",rawName:"v-show",value:t.sysShowDZCData,expression:"sysShowDZCData"}],attrs:{title:"称重状态",value:t.currentItemData.isWeightSign?"已称重":"未称重","value-class":"info-item-value"}}),i("stock-select-image",t._g(t._b({directives:[{name:"show",rawName:"v-show",value:t.currentItemData.id,expression:"currentItemData.id"}],attrs:{disabled:t.isDisabled,uploadAble:6,currentItemData:t.currentItemData},on:{pictureChange:t.pictureChange}},"stock-select-image",t.$props,!1),t.$listeners))],1)],1),i("div",{staticClass:"itemRowEdit-bottom"},[t.isDisabled?t._e():i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onConfirmClick}},[t._v("保存")])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("taxesActionSheet",{attrs:{sync:!0},on:{"on-taxes-select":t.onTaxesSelect},model:{value:t.taxesActionShow,callback:function(e){t.taxesActionShow=e},expression:"taxesActionShow"}})],1)},o=[],s=i("59ad"),a=i.n(s),r=(i("28a5"),i("795b")),c=i.n(r),l=i("f499"),u=i.n(l),d=i("cebc"),h=i("2f62"),p=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"show",rawName:"v-show",value:t.picture.length||!t.isDisabled,expression:"picture.length || !isDisabled"}],staticClass:"StockSelectImage"},[t._l(t.picture,function(e,i){return n("div",{directives:[{name:"show",rawName:"v-show",value:t.picture,expression:"picture"}],key:i+e.imagUrl},[n("img",{attrs:{src:e.imagUrl}}),n("van-icon",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"img-del",attrs:{size:"20px",name:"clear",color:"#FC4E49"},on:{click:function(n){return t.del(e,i)}}})],1)}),n("div",{directives:[{name:"show",rawName:"v-show",value:!t.picture||t.picture.length<t.uploadAble,expression:"!picture || picture.length<uploadAble"}],on:{click:t.showSelect}},[n("img",{attrs:{src:i("9fd4")}})])],2)},f=[],m=(i("c5f6"),i("9541"),{name:"StockSelectImage",props:{selcetPictureMode:{type:Object,default:function(){}},currentItemData:{type:Object,default:function(){}},uploadAble:{type:Number,default:1},isDisabled:{type:Boolean,default:!1}},data:function(){return{picture:[],delArr:[]}},methods:{add:function(t){this.picture.push({imagUrl:t,type:"add"})},del:function(t,e){"add"!==t.type&&this.delArr.push(t),this.picture.splice(e,1)},showSelect:function(){this.$emit("on-selcet-iamge")},getPictureData:function(t){var e=this;this.$fxCordova&&this.$fxCordova.camera?this.$fxCordova.camera["getPictureBy".concat(t)]().then(function(t){e.add("data:image/jpeg;base64,".concat(t))}):this.$fxToast.fail("未获取到$fxCordova")}},watch:{currentItemData:{handler:function(t){this.picture=t&&t.images?JSON.parse(u()(t.images)):[],this.delArr=[]},immediate:!0},selcetPictureMode:{handler:function(t){t.value&&this.getPictureData(t.value)}},picture:{handler:function(t){this.$emit("pictureChange",t,this.delArr)}}}}),S=m,v=(i("6cf2"),i("2877")),b=Object(v["a"])(S,p,f,!1,null,"f517d064",null),g=b.exports,I=i("f729"),y={name:"itemRowEdit",components:{taxesActionSheet:I["a"],stockSelectImage:g},props:{visibleFlag:Boolean,itemData:{type:Object,default:function(){return{}}},selcetPictureMode:{type:Object,default:function(){}},hasFatherBillFlag:Boolean,isDisabled:Boolean},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},delImagesArr:[],currentItemData:{},currentDate:new Date,datePickerShow:!1,taxesActionShow:!1}},computed:Object(d["a"])({},Object(h["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",maxAmount:"maxAmount",uploadCloud:function(t){return t.systemParams.uploadCloud},sysShowDZCData:function(t){return t.systemParams.sysShowDZCData},loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{fomatterDate:function(t){var e=this;return function(t){return t?e.$fxUtils.setDateTime(new Date(t),"时分"):""}},fomatterTaxes:function(t){var e=this;return function(t){if(t){var i=e.$fxUtils.toFixedSHW(100*t,2,!1);return"".concat(i,"%")}return"0%"}},setPlaceholder:function(t){var e=this;return function(t){return e.isDisabled?"":t}},comptedItemImgSrc:function(t){return function(t){return t?0===t.length?"":t[0].imagUrl:""}},hasFatherIsEdit:function(){return this.hasFatherBillFlag&&!!this.currentItemData.preDetailId}}),watch:{visibleFlag:{handler:function(t){t&&(this.currentItemData=JSON.parse(u()(this.itemData)))},immediate:!0}},methods:{pictureChange:function(t,e){this.currentItemData.images=t,this.delImagesArr=e},onCloseClick:function(){var t=this;this.onCheckMoneyOrAmount().then(function(){t.$emit("update:visibleFlag",!1)}).catch(function(){t.$refs.taxPriceInput.setFocus()})},onConfirmClick:function(){var t=this;this.onCheckMoneyOrAmount().then(function(){t.currentItemData.id?(t.currentItemData.changeType="edit",t.saveBill().then(function(e){return t.saveNotice()})):t.saveNotice()}).catch(function(){t.$refs.taxPriceInput.setFocus()})},saveBill:function(){var t=this;return new c.a(function(e,i){var n=[];t.currentItemData.images.map(function(t){t.type&&"add"===t.type&&n.push(t.imagUrl)});var o=t.delImagesArr.map(function(t){return t.imagUrl}),s={"input_files[]":n,del_filename:o};n.length||o.length?t.$fxHttp.requestPost({url:"".concat(t.$fxBaseApi.url,"/upload/detailId/").concat(t.currentItemData.id,"/uploadDetailPicturesMultipleWithMaxCount"),data:s}).then(function(i){t.resetImagesUrl(i.storeBillImags),e()}).catch(function(t){return i(t)}):e()})},getLasturl:function(t){if(null!==t||""!==t){var e=t.split("http://"),i=e[1].indexOf("/");return e[1].substring(i+1)}return!1},resetImagesUrl:function(t){this.currentItemData.images=t},saveNotice:function(){this.$emit("on-Confirm",this.currentItemData),this.$emit("update:visibleFlag",!1)},onProductDateClick:function(){if(this.isDisabled)return!1;this.currentItemData.productDate&&(this.currentDate=new Date(this.currentItemData.productDate)),this.datePickerShow=!0},dateConfirmhandle:function(t){this.currentItemData.productDate=t.getTime(),this.datePickerShow=!1},onTaxClick:function(){var t=this;if(this.isDisabled||!this.$fxAuth("shopStockInBill.editTax"))return!1;this.onCheckMoneyOrAmount().then(function(){t.taxesActionShow=!0}).catch(function(){t.$refs.taxPriceInput.setFocus()})},onTaxesSelect:function(t){this.currentItemData.tax=t.tax,this.computedByTaxes(t.tax)},computedByTaxes:function(t){var e=this.currentItemData,i=e.price,n=e.busUnitInAmount,o=e.inMoney,s=e.taxInMoney,r=e.inMoneyWithTax;i=a()(this.$fxUtils.toFixedSHW(r/n/(1+t),this.sysPointSize)),o=a()(this.$fxUtils.toFixedSHW(i*n,this.sysPointSize)),s=a()(this.$fxUtils.toFixedSHW(r-o,this.sysPointSize)),this.currentItemData.price=i,this.currentItemData.inMoney=o,this.currentItemData.taxInMoney=s},onTaxPriceChange:function(t){this.calcMoney("taxPrice",t,this.currentItemData)},calcMoney:function(t,e,i){var n=i.taxPrice,o=i.busUnitInAmount,s=i.price,a=i.tax,r=0,c=0,l=0,u=0;if(e=this.toFixedNumberSize(e),i.giftFlag||"money"===t&&0===e)return i.inMoney=0,i.inMoneyWithTax=0,i.taxInMoney=0,!0;"money"===t?(r=e,l=this.toFixedNumberSize(r/o),c=this.toFixedNumberSize(r*(1+a)),u=this.toFixedNumberSize(c/o)):"amount"===t?(i.busUnitInAmount=e,l=s,u=n,r=this.toFixedNumberSize(s*e),c=this.toFixedNumberSize(n*e)):"moneyWithTax"===t?(c=e,u=this.toFixedNumberSize(c/o),r=this.toFixedNumberSize(c/(1+a)),l=this.toFixedNumberSize(r/o)):"taxPrice"===t?(u=e,c=this.toFixedNumberSize(o*u),l=this.toFixedNumberSize(u/(1+a)),r=this.toFixedNumberSize(l*o)):"price"===t&&(l=e,r=this.toFixedNumberSize(l*o),u=this.toFixedNumberSize(l*(1+a)),c=this.toFixedNumberSize(o*u)),i.inMoney=r,i.inMoneyWithTax=c,i.taxInMoney=this.toFixedNumberSize(this.toFixedNumberSize(c)-this.toFixedNumberSize(r)),i.price=l,i.taxPrice=u},toFixedNumberSize:function(t){return a()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},changeGiftFlag:function(){this.currentItemData.giftFlag?(this.currentItemData.inMoney=0,this.currentItemData.inMoneyWithTax=0,this.currentItemData.taxInMoney=0):this.calcMoney("price",this.currentItemData.price,this.currentItemData)},onTaxPriceBlur:function(){var t=this;this.onCheckMoneyOrAmount().then(function(){}).catch(function(){t.$refs.taxPriceInput.setFocus()})},onCheckMoneyOrAmount:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new c.a(function(i,n){var o="不符合规则",s=t.currentItemData,a=t.currentItemData.pricePlanDTO,r=s.getPriceWay;if(!t.$fxUtils.isDef(a))return i(),!1;if(!s.giftFlag&&"1"===r&&a.priced){var c=s.taxPrice,l=t.toFixedNumberSize(a.floatRate),u=t.toFixedNumberSize(a.downFloatRate),d=a.priceWithTax/a.unit.value*s.unitDTO.value,h=t.toFixedNumberSize(d*(1-u/100)),p=t.toFixedNumberSize(d*(1+l/100));c<h||c>p?t.$nextTick(function(){if(e){var i="含税单价：请填写 "+h+" 到 "+p+" 范围内的数值！";t.$fxNotify.fail(i)}n(o)}):i()}else i()})},onFocus:function(t){this.onScrollTop(t)},onScrollTop:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,i=this.$refs[t];if(!i||0===i.length)return!1;var n=i.$el.offsetTop,o=this.$refs["rowEditContent"];this.$fxUtils.scrollTopW({offsetTop:n,$el:o,distance:e})}}},k=y,x=(i("56f5"),Object(v["a"])(k,n,o,!1,null,"d155cee6",null));e["a"]=x.exports},"865d":function(t,e,i){},"8a0e":function(t,e,i){},"90bc":function(t,e,i){"use strict";var n=i("bfe1"),o=i.n(n);o.a},9541:function(t,e,i){"use strict"},"95a8":function(t,e,i){"use strict";var n=i("fd54"),o=i.n(n);o.a},"987b":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-info-cell"},[i("div",{staticClass:"item-img"},[i("img",{attrs:{src:t.comptedItemImgSrc(t.itemData.goodsDTO.imageUrls),onerror:t.$fxCommon.errorImg("item")}})]),i("div",{staticClass:"item-details"},[i("div",{staticClass:"item-name fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.name))]),i("div",{staticClass:"details-cell"},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopStockInBill.seeWithTaxMoney"),expression:"$fxAuth('shopStockInBill.seeWithTaxMoney')"}],staticClass:"item-taxprice fx-ellipsis"},[i("span",[t._v("含税金额：￥")]),t.isDisabled||!t.$fxAuth("shopStockInBill.editWithTaxMoney")||t.itemData.giftFlag||0===t.itemData.busUnitInAmount?i("span",[t._v(t._s(t.itemData.inMoneyWithTax))]):i("w-number-input",{ref:"moneyInput",staticClass:"item-taxprice-input",attrs:{min:"0",max:t.maxAmount,intLength:t.numberLength,pointSize:t.sysPointSize},on:{change:function(e){return t.onMoneyChange(t.itemData.inMoneyWithTax)},focus:t.onFocus,blur:t.onBlur},model:{value:t.itemData.inMoneyWithTax,callback:function(e){t.$set(t.itemData,"inMoneyWithTax",e)},expression:"itemData.inMoneyWithTax"}})],1)]),i("div",{staticClass:"details-cell"},[i("div",{staticClass:"item-spec fx-ellipsis"},[t._v(t._s(t.itemData.goodsDTO.spec))]),t.isDisabled||t.itemData.isWeightSign&&!t.sysDZCCanModifyAcount||!t.$fxAuth("shopStockInBill.editAmount")?i("div",{staticClass:"item-amount"},[i("span",[t._v(t._s(t.itemData.busUnitInAmount))])]):i("div",{staticClass:"item-amount-edit"},[i("w-stepper",{ref:"amountInput",staticClass:"amount-step",attrs:{min:"0",max:t.maxAmount,stepperBtnShow:!1,intLength:t.numberLength,pointSize:t.sysPointSize},on:{change:t.onChange,focus:t.onFocus,blur:t.onBlur},model:{value:t.itemData.busUnitInAmount,callback:function(e){t.$set(t.itemData,"busUnitInAmount",e)},expression:"itemData.busUnitInAmount"}})],1),i("div",{staticClass:"unit-text"},[i("span",{staticClass:"fx-ellipsis cell-unit",on:{click:function(e){return e.stopPropagation(),t.onUnitClick(e)}}},[t._v(t._s(t.itemData.unitDTO.name))]),i("van-icon",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&t.sysStockInChangeUnit,expression:"!isDisabled && sysStockInChangeUnit"}],staticClass:"unit-icon",attrs:{name:"arrow-down"}})],1)])]),i("i",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&!t.disabledEditBtn,expression:"!isDisabled && !disabledEditBtn"}],staticClass:"block-item-edit",on:{click:t.onItemEditClick}}),i("i",{directives:[{name:"show",rawName:"v-show",value:t.isDisabled&&t.showEditBtn,expression:"isDisabled && showEditBtn"}],staticClass:"block-item-watch",on:{click:t.onItemEditClick}})])},o=[],s=i("795b"),a=i.n(s),r=i("59ad"),c=i.n(r),l=i("cebc"),u=i("2f62"),d={name:"itemInfoCell",props:{itemData:{type:Object,default:function(){return{}}},isDisabled:Boolean,sysStockInChangeUnit:{type:Boolean,default:function(){return!0}},disabledEditBtn:Boolean,showEditBtn:{type:Boolean,default:function(){return!0}},blurSetFocusFlag:{type:Boolean,default:!0}},computed:Object(l["a"])({},Object(u["c"])({sysDZCCanModifyAcount:function(t){return t.systemParams.sysDZCCanModifyAcount},sysPointSize:"sysPointSize",numberLength:"numberLength",maxAmount:"maxAmount"}),{comptedItemImgSrc:function(t){return function(t){return null===t?"":t[0]}}}),data:function(){return{isHasGoods:!1}},methods:{onChange:function(t){this.amountChange(t)},editItem:function(){this.itemData.id&&this.$set(this.itemData,"changeType","edit")},amountChange:function(t){this.editItem(),this.calcMoney("amount",t,this.itemData),this.itemData.weightState=0,this.hasGoodsChange(t)},onMoneyChange:function(t){this.editItem(),this.calcMoney("moneyWithTax",t,this.itemData)},calcMoney:function(t,e,i){var n=i.taxPrice,o=i.busUnitInAmount,s=i.price,a=i.tax,r=0,c=0,l=0,u=0,d=this.toFixedNumberSize(e);if(i.giftFlag||"money"===t&&0===d)return i.inMoney=0,i.inMoneyWithTax=0,i.taxInMoney=0,!0;"money"===t?(r=d,l=this.toFixedNumberSize(r/o),c=r*(1+a),u=this.toFixedNumberSize(c/o)):"amount"===t?(""!==e&&(i.busUnitInAmount=d),l=s,u=n,r=this.toFixedNumberSize(s*d),c=this.toFixedNumberSize(n*d)):"moneyWithTax"===t?(c=d,u=this.toFixedNumberSize(c/o),r=this.toFixedNumberSize(c/(1+a)),l=this.toFixedNumberSize(r/o)):"taxPrice"===t?(u=d,c=this.toFixedNumberSize(o*u),l=this.toFixedNumberSize(u/(1+a)),r=this.toFixedNumberSize(l*o)):"price"===t&&(l=d,r=this.toFixedNumberSize(l*o),u=this.toFixedNumberSize(l*(1+a)),c=this.toFixedNumberSize(o*u)),i.inMoney=r,""!==e&&(i.inMoneyWithTax=c),i.taxInMoney=this.toFixedNumberSize(this.toFixedNumberSize(c)-this.toFixedNumberSize(r)),i.price=l,i.taxPrice=u},toFixedNumberSize:function(t){return c()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},hasGoodsChange:function(t){0!==c()(t)&&this.itemData.shortageFlag?(this.isHasGoods=this.itemData.shortageFlag,this.itemData.shortageFlag=!1):0===t&&this.isHasGoods&&(this.itemData.shortageFlag=!0)},onItemEditClick:function(){this.editItem(),this.$emit("on-item-edit",this.itemData)},onUnitClick:function(){if(this.isDisabled||!this.sysStockInChangeUnit)return!1;this.editItem(),this.$emit("on-unit-edit",this.itemData)},onCheckAmount:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new a.a(function(i,n){var o=t.itemData,s=o.goodsDTO,a=t.itemData,r=a.busUnitInAmount,c=a.outOrderAmount,l="数量不符合规则",u=o.getPriceWay,d=t.itemData.pricePlanDTO;if(!o.giftFlag&&"1"===u&&d.priced){var h=o.taxPrice,p=t.toFixedNumberSize(d.floatRate),f=t.toFixedNumberSize(d.downFloatRate),m=d.priceWithTax/d.unit.value*o.unitDTO.value,S=t.toFixedNumberSize(m*(1-f/100)),v=t.toFixedNumberSize(m*(1+p/100));if(h<S||h>v)return t.$nextTick(function(){if(e){var i="含税单价：请填写 "+S+" 到 "+v+" 范围内的数值！";t.$fxNotify.fail(i)}}),n(l),!1}c>0&&"0"===s.disOvercharge&&r>c+c*s.overchargePortion/100?(e&&t.$fxNotify.fail("入库数量不能超出订货数量"+s.overchargePortion+"%"),n(l)):i()})},onFocus:function(){this.$emit("on-item-focus")},onBlur:function(){var t=this,e=!0;this.blurSetFocusFlag||(e=!1),this.onCheckAmount(e).then(function(){t.$emit("on-item-blur")}).catch(function(){t.blurSetFocusFlag?(t.$refs.moneyInput.setFocus(),t.$emit("on-item-focus")):t.$emit("on-item-blur-fail")})}}},h=d,p=(i("1db1"),i("2877")),f=Object(p["a"])(h,n,o,!1,null,"1082a1fe",null);e["a"]=f.exports},"9fd4":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAACgCAYAAACLz2ctAAADoElEQVR4nO3cMYibZRwG8CfH0aGIOrgcXUQHcRNyg05VqdTZtUPdom5u3aybm7hYbxFdHRycWuxQJ5fvoLPlRBcdnIQq4mBLjk89Qs8SzeWRy+8HGRK++97kzZ97/3mffJkMw5AkzyZ5L8mFJGfzt7eSXDty/8Mkb+Z4jnf8w46/lORmkitJ7mwneSbJ10ke+4cTwao8muS1JC8neX7+H/Bikg+SfJPkjSQ/mGpO0E6Sj5O8muTzP5fgrSRnkvxm5lmDnfEf3d2tcaw/FB9r9OM41CPbZp2Sp+fDzgvwy3H8V7wTrNG3GQvwglmnZcvM06QHpOUgCpCip2IJpk0BUqUAqdq2/0fT9vjVGKiwBFNlG4YWWTBVsmD69IBU6QFpkQVTJQumTwFSpQCpkgVTJQumyhJMlW0YWmTBVMmC6dMDUqUHpEUWTJUsmD4FSJUCpEoWTJUsmCpLMFW2YWiRBVMlC6ZPD0iVHpAWWTBVsmD6FCBVCpAqWTBVsmCqLMFU2YahRRZMlSyYPj0gVRvfA+7u7i79N3t7e1eTvLPw8Luz2ezqsucahmHp8U8JWTBVsmD6FCBVCpAqWTBVsmCqLMFU2YahRRZMlSyYPj0gVXpAWmTBVMmC6VOAVClAqmTBVMmCqbIEUzXZhGsS9vf330/y3ApP+eR4O+q78bYy0+n0pVWe73/mcBtmU7LgefG9eMJjPKgoOZ4smD49IFWiOFo2Kgt+O8njKzzf5SSvLzz2SZJPVzjGaffXh5BTbzqd3j7uNf7LX0Z40Aea72ez2a1lz7XBv4xwSA9IlQKkShZMlSyYKkswVfYBaXFdMFWyYPr0gFTpAWlxXTBVrgumTwFSpQCpkgVTJQumyhJMlW0YWmTB/8H8AvTFr9+v9KL0DXCYBc9/GeHe+Fonmz4jrJ8ekCo9IC2yYKpkwfQpQKoUIFWyYKpkwVRZgqmyDUOLLJgq1wXTpwekSg9IiyyYKlkwfQqQKgVIlSyYKlkwVZZgqmzD0CILpkoWTJ8ekCo9IC2yYKpkwfQpQKoUIFWyYKpkwVRZgqmyDUOLLJgqWTB9ekCq9IC0yIKpkgXTpwCpUoBUyYKpkgVTZQmmyjYMLbJgqmTB9OkBqdID0iILpkoWTN+8AO+Oz2LH+8GanBuH+XW+BF9P8nOSX8w+a/BEko/GYb6YDMNwJsnvR8a995DnMFm473jHL3P8xSQ3kvyU5IWtheKDk/ZVks+SnE9ycB+z3qebG/hSKwAAAABJRU5ErkJggg=="},a348:function(t,e,i){"use strict";var n=i("166f"),o=i.n(n);o.a},af41:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-number-keyboard fx-shadow-up"},[i("div",{staticClass:"number-keyboard-title"},[i("div",{staticClass:"title-name fx-ellipsis"},[t._v(t._s(t.title))]),i("div",{staticClass:"title-amount"},[t._v(t._s(t.amount))]),i("div",{staticClass:"title-unit",on:{click:t.onUnitClick}},[i("span",{staticClass:"title-unit-text fx-ellipsis"},[t._v(t._s(t.unit))]),i("i",{directives:[{name:"show",rawName:"v-show",value:t.unitEdit,expression:"unitEdit"}],staticClass:"title-unit-select"})])]),i("div",{staticClass:"number-keyboard-content"},[i("div",{staticClass:"keyboard-number"},[i("div",{staticClass:"keyboard-number-row"},[i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("1")}}},[t._v("1")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("2")}}},[t._v("2")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("3")}}},[t._v("3")]),i("i",{staticClass:"keyboard-btn-1 keyboard-btn-hide fx-Pseudo-btn",on:{click:t.hideKeyboardBtnClick}})]),i("div",{staticClass:"keyboard-number-row"},[i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("4")}}},[t._v("4")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("5")}}},[t._v("5")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("6")}}},[t._v("6")]),i("i",{staticClass:"keyboard-btn-1 keyboard-btn-del fx-Pseudo-btn",on:{click:t.delBtnClick}})]),i("div",{staticClass:"keyboard-number-row"},[i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("7")}}},[t._v("7")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("8")}}},[t._v("8")]),i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("9")}}},[t._v("9")]),t.shortcutBtn?i("i",{staticClass:"keyboard-btn-1 keyboard-btn-pre fx-Pseudo-btn",on:{click:t.preBtnClick}},[t._v("上一个")]):i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn"})]),i("div",{staticClass:"keyboard-number-row"},[i("i",{staticClass:"keyboard-btn-2 keyboard-btn-zero fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick("0")}}},[t._v("0")]),i("i",{staticClass:"keyboard-btn-1 keyboard-btn-dot fx-Pseudo-btn",on:{click:function(e){return t.numberBtnClick(".")}}},[t._v(".")]),t.shortcutBtn?i("i",{staticClass:"keyboard-btn-1 keyboard-btn-next fx-Pseudo-btn",on:{click:t.nextBtnClick}},[t._v("下一个")]):i("i",{staticClass:"keyboard-btn-1 fx-Pseudo-btn"})])])])])},o=[],s=(i("3b2b"),i("c5f6"),{name:"itemNumberKeyboard",props:{title:String,unit:String,amount:[String,Number],unitEdit:{type:Boolean,default:!1},integer:Boolean,pointSize:{type:[String,Number],default:4},intLength:{type:[String,Number],default:8},shortcutBtn:{type:Boolean,default:!0}},computed:{computedNumberReg:function(){return new RegExp("^\\d+(\\.|\\.\\d{1,".concat(this.pointSize-1,"})?$"))}},methods:{numberBtnClick:function(t){this.$emit("input",t),this.$emit("change",this.getAddValue(t))},delBtnClick:function(t){this.$emit("delete"),this.$emit("change",this.getDelValue(t))},preBtnClick:function(){this.$emit("pre")},nextBtnClick:function(){this.$emit("next")},hideKeyboardBtnClick:function(){this.$emit("hide")},onUnitClick:function(){this.$emit("on-unit-unitEdit")},getAddValue:function(t){var e=this.amount+"";return-1===e.indexOf(".")&&e.length>=this.intLength&&"."!==t||-1!==e.indexOf(".")&&("."===t||!this.computedNumberReg.test(e))||"."===t&&this.integer?e:("0"===e&&"."!==t?e=t:e+=t,e)},getDelValue:function(t){var e=this.amount+"";return"0"===e?e:(e=1===e.length?"0":e.substr(0,e.length-1),e)}}}),a=s,r=(i("95a8"),i("2877")),c=Object(r["a"])(a,n,o,!1,null,"2fae3907",null);e["a"]=c.exports},b05e:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"store-item"},[i("w-header",{attrs:{title:"编辑入库单明细",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{staticClass:"add-store-bar"},[i("van-button",{staticClass:"add-store-btn",attrs:{type:"primary",round:""},on:{click:t.onAddStoreClick}},[t._v("添加仓库")])],1),i("div",{staticClass:"store-item-content"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeStoreNames,callback:function(e){t.activeStoreNames=e},expression:"activeStoreNames"}},t._l(t.currentStoreItemData,function(e,n){return i("van-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.storeShowComputed(e),expression:"storeShowComputed(storeItem)"}],key:e.id,staticClass:"store-row",attrs:{name:e.id}},[i("div",{staticClass:"item-store-title",attrs:{slot:"title"},slot:"title"},[i("span",[t._v(t._s(e.name))])]),i("div",{staticClass:"item-storn-btn"},[i("span",{staticClass:"edit-btn",on:{click:function(i){return t.editStoreItem(e)}}}),i("span",{staticClass:"delete-btn",on:{click:function(i){return t.deleteStoreItem(e,n)}}})]),t._l(e.details,function(t,n){return i("div",{directives:[{name:"show",rawName:"v-show",value:"del"!==t.changeType,expression:"item.changeType !== 'del'"}],key:e.id+"-"+t.goodsDTO.id+"-"+n,staticClass:"item-row"},[i("itemInfoCell",{attrs:{itemData:t,isDisabled:!0,showEditBtn:!1}})],1)})],2)}),1)],1),i("div",{staticClass:"store-item-bottom"},[i("van-button",{staticClass:"save-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onSaveClick}},[t._v("保存")])],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.storePopShow,callback:function(e){t.storePopShow=e},expression:"storePopShow"}},[i("listComp",{attrs:{visibleFlag:t.storePopShow,data:t.storeList,loadFinished:!0,title:"仓库检索"},on:{"update:visibleFlag":function(e){t.storePopShow=e},"update:visible-flag":function(e){t.storePopShow=e},"on-search":t.searchStore,"on-select":t.selectStore}})],1),i("van-popup",{staticClass:"fx-list-popup-full scan-pop",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemPopShow,callback:function(e){t.itemPopShow=e},expression:"itemPopShow"}},[i("scanEditComp",t._b({attrs:{visibleFlag:t.itemPopShow,supplierId:t.supplierId,shopId:t.shopId,store:t.currentStoreObj,initGoods:t.scanGoods,parentStoreItem:t.computedStoreItem,orderItemList:t.currentStoreItemData},on:{"update:visibleFlag":function(e){t.itemPopShow=e},"update:visible-flag":function(e){t.itemPopShow=e},"on-confirm":t.onItemEditConfirm}},"scanEditComp",t.$attrs,!1))],1)],1)},o=[],s=(i("ac6a"),i("7f7f"),i("5176")),a=i.n(s),r=i("f499"),c=i.n(r),l=i("768b"),u=i("795b"),d=i.n(u),h=(i("20d6"),i("7514"),i("cebc")),p=i("2f62"),f=i("f6bb"),m=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-edit"},[i("div",{staticClass:"edit-head"},[i("van-icon",{attrs:{name:"cross"},on:{click:t.onCloseClick}})],1),i("div",{staticClass:"item-edit-content"},[i("div",{staticClass:"edit-content-wrap"},[i("div",{staticClass:"content-row"},[t._v("入库仓库："),i("span",[t._v(t._s(t.store.name))])]),i("div",[t._v("品项名称："),i("span",[t._v(t._s(t.scanGoods.goodsDTO.name))])]),i("div",[t._v("单位："),i("span",[t._v(t._s(t.scanGoods.unitDTO.name))])]),i("div",{staticClass:"content-row"},[t._v("数量："),i("span",{staticClass:"item-amount",on:{click:t.onItemEdit}},[t._v(t._s(t.scanGoods.busUnitInAmount))])]),"add"!==t.scanGoods.scanType?i("div",{staticClass:"content-row"},[i("span",{staticClass:"row-title"},[t._v("重复品项添加方式")]),i("van-radio-group",{staticClass:"radio-group",on:{change:t.onScanTypeClick},model:{value:t.scanType,callback:function(e){t.scanType=e},expression:"scanType"}},[i("van-radio",{staticClass:"radio-item",attrs:{name:"acc"}},[t._v("累加")]),i("van-radio",{attrs:{name:"cover"}},[t._v("覆盖")])],1)],1):t._e()])]),i("div",{staticClass:"item-bottom"},[i("van-button",{staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:t.onItemConfirm}},[t._v("完成")]),i("van-button",{staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onReScanClick}},[t._v("继续")])],1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.numberKeyboardShow,expression:"numberKeyboardShow"}],staticClass:"details-number-keyboard"},[i("itemNumberKeyboard",{attrs:{title:t.keyboardTitleCompted,unit:t.keyboardUnitCompted,amount:t.keyboardAmountCompted,pointSize:t.sysPointSize,intLength:t.numberLength,shortcutBtn:!1},on:{change:t.onKeyboardChange,hide:t.onKeyboardHide}})],1)])},S=[],v=i("59ad"),b=i.n(v),g=i("af41"),I={name:"scanEditComp",components:{itemNumberKeyboard:g["a"]},props:{visibleFlag:Boolean,store:{type:Object,default:function(){return{}}},initGoods:{type:Object,default:function(){return{}}},supplierId:{type:String,default:""},shopId:{type:String,default:""},orderItemList:{type:Array,default:function(){return[]}}},data:function(){return{activeNames:[],leftOptions:{showBackBtn:!0,preventGoBack:!0},itemClassList:[],numberKeyboardShow:!1,scanGoods:{},scanType:"acc",scanItemList:[]}},computed:Object(h["a"])({},Object(p["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",systemParams:"systemParams",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{keyboardTitleCompted:function(){return this.scanGoods.goodsDTO&&this.scanGoods.goodsDTO.name},keyboardUnitCompted:function(){return this.scanGoods.unitDTO&&this.scanGoods.unitDTO.name},keyboardAmountCompted:function(){return this.scanGoods.busUnitInAmount}}),watch:{visibleFlag:{handler:function(t){t&&(this.refresh(),this.scanItemList=JSON.parse(c()(this.orderItemList)),this.setScanGoods(this.initGoods))},immediate:!0}},methods:{refresh:function(){this.resetHandler()},resetHandler:function(){this.scanType="acc"},onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onItemConfirm:function(){var t=this;this.$nextTick(function(){t.setOrderItemList(t.scanGoods),t.$emit("on-confirm",[t.scanItemList,t.store]),t.$emit("update:visibleFlag",!1)})},onKeyboardChange:function(t){this.scanGoods.busUnitInAmount=t},numberStringAmount:function(){var t=this.scanGoods.busUnitInAmount;this.scanGoods.busUnitInAmount=b()(t)+""},onItemEdit:function(){this.numberKeyboardShow=!0},calcMoney:function(t,e,i){var n=i.taxPrice,o=i.busUnitInAmount,s=i.price,a=i.tax,r=0,c=0,l=0,u=0;if(e=this.toFixedNumberSize(e),i.giftFlag||"money"===t&&0===e)return i.inMoney=0,i.inMoneyWithTax=0,i.taxInMoney=0,!0;"money"===t?(r=e,l=this.toFixedNumberSize(r/o),c=r*(1+a),u=this.toFixedNumberSize(c/o)):"amount"===t?(i.busUnitInAmount=e,l=s,u=n,r=this.toFixedNumberSize(s*e),c=this.toFixedNumberSize(n*e)):"moneyWithTax"===t?(c=e,u=this.toFixedNumberSize(c/o),r=this.toFixedNumberSize(c/(1+a)),l=this.toFixedNumberSize(r/o)):"taxPrice"===t?(u=e,c=this.toFixedNumberSize(o*u),l=this.toFixedNumberSize(u/(1+a)),r=this.toFixedNumberSize(l*o)):"price"===t&&(l=e,r=this.toFixedNumberSize(l*o),u=this.toFixedNumberSize(l*(1+a)),c=this.toFixedNumberSize(o*u)),i.inMoney=r,i.inMoneyWithTax=c,i.taxInMoney=this.toFixedNumberSize(this.toFixedNumberSize(c)-this.toFixedNumberSize(r)),i.price=l,i.taxPrice=u},toFixedNumberSize:function(t){return b()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},onKeyboardHide:function(){this.numberStringAmount(),this.numberKeyboardShow=!1},editItem:function(t){t.id&&this.$set(t,"changeType","edit")},onScanTypeClick:function(t){this.scanGoods.scanType=t},onReScanClick:function(){var t=this;this.$fxCordova.barcodeScan().then(function(e){t.numberKeyboardShow=!1,t.setOrderItemList(t.scanGoods),t.getItemByTwoCode(e).then(function(e){t.setScanGoods(e[0])})})},setScanGoods:function(t){var e=this;t.busUnitInAmount=1;var i=this.scanItemList.find(function(t){return t.id===e.store.id});if(!i)return t.scanType="add",this.scanType=t.scanType,this.scanGoods=t,!0;var n=i.details.filter(function(e){return e.goodsDTO.id===t.goodsDTO.id&&"del"!==e.changeType});if(n.length){var o=n.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id&&t.unitDTO.id===e.unitDTO.id&&"del"!==e.changeType});this.systemParams.sysStockInSameGoods&&!~o?t.scanType="add":t.scanType="acc"}else t.scanType="add";this.scanType=t.scanType,this.scanGoods=t},setOrderItemList:function(t){var e=this,i=this.scanItemList.find(function(t){return t.id===e.store.id});if(!i){var n=this.store;return t.scanType="add",t.changeType="add",t.inHouseDTO=JSON.parse(c()(this.store)),this.calcMoney("amount",t.busUnitInAmount,t),n.details=[t],this.scanItemList.push(n),!0}var o=i.details.filter(function(e){return e.goodsDTO.id===t.goodsDTO.id&&"del"!==e.changeType});if(o.length){var s=i.details.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id&&t.unitDTO.id===e.unitDTO.id&&"del"!==e.changeType});if(this.systemParams.sysStockInSameGoods&&!~s){t.scanType="add",t.changeType="add";var a=t.pricePlanDTO;t.price=this.toFixedNumberSize(a.price),t.tax=this.toFixedNumberSize(a.taxes),t.taxPrice=this.toFixedNumberSize(a.priceWithTax),this.calcMoney("amount",t.busUnitInAmount,t),this.currentStore.details.push(t)}else{~s||(s=0);var r=i.details[s].unitDTO.value,l=t.unitDTO.value,u=0,d=i.details[s].busUnitInAmount;i.details[s].changeType="add"===i.details[s].changeType?"add":"edit","cover"===t.scanType?(this.systemParams.sysStockInChangeUnit?(u=b()(t.busUnitInAmount)*r/l,i.details[s].unitDTO=t.unitDTO):u=b()(t.busUnitInAmount)*l/r,i.details[s].busUnitInAmount=this.toFixedNumberSize(u)):(this.systemParams.sysStockInChangeUnit?(u=b()(d)*r/l+this.toFixedNumberSize(t.busUnitInAmount),i.details[s].unitDTO=t.unitDTO):u=b()(t.busUnitInAmount)*l/r+this.toFixedNumberSize(i.details[s].busUnitInAmount),i.details[s].busUnitInAmount=this.toFixedNumberSize(u)),this.calcMoney("amount",u,i.details[s])}}else{t.scanType="add",t.changeType="add";var h=t.pricePlanDTO;t.price=this.toFixedNumberSize(h.price),t.tax=this.toFixedNumberSize(h.taxes),t.taxPrice=this.toFixedNumberSize(h.priceWithTax),this.calcMoney("amount",t.busUnitInAmount,t),t.inHouseDTO=JSON.parse(c()(this.store)),i.details.push(t)}},getItemByTwoCode:function(t){var e={shopId:this.shopId,query:{barCode:t,houseId:this.store.id,supplierId:this.supplierId}};return this.$fxApi("z5common.getScanCodeBySM",e)().then(function(t){return t.billAndDetails})}}},y=I,k=(i("f65d"),i("2877")),x=Object(k["a"])(y,m,S,!1,null,"2357aaae",null),w=x.exports,C=i("987b"),D={name:"ScanStoreComp",components:{listComp:f["a"],scanEditComp:w,itemInfoCell:C["a"]},props:{visibleFlag:Boolean,shopId:{type:String,default:""},supplierId:{type:String,default:""},storeItemData:{type:Array,default:function(){return[]}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},storePopShow:!1,storeList:[],itemPopShow:!1,currentStoreObj:{},currentStoreItemData:[],activeStoreNames:[],scanGoods:{}}},computed:Object(h["a"])({},Object(p["c"])({sysPointSize:"sysPointSize",systemParams:"systemParams",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{computedStoreItem:function(){var t=this;if(this.$fxUtils.isEmptyObjSHW(this.currentStoreObj))return[];var e=this.currentStoreItemData.find(function(e){return e.id===t.currentStoreObj.id});return e?e.details:[]},storeShowComputed:function(t){return function(t){var e=t.details.filter(function(t){return"del"!==t.changeType}).length;return e>0}}}),watch:{visibleFlag:{handler:function(t){t&&(this.currentStoreItemData=this.storeItemData,this.openStoreItemList(this.currentStoreItemData))},immediate:!0}},methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onAddStoreClick:function(){this.onStoreRefresh()},searchStore:function(t){this.onStoreRefresh(t)},onStoreRefresh:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getStoreListData(e).then(function(e){t.storeList=e.shops.filter(function(e){var i=t.currentStoreItemData.find(function(t){var i=t.details.findIndex(function(t){return"del"!==t.changeType});return~i&&t.id===e.id});if(!i)return!0}),t.storePopShow=!0})},getStoreListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new d.a(function(i){var n={keyword:e,m:"list4ShopOrderBill"};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.shopId,"/users/").concat(t.loginerId,"/houses"),data:n}).then(function(t){i(t)})})},selectStore:function(t){this.currentStoreObj=t,this.barcodeScan()},onItemEditConfirm:function(t){var e=Object(l["a"])(t,2),i=e[0];e[1];this.currentStoreItemData=JSON.parse(c()(i))},editStoreItem:function(t){this.currentStoreObj=a()({},{code:t.code,id:t.id,name:t.name,pinYin:t.pinYin,updateIndicator:t.updateIndicator}),this.barcodeScan()},barcodeScan:function(){var t=this;this.$fxCordova.barcodeScan().then(function(e){t.getItemByTwoCode(e).then(function(e){t.scanGoods=e[0],t.itemPopShow=!0})})},deleteStoreItem:function(t,e){var i=this;this.$dialog.confirm({title:"提示",message:"确定要删除当前仓库品项吗?"}).then(function(){var n=t.details.filter(function(t){return!!t.id});if(0===n.length)return i.currentStoreItemData.splice(e,1),!1;n.forEach(function(t){t.changeType="del"}),i.currentStoreItemData[e].details=n}).catch(function(){})},onSaveClick:function(){this.$emit("on-save",this.currentStoreItemData),this.$emit("update:visibleFlag",!1)},openStoreItemList:function(t){var e=this;t.forEach(function(t){var i=t.details.filter(function(t){return"del"!==t.changeType}).length;i>0&&e.activeStoreNames.push(t.id)})},getItemByTwoCode:function(t){var e={shopId:this.shopId,query:{barCode:t,houseId:this.currentStoreObj.id,supplierId:this.supplierId}};return this.$fxApi("z5common.getScanCodeBySM",e)().then(function(t){return t.billAndDetails})}}},T=D,P=(i("a348"),Object(k["a"])(T,n,o,!1,null,"2b540ff2",null));e["a"]=P.exports},b346:function(t,e,i){"use strict";var n=i("6053"),o=i.n(n);o.a},b3be:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-search-block"},[i("w-header",{attrs:{title:"搜索品项",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("searchHead",{attrs:{initSearch:t.visibleFlag,searchKey:t.searchKey,selectActive:t.isSelectAll},on:{"update:searchKey":function(e){t.searchKey=e},"update:search-key":function(e){t.searchKey=e},"on-select-click":t.onSelectAllClick,"on-confirm-key":t.onConfirmKey}}),i("div",{ref:"details-content",staticClass:"item-list"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeStoreNames,callback:function(e){t.activeStoreNames=e},expression:"activeStoreNames"}},t._l(t.data,function(e){return i("van-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.storeShowComputed(e),expression:"storeShowComputed(storeItem)"}],key:e.id,staticClass:"store-row",attrs:{name:e.id}},[i("div",{staticClass:"item-store-title-container",attrs:{slot:"title"},slot:"title"},[i("w-icon",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],attrs:{type:"camera"},on:{click:function(i){return t.onCameraClick(e)}}}),i("div",{staticClass:"item-store-title"},[i("div",{staticClass:"fx-ellipsis"},[t._v(t._s(e.name))])])],1),t._l(t.detailFilter(e.details),function(n,o){return i("van-swipe-cell",{directives:[{name:"show",rawName:"v-show",value:"del"!==n.changeType&&n.showFlag,expression:"item.changeType !== 'del' && item.showFlag"}],key:e.id+"-"+n.goodsDTO.id+"-"+o,ref:"details-row-"+e.id+"-"+n.goodsDTO.id,refInFor:!0,staticClass:"item-row",attrs:{"right-width":80,disabled:t.isDisabled||t.focusing}},[i("div",{staticClass:"item-cell"},[i("checkBox",{staticClass:"search-checkbox",attrs:{visibleFlag:!t.isDisabled,checked:n.checked},on:{"on-checkbox-click":function(e){return t.onCheckBoxClick(n)}}}),i("itemInfoCell",{staticClass:"search-info",attrs:{itemData:n,isDisabled:t.isDisabled,sysStockInChangeUnit:t.sysStockInChangeUnit,disabledEditBtn:t.focusing},on:{"on-item-focus":function(i){return t.onItemFocus(arguments,e.id+"-"+n.goodsDTO.id)},"on-item-blur":t.onItemBlur,"on-unit-edit":t.onUnitEdit,"on-item-edit":t.onSearchItemEdit}})],1),i("div",{staticClass:"item-row-delete",attrs:{slot:"right"},on:{click:function(i){return t.onDeleteClick(n,o,e.details)}},slot:"right"},[t._v("删除")])])})],2)}),1)],1),i("div",{staticClass:"search-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onSearchConfirm}},[t._v("保存")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled,expression:"!isDisabled"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:t.onSelectConfirm}},[t._v("删除")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:!t.isDisabled&&t.$fxAuth("shopStockInBill.batchSetProducedate"),expression:"!isDisabled && $fxAuth('shopStockInBill.batchSetProducedate')"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:t.onSetProduceDate}},[t._v("批量设置")])],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,selcetPictureMode:t.selcetPictureMode},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-selcet-iamge":function(e){t.selcetPictureActionsheet=!0},"on-Confirm":t.onEditRowConfirm}})],1),i("van-actionsheet",{attrs:{actions:t.actions,"cancel-text":"取消"},on:{select:t.onSelect},model:{value:t.selcetPictureActionsheet,callback:function(e){t.selcetPictureActionsheet=e},expression:"selcetPictureActionsheet"}}),i("van-popup",{staticClass:"center-popup",attrs:{"close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.showBatchProduceDate,callback:function(e){t.showBatchProduceDate=e},expression:"showBatchProduceDate"}},[i("batchProduceDate",{attrs:{visibleFlag:t.showBatchProduceDate},on:{"update:visibleFlag":function(e){t.showBatchProduceDate=e},"update:visible-flag":function(e){t.showBatchProduceDate=e},"on-Confirm":t.onBatchProduceDate}})],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("w-action-sheet",{directives:[{name:"fx-history-back",rawName:"v-fx-history-back",value:t.scanActionShow,expression:"scanActionShow"}],ref:"scanActionSheet",attrs:{actions:t.scanActions},model:{value:t.scanActionShow,callback:function(e){t.scanActionShow=e},expression:"scanActionShow"}})],1)},o=[],s=(i("7f7f"),i("795b")),a=i.n(s),r=i("59ad"),c=i.n(r),l=(i("20d6"),i("6762"),i("2fdb"),i("28a5"),i("7514"),i("cebc")),u=(i("ac6a"),i("2f62")),d=i("987b"),h=i("8533"),p=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"itemRowEdit-popup"},[i("div",{staticClass:"batch-wrap"},[i("w-header",{attrs:{title:"批量设置",leftOptions:t.leftOptions}}),i("div",{staticClass:"itemRowEdit-content"},[i("van-cell",{attrs:{title:"生产日期：",value:t.fomatterDate(t.produceDate),"is-link":""},on:{click:t.onProductDateClick}})],1),i("div",{staticClass:"itemRowEdit-bottom"},[i("div",{staticClass:"batch-btn",on:{click:t.onCloseClick}},[t._v("取消")]),i("div",{staticClass:"batch-btn btn-query",on:{click:t.onConfirmClick}},[t._v("确认")])])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1)],1)},f=[],m={name:"batchProduceDate",components:{},props:{visibleFlag:Boolean},data:function(){return{leftOptions:{showBackBtn:!1,preventGoBack:!1},produceDate:new Date,currentDate:new Date,datePickerShow:!1}},computed:Object(l["a"])({},Object(u["c"])({sysPointSize:"sysPointSize",numberLength:"numberLength",maxAmount:"maxAmount",sysShowDZCData:function(t){return t.systemParams.sysShowDZCData},loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}}),{fomatterDate:function(t){var e=this;return function(t){return t?e.$fxUtils.setDateTime(new Date(t),"时分"):""}}}),watch:{visibleFlag:{handler:function(t){t&&(this.produceDate=this.$fxUtils.getCustomerDateAndTime(new Date,"00:00"))},immediate:!0}},methods:{onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onConfirmClick:function(){this.$emit("update:visibleFlag",!1),this.$emit("on-Confirm",this.produceDate)},onProductDateClick:function(){this.datePickerShow=!0},dateConfirmhandle:function(t){this.produceDate=t.getTime(),this.datePickerShow=!1}}},S=m,v=(i("bdd8"),i("2877")),b=Object(v["a"])(S,p,f,!1,null,"f4ce9bbe",null),g=b.exports,I=i("01db"),y=i("0f38"),k={name:"itemSearchPop",components:{itemInfoCell:d["a"],itemRowEditPop:h["a"],batchProduceDate:g,searchHead:I["a"],checkBox:y["a"]},props:{data:{type:Array,default:function(){return[]}},sysStockInChangeUnit:Boolean,isDisabled:Boolean,visibleFlag:Boolean,supplierId:String,billId:{type:String,default:function(){return""}}},data:function(){return{focusing:!1,leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",unitActions:[],unitActionShow:!1,itemRowEditPopShow:!1,itemEditRowData:{},activeStoreNames:[],showBatchProduceDate:!1,currentDate:new Date,datePickerShow:!1,scanActionShow:!1,scanActions:[{name:"累加数量"},{name:"覆盖数量"}],scanStoreItem:{},selcetPictureActionsheet:!1,selcetPictureMode:{},actions:[{name:"拍摄",value:"Camera"},{name:"从手机相册选择",value:"Library"}]}},watch:{visibleFlag:{handler:function(t){var e=this;t&&(this.searchKey="",this.showData(this.data),this.data.forEach(function(t){var i=t.details.filter(function(t){return"del"!==t.changeType}).length;i>0&&e.activeStoreNames.push(t.id)}))},immediate:!0}},computed:Object(l["a"])({},Object(u["c"])({sysPointSize:"sysPointSize"}),{isSelectAll:function(){var t=this;if(this.isDisabled)return"";var e=0,i=0;return this.data.forEach(function(n){var o=t.detailFilter(n.details);e+=o.filter(function(t){return"del"!==t.changeType&&t.showFlag&&t.checked}).length,i+=o.length}),0!==e&&e===i}}),methods:{onSelect:function(t){this.selcetPictureMode=Object(l["a"])({},t,{random:Math.random()}),this.selcetPictureActionsheet=!1},storeShowComputed:function(t){return this.detailFilter(t.details).length>0},detailFilter:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"code,name,pinYin";return t.filter(function(t){return"del"!==t.changeType&&t.showFlag&&!!i.split(",").find(function(i){if(t.goodsDTO[i].toLowerCase().includes(e.searchKey.toLowerCase()))return!0})})},onCloseClick:function(){if(this.focusing)return!1;this.$emit("update:visibleFlag",!1)},onDeleteClick:function(t,e,i){t.id?this.$set(t,"changeType","del"):i.splice(e,1)},onItemFocus:function(t,e){this.focusing=!0},onItemBlur:function(){this.focusing=!1},onSearchItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this.data.findIndex(function(e){return e.id===t.inHouseDTO.id});if(~e){var i=this.data[e].details.findIndex(function(e){return e.goodsDTO.id===t.goodsDTO.id});~i&&(this.data[e].details[i]=t)}},onUnitEdit:function(t){var e=this;this.itemEditRowData=t,this.getItemUnit(t.goodsDTO.id).then(function(t){e.unitActions=t,e.unitActionShow=!0})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemEditRowData,i=e.unitDTO.value,n=t,o=c()(e.busUnitInAmount);o>0?(o=o*i/n.value,e.busUnitInAmount=c()(this.$fxUtils.toFixedSHW(o,this.sysPointSize)),this.calcMoney("moneyWithTax",e.inMoneyWithTax,e)):(e.taxPrice=c()(e.taxPrice)*n.value/i,e.costTaxPrice=c()(e.costTaxPrice)*n.value/i,this.calcMoney("taxPrice",e.taxPrice,e));var s=c()(e.outOrderAmount);s=s*i/n.value,e.outOrderAmount=s,e.unitDTO=t},getItemUnit:function(t){var e=this;return new a.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/users/").concat(e.loginerId,"/goods/").concat(t,"/units")}).then(function(t){i(t.units)})})},calcMoney:function(t,e,i){var n=i.taxPrice,o=i.busUnitInAmount,s=i.price,a=i.tax,r=0,c=0,l=0,u=0;if(e=this.toFixedNumberSize(e),i.giftFlag||"money"===t&&0===e)return i.inMoney=0,i.inMoneyWithTax=0,i.taxInMoney=0,!0;"money"===t?(r=e,l=this.toFixedNumberSize(r/o),c=r*(1+a),u=this.toFixedNumberSize(c/o)):"amount"===t?(i.busUnitInAmount=e,l=s,u=n,r=this.toFixedNumberSize(s*e),c=this.toFixedNumberSize(n*e)):"moneyWithTax"===t?(c=e,u=this.toFixedNumberSize(c/o),r=this.toFixedNumberSize(c/(1+a)),l=this.toFixedNumberSize(r/o)):"taxPrice"===t?(u=e,c=this.toFixedNumberSize(o*u),l=this.toFixedNumberSize(u/(1+a)),r=this.toFixedNumberSize(l*o)):"price"===t&&(l=e,r=this.toFixedNumberSize(l*o),u=this.toFixedNumberSize(l*(1+a)),c=this.toFixedNumberSize(o*u)),i.inMoney=r,i.inMoneyWithTax=c,i.taxInMoney=this.toFixedNumberSize(this.toFixedNumberSize(c)-this.toFixedNumberSize(r)),i.price=l,i.taxPrice=u},toFixedNumberSize:function(t){return c()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},onSearchConfirm:function(){if(this.focusing)return!1;this.data.forEach(function(t){t.details.forEach(function(t){delete t.checked})}),this.$emit("on-search-confirm",this.data),this.$emit("update:visibleFlag",!1)},onCheckBoxClick:function(t){if(this.focusing)return!1;this.$set(t,"checked",!t.checked)},onSelectAllClick:function(){var t=this,e=!this.isSelectAll;this.data.forEach(function(i){var n=t.detailFilter(i.details);n.forEach(function(i){"del"!==i.changeType&&t.$set(i,"checked",e)})})},onSelectConfirm:function(){var t=this,e=this.data.find(function(t){return t.details.find(function(t){return t.checked&&"del"!==t.changeType})});if(!e)return this.$fxToast.top("请先选择品项!"),!0;this.$dialog.confirm({title:"提示",message:"是否删除？"}).then(function(){t.data.forEach(function(e){for(var i=e.details,n=i.length-1;n>=0;n--){var o=i[n];o.checked&&(o.id?t.$set(o,"changeType","del"):e.details.splice(n,1))}})})},onCameraClick:function(t){this.scanStoreItem=t,this.$fxEventBus.initEvent(this,"redCode",this.getItemByRedCode),this.$dialog.alert({title:"请扫码",message:"当前入库仓库：".concat(t.name),confirmButtonText:"取消扫码",beforeClose:function(t,e){this.$fxEventBus.$off("redCode",this.getItemByRedCode),e()}})},getItemByRedCode:function(t){var e=this;if(!this.visibleFlag)return!1;t.length<=24?this.onRedCodeHandler(t):this.getItemByTwoCode(t).then(function(t){if(0===t.length)return e.$fxToast.top("当前仓库无此品项!"),!1;e.setScanGood(t)})},onRedCodeHandler:function(t){var e=this;this.getItemByCode(t).then(function(t){var i=t.billAndDetails[0];if(0===i.length)return e.$fxToast.top("当前仓库无此品项!"),!1;e.hideItemData(e.data);for(var n=null,o=0;o<e.data.length;o++)if(n=e.data[o].details.find(function(t){return t.goodsDTO.id===i.goodsDTO.id&&"del"!==t.changeType}),n)break;n?(e.itemUpdate(i,n),e.$set(n,"showFlag",!0)):e.$fxToast.top("无此品项!"),e.searchKey=""})},itemUpdate:function(t,e){var i=e.unitDTO,n=t.unitDTO,o=n.value/i.value,s=t.goodsDTO.countValue*o;e.id&&this.$set(e,"changeType","edit"),this.calcMoney("amount",s,e)},getItemByCode:function(t){var e=this;return new a.a(function(i){var n={m:"getGoodsByBarCode4Modify",barCodes:t};e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/users/").concat(e.loginerId,"/goods"),data:n}).then(function(t){i(t)})})},hideItemData:function(t){var e=this;t.forEach(function(t){t.details.forEach(function(t){e.$set(t,"showFlag",!1)})})},showData:function(t){var e=this;t.forEach(function(t){t.details.forEach(function(t){e.$set(t,"showFlag",!0)})})},onConfirmKey:function(){""===this.searchKey&&this.showData(this.data)},getItemByTwoCode:function(t){var e=this;return new a.a(function(i){var n={billId:e.billId,qrCodeContent:t,houseId:e.scanStoreItem.id,supplierId:e.supplierId,billType:"20"};e.$fxHttp.requestPost({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.shopId,"/users/").concat(e.loginerId,"/getscancodedata"),query:n}).then(function(t){i(t.storeBillDetailDTO)})})},setScanGood:function(t){var e=this,i=this.scanStoreItem.details.findIndex(function(e){return t.goodsDTO.id===e.goodsDTO.id&&"del"!==e.changeType});if(!~i)return this.$fxToast.fail("当前仓库无此品项！"),!1;var n=this.$fxUtils.appointedMap(this.scanStoreItem.details,function(e,i){if(t.goodsDTO.id===e.goodsDTO.id&&t.unitDTO.id===e.unitDTO.id&&"del"!==e.changeType)return i});if(!n.length)return this.$fxToast.fail("不能重复添加品项！"),!1;var o=this.data.find(function(e){return e.details.find(function(e){return e.batchCode===t.batchCode&&"del"!==e.changeType})});if(o&&o.id!==this.scanStoreItem.id)return this.$fxToast.success("该批次号已存在,不能扫码入库！"),!1;var s=n.find(function(i){return e.scanStoreItem.details[i].batchCode===t.batchCode}),a={};if(a=s?this.scanStoreItem.details[s]:this.scanStoreItem.details[n[0]],a.batchCode!==t.batchCode&&this.$fxUtils.isDef(a.batchCode))return this.refreshSelectItem(t,a),!1;this.$refs.scanActionSheet.doSelect().then(function(i){"累加数量"===i.name&&e.computedScanItemAmount(t,a),e.refreshSelectItem(t,a)})},computedScanItemAmount:function(t,e){var i=this.toFixedNumberSize(t.busUnitInAmount+e.busUnitInAmount);t.busUnitInAmount=this.$fxCommon.checkAmountRange(i)},refreshSelectItem:function(t,e){e.busUnitInAmount=t.busUnitInAmount,e.batchCode=t.batchCode,e.productDate=t.productDate,e.autoType=3,this.editItem(e),this.calcMoney("amount",e.busUnitInAmount,e)},editItem:function(t){t.id&&this.$set(t,"changeType","edit")},onSetProduceDate:function(){var t=this.data.find(function(t){return t.details.find(function(t){return t.checked&&"del"!==t.changeType})});if(!t)return this.$fxToast.top("请先选择品项!"),!0;this.showBatchProduceDate=!0},onBatchProduceDate:function(t){var e=this;this.data.forEach(function(i){for(var n=i.details,o=n.length-1;o>=0;o--){var s=n[o];s.checked&&(s.productDate=t,s.id&&e.$set(s,"changeType","edit"))}})}}},x=k,w=(i("673b"),Object(v["a"])(x,n,o,!1,null,"da56c738",null));e["a"]=w.exports},bc59:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-info-block fx-shadow-block"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},[i("van-collapse-item",{attrs:{name:"1",disabled:t.collapseDisabled}},[i("div",{staticClass:"info-title",attrs:{slot:"title"},slot:"title"},[i("span",{staticClass:"info-title-name"},[t._v("单据信息")]),i("stateText",{staticClass:"stateTag fl-r",attrs:{billState:t.data.billState}}),i("span",{directives:[{name:"show",rawName:"v-show",value:1===t.data.weightState,expression:"data.weightState === 1"}],staticClass:"info-title-weightState"},[t._v("待称重")])],1),i("van-tabs",{attrs:{animated:""},model:{value:t.tabActive,callback:function(e){t.tabActive=e},expression:"tabActive"}},[i("van-tab",{attrs:{title:"表头"}},[i("van-cell",{staticClass:"info-item",attrs:{title:"入库机构","value-class":"info-item-value",value:t.data.shopDTO&&t.data.shopDTO.name,"is-link":!t.isDisabled},on:{click:function(e){return t.onEmitClick("on-shop-click")}}}),i("van-cell",{staticClass:"info-item",attrs:{title:"供货商","value-class":"info-item-value",value:t.data.supplierDTO&&t.data.supplierDTO.name,"is-link":!t.isDisabled},on:{click:function(e){return t.onEmitClick("on-supplier-click")}}}),i("van-cell",{staticClass:"info-item",attrs:{title:"业务日期",value:t.formatterDate(t.data.businessDate),"is-link":!t.isDisabled&&t.modifyBusinessDateFlag},on:{click:t.onBusDateClick}}),i("van-cell",{staticClass:"info-item",attrs:{title:"订货日期",value:t.formatterDate(t.data.orderDate),"is-link":!t.isDisabled},on:{click:function(e){return t.onEmitClick("on-orderDate-click")}}}),i("van-cell",{staticClass:"info-item",attrs:{title:"单据类型","value-class":"info-item-value",value:t.data.businessTypeDTO&&t.data.businessTypeDTO.name},on:{click:function(e){return t.onBillTypeClick("on-billType-click")}}},[i("van-icon",{directives:[{name:"show",rawName:"v-show",value:!(!t.isDisabled||t.data.fatherId),expression:"!isDisabled || data.fatherId ? false : true"}],staticClass:"item-clear-btn",attrs:{slot:"right-icon",name:t.hasBillType?"close":"arrow"},on:{click:function(e){e.stopPropagation(),t.hasBillType?t.onBillTypeClick("on-billType-clear"):t.onBillTypeClick("on-billType-click")}},slot:"right-icon"})],1),i("van-pro-field",{staticClass:"info-item",attrs:{label:"手工单号",placeholder:t.isDisabled?"":"请输入手工单号",maxlength:"50","input-align":"right",disabled:t.isDisabled},model:{value:t.data.manualCode,callback:function(e){t.$set(t.data,"manualCode",e)},expression:"data.manualCode"}}),i("van-pro-field",{staticClass:"info-item",attrs:{label:"整单备注",placeholder:t.isDisabled?"":"请输入整单备注","input-align":"right",disabled:t.isDisabled},model:{value:t.data.billMemo,callback:function(e){t.$set(t.data,"billMemo",e)},expression:"data.billMemo"}})],1),i("van-tab",{attrs:{title:"更多"}},[i("van-cell",{staticClass:"info-item",attrs:{title:"制单人",value:t.data.billEmp}}),i("van-cell",{staticClass:"info-item",attrs:{title:"制单日期",value:t.formatterDate(t.data.billDate)}}),i("van-cell",{staticClass:"info-item",attrs:{title:"审核人",value:t.data.checkEmp}}),i("van-cell",{staticClass:"info-item",attrs:{title:"审核日期",value:t.formatterDate(t.data.checkDate)}}),t.data.id?i("van-cell",{staticClass:"info-item",attrs:{title:"上传附件","value-class":"info-item-value","is-link":!t.isDisabled},on:{click:function(e){return t.onEmitClick("on-uploader-click")}}}):t._e()],1)],1)],1)],1)],1)},o=[],s=i("4760"),a={name:"orderInfo",components:{stateText:s["a"]},props:{data:{type:Object,default:function(){return{}}},isDisabled:Boolean,collapseDisabled:Boolean,modifyBusinessDateFlag:{type:Boolean,default:!1}},data:function(){return{activeNames:["1"],tabActive:0}},computed:{formatterDate:function(t){var e=this;return function(t){return"number"===typeof t?e.$fxUtils.setDateTime(new Date(t),"时分"):""}},hasBillType:function(){return this.data.businessTypeDTO&&this.data.businessTypeDTO.id}},methods:{onEmitClick:function(t){if(this.isDisabled)return!1;this.$emit(t)},onBillTypeClick:function(t){if(this.isDisabled||null!==this.data.fatherId)return!1;this.$emit(t)},closeCollapse:function(){this.activeNames=[]},onBusDateClick:function(){return!this.isDisabled&&(this.modifyBusinessDateFlag?void this.$emit("on-busdate-click"):(this.$toast({message:"当前没有修改业务日期权限!",position:"top"}),!1))}}},r=a,c=(i("f4dd"),i("2877")),l=Object(c["a"])(r,n,o,!1,null,"6f4c0931",null);e["a"]=l.exports},bdd8:function(t,e,i){"use strict";var n=i("72e4"),o=i.n(n);o.a},be45:function(t,e,i){},bfe1:function(t,e,i){},c0db:function(t,e,i){},c5bf:function(t,e,i){},cefa:function(t,e,i){},e0a9:function(t,e,i){},e4f5:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"inteledi-stockInBill-details"},[i("w-header",{attrs:{title:t.orderInfoData.sysbillCode,titleFontSize:"3.733vw",border:!0}}),i("orderInfo",{ref:"orderInfo",attrs:{data:t.orderInfoData,isDisabled:t.isBillState(1)||t.isWeightState(1)||t.isWeightState(2)||!t.$fxAuth("shopStockInBill.save"),collapseDisabled:t.itemInputFocusing,modifyBusinessDateFlag:t.modifyBusinessDateFlag},on:{"on-shop-click":t.onShopClick,"on-supplier-click":t.onSupplierClick,"on-busdate-click":t.onBusinessDateClick,"on-orderDate-click":t.onOrderDateClick,"on-billType-click":t.onBillTypeClick,"on-billType-clear":t.onBillTypeClear,"on-uploader-click":t.onUploaderClick}}),i("orderItem",{attrs:{data:t.orderItemList,isDisabled:t.isBillState(1)||t.isWeightState(1)||t.isWeightState(2)||!t.$fxAuth("shopStockInBill.save"),sysStockInChangeUnit:t.systemParams.sysStockInChangeUnit,itemInputFocusing:t.itemInputFocusing,hasFatherBillFlag:!!t.orderInfoData.fatherId},on:{"update:itemInputFocusing":function(e){t.itemInputFocusing=e},"update:item-input-focusing":function(e){t.itemInputFocusing=e},"on-add-click":t.onAddClick,"on-scan-click":t.onScanClick,"on-search-click":t.onSearchClick,"on-item-edit":t.onItemEdit,"on-unit-edit":t.onUnitEdit,"on-item-focus":t.onItemFocus}}),i("div",{staticClass:"stockInBill-bottom"},[i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopStockInBill.del")&&t.isBillState(0)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('shopStockInBill.del') && isBillState(0) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:t.onDeleteClick}},[t._v("\n\t\t\t删除\n\t\t")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopStockInBill.save")&&t.isBillState(0)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('shopStockInBill.save') && isBillState(0) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onSaveClick")}}},[t._v("\n\t\t\t保存\n\t\t")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopStockInBill.check")&&t.isBillState(0)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('shopStockInBill.check') && isBillState(0) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:function(e){return t.onClickHandler("onExpressClick")}}},[t._v("审核")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopStockInBill.unCheck")&&t.isBillState(1)&&t.isBillReState(0)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('shopStockInBill.unCheck') && isBillState(1) && isBillReState(0) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onUnExpressClick")}}},[t._v("反审")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopStockInBill.reCheck")&&t.isBillState(1)&&t.isBillReState(0),expression:"$fxAuth('shopStockInBill.reCheck') && isBillState(1) && isBillReState(0)"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:function(e){return t.onClickHandler("onBillReStateClick")}}},[t._v("复审")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopStockInBill.unReCheck")&&t.isBillReState(1),expression:"$fxAuth('shopStockInBill.unReCheck') && isBillReState(1)"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onUnBillReStateClick")}}},[t._v("取消复审")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopStockInBill.agree")&&t.isBillState(0)&&(t.isWeightState(0)||t.isWeightState(3))&&t.isEdiSendStateFlag(3)&&t.isEdiPriceFlag("0")&&(t.isStockType(0)||t.isStockType(2)),expression:"$fxAuth('shopStockInBill.agree') && isBillState(0) && (isWeightState(0) || isWeightState(3)) && isEdiSendStateFlag(3) && isEdiPriceFlag('0') && (isStockType(0) || isStockType(2))"}],staticClass:"fx-no-radius",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onAgreeEDIClick")}}},[t._v("同意EDI价格")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopStockInBill.agree")&&t.isBillState(0)&&(t.isWeightState(0)||t.isWeightState(3))&&t.isEdiSendStateFlag(3)&&t.isEdiPriceFlag("1")&&(t.isStockType(0)||t.isStockType(2)),expression:"$fxAuth('shopStockInBill.agree') && isBillState(0) && (isWeightState(0) || isWeightState(3)) && isEdiSendStateFlag(3) && isEdiPriceFlag('1') && (isStockType(0) || isStockType(2))"}],staticClass:"fx-no-radius",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onRefuseEDIClick")}}},[t._v("拒绝EDI价格")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopStockInBill.weighState")&&t.isBillState(0)&&(t.isWeightState(0)||t.isWeightState(3)),expression:"$fxAuth('shopStockInBill.weighState') && isBillState(0) && (isWeightState(0) || isWeightState(3))"}],staticClass:"bottom-btn fx-no-radius yellow-btn",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onWeightClick")}}},[t._v("下发称重")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopStockInBill.weighState")&&t.isBillState(0)&&(t.isWeightState(1)||t.isWeightState(2)),expression:"$fxAuth('shopStockInBill.weighState') && isBillState(0) && (isWeightState(1) || isWeightState(2))"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"danger"},on:{click:function(e){return t.onClickHandler("onUnWeightClick")}}},[t._v("取消称重")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopStockInBill.weighState")&&t.isBillState(0)&&t.isWeightState(2)&&t.sysDZCManyLower,expression:"$fxAuth('shopStockInBill.weighState') && isBillState(0) && isWeightState(2) && sysDZCManyLower"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onEndWeightClick")}}},[t._v("结束称重")]),i("van-button",{directives:[{name:"show",rawName:"v-show",value:t.$fxAuth("shopStockInBill.quickAccess")&&t.isBillState(1)&&t.isStockType(0),expression:"$fxAuth('shopStockInBill.quickAccess') && isBillState(1) && isStockType(0)"}],staticClass:"bottom-btn fx-no-radius",attrs:{type:"info"},on:{click:function(e){return t.onClickHandler("onQuickAccessClick")}}},[t._v("快速领用")])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:t.datePickerShow,callback:function(e){t.datePickerShow=e},expression:"datePickerShow"}},[i("w-date-picker",{attrs:{visibleFlag:t.datePickerShow,currentDate:t.currentDate},on:{"update:visibleFlag":function(e){t.datePickerShow=e},"update:visible-flag":function(e){t.datePickerShow=e},confirm:t.dateConfirmhandle}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.shopPopShow,callback:function(e){t.shopPopShow=e},expression:"shopPopShow"}},[i("listComp",{attrs:{visibleFlag:t.shopPopShow,data:t.shopList,loadFinished:t.shopListLoadFinished,loading:t.onShopLoading,title:"请选择门店"},on:{"update:visibleFlag":function(e){t.shopPopShow=e},"update:visible-flag":function(e){t.shopPopShow=e},"update:loading":function(e){t.onShopLoading=e},"on-search":t.searchShop,"on-select":t.selectShop,"on-load":t.onShopLoad}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.supplierPopShow,callback:function(e){t.supplierPopShow=e},expression:"supplierPopShow"}},[i("listComp",{attrs:{visibleFlag:t.supplierPopShow,data:t.supplierList,loadFinished:!0,title:"请选择供货商"},on:{"update:visibleFlag":function(e){t.supplierPopShow=e},"update:visible-flag":function(e){t.supplierPopShow=e},"on-search":t.searchSupplier,"on-select":t.selectSupplier}})],1),i("van-popup",{staticClass:"fx-list-popup-300",attrs:{position:"right","lock-scroll":!1},model:{value:t.billTypePopShow,callback:function(e){t.billTypePopShow=e},expression:"billTypePopShow"}},[i("listComp",{attrs:{visibleFlag:t.billTypePopShow,data:t.billTypeList,loadFinished:!0,title:"单据类型检索"},on:{"update:visibleFlag":function(e){t.billTypePopShow=e},"update:visible-flag":function(e){t.billTypePopShow=e},"on-search":t.searchBillType,"on-select":t.selectBillType}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemStorePopShow,callback:function(e){t.itemStorePopShow=e},expression:"itemStorePopShow"}},[i("storeItemComp",{attrs:{visibleFlag:t.itemStorePopShow,storeItemData:t.storeItem,orderItemList:t.orderItemList,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,supplierId:t.orderInfoData.supplierDTO&&t.orderInfoData.supplierDTO.id,businessDate:t.orderInfoData.businessDate,sysStockInSameGoods:t.systemParams.sysStockInSameGoods,sysStockInChangeUnit:t.systemParams.sysStockInChangeUnit,billId:t.orderInfoData.id},on:{"update:visibleFlag":function(e){t.itemStorePopShow=e},"update:visible-flag":function(e){t.itemStorePopShow=e},"on-save":t.onStoreItemSave}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.storeScanPopShow,callback:function(e){t.storeScanPopShow=e},expression:"storeScanPopShow"}},[i("scanStoreComp",{attrs:{visibleFlag:t.storeScanPopShow,storeItemData:t.storeItem,orderItemList:t.orderItemList,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,supplierId:t.orderInfoData.supplierDTO&&t.orderInfoData.supplierDTO.id},on:{"update:visibleFlag":function(e){t.storeScanPopShow=e},"update:visible-flag":function(e){t.storeScanPopShow=e},"on-save":t.onStoreItemSave}})],1),i("van-actionsheet",{attrs:{actions:t.unitActions,"cancel-text":"取消"},on:{select:t.onUnitSelect},model:{value:t.unitActionShow,callback:function(e){t.unitActionShow=e},expression:"unitActionShow"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,selcetPictureMode:t.selcetPictureMode,hasFatherBillFlag:!!t.orderInfoData.fatherId,isDisabled:t.isBillState(1)||t.isWeightState(1)||t.isWeightState(2)||!t.$fxAuth("shopStockInBill.save")},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e},"on-selcet-iamge":function(e){t.selcetPictureActionsheet=!0},"on-Confirm":t.onEditRowConfirm}})],1),i("van-actionsheet",{attrs:{actions:t.actions,"cancel-text":"取消"},on:{select:t.onSelect},model:{value:t.selcetPictureActionsheet,callback:function(e){t.selcetPictureActionsheet=e},expression:"selcetPictureActionsheet"}}),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemSearchPopShow,callback:function(e){t.itemSearchPopShow=e},expression:"itemSearchPopShow"}},[i("itemSearchPop",{attrs:{visibleFlag:t.itemSearchPopShow,data:t.searchItem,supplierId:t.orderInfoData.supplierDTO&&t.orderInfoData.supplierDTO.id,isDisabled:t.isBillState(1)||t.isWeightState(1)||t.isWeightState(2)||!t.$fxAuth("shopStockInBill.save"),sysStockInChangeUnit:t.systemParams.sysStockInChangeUnit,billId:t.orderInfoData.id},on:{"update:visibleFlag":function(e){t.itemSearchPopShow=e},"update:visible-flag":function(e){t.itemSearchPopShow=e},"on-search-confirm":t.onSearchConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.quickAccessPopShow,callback:function(e){t.quickAccessPopShow=e},expression:"quickAccessPopShow"}},[i("quickAccessPop",{attrs:{visibleFlag:t.quickAccessPopShow,data:t.searchItem,shopId:t.orderInfoData.shopDTO&&t.orderInfoData.shopDTO.id,isDisabled:t.isBillState(1)||t.isWeightState(1)||t.isWeightState(2)||!t.$fxAuth("shopStockInBill.save"),billId:t.orderInfoData.id},on:{"update:visibleFlag":function(e){t.quickAccessPopShow=e},"update:visible-flag":function(e){t.quickAccessPopShow=e},"on-search-confirm":t.onSearchConfirm}})],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.uploaderPopShow,callback:function(e){t.uploaderPopShow=e},expression:"uploaderPopShow"}},[i("uploaderEditPop",{attrs:{visibleFlag:t.uploaderPopShow,billId:t.orderInfoData.id},on:{"update:visibleFlag":function(e){t.uploaderPopShow=e},"update:visible-flag":function(e){t.uploaderPopShow=e}}})],1)],1)},o=[],s=(i("20d6"),i("7f7f"),i("5176")),a=i.n(s),r=i("75fc"),c=i("f499"),l=i.n(c),u=(i("7514"),i("b6d0")),d=i.n(u),h=i("774e"),p=i.n(h),f=i("59ad"),m=i.n(f),S=(i("ac6a"),i("795b")),v=i.n(S),b=(i("6762"),i("2fdb"),i("6b54"),i("cebc")),g=i("2f62"),I=i("bc59"),y=i("3d83"),k=i("f6bb"),x=i("30b4"),w=i("8533"),C=i("b3be"),D=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"item-search-block"},[i("w-header",{attrs:{title:"快速生成部门领用",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("searchHead",{attrs:{initSearch:t.visibleFlag,searchKey:t.searchKey,selectActive:t.isSelectAll},on:{"update:searchKey":function(e){t.searchKey=e},"update:search-key":function(e){t.searchKey=e},"on-select-click":t.onSelectAllClick}}),i("div",{staticClass:"order-info-block fx-shadow-block"},[i("van-cell-group",[i("van-cell",{staticClass:"info-item",attrs:{title:"领用部门",value:t.department,"value-class":"info-item-value","is-link":""},on:{click:t.onDepartmentClick}})],1)],1),i("div",{ref:"details-content",staticClass:"item-list"},[i("van-collapse",{attrs:{border:!1},model:{value:t.activeStoreNames,callback:function(e){t.activeStoreNames=e},expression:"activeStoreNames"}},t._l(t.data,function(e){return i("van-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.storeShowComputed(e),expression:"storeShowComputed(storeItem)"}],key:e.id,staticClass:"store-row",attrs:{name:e.id}},[i("div",{staticClass:"item-store-title-container",attrs:{slot:"title"},slot:"title"},[i("div",{staticClass:"item-store-title"},[i("div",{staticClass:"fx-ellipsis"},[t._v(t._s(e.name))])])]),t._l(t.detailFilter(e.details),function(n,o){return i("div",{directives:[{name:"show",rawName:"v-show",value:"del"!==n.changeType,expression:"item.changeType !== 'del'"}],key:e.id+"-"+n.goodsDTO.id+"-"+o,ref:"details-row-"+e.id+"-"+n.goodsDTO.id,refInFor:!0,staticClass:"item-row"},[i("div",{staticClass:"item-cell"},[i("checkBox",{staticClass:"search-checkbox",attrs:{visibleFlag:!0,checked:n.checked},on:{"on-checkbox-click":function(e){return t.onCheckBoxClick(n)}}}),i("itemInfoCell",{staticClass:"search-info",attrs:{itemData:n,isDisabled:t.isDisabled},on:{"on-item-edit":t.onSearchItemEdit}})],1)])})],2)}),1)],1),i("div",{staticClass:"search-bottom"},[i("van-button",{staticClass:"bottom-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onConfirm}},[t._v("确认")])],1),i("van-popup",{staticClass:"fx-list-popup-full",attrs:{position:"right","close-on-click-overlay":!1,"lock-scroll":!1},model:{value:t.itemRowEditPopShow,callback:function(e){t.itemRowEditPopShow=e},expression:"itemRowEditPopShow"}},[i("itemRowEditPop",{attrs:{visibleFlag:t.itemRowEditPopShow,itemData:t.itemEditRowData,isDisabled:!0},on:{"update:visibleFlag":function(e){t.itemRowEditPopShow=e},"update:visible-flag":function(e){t.itemRowEditPopShow=e}}})],1),i("filterListPopup",{attrs:{title:"部门检索",rollingLoad:!0,getDataApi:t.getDepartmentListData},on:{"on-select":t.selectDepartment},model:{value:t.departmentPopShow,callback:function(e){t.departmentPopShow=e},expression:"departmentPopShow"}})],1)},T=[],P=(i("28a5"),i("eb03")),F=i("987b"),A=i("01db"),B=i("0f38"),$={name:"quickAccessPop",components:{filterListPopup:P["a"],itemInfoCell:F["a"],itemRowEditPop:w["a"],searchHead:A["a"],checkBox:B["a"]},props:{data:{type:Array,default:function(){return[]}},isDisabled:Boolean,visibleFlag:Boolean,shopId:String,billId:{type:String,default:function(){return""}}},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},searchKey:"",itemRowEditPopShow:!1,itemEditRowData:{},activeStoreNames:[],department:"请选择",departmentId:"",departmentPopShow:!1,departmentList:[]}},watch:{visibleFlag:{handler:function(t){var e=this;t&&(this.searchKey="",this.data.forEach(function(t){var i=t.details.filter(function(t){return"del"!==t.changeType}).length;i>0&&e.activeStoreNames.push(t.id)}),this.setDefaultDepartment())},immediate:!0}},computed:{isSelectAll:function(){var t=this,e=0,i=0;return this.data.forEach(function(n){var o=t.detailFilter(n.details);e+=o.filter(function(t){return"del"!==t.changeType&&t.checked}).length,i+=o.length}),0!==e&&e===i}},methods:{storeShowComputed:function(t){return this.detailFilter(t.details).length>0},detailFilter:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"code,name,pinYin";return t.filter(function(t){return"del"!==t.changeType&&!!i.split(",").find(function(i){if(t.goodsDTO[i].toLowerCase().includes(e.searchKey.toLowerCase()))return!0})})},onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onSearchItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},checkSelectInfo:function(){var t=this;return new v.a(function(e){var i=t.data.filter(function(t){return t.details.find(function(t){return t.checked&&"del"!==t.changeType})});return 0===i.length?(t.$fxToast.top("请先选择品项!"),!1):t.departmentId?void e():(t.$fxToast.top("请先选择部门!"),!1)})},getSaveParams:function(){var t=[];this.data.forEach(function(e){t.push.apply(t,Object(r["a"])(e.details))});var e=t.reduce(function(t,e){var i=e.checked&&"del"!==e.changeType?t.concat(e.id):t;return i},[]);return e},onConfirm:function(){var t=this;this.checkSelectInfo().then(function(){var e={billId:t.billId,detailIds:t.getSaveParams(),departmentId:t.departmentId};return t.$fxApi("stockInBill.quickAccess")({data:e}).then(function(e){t.$dialog.alert({title:"提示",message:e.message}),t.$emit("update:visibleFlag",!1)})})},onCheckBoxClick:function(t){this.$set(t,"checked",!t.checked)},onSelectAllClick:function(){var t=this,e=!this.isSelectAll;this.data.forEach(function(i){var n=t.detailFilter(i.details);n.forEach(function(i){"del"!==i.changeType&&t.$set(i,"checked",e)})})},setDefaultDepartment:function(){var t=this,e={start:0,size:1,id:this.shopId};return this.$fxApi("z5common.getDepartment")({data:e}).then(function(e){t.department=e.departmentDTOData[0].name,t.departmentId=e.departmentDTOData[0].id})},onDepartmentClick:function(){this.departmentPopShow=!0},getDepartmentListData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,n={keyword:t,start:e,size:i,id:this.shopId};return this.$fxApi("z5common.getDepartment")({data:n}).then(function(t){return t.departmentDTOData})},selectDepartment:function(t){this.department=t.name,this.departmentId=t.id}}},O=$,L=(i("5d48"),i("2877")),N=Object(L["a"])(O,D,T,!1,null,"45a1db06",null),E=N.exports,U=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"billUploaderEdit-popup"},[i("w-header",{attrs:{title:"附件上传",leftOptions:t.leftOptions},on:{"on-click-back":t.onCloseClick}}),i("div",{staticClass:"billUploaderEdit-content"},[i("van-uploader",{staticClass:"uploader-item",attrs:{"before-read":t.imagePreview,"after-read":t.onRead,"max-size":20971520,accept:"image/*"},on:{oversize:t.onOversize}},[i("van-icon",{attrs:{size:"50px",name:"photograph"}})],1),i("ul",{staticClass:"img-list"},t._l(t.imgList,function(e,n){return i("li",{key:n},[i("img",{staticClass:"uploader-img",attrs:{src:t.fomatterFileSrc(e),onerror:t.$fxCommon.errorImg(t.fomatterFileSrc(e))}}),i("van-icon",{staticClass:"img-del",attrs:{name:"cross"},on:{click:function(i){return t.delImg(n,e)}}})],1)}),0)],1),i("div",{staticClass:"billUploaderEdit-bottom"},[t.isDisabled?t._e():i("van-button",{staticClass:"confirm-btn fx-no-radius",attrs:{type:"primary"},on:{click:t.onConfirmClick}},[t._v("保存")])],1)],1)},z=[],_={name:"uploaderEditPop",components:{},props:{visibleFlag:Boolean,billId:String,isDisabled:Boolean},data:function(){return{leftOptions:{showBackBtn:!0,preventGoBack:!0},imgList:[],delFiles:[]}},computed:Object(b["a"])({},Object(g["c"])({loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId}})),watch:{visibleFlag:{handler:function(t){t&&this.resetFilesList()},immediate:!0}},methods:{resetFilesList:function(){var t=this;return new v.a(function(e){t.imgList=[],t.delFiles=[],t.getList().then(function(i){t.imgList=i.storeBillImags,e(i)})})},fomatterFileSrc:function(t){return t.baseCode?t.baseCode:t.imagUrl},getList:function(){var t=this;return new v.a(function(e){t.$fxHttp.requestPost({url:"".concat(t.$fxBaseApi.url,"/upload/billId/").concat(t.billId,"/getAnnexByBillId")}).then(function(t){e(t)})})},onCloseClick:function(){this.$emit("update:visibleFlag",!1)},onConfirmClick:function(){var t=this;this.saveBill().then(function(e){t.resetFilesList().then(function(){t.$fxToast.success(e.message),t.$emit("update:visibleFlag",!1)})})},saveBill:function(){var t=this;return new v.a(function(e){var i=[];t.imgList.filter(function(t){t.fileCode&&i.push({name:"input_files[]",value:t.fileCode})});var n=t.delFiles.map(function(t){return t.imagUrl});i.push({name:"del_filename",value:n.join("\r\n")}),t.$fxHttp.requestFilePost({url:"".concat(t.$fxBaseApi.url,"/upload/billId/").concat(t.billId,"/uploadPictures"),data:i}).then(function(t){e(t)})})},onRead:function(t){this.imgList.push({fileCode:t.file,name:t.file.name,baseCode:t.content})},onOversize:function(t,e){this.$fxToast.fail("文件超过了允许大小20480KB!")},imagePreview:function(t){var e=this.imgList;return/\.(gif|jpg|png|GIF|JPG|PNG)$/.test(t.name)?!(e.length>=6)||(this.$fxToast.fail("最多可上传6张图片!"),!1):(this.$fxToast.fail("图片类型必须是.gif,jpg,png中的一种"),!1)},delImg:function(t,e){e.imagUrl&&this.delFiles.push(e),this.imgList.splice(t,1)}}},M=_,R=(i("b346"),Object(L["a"])(M,U,z,!1,null,"4f20de7c",null)),W=R.exports,H=i("b05e"),j=50,q={name:"stockInBillDetails",components:{orderInfo:I["a"],orderItem:y["a"],listComp:k["a"],storeItemComp:x["a"],itemRowEditPop:w["a"],itemSearchPop:C["a"],quickAccessPop:E,uploaderEditPop:W,scanStoreComp:H["a"]},data:function(){return{query:this.$route.query,orderInfoData:{},orderItemList:[],dateType:"business",currentDate:new Date,shopPopShow:!1,shopList:[],searchShopKey:null,onShopLoading:!1,shopListLoadFinished:!1,datePickerShow:!1,supplierPopShow:!1,supplierList:[],billTypePopShow:!1,billTypeList:[],itemStorePopShow:!1,storeScanPopShow:!1,storeItem:[],itemEditRowData:{},itemRowEditPopShow:!1,unitActions:[],unitActionShow:!1,itemInputFocusing:!1,orderDeleteFlag:!1,modifyBusinessDateFlag:!1,itemSearchPopShow:!1,searchItem:[],uploaderPopShow:!1,selcetPictureActionsheet:!1,selcetPictureMode:{},quickAccessPopShow:!1,actions:[{name:"拍摄",value:"Camera"},{name:"从手机相册选择",value:"Library"}]}},created:function(){var t=this;this.createOrderDetails().then(function(){0===t.systemParams.sysShopInWorkDate?t.modifyBusinessDateFlag=!0:t.modifyBusinessDateFlag=!1,1===t.orderInfoData.autoType&&(t.modifyBusinessDateFlag=!0)})},beforeRouteLeave:function(t,e,i){var n=this;if(this.itemInputFocusing)return this.$router.go(1),!1;"/stockInBill"!==t.path||this.orderDeleteFlag||0!==this.orderInfoData.billState?i():this.$dialog.confirm({title:"提示",message:"若已修改,请先保存单据<br/>是否关闭页面?"}).then(function(){i()}).catch(function(){return n.$router.go(1),!1})},computed:Object(b["a"])({},Object(g["c"])({sysPointSize:"sysPointSize",loginerShopId:function(t){return t.loginer.loginerShopId},loginerId:function(t){return t.loginer.loginerId},sysDZCManyLower:function(t){return t.systemParams.sysDZCManyLower},sysStockInPriceIsZeroPrompt:function(t){return t.systemParams.sysStockInPriceIsZeroPrompt},systemParams:"systemParams"}),{isBillState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.billState):e.orderInfoData.billState===t}},isBillReState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.billReState):e.orderInfoData.billReState===t}},isWeightState:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.weightState):e.orderInfoData.weightState===t}},isEdiSendStateFlag:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.ediSendState):e.orderInfoData.ediSendState===t}},isEdiPriceFlag:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.ediPriceFlag):e.orderInfoData.ediPriceFlag===t}},isStockType:function(t){var e=this;return function(t){return"[object Array]"===Object.prototype.toString.call(t)?t.includes(e.orderInfoData.stockType):e.orderInfoData.stockType===t}}}),methods:{createOrderDetails:function(){var t=this;return new v.a(function(e){t.getOrderDetails().then(function(i){var n=i.storeBills[0];t.orderInfoData=n,t.orderItemList=t.filterStoreItem(n.details),t.setDetailGoodsUUid(t.orderItemList),e()})})},getOrderDetails:function(){var t=this;return new v.a(function(e){t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/stockinbills/").concat(t.query.orderId,"/users/").concat(t.loginerId)}).then(function(t){e(t)})})},filterStoreItem:function(t){var e=this;t.forEach(function(t){var i=m()(t.busUnitInAmount);i&&!t.giftFlag?(t.price=e.toFixedNumberSize(t.inMoney/i),t.taxPrice=e.toFixedNumberSize(t.inMoneyWithTax/i)):(t.price=e.toFixedNumberSize(t.price),t.taxPrice=e.toFixedNumberSize(t.taxPrice)),t.busUnitInAmount=e.toFixedNumberSize(i),t.inMoney=e.toFixedNumberSize(t.inMoney),t.rawAmount=e.toFixedNumberSize(t.rawAmount),t.taxInMoney=e.toFixedNumberSize(t.taxInMoney),t.inMoneyWithTax=e.toFixedNumberSize(t.inMoneyWithTax)});var i=p()(new d.a(t.map(function(t){return t.inHouseDTO.id}))),n=i.map(function(e){var i=t.find(function(t){return t.inHouseDTO.id===e}).inHouseDTO;return i=JSON.parse(l()(i)),i.details=t.filter(function(t){return t.inHouseDTO.id===e}),i});return n},setDetailGoodsUUid:function(t){var e=this;t.forEach(function(t){t.details.forEach(function(t){t.goodsUUid=e.$fxUtils.createUUID()})})},onShopClick:function(){if(this.$fxStateMiddleware.stateIs("loginerOrganType")("shop")(this.loginerOrganType))return!0;this.shopListStart=0,this.searchShopKey=null,this.shopListLoadFinished=!1,this.onShopRefresh()},searchShop:function(t){this.shopListStart=0,this.searchShopKey=t,this.onShopRefresh()},onShopLoad:function(){var t=this;this.getShopListData().then(function(e){var i;(i=t.shopList).push.apply(i,Object(r["a"])(e.shops))})},onShopRefresh:function(){var t=this;this.getShopListData().then(function(e){t.shopList=e.shops,t.shopPopShow=!0})},getShopListData:function(){var t=this;return new v.a(function(e){var i={start:t.shopListStart,size:j,m:"list4ShopOtherOrderBill4Edit",keyword:t.searchShopKey};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/shops"),data:i}).then(function(i){t.onShopLoading=!1,t.shopListStart+=j,i.shops.length<j?t.shopListLoadFinished=!0:t.shopListLoadFinished=!1,e(i)})})},selectShop:function(t){var e=this;this.checkShop(t).then(function(){e.clearItemConfim("更换入库机构清空供货商和明细,是否继续?").then(function(){e.orderInfoData.shopDTO=t,e.orderInfoData.supplierDTO={},2===e.systemParams.sysShopInWorkDate&&e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(t.id,"/users/").concat(e.loginerId,"/nextaccountperiod")}).then(function(t){t.shopAccountPeriods.length&&(e.orderInfoData.businessDate=t.shopAccountPeriods[0].beginDate)})})})},checkShop:function(t){var e=this;return new v.a(function(i){var n=e.orderInfoData.shopDTO||{};n.id!==t.id&&i()})},onSupplierClick:function(){var t=this;if(!this.orderInfoData.shopDTO.id)return this.$fxToast.fail("请选择入库机构！"),!1;this.getSupplierListData().then(function(e){t.supplierList=e.suppliers,t.supplierPopShow=!0})},searchSupplier:function(t){var e=this;this.getSupplierListData(t).then(function(t){e.supplierList=t.suppliers,e.supplierPopShow=!0})},getSupplierListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new v.a(function(i){var n={paged:!0,size:50,start:0,searchText:e};t.$fxHttp.requestPost({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.orderInfoData.shopDTO.id,"/users/").concat(t.loginerId,"/suppliers"),data:n}).then(function(t){i(t)})})},selectSupplier:function(t){var e=this;this.checkSupplier(t).then(function(){e.clearItemConfim("更换供货商清空明细，是否确认修改?").then(function(){e.orderInfoData.supplierDTO=t})})},checkSupplier:function(t){var e=this;return new v.a(function(i){var n=e.orderInfoData.supplierDTO||{};n.id!==t.id&&i()})},onBusinessDateClick:function(){this.dateType="business",this.datePickerShow=!0},onOrderDateClick:function(){this.dateType="order",this.datePickerShow=!0},dateConfirmhandle:function(t){var e=t.getTime();"business"===this.dateType?this.orderInfoData.businessDate=e:this.orderInfoData.orderDate=e,this.datePickerShow=!1},getBillTypeListData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new v.a(function(i){var n={m:"list4ShopStockInBillEdit",keyword:e};t.$fxHttp.requestGet({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/users/").concat(t.loginerId,"/businessTypes"),data:n}).then(function(t){i(t)})})},onBillTypeClick:function(){var t=this;this.getBillTypeListData().then(function(e){t.billTypeList=e.businessTypes,t.billTypePopShow=!0})},searchBillType:function(t){var e=this;this.getBillTypeListData(t).then(function(t){e.billTypeList=t.businessTypes,e.billTypePopShow=!0})},selectBillType:function(t){this.orderInfoData.businessTypeDTO=t},onBillTypeClear:function(){this.orderInfoData.businessTypeDTO={}},clearItemConfim:function(t){var e=this;return new v.a(function(i){var n=e.orderItemList.filter(function(t){var e=t.details.filter(function(t){return"del"!==t.changeType});return 0!==e.length});0===n.length?i():e.$dialog.confirm({title:"提示",message:t}).then(function(){e.onItemClear(),i()}).catch(function(){})})},onItemClear:function(){this.orderInfoData.details=[],this.orderItemList=this.orderInfoData.details},onUnitEdit:function(t){var e=this;this.itemEditRowData=t,this.getItemUnit(t.goodsDTO.id).then(function(t){e.unitActions=t,e.unitActionShow=!0})},onUnitSelect:function(t){this.unitActionShow=!1;var e=this.itemEditRowData,i=e.unitDTO.value,n=t,o=m()(e.busUnitInAmount);o>0?(o=o*i/n.value,e.busUnitInAmount=m()(this.$fxUtils.toFixedSHW(o,this.sysPointSize)),this.calcMoney("moneyWithTax",e.inMoneyWithTax,e)):(e.taxPrice=m()(e.taxPrice)*n.value/i,e.costTaxPrice=m()(e.costTaxPrice)*n.value/i,this.calcMoney("taxPrice",e.taxPrice,e));var s=m()(e.outOrderAmount);s=s*i/n.value,e.outOrderAmount=s,e.unitDTO=t},getItemUnit:function(t){var e=this;return new v.a(function(i){e.$fxHttp.requestGet({url:"".concat(e.$fxBaseApi.url,"/accounts/").concat(e.loginerShopId,"/users/").concat(e.loginerId,"/goods/").concat(t,"/units")}).then(function(t){i(t.units)})})},calcMoney:function(t,e,i){var n=i.taxPrice,o=i.busUnitInAmount,s=i.price,a=i.tax,r=0,c=0,l=0,u=0;if(e=this.toFixedNumberSize(e),i.giftFlag||"money"===t&&0===e)return i.inMoney=0,i.inMoneyWithTax=0,i.taxInMoney=0,!0;"money"===t?(r=e,l=this.toFixedNumberSize(r/o),c=r*(1+a),u=this.toFixedNumberSize(c/o)):"amount"===t?(i.busUnitInAmount=e,l=s,u=n,r=this.toFixedNumberSize(s*e),c=this.toFixedNumberSize(n*e)):"moneyWithTax"===t?(c=e,u=this.toFixedNumberSize(c/o),r=this.toFixedNumberSize(c/(1+a)),l=this.toFixedNumberSize(r/o)):"taxPrice"===t?(u=e,c=this.toFixedNumberSize(o*u),l=this.toFixedNumberSize(u/(1+a)),r=this.toFixedNumberSize(l*o)):"price"===t&&(l=e,r=this.toFixedNumberSize(l*o),u=this.toFixedNumberSize(l*(1+a)),c=this.toFixedNumberSize(o*u)),i.inMoney=r,i.inMoneyWithTax=c,i.taxInMoney=this.toFixedNumberSize(this.toFixedNumberSize(c)-this.toFixedNumberSize(r)),i.price=l,i.taxPrice=u},toFixedNumberSize:function(t){return m()(this.$fxUtils.toFixedSHW(t,this.sysPointSize))},onAddClick:function(){var t=this;this.checkOrderInfo().then(function(){t.storeItem=JSON.parse(l()(t.orderItemList)),t.itemStorePopShow=!0})},onScanClick:function(){var t=this;this.checkOrderInfo().then(function(){t.storeItem=JSON.parse(l()(t.orderItemList)),t.storeScanPopShow=!0})},checkOrderInfo:function(){var t=this;return new v.a(function(e,i){t.orderInfoData.businessDate?e():t.$toast.fail("请先选择业务日期!")})},onStoreItemSave:function(t){this.orderItemList=t,this.setDetailGoodsUUid(this.orderItemList)},onSaveClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要保存该单据吗?"}).then(function(){t.checkDetails().then(function(){var e=t.getSaveParams();t.saveHandler(e)})}).catch(function(){})},saveHandler:function(t){var e=this;this.$fxHttp.requestPut({url:"".concat(this.$fxBaseApi.url,"/accounts/").concat(this.loginerShopId,"/stockinbills/").concat(this.query.orderId,"/users/").concat(this.loginerId),data:t,query:{m:"modify"}}).then(function(t){e.createOrderDetails().then(function(){e.$fxToast.success("保存成功")})})},onExpressClick:function(){var t=this;this.checkDetails().then(function(){var e="";if(t.sysStockInPriceIsZeroPrompt){var i=t.orderItemList.find(function(t){return t.details.find(function(t){return 0===t.inMoneyWithTax&&!t.giftFlag})});e=i?"存在非赠品价格为0的品项，是否继续审核?":"确定要审核该单据吗?"}else e="确定要审核该单据吗?";t.$dialog.confirm({title:"提示",message:e}).then(function(){t.expressHandler()})})},expressHandler:function(){var t=this;this.checkDetails().then(function(){var e=t.getSaveParams();t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/stockinbills/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:e,query:{userId:t.loginerId,m:"editAndCheck"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("审核成功")})}).catch(function(e){"1"===e.errorCode&&t.createOrderDetails()})})},onUnExpressClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要反审该单据吗?"}).then(function(){var e=t.getSaveParams();t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/stockinbills/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:e,query:{m:"unCheck"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("反审成功")})})}).catch(function(){})},onDeleteClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要删除该单据吗?"}).then(function(){var e=t.getSaveParams();t.$fxHttp.requestDel({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/stockinbills/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:e}).then(function(e){t.$fxToast.success("删除成功").then(function(){t.itemInputFocusing=!1,t.orderDeleteFlag=!0,t.$router.go(-1)})})}).catch(function(){})},onBillReStateClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要复审该单据吗?"}).then(function(){var e=t.getSaveParams();t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/stockinbills/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:e,query:{m:"reCheck"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("复审成功")})})}).catch(function(){})},onUnBillReStateClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定要取消复审该单据吗?"}).then(function(){var e=t.getSaveParams();t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/stockinbills/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:e,query:{m:"unReCheck"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("取消复审成功")})})}).catch(function(){})},onAgreeEDIClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定同意EDI价格吗？"}).then(function(){t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/stockinbills/").concat(t.query.orderId,"/users/").concat(t.loginerId),query:{m:"ediAgree"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("同意EDI价格成功")})})}).catch(function(){})},onRefuseEDIClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"确定拒绝EDI价格吗？"}).then(function(){t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/stockinbills/").concat(t.query.orderId,"/users/").concat(t.loginerId),query:{m:"ediReturn"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("拒绝EDI价格成功")})})}).catch(function(){})},onWeightClick:function(){var t=this;this.checkDetails().then(function(){t.$dialog.confirm({title:"提示",message:"确定要下发称重吗?"}).then(function(){var e=t.getSaveParams();if(!e)return!1;t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/stockinbills/").concat(t.query.orderId,"/users/").concat(t.loginerId),data:e,query:{userId:t.loginerId,m:"weighBill"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("下发称重成功")})})}).catch(function(){})})},onUnWeightClick:function(){var t=this;this.checkDetails().then(function(){var e="确定要取消称重吗?";2===t.orderInfoData.weighState&&(e="称重中的单据，取消称重后电子秤可以继续称重并传回数据！确定要取消称重吗"),t.$dialog.confirm({title:"提示",message:e}).then(function(){t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/stockinbills/").concat(t.query.orderId,"/users/").concat(t.loginerId),query:{userId:t.loginerId,m:"unWeighBill"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("取消称重成功")})})}).catch(function(){})})},onEndWeightClick:function(){var t=this;this.$dialog.confirm({title:"提示",message:"结束称重后将不再接收此单据的称重数据"}).then(function(){t.$fxHttp.requestPut({url:"".concat(t.$fxBaseApi.url,"/accounts/").concat(t.loginerShopId,"/stockinbills/").concat(t.query.orderId,"/users/").concat(t.loginerId),query:{userId:t.loginerId,m:"endWeighBill"}}).then(function(e){t.createOrderDetails().then(function(){t.$fxToast.success("结束称重成功")})})}).catch(function(){})},onQuickAccessClick:function(){this.quickAccessPopShow=!0,this.searchItem=JSON.parse(l()(this.orderItemList))},onClickHandler:function(t){if(this.itemInputFocusing)return!1;this[t]()},getSaveParams:function(){var t=[];this.orderItemList.forEach(function(e){t.push.apply(t,Object(r["a"])(e.details))});var e=t.filter(function(t){return"add"===t.changeType}),i=t.filter(function(t){return"del"===t.changeType}),n=t.filter(function(t){return"edit"===t.changeType}),o=a()(this.orderInfoData,{detailAdd:e.length>0?e:null,detailDel:i.length>0?i:null,detailMdf:n.length>0?n:null,details:[]});return o},checkDetails:function(){var t=this;return new v.a(function(e){var i=[];if(t.orderItemList.forEach(function(t){i.push.apply(i,Object(r["a"])(t.details))}),t.$fxSysAuth("shopStockInBill.sysStockProductionDate")){var n=i.reduce(function(t,e){var i="";return i=!e.productDate&&e.goodsDTO.periodFlag&&"del"!==e.changeType?""===t?t+e.goodsDTO.name:t+"<br/>"+e.goodsDTO.name:t,i},"");if(""!==n)return t.$dialog.alert({title:"提示",message:n+"生产日期不能为空！"}),!1}var o=i.filter(function(t){return"del"!==t.changeType});if(0===t.orderInfoData.autoType||7===t.orderInfoData.autoType);else if(t.$fxAuth("shopStockInBill.billMemoRequired")&&!t.orderInfoData.billMemo)return t.$fxToast.fail("请填写备注!"),!1;0===o.length?t.$fxToast.fail("单据明细不能为空"):e()})},onItemEdit:function(t){this.itemEditRowData=t,this.itemRowEditPopShow=!0},onEditRowConfirm:function(t){var e=this.orderItemList.findIndex(function(e){return e.id===t.inHouseDTO.id});if(~e){var i=this.orderItemList[e].details.findIndex(function(e){return e.goodsUUid===t.goodsUUid});~i&&(this.orderItemList[e].details[i]=t)}},onItemFocus:function(){this.$refs.orderInfo.closeCollapse()},onSearchClick:function(){this.itemSearchPopShow=!0,this.searchItem=JSON.parse(l()(this.orderItemList))},onSearchConfirm:function(t){this.orderItemList=t},onUploaderClick:function(){this.uploaderPopShow=!0},onSelect:function(t){this.selcetPictureMode=Object(b["a"])({},t,{random:Math.random()}),this.selcetPictureActionsheet=!1}}},G=q,K=(i("190c"),Object(L["a"])(G,n,o,!1,null,"1941edca",null));e["default"]=K.exports},f425:function(t,e,i){"use strict";var n=i("786c"),o=i.n(n);o.a},f4c8:function(t,e,i){},f4dd:function(t,e,i){"use strict";var n=i("1d3e"),o=i.n(n);o.a},f65d:function(t,e,i){"use strict";var n=i("865d"),o=i.n(n);o.a},f75d:function(t,e,i){},fb5d:function(t,e,i){},fc9a:function(t,e,i){},fd54:function(t,e,i){},ff3f:function(t,e,i){"use strict";var n=i("be45"),o=i.n(n);o.a}}]);
//# sourceMappingURL=stockInBill.1eb75191.js.map